(()=>{"use strict";var e={794:(e,t,n)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(i=o.key,r=void 0,r=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i),"symbol"===a(r)?r:String(r)),o)}var i,r}n.r(t),n.d(t,{default:()=>_});var i,r=n(642),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var t,n,a;return t=e,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var n=(0,r.video_getScale)();e*=n.x,t*=n.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var n=(0,r.video_getScale)();e*=n.x,t*=n.y,!0===this._pressed&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,n=e.clientY;return this._onDown(t,n)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",e)){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var n=t.pageX,a=t.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length){var a=t[n];e.preventDefault();var o=a.pageX,i=a.pageY;return this._onMove(o,i)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}])&&o(t.prototype,n),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();(i=_.prototype).addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},i.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},i.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;n++){var a=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}}},6378:(e,t,n)=>{n.r(t),n.d(t,{ES_DEAD:()=>De,ES_IDLE:()=>Ne,enemy_add_child:()=>we,enemy_create:()=>he,enemy_destroy:()=>be,enemy_get_child:()=>xe,enemy_get_list_of_names:()=>ve,enemy_get_observed_player:()=>ke,enemy_get_parent:()=>Ie,enemy_objects_init:()=>ge,enemy_observe_active_player:()=>Le,enemy_observe_current_player:()=>Re,enemy_observe_player:()=>Oe,enemy_release:()=>me,enemy_remove_child:()=>Se,enemy_render:()=>Ee,enemy_update:()=>ye});var a,o=n(7898),i=n(9880),r=n(7774),_=n(3450),s=n(4054),c=n(3031),d=n(2594),l=n(8529),u=function(e){return e.reference_to_current_state},p=function e(t,n){return null!=t?t.name?t:e(t.next,n):null},f=n(6432),g=n(2878),m=n(4163),v=function(e){var t=e.decorated_machine;t.init(t)},h=function(e){},b=function(e,t,n,a,o,i){var r,_=e.decorated_machine,s=e,c=e.get_object_instance(e),d=(0,m.timer_get_delta)();r=(0,g.v2d_multiply)(s.speed,d),c.actor.position=(0,g.v2d_add)(c.actor.position,r),_.update(_,t,n,a,o,i)},y=function(e,t){var n=e.decorated_machine;n.render(n,t)},E=n(9931),I=n(4470),x=n(5971),w=function(e){var t=e.decorated_machine;t&&t.init(t)},S=function(e){},k=function(e,t,n,a,o,i){var r,_=e.decorated_machine,l=e,u=e.get_object_instance(e);for(r=0;r<n;r++){var p=t[r];p&&(0,c.actor_pixelperfect_collision)(u.actor,p.actor)&&((0,x.player_attacking)(p)||p.invincible?(p.actor.is_jumping&&(0,x.player_bounce)(p),(0,s.level_add_to_score)(l.score),(0,s.level_create_item)(d.bW,(0,g.v2d_add)(u.actor.position,(0,g.v2d_new)(0,-15))),(0,s.level_create_animal)(u.actor.position),(0,E.sound_play)((0,I.soundfactory_get)("destroy")),u.state=De):p.hit(p))}_&&_.update(_,t,n,a,o,i)},O=function(e,t){var n=e.decorated_machine;n.render(n,t)},R=n(9386),L=n(8707),N=function(e){var t=e.decorated_machine;t.init(t)},D=function(e){},T=function(e,t,n,a,o,i){var r=e.decorated_machine,_=e,s=e.get_object_instance(e).actor,d=(0,m.timer_get_delta)(),l=null,u=null,p=null,f=null,g=null,v=null,h=null,b=null,y=.001*(0,m.timer_get_ticks)(),E=s.position;s.position.x+=-_.amplitude_x*_.angularspeed_x*Math.sin(_.initialphase_x+_.angularspeed_x*y)*d,s.position.y+=_.amplitude_y*_.angularspeed_y*Math.cos(_.initialphase_y+_.angularspeed_y*y)*d;var I=(0,c.actor_corners)(s,0,0,a,l,u,p,f,g,v,h,b);l=I.up,u=I.upright,p=I.right,f=I.downright,g=I.down,v=I.downleft,h=I.left,b=I.upleft;var x=(0,c.actor_handle_clouds)(s,0,l,u,p,f,g,v,h,b);l=x.up,u=x.upright,p=x.right,f=x.downright,g=x.down,v=x.downleft,h=x.left,b=x.upleft,null!=p&&s.position.x>E.x&&(s.position.x=s.hot_spot.x-(0,c.actor_image)(s).width+p.x),null!=h&&s.position.x<E.x&&(s.position.x=s.hot_spot.x+h.x+(0,L.brick_image)(h).width),null!=g&&s.position.y>E.y&&(s.position.y=s.hot_spot.y-(0,c.actor_image)(s).height+g.y),null!=l&&s.position.y<E.y&&(s.position.y=s.hot_spot.y+l.y+(0,L.brick_image)(l).height),r.update(r,t,n,a,o,i)},P=function(e,t){var n=e.decorated_machine;n.render(n,t)},M=function(e){var t=e.decorated_machine;t.init(t)},B=function(e){},C=function(e,t,n,a,o,i){var r=e.decorated_machine,_=e.get_object_instance(e).actor;(0,c.actor_move)(_,(0,c.actor_platform_movement)(_,a,(0,s.level_gravity)())),r.update(r,t,n,a,o,i)},A=function(e,t){var n=e.decorated_machine;n.render(n,t)},j=function(e,t){var n={};return n.init=F,n.release=V,n.update=H,n.render=U,n.get_object_instance=f.m,n.decorated_machine=e,n.look_strategy=t,n},F=function(e){var t=e.decorated_machine;t.init(t)},V=function(e){},H=function(e,t,n,a,o,i){var r=e.decorated_machine,_=e;t[0]&&_.look_strategy(_,t[0]),r.update(r,t,n,a,o,i)},U=function(e,t){var n=e.decorated_machine;n.render(n,t)},W=function(e){var t=e;t.get_object_instance(t).actor.mirror&=~R.IF_HFLIP},G=function(e){var t=e;t.get_object_instance(t).actor.mirror|=R.IF_HFLIP},Y=function(e){var t=e,n=t.get_object_instance(t),a=ke(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=~R.IF_HFLIP:n.actor.mirror|=R.IF_HFLIP)},K=function(e){var t=e,n=t.get_object_instance(t);n.actor.position.x>e.old_x?n.actor.mirror&=~R.IF_HFLIP:n.actor.mirror|=R.IF_HFLIP,e.old_x=n.actor.position.x},X=function(e){var t=e.decorated_machine;t.init(t)},q=function(e){},z=function(e,t,n,a,o,i){var r=e.decorated_machine,_=e,s=e.get_object_instance(e),c=ke(s);if(c){var d=(0,g.v2d_subtract)(c.actor.position,s.actor.position);if((0,g.v2d_magnitude)(d)>=5){var l=(0,m.timer_get_delta)(),u=(0,g.v2d_normalize)(d),p=(0,g.v2d_multiply)(u,_.speed*l);s.actor.position=(0,g.v2d_add)(s.actor.position,p)}}r.update(r,t,n,a,o,i)},Q=function(e,t){var n=e.decorated_machine;n.render(n,t)},J=function(e){var t=e.decorated_machine;te(e),t.init(t)},$=function(e){},Z=function(e,t,n,a,o,i){te(e)},ee=function(e,t){var n=e.decorated_machine;n.render(n,t)},te=function(e){var t=e,n=e.get_object_instance(e);(0,c.actor_change_animation)(n.actor,t.anim)},ne=function(e){var t=e.decorated_machine;t.init(t)},ae=function(e){},oe=function(e,t,n,a,o,i){var r=e.decorated_machine,_=e,s=e.get_object_instance(e).actor,d=(0,m.timer_get_delta)(),l=null,u=null,p=null,f=null,g=null,v=null,h=null,b=null;s.position.x+=_.direction*_.speed*d;var y=(0,c.actor_corners)(s,2,-2,a,l,u,p,f,g,v,h,b);l=y.up,u=y.upright,p=y.right,f=y.downright,g=y.down,v=y.downleft,h=y.left,b=y.upleft;var E=(0,c.actor_handle_clouds)(s,-2,l,u,p,f,g,v,h,b);l=E.up,u=E.upright,p=E.right,f=E.downright,g=E.down,v=E.downleft,h=E.left,b=E.upleft,null!=p&&_.direction>0&&(s.position.x=s.hot_spot.x-(0,c.actor_image)(s).width+p.x,_.direction=-1),null!=h&&_.direction<0&&(s.position.x=s.hot_spot.x+h.x+(0,L.brick_image)(h).width,_.direction=1),null!=g&&(null==f&&null!=v?_.direction=-1:null==v&&null!=f&&(_.direction=1)),r.update(r,t,n,a,o,i)},ie=function(e,t){var n=e.decorated_machine;n.render(n,t)},re={},_e=[{command:"set_animation",action:function(e,t,n){var a,r,_,s;return 2==t?(a=e,r=n[0],_=n[1],(s={}).init=J,s.release=$,s.update=Z,s.render=ee,s.get_object_instance=f.m,s.decorated_machine=a,s.anim=(0,i.sprite_get_animation)(r,_),e=s):(0,o.logfile_fatal_error)("Object script error - set_animation expects two parameters: sprite_name, animation_id"),e}},{command:"set_obstacle",action:function(e,t,n){1==t?e=objectdecorator_setobstacle_new(e,n[0],0):2==t?e=objectdecorator_setobstacle_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]")}},{command:"set_alpha",action:function(e,t,n){1==t?e=objectdecorator_setalpha_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))")}},{command:"hide",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,0):(0,o.logfile_fatal_error)("Object script error - hide expects no parameters")}},{command:"show",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,1):(0,o.logfile_fatal_error)("Object script error - show expects no parameters")}},{command:"enemy",action:function(e,t,n){var a,i,r;return 1==t?(a=e,i=n,(r={}).init=w,r.release=S,r.update=k,r.render=O,r.get_object_instance=f.m,r.decorated_machine=a,r.score=i,e=r):(0,o.logfile_fatal_error)("Object script error - enemy expects one parameter: score"),e}},{command:"lock_camera",action:function(e,t,n){4==t?e=objectdecorator_lockcamera_new(e,n[0],n[1],n[2],n[3]):(0,o.logfile_fatal_error)("Object script error - lock_camera expects four parameters: x1, y1, x2, y2")}},{command:"move_player",action:function(e,t,n){2==t?e=objectdecorator_moveplayer_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - move_player expects two parameters: speed_x, speed_y")}},{command:"hit_player",action:function(e,t,n){0==t?e=objectdecorator_hitplayer_new(e):(0,o.logfile_fatal_error)("Object script error - hit_player expects no parameters")}},{command:"burn_player",action:function(e,t,n){0==t?e=objectdecorator_burnplayer_new(e):(0,o.logfile_fatal_error)("Object script error - burn_player expects no parameters")}},{command:"shock_player",action:function(e,t,n){0==t?e=objectdecorator_shockplayer_new(e):(0,o.logfile_fatal_error)("Object script error - shock_player expects no parameters")}},{command:"acid_player",action:function(e,t,n){0==t?e=objectdecorator_acidplayer_new(e):(0,o.logfile_fatal_error)("Object script error - acid_player expects no parameters")}},{command:"add_rings",action:function(e,t,n){1==t?e=objectdecorator_addrings_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - add_rings expects one parameter: number_of_rings")}},{command:"add_to_score",action:function(e,t,n){1==t?e=objectdecorator_addtoscore_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - add_to_score expects one parameter: score")}},{command:"set_player_animation",action:function(e,t,n){2==t?e=objectdecorator_setplayeranimation_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - set_player_animation expects two parameters: sprite_name, animation_id")}},{command:"enable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_enableplayermovement_new(e):(0,o.logfile_fatal_error)("Object script error - enable_player_movement expects no parameters")}},{command:"disable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_disableplayermovement_new(e):(0,o.logfile_fatal_error)("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayerxspeed_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - set_player_xspeed expects one parameter: speed")}},{command:"set_player_yspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayeryspeed_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - set_player_yspeed expects one parameter: speed")}},{command:"set_player_position",action:function(e,t,n){2==t?e=objectdecorator_setplayerposition_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - set_player_position expects two parameters: xpos, ypos")}},{command:"bounce_player",action:function(e,t,n){0==t?e=objectdecorator_bounceplayer_new(e):(0,o.logfile_fatal_error)("Object script error - bounce_player expects no parameters")}},{command:"observe_player",action:function(e,t,n){1==t?e=objectdecorator_observeplayer_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - observe_player expects one parameter: player_name")}},{command:"observe_current_player",action:function(e,t,n){0==t?e=objectdecorator_observecurrentplayer_new(e):(0,o.logfile_fatal_error)("Object script error - observe_current_player expects no parameters")}},{command:"observe_active_player",action:function(e,t,n){0==t?e=objectdecorator_observeactiveplayer_new(e):(0,o.logfile_fatal_error)("Object script error - observe_active_player expects no parameters")}},{command:"observe_all_players",action:le},{command:"observe_next_player",action:le},{command:"attach_to_player",action:function(e,t,n){0==t?e=objectdecorator_attachtoplayer_new(e,0,0):1==t?e=objectdecorator_attachtoplayer_new(e,n[0],0):2==t?e=objectdecorator_attachtoplayer_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]")}},{command:"springfy_player",action:function(e,t,n){0==t?e=objectdecorator_springfyplayer_new(e):(0,o.logfile_fatal_error)("Object script error - springfy_player expects no parameters")}},{command:"roll_player",action:function(e,t,n){0==t?e=objectdecorator_rollplayer_new(e):(0,o.logfile_fatal_error)("Object script error - roll_player expects no parameters")}},{command:"walk",action:function(e,t,n){var a,i,r;return 1==t?(a=e,i=n,(r={}).init=ne,r.release=ae,r.update=oe,r.render=ie,r.get_object_instance=f.m,r.decorated_machine=a,r.speed=i,r.direction=-1,e=r):(0,o.logfile_fatal_error)("Object script error - walk expects one parameter: speed"),e}},{command:"gravity",action:function(e,t,n){var a,i,r;return 0==t?(a=e,r=i={},i.init=M,i.release=B,i.update=C,i.render=A,i.get_object_instance=f.m,r.decorated_machine=a,e=i):(0,o.logfile_fatal_error)("Object script error - gravity expects no parameters"),e}},{command:"jump",action:function(e,t,n){1==t?e=objectdecorator_jump_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - jump expects one parameter: jump_strength")}},{command:"move",action:ue},{command:"bullet_trajectory",action:ue},{command:"elliptical_trajectory",action:function(e,t,n){var a,i,r,_,s,c,d,l;return t>=4&&t<=6?(a=e,i=n[0],r=n[1],_=n[2],s=n[3],c=n[4],d=n[5],(l={}).init=N,l.release=D,l.update=T,l.render=P,l.get_object_instance=f.m,l.decorated_machine=a,l.amplitude_x=i,l.amplitude_y=r,l.angularspeed_x=_*(2*R.PI),l.angularspeed_y=s*(2*R.PI),l.initialphase_x=c*R.PI/180,l.initialphase_y=d*R.PI/180,e=l):(0,o.logfile_fatal_error)("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),e}},{command:"mosquito_movement",action:function(e,t,n){var a,i,r;return 1==t?(a=e,i=n,(r={}).init=X,r.release=q,r.update=z,r.render=Q,r.get_object_instance=f.m,r.decorated_machine=a,r.speed=i,e=r):(0,o.logfile_fatal_error)("Object script error - mosquito_movement expects one parameter: speed"),e}},{command:"look_left",action:function(e,t,n){0==t?e=j(e,W):(0,o.logfile_fatal_error)("Object script error - look_left expects no parameters")}},{command:"look_right",action:function(e,t,n){0==t?e=j(e,G):(0,o.logfile_fatal_error)("Object script error - look_right expects no parameters")}},{command:"look_at_player",action:function(e,t,n){return 0==t?e=j(e,Y):(0,o.logfile_fatal_error)("Object script error - look_at_player expects no parameters"),e}},{command:"look_at_walking_direction",action:function(e,t,n){return 0==t?e=j(e,K):(0,o.logfile_fatal_error)("Object script error - look_at_walking_direction expects no parameters"),e}},{command:"create_item",action:function(e,t,n){3==t?e=objectdecorator_createitem_new(e,n[0],n[1],n[2]):(0,o.logfile_fatal_error)("Object script error - create_item expects three parameters: item_id, offset_x, offset_y")}},{command:"change_closest_object_state",action:function(e,t,n){2==t?e=objectdecorator_changeclosestobjectstate_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name")}},{command:"create_child",action:function(e,t,n){3==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],""):4==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],n[3]):(0,o.logfile_fatal_error)("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]")}},{command:"change_child_state",action:function(e,t,n){2==t?e=objectdecorator_changechildstate_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - change_child_state expects two parameters: child_name, new_state_name")}},{command:"change_parent_state",action:function(e,t,n){1==t?e=objectdecorator_changeparentstate_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - change_parent_state expects one parameter: new_state_name")}},{command:"destroy",action:function(e,t,n){0==t?e=objectdecorator_destroy_new(e):(0,o.logfile_fatal_error)("Object script error - destroy expects no parameters")}},{command:"change_state",action:function(e,t,n){1==t?e=objectdecorator_ontimeout_new(e,0,n[0]):(0,o.logfile_fatal_error)("Object script error - change_state expects one parameter: new_state_name")}},{command:"on_timeout",action:function(e,t,n){2==t?e=objectdecorator_ontimeout_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name")}},{command:"on_collision",action:function(e,t,n){2==t?e=objectdecorator_oncollision_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - on_collision expects two parameters: object_name, new_state_name")}},{command:"on_animation_finished",action:function(e,t,n){1==t?e=objectdecorator_onanimationfinished_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_animation_finished expects one parameter: new_state_name")}},{command:"on_random_event",action:function(e,t,n){2==t?e=objectdecorator_onrandomevent_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name")}},{command:"on_player_collision",action:function(e,t,n){1==t?e=objectdecorator_onplayercollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_player_collision expects one parameter: new_state_name")}},{command:"on_player_attack",action:function(e,t,n){1==t?e=objectdecorator_onplayerattack_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_player_attack expects one parameter: new_state_name")}},{command:"on_player_rect_collision",action:function(e,t,n){5==t?e=objectdecorator_onplayerrectcollision_new(e,n[0],n[1],n[2],n[3],n[4]):(0,o.logfile_fatal_error)("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name")}},{command:"on_no_shield",action:function(e,t,n){1==t?e=objectdecorator_onnoshield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_no_shield expects one parameter: new_state_name")}},{command:"on_shield",action:function(e,t,n){1==t?e=objectdecorator_onshield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_shield expects one parameter: new_state_name")}},{command:"on_fire_shield",action:function(e,t,n){1==t?e=objectdecorator_onfireshield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_fire_shield expects one parameter: new_state_name")}},{command:"on_thunder_shield",action:function(e,t,n){1==t?e=objectdecorator_onthundershield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_thunder_shield expects one parameter: new_state_name")}},{command:"on_water_shield",action:function(e,t,n){1==t?e=objectdecorator_onwatershield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_water_shield expects one parameter: new_state_name")}},{command:"on_acid_shield",action:function(e,t,n){1==t?e=objectdecorator_onacidshield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_acid_shield expects one parameter: new_state_name")}},{command:"on_wind_shield",action:function(e,t,n){1==t?e=objectdecorator_onwindshield_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_wind_shield expects one parameter: new_state_name")}},{command:"on_brick_collision",action:function(e,t,n){1==t?e=objectdecorator_onbrickcollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_brick_collision expects one parameter: new_state_name")}},{command:"on_floor_collision",action:function(e,t,n){1==t?e=objectdecorator_onfloorcollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_floor_collision expects one parameter: new_state_name")}},{command:"on_ceiling_collision",action:function(e,t,n){1==t?e=objectdecorator_onceilingcollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_ceiling_collision expects one parameter: new_state_name")}},{command:"on_left_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onleftwallcollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_left_wall_collision expects one parameter: new_state_name")}},{command:"on_right_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onrightwallcollision_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - on_right_wall_collision expects one parameter: new_state_name")}},{command:"show_dialog_box",action:function(e,t,n){2==t?e=objectdecorator_showdialogbox_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - show_dialog_box expects two parameters: title, message")}},{command:"hide_dialog_box",action:function(e,t,n){0==t?e=objectdecorator_hidedialogbox_new(e):(0,o.logfile_fatal_error)("Object script error - hide_dialog_box expects no parameters")}},{command:"clear_level",action:function(e,t,n){0==t?e=objectdecorator_clearlevel_new(e):(0,o.logfile_fatal_error)("Object script error - clear_level expects no parameters")}},{command:"play_sample",action:function(e,t,n){1==t?e=objectdecorator_playsample_new(e,n[0],1,0,1,0):2==t?e=objectdecorator_playsample_new(e,n[0],n[1],0,1,0):3==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],1,0):4==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],0):5==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],n[4]):(0,o.logfile_fatal_error)("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]")}},{command:"play_music",action:function(e,t,n){1==t?e=objectdecorator_playmusic_new(e,n[0],0):2==t?e=objectdecorator_playmusic_new(e,n[0],n[1]):(0,o.logfile_fatal_error)("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]")}},{command:"play_level_music",action:function(e,t,n){0==t?e=objectdecorator_playlevelmusic_new(e):(0,o.logfile_fatal_error)("Object script error - play_level_music expects no parameters")}},{command:"set_music_volume",action:function(e,t,n){1==t?e=objectdecorator_setmusicvolume_new(e,n[0]):(0,o.logfile_fatal_error)("Object script error - set_music_volume expects one parameter: volume")}},{command:null,action:null}],se=function(e,t){return function(e,t){var n,i,r,_=t;if(0===_.state){var s=e.state.name;for(_.state,_.vm.state_list=(i=_.vm,r=e.state.list,null==p(i.state_list,r)&&(i.state_list=function(e,t,n){var a={};return a.name=t,a.data=(0,l.E)(n),a.next=e,a}(i.state_list,r,i.owner)),i.state_list),_.vm=function(e,t){var n=p(e.state_list,t);return null!=n?e.reference_to_current_state=n.data:(0,o.logfile_message)('Object script error: can\'t find state "%s".',t),e}(_.vm,s),n=u(_.vm),a=0,function(e,t){a<1024?(re[a]={},re[a].stmt=e,re[a].machine=t,a++):(0,o.logfile_message)("Object script error: you may write %d commands or less per state",1024)}(e.state.list,n);a-- >0;)n=ce(re[a].stmt,re[a].machine);n&&n.init(n)}return _.vm.reference_to_current_state=n,e.destroy_if_far_from_play_area&&(_.preserve=!1),e.always_active&&(_.always_active=!0),e.hide_unless_in_editor_mode&&(_.hide_unless_in_editor_mode=!0),_}(t,e)};function ce(e,t){var n,a,o,i,r=e;for(a=r.length,n=0;n<a;n++)i=(o=r[n])[1]&&void 0!==o[1]?o[1].length?o[1].length:1:0,t=de(t,o[0],i,o[1]);return t}function de(e,t,n,a){for(var o=0,i=_e[o++];null!=i.command&&null!=i.action;)i.command==t&&(e=i.action(e,n,a)),i=_e[o++];return e}function le(e,t,n){0==t?e=objectdecorator_observeallplayers_new(e):(0,o.logfile_fatal_error)("Object script error - observe_all_players expects no parameters")}function ue(e,t,n){var a,i,r,_;return 2==t?(a=e,i=n[0],r=n[1],(_={}).init=v,_.release=h,_.update=b,_.render=y,_.get_object_instance=f.m,_.decorated_machine=a,_.speed=(0,g.v2d_new)(i,r),e=_):(0,o.logfile_fatal_error)("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),e}var pe,fe=[],ge=function(){(0,o.logfile_message)("Loading objects scripts..."),pe=null,(0,_.resourcemanager_getJsonFile)("data/objects/enemies.json").then((function(e){Me(pe,e),pe=e}))},me=function(){},ve=function(e){return fe.name},he=function(e){return Te(e)},be=function(e){},ye=function(e,t,n,a,o,i){if(e){var r=u(e.vm);r.update(r,t,n,a,o,i)}},Ee=function(e,t){if(e){var n=u(e.vm);(!e.hide_unless_in_editor_mode||e.hide_unless_in_editor_mode&&(0,s.level_editmode)())&&n.render(n,t)}},Ie=function(e){return e.parent},xe=function(e,t){return je(e.children,t)},we=function(e,t,n){e.children=Ce(e.children,t,n),n.parent=e,n.created_from_editor=!1},Se=function(e,t){e.children=Ae(e.children,t)},ke=function(e){return null!=e.observed_player?e.observed_player:(0,s.level_player)()},Oe=function(e,t){e.observed_player=t},Re=function(e){e.observed_player=(0,s.level_player)()},Le=function(e){e.observed_player=null},Ne=0,De=1,Te=function(e){var t,n={},a={};return n.name=e,n.state=Ne,n.actor=(0,c.actor_create)(),n.actor.input=(0,r.input_create_computer)(),n.actor=(0,c.actor_change_animation)(n.actor,(0,i.sprite_get_animation)("SD_QUESTIONMARK",0)),n.preserve=!0,n.obstacle=!1,n.obstacle_angle=0,n.always_active=!1,n.hide_unless_in_editor_mode=!1,n.vm=((t={}).owner=n,t.state_list=null,t.reference_to_current_state=null,t),n.created_from_editor=!0,n.parent=null,n.children=Be(),n.observed_player=null,a.in_object_name=e,a.out_object_block=null,a.out_object_block=Pe(pe,a),null!=a.out_object_block?n=se(n,a.out_object_block):(0,o.logfile_message)("Object '%s' does not exist",e),n},Pe=function(e,t){var n=e[t.in_object_name];return n?(t.in_object_name,n):((0,o.logfile_message)("Object script error: unknown keyword '%s'",n),0)},Me=function(e,t){return e},Be=function(){return null},Ce=function(e,t,n){var a={};return a.name=t,a.data=n,a.next=e,a},Ae=function(e,t){var n,a;if(null!=e){if(e.data==t)return a=e.next,e.name=null,e=null,a;for(n=e;null!=n.next&&n.next.data!=t;)n=n.next;return null!=n.next&&(a=n.next.next,n.next.name=null,n.next=null,n.next=a),e}return null},je=function(e,t){for(var n=e;null!=n;){if(0==strcmp(n.name,t))return n.data;n=n.next}return null}},5176:(e,t,n)=>{n.r(t),n.d(t,{font_create:()=>l,font_destroy:()=>u,font_get_charsize:()=>g,font_get_charspacing:()=>m,font_get_text:()=>f,font_init:()=>d,font_render:()=>h,font_set_text:()=>p,font_set_width:()=>v});var a=n(7898),o=n(2954),i=n(2878),r=n(6038),_=n(9880),s=n(642),c=[],d=function(){var e,t,n,o=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for((0,a.logfile_message)("font_init()"),e=0;e<o.length;e++)for(c[e]={ch:[]},n="FT_FONT"+e,t=0;t<o[e].length;t++)c[e].ch[o[e][t]]=(0,_.sprite_get_image)((0,_.sprite_get_animation)(n,0),t);(0,a.logfile_message)("font_init() ok")},l=function(e){var t,n={};for(n.type=(0,o.clip)(e,0,9),n.text=null,n.width=0,n.visible=!0,n.hspace=n.vspace=1,n.value=[],n.position=(0,i.v2d_new)(0,0),t=0;t<5;t++)n.value[t]=0;return n},u=function(e){},p=function(e,t){if(!e)return!1;for(var n,a=arguments.length,o=new Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];for(n=0;n<o.length;n++)o[n]=""+o[n];var _=(t=""+t).match(/\$[A-Z_\d]\w+/g);if(_)for(n=0;n<_.length;n++){var s=_[n].slice(1),c=(0,r.lang_get)(s);c&&(t=t.replace("$"+s,c))}if(_=t.match(/\%[s]+/g))for(n=0;n<_.length;n++)if(o[n]){var d=o[n].match(/\$[A-Z_\d]\w+/g);d&&(o[n]=d[0].slice(1)),t=t.replace("%s",(0,r.lang_get)(o[n]))}if(_=t.match(/\%[d]+/g))for(n=0;n<_.length;n++)o[n]&&(t=t.replace("%d",""+o[n]));return e.text=""+t,e},f=function(e){return e.text?e.text:""},g=function(e){return b(e)},m=function(e){return(0,i.v2d_new)(e.hspace,e.vspace)},v=function(e,t){e.width=Math.max(0,t)},h=function(e,t){var n,a,i,r,_,d=0,l=0,u=[],p=0,f=0;u[f++]={r:!1,g:0,b:0};var g=b(e);if(n=g.x,a=g.y,e&&e.visible&&e.text)for(p=0;p<e.text.length;p++){if(i=e.text[p],_=!1,(0,o.isspace)(e.text[p-1])){var m=void 0,v=!1,h=0,I=e.text.slice(p),x=(I=(I=I.replace("(","")).replace(")","")).split(" ")[0];for(m=0;m<x.length;m++)"<"==x[m]&&(v=!0),v||h++,">"==x[m]&&(v=!1);_=e.width>0&&d+(n+e.hspace)*h-e.hspace>e.width}if("<"==i){var w=e.text.slice(p,p+7);if("<color="==w){var S,k,O;p+=7;var R=e.text.slice(p,p+6);S=E(R.slice(0,2)),k=E(R.slice(2,4)),O=E(R.slice(4,6)),u[f++]={r:S,g:k,b:O},p+=7,i=e.text[p]}"</color"==w&&(p+=8,i=e.text[p],f>=2&&f--)}_&&(d=0,l+=a+e.vspace),"\n"!=i?(r=c[e.type].ch[i])?(d+=r.width,(0,o.isspace)(e.text[p-1]),y((0,s.video_get_backbuffer)(),r,parseInt(e.position.x+d-(t.x-s.VIDEO_SCREEN_W/2),10),parseInt(e.position.y+l-(t.y-s.VIDEO_SCREEN_H/2),10),u[f-1].r,u[f-1].g,u[f-1].b)):d+=n+e.hspace:(d=0,l+=a+e.vspace)}},b=function(e){var t,n;if(e)for(t=0;t<256;t++)if(c[e.type]&&null!=(n=c[e.type].ch[t]))return(0,i.v2d_new)(n.width,n.height);return(0,i.v2d_new)(16,16)},y=function(e,t,n,a,o,i,r){var _=t.data;e.drawImage(_,t.sx,t.sy,t.swidth,t.sheight,n,a-2,t.width*s.VIDEO_SCALE,t.height*s.VIDEO_SCALE)},E=function(e){return(e=e.toLowerCase())>="0"&&e<="9"?e-"0":e>="a"&&e<="f"?e-"a"+10:255}},4878:(e,t,n)=>{n.r(t),n.d(t,{animal_create:()=>d});var a=n(3031),o=n(9880),i=n(2954),r=n(7774),_=n(9386),s=n(2594),c=n(4054),d=function(){var e={};return e.init=l,e.release=u,e.update=p,e.render=f,e},l=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,a.actor_create)(),e.actor.maxspeed=145+(0,i.random)(21),e.actor.input=(0,r.input_create_computer)(),t.is_running=!1,t.animal_id=(0,i.random)(12),(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_ANIMAL",0))},u=function(e){(0,a.actor_destroy)(e.actor)},p=function(e,t,n,d,l,u){var p,f,g,m,v=e,h=e.actor,b=2*v.animal_id+(v.is_running?1:0);(0,r.input_simulate_button_down)(h.input,r.IB_FIRE1),h.jump_strength=1.3*(200+(0,i.random)(50)),h.speed.x>_.EPSILON?(h.speed.x=h.maxspeed,h.mirror=_.IF_NONE):h.speed.x<-_.EPSILON&&(h.speed.x=-h.maxspeed,h.mirror=_.IF_HFLIP),(0,a.actor_change_animation)(h,(0,o.sprite_get_animation)("SD_ANIMAL",b));var y=(0,a.actor_corners)(h,2,-2,d,p,null,m,null,f,null,g,null);p=y.up,y.upright,m=y.right,y.downright,f=y.down,y.downleft,g=y.left,y.upleft;var E=(0,a.actor_handle_clouds)(h,-2,p,null,m,null,f,null,g,null);p=E.up,E.upright,m=E.right,E.downright,f=E.down,E.downleft,g=E.left,E.upleft,f&&!v.is_running&&(v.is_running=!0,h.speed.x=((0,i.random)(2)?-1:1)*h.maxspeed),g&&!p&&(h.speed.x=h.maxspeed),m&&!p&&(h.speed.x=-h.maxspeed),!v.is_running&&(f&&p||g&&m)&&(e.state=s.rJ),(0,a.actor_move)(h,(0,a.actor_platform_movement)(h,d,(0,c.level_gravity)()))},f=function(e,t){(0,a.actor_render)(e.actor,t)}},3446:(e,t,n)=>{n.r(t),n.d(t,{animalprison_create:()=>u});var a=n(9931),o=n(4470),i=n(3031),r=n(9880),_=n(4163),s=n(2954),c=n(2878),d=n(2594),l=n(4054),u=function(){var e={},t=e;return e.init=p,e.release=f,e.update=g,e.render=m,t.state=null,e},p=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),v(e,h()),(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ENDLEVEL",0))},f=function(e){(0,i.actor_destroy)(e.actor),v(e,null)},g=function(e,t,n,a,o,i){var r=e;r.state.handle(r.state,e,t,n)},m=function(e,t){(0,i.actor_render)(e.actor,t)},v=function(e,t){e.state=t},h=function(){var e={},t=e;return e.handle=b,t.being_hit=!1,t.hit_count=0,e},b=function(e,t,n,_){var s,c,d,l=e,u=t.actor;for(s=0;s<_;s++){var p=n[s];x(t,p)&&!l.being_hit&&(l.being_hit=!0,(0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_ENDLEVEL",1)),(0,a.sound_play)((0,o.soundfactory_get)("boss hit")),p.bounce(p),p.actor.speed.x*=-.5,++l.hit_count>=3&&v(t,(c=void 0,d=void 0,d=c={},c.handle=y,d.explode_timer=0,d.break_timer=0,c)))}(0,i.actor_animation_finished)(u)&&l.being_hit&&((0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_ENDLEVEL",0)),l.being_hit=!1)},y=function(e,t,n,r){var u,p=e,f=t.actor,g=(0,_.timer_get_delta)();if(p.explode_timer+=g,p.break_timer+=g,p.explode_timer>=.1){var m=(0,c.v2d_new)(f.position.x-f.hot_spot.x+(0,s.random)((0,i.actor_image)(f).width),f.position.y-f.hot_spot.y+(0,s.random)((0,i.actor_image)(f).height/2));(0,l.level_create_item)(d.bW,m),(0,a.sound_play)((0,o.soundfactory_get)("explode")),p.explode_timer=0}p.break_timer>=2&&v(t,((u={}).handle=E,u))},E=function(e,t,n,a){for(var o,_=t.actor,d=0;d<20;d++){var u=(0,c.v2d_new)(_.position.x-_.hot_spot.x+(0,s.random)((0,i.actor_image)(_).width),_.position.y-_.hot_spot.y+(0,s.random)((0,i.actor_image)(_).height/2));(0,l.level_create_animal)(u)}(0,l.level_clear)(_),(0,i.actor_change_animation)(_,(0,r.sprite_get_animation)("SD_ENDLEVEL",2)),v(t,((o={}).handle=I,o))},I=function(e,t,n,a){},x=function(e,t){if(e&&t){var n=[],a=[],o=e.actor,r=t.actor;return n[0]=r.position.x-r.hot_spot.x,n[1]=r.position.y-r.hot_spot.y,n[2]=n[0]+(0,i.actor_image)(r).width,n[3]=n[1]+(0,i.actor_image)(r).height,a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y,a[2]=a[0]+(0,i.actor_image)(o).width-10,a[3]=a[1]+(0,i.actor_image)(o).height/2,t.attacking(t)&&(0,s.bounding_box)(n,a)&&(0,i.actor_pixelperfect_collision)(o,r)}}},9930:(e,t,n)=>{n.r(t),n.d(t,{bigring_create:()=>l});var a=n(9931),o=n(4470),i=n(9880),r=n(3031),_=n(2594),s=n(5971),c=n(4054),d=n(7307),l=function(){var e={};return e.init=u,e.release=p,e.update=f,e.render=g,e},u=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,r.actor_create)(),t.is_disappearing=!1,(0,r.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_BLUERING",0))},p=function(e){(0,r.actor_destroy)(e.actor)},f=function(e,t,n,i,l,u){var p;for(p=0;p<n;p++){var f=t[p];f&&!f.dying&&(0,r.actor_collision)(f.actor,e.actor)&&(e.state=_.rJ,(0,s.player_set_rings)((0,s.player_get_rings)()+50),(0,c.level_add_to_secret_bonus)(5e3),(0,a.sound_play)((0,o.soundfactory_get)("big ring")),(0,c.level_call_dialogbox)("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),(0,d.quest_setvalue)(d.QUESTVALUE_BIGRINGS,(0,d.quest_getvalue)(d.QUESTVALUE_BIGRINGS)+1))}},g=function(e,t){(0,r.actor_render)(e.actor,t)}},8102:(e,t,n)=>{n.r(t),n.d(t,{bluering_create:()=>d});var a=n(9931),o=n(4470),i=n(9880),r=n(3031),_=n(2594),s=n(5971),c=n(4054),d=function(){var e={};return e.init=l,e.release=f,e.update=u,e.render=p,e},l=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,r.actor_create)(),t.is_disappearing=!1,(0,r.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_BLUERING",0))},u=function(e,t,n,d,l,u){var p=(0,c.level_player)(),f=e,g=e.actor;g.visible=p.got_glasses||(0,c.level_editmode)(),f.is_disappearing?(0,r.actor_animation_finished)(g)&&(e.state=_.rJ):!p.dying&&p.got_glasses&&(0,r.actor_collision)(g,p.actor)&&((0,r.actor_change_animation)(g,(0,i.sprite_get_animation)("SD_BLUERING",1)),(0,s.player_set_rings)((0,s.player_get_rings)()+5),(0,a.sound_play)((0,o.soundfactory_get)("blue ring")),f.is_disappearing=!0)},p=function(e,t){(0,r.actor_render)(e.actor,t)},f=function(e){(0,r.actor_destroy)(e.actor)}},3658:(e,t,n)=>{n.r(t),n.d(t,{bumper_create:()=>s});var a=n(9931),o=n(4470),i=n(3031),r=n(9880),_=n(2878),s=function(){var e={};return e.init=c,e.release=u,e.update=d,e.render=l,e},c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),t.getting_hit=!1,(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_BUMPER",0))},d=function(e,t,n,_,s,c){var d,l=e,u=e.actor;for(d=0;d<n;d++){var f=t[d];f&&!f.dying&&(0,i.actor_pixelperfect_collision)(f.actor,u)&&(l.getting_hit||(l.getting_hit=!0,(0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_BUMPER",1)),(0,a.sound_play)((0,o.soundfactory_get)("bumper")),p(e,f)))}l.getting_hit&&actor_animation_finished(u)&&(l.getting_hit=!1,(0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_BUMPER",0)))},l=function(e,t){(0,i.actor_render)(e.actor,t)},u=function(e){(0,i.actor_destroy)(e.actor)},p=function(e,t){var n,a,o,i=e.actor;(n=t.actor_speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=(0,_.v2d_multiply)((0,_.v2d_normalize)((0,_.v2d_subtract)(i.position,t.actor_position)),v2d_magnitude(n)),o=(0,_.v2d_multiply)(a,1),t.actor_speed=(0,_.v2d_multiply)((0,_.v2d_add)(n,(0,_.v2d_multiply)(o,-1e4)),1/10001),i.speed=(0,_.v2d_multiply)((0,_.v2d_add)(n,o),1/10001),t.flying=!1,t.landing=!1,t.climbing=!1,t.spring=!1}},649:(e,t,n)=>{n.r(t),n.d(t,{checkpointorb_create:()=>s});var a=n(9931),o=n(4470),i=n(3031),r=n(9880),_=n(4054),s=function(){var e={};return e.init=c,e.release=u,e.update=d,e.render=l,e},c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),t.is_active=!1,(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_CHECKPOINT",0))},d=function(e,t,n,s,c,d){var l,u=e,p=e.actor;if(u.is_active)(0,i.actor_animation_finished)(p)&&(0,i.actor_change_animation)(p,(0,r.sprite_get_animation)("SD_CHECKPOINT",2));else for(l=0;l<n;l++){var f=t[l];if(f&&!f.dying&&(0,i.actor_pixelperfect_collision)(f.actor,p)){u.is_active=!0,(0,a.sound_play)((0,o.soundfactory_get)("checkpoint")),(0,_.level_set_spawn_point)(p.position),(0,i.actor_change_animation)(p,(0,r.sprite_get_animation)("SD_CHECKPOINT",1));break}}},l=function(e,t){(0,i.actor_render)(e.actor,t)},u=function(e){(0,i.actor_destroy)(e.actor)}},4598:(e,t,n)=>{n.r(t),n.d(t,{crushedbox_create:()=>i});var a=n(9880),o=n(3031),i=function(){var e={};return e.init=r,e.release=c,e.update=_,e.render=s,e},r=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,o.actor_create)(),(0,o.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_ITEMBOX",10))},_=function(e,t,n,a,o,i){},s=function(e,t){(0,o.actor_render)(e.actor,t)},c=function(e){(0,o.actor_destroy)(e.actor)}},9412:(e,t,n)=>{n.r(t),n.d(t,{horizontaldanger_create:()=>_,horizontalfiredanger_create:()=>c,verticaldanger_create:()=>s,verticalfiredanger_create:()=>d});var a=n(9880),o=n(3031),i=n(5971),r=n(4054),_=function(){return l("SD_DANGER",m)},s=function(){return l("SD_VERTICALDANGER",m)},c=function(){return l("SD_FIREDANGER",v)},d=function(){return l("SD_VERTICALFIREDANGER",v)},l=function(e,t){var n={},a=n;return n.init=u,n.release=g,n.update=p,n.render=f,a.sprite_name=e,a.player_is_vulnerable=t,n},u=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,o.actor_create)(),(0,o.actor_change_animation)(e.actor,(0,a.sprite_get_animation)(t.sprite_name,0))},p=function(e,t,n,a,i,_){var s,c=e,d=e.actor;for(s=0;s<n;s++){var l=t[s];l&&(l.dying||l.blinking||l.invincible||!(0,o.actor_collision)(d,l.actor)||c.player_is_vulnerable(l)&&l.hit(l))}d.visible=(0,r.level_editmode)()},f=function(e,t){(0,o.actor_render)(e.actor,t)},g=function(e){(0,o.actor_destroy)(e.actor)},m=function(e){return!0},v=function(e){return e.shield_type!=i.SH_FIRESHIELD}},8397:(e,t,n)=>{n.r(t),n.d(t,{dangerouspower_create:()=>s,dangerouspower_set_speed:()=>c});var a=n(9880),o=n(4163),i=n(2878),r=n(3031),_=n(2594),s=function(){var e={};return e.init=d,e.release=p,e.update=l,e.render=u,e.dangerouspower_set_speed=c,e},c=function(e,t){e.actor_speed=t},d=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,r.actor_create)(),(0,r.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_DANGPOWER",0))},l=function(e,t,n,a,s,c){var d,l=(0,o.timer_get_delta)(),u=e.actor,p=(0,i.v2d_multiply)(u.speed,l);for(d=0;d<n;d++){var f=t[d];f&&!f.dying&&(0,r.actor_collision)(u,f.actor)&&(f.hit(f),e.state=_.rJ)}u.position=(0,i.v2d_add)(u.position,p)},u=function(e,t){(0,r.actor_render)(e.actor,t)},p=function(e){(0,r.actor_destroy)(e.actor)}},8514:(e,t,n)=>{n.r(t),n.d(t,{charge_dnadoor_create:()=>d,charge_horizontal_dnadoor_create:()=>p,neon_dnadoor_create:()=>c,neon_horizontal_dnadoor_create:()=>u,surge_dnadoor_create:()=>s,surge_horizontal_dnadoor_create:()=>l});var a=n(9880),o=n(4163),i=n(2954),r=n(3031),_=(n(2594),n(5971)),s=function(){return f(_.PL_SONIC,!0)},c=function(){return f(_.PL_TAILS,!0)},d=function(){return f(_.PL_KNUCKLES,!0)},l=function(){return f(_.PL_SONIC,!1)},u=function(){return f(_.PL_TAILS,!1)},p=function(){return f(_.PL_KNUCKLES,!1)},f=function(e,t){var n={},a=n;return n.init=g,n.release=h,n.update=m,n.render=v,a.authorized_player_type=e,a.is_vertical_door=t,n},g=function(e){var t,n,o=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,r.actor_create)(),n=parseInt(o.authorized_player_type,10),t=o.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",(0,r.actor_change_animation)(e.actor,(0,a.sprite_get_animation)(t,n))},m=function(e,t,n,a,_,s){var c,d,l={},u=e.actor,p=!1,f=!1,g=(0,o.timer_get_delta)(),m=[],v=[];for(e.obstacle=!0,d=0;d<n;d++){var h=t[d];h&&(h.dying||h.actor_carrying||h.actor_carried_by||!b(h,e)||(h.type==l.authorized_player_type?(e.obstacle=!1,f=(0,r.actor_pixelperfect_collision)(u,h.actor)):p=!0))}if(p&&(e.obstacle=!0),e.obstacle?u.alpha=Math.min(1,u.alpha+2*g):f&&(u.alpha=Math.max(.4,u.alpha-2*g)),f)for(m[0]=u.position.x-u.hot_spot.x-5,m[1]=u.position.y-u.hot_spot.y-5,m[2]=m[0]+(0,r.actor_image)(u).width+10,m[3]=m[1]+(0,r.actor_image)(u).height+10,c=_;null!=c;c=c.next)c.data.type==e.type&&(v[0]=c.data.actor_position.x-c.data.actor_hot_spot.x-5,v[1]=c.data.actor_position.y-c.data.actor_hot_spot.y-5,v[2]=v[0]+(0,r.actor_image)(c.data.actor).width+10,v[3]=v[1]+(0,r.actor_image)(c.data.actor).height+10,(0,i.bounding_box)(m,v)&&(c.data.actor_alpha<u.alpha?u.alpha=c.data.actor_alpha:c.data.actor_alpha=u.alpha))},v=function(e,t){(0,r.actor_render)(e.actor,t)},h=function(e){(0,r.actor_destroy)(e.actor)},b=function(e,t){var n=[],a=[],o=e.actor,_=t.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+(0,r.actor_image)(o).width,n[3]=n[1]+(0,r.actor_image)(o).height,a[0]=_.position.x-_.hot_spot.x,a[1]=_.position.y-_.hot_spot.y-3,a[2]=a[0]+(0,r.actor_image)(_).width,a[3]=a[1]+(0,r.actor_image)(_).height+3,(0,i.bounding_box)(n,a)}},7813:(e,t,n)=>{n.r(t),n.d(t,{door_close:()=>d,door_create:()=>s,door_open:()=>c});var a=n(9931),o=n(4470),i=n(4163),r=n(3031),_=n(9880),s=function(){var e={};return e.init=l,e.release=f,e.update=u,e.render=p,e},c=function(e){e.is_closed=!1,(0,a.sound_play)((0,o.soundfactory_get)("open door"))},d=function(e){e.is_closed=!0,(0,a.sound_play)((0,o.soundfactory_get)("close door"))},l=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,r.actor_create)(),t.is_closed=!0,(0,r.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_DOOR",0))},u=function(e,t,n,a,o,_){var s=e,c=e.actor,d=(0,i.timer_get_delta)();s.is_closed?c.position.y=parseInt(Math.min(c.position.y+2e3*d,c.spawn_point.y),10):c.position.y=parseInt(Math.max(c.position.y-2e3*d,c.spawn_point.y-.8*(0,r.actor_image)(c).height),10)},p=function(e,t){(0,r.actor_render)(e.actor,t)},f=function(e){(0,r.actor_destroy)(e.actor)}},8523:(e,t,n)=>{n.r(t),n.d(t,{endsign_create:()=>s});var a=n(9931),o=n(4470),i=n(9880),r=n(3031),_=n(4054),s=function(){var e={};return e.init=c,e.release=u,e.update=d,e.render=l,e},c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,r.actor_create)(),t.who=null,(0,r.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_ENDSIGN",0))},d=function(e,t,n,s,c,d){var l,u=e,p=e.actor;if(null==u.who)for(l=0;l<n;l++){var f=t[l];f&&!f.dying&&(0,r.actor_pixelperfect_collision)(f.actor,p)&&(u.who=f,(0,a.sound_play)((0,o.soundfactory_get)("end sign")),(0,r.actor_change_animation)(p,(0,i.sprite_get_animation)("SD_ENDSIGN",1)),(0,_.level_clear)(e.actor))}else if((0,r.actor_animation_finished)(p)){var g=2+u.who.type;(0,r.actor_change_animation)(p,(0,i.sprite_get_animation)("SD_ENDSIGN",g))}},l=function(e,t){(0,r.actor_render)(e.actor,t)},u=function(e){(0,r.actor_destroy)(e.actor)}},8092:(e,t,n)=>{n.r(t),n.d(t,{explosion_create:()=>_});var a=n(9880),o=n(2954),i=n(3031),r=n(2594),_=function(){var e={};return e.init=s,e.release=l,e.update=c,e.render=d,e},s=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.actor_create)(),(0,i.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_EXPLOSION",(0,o.random)(2)))},c=function(e,t,n,a,o,_){(0,i.actor_animation_finished)(e.actor)&&(e.state=r.rJ)},d=function(e,t){(0,i.actor_render)(e.actor,t)},l=function(e){(0,i.actor_destroy)(e.actor)}},3842:(e,t,n)=>{n.r(t),n.d(t,{falglasses_create:()=>c,falglasses_set_speed:()=>d});var a=n(9386),o=n(9880),i=n(4163),r=n(2878),_=n(4054),s=n(3031),c=function(){var e={};return e.init=l,e.release=f,e.update=u,e.render=p,e},d=function(e,t){null!=e.actor&&(e.actor.speed=t)},l=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=actor.create(),(0,s.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GLASSES",4)),e.actor.hot_spot.y*=.5},u=function(e,t,n,o,c,d){var l=e.actor,u=(0,i.timer_get_delta)();l.angle+=Math.sign(l.speed.x)*(6*a.PI*u),l.position=(0,r.v2d_add)(l.position,(0,s.actor_particle_movement)(l,(0,_.level_gravity)()))},p=function(e,t){(0,s.actor_render)(e.actor,t)},f=function(e){(0,s.actor_destroy)(e.actor)}},581:(e,t,n)=>{n.r(t),n.d(t,{flyingtext_create:()=>s,flyingtext_set_text:()=>c});var a=n(9880),o=n(4163),i=n(3031),r=n(5176),_=n(2594),s=function(){var e={};return e.init=d,e.release=p,e.update=l,e.render=u,e.set_text=c,e},c=function(e,t){var n=e;(0,r.font_set_text)(n.font,t)},d=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.actor_create)(),t.elapsed_time=0,t.font=(0,r.font_create)(0),(0,r.font_set_text)(t.font,"0"),(0,i.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_RING",0)),e.actor.visible=!1},l=function(e,t,n,a,i,r){var s=e,c=(0,o.timer_get_delta)();s.elapsed_time+=c,s.elapsed_time<.5?e.actor.position.y-=100*c:s.elapsed_time>2&&(e.state=_.rJ),s.font.position=e.actor.position},u=function(e,t){var n=e;(0,r.font_render)(n.font,t)},p=function(e){var t=e;(0,i.actor_destroy)(e.actor),(0,r.font_destroy)(t.font)}},6052:(e,t,n)=>{n.r(t),n.d(t,{goalsign_create:()=>_});var a=n(3031),o=n(9880),i=n(2594),r=n(4286),_=function(){var e={};return e.init=s,e.release=l,e.update=c,e.render=d,e},s=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,a.actor_create)(),(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",0))},c=function(e,t,n,_,s,c){var d,l=(0,r.E)(e,s,i.pp,null);d=null!=l?l.actor.position.x>e.actor.position.x?0:1:0,(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",d))},d=function(e,t){(0,a.actor_render)(e.actor,t)},l=function(e){(0,a.actor_destroy)(e.actor)}},9294:(e,t,n)=>{n.r(t),n.d(t,{icon_change_animation:()=>u,icon_create:()=>l});var a=n(7709),o=n(3031),i=n(9880),r=n(4163),_=n(2954),s=n(2878),c=n(2594),d=n(4054),l=function(){var e={};return e.init=p,e.release=m,e.update=f,e.render=g,e.change_animation=u,e},u=function(e,t){(0,o.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_ICON",t))},p=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,o.actor_create)(),t.elapsed_time=0,u(e,0)},f=function(e,t,n,i,l,u){var p=e,f=e.actor,g=(0,r.timer_get_delta)();if(p.elapsed_time+=g,p.elapsed_time<1)f.position.y-=40*g;else if(p.elapsed_time>=2.5){var m,v,h,b=parseInt(f.position.x-f.hot_spot.x,10),y=parseInt(f.position.y-f.hot_spot.y,10),E=(0,o.actor_image)(f);for(m=0;m<E.h;m++)for(v=0;v<E.w;v++)h=(0,a.image_create)(1,1),(0,a.image_clear)(h,255,255,255),(0,d.level_create_particle)(h,(0,s.v2d_new)(b+v,y+m),(0,s.v2d_new)(v-E.width/2+((0,_.random)(E.width)-E.width/2),m-(0,_.random)(E.height/2)),!1);e.state=c.rJ}},g=function(e,t){(0,o.actor_render)(e.actor,t)},m=function(e){(0,o.actor_destroy)(e.actor)}},4667:(e,t,n)=>{n.r(t),n.d(t,{acidshieldbox_create:()=>I,emptybox_create:()=>h,fireshieldbox_create:()=>b,glassesbox_create:()=>g,lifebox_create:()=>l,ringbox_create:()=>u,shieldbox_create:()=>m,speedbox_create:()=>f,starbox_create:()=>p,thundershieldbox_create:()=>y,trapbox_create:()=>v,watershieldbox_create:()=>E,windshieldbox_create:()=>x});var a=n(2594),o=n(5971),i=n(2878),r=n(9880),_=n(9931),s=n(4470),c=n(4054),d=n(3031),l=function(){return A(w,0)},u=function(){return A(S,3)},p=function(){return A(k,4)},f=function(){return A(O,5)},g=function(){return A(R,6)},m=function(){return A(L,7)},v=function(){return A(B,8)},h=function(){return A(C,9)},b=function(){return A(N,11)},y=function(){return A(D,12)},E=function(){return A(T,13)},I=function(){return A(P,14)},x=function(){return A(M,15)},w=function(e,t){(0,c.level_add_to_score)(100),(0,o.player_set_lives)((0,o.player_get_lives)()+1),(0,c.level_override_music)((0,s.soundfactory_get)("1up"))},S=function(e,t){(0,c.level_add_to_score)(100),(0,o.player_set_rings)((0,o.player_get_rings)()+10),(0,_.sound_play)((0,s.soundfactory_get)("ring"))},k=function(e,t){(0,c.level_add_to_score)(100),t.invincible=!0,t.invtimer=0,(0,_.music_play)((0,_.music_load)("data/music/invincible.mp4"),0)},O=function(e,t){(0,c.level_add_to_score)(100),t.got_speedshoes=!0,t.speedshoes_timer=0,(0,_.music_play)((0,_.music_load)("data/music/speed.mp4"),0)},R=function(e,t){(0,c.level_add_to_score)(100),t.got_glasses=!0},L=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_SHIELD,(0,_.sound_play)((0,s.soundfactory_get)("shield"))},N=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_FIRESHIELD,(0,_.sound_play)((0,s.soundfactory_get)("fire shield"))},D=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_THUNDERSHIELD,(0,_.sound_play)((0,s.soundfactory_get)("thunder shield"))},T=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_WATERSHIELD,(0,_.sound_play)((0,s.soundfactory_get)("water shield"))},P=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_ACIDSHIELD,(0,_.sound_play)((0,s.soundfactory_get)("acid shield"))},M=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=o.SH_WINDSHIELD,audio.sound_play((0,s.soundfactory_get)("wind shield"))},B=function(e,t){player_hit(t)},C=function(e,t){(0,c.level_add_to_score)(100)},A=function(e,t){var n={},a=n;return n.init=j,n.release=H,n.update=F,n.render=V,a.on_destroy=e,a.anim_id=t,n},j=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,d.actor_create)(),(0,d.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ITEMBOX",t.anim_id))},F=function(e,t,n,l,u,p){var f,g=e.actor,m=e;for(f=0;f<n;f++){var v=t[f];if(v&&!(v.actor.is_jumping&&v.actor.speed.y<-10)&&e.state===a.Hx&&U(e,v)&&(0,o.player_attacking)(v)){console.log("ITEM BOX HIT");var h=(0,c.level_create_item)(a.C_,(0,i.v2d_add)(g.position,(0,i.v2d_new)(0,-5)));h.change_animation(h,m.anim_id),(0,c.level_create_item)(a.bW,(0,i.v2d_add)(g.position,(0,i.v2d_new)(0,-20))),(0,c.level_create_item)(a.z8,g.position),(0,_.sound_play)((0,s.soundfactory_get)("destroy")),v.actor.is_jumping&&v.bounce(v),m.on_destroy(e,v),e.state=a.rJ}}m.anim_id=m.anim_id<t.length?(0,c.level_player_id)():m.anim_id,(0,d.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ITEMBOX",m.anim_id))},V=function(e,t){(0,d.actor_render)(e.actor,t)},H=function(e){(0,d.actor_destroy)(e.actor)},U=function(e,t){var n,a=e.actor.position;return n=(0,d.actor_collision)(e.actor,t.actor),e.actor.position=a,n}},9024:(e,t,n)=>{n.r(t),n.d(t,{loopfloor_create:()=>u,loopfloornone_create:()=>p,loopfloortop_create:()=>f,loopleft_create:()=>d,loopnone_create:()=>l,loopright_create:()=>s,looptop_create:()=>c});var a=n(4286),o=n(2594),i=n(5971),r=n(3031),_=n(9880),s=function(){return g(E,"SD_LOOPRIGHT")},c=function(){return g(I,"SD_LOOPMIDDLE")},d=function(){return g(x,"SD_LOOPLEFT")},l=function(){return g(w,"SD_LOOPNONE")},u=function(){return g(S,"SD_LOOPFLOOR")},p=function(){return g(k,"SD_LOOPFLOORNONE")},f=function(){return g(O,"SD_LOOPFLOORTOP")},g=function(e,t){var n={},a=n;return n.init=m,n.release=v,n.update=h,n.render=b,a.on_collision=e,a.sprite_name=t,n},m=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,r.actor_create)(),e.actor=(0,r.actor_change_animation)(e.actor,(0,_.sprite_get_animation)(t.sprite_name,0))},v=function(e){},h=function(e,t,n,a,o,i){var _,s=e,c=e.actor;for(c.visible=!1,_=0;_<n;_++){var d=t[_];d&&(0,r.actor_collision)(c,d.actor)&&(d.at_loopfloortop=y(e,o,d),s.on_collision(d))}},b=function(e,t){(0,r.actor_render)(e.actor,t)},y=function(e,t,n){var i=(0,a.E)(e,t,o.Bh,null);return null!=i&&(0,r.actor_collision)(n.actor,i.actor)},E=function(e){e.disable_wall|=i.PLAYER_WALL_LEFT,e.entering_loop=!0,e.bring_to_back=!1},I=function(e){if(!e.flying){var t=e.actor.speed.x>0;e.disable_wall&=~(i.PLAYER_WALL_LEFT|i.PLAYER_WALL_RIGHT),e.disable_wall|=t?i.PLAYER_WALL_RIGHT:i.PLAYER_WALL_LEFT,e.bring_to_back=t}},x=function(e){e.disable_wall|=i.PLAYER_WALL_RIGHT,e.entering_loop=!0,e.bring_to_back=!0},w=function(e){e.entering_loop||(e.disable_wall=i.PLAYER_WALL_NONE,e.bring_to_back=!1)},S=function(e){e.at_loopfloortop||e.flying||(e.disable_wall|=i.PLAYER_WALL_BOTTOM,e.entering_loop=!0,e.bring_to_back=!0)},k=function(e){e.at_loopfloortop||e.entering_loop||e.flying||(e.disable_wall&=~i.PLAYER_WALL_BOTTOM,e.bring_to_back=!1)},O=function(e){if(!e.flying)if(e.disable_wall&i.PLAYER_WALL_BOTTOM){var t=e.actor.speed.x>0;e.disable_wall&=~(i.PLAYER_WALL_LEFT|i.PLAYER_WALL_RIGHT),e.disable_wall|=t?i.PLAYER_WALL_RIGHT:i.PLAYER_WALL_LEFT,e.bring_to_back=!0}else e.disable_wall&=~(i.PLAYER_WALL_LEFT|i.PLAYER_WALL_RIGHT),e.bring_to_back=!0}},3465:(e,t,n)=>{n.r(t),n.d(t,{ring_create:()=>p,start_bouncing:()=>f});var a=n(9931),o=n(4470),i=n(2594),r=n(3031),_=n(9880),s=n(4163),c=n(7774),d=n(2954),l=(n(2878),n(5971)),u=n(4054),p=function(){var e={};return e.init=g,e.release=m,e.update=v,e.render=h,e},f=function(e){e.is_moving=!0,e.actor.speed.x=e.actor.maxspeed*((0,d.random)(100)-50)/100,e.actor.speed.y=-e.actor.jump_strength+(0,d.random)(e.actor.jump_strength)},g=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,r.actor_create)(),e.actor.maxspeed=220+(0,d.random)(140),e.actor.jump_strength=1.2*(350+(0,d.random)(50)),e.actor.input=(0,c.input_create_computer)(),t.is_disappearing=!1,t.is_moving=!1,t.life_time=0,(0,r.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_RING",0))},m=function(e){},v=function(e,t,n,p,f,g){var m,v=(0,s.timer_get_delta)(),h=e,b=e.actor;for(m=0;m<n;m++){var y=t[m];if(y&&(!h.is_moving||h.is_moving&&!y.getting_hit&&h.life_time>=.5)&&!h.is_disappearing&&!y.dying&&(0,r.actor_collision)(b,y.actor)){(0,l.player_set_rings)((0,l.player_get_rings)()+1),h.is_disappearing=!0,(0,a.sound_play)((0,o.soundfactory_get)("ring"));break}}if(h.is_disappearing)(0,r.actor_change_animation)(b,(0,_.sprite_get_animation)("SD_RING",1)),(0,r.actor_animation_finished)(b)&&(e.state=i.rJ);else if(h.is_moving){if((0,c.input_simulate_button_down)(b.input,c.IB_FIRE1),e.preserve=!1,h.life_time+=v,h.life_time>5){var E=240+(0,d.random)(20);b.visible=parseInt(((0,s.timer_get_ticks)(),10))<E/2,h.life_time>8&&(e.state=i.rJ)}(0,r.actor_move)(b,(0,r.actor_platform_movement)(b,p,(0,u.level_gravity)()))}},h=function(e,t){(0,r.actor_render)(e.actor,t)}},2796:(e,t,n)=>{n.r(t),n.d(t,{ceilingspikes_create:()=>u,floorspikes_create:()=>l,leftwallspikes_create:()=>p,periodic_ceilingspikes_create:()=>m,periodic_floorspikes_create:()=>g,periodic_leftwallspikes_create:()=>v,periodic_rightwallspikes_create:()=>h,rightwallspikes_create:()=>f});var a=n(9931),o=n(4470),i=n(9386),r=n(2954),_=n(4163),s=n(3031),c=n(9880),d=n(5971),l=function(){return b(S,0,i.INFINITY_FLT)},u=function(){return b(k,2,i.INFINITY_FLT)},p=function(){return b(O,1,i.INFINITY_FLT)},f=function(){return b(R,3,i.INFINITY_FLT)},g=function(){return b(S,0,5)},m=function(){return b(k,2,5)},v=function(){return b(O,1,5)},h=function(){return b(R,3,5)},b=function(e,t,n){var a={},o=a;return a.init=y,a.release=E,a.update=I,a.render=x,o.collision=e,o.anim_id=t,o.cycle_length=n,a},y=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,s.actor_create)(),t.timer=0,t.hidden=!1,(0,s.actor_change_animation)(e.actor,(0,c.sprite_get_animation)("SD_SPIKES",t.anim_id))},E=function(e){(0,s.actor_destroy)(e.actor)},I=function(e,t,n,i,r,s){var c,l=e,u=(0,_.timer_get_delta)();if(l.timer+=u,l.timer>=.5*l.cycle_length&&(l.timer=0,l.hidden=!l.hidden,(0,a.sound_play)((0,o.soundfactory_get)(l.hidden?"spikes disappearing":"spikes appearing"))),e.obstacle=!l.hidden,e.actor.visible=!l.hidden,!l.hidden)for(c=0;c<n;c++){var p=t[c];if(p&&!p.dying&&!p.blinking&&!p.invincible&&l.collision(e,p)){var f=(0,o.soundfactory_get)("spikes hit");(0,a.sound_is_playing)(f)||(0,a.sound_play)(f),(0,d.player_hit)(p)}}},x=function(e,t){(0,s.actor_render)(e.actor,t)},w=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+(0,s.actor_image)(a).width,n[3]=n[1]+(0,s.actor_image)(a).height,(0,r.bounding_box)(n,t)},S=function(e,t){var n,a=[],o=e.actor;return a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y-5,a[2]=a[0]+(0,s.actor_image)(o).width-10,a[3]=a[1]+10,n=t.actor.position.y-t.actor.hot_spot.y+(0,s.actor_image)(t.actor).height,w(t,a)&&n<o.position.y-o.hot_spot.y+(0,s.actor_image)(o).height/2},k=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+(0,s.actor_image)(a).height-5,n[2]=n[0]+(0,s.actor_image)(a).width-10,n[3]=n[1]+10,w(t,n)},O=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+(0,s.actor_image)(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,s.actor_image)(a).height-10,w(t,n)},R=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,s.actor_image)(a).height-10,w(t,n)}},2918:(e,t,n)=>{n.r(t),n.d(t,{bbluespring_create:()=>N,blbluespring_create:()=>D,blredspring_create:()=>x,bluespring_create:()=>k,blyellowspring_create:()=>g,brbluespring_create:()=>L,bredspring_create:()=>I,brredspring_create:()=>E,bryellowspring_create:()=>p,byellowspring_create:()=>f,lbluespring_create:()=>T,lredspring_create:()=>w,lyellowspring_create:()=>m,rbluespring_create:()=>R,redspring_create:()=>h,rredspring_create:()=>y,ryellowspring_create:()=>u,tlbluespring_create:()=>P,tlredspring_create:()=>S,tlyellowspring_create:()=>v,trbluespring_create:()=>O,trredspring_create:()=>b,tryellowspring_create:()=>l,yellowspring_create:()=>d});var a=n(9386),o=n(9931),i=n(4470),r=n(9880),_=n(4163),s=n(2878),c=n(3031),d=function(){return M(F,"SD_YELLOWSPRING",(0,s.v2d_new)(0,-500))},l=function(){return M(V,"SD_TRYELLOWSPRING",(0,s.v2d_new)(400,-600))},u=function(){return M(V,"SD_RYELLOWSPRING",(0,s.v2d_new)(600,0))},p=function(){return M(V,"SD_BRYELLOWSPRING",(0,s.v2d_new)(400,600))},f=function(){return M(V,"SD_BYELLOWSPRING",(0,s.v2d_new)(0,500))},g=function(){return M(V,"SD_BLYELLOWSPRING",(0,s.v2d_new)(-400,600))},m=function(){return M(V,"SD_LYELLOWSPRING",(0,s.v2d_new)(-600,0))},v=function(){return M(V,"SD_TLYELLOWSPRING",(0,s.v2d_new)(-400,-600))},h=function(){return M(F,"SD_REDSPRING",(0,s.v2d_new)(0,-750))},b=function(){return M(V,"SD_TRREDSPRING",(0,s.v2d_new)(800,-1e3))},y=function(){return M(V,"SD_RREDSPRING",(0,s.v2d_new)(1200,0))},E=function(){return M(V,"SD_BRREDSPRING",(0,s.v2d_new)(800,1e3))},I=function(){return M(V,"SD_BREDSPRING",(0,s.v2d_new)(0,750))},x=function(){return M(V,"SD_BLREDSPRING",(0,s.v2d_new)(-800,1e3))},w=function(){return M(V,"SD_LREDSPRING",(0,s.v2d_new)(-1200,0))},S=function(){return M(V,"SD_TLREDSPRING",(0,s.v2d_new)(-800,-1e3))},k=function(){return M(F,"SD_BLUESPRING",(0,s.v2d_new)(0,-1500))},O=function(){return M(V,"SD_TRBLUESPRING",(0,s.v2d_new)(1800,-1500))},R=function(){return M(V,"SD_RBLUESPRING",(0,s.v2d_new)(2e3,0))},L=function(){return M(V,"SD_BRBLUESPRING",(0,s.v2d_new)(1800,1500))},N=function(){return M(V,"SD_BBLUESPRING",(0,s.v2d_new)(0,1500))},D=function(){return M(V,"SD_BLBLUESPRING",(0,s.v2d_new)(-1800,1500))},T=function(){return M(V,"SD_LBLUESPRING",(0,s.v2d_new)(-2e3,0))},P=function(){return M(V,"SD_TLBLUESPRING",(0,s.v2d_new)(-1800,-1500))},M=function(e,t,n){var a={};return a.init=B,a.release=C,a.update=A,a.render=j,a.on_bump=e,a.sprite_name=t,a.strength=n,a},B=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,c.actor_create)(),t.is_bumping=!1,t.bang_timer=0,(0,c.actor_change_animation)(e.actor,(0,r.sprite_get_animation)(t.sprite_name,0))},C=function(e){},A=function(e,t,n,a,o,i){var s,d=e,l=(0,_.timer_get_delta)();for(d.bang_timer+=l,s=0;s<n;s++){var u=t[s];u&&!u.dying&&(0,c.actor_pixelperfect_collision)(u.actor,e.actor)&&d.on_bump(e,u)}d.is_bumping&&(0,c.actor_animation_finished)(e.actor)&&((0,c.actor_change_animation)(e.actor,(0,r.sprite_get_animation)(d.sprite_name,0)),d.is_bumping=!1)},j=function(e,t){(0,c.actor_render)(e.actor,t)},F=function(e,t){t.actor.speed.y>=1&&!t.actor.carrying&&!t.actor.carried_by&&H(e,t)},V=function(e,t){H(e,t)},H=function(e,t){var n=e;e.is_bumping=!0,function(e,t){var n=(0,_.timer_get_delta)(),o=[],i=[];o[0]=t.x*e.actor.speed.x>=0,o[1]=t.y*e.actor.speed.y>=0,i[0]=t.x*e.actor.speed.x<=0&&Math.abs(t.x)>a.EPSILON,i[1]=t.y*e.actor.speed.y<=0&&Math.abs(t.y)>a.EPSILON,Math.abs(t.y)>a.EPSILON&&(e.spring=!0),e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1,(Math.abs(t.x)>Math.abs(e.actor.speed.x)&&o[0]||i[0])&&(e.actor.speed.x=t.x),(Math.abs(t.y)>Math.abs(e.actor.speed.y)&&o[1]||i[1])&&(e.actor.speed.y=t.y,e.actor.position.y+=e.actor.speed.y*n)}(t,e.strength),(0,c.actor_change_animation)(n.actor,(0,r.sprite_get_animation)(e.sprite_name,1)),e.strength.x>a.EPSILON?t.actor.mirror&=~a.IF_HFLIP:e.strength.x<-a.EPSILON&&(t.actor.mirror|=a.IF_HFLIP),e.bang_timer>.2&&((0,o.sound_play)((0,i.soundfactory_get)("spring")),e.bang_timer=0)}},4060:(e,t,n)=>{n.r(t),n.d(t,{switch_create:()=>u});var a=n(7813),o=n(3110),i=n(4286),r=n(2594),_=n(9931),s=n(9880),c=n(4470),d=n(2954),l=n(3031),u=function(){var e={};return e.init=p,e.release=f,e.update=g,e.render=m,e},p=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,l.actor_create)(),t.is_pressed=!1,t.partner=null,(0,l.actor_change_animation)(e.actor,(0,s.sprite_get_animation)("SD_SWITCH",0))},f=function(e){(0,l.actor_destroy)(e.actor)},g=function(e,t,n,a,o,_){var s,c,d=e,l={},u={};d.partner=null,s=(0,i.E)(e,o,r.wN,l),c=(0,i.E)(e,o,r.Gd,u),null!=s&&l.dist<u.dist&&(d.partner=s),null!=c&&u.dist<l.dist&&(d.partner=c),null==d.partner?v(e,s,t,n,h,b):d.partner==s?v(e,s,t,n,y,E):d.partner==c&&v(e,c,t,n,I,x)},m=function(e,t){(0,l.actor_render)(e.actor,t)},v=function(e,t,n,a,o,i){var r,d=!0,u=e,p=e.actor;for(r=0;r<a;r++){var f=n[r];w(e,f)&&(d=!1,u.is_pressed||(o(t,f),(0,_.sound_play)((0,c.soundfactory_get)("switch")),(0,l.actor_change_animation)(p,(0,s.sprite_get_animation)("SD_SWITCH",1)),u.is_pressed=!0))}d&&u.is_pressed&&(i(t),(0,l.actor_change_animation)(p,(0,s.sprite_get_animation)("SD_SWITCH",0)),u.is_pressed=!1)},h=function(e,t){},b=function(e){},y=function(e,t){(0,a.door_open)(e)},E=function(e){(0,a.door_close)(e)},I=function(e,t){(0,o.teleporter_activate)(e,t)},x=function(e){},w=function(e,t){if(!e)return!1;if(!t)return!1;var n=[],a=[];return n[0]=e.actor.position.x-e.actor.hot_spot.x,n[1]=e.actor.position.y-e.actor.hot_spot.y,n[2]=n[0]+(0,l.actor_image)(e.actor).width,n[3]=n[1]+(0,l.actor_image)(e.actor).height,a[0]=t.actor.position.x-t.actor.hot_spot.x+.3*(0,l.actor_image)(t.actor).width,a[1]=t.actor.position.y-t.actor.hot_spot.y+.5*(0,l.actor_image)(t.actor).height,a[2]=a[0]+.4*(0,l.actor_image)(t.actor).width,a[3]=a[1]+.5*(0,l.actor_image)(t.actor).height,!t.dying&&!t.climbing&&!t.flying&&(0,d.bounding_box)(n,a)}},3110:(e,t,n)=>{n.r(t),n.d(t,{teleporter_activate:()=>p,teleporter_create:()=>u});var a=n(9931),o=n(4470),i=n(7774),r=n(9880),_=n(4163),s=n(2878),c=n(3031),d=n(5971),l=n(4054),u=function(){var e={};return e.init=f,e.release=v,e.update=g,e.render=m,e},p=function(e,t){var n=e,r=e.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=t,(0,i.input_ignore)(t.actor.input),(0,l.level_set_camera_focus)(r),(0,a.sound_play)((0,o.soundfactory_get)("teleporter")))},f=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,c.actor_create)(),t.is_disabled=!1,t.is_active=!1,t.timer=0,(0,c.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_TELEPORTER",0))},g=function(e,t,n,a,o,d){var u,p=e,f=e.actor,g=(0,_.timer_get_delta)(),m=0;if(p.is_active){if(p.timer+=g,p.timer>=3){var v=p.who;for((0,i.input_restore)(v.actor.input),(0,l.level_set_camera_focus)(v.actor),u=0;u<n;u++){var b=t[u];if(b!=v){var y=(0,s.v2d_add)(f.position,(0,s.v2d_new)(40*m++-20,-30));h(b,y)}}p.is_active=!1,p.is_disabled=!0}(0,c.actor_change_animation)(f,(0,r.sprite_get_animation)("SD_TELEPORTER",1))}else(0,c.actor_change_animation)(f,(0,r.sprite_get_animation)("SD_TELEPORTER",0))},m=function(e,t){(0,c.actor_render)(e.actor,t)},v=function(e){(0,c.actor_destroy)(e.actor)},h=function(e,t){e&&(e.actor.position=t,e.actor.speed=(0,s.v2d_new)(0,0),e.actor.is_jumping=!1,e.flying=!1,e.climbing=!1,e.getting_hit=!1,e.spring=!1,e.actor.angle=0,e.disable_wall=d.PLAYER_WALL_NONE,e.entering_loop=!1,e.at_loopfloortop=!1,e.bring_to_back=!1)}},4286:(e,t,n)=>{n.d(t,{E:()=>i});var a=n(9386),o=n(2878),i=function(e,t,n,i){var r,_,s=a.INFINITY_FLT,c=null;for(r=t;r;r=r.next)r.data&&r.data.type==n&&(_=(0,o.v2d_subtract)(r.data.actor.position,e.actor.position),(0,o.v2d_magnitude)(_)<s&&(c=r.data,s=(0,o.v2d_magnitude)(_)));return i&&(i.dist=s),c}},5971:(e,t,n)=>{n.r(t),n.d(t,{PLAYER_INITIAL_LIVES:()=>b,PLAYER_JUMP_SENSITIVITY:()=>N,PLAYER_MAX_BLINK:()=>k,PLAYER_MAX_INVINCIBILITY:()=>O,PLAYER_MAX_INVSTAR:()=>y,PLAYER_MAX_SPEEDSHOES:()=>R,PLAYER_WALL_BOTTOM:()=>w,PLAYER_WALL_LEFT:()=>S,PLAYER_WALL_NONE:()=>E,PLAYER_WALL_RIGHT:()=>x,PLAYER_WALL_TOP:()=>I,PL_KNUCKLES:()=>P,PL_SONIC:()=>D,PL_TAILS:()=>T,SH_ACIDSHIELD:()=>F,SH_FIRESHIELD:()=>C,SH_NONE:()=>M,SH_SHIELD:()=>B,SH_THUNDERSHIELD:()=>A,SH_WATERSHIELD:()=>j,SH_WINDSHIELD:()=>V,TAILS_MAX_FLIGHT:()=>L,player_attacking:()=>J,player_bounce:()=>Q,player_create:()=>W,player_destroy:()=>G,player_get_lives:()=>Z,player_get_rings:()=>$,player_get_score:()=>ee,player_get_sprite_name:()=>te,player_hit:()=>q,player_kill:()=>z,player_platform_movement:()=>X,player_render:()=>K,player_set_lives:()=>ae,player_set_rings:()=>ne,player_set_score:()=>oe,player_update:()=>Y});var a,o,i=n(3031),r=n(8707),_=n(2594),s=n(9931),c=n(4470),d=n(7774),l=n(9880),u=n(7709),p=n(7898),f=n(4163),g=n(2878),m=n(9386),v=n(2954),h=n(4054),b=5,y=5,E=0,I=1,x=2,w=4,S=8,k=4,O=23,R=23,L=10,N=.88,D=0,T=1,P=2,M=0,B=1,C=2,A=3,j=4,F=5,V=6,H=0,U=0,W=function(e){var t,n={};switch((0,p.logfile_message)("player_create(%d)",e),e){case D:n.name="Surge";break;case T:n.name="Neon";break;case P:n.name="Charge";break;default:n.name="Unknown"}for(n.type=e,n.actor=(0,i.actor_create)(),n.disable_movement=!1,n.in_locked_area=!1,n.at_some_border=!1,n.attacking=J,n.bounce=Q,n.spin=n.spin_dash=n.braking=n.flying=n.climbing=n.landing=n.spring=!1,n.is_fire_jumping=!1,n.getting_hit=n.dying=n.dead=n.blinking=!1,n.on_moveable_platform=!1,n.lock_accel=0,n.flight_timer=n.blink_timer=n.death_timer=0,n.disable_jump_for=0,n.glasses=(0,i.actor_create)(),n.got_glasses=!0,n.shield=(0,i.actor_create)(),n.shield_type=M,n.invincible=!1,n.invtimer=0,n.invstar=[],t=0;t<y;t++)n.invstar[t]=(0,i.actor_create)(),n.invstar[t]=(0,i.actor_change_animation)(n.invstar[t],(0,l.sprite_get_animation)("SD_INVSTAR",0));switch(n.got_speedshoes=!1,n.speedshoes_timer=0,n.disable_wall=E,n.entering_loop=!1,n.at_loopfloortop=!1,n.bring_to_back=!1,n.type){case D:n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=(0,d.input_create_user)(),n.actor=(0,i.actor_change_animation)(n.actor,(0,l.sprite_get_animation)(ie(D),0));break;case T:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,d.input_create_user)(),n.actor=(0,i.actor_change_animation)(n.actor,(0,l.sprite_get_animation)(ie(T),0));break;case P:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,d.input_create_user)(),n.actor=(0,i.actor_change_animation)(n.actor,(0,l.sprite_get_animation)(ie(P),0))}return o=1,a=0,(0,p.logfile_message)("player_create() ok"),n},G=function(){},Y=function(e,t,n){var a=e.actor;return e.blinking&&(e.blink_timer+=(0,f.timer_get_delta)(),a.visible=(0,f.timer_get_ticks)()%250<125,e.blink_timer>=k&&(e.getting_hit=e.blinking=!1,a.visible=!0)),e.disable_movement?e.spin?e.actor=(0,i.actor_change_animation)(e.actor,(0,l.sprite_get_animation)(ie(e.type),3)):e.spring&&(e.actor=(0,i.actor_change_animation)(e.actor,(0,l.sprite_get_animation)(ie(e.type),13))):(0,i.actor_move)(a,X(e,t,n,(0,h.level_gravity)())),e},K=function(e,t){if(e){var n=e.actor;if(n){var a,o,r=n.hot_spot,_=n.position,s=(0,g.v2d_new)(0,0),c=(0,g.v2d_new)(0,0),d=[],u=n.angle;if(e.invincible){var p=(0,l.sprite_get_animation)("SD_INVSTAR",0).frame_count;for(e.invtimer+=(0,f.timer_get_delta)(),a=0;a<y;a++)d[a]=720*(0,f.timer_get_ticks)()*.001+(a+1)*(360/y),c.x=30*Math.cos(d[a]*m.PI/180),c.y=((0,f.timer_get_ticks)()+400*a)%2e3/40,c=(0,g.v2d_rotate)(c,u),e.invstar[a].position.x=n.position.x+c.x,e.invstar[a].position.y=n.position.y-c.y+5,(0,i.actor_change_animation_frame)(e.invstar[a],(0,v.random)(p))}for(e.got_glasses&&re(e),e.shield_type!=M&&se(e),e.type,a=0;a<y&&e.invincible;a++)d[a]%360>=180&&(0,i.actor_render)(e.invstar[a],t);for(o=n.angle,n.angle=n.is_jumping||e.spin?o:(0,v.old_school_angle)(o),(0,i.actor_render)(n,t),n.angle=o,e.got_glasses&&(0,i.actor_render)(e.glasses,t),e.shield_type!=M&&(0,i.actor_render)(e.shield,t),a=0;a<y&&e.invincible;a++)d[a]%360<180&&(0,i.actor_render)(e.invstar[a],t);switch(e.type){case D:break;case T:n.is_jumping&&n.animation==(0,l.sprite_get_animation)(ie(T),3)&&(n.position=(0,g.v2d_new)(_.x,_.y),n.angle=u,n.hot_spot=r,e.shield_type!=M&&(e.shield.angle=0,e.shield.hot_spot=s))}}}},X=function(e,t,n,a){var o,_,p,b,y,E,k,O,M,B,C,A,j,F,V,H,U,W,G,Y,K=e.actor,X=ie(e.type),q=(0,f.timer_get_delta)(),z=480,Q=0,J=1,$=K.maxspeed,Z=(0,g.v2d_new)(0,0),ee=!1,te=e.actor.animation==(0,l.sprite_get_animation)(X,1),ne=!1,ae=!1,oe=!1,re=null,_e=(0,i.actor_image)(K).width,se=(0,i.actor_image)(K).height,de=!(Math.abs(K.angle)<m.EPSILON||Math.abs(K.angle-m.PI/2)<m.EPSILON||Math.abs(K.angle-m.PI)<m.EPSILON||Math.abs(K.angle-3*m.PI/2)<m.EPSILON),le=-2,ue=0,pe=0,fe=0,ge=K.position;switch(e.type){case D:de?(ue=1,pe=.8,fe=.5):(ue=.7,pe=.5,fe=.4);break;case T:case P:de?(ue=1,pe=.7,fe=.25):(ue=.7,pe=.5,fe=.25)}if(j=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(0,-se*ue+le),-K.angle)),U=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(0,2),-K.angle)),G=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,-se*pe),-K.angle)),V=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,-se*pe),-K.angle)),Y=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,-se*ue+le),-K.angle)),F=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,-se*ue+le),-K.angle)),W=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,2),-K.angle)),H=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,2),-K.angle)),e.type==T&&K.carrying&&Math.abs(K.angle)<m.EPSILON){var me=(0,i.actor_image)(K.carrying).height,ve=K.speed.y>5?.7*me:0;W.y+=ve,H.y+=ve,U.y+=ve,G.y+=me*pe+(0,v.random)(me)-.5*me,V.y=G.y}(0,i.actor_corners_disable_detection)(e.disable_wall&S,e.disable_wall&x,e.disable_wall&w,e.disable_wall&I),(0,i.actor_corners_set_floor_priority)(!(e.disable_wall&w));var he=(0,i.actor_corners_ex)(K,2,j,F,V,H,U,W,G,Y,n,b,O,E,M,y,B,k,C);if(b=he.up,y=he.down,k=he.left,E=he.right,C=he.upleft,O=he.upright,B=he.downleft,M=he.downright,(0,i.actor_corners_restore_floor_priority)(),e.dying)return K.speed.x=0,K.speed.y=Math.min(z,K.speed.y+a*q),K.mirror=null,K.angle=0,K.visible=!0,e.blinking=!1,e.death_timer+=q,e.dead=e.death_timer>=2.5,K=(0,i.actor_change_animation)(K,(0,l.sprite_get_animation)(X,8)),(0,g.v2d_new)(0,K.speed.y*q+.5*a*q*q);if(e.dead)return(0,g.v2d_new)(0,0);var be=(0,i.actor_handle_clouds)(K,le,b,O,E,M,y,B,k,C);switch(b=be.up,O=be.upright,E=be.right,k=be.left,C=be.upleft,y=be.down,B=be.downleft,M=be.downright,e.type){case D:K.carry_offset=(0,g.v2d_new)(K.mirror&m.IF_HFLIP?7:-9,-40);break;case T:case P:K.carry_offset=(0,g.v2d_new)(K.mirror&m.IF_HFLIP?7:-7,-42)}if(null!=K.carried_by){var ye,Ee=null,Ie=0,xe=0,we=K.carried_by;for(ye=0;ye<t.length;ye++)if(t[ye]==e){xe=ye;break}for(ye=0;ye<t.length;ye++)if(t[ye].actor==we){Ee=t[ye],Ie=ye,e.disable_wall=Ee.disable_wall,e.entering_loop=Ee.entering_loop,e.at_loopfloortop=Ee.at_loopfloortop,e.bring_to_back=Ee.bring_to_back;break}if(Ee&&(Ee.type==T&&!Ee.flying||Ee.getting_hit||Ee.dying||Ee.dead))K.position=(0,g.v2d_new)(K.carried_by.position.x,K.carried_by.position.y),K.carried_by.carrying=null,K.carried_by=null;else{if(!(y&&0==y.brick_ref.angle&&parseInt(we.speed.y,10)>=5||e.getting_hit||e.dying||e.dead)){var Se=xe<Ie?(0,g.v2d_multiply)(we.speed,q):(0,g.v2d_new)(0,0);return K.speed=(0,g.v2d_new)(0,0),K.mirror=we.mirror,K.angle=0,(K=(0,i.actor_change_animation)(K,(0,l.sprite_get_animation)(X,25))).position=(0,g.v2d_subtract)((0,g.v2d_add)(we.position,Se),K.carry_offset),(0,g.v2d_new)(0,0)}K.position=(0,g.v2d_new)(K.carried_by.position.x,K.carried_by.position.y),K.carried_by.carrying=null,K.carried_by=null}}if(e.entering_loop=!1,e.got_speedshoes&&(e.speedshoes_timer>R?e.got_speedshoes=!1:($*=1.5,e.speedshoes_timer+=q)),ce(e)&&K.is_jumping&&(e.disable_wall&=~w),e.spring&&(y&&parseInt(K.speed.y,10)>=0||e.flying||e.climbing)&&(e.spring=!1),o=(E&&(0,d.input_button_down)(K.input,d.IB_RIGHT)||k&&(0,d.input_button_down)(K.input,d.IB_LEFT))&&y,e.on_moveable_platform=(0,g.v2d_magnitude)((0,h.level_brick_move_actor)(y,K))>m.EPSILON,(p=y&&(K.angle>0&&K.angle<m.PI/2&&K.speed.x>0||K.angle>3*m.PI/2&&K.angle<2*m.PI&&K.speed.x<0))&&(C||O)||Math.abs(K.angle)<m.EPSILON||Math.abs(K.angle-m.PI)<m.EPSILON){if(E&&E.brick_ref.angle%90==0&&(K.speed.x>m.EPSILON||V.x>E.x)&&(!p||p&&90!=E.brick_ref.angle)&&(K.speed.x=0,K.position.x=E.x+(ge.x-V.x),!K.is_jumping&&!e.flying&&!e.climbing&&Math.abs(K.speed.y)<m.EPSILON&&(re=(0,l.sprite_get_animation)(X,o?14:0)),p))return(0,g.v2d_new)(-5,0);if(k&&k.brick_ref.angle%90==0&&(K.speed.x<-m.EPSILON||G.x<k.x+k.brick_ref.image.width)&&(!p||p&&270!=k.brick_ref.angle)&&(K.speed.x=0,K.position.x=k.x+k.brick_ref.image.width+(ge.x-G.x),!K.is_jumping&&!e.flying&&!e.climbing&&Math.abs(K.speed.y)<m.EPSILON&&(re=(0,l.sprite_get_animation)(X,o?14:0)),p))return(0,g.v2d_new)(5,0);K.position.x<=K.hot_spot.x&&(e.spin=!1,ae=!0,K.position.x<K.hot_spot.x&&(K.speed.x=0,K.position.x=K.hot_spot.x,y&&(o=!0,re=(0,l.sprite_get_animation)(X,1)))),K.position.x>=(0,h.level_size)().x-((0,i.actor_image)(K).width-K.hot_spot.x)&&(e.spin=!1,ne=!0,K.position.x>(0,h.level_size)().x-((0,i.actor_image)(K).width-K.hot_spot.x)&&(K.speed.x=0,K.position.x=(0,h.level_size)().x-((0,i.actor_image)(K).width-K.hot_spot.x),y&&(o=!0,re=(0,l.sprite_get_animation)(X,1))))}if(!e.climbing){if(y){var ke,Oe,Re=y.brick_ref.angle;if(ee=!0,K.ignore_horizontal=!1,e.is_fire_jumping=!1,K.is_jumping=!1,y.brick_ref&&y.brick_ref.behavior==r.BRB_FALL&&y.state==r.BRS_IDLE&&(y.state=r.BRS_ACTIVE),Math.abs(K.speed.x)<m.EPSILON){if(Re%180==0&&(e.spin=!1),(0,d.input_button_down)(K.input,d.IB_DOWN))e.spin_dash||(re=(0,l.sprite_get_animation)(X,4)),(0,d.input_button_pressed)(K.input,d.IB_FIRE1)&&(re=(0,l.sprite_get_animation)(X,6),e.spin_dash=!0,(0,s.sound_play)((0,c.soundfactory_get)("charge")));else if(!o)if((0,d.input_button_down)(K.input,d.IB_UP))te&&e.at_some_border||(re=(0,l.sprite_get_animation)(X,5));else if(ce(e))re=(0,l.sprite_get_animation)(X,0);else{var Le=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-8,0),-K.angle)),Ne=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(5,0),-K.angle)),De=(0,g.v2d_new)(0,0),Te=(0,i.actor_corners_ex)(K,2,De,De,De,Ne,De,Le,De,De,n,null,null,null,void 0,null,void 0,null,null);Te.downleft&&Te.downright||e.on_moveable_platform?(0,d.input_button_down)(K.input,d.IB_LEFT)&&(ae||e.at_some_border)||(0,d.input_button_down)(K.input,d.IB_RIGHT)&&(ne||e.at_some_border)?(K.mirror=ae?m.IF_HFLIP:m.IF_NONE,re=(0,l.sprite_get_animation)(X,1)):re=(0,l.sprite_get_animation)(X,0):re=(0,l.sprite_get_animation)(X,10)}if(e.spin_dash){var Pe,Me,Be,Ce,Ae=K.mirror&m.IF_HFLIP?1:-1;for(Pe=0;Pe<3;Pe++)(0,v.random)(128),Ce=(0,u.image_create)(1,1),(0,u.image_clear)(Ce,255,255,255),Me=(0,g.v2d_new)(Ae*(7+(0,v.random)(7)),2),Be=(0,g.v2d_new)(Ae*(50+(0,v.random)(200)),-(0,v.random)(200)),(0,h.level_create_particle)(Ce,(0,g.v2d_add)(K.position,Me),Be,!0);((0,d.input_button_up)(K.input,d.IB_DOWN)||(0,h.level_editmode)())&&(e.spin=!0,e.spin_dash=!1,(!(K.mirror&m.IF_HFLIP)||k||ae)&&(K.mirror&m.IF_HFLIP||E||ne)||(K.speed.x=(K.mirror&m.IF_HFLIP?-1:1)*$*1.35),(0,s.sound_play)((0,c.soundfactory_get)("release")),e.disable_jump_for=.05)}}else if((0,d.input_button_down)(K.input,d.IB_DOWN)&&(e.spin||(0,s.sound_play)((0,c.soundfactory_get)("roll")),e.spin=!0),e.spin||e.braking){if(e.spin)re=(0,l.sprite_get_animation)(X,3);else if(e.braking){var je,Fe,Ve,He=K.mirror&m.IF_HFLIP?1:-1;(0,v.random)(128),Ve=(0,u.image_create)(1,1),je=(0,g.v2d_new)(He*(10-(0,v.random)(21)),0),Fe=(0,g.v2d_new)(He*(50+(0,v.random)(200)),-(0,v.random)(200)),(0,h.level_create_particle)(Ve,(0,g.v2d_add)(K.position,je),Fe,!0),re=(0,l.sprite_get_animation)(X,7),Math.abs(K.speed.x)<10&&(e.braking=!1)}}else{var Ue=.75*$,We=.35*$;Math.abs(K.speed.x)<Ue?!o&&K.speed.y>=0&&(re=(0,l.sprite_get_animation)(X,1),K=(0,i.actor_change_animation_speed_factor)(K,.5+Math.abs(K.speed.x)/Ue*1.5)):re=(0,l.sprite_get_animation)(X,2),Math.abs(K.speed.x)>=We&&((0,d.input_button_down)(K.input,d.IB_RIGHT)&&K.speed.x<0||(0,d.input_button_down)(K.input,d.IB_LEFT)&&K.speed.x>0)&&((0,s.sound_play)((0,c.soundfactory_get)("brake")),e.braking=!0)}if(e.disable_jump_for=Math.max(e.disable_jump_for-q,0),Math.abs(K.speed.x)<m.EPSILON&&(e.disable_jump_for=0),ke=!e.spin_dash,(0,d.input_button_down)(K.input,d.IB_FIRE1)&&e.disable_jump_for<=0&&!(0,d.input_button_down)(K.input,d.IB_DOWN)&&!b&&!e.landing&&ke&&!K.is_jumping&&((0,s.sound_play)((0,c.soundfactory_get)("jump")),K.angle=0,K.is_jumping=!0,e.is_fire_jumping=!0,oe=!0,e.spin=!1,re=(0,l.sprite_get_animation)(X,3),0==Re?K.speed.y=1*-K.jump_strength:Re>0&&Re<90?Re>45?(K.speed.x=Math.min(K.speed.x,-.7*K.jump_strength*1),K.speed.y=-.7*K.jump_strength*1):(K.speed.x*=K.speed.x>0?.5:1,K.speed.y=1*-K.jump_strength):90==Re?((0,i.actor_move)(K,(0,g.v2d_new)(-40,0)),K.speed.x=Math.min(K.speed.x,1*-K.jump_strength),K.speed.y=-K.jump_strength/2*1):Re>90&&Re<180?((0,i.actor_move)(K,(0,g.v2d_new)(0,40)),K.speed.x=Math.min(K.speed.x,-.7*K.jump_strength*1),K.speed.y=1*K.jump_strength):180==Re?((0,i.actor_move)(K,(0,g.v2d_new)(0,40)),K.speed.x*=-1,K.speed.y=1*K.jump_strength):Re>180&&Re<270?((0,i.actor_move)(K,(0,g.v2d_new)(0,40)),K.speed.x=Math.max(K.speed.x,.7*K.jump_strength*1),K.speed.y=1*K.jump_strength):270==Re?((0,i.actor_move)(K,(0,g.v2d_new)(40,0)),K.speed.x=Math.max(K.speed.x,1*K.jump_strength),K.speed.y=-K.jump_strength/2*1):Re>270&&Re<360&&(Re<315?(K.speed.x=Math.max(K.speed.x,.7*K.jump_strength*1),K.speed.y=-.7*K.jump_strength*1):(K.speed.x*=K.speed.x<0?.5:1,K.speed.y=1*-K.jump_strength))),!K.is_jumping){var Ge;Re>0&&Re<90?(Ge=.8*Math.min(1,Math.tan(Re*m.PI/180)),Math.abs(K.speed.y)>m.EPSILON?K.speed.x=ee&&Re<=45?K.speed.x:Math.max(-1.2*$,-1*Ge*K.speed.y):(Oe=(K.mirror&m.IF_HFLIP?2:1)*Ge,e.braking&&Re<45?Oe*=8*(K.speed.x<0?-.5:1):Math.abs(K.speed.x)<5&&(Oe*=25*Math.sin(Re*m.PI/180),e.lock_accel=2),K.speed.x=Math.max(K.speed.x-700*Oe*q,-1.2*$))):Re>270&&Re<360&&(Ge=.8*Math.min(1,-Math.tan(Re*m.PI/180)),Math.abs(K.speed.y)>m.EPSILON?K.speed.x=ee&&Re>=315?K.speed.x:Math.min(1.2*$,1*Ge*K.speed.y):(Oe=(K.mirror&m.IF_HFLIP?1:2)*Ge,e.braking&&Re>315?Oe*=8*(K.speed.x>0?-.5:1):Math.abs(K.speed.x)<5&&(Oe*=25*-Math.sin(Re*m.PI/180),e.lock_accel=1),K.speed.x=Math.min(K.speed.x+700*Oe*q,1.2*$)))}Re%90==0&&(e.lock_accel=0),B&&M&&Math.abs(K.speed.x)<40&&B.brick_ref.angle>270&&B.brick_ref.angle<360&&M.brick_ref.angle>0&&M.brick_ref.angle<90&&((0,d.input_button_down)(K.input,d.IB_LEFT)||(0,d.input_button_down)(K.input,d.IB_RIGHT)||(K.speed.x=0))}else e.braking=!1,e.lock_accel=0,e.spin_dash&&(e.spin_dash=!1,re=(0,l.sprite_get_animation)(X,1)),K.animation!=(0,l.sprite_get_animation)(X,0)&&K.animation!=(0,l.sprite_get_animation)(X,10)&&K.animation!=(0,l.sprite_get_animation)(X,5)||(re=(0,l.sprite_get_animation)(X,1)),(e.spring||te||K.speed.y<0)&&(e.spin=!1),ce(e)||(K.angle=0);if(y||e.is_fire_jumping&&K.speed.y<-K.jump_strength*N&&(0,d.input_button_up)(K.input,d.IB_FIRE1)&&(K.speed.y*=.7),e.type==T&&e.flying?(J=e.flight_timer<L?.15:.8,z*=.3):J=1,Z.y=Math.abs(K.speed.y)>m.EPSILON?K.speed.y*q+a*J*.5*(q*q):0,e.type==P&&e.flying||(K.speed.y=Math.min(K.speed.y+a*J*q,z)),_=b&&b.brick_ref.angle%90!=0&&Math.abs(K.angle)<m.EPSILON,b&&(b.brick_ref.angle%90==0||_)&&K.speed.y<-m.EPSILON&&(K.position.y=b.y+b.brick_ref.image.height+(ge.y-j.y),K.speed.y=10,b.brick_ref.behavior==r.BRB_CIRCULAR&&Math.sin(b.brick_ref.behavior_arg[3]*b.value[0])>0))return K.speed.y=100,(0,g.v2d_add)(Z,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(b,K),q));if((A=y)&&!K.is_jumping){var Ye=A.brick_ref.angle;if(K.speed.y=Z.y=0,K.angle=Ye*m.PI/180,0==Ye){var Ke=(0,h.level_brick_move_actor)(y,K);ge.y=A.y,Q=0,Ke.y>m.EPSILON?Z.y+=Ke.y*q:K.position.y=ge.y+le+1}else if(Ye>0&&Ye<90)ge.y=parseInt(A.y+A.brick_ref.image.height-(K.position.x-A.x)*Math.tan(K.angle),10),K.speed.x<0&&(ge.y+=2),K.position.y=ge.y+le,K.mirror&m.IF_HFLIP||(Q=.2);else if(90==Ye){if(Math.abs(K.speed.x)>5){var Xe=M?M.brick_ref.angle:-1;M&&Xe>=Ye&&Xe<Ye+90?e.flying||(K.position.x=A.x+le):(K.angle=0,K.is_jumping=!0,e.spin||e.flying||(re=(0,l.sprite_get_animation)(X,1)),ce(e)||(e.flying||(0,i.actor_move)(K,(0,g.v2d_new)(-13,0)),K.speed=(0,g.v2d_new)(0,-.9*Math.abs(K.speed.x))))}else K.angle=0,e.flying||(0,i.actor_move)(K,(0,g.v2d_new)(-10,0)),K.is_jumping=!0,K.ignore_horizontal=!1;K.mirror&m.IF_HFLIP||(Q=1.5)}else Ye>90&&Ye<180?(Math.abs(K.speed.x)>5?(ge.y=A.y-(K.position.x-A.x)*Math.tan(K.angle),K.position.y=ge.y-le):(K.angle=0,(0,i.actor_move)(K,(0,g.v2d_new)(0,30)),K.is_jumping=!0),Q=1.5):180==Ye?(Math.abs(K.speed.x)>5?(ge.y=A.y+A.brick_ref.image.height,K.position.y=ge.y-le,(K.speed.x>0&&!M||K.speed.x<0&&!B)&&((0,i.actor_move)(K,(0,g.v2d_new)(0,-30)),K.is_jumping=!0,K.speed.x*=-1,K.mirror=K.speed.x<0?m.IF_HFLIP:m.IF_NONE,K.angle=0)):(K.angle=0,(0,i.actor_move)(K,(0,g.v2d_new)(0,40)),K.is_jumping=!0,K.speed.x=0),Q=1.2):Ye>180&&Ye<270?(Math.abs(K.speed.x)>5?(ge.y=A.y+A.brick_ref.image.height-(K.position.x-A.x)*Math.tan(K.angle),K.position.y=ge.y-le):(K.angle=0,(0,i.actor_move)(K,(0,g.v2d_new)(0,30)),K.is_jumping=!0),Q=1.5):270==Ye?(Math.abs(K.speed.x)>5?(Xe=B?B.brick_ref.angle:-1,B&&Xe>Ye-90&&Xe<=Ye?e.flying||(K.position.x=A.x+A.brick_ref.image.width-le):(K.angle=0,K.is_jumping=!0,e.spin||e.flying||(re=(0,l.sprite_get_animation)(X,1)),ce(e)||(e.flying||(0,i.actor_move)(K,(0,g.v2d_new)(13,0)),K.speed=(0,g.v2d_new)(0,-.9*Math.abs(K.speed.x))))):(K.angle=0,e.flying||(0,i.actor_move)(K,(0,g.v2d_new)(10,0)),K.is_jumping=!0,K.ignore_horizontal=!1),K.mirror&m.IF_HFLIP&&(Q=1.5)):Ye>270&&Ye<360&&(ge.y=A.y-(K.position.x-A.x)*Math.tan(K.angle),K.speed.x>0&&(ge.y+=2),K.position.y=ge.y+le,K.mirror&m.IF_HFLIP&&(Q=.2))}if(Z.x=Math.abs(K.speed.x)>m.EPSILON?K.speed.x*q+(1-Q)*K.acceleration*.5*(q*q):0,!(0,d.input_button_down)(K.input,d.IB_LEFT)||(0,d.input_button_down)(K.input,d.IB_RIGHT)||e.spin||e.braking||e.landing||e.getting_hit||1==e.lock_accel||ae)if(!(0,d.input_button_down)(K.input,d.IB_RIGHT)||(0,d.input_button_down)(K.input,d.IB_LEFT)||e.spin||e.braking||e.landing||e.getting_hit||2==e.lock_accel||ne){if(y){var qe,ze=0,Qe=y.brick_ref.angle;qe=e.spin?.65:e.braking?4.5:e.landing?.6:1,Qe%90==0?ze=90==Qe?-1:270==Qe?1:K.speed.x>m.EPSILON?-1:-K.speed.x>m.EPSILON?1:0:(Qe>90&&Qe<180||Qe>180&&Qe<270)&&(ze=K.speed.x>m.EPSILON?-1:-K.speed.x>m.EPSILON?1:0),K.speed.x+=ze*qe*K.acceleration*q}}else K.ignore_horizontal||!(K.is_jumping||e.spring||te)&&(0,d.input_button_down)(K.input,d.IB_DOWN)||(K.mirror=!1,Q=K.speed.x<0?-1:Q,K.speed.x<=1.1*$&&(K.speed.x=Math.min(K.speed.x+(1-Q)*K.acceleration*q,$)));else K.ignore_horizontal||!(K.is_jumping||e.spring||te)&&(0,d.input_button_down)(K.input,d.IB_DOWN)||(K.mirror=m.IF_HFLIP,Q=K.speed.x>0?-1:Q,K.speed.x>=1.1*-$&&(K.speed.x=Math.max(K.speed.x-(1-Q)*K.acceleration*q,-$)))}switch(e.spring&&(re=(0,l.sprite_get_animation)(X,K.speed.y<=0?13:1),K.speed.y>0&&(e.spring=!1,K.is_jumping=!1)),e.getting_hit&&(y?e.getting_hit=!1:re=(0,l.sprite_get_animation)(X,11)),e.type){case D:break;case T:if(e.flight_timer+=q,y&&90!=y.brick_ref.angle&&270!=y.brick_ref.angle&&(e.flying=!1,e.flight_timer=0),(K.is_jumping&&K.speed.y>-K.jump_strength/3&&!oe&&!e.getting_hit||e.flying)&&(0,d.input_button_pressed)(K.input,d.IB_FIRE1)&&!e.getting_hit&&e.flight_timer<L&&(e.flying||(e.flight_timer=0),K.speed.y=.1*-(0,h.level_gravity)(),e.flying=!0,K.is_jumping=!1,e.is_fire_jumping=!1),e.flying)if(re=(0,l.sprite_get_animation)(X,K.carrying?16:20),K.speed.x=(0,v.clip)(K.speed.x,-K.maxspeed/2,K.maxspeed/2),e.flight_timer>=L){var Je=(0,c.soundfactory_get)("tired of flying");(0,s.sound_is_playing)(Je)||(0,s.sound_play)(Je),re=(0,l.sprite_get_animation)(X,19)}else{var $e,Ze;for(ce(e)&&(K.angle=0),$e=(0,c.soundfactory_get)("flying"),(0,s.sound_is_playing)($e)||(0,s.sound_play)($e),Ze=0;Ze<t.length&&null==K.carrying;Ze++)if(t[Ze]!=e&&parseInt(K.speed.y,10)<=0){var et=[t[Ze].actor.position.x+.3*(0,i.actor_image)(t[Ze].actor).width,t[Ze].actor.position.y,t[Ze].actor.position.x+.7*(0,i.actor_image)(t[Ze].actor).width,t[Ze].actor.position.y+.2*(0,i.actor_image)(t[Ze].actor).height],tt=[K.position.x+.3*(0,i.actor_image)(K).width,K.position.y+.7*(0,i.actor_image)(K).height,K.position.x+.7*(0,i.actor_image)(K).width,K.position.y+(0,i.actor_image)(K).height],nt=(0,v.bounding_box)(et,tt),at=!(null!=t[Ze].actor.carried_by||t[Ze].dying||t[Ze].dead||t[Ze].climbing||t[Ze].landing||t[Ze].getting_hit);nt&&at&&!y&&(K.carrying=t[Ze].actor,t[Ze].actor.carried_by=K,t[Ze].spin=t[Ze].spin_dash=t[Ze].braking=t[Ze].flying=t[Ze].spring=t[Ze].on_moveable_platform=!1,(0,s.sound_play)((0,c.soundfactory_get)("touch the wall")))}}else K.animation==(0,l.sprite_get_animation)(X,K.carrying?16:20)&&(re=(0,l.sprite_get_animation)(X,1));break;case P:if((K.is_jumping&&K.speed.y>-.7*K.jump_strength||e.flying)&&(0,d.input_button_pressed)(K.input,d.IB_FIRE1)&&!y&&!e.getting_hit&&(K.speed.y=50,e.flying=!0,K.is_jumping=!1,e.is_fire_jumping=!1,K.speed.x=K.mirror&m.IF_HFLIP?Math.min(-100,K.speed.x):Math.max(100,K.speed.x)),e.flying){var ot=(0,d.input_button_down)(K.input,d.IB_LEFT)&&K.speed.x>0||(0,d.input_button_down)(K.input,d.IB_RIGHT)&&K.speed.x<0,it=y&&Math.abs(y.brick_ref.angle*m.PI/180-0)<m.EPSILON;if(ot+=K.animation==(0,l.sprite_get_animation)(X,21)&&!(0,i.actor_animation_finished)(K),it||K.animation==(0,l.sprite_get_animation)(X,19)||e.landing||(K.mirror&m.IF_HFLIP?(re=(0,l.sprite_get_animation)(X,ot?21:20),K.speed.x=Math.max(K.speed.x-.5*K.acceleration*q,-$/2)):(re=(0,l.sprite_get_animation)(X,ot?21:20),K.speed.x=Math.min(K.speed.x+.5*K.acceleration*q,$/2))),it)e.landing=!0,K.is_jumping=!1,re=(0,l.sprite_get_animation)(X,19),K.speed.y=0,Z.y=0,e.climbing=!1;else if((0,d.input_button_up)(K.input,d.IB_FIRE1))e.flying=!1,re=(0,l.sprite_get_animation)(X,18);else{var rt,_t=[k,B,E,M,y];for(rt=0;rt<_t.length;rt++)(A=_t[rt])&&A.brick_ref.angle%90!=0&&(e.flying=!1,e.landing=!1)}it||b||(k&&k.brick_ref.angle%90==0||E&&E.brick_ref.angle%90==0)&&(e.climbing=!0,e.flying=!1,(0,s.sound_play)((0,c.soundfactory_get)("touch the ground")))}if(e.landing&&(Math.abs(K.speed.x)<m.EPSILON||!y)&&(e.flying=e.landing=!1),e.climbing){var st=(0,g.v2d_new)(0,0);if(K.speed.x=Z.x=0,k&&!E&&(K.mirror|=m.IF_HFLIP),E&&!k&&(K.mirror&=~m.IF_HFLIP),st=(0,g.v2d_add)(st,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(k,K),q)),((st=(0,g.v2d_add)(st,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(E,K),q))).y<=0&&!b||st.y>=0&&!y||!k&&E)&&(Z=(0,g.v2d_add)(Z,st)),k||E)if((0,d.input_button_pressed)(K.input,d.IB_FIRE1)){var ct=(0,l.sprite_get_animation)(X,17),dt=(0,l.sprite_get_animation)(X,22);K.animation!=ct&&K.animation!=dt||(e.climbing=!1,K.is_jumping=!0,e.is_fire_jumping=!0,K.speed.x=.7*(K.mirror&m.IF_HFLIP?1:-1)*K.jump_strength,K.speed.y=-.5*K.jump_strength,k&&!E&&(K.mirror&=~m.IF_HFLIP),!k&&E&&(K.mirror|=m.IF_HFLIP),re=(0,l.sprite_get_animation)(X,3),(0,s.sound_play)((0,c.soundfactory_get)("jump")))}else(0,d.input_button_down)(K.input,d.IB_UP)?b||(Z.y=.1*-$*q,re=(0,l.sprite_get_animation)(X,17)):(0,d.input_button_down)(K.input,d.IB_DOWN)?y?e.climbing=!1:(Z.y=.1*$*q,re=(0,l.sprite_get_animation)(X,17)):re=(0,l.sprite_get_animation)(X,22);else(A=K.mirror&m.IF_HFLIP?B:M)?(re=(0,l.sprite_get_animation)(X,23),K.ignore_horizontal=!0,Z=(0,g.v2d_add)(Z,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(A,K),q)),(0,i.actor_animation_finished)(K)&&(e.climbing=!1,K.ignore_horizontal=!1,K.speed=(0,g.v2d_new)((K.mirror&m.IF_HFLIP?-1:1)*$*.15,-(0,h.level_gravity)()/12.5),Z.x=5*(K.mirror&m.IF_HFLIP?-1:1))):(e.climbing=!1,K.is_jumping=!0,re=(0,l.sprite_get_animation)(X,3))}}return e.at_some_border=!1,re&&(K=(0,i.actor_change_animation)(K,re)),Math.abs(K.speed.x)<4&&(e.braking=!1,(!(0,d.input_button_down)(K.input,d.IB_RIGHT)&&!(0,d.input_button_down)(K.input,d.IB_LEFT)||(0,d.input_button_down)(K.input,d.IB_RIGHT)&&(0,d.input_button_down)(K.input,d.IB_LEFT)||e.spin||e.landing)&&(Z.x=0,K.speed.x=0)),Z.x+=(0,h.level_brick_move_actor)(y,K).x*q,Z.x=K.position.x<=K.hot_spot.x&&K.speed.x<0?0:Z.x,Z.x=K.position.x>=(0,h.level_size)().x-((0,i.actor_image)(K).width-K.hot_spot.x)&&K.speed.x>0?0:Z.x,Z},q=function(e){var t,n,o=e.actor,r=!1;if(!e.blinking&&!e.dying&&!e.invincible)if(_e(e),e.shield_type!=M)r=!0,e.shield_type=M,(0,s.sound_play)((0,c.soundfactory_get)("death"));else if(a>0){for(r=!0,n=0;n<Math.min($(),15);n++)(t=(0,h.level_create_item)(_.vJ,o.position)).is_moving=!0,t.actor.speed.x=t.actor.maxspeed*((0,v.random)(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+(0,v.random)(t.actor.jump_strength);ne(0),(0,s.sound_play)((0,c.soundfactory_get)("ringless"))}else z(e);r&&(e.getting_hit=!0,e.flying=e.landing=e.climbing=e.spring=!1,e.is_fire_jumping=!1,e.spin_dash=e.spin=!1,e.blinking=!0,e.blink_timer=0,o.speed.x=o.mirror&m.IF_HFLIP?200:-200,o.speed.y=-.75*o.jump_strength,(0,i.actor_move)(o,(0,g.v2d_new)(0,-5)))},z=function(e){e.dying||(_e(e),e.shield_type=M,e.invincible=!1,e.got_speedshoes=!1,e.dying=!0,e.death_timer=0,e.spring=!1,e.actor.speed.y=1.2*-e.actor.jump_strength,e.flying=e.climbing=e.landing=!1,e.is_fire_jumping=!1,e.spin=e.spin_dash=!1,e.blinking=!1,(0,s.sound_play)((0,c.soundfactory_get)("death")))},Q=function(e){(0,d.input_simulate_button_down)(e.actor.input,d.IB_FIRE1),e.spring=!1,e.actor.speed.y=-e.actor.jump_strength,e.actor.is_jumping=!0,e.is_fire_jumping=!1,e.flying=!1},J=function(e){var t=(0,l.sprite_get_animation)(ie(e.type),3);return e.spin||e.spin_dash||e.actor.animation==t||e.type==P&&(e.landing||e.flying)},$=function(){return a},Z=function(){return H},ee=function(){return U},te=function(e){return ie(e.type)},ne=function(e){a=(0,v.clip)(e,0,9999),e/100>=o&&(o+=1,ae(Z()+1),(0,h.level_override_music)((0,c.soundfactory_get)("1up")))},ae=function(e){H=e},oe=function(e){U=e},ie=function(e){switch(e){case D:return"SD_SONIC";case T:return"SD_TAILS";case P:return"SD_KNUCKLES";default:return"null"}},re=function(e){if(e&&e.actor){var t=0,n=e.actor.mirror&m.IF_HFLIP,a=!0,o=(0,v.old_school_angle)(e.actor.angle),r=(0,g.v2d_new)(0,0),_=(0,g.v2d_subtract)(e.actor.position,(0,g.v2d_rotate)((0,g.v2d_new)(0,e.actor.hot_spot.y),-o)),s=e.actor.animation;switch(e.type){case D:if(s==(0,l.sprite_get_animation)(ie(D),0))r=(0,g.v2d_new)(3,24),t=1;else if(s==(0,l.sprite_get_animation)(ie(D),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=2,r=(0,g.v2d_new)(5,23);break;case 1:t=2,r=(0,g.v2d_new)(4,25);break;case 2:t=1,r=(0,g.v2d_new)(7,25);break;case 3:case 4:t=1,r=(0,g.v2d_new)(5,23);break;case 5:t=1,r=(0,g.v2d_new)(4,24);break;case 6:t=2,r=(0,g.v2d_new)(6,24);break;case 7:t=2,r=(0,g.v2d_new)(6,23)}else if(s==(0,l.sprite_get_animation)(ie(D),2))t=1,r=(0,g.v2d_new)(8,26);else if(s==(0,l.sprite_get_animation)(ie(D),5))t=3,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,19):(0,g.v2d_new)(-1,21);else if(s==(0,l.sprite_get_animation)(ie(D),7))t=1,r=parseInt(e.actor.animation_frame,10)<2?(0,g.v2d_new)(8,26):(0,g.v2d_new)(10,28);else if(s==(0,l.sprite_get_animation)(ie(D),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(1,22);break;case 1:r=(0,g.v2d_new)(-1,23);break;case 2:r=(0,g.v2d_new)(1,23)}else s==(0,l.sprite_get_animation)(ie(D),11)?(t=3,r=(0,g.v2d_new)(-4,30)):s==(0,l.sprite_get_animation)(ie(D),12)?(t=3,r=(0,g.v2d_new)(1,19)):s==(0,l.sprite_get_animation)(ie(D),13)?(t=3,r=(0,g.v2d_new)(4,13)):s==(0,l.sprite_get_animation)(ie(D),14)?(t=1,r=(0,g.v2d_new)(12,31)):s==(0,l.sprite_get_animation)(ie(D),15)?(t=0,r=(0,g.v2d_new)(3,23)):s==(0,l.sprite_get_animation)(ie(D),25)?(t=0,r=(0,g.v2d_new)(3,22)):a=!1;break;case T:if(s==(0,l.sprite_get_animation)(ie(T),0))r=(0,g.v2d_new)(5,34),t=1;else if(s==(0,l.sprite_get_animation)(ie(T),1))switch(t=2,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(2,33);break;case 1:case 5:r=(0,g.v2d_new)(3,33);break;case 2:r=(0,g.v2d_new)(8,33);break;case 3:case 7:r=(0,g.v2d_new)(3,32);break;case 4:r=(0,g.v2d_new)(1,33);break;case 6:r=(0,g.v2d_new)(7,33)}else if(s==(0,l.sprite_get_animation)(ie(T),2))t=2,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(7,35):(0,g.v2d_new)(6,34);else if(s==(0,l.sprite_get_animation)(ie(T),4))t=1,r=(0,g.v2d_new)(9,44);else if(s==(0,l.sprite_get_animation)(ie(T),5))t=1,r=(0,g.v2d_new)(7,32);else if(s==(0,l.sprite_get_animation)(ie(T),7))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(2,33):(0,g.v2d_new)(4,33);else if(s==(0,l.sprite_get_animation)(ie(T),10))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(5,33);break;case 1:r=(0,g.v2d_new)(6,33)}else if(s==(0,l.sprite_get_animation)(ie(T),11))t=1,r=(0,g.v2d_new)(1,33);else if(s==(0,l.sprite_get_animation)(ie(T),12))t=1,r=(0,g.v2d_new)(6,28);else if(s==(0,l.sprite_get_animation)(ie(T),13))t=3,r=(0,g.v2d_new)(2,17);else if(s==(0,l.sprite_get_animation)(ie(T),14))t=1,r=(0,g.v2d_new)(9,35);else if(s==(0,l.sprite_get_animation)(ie(T),15))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:case 8:case 9:case 10:r=(0,g.v2d_new)(5,34);break;default:r=(0,g.v2d_new)(5,33)}else s==(0,l.sprite_get_animation)(ie(T),16)?(t=1,r=(0,g.v2d_new)(8,37)):s==(0,l.sprite_get_animation)(ie(T),19)?(t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(9,39):(0,g.v2d_new)(9,40)):s==(0,l.sprite_get_animation)(ie(T),20)?(t=1,r=(0,g.v2d_new)(8,39)):s==(0,l.sprite_get_animation)(ie(T),25)?(t=1,r=(0,g.v2d_new)(0,23)):a=!1;break;case P:if(s==(0,l.sprite_get_animation)(ie(P),0))t=1,r=(0,g.v2d_new)(1,24);else if(s==(0,l.sprite_get_animation)(ie(P),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,r=(0,g.v2d_new)(5,29);break;case 1:t=2,r=(0,g.v2d_new)(5,29);break;case 2:t=2,r=(0,g.v2d_new)(8,29);break;case 3:t=2,r=(0,g.v2d_new)(9,28);break;case 4:t=1,r=(0,g.v2d_new)(6,28);break;case 5:t=1,r=(0,g.v2d_new)(6,29);break;case 6:t=1,r=(0,g.v2d_new)(5,28);break;case 7:t=1,r=(0,g.v2d_new)(4,27)}else if(s==(0,l.sprite_get_animation)(ie(P),2))t=1,r=(0,g.v2d_new)(7,29);else if(s==(0,l.sprite_get_animation)(ie(P),4))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,31):(0,g.v2d_new)(0,40);else if(s==(0,l.sprite_get_animation)(ie(P),5))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,21):(0,g.v2d_new)(-1,21);else if(s==(0,l.sprite_get_animation)(ie(P),7))t=0,r=(0,g.v2d_new)(-2,27);else if(s==(0,l.sprite_get_animation)(ie(P),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(9,30);break;case 1:r=(0,g.v2d_new)(8,27)}else if(s==(0,l.sprite_get_animation)(ie(P),11))t=1,r=(0,g.v2d_new)(-3,27);else if(s==(0,l.sprite_get_animation)(ie(P),12))t=1,r=(0,g.v2d_new)(5,24);else if(s==(0,l.sprite_get_animation)(ie(P),13))t=3,r=(0,g.v2d_new)(-1,16);else if(s==(0,l.sprite_get_animation)(ie(P),14))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,r=(0,g.v2d_new)(5,29);break;case 1:t=2,r=(0,g.v2d_new)(5,29);break;case 2:t=2,r=(0,g.v2d_new)(8,29);break;case 3:t=2,r=(0,g.v2d_new)(9,28);break;case 4:t=1,r=(0,g.v2d_new)(6,28);break;case 5:t=1,r=(0,g.v2d_new)(6,29);break;case 6:t=1,r=(0,g.v2d_new)(5,28);break;case 7:t=1,r=(0,g.v2d_new)(4,27)}else if(s==(0,l.sprite_get_animation)(ie(P),15))t=0,r=(0,g.v2d_new)(1,23);else if(s==(0,l.sprite_get_animation)(ie(P),16))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(6,23);break;case 1:r=(0,g.v2d_new)(5,20);break;case 2:r=(0,g.v2d_new)(0,22)}else if(s==(0,l.sprite_get_animation)(ie(P),17))switch(t=3,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(-1,22);break;case 1:r=(0,g.v2d_new)(-2,20);break;case 2:r=(0,g.v2d_new)(0,21);break;case 3:r=(0,g.v2d_new)(-1,24);break;case 4:r=(0,g.v2d_new)(0,23);break;case 5:r=(0,g.v2d_new)(0,22)}else if(s==(0,l.sprite_get_animation)(ie(P),18))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(6,23):(0,g.v2d_new)(5,20);else if(s==(0,l.sprite_get_animation)(ie(P),19))t=1,r=(0,g.v2d_new)(8,44);else if(s==(0,l.sprite_get_animation)(ie(P),20))t=1,r=(0,g.v2d_new)(8,39);else if(s==(0,l.sprite_get_animation)(ie(P),21))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(-8,41);break;case 1:r=(0,g.v2d_new)(0,43);break;case 2:r=(0,g.v2d_new)(10,41)}else if(s==(0,l.sprite_get_animation)(ie(P),22))t=3,r=(0,g.v2d_new)(0,22);else if(s==(0,l.sprite_get_animation)(ie(P),23))switch(parseInt(e.actor.animation_frame,10)){case 0:t=3,r=(0,g.v2d_new)(7,17);break;case 1:t=3,r=(0,g.v2d_new)(11,15);break;case 2:t=0,r=(0,g.v2d_new)(12,13)}else s==(0,l.sprite_get_animation)(ie(P),25)?(t=0,r=(0,g.v2d_new)(0,23)):a=!1}return r.x*=n?-1:1,e.glasses=(0,i.actor_change_animation)(e.glasses,(0,l.sprite_get_animation)("SD_GLASSES",t)),e.glasses.position=(0,g.v2d_add)(_,(0,g.v2d_rotate)(r,-o)),e.glasses.angle=o,e.glasses.mirror=e.actor.mirror,e.glasses.visible=a&&e.actor.visible,e}},_e=function(e){},se=function(e){var t=e.shield,n=e.actor,a=(0,g.v2d_new)(0,0);switch(e.shield_type){case B:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_SHIELD",0));break;case C:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_FIRESHIELD",0));break;case A:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_THUNDERSHIELD",0));break;case j:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_WATERSHIELD",0));break;case F:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_ACIDSHIELD",0));break;case V:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,i.actor_change_animation)(t,(0,l.sprite_get_animation)("SD_WINDSHIELD",0))}},ce=function(e){return e.disable_wall!==E}},4054:(e,t,n)=>{n.r(t),n.d(t,{PLAYERS:()=>St,level_add_to_score:()=>zt,level_add_to_secret_bonus:()=>en,level_boss_battle:()=>an,level_brick_move_actor:()=>fn,level_call_dialogbox:()=>tn,level_clear:()=>Zt,level_create_animal:()=>gn,level_create_brick:()=>dn,level_create_enemy:()=>un,level_create_item:()=>ln,level_create_particle:()=>pn,level_editmode:()=>Kt,level_get_brick_id:()=>hn,level_get_brick_list:()=>vn,level_getfile:()=>Vt,level_gravity:()=>cn,level_hide_dialogbox:()=>nn,level_init:()=>Ut,level_kill_all_baddies:()=>on,level_lock_camera:()=>rn,level_override_music:()=>Jt,level_player:()=>Xt,level_player_id:()=>qt,level_release:()=>Yt,level_render:()=>Gt,level_render_entities:()=>mn,level_restore_music:()=>sn,level_save:()=>Ht,level_set_camera_focus:()=>qn,level_set_spawn_point:()=>$t,level_setfile:()=>Ft,level_size:()=>Qt,level_spawn_players:()=>bn,level_unlock_camera:()=>_n,level_update:()=>Wt});var a,o,i,r,_,s,c,d,l,u,p,f,g,m,v,h,b,y,E,I,x,w,S,k,O,R,L,N,D,T,P,M,B,C,A,j,F,V,H,U,W,G,Y,K,X,q,z,Q,J,$,Z,ee,te,ne,ae,oe,ie,re,_e,se,ce,de,le,ue=n(5858),pe=n(9931),fe=n(4470),ge=n(9386),me=n(7709),ve=n(7774),he=n(7898),be=n(9880),ye=n(4163),Ee=n(2954),Ie=n(2878),xe=n(642),we=n(3031),Se=n(8707),ke=n(2985),Oe=n(6378),Re=n(5176),Le=n(2594),Ne=[],De=function(){return a},Te=function(e){return a>0?(e=(0,Ee.clip)(e,0,a-1),Ne[e]):null},Pe=function e(t){return null!=t&&(t.next=e(t.next),t=null,t=null),t},Me=!1,Be=[ve.KEY_UP,ve.KEY_DOWN,ve.KEY_RIGHT,ve.KEY_LEFT,ve.KEY_N,ve.KEY_B,ve.KEY_LCONTROL,ve.KEY_F12],Ce=[ve.KEY_W,ve.KEY_S,ve.KEY_D,ve.KEY_A,ve.KEY_Z,ve.KEY_Y,ve.KEY_G,ve.KEY_P],Ae={},je={},Fe=0,Ve=0,He=[Le.vJ,Le.oM,Le.e0,Le.eM,Le.Or,Le.Dk,Le.vP,Le.ZG,Le.o9,Le.Xb,Le.M7,Le.cV,Le.vo,Le.Mo,Le.tk,Le._q,Le.H7,Le.rm,Le.k_,Le.Rt,Le.uW,Le.uV,Le.VJ,Le.mw,Le.mH,Le.jQ,Le.at,Le.ko,Le.uN,Le.PC,Le.pQ,Le.Vu,Le.bw,Le.b0,Le.OQ,Le.d8,Le.vc,Le.ty,Le.zm,Le.EO,Le.Wm,Le.jy,Le.Nx,Le.wN,Le.Gd,Le.xe,Le.Vj,Le.xW,Le.pp,Le.qh,Le.Zy,Le.be,Le.Bh,Le.jw,Le.nN,Le.Bs,Le.X,Le.$q,Le.Zf,Le.lL,Le.C8,Le.EQ,Le.fm,Le.Qs,Le.so,Le.DM,Le.f7,Le.S0,Le.tG,Le.iR,Le.mb,Le.Bq,-1],Ue=0,We=function(){return Me},Ge=function(){console.log("SAVE");var e=Vt();Ht(e),(0,pe.sound_play)((0,fe.soundfactory_get)("level saved"))},Ye=function(){var e,t=(0,ye.timer_get_delta)();e=(0,ve.input_button_down)(s,ve.IB_FIRE3)?3750:750,((0,ve.input_button_down)(s,ve.IB_UP)||(0,ve.input_button_down)(c,ve.IB_UP))&&(Ae.y-=e*t),((0,ve.input_button_down)(s,ve.IB_DOWN)||(0,ve.input_button_down)(c,ve.IB_DOWN))&&(Ae.y+=e*t),((0,ve.input_button_down)(s,ve.IB_LEFT)||(0,ve.input_button_down)(c,ve.IB_LEFT))&&(Ae.x-=e*t),((0,ve.input_button_down)(s,ve.IB_RIGHT)||(0,ve.input_button_down)(c,ve.IB_RIGHT))&&(Ae.x+=e*t),Ae.x=parseInt(Math.max(Ae.x,xe.VIDEO_SCREEN_W/2),10),Ae.y=parseInt(Math.max(Ae.y,xe.VIDEO_SCREEN_H/2),10),(0,ke.kX)(Ae)},Ke=function(e){switch(e){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},Xe=function(e,t){var n;switch(e){case 1:n=(0,Se.brick_get)(t);break;case 2:n=(0,Le._y)(t),(0,Le.tl)(n)}return""},qe=function e(){Fe=0,Ve=0,4==(d=1==d?2:2==d?3:3==d?4:4==d?1:d)&&0==De()&&e()},ze=function e(){Fe=0,Ve=0,4==(d=2==d?1:3==d?2:4==d?3:1==d?4:d)&&0==De()&&e()},Qe=function e(){var t;switch(d){case 1:t=(0,Se.brick_size)(),Fe=(Fe+1)%t,null==(0,Se.brick_get)(Fe)&&e();break;case 2:Fe=He[Ve=(Ve+1)%(t=p)];break;case 3:Fe=(Fe+1)%(t=g);break;case 4:t=De(),Fe=(Fe+1)%t}},Je=function e(){var t;switch(d){case 1:t=(0,Se.brick_size)(),Fe=(Fe-1+t)%t,null==(0,Se.brick_get)(Fe)&&e();break;case 2:Fe=He[Ve=(Ve-1+(t=p))%t];break;case 3:Fe=(Fe-1+(t=g))%t;break;case 4:t=De(),Fe=(Fe-1+t)%t}},$e=function(e){var t;for(t=0;t<p;t++)if(e==He[t])return t;return-1},Ze=function e(t,n,a){var o=null,i=(0,Ie.v2d_new)(0,0);switch(t){case 1:null!=(0,Se.brick_get)(n)&&(o=(0,Se.brick_get)(n).image);break;case 2:var r=(0,Le._y)(n);null!=r&&(o=(0,we.actor_image)(r.actor),(i=r.actor.hot_spot).y-=2,(0,Le.tl)(r));break;case 3:var _=(0,Oe.enemy_create)(tt(n));null!=_&&(o=(0,we.actor_image)(_.actor),(i=_.actor.hot_spot).y-=2,(0,Oe.enemy_destroy)(_));break;case 4:var s;for(s=Te(n);s;s=s.next)e(EDITORGRP_ENTITY_TO_EDT(s.entity.type),s.entity.id,(0,Ie.v2d_add)(a,s.entity.position))}null!=o&&(0,me.image_blit)(o.data,(0,xe.video_get_backbuffer)(),o.sx,o.sy,parseInt(a.x-i.x,10),parseInt(a.y-i.y,10),o.swidth,o.sheight)},et=function(e){var t;for(t=0;t<g;t++)if(e==f[t])return t;return-1},tt=function(e){return null},nt=function(){Ue=!1},at=function(){},ot=function(){(0,ve.input_button_pressed)(c,ve.IB_FIRE3)&&(Ue=!Ue)},it=function(e){var t=(0,Ie.v2d_subtract)(Ae,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2)),n=parseInt(t.x%1,10),a=parseInt(t.y%1,10),o=-n+1*parseInt(e.x/1,10),i=-a+1*parseInt(e.y/1,10);return(0,Ie.v2d_add)(t,(0,Ie.v2d_new)(o,i))},rt=function(e,t,n,a){var o={};return o.type=e?1:2,o.obj_type=t,o.obj_id=n,o.obj_position=a,o},_t=function(e,t,n){var a={};return a.type=e?3:4,a.obj_position=t,a.obj_old_position=n,a},st=function(){v=dt(v),m=null,h=null},ct=function e(t){console.log("REGISTER",t);var n,a=!1;if(4!=t.obj_type){var o,i,r;for((r={}).action=t,r.in_group=a,r.in_group&&(r.group_key=n),null!=(o=h)&&(o.next=dt(o.next)),i=m;null!=i.next;)i=i.next;i.next=r,r.prev=i,r.next=null,h=r}else{var _,s=48879;for(a=!0,n=s++,_=Te(t.obj_id);_;_=_.next){var c=_.entity,d=EDITORGRP_ENTITY_TO_EDT(c.type);e(rt(!0,d,c.id,(0,Ie.v2d_add)(c.position,t.obj_position)))}a=!1}},dt=function(e){var t,n;for(t=e;null!=t;)n=t.next,t=null,t=n;return null},lt=function e(){var t,n;h!=v&&(t=h,h=h.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&e(),(n=t.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,pt(n))},ut=function e(){var t,n;null!=h.next&&((t=h=h.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&e(),n=t.action,pt(n))},pt=function e(t){if(console.log("COMMIT",t),1==t.type)switch(t.obj_type){case 1:dn(t.obj_id,t.obj_position);break;case 2:ln(t.obj_id,t.obj_position);break;case 3:un(tt(t.obj_id),t.obj_position);break;case 4:var n;for(n=Te(t.obj_id);n;n=n.next){var a=n.entity,o=EDITORGRP_ENTITY_TO_EDT(a.type);e(rt(!0,o,a.id,(0,Ie.v2d_add)(a.position,t.obj_position)))}}else if(2==t.type)switch(t.obj_type){case 1:var i,r=(0,Se.brick_get)(t.obj_id);for(i=b;i;i=i.next)i.data.brick_ref==r&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)((0,Ie.v2d_new)(i.data.x,i.data.y),t.obj_position))<ge.EPSILON&&(i.data.state=Se.BRS_DEAD);break;case 2:var _,s=t.obj_id;for(_=item_list;_;_=_.next)_.data.type==s&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)(_.data.actor.position,t.obj_position))<ge.EPSILON&&(_.data.state=IS_DEAD);break;case 3:var c,d=t.obj_id;for(c=enemy_list;c;c=c.next)et(c.data.name)==d&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)(c.data.actor.position,t.obj_position))<ge.EPSILON&&(c.data.state=ES_DEAD)}else 3==t.type?($t(t.obj_position),bn()):4==t.type&&($t(t.obj_old_position),bn())},ft=n(6038),gt=n(3450),mt=n(2667),vt=n(532),ht=n(3339),bt=function(e,t){It(e,t,!0),(0,we.actor_render)(e.actor,t),It(e,t,!1)},yt=function(e){return 1==e.state},Et=function(e,t){var n;for(n=0;n<t.length&&1!=e.state;n++)if(t[n]&&(0,we.actor_pixelperfect_collision)(e.actor,t[n].actor))return!(!t[n].attacking(t[n])&&!t[n].invincible&&(t[n].hit(t[n]),1));return!1},It=function(e,t,n){var a=e.actor,o=.001*(0,ye.timer_get_ticks)();if(3===e.type){var i,r=(0,Ie.v2d_new)(0,0);if((0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_INVSTAR",0),1),1!=e.state)for(i=0;i<5;i++)r.x=a.position.x+20*Math.cos(2*ge.PI*o+2*i*ge.PI/5),r.y=a.position.y+20*Math.sin(ge.PI*o+2*i*ge.PI/5)}},xt=n(5971),wt=n(7307),St=[0,1,2],kt=xe.VIDEO_SCREEN_W,Ot="data/levels/blue_ocean_1.json",Rt=null,Lt=[],Nt=[],Dt=[],Tt=[],Pt={position:{x:0,y:0}},Mt=[],Bt=[],Ct=[],At=[],jt=[],Ft=function(e){Ot=e,(0,he.logfile_message)("level_setfile('%s')",e)},Vt=function(){return Ot},Ht=function(e){var t,n,a,o,i,r={name:y,act:S,theme:I,bgtheme:x,grouptheme:w,spawn_point:N,music:E,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};Qn()&&(r.boss={id:F.type,x:F.actor.spawn_point.x,y:F.actor.spawn_point.y,rx:F.rect_x,ry:F.rect_y,rw:F.rect_w,rh:F.rect_h});var _=[];for(a=Rt;a;a=a.next)_.push({id:En(a.data),xpos:a.data.sx,ypos:a.data.sy});r.bricklist=_;var s=[];for(o=Lt;o;o=o.next)o.data&&s.push({id:o.data.type,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.itemlist=s;var c=[];for(i=Nt;i;i=i.next)i.data&&i.data.created_from_editor&&c.push({id:i.data.name,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y});r.enemylist=c;var d=[];for(t=0,n=jt.length;t<n;t++)d.push({xpos:jt[t].rect_x,ypos:jt[t].rect_y,width:jt[t].rect_w,height:jt[t].rect_h,title:jt[t].title,message:jt[t].message});r.dialogbox=d;var l=e.split("/");l=l[l.length-1],console.log("saveFile",e,r),(0,he.logfile_message)("level_save() ok")},Ut=function(){var e;kt=xe.VIDEO_SCREEN_W,(0,he.logfile_message)("level_init()"),Rt=null,Lt=[],Tt=[],k=800,O=R=0,L=0,le=0,T=null,Y=!1,M=!1,B="",K=X=q=0,Bt=$=Z=0,z=Q=!1,J=!1,C=null,Rn(),(0,he.logfile_message)("editor_init()"),b=vn(),Me=!1,p=He.length,d=1,Fe=0,o=(0,xe.video_get_resolution)(),i=(0,xe.video_is_smooth)(),f=(0,Oe.enemy_get_list_of_names)(g),r=(0,me.image_load)("data/images/editorbg.png"),s=(0,ve.input_create_keyboard)(Be),c=(0,ve.input_create_keyboard)(Ce),_=(0,ve.input_create_mouse)(),l=(0,Re.font_create)(8),u=(0,Re.font_create)(8),function(){var e;for(a=0,e=0;e<501;e++)Ne[e]=null}(),nt(),(0,he.logfile_message)("editor_init() ok"),Jn(Ot).then((function(){for((0,he.logfile_message)("Creating players..."),e=0;e<St.length;e++){var t=(0,xt.player_create)(St[e]);t.hit=xt.player_hit,t.kill=xt.player_kill,t.set_rings=xt.player_set_rings,t.get_rings=xt.player_get_rings,t.got_glasses=!1,Tt.push(t)}for(Bn(),A=Tt[j=0],(0,ke.qO)(),(0,ke.kX)(A.actor.position),qn(A.actor),(0,xt.player_set_rings)(0),V=!1,H=!1,(0,he.logfile_message)("Loading hud..."),(U=(0,we.actor_create)()).position=(0,Ie.v2d_new)(16,7),U=(0,we.actor_change_animation)(U,(0,be.sprite_get_animation)("SD_MAINGUI",0)),(W=(0,we.actor_create)()).position=(0,Ie.v2d_new)(16,xe.VIDEO_SCREEN_H-23),W=(0,we.actor_change_animation)(W,(0,be.sprite_get_animation)("SD_LIFEGUI",0)),(G=(0,Re.font_create)(0)).position=(0,Ie.v2d_add)(W.position,(0,Ie.v2d_new)(32,11)),e=0;e<3;e++)Mt[e]=(0,Re.font_create)(2),Mt[e].position=(0,Ie.v2d_add)(U.position,(0,Ie.v2d_new)(42,16*e+2));for((ae=(0,we.actor_create)()).position=(0,Ie.v2d_new)(0,-240),ae=(0,we.actor_change_animation)(ae,(0,be.sprite_get_animation)("SD_LEVELOP",0)),(oe=(0,we.actor_create)()).position=(0,Ie.v2d_new)(260,250),oe=(0,we.actor_change_animation)(oe,(0,be.sprite_get_animation)("SD_LEVELACT",S-1)),(ie=(0,Re.font_create)(3)).position=(0,Ie.v2d_new)(330,50),(0,Re.font_set_text)(ie,"%s",y.toUpperCase()),(0,Re.font_set_width)(ie,180),ee=(0,Re.font_create)(4),te=(0,Re.font_create)(7),ne=(0,we.actor_create)(),e=0;e<3;e++)Ct[e]=(0,Re.font_create)(2),At[e]=(0,we.actor_create)();re=!1,_e=0,(se=(0,we.actor_create)()).position.y=xe.VIDEO_SCREEN_H,se=(0,we.actor_change_animation)(se,(0,be.sprite_get_animation)("SD_DIALOGBOX",0)),ce=(0,Re.font_create)(8),de=(0,Re.font_create)(8)}))},Wt=function(){var e,t;L+=(0,ye.timer_get_delta)();var n,a,r,p,f,g,y,E=!1,I=!1,x=!1,w=(0,ye.timer_get_delta)();if(Yn(),Wn(),Gn(),We())!function(){b||(b=vn());var e,t,n,a,r,p=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ARROW",0),0),f=(0,Re.font_get_charsize)(l).x,g=(0,Re.font_get_charsize)(l).y,m=(0,Ie.v2d_subtract)(Ae,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2));if((0,ve.input_button_down)(s,ve.IB_FIRE3)&&(0,ve.input_button_pressed)(s,ve.IB_FIRE4)&&Ge(),(0,ve.input_button_down)(s,ve.IB_FIRE4))return(0,he.logfile_message)("editor_disable()"),st(),Me=!1,(0,xe.video_changemode)(o,i,(0,xe.video_is_fullscreen)()),void(0,he.logfile_message)("editor_disable() ok");if((0,ve.input_button_down)(s,ve.IB_FIRE3)?(((0,ve.input_button_pressed)(s,ve.IB_FIRE1)||(0,ve.input_button_pressed)(_,ve.IB_DOWN))&&qe(),((0,ve.input_button_pressed)(s,ve.IB_FIRE2)||(0,ve.input_button_pressed)(_,ve.IB_UP))&&ze()):(((0,ve.input_button_pressed)(s,ve.IB_FIRE1)||(0,ve.input_button_pressed)(_,ve.IB_DOWN))&&Qe(),((0,ve.input_button_pressed)(s,ve.IB_FIRE2)||(0,ve.input_button_pressed)(_,ve.IB_UP))&&Je()),je.x=(0,Ee.clip)((0,ve.input_get_xy)(_).x,0,xe.VIDEO_SCREEN_W-p.width),je.y=(0,Ee.clip)((0,ve.input_get_xy)(_).y,0,xe.VIDEO_SCREEN_H-p.height),(0,ve.input_button_pressed)(_,ve.IB_FIRE1)&&(0,ve.input_button_down)(s,ve.IB_FIRE3)){var v=it(je),h=_t(!0,v,spawn_point);pt(h),ct(h)}if((0,ve.input_button_pressed)(_,ve.IB_FIRE1)&&!(0,ve.input_button_down)(s,ve.IB_FIRE3)){var y=rt(!0,d,Fe,it(je));pt(y),ct(y)}if(e=(0,ve.input_button_pressed)(_,ve.IB_FIRE3),t=(0,ve.input_button_pressed)(_,ve.IB_FIRE2),e||t)switch(console.log(e,t,d,1),d){case 1:for(n=b;n;n=n.next){var E=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],I=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1];if((0,Ee.bounding_box)(E,I)){if(!e){var x=rt(!1,1,hn(n.data),(0,Ie.v2d_new)(n.data.x,n.data.y));pt(x),ct(x);break}Fe=hn(n.data)}}break;case 2:for(a=item_list;a;a=a.next){var w=[a.data.actor.position.x-a.data.actor.hot_spot.x,a.data.actor.position.y-a.data.actor.hot_spot.y,a.data.actor.position.x-a.data.actor.hot_spot.x+(0,we.actor_image)(a.data.actor).width,a.data.actor.position.y-a.data.actor.hot_spot.y+(0,we.actor_image)(a.data.actor).height],S=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1];if((0,Ee.bounding_box)(w,S)){if(!e){var k=rt(!1,2,a.data.type,a.data.actor.position);pt(k),ct(k);break}var O=$e(a.data.type);O>=0&&(Ve=O,Fe=He[O])}}break;case 3:for(r=enemy_list;r;r=r.next){var R=[r.data.actor.position.x-r.data.actor.hot_spot.x,r.data.actor.position.y-r.data.actor.hot_spot.y,r.data.actor.position.x-r.data.actor.hot_spot.x+(0,we.actor_image)(r.data.actor).width,r.data.actor.position.y-r.data.actor.hot_spot.y+(0,we.actor_image)(r.data.actor).height],L=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1],N=et(r.data.name);if(N>=0&&(0,Ee.bounding_box)(R,L)){if(!e){var D=rt(!1,3,N,r.data.actor.position);pt(D),ct(D);break}Fe=N}}}(0,ve.input_button_down)(s,ve.IB_FIRE3)&&((0,ve.input_button_pressed)(c,ve.IB_FIRE1)?lt():(0,ve.input_button_pressed)(c,ve.IB_FIRE2)&&ut()),ot(),Ye(),(0,Re.font_set_text)(l,"%d,%d",parseInt(it(je).x,10),parseInt(it(je).y,10)),l.position.x=(0,Ee.clip)(parseInt(je.x,10),10,xe.VIDEO_SCREEN_W-f*(0,Re.font_get_text)(l).length-10),l.position.y=(0,Ee.clip)(parseInt(je.y-3*g,10),10,xe.VIDEO_SCREEN_H-10),u.position=(0,Ie.v2d_new)(10,10),3!=d?(0,Re.font_set_text)(u,"<color=ffff00>%s %d</color>\n%s",Ke(d),Fe,Xe(d,Fe)):(0,Re.font_set_text)(u,'<color=ffff00>%s "%s"</color>\n%s',Ke(d),tt(Fe),Xe(d,Fe))}();else{for(x=L<5,e=0;e<Tt.length&&!x;e++)Tt[e]&&(x=Tt[e].dead);if(A&&A.actor&&(0,ve.input_button_pressed)(A.actor.input,ve.IB_FIRE4)&&!x){console.log("QUIT");var S=[];return D.pause(),S[0]=(0,ft.lang_getstring)("CBOX_QUIT_QUESTION"),S[1]=(0,ft.lang_getstring)("CBOX_QUIT_OPTION1"),S[2]=(0,ft.lang_getstring)("CBOX_QUIT_OPTION2"),(0,ue.confirmbox_alert)(S[0],S[1],S[2]),void(0,mt.scenestack_push)((0,vt.storyboard_get_scene)(vt.SCENE_CONFIRMBOX))}if(1==(t=(0,ue.confirmbox_selected_option)())?M=!0:2==t&&(0,pe.music_play)(D,!0),M)return(0,xe.video_fadefx_over)()?((0,mt.scenestack_pop)(),void(0,wt.quest_abort)()):void(0,xe.video_fadefx_out)((0,me.image_rgb)(0,0,0),1);if((0,ve.input_button_pressed)(s,ve.IB_FIRE5))return(0,he.logfile_message)("editor_enable()"),(v={}).in_group=!1,v.prev=null,v.next=null,m=v,h=v,Me=!0,Ae.x=parseInt((0,ke.gY)().x,10),Ae.y=parseInt((0,ke.gY)().y,10),je=(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2),o=(0,xe.video_get_resolution)(),i=(0,xe.video_is_smooth)(),(0,xe.video_changemode)(xe.VIDEORESOLUTION_EDT,!1,(0,xe.video_is_fullscreen)()),void(0,he.logfile_message)("editor_enable() ok");for(I=L<5,e=0;e<Tt.length&&!I;e++)I=Tt[e].dying||Tt[e].dead;if(A&&(0,ve.input_button_pressed)(A.actor.input,ve.IB_FIRE3)&&!I)return A.spin_dash=A.braking=!1,(0,pe.music_pause)(),void(0,mt.scenestack_push)((0,vt.storyboard_get_scene)(vt.SCENE_PAUSE));U=(0,we.actor_change_animation)(U,(0,be.sprite_get_animation)("SD_MAINGUI",(0,xt.player_get_rings)()>0?0:1)),W=(0,we.actor_change_animation)(W,(0,be.sprite_get_animation)("SD_LIFEGUI",j)),G=(0,Re.font_set_text)(G,"%d",(0,xt.player_get_lives)()),(0,Re.font_set_text)(Mt[0],"%d",(0,xt.player_get_score)());var k=parseInt(L%60,10);if(k<10&&(k="0"+k),(0,Re.font_set_text)(Mt[1],"%s",parseInt(L/60,10)+":"+k),(0,Re.font_set_text)(Mt[2],"%d",(0,xt.player_get_rings)()),ae&&(L<5?L<1.5?(ae.position.y+=360*w,ae.position.y>-2&&(ae.position.y=-2),ie.position.x-=320*w,ie.position.x<140&&(ie.position.x=140),oe.position.y-=200*w,oe.position.y<200&&(oe.position.y=200)):L>3.5&&(ae.position.x-=320*w):(ae.visible=!1,ie.visible=!1,oe.visible=!1)),Y){var O=0,N=(0,ye.timer_get_ticks)(),T=(0,fe.soundfactory_get)("ring count"),B=(0,fe.soundfactory_get)("cash"),re=(0,fe.soundfactory_get)("glasses");if(N>=K+2e3){for(e=0;e<Tt.length;e++)Tt[e]&&(Tt[e].actor.speed.x=0);for(ee.position.x=Math.min(ee.position.x+800*w,30),te.position.x=Math.min(te.position.x+700*w,12),ne.position.x=Math.max(ne.position.x-700*w,250),e=0;e<3;e++)At[e].position.x=Math.min(At[e].position.x+(400-50*e)*w,50),Ct[e].position.x=Math.max(Ct[e].position.x-(400-50*e)*w,230);O=Z-(Bt+$),(0,Re.font_set_text)(Ct[0],"%d",parseInt(Bt,10)),(0,Re.font_set_text)(Ct[1],"%d",parseInt($,10)),(0,Re.font_set_text)(Ct[2],"%d",parseInt(O,10)),J||((0,pe.music_stop)(),(0,pe.sound_play)((0,fe.soundfactory_get)("goal")),J=!0)}if(N>=K+6e3&&!z)if(Bt=Math.max(0,Bt-400*w),$=Math.max(0,$-2e3*w),Bt>0||$>0)T&&N>=q&&(q=N+100,(0,pe.sound_play)(T));else for(z=!0,X=N+4e3,(0,pe.sound_play)(B),e=0;e<Tt.length;e++)if(Tt[e].got_glasses){(0,pe.sound_play)(re);break}z&&N>=X&&(Q=!0)}for(Pn(),Tn(),E=!1,e=0;e<Tt.length;e++)Tt[e].dying&&(E=!0);for(f=Hn(),n=Fn(),a=null,(0,ht.background_update)(C),g=Lt;g;g=g.next)if(g.data&&g.data.actor){var _e=g.data.actor.position.x,se=g.data.actor.position.y,ce=(0,we.actor_image)(g.data.actor).width,de=(0,we.actor_image)(g.data.actor).height;if(zn(_e,se,ce,de,kt)){if((0,Le.wU)(g.data,Tt,3,n,Lt,Nt),g.data.obstacle){var le=void 0,Ne=void 0,De=(0,Ie.v2d_add)(g.data.actor.hot_spot,(0,Ie.v2d_new)(0,-1)),Te=(0,we.actor_image)(g.data.actor),Pe=Cn(Te.width,Te.height-1,(0,Ie.v2d_subtract)(g.data.actor.position,De),0);Pe.brick_ref.zindex=g.data.bring_to_back?.4:.5,(le={}).next=a,le.data=Pe,a=le,(Ne={}).next=n,Ne.data=Pe,n=Ne}}else g.data.preserve||(g.data.state=Le.rJ)}for(y=Nt;y;y=y.next)if(y.data){var Be=y.data.actor.position.x,Ce=y.data.actor.position.y,Ue=(0,we.actor_image)(y.data.actor).width,Ze=(0,we.actor_image)(y.data.actor).height;if(zn(Be,Ce,Ue,Ze,kt)||y.data.always_active){if(A&&A.actor&&!(0,ve.input_is_ignored)(A.actor.input)&&(E||Y||(0,Oe.enemy_update)(y.data,Tt,Tt.length,n,f,Nt)),y.data.obstacle){var nt=void 0,at=void 0,dt=(0,Ie.v2d_add)(y.data.actor.hot_spot,(0,Ie.v2d_new)(0,-1)),gt=(0,we.actor_image)(y.data.actor),bt=Cn(gt.width,gt.height-1,(0,Ie.v2d_subtract)(y.data.actor.position,dt),y.data.obstacle_angle);(nt={}).next=a,nt.data=bt,a=nt,(at={}).next=n,at.data=bt,n=at}}else y.data.preserve?zn(y.data.actor.spawn_point.x,y.data.actor.spawn_point.y,Ue,Ze,kt)||(y.data.actor.position=(0,Ie.v2d_new)(y.data.actor.spawn_point.x,y.data.actor.spawn_point.y)):y.data.state=Le.rJ}if(Qn()&&A&&A.actor){var It,St=A.actor,Ot=[St.position.x,St.position.y,St.position.x+1,St.position.y+1],Dt=[F.rect_x,F.rect_y,F.rect_x+F.rect_w,F.rect_y+F.rect_h];if(E||function(e,t,n){var a=e.actor,o=null,i=null,r=null,_=null,s=null,c=null,d=null,l=null,u=[],p=(0,we.actor_corners)(a,2,-2,n,o,i,r,_,s,c,d,l);o=p.up,i=p.upright,r=p.right,_=p.downright,s=p.down,c=p.downleft,d=p.left,l=p.upleft;var f=(0,we.actor_handle_clouds)(a,-2,o,i,r,_,s,c,d,l);if(o=f.up,i=f.upright,r=f.right,_=f.downright,s=f.down,c=f.downleft,d=f.left,l=f.upleft,u[0]=o,u[1]=i,u[2]=r,u[3]=_,u[4]=s,u[5]=c,u[6]=d,u[7]=l,an())switch(e.hp<=0&&1!=e.state&&(on(),e.state=1),e.type){case 0:!function(e,t,n,a){var o=Xt(),i=.001*(0,ye.timer_get_ticks)(),r=e.actor,_=e.value[0],s=e.value[1];if(1==e.state){if(e.bring_to_front=!0,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,ye.timer_get_delta)(),i>=s+.15){var c=(0,Ie.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.actor_image)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.actor_image)(r).height));ln(Le.bW,c),r.position.y<=r.spawn_point.y+1.5*xe.VIDEO_SCREEN_H&&(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),s=i}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?(0,ve.input_simulate_button_down)(r.input,ve.IB_RIGHT):3==e.direction&&(0,ve.input_simulate_button_down)(r.input,ve.IB_LEFT),r.position.y=r.spawn_point.y+20*Math.cos(ge.PI*i),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,(0,we.actor_move)(r,(0,we.actor_eightdirections_movement)(r)),i>=_+2/e.initial_hp*e.hp&&(un([0,3][parseInt((0,Ee.random)(2),10)],r.position).actor.speed.y=-150-(0,Ee.random)(50),_=i),Et(e,t)&&r.animation==(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),o.actor.speed.x*=-1,o.actor.speed.y=100,e.hp--),(0,we.actor_animation_finished)(r)&&(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=_,e.value[1]=s}(e,t);break;case 1:!function(e,t,n,a){var o,i=Xt(),r=e.actor,_=.001*(0,ye.timer_get_ticks)(),s=(0,ye.timer_get_delta)(),c=e.value[0],d=e.value[1],l=e.value[2];switch(e.state){case 0:if(e.direction=i.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(ge.PI*_),(0,we.actor_animation_finished)(r)&&actor.change_animation(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),_>=c+5){var u,p=(0,Ie.v2d_new)(i.actor.position.x-r.position.x,i.actor.position.y-r.position.y);p=(0,Ie.v2d_multiply)((0,Ie.v2d_normalize)(p),200),(u=ln(Le.gb,r.position)).dangerouspower_set_speed(u,p),(0,pe.sound_play)((0,fe.soundfactory_get)("big shot")),c=_}if(_>=d+15){var f=e.rect_x+e.rect_w/2;e.direction=r.position.x>f?3:1,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,d=_}break;case 2:var g=e.rect_x+100,m=e.rect_x+e.rect_w-100,v=m-g+(r.position.x-g),h=3==e.direction?-1:1;r.position.x+=200*h*s,r.position.y=r.spawn_point.y-100*Math.sin(ge.PI/(m-g)*v),(0,we.actor_animation_finished)(r)&&(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==h&&r.position.x<=g||1==h&&r.position.x>=m)&&((0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",4)),r.position.y+=100*(0,ye.timer_get_delta)(),_>=l+.15){var b=(0,Ie.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.actor_image)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.actor_image)(r).height));ln(Le.bW,b),r.position.y<=r.spawn_point.y+1.5*xe.VIDEO_SCREEN_H&&(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),l=_}}o=r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",1)||r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",3),Et(e,t)&&!o&&1!=e.state&&(r.animation=(0,be.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),e.hp--,i.actor.speed.x*=-.5,i.actor.speed.y=i.actor.jump_strength),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP}(e,t);break;case 2:!function(e,t,n,a){var o=Xt(),i=.001*(0,ye.timer_get_ticks)(),r=e.actor,_=e.value[0],s=e.value[1],c=e.value[2];if(1==e.state){if(e.bring_to_front=!0,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,ye.timer_get_delta)(),i>=s+.15){var d=(0,Ie.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.actor_image)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.actor_image)(r).height));ln(Le.bW,d),r.position.y<=r.spawn_point.y+1.5*xe.VIDEO_SCREEN_H&&(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),s=i}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?(0,ve.input_simulate_button_down)(r.input,ve.IB_RIGHT):3==e.direction&&(0,ve.input_simulate_button_down)(r.input,ve.IB_LEFT),r.position.y=r.spawn_point.y+20*Math.cos(ge.PI*i),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,(0,we.actor_move)(r,(0,we.actor_eightdirections_movement)(r)),i>=_+2/e.initial_hp*e.hp&&(un(["9","6"][parseInt((0,Ee.random)(2),10)],r.position).actor.speed.y=-150-(0,Ee.random)(50),_=i),i>=c+3/e.initial_hp*e.hp&&(ln(Le.Pr,r.position).actor.speed.y=100,(0,pe.sound_play)((0,fe.soundfactory_get)("fire")),c=i),Et(e,t)&&r.animation==(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),o.actor.speed.x*=-1,o.actor.speed.y=100,e.hp--),(0,we.actor_animation_finished)(r)&&(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=_,e.value[1]=s,e.value[2]=c}(e,t);break;case 3:!function(e,t,n,a){var o,i=Xt(),r=e.actor,_=.001*(0,ye.timer_get_ticks)(),s=(0,ye.timer_get_delta)(),c=e.value[0],d=e.value[1],l=e.value[2],u=e.value[3];switch(e.state){case 0:if(e.direction=i.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(ge.PI*_),(0,we.actor_animation_finished)(r)&&(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),_>=c+4){var p,f=(0,Ie.v2d_new)(i.actor.position.x-r.position.x,i.actor.position.y-r.position.y);f=(0,Ie.v2d_multiply)((0,Ie.v2d_normalize)(f),200),(p=ln(Le.gb,r.position)).dangerouspower_set_speed(p,f),(0,pe.sound_play)((0,fe.soundfactory_get)("big shot")),c=_}if(_>=d+8){var g=e.rect_x+e.rect_w/2;e.direction=r.position.x>g?3:1,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,d=_}break;case 2:var m=e.rect_x+100,v=e.rect_x+e.rect_w-100,h=v-m+(r.position.x-m),b=3==e.direction?-1:1;r.position.x+=200*b*s,r.position.y=r.spawn_point.y-100*Math.sin(ge.PI/(v-m)*h),_>=u+.2&&(ln(Le.Pr,r.position).actor.speed.y=-200,(0,pe.sound_play)((0,fe.soundfactory_get)("fire")),u=_),(0,we.actor_animation_finished)(r)&&(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==b&&r.position.x<=m||1==b&&r.position.x>=v)&&((0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,we.actor_change_animation)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",4)),r.position.y+=100*(0,ye.timer_get_delta)(),_>=l+.15){var y=(0,Ie.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.actor_image)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.actor_image)(r).height));ln(Le.bW,y),r.position.y<=r.spawn_point.y+1.5*xe.VIDEO_SCREEN_H&&(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),l=_}}o=r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",1)||r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",3),Et(e,t)&&!o&&1!=e.state&&(r.animation=(0,be.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,pe.sound_play)((0,fe.soundfactory_get)("boss hit")),e.hp--,i.actor.speed.x*=-.5,i.actor.speed.y=i.actor.jump_strength),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,e.value[0]=c,e.value[1]=d,e.value[2]=l,e.value[3]=u}(e,t)}}(F,Tt,Rt),!yt(F)&&(0,Ee.bounding_box)(Ot,Dt)&&(V=!0,H=!0),!yt(F))for(e=0;e<Tt.length;e++)(Tt[e]!=A||A.actor.carrying)&&((It=Tt[e].actor).position.x>F.rect_x-30&&It.position.x<F.rect_x&&(It.position.x=F.rect_x-30,It.speed.x=0),It.position.x>F.rect_x+F.rect_w&&It.position.x<F.rect_x+F.rect_w+30&&(It.position.x=F.rect_x+F.rect_w+30,It.speed.x=0));(yt(F)||A.dying)&&(V=!1,D&&((0,pe.music_set_volume)((0,pe.music_get_volume)()-.5*w),(0,pe.music_get_volume)()<ge.EPSILON&&((0,pe.music_stop)(),(0,pe.music_set_volume)(1),P=!0)))}for(e=0;e<Tt.length;e++)(0,ve.input_ignore)(Tt[e].actor.input);for(A&&A.actor&&L>=3.5&&(0,ve.input_restore)(A.actor.input),e=0;e<Tt.length;e++){var jt=Tt[e].actor.position.x,Ft=Tt[e].actor.position.y,Vt=(0,we.actor_image)(Tt[e].actor).width,Ht=(0,we.actor_image)(Tt[e].actor).height,Ut=Tt[e].actor.hot_spot.y;if(e!=j&&(Tt[e].getting_hit&&Mn(e),Tt[e].dying&&(Mn(e),Pt!=Tt[e].actor&&(0,ke.q1)(Tt[e].actor.position,0))),Tt[e].dead){if(!((0,xt.player_get_lives)()>1))return(0,mt.scenestack_pop)(),void(0,mt.scenestack_push)((0,vt.storyboard_get_scene)(vt.SCENE_GAMEOVER));if((0,xe.video_fadefx_over)())return(0,xt.player_set_lives)((0,xt.player_get_lives)()-1),void In();(0,xe.video_fadefx_out)((0,me.image_rgb)(0,0,0),1)}if(Q){if((0,xe.video_fadefx_over)())return void(0,mt.scenestack_pop)();(0,xe.video_fadefx_out)((0,me.image_rgb)(0,0,0),1)}(zn(jt,Ft,Vt,Ht,kt/4)||Tt[e].dying)&&(!E||Tt[e].dying||Tt[e].getting_hit)&&(0,xt.player_update)(Tt[e],Tt,n),Tt[e].actor.position.y<Ut&&!Tt[e].dying?(Tt[e].actor.position.y=Ut,Tt[e].actor.speed.y=0):Tt[e].actor.position.y>R-(Ht-Ut)&&zn(jt,Ft,Vt,Ht,kt/4)&&(0,xt.player_kill)(Tt[e])}if(E||Y||(L+=(0,ye.timer_get_delta)()/1e3,A&&(0,ve.input_button_pressed)(A.actor.input,ve.IB_FIRE2)&&(!(Math.abs(A.actor.speed.y)<ge.EPSILON)||A.on_moveable_platform||V||A.disable_movement||A.in_locked_area?(0,pe.sound_play)((0,fe.soundfactory_get)("deny")):Mn((j+1)%3))),Qn()&&V){var Wt=A.actor;Wt&&(Wt.position.x<F.rect_x?(Wt.position.x=F.rect_x,Wt.speed.x=Math.max(0,Wt.speed.x)):Wt.position.x>F.rect_x+F.rect_w&&(Wt.position.x=F.rect_x+F.rect_w,Wt.speed.x=Math.min(Wt.speed.x,0)),Wt.position.y=(0,Ee.clip)(Wt.position.y,F.rect_y,F.rect_y+F.rect_h))}for(Ln(n),r=n;r;r=r.next){if(r.data&&r.data.brick_ref.behavior==Se.BRB_BREAKABLE){var Gt=r.data.brick_ref.image.width,Yt=r.data.brick_ref.image.height,Kt=[r.data.x,r.data.y,r.data.x+Gt,r.data.y+Yt],qt=[r.data.x,r.data.y,r.data.x+Gt,r.data.y+Yt];for(e=0;e<Tt.length;e++)if(Tt[e]&&(Kt[0]=Tt[e].actor.position.x-Tt[e].actor.hot_spot.x-3,Kt[1]=Tt[e].actor.position.y-Tt[e].actor.hot_spot.y-3,Kt[2]=Kt[0]+(0,we.actor_image)(Tt[e].actor).width+6,Kt[3]=Kt[1]+(0,we.actor_image)(Tt[e].actor).height+6,(Tt[e].spin_dash||Tt[e].spin||Tt[e].type==xt.PL_KNUCKLES)&&(0,Ee.bounding_box)(Kt,qt))){var zt,Qt,Jt=void 0,$t=void 0;for(Qt=Math.max(r.data.brick_ref.behavior_arg[0],1),zt=Math.max(r.data.brick_ref.behavior_arg[1],1),Jt=0;Jt<Qt;Jt++)for($t=0;$t<zt;$t++){var Zt=(0,Ie.v2d_new)(r.data.x+Jt*Gt/Qt,r.data.y+$t*Yt/zt),en=(0,Ie.v2d_new)(.3*-Tt[e].actor.speed.x,-100-(0,Ee.random)(50)),tn=(0,me.image_create)(Gt/Qt,Yt/zt);Math.abs(en.x)>ge.EPSILON&&(en.x+=(en.x>0?1:-1)*(0,Ee.random)(50)),pn(tn,Zt,en,!1)}(0,pe.sound_play)((0,fe.soundfactory_get)("break")),r.data.state=Se.BRS_DEAD}}if(r.data&&r.data.brick_ref.behavior==Se.BRB_FALL&&r.data.state==Se.BRS_ACTIVE){var nn=r.data;if(nn.value[1]+=(0,ye.timer_get_delta)(),nn.value[1]>=Se.BRB_FALL_TIME){var rn,_n,sn=void 0,cn=void 0,dn=0!=parseInt(nn.brick_ref.behavior_arg[2],10),fn=nn.brick_ref.image;for(rn=Math.max(nn.brick_ref.behavior_arg[0],1),_n=Math.max(nn.brick_ref.behavior_arg[1],1),sn=0;sn<rn;sn++)for(cn=0;cn<_n;cn++){var gn=(0,Ie.v2d_new)(nn.x+sn*fn.width/rn,nn.y+cn*fn.height/_n),mn=(0,Ie.v2d_new)(0,20+20*cn+20*(dn?sn:rn-sn)),bn=(0,me.image_create)(fn.width/rn,fn.height/_n);pn(bn,gn,mn,!1)}(0,pe.sound_play)((0,fe.soundfactory_get)("break")),nn.state=Se.BRS_DEAD}}Xn(r.data)}for(r=a;r;r=p)p=r.next,Kn(r.data),r=null;if(a=null,Vn(n),Un(f),A&&A.actor&&qn(A.actor),Y)(0,ke.q1)((0,Ie.v2d_add)(Pt.position,(0,Ie.v2d_new)(0,-90)),.17);else if(V){var yn=[F.rect_x+xe.VIDEO_SCREEN_W/2,F.rect_x+F.rect_w-xe.VIDEO_SCREEN_W/2],En=(0,Ie.v2d_new)((0,Ee.clip)(Pt.position.x,yn[0],yn[1]),Pt.position.y);(0,ke.q1)((0,Ie.v2d_add)(En,(0,Ie.v2d_new)(0,-90)),.17)}else E||(0,ke.q1)(Pt.position,.1);(0,ke.LF)()}Dn()},Gt=function(){if((0,xe.video_clearDisplay)(),We())return t=(0,Ie.v2d_subtract)(Ae,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2)),xe.VIDEO_SCREEN_W,r.width,xe.VIDEO_SCREEN_H,r.height,function(){if(Ue){var e,t,n,a,o=(0,Ie.v2d_subtract)(Ae,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2));for(n=(0,me.image_create)(1,1),a=(0,me.image_rgb)(0,128,160),(0,me.image_clear)(n,0,0,0),e=0;e<n.height;e++)(0,me.image_putpixel)(n,(0,xe.video_get_backbuffer)(),n.width-1,e,a);for(e=0;e<n.width;e++)(0,me.image_putpixel)(n,(0,xe.video_get_backbuffer)(),e,n.height-1,a);for(e=0;e<=xe.VIDEO_SCREEN_W/1;e++)for(t=0;t<=xe.VIDEO_SCREEN_H/1;t++)(0,Ie.v2d_subtract)(it((0,Ie.v2d_new)(e*n.width,t*n.height)),o);(0,me.image_destroy)(n)}}(),mn(),Ze(d,Fe,(0,Ie.v2d_subtract)(it(je),t)),e=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ARROW",0),0),(0,me.image_blit)(e.data,(0,xe.video_get_backbuffer)(),e.sx,e.sy,parseInt(je.x,10),parseInt(je.y,10),e.width,e.height),(0,Re.font_render)(l,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2)),void(0,Re.font_render)(u,(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2));var e,t;(0,ht.background_render_bg)(C,(0,ke.gY)()),xn(),(0,ht.background_render_fg)(C,(0,ke.gY)()),Sn()},Yt=function(){var e;for((0,he.logfile_message)("level_release()"),(0,me.image_destroy)(B),yn(),e=0;e<Tt.length;e++)(0,xt.player_destroy)(Tt[e]);for((0,ke.Xq)(),(0,he.logfile_message)("editor_release()"),at(),function(){var e;for(e=0;e<a;e++)Ne[e]=Pe(Ne[e]);a=0}(),(0,ve.input_destroy)(c),(0,ve.input_destroy)(s),(0,ve.input_destroy)(_),(0,Re.font_destroy)(u),(0,Re.font_destroy)(l),Me=!1,d=2,Fe=0,(0,he.logfile_message)("editor_release() ok"),(0,we.actor_destroy)(W),(0,we.actor_destroy)(U),(0,Re.font_destroy)(G),e=0;e<Tt.length;e++)(0,Re.font_destroy)(Mt[e]);for((0,we.actor_destroy)(ae),(0,we.actor_destroy)(oe),(0,Re.font_destroy)(ie),(0,Re.font_destroy)(ee),(0,Re.font_destroy)(te),(0,we.actor_destroy)(ne),e=0;e<3;e++)(0,Re.font_destroy)(Ct[e]),(0,we.actor_destroy)(At[e]);(0,Re.font_destroy)(ce),(0,Re.font_destroy)(de),(0,we.actor_destroy)(se),(0,he.logfile_message)("level_release() ok")},Kt=function(){return We()},Xt=function(){return A},qt=function(){return j},zt=function(e){var t;e=Math.max(0,e),(0,xt.player_set_score)((0,xt.player_get_score)()+e),(t=ln(Le.Sr,(0,Ie.v2d_add)(A.actor.position,(0,Ie.v2d_new)(-9,0)))).set_text(t,e)},Qt=function(){return(0,Ie.v2d_new)(O,R)},Jt=function(e){D&&(0,pe.music_stop)(),T=e,(0,pe.sound_play)(T)},$t=function(e){N=(0,Ie.v2d_new)(e.x,e.y)},Zt=function(e){var t;if(!Y){for(Y=!0,K=(0,ye.timer_get_ticks)(),Bt=10*(0,xt.player_get_rings)(),Z+=Bt,t=0;t<Tt.length;t++)Tt[t]&&Tt[t].got_glasses&&en(5e3);for((0,xt.player_set_score)((0,xt.player_get_score)()+Z),t=0;t<Tt.length;t++)Tt[t]&&((0,ve.input_ignore)(Tt[t].actor.input),Tt[t].spin_dash=!1);for(qn(e),nn(),(ee=(0,Re.font_set_text)(ee,"TEAM SONIC")).position=(0,Ie.v2d_new)(-500,20),(te=(0,Re.font_set_text)(te,"GOT THROUGH")).position=(0,Ie.v2d_new)(-500,46),(ne=(0,we.actor_change_animation)(ne,(0,be.sprite_get_animation)("SD_LEVELACT",S-1))).position=(0,Ie.v2d_new)(820,25),t=0;t<3;t++)At[t].position=(0,Ie.v2d_new)(-500,120+20*t),Ct[t].position=(0,Ie.v2d_new)(820,120+20*t);At[0]=(0,we.actor_change_animation)(At[0],(0,be.sprite_get_animation)("SD_RINGBONUS",0)),At[1]=(0,we.actor_change_animation)(At[1],(0,be.sprite_get_animation)("SD_SECRETBONUS",0)),At[2]=(0,we.actor_change_animation)(At[2],(0,be.sprite_get_animation)("SD_TOTAL",0))}},en=function(e){$+=e,Z+=e},tn=function(e,t){(!re||(0,Re.font_get_text)(ce)||(0,Re.font_get_text)(de))&&(re=!0,_e=(0,ye.timer_get_ticks)(),(0,Re.font_set_text)(ce,e),(0,Re.font_set_text)(de,t),(0,Re.font_set_width)(de,260))},nn=function(){re=!1},an=function(){return H},on=function(){var e,t;for(e=Nt;e;e=e.next)(t=e.data)&&(t.state=1)},rn=function(e,t,n,a){(0,ke.vY)(e+xe.VIDEO_SCREEN_W/2,t+xe.VIDEO_SCREEN_H/2,n-xe.VIDEO_SCREEN_W/2,a-xe.VIDEO_SCREEN_H/2)},_n=function(){(0,ke.H1)()},sn=function(){null!=D&&(0,pe.music_stop)()},cn=function(){return k},dn=function(e,t){var n,a;for((a={}).data={},a.data.brick_ref=(0,Se.brick_get)(e),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(t.x,10),a.data.y=a.data.sy=parseInt(t.y,10),a.data.enabled=!0,a.data.state=Se.BRS_IDLE,a.data.value=[],n=0;n<Se.BRICK_MAXVALUES;n++)a.data.value[n]=0;return jn(a),a.data},ln=function(e,t){var n={};return n.data=(0,Le._y)(e),n.data&&(n.data.actor.spawn_point=(0,Ie.v2d_new)(t.x,t.y),n.data.actor.position=(0,Ie.v2d_new)(t.x,t.y)),n.next=Lt,Lt=n,n.data},un=function(e,t){var n,a=(0,Ie.v2d_new)(t.x,t.y);return(n={}).data=(0,Oe.enemy_create)(e),n.data.actor.spawn_point=(0,Ie.v2d_new)(a.x,a.y),n.data.actor.position=(0,Ie.v2d_new)(a.x,a.y),n.next=Nt,Nt=n,n.data},pn=function(e,t,n,a){var o,i;We()?(0,me.image_destroy)(e):((o={}).image=e,o.position=t,o.speed=n,o.destroy_on_brick=a,(i={}).data=o,i.next=Dt,Dt=i)},fn=function(e,t){var n,a,o,i,r,_;return e?(n=e.value[0],e.brick_ref.behavior===Se.BRB_CIRCULAR?(a=e.brick_ref.behavior_arg[0],o=e.brick_ref.behavior_arg[1],i=e.brick_ref.behavior_arg[2]*(2*ge.PI),r=e.brick_ref.behavior_arg[3]*(2*ge.PI),_=e.brick_ref.behavior_arg[4]*ge.PI/180,(0,Ie.v2d_new)(-a*i*Math.sin(i*n+_),o*r*Math.cos(r*n+_))):(0,Ie.v2d_new)(0,0)):(0,Ie.v2d_new)(0,0)},gn=function(e){return ln(Le.NE,e)},mn=function(){xn()},vn=function(){return Rt},hn=function(e){return En(e)},bn=function(){Bn()},yn=function(){var e,t,n,a,o,i;for((0,he.logfile_message)("level_unload()"),D.pause(),(0,he.logfile_message)("releasing brick list..."),e=Rt;e;e=t)t=e.next,e.data=null,e=null;for(Rt=null,(0,he.logfile_message)("releasing item list..."),n=Lt;n;n=a)a=n.next,(0,Le.tl)(n.data),n=null;for(Lt=null,(0,he.logfile_message)("releasing enemy list..."),o=Nt;o;o=i)i=o.next,(0,Oe.enemy_destroy)(o.data),o=null;Nt=null,Qn()&&((0,he.logfile_message)("releasing the boss..."),function(e){(0,we.actor_destroy)(e.actor)}(F),F=null),(0,he.logfile_message)("unloading the brickset..."),(0,he.logfile_message)("unloading the background..."),(0,he.logfile_message)("level_unload() ok")},En=function(e){var t;for(t=0;t<(0,Se.brick_size)();t++)if(e.brick_ref==(0,Se.brick_get)(t))return t;return-1},In=function(){var e=N;Yt(),Ut(),N=e},xn=function(){var e,t,n,a,o={};for(t=e=Fn();t;t=t.next)t.data&&t.data.brick_ref.zindex<.5&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,xe.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,ke.gY)().x,10)-xe.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,ke.gY)().y,10)-xe.VIDEO_SCREEN_H/2),o.width*xe.VIDEO_SCALE,o.height*xe.VIDEO_SCALE));for(wn(!0),t=e;t;t=t.next)if(t.data){var i=t.data.brick_ref;Math.abs(i.zindex-.5)<ge.EPSILON&&i.property!=Se.BRK_OBSTACLE&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,xe.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,ke.gY)().x,10)-xe.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,ke.gY)().y,10)-xe.VIDEO_SCREEN_H/2),o.width*xe.VIDEO_SCALE,o.height*xe.VIDEO_SCALE))}for(n=Lt;n;n=n.next)n.data&&n.data.bring_to_back&&(0,Le.tx)(n.data,(0,ke.gY)());for(t=e;t;t=t.next)if(t.data){var r=t.data.brick_ref;Math.abs(r.zindex-.5)<ge.EPSILON&&r.property==Se.BRK_OBSTACLE&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,xe.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,ke.gY)().x,10)-xe.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,ke.gY)().y,10)-xe.VIDEO_SCREEN_H/2),o.width*xe.VIDEO_SCALE,o.height*xe.VIDEO_SCALE))}for(Qn()&&!F.bring_to_front&&bt(F,(0,ke.gY)()),a=Nt;a;a=a.next)(0,Oe.enemy_render)(a.data,(0,ke.gY)());for(wn(!1),Qn()&&F.bring_to_front&&bt(F,(0,ke.gY)()),n=Lt;n;n=n.next)n.data&&(0,Le.tx)(n.data,(0,ke.gY)());for(Nn(),t=e;t;t=t.next)t.data&&t.data.brick_ref.zindex>.5&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,xe.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,ke.gY)().x,10)-xe.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,ke.gY)().y,10)-xe.VIDEO_SCREEN_H/2),o.width*xe.VIDEO_SCALE,o.height*xe.VIDEO_SCALE));Vn(e)},wn=function(e){if(A){var t;for(t=Tt.length-1;t>=0;t--)Tt[t]!=A&&!!Tt[t].bring_to_back==e&&(0,xt.player_render)(Tt[t],(0,ke.gY)());!!A.bring_to_back==e&&(0,xt.player_render)(A,(0,ke.gY)())}},Sn=function(){var e,t=(0,Ie.v2d_new)(xe.VIDEO_SCREEN_W/2,xe.VIDEO_SCREEN_H/2);if(Y)for((0,we.actor_render)(ne,t),(0,Re.font_render)(ee,t),(0,Re.font_render)(te,t),e=0;e<3;e++)(0,we.actor_render)(At[e],t),(0,Re.font_render)(Ct[e],t);else{for((0,we.actor_render)(U,t),(0,we.actor_render)(W,t),(0,Re.font_render)(G,t),e=0;e<3;e++)(0,Re.font_render)(Mt[e],t);kn()}L<2.5&&(0,xe.video_clearDisplay)("rgb(0,0,0)"),(0,we.actor_render)(ae,t),(0,we.actor_render)(oe,t),(0,Re.font_render)(ie,t),On(t)},kn=function(){var e,t=[],n=[],a=0,o=.001*(0,ye.timer_get_ticks)();for(e=0;e<10;e++)n[e]=!0;if(A){switch(A.got_glasses&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",6),0)),A.shield_type){case xt.SH_SHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",7),0);break;case xt.SH_FIRESHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",11),0);break;case xt.SH_THUNDERSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",12),0);break;case xt.SH_WATERSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",13),0);break;case xt.SH_ACIDSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",14),0);break;case xt.SH_WINDSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",15),0)}if(A.invincible&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",4),0),A.invtimer>=.75*xt.PLAYER_MAX_INVINCIBILITY)){var i=(xt.PLAYER_MAX_INVINCIBILITY-A.invtimer)/(.25*xt.PLAYER_MAX_INVINCIBILITY);n[a-1]=Math.sin(.5*ge.PI*o/(i+.1))>=0}if(A.got_speedshoes&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",5),0),A.speedshoes_timer>=.75*xt.PLAYER_MAX_SPEEDSHOES)){var r=(xt.PLAYER_MAX_SPEEDSHOES-A.speedshoes_timer)/(.25*xt.PLAYER_MAX_SPEEDSHOES);n[a-1]=Math.sin(.5*ge.PI*o/(r+.1))>=0}}for(e=0;e<a;e++)n[e]&&(0,me.image_blit)(t[e].data,(0,xe.video_get_backbuffer)(),t[e].sx,t[e].sy,xe.VIDEO_SCREEN_W-(t[e].width+5)*(e+1),5,t[e].swidth,t[e].sheight)},On=function(e){(0,we.actor_render)(se,e),(0,Re.font_render)(ce,e),(0,Re.font_render)(de,e)},Rn=function(){Dt=null},Ln=function(e){var t,n,a,o,i,r=(0,ye.timer_get_delta)(),_=k,s=null;for(a=Dt;a;a=o)if(i=a.data){if(n=zn(i.position.x,i.position.y,i.position.x+i.image.width,i.position.y+i.image.height,kt),t=!1,i.destroy_on_brick&&n&&i.speed.y>0){var c=[i.position.x,i.position.y,i.position.x+i.image.width,i.position.y+i.image.height],d=void 0;for(d=e;d&&!t;d=d.next){var l=d.data;if(l&&l.brick_ref.property==Se.BRK_OBSTACLE&&0==l.brick_ref.angle){var u=[l.x,l.y,l.x+l.brick_ref.image.width,l.y+l.brick_ref.image.height];(0,Ee.bounding_box)(c,u)&&(t=!0)}}}!n||t?s?s.next=o:Dt=o:(i.position.x+=i.speed.x*r,i.position.y+=i.speed.y*r+.5*_*(r*r),i.speed.y+=_*r,s=a)}},Nn=function(){var e,t,n=(0,Ie.v2d_new)((0,ke.gY)().x-xe.VIDEO_SCREEN_W/2,(0,ke.gY)().y-xe.VIDEO_SCREEN_H/2);for(e=Dt;e;e=e.next)(t=e.data)&&(0,me.image_draw)(t.image,(0,xe.video_get_backbuffer)(),parseInt(t.position.x-n.x,10),parseInt(t.position.y-n.y,10),ge.IF_NONE)},Dn=function(){null==D||Y||P||(0,pe.music_is_playing)()||(T=null,(0,pe.music_play)(D,!0))},Tn=function(){if(se){var e=(0,ye.timer_get_delta)(),t=(0,ye.timer_get_ticks)();if(re){if(t>=_e+7e3)return void(re=!1);se.position.x=(xe.VIDEO_SCREEN_W-(0,we.actor_image)(se).width)/2,se.position.y=Math.max(se.position.y-100*e,xe.VIDEO_SCREEN_H-1.3*(0,we.actor_image)(se).height)}else se.position.y=Math.min(se.position.y+100*e,xe.VIDEO_SCREEN_H);ce.position=(0,Ie.v2d_add)(se.position,(0,Ie.v2d_new)(2,10)),de.position=(0,Ie.v2d_add)(se.position,(0,Ie.v2d_new)(2,23))}},Pn=function(){if(A&&A.actor){var e,t=[],n=[];if(!(L<2))for(t[0]=A.actor.position.x,t[1]=A.actor.position.y,t[2]=t[0]+(0,we.actor_image)(A.actor).width,t[3]=t[1]+(0,we.actor_image)(A.actor).height,e=0;e<le;e++)if(!jt[e].disabled&&(n[0]=jt[e].rect_x,n[1]=jt[e].rect_y,n[2]=n[0]+jt[e].rect_w,n[3]=n[1]+jt[e].rect_h,(0,Ee.bounding_box)(t,n))){jt[e].disabled=!0,tn(jt[e].title,jt[e].message);break}}},Mn=function(e){A.spin_dash=A.braking=!1,Tt[j=e]&&(A=Tt[j],qn(A.actor),(0,ve.input_restore)(A.actor.input))},Bn=function(){var e,t;for(e=0;e<Tt.length;e++)t=parseInt(N.x,10)<=O/2?2-e:e,Tt[e].actor.mirror=parseInt(N.x,10)<=O/2?ge.IF_NONE:ge.IF_HFLIP,Tt[e].actor.spawn_point.x=Tt[e].actor.position.x=N.x+15*t,Tt[e].actor.spawn_point.y=Tt[e].actor.position.y=N.y},Cn=function(e,t,n,a){var o,i={},r={data:null};for(r.image=(0,me.image_create)(e,t),r.angle=a,r.property=Se.BRK_OBSTACLE,r.behavior=Se.BRB_DEFAULT,r.zindex=.5,r.behavior_arg=[],o=0;o<Se.BRICKBEHAVIOR_MAXARGS;o++)r.behavior_arg[o]=0;for(i.brick_ref=r,i.animation_frame=0,i.enabled=!0,i.x=i.sx=parseInt(n.x,10),i.y=i.sy=parseInt(n.y,10),i.value=[],o=0;o<Se.BRICK_MAXVALUES;o++)i.value[o]=0;return i},An=function(e,t){var n=e.brick_ref,a=t.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var o=[0,100,50];return o[n.property]-o[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:e.sy-t.sy},jn=function(e){var t;if(Rt)if(An(e.data,Rt.data)>=0)e.next=Rt,Rt=e;else{for(t=Rt;t.next&&An(t.next.data,e.data)>0;)t=t.next;e.next=t.next,t.next=e}else e.next=null,Rt=e},Fn=function(){var e,t,n,a,o,i,r=[];for(e=Rt;e;e=e.next)e.data&&e.data.brick_ref&&e.data.brick_ref.image&&(n=Math.min(e.data.x,e.data.sx),a=Math.min(e.data.y,e.data.sy),o=e.data.brick_ref.image.width,i=e.data.brick_ref.image.height,(zn(n,a,o,i,2*kt)||e.data.brick_ref.behavior==Se.BRB_CIRCULAR)&&((t={}).data=e.data,t.next=r,r=t));return r},Vn=function(e){for(var t;e;)t=e.next,e=null,e=t},Hn=function(){var e,t,n,a,o,i,r,_=null;for(e=Lt;e;e=e.next)e.data&&(r=(0,we.actor_image)(e.data.actor))&&(n=parseInt(e.data.actor.position.x,10),a=parseInt(e.data.actor.position.y,10),o=r.width,i=r.height,zn(n,a,o,i,kt)&&((t={}).data=e.data,t.next=_,_=t));return _},Un=function(e){for(var t;e;)t=e.next,e=null,e=t},Wn=function(){var e,t;if(Lt)for(Lt.data&&Lt.data.state==Le.rJ&&(t=Lt.next,(0,Le.tl)(Lt.data),Lt=t),e=Lt;e&&e.next;e=e.next)e.next&&e.next.data&&e.next.data.state==Le.rJ&&(t=e.next,e.next=t.next,(0,Le.tl)(t.data),t=null)},Gn=function(){var e,t;if(Nt)for(Nt&&Nt.data&&Nt.data.state==Oe.ES_DEAD&&(t=Nt.next,(0,Oe.enemy_destroy)(Nt.data),Nt=null,Nt=t),e=Nt;e&&e.next;e=e.next)e&&e.next&&e.next.data&&e.next.data.state==Oe.ES_DEAD&&(t=e.next,e.next=t.next,(0,Oe.enemy_destroy)(t.data),t=null)},Yn=function(){var e,t;if(Rt)for(Rt.data&&Rt.data.state==Se.BRS_DEAD&&(t=Rt.next,Rt.data=null,Rt=null,Rt=t),e=Rt;e&&e.next;e=e.next)e.next.data.state==Se.BRS_DEAD&&(t=e.next,e.next=t.next,t.data=null,t=null)},Kn=function(e){(0,me.image_destroy)(e.brick_ref.image),e.brick_ref=null,e=null},Xn=function(e){var t,n,a,o,i,r;e&&(e.value[0]+=(0,ye.timer_get_delta)(),t=e.value[0],e.brick_ref.behavior===Se.BRB_CIRCULAR)&&(n=e.brick_ref.behavior_arg[0],a=e.brick_ref.behavior_arg[1],o=e.brick_ref.behavior_arg[2]*(2*ge.PI),i=e.brick_ref.behavior_arg[3]*(2*ge.PI),r=e.brick_ref.behavior_arg[4]*ge.PI/180,e.x=e.sx+Math.round(n*Math.cos(o*t+r)),e.y=e.sy+Math.round(a*Math.sin(i*t+r)))},qn=function(e){Pt={position:{x:e.position.x,y:e.position.y}}},zn=function(e,t,n,a,o){var i=(0,ke.gY)(),r=[e,t,e+n,t+a],_=[i.x-xe.VIDEO_SCREEN_W/2-o,i.y-xe.VIDEO_SCREEN_H/2-o,i.x+xe.VIDEO_SCREEN_W/2+o,i.y+xe.VIDEO_SCREEN_H/2+o];return(0,Ee.bounding_box)(r,_)},Qn=function(){return null!=F},Jn=function(e){return y="Untitled",E="",I="",x="",w="",N=(0,Ie.v2d_new)(0,0),le=0,F=null,S=1,new Promise((function(t,n){(0,he.logfile_message)('level_load("%s")',e),(0,gt.resourcemanager_getJsonFile)(e).then($n).then((function(){D=(0,pe.music_load)(E),function(){var e,t,n;for(e=t=-ge.INFINITY,n=Rt;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(e=Math.max(e,n.data.sx+(0,Se.brick_image)(n.data).width),t=Math.max(t,n.data.sy+(0,Se.brick_image)(n.data).height));O=Math.max(e,xe.VIDEO_SCREEN_W),R=Math.max(t,xe.VIDEO_SCREEN_H)}(),(0,he.logfile_message)("level_load() ok"),t()}))}))},$n=function(e){var t;for(I=e.theme,x=e.bgtheme,w=e.grouptheme,E=e.music,y=e.name,e.author,e.version,e.requires,S=e.act,N=e.spawn_point,e.readonly,e.boss&&(F=function(e,t,n,a,o,i){var r,_,s={};for(s.type=e,s.state=0,s.rect_x=n,s.rect_y=a,s.rect_w=o,s.rect_h=i,s.value=[],r=0;r<10;r++)s.value[r]=0;switch(s.bring_to_front=!1,s.actor=_=(0,we.actor_create)(),_.spawn_point=(0,Ie.v2d_new)(t.x,t.y),_.position=(0,Ie.v2d_new)(t.x,t.y),_.input=(0,ve.input_create_computer)(),e){case 0:case 2:(0,we.actor_change_animation)(_,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),s.initial_hp=s.hp=3,s.direction=3,_.maxspeed=100,_.acceleration=100;break;case 1:case 3:(0,we.actor_change_animation)(_,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),s.initial_hp=s.hp=10,s.direction=3,_.maxspeed=100,_.acceleration=100}return s}(e.boss.id,(0,Ie.v2d_new)(e.boss.x,e.boss.y),e.boss.rx,e.boss.ry,e.boss.rw,e.boss.rh),console.log("BOSS",F)),t=0;t<e.dialogbox.length;t++){var n={disabled:!1};n.rect_x=e.dialogbox[t].xpos,n.rect_y=e.dialogbox[t].ypos,n.rect_w=e.dialogbox[t].width,n.rect_h=e.dialogbox[t].height,n.title=(0,ft.lang_get)(e.dialogbox[t].title),n.message=(0,ft.lang_get)(e.dialogbox[t].message),jt.push(n),le=jt.length}for(t=0;t<e.enemylist.length;t++)un(e.enemylist[t].id,(0,Ie.v2d_new)(e.enemylist[t].xpos,e.enemylist[t].ypos));return new Promise((function(n,a){(0,Se.brick_load)(e.theme).then((function(a){for(var o=0;o<e.bricklist.length;o++)dn(e.bricklist[o].id,(0,Ie.v2d_new)(e.bricklist[o].xpos,e.bricklist[o].ypos));(0,ht.background_load)(e.bgtheme).then((function(a){for(C=a,t=0;t<e.itemlist.length;t++)Lt[t]=ln(e.itemlist[t].id,(0,Ie.v2d_new)(e.itemlist[t].xpos,e.itemlist[t].ypos));n()}))}))}))}},4344:(e,t,n)=>{n.r(t),n.d(t,{menu_init:()=>K,menu_release:()=>z,menu_render:()=>q,menu_update:()=>X});var a,o,i,r,_,s,c,d,l,u,p,f,g,m,v,h,b,y,E,I,x,w,S=n(7307),k=n(6093),O=n(2667),R=n(532),L=n(9386),N=n(2878),D=n(7774),T=n(642),P=n(7709),M=n(9931),B=n(4163),C=n(6038),A=n(4470),j=n(9880),F=n(3031),V=n(5176),H=n(3339),U=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],W=3,G=[],Y=[],K=function(){var e,t;for(b=!1,a=0,_=.001*(0,B.timer_get_ticks)(),s=!1,i=null,o=(0,D.input_create_user)(),(0,D.input_ignore)(o),J(),w=(0,M.music_load)("data/music/title.mp4"),(0,M.music_play)(w,!0),r=(0,H.background_load)("data/themes/menu.bg.json").then((function(e){r=e,(0,T.video_fadefx_in)((0,P.image_rgb)(0,0,0),1)})),p=!0,f=(0,F.actor_create)(),(f=(0,F.actor_change_animation)(f,(0,j.sprite_get_animation)("SD_TITLESURGE",0))).position.x=(T.VIDEO_SCREEN_W-(0,F.actor_image)(f).width)/2+5,f.position.y=-15,g=(0,F.actor_create)(),(g=(0,F.actor_change_animation)(g,(0,j.sprite_get_animation)("SD_TITLEBG",0))).position.x=(T.VIDEO_SCREEN_W-(0,F.actor_image)(g).width)/2,g.position.y=f.position.y+25,m=(0,F.actor_create)(),(m=(0,F.actor_change_animation)(m,(0,j.sprite_get_animation)("SD_TITLEGAMENAME",0))).position.x=(T.VIDEO_SCREEN_W-(0,F.actor_image)(m).width)/2,m.position.y=f.position.y+(0,F.actor_image)(f).height-9,(v=(0,V.font_create)(8)).position=(0,N.v2d_new)(3,T.VIDEO_SCREEN_H-12),(0,V.font_set_text)(v,"%s",L.GAME_WEBSITE),(h=(0,V.font_create)(0)).position=(0,N.v2d_new)(T.VIDEO_SCREEN_W-75,3),(0,V.font_set_text)(h,"V%d.%d.%d",L.GAME_VERSION,L.GAME_SUB_VERSION,L.GAME_WIP_VERSION),d=0,u=(0,F.actor_create)(),u=(0,F.actor_change_animation)(u,(0,j.sprite_get_animation)("SD_TITLEFOOT",0)),(c=[])[0]=(0,C.lang_getstring)("MENU_1PGAME"),c[1]=(0,C.lang_getstring)("MENU_TUTORIAL"),c[2]=(0,C.lang_getstring)("MENU_CUSTOMQUESTS"),c[3]=(0,C.lang_getstring)("MENU_OPTIONS"),W=c.length,l=[],e=0;e<2;e++)for(t=0;t<W;t++)l[t]||(l[t]=[]),l[t][e]=(0,V.font_create)(e),l[t][e].position=(0,N.v2d_new)(T.VIDEO_SCREEN_W/2-(0,F.actor_image)(g).width/5,m.position.y+65+10*t),(0,V.font_set_text)(l[t][e],c[t]);G[0]=(0,V.font_create)(8),G[0].position=(0,N.v2d_new)(5,3),G[1]=(0,V.font_create)(8),G[1].position=(0,N.v2d_new)(5,T.VIDEO_SCREEN_H-13),(y=(0,V.font_create)(8)).position=(0,N.v2d_new)(5,170),(0,T.video_fadefx_in)((0,P.image_rgb)(0,0,0),1.5)},X=function(){var e,t=.001*(0,B.timer_get_ticks)();if(null!=i&&(0,T.video_fadefx_over)())return(0,O.scenestack_pop)(),void(0,O.scenestack_push)(i);switch(t<=_+2?(0,D.input_ignore)(o):s||((0,D.input_restore)(o),s=!0),(0,H.background_update)(r),a){case 0:p&&(0,F.actor_animation_finished)(f)&&(p=!1,f=(0,F.actor_change_animation)(f,(0,j.sprite_get_animation)("SD_TITLESURGE",1)),(0,D.input_restore)(o)),m.visible=!p,u.position.x=l[d][0].position.x-20+3*Math.cos(2*L.PI*t),u.position.y=l[d][0].position.y,(0,D.input_button_pressed)(o,D.IB_UP)&&((0,M.sound_play)((0,A.soundfactory_get)("choose")),d--),(0,D.input_button_pressed)(o,D.IB_DOWN)&&((0,M.sound_play)((0,A.soundfactory_get)("choose")),d++),d=(d%W+W)%W,((0,D.input_button_pressed)(o,D.IB_FIRE1)||(0,D.input_button_pressed)(o,D.IB_FIRE3))&&((0,M.sound_play)((0,A.soundfactory_get)("select")),Q(d));break;case 1:for((0,D.input_button_pressed)(o,D.IB_FIRE4)&&((0,M.sound_play)((0,A.soundfactory_get)("return")),a=0),e=0;e<I;e++)Y[e].position=(0,N.v2d_new)(30,20+e%14*10),Y[e].visible=$(e)==$(E);if(u.position.x=10,u.position.y=Y[E].position.y,(0,D.input_button_pressed)(o,D.IB_UP)&&((0,M.sound_play)((0,A.soundfactory_get)("choose")),E--),(0,D.input_button_pressed)(o,D.IB_DOWN)&&((0,M.sound_play)((0,A.soundfactory_get)("choose")),E++),E=(E%I+I)%I,(0,V.font_set_text)(G[0],(0,C.lang_get)("MENU_CQ_SELECT"),$(E),Z()),(0,V.font_set_text)(G[1],(0,C.lang_get)("MENU_CQ_BACK")),(0,V.font_set_text)(y,(0,C.lang_get)("MENU_CQ_INFO"),x[E].version,x[E].name,x[E].author,x[E].description),(0,D.input_button_pressed)(o,D.IB_FIRE1)||(0,D.input_button_pressed)(o,D.IB_FIRE3))return(0,M.sound_play)((0,A.soundfactory_get)("select")),void ee(x[E])}},q=function(){var e,t=(0,N.v2d_new)(T.VIDEO_SCREEN_W/2,T.VIDEO_SCREEN_H/2);if((0,T.video_clearDisplay)(),!b||!(0,T.video_fadefx_over)())switch((0,H.background_render_bg)(r,t),(0,H.background_render_fg)(r,t),a){case 0:for(e=0;e<W;e++)(0,V.font_render)(l[e][e==d?1:0],t);(0,F.actor_render)(u,t),(0,V.font_render)(v,t),(0,V.font_render)(h,t),(0,F.actor_render)(g,t),p&&(0,T.video_clearDisplay)(),(0,F.actor_render)(f,t),(0,F.actor_render)(m,t);break;case 1:var n=x[E].image;for((0,V.font_render)(y,t),(0,P.image_blit)(n,(0,T.video_get_backbuffer)(),0,0,T.VIDEO_SCREEN_W-n.width-25,parseInt(Y[0].position.y,10),n.width,n.height),(0,V.font_render)(G[0],t),(0,V.font_render)(G[1],t),e=0;e<I;e++)(0,V.font_render)(Y[e],t);(0,F.actor_render)(u,t)}},z=function(){var e,t;for(w.pause(),(0,V.font_destroy)(v),(0,V.font_destroy)(h),e=0;e<2;e++)for(t=0;t<W;t++)(0,V.font_destroy)(l[t][e]);(0,F.actor_destroy)(g),(0,F.actor_destroy)(m),(0,F.actor_destroy)(f),(0,F.actor_destroy)(u),(0,D.input_destroy)(o)},Q=function(e){var t=U[0];switch(e){case 0:return void(0,k.quest_load)(t).then((function(e){ee(e)}));case 1:return void(0,k.quest_load)("data/quests/tutorial.json").then((function(e){ee(e)}));case 2:a=1,E=0;break;case 3:return i=(0,R.storyboard_get_scene)(R.SCENE_OPTIONS),void(0,T.video_fadefx_out)((0,P.image_rgb)(0,0,0),.5)}},J=function(){var e;for(I=U.length,x=[],e=0;e<I;e++)!function(t){(0,k.quest_load)(U[e]).then((function(e){Y[t]=(0,V.font_create)(8),x[t]=e,(0,V.font_set_text)(Y[t],e.name)}))}(e)},$=function(e){return Math.floor(e/14+1)},Z=function(){return Math.floor(I/14+(I%14==0?0:1))},ee=function(e){(0,S.quest_run)(e,!1),i=(0,R.storyboard_get_scene)(R.SCENE_QUEST),(0,D.input_ignore)(o),(0,T.video_fadefx_out)((0,P.image_rgb)(0,0,0),.5)}},3494:(e,t,n)=>{n.r(t),n.d(t,{options_init:()=>j,options_release:()=>H,options_render:()=>V,options_update:()=>F});var a,o,i,r,_,s,c,d,l,u,p=n(2878),f=n(5176),g=function e(t){var n;if(t)for(t.init(t),n=0;n<t.child_count;n++)e(t.child[n])},m=function e(t){var n;if(t){for(n=0;n<t.child_count;n++)e(t.child[n]);t.update(t)}},v=function e(t,n){var a;if(t){for(a=0;a<t.child_count;a++)e(t.child[a],n);t.render(t,n)}},h=function e(t){var n,a=0;if(t){for(n=0;n<t.child_count;n++)a+=e(t.child[n]);return 1+a}return 0},b=function(e,t,n,a){var o={};return o.init=e,o.release=t,o.update=n,o.render=a,o.font=null,o.data=null,o.parent=null,o.child_count=0,o.child=[],o},y=function(e,t){e.child_count<10&&(e.child[e.child_count++]=t,t.parent=e)},E=function(e){if(e.font=(0,f.font_create)(8),(0,f.font_set_text)(e.font,"LABEL"),null!=e.parent){var t,n,a=0,o=null!=e.parent.font?(0,f.font_get_charsize)(e.parent.font):(0,p.v2d_new)(12,12);for(t=0;t<e.parent.child_count&&e.parent.child[t]!=e;t++);for(n=0;n<t;n++)a+=h(e.parent.child[n])-1;e.font.position={x:e.parent.font.position.x,y:e.parent.font.position.y},e.font.position.x+=3*o.x,e.font.position.y+=(1+a+t)*o.y*2}},I=function(e){(0,f.font_destroy)(e.font)},x=function(e,t){(0,f.font_render)(e.font,t)},w=n(9386),S=n(2667),k=n(532),O=n(5286),R=n(642),L=n(7709),N=n(9931),D=n(4470),T=n(6038),P=n(7774),M=n(9880),B=n(4163),C=n(3031),A=n(3339),j=function(){l=0,a=!1,c=0,_=(0,P.input_create_user)(),s=null,o=!0,i=(0,f.font_create)(4),(0,f.font_set_text)(i,(0,T.lang_get)("OPTIONS_TITLE")),i.position.x=R.VIDEO_SCREEN_W/2-100,i.position.y=10,d=(0,A.background_load)("data/themes/options.bg.json").then((function(e){d=e})),r=(0,C.actor_create)(),(0,C.actor_change_animation)(r,(0,M.sprite_get_animation)("SD_TITLEFOOT",0)),r.position=(0,p.v2d_new)(-50,-50),u=Ne(),g(u)},F=function(){var e=(0,B.timer_get_delta)();if(c+=e,(0,f.font_set_text)(i,(0,T.lang_get)("OPTIONS_TITLE")),o&&((0,R.video_fadefx_in)((0,L.image_rgb)(0,0,0),1),o=!1),(0,A.background_update)(d),a||null!=s||(0,R.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_DOWN)&&(l=(l+1)%5,(0,N.sound_play)((0,D.soundfactory_get)("choose"))),(0,P.input_button_pressed)(_,P.IB_UP)&&(l=((l-1)%5+5)%5,(0,N.sound_play)((0,D.soundfactory_get)("choose"))),(0,P.input_button_pressed)(_,P.IB_FIRE4)&&((0,N.sound_play)((0,D.soundfactory_get)("return")),a=!0)),m(u),a)(0,R.video_fadefx_is_fading)()||(0,N.music_stop)();else if(!(0,N.music_is_playing)()&&c>=.2){var t=(0,N.music_load)("data/music/options.mp4");(0,N.music_play)(t,w.INFINITY)}if(a){if((0,R.video_fadefx_over)())return U(),(0,S.scenestack_pop)(),void(0,S.scenestack_push)((0,k.storyboard_get_scene)(k.SCENE_MENU));(0,R.video_fadefx_out)((0,L.image_rgb)(0,0,0),1)}if(null!=s){if((0,R.video_fadefx_over)())return U(),(0,S.scenestack_push)(s),s=null,void(o=!0);(0,R.video_fadefx_out)((0,L.image_rgb)(0,0,0),1)}},V=function(){var e=(0,p.v2d_new)(R.VIDEO_SCREEN_W/2,R.VIDEO_SCREEN_H/2);(0,A.background_render_bg)(d,e),(0,A.background_render_fg)(d,e),(0,f.font_render)(i,e),v(u,e),(0,C.actor_render)(r,e)},H=function(){(0,C.actor_destroy)(r),(0,f.font_destroy)(i),(0,P.input_destroy)(_)},U=function(){(0,O.preferences_set_video_resolution)((0,R.video_get_resolution)()),(0,O.preferences_set_fullscreen)((0,R.video_is_fullscreen)()),(0,O.preferences_set_smooth_graphics)((0,R.video_is_smooth)()),(0,O.preferences_set_show_fps)((0,R.video_is_fps_visible)())},W=function(e,t){E(e),e.data=t,(0,f.font_set_text)(e.font,(0,T.lang_get)(t))},G=function(e){e.data=null,I(e)},Y=function(e){(0,f.font_set_text)(e.font,(0,T.lang_get)(e.data))},K=function(e,t){x(e,t)},X=function(e,t,n){var a;E(e),(0,f.font_set_text)(e.font,(0,T.lang_get)(t)),e.data={},(a=e.data).option_index=n,a.lang_key=t},q=function(e){e.data=null,I(e)},z=function(e){var t=e.data;return l==t.option_index},Q=function(e){var t=e.data;(0,f.font_set_text)(e.font,(0,T.lang_get)(t.lang_key)),z(e)&&((0,f.font_set_text)(e.font,"<color=ffff00>%s</color>",(0,T.lang_get)(t.lang_key)),r.position=(0,p.v2d_add)(e.font.position,(0,p.v2d_new)(3*Math.cos(2*w.PI*c)-20,0)))},J=function(e,t){x(e,t)},$=function(e){E(e),(0,f.font_set_text)(e.font,""),e.font.position=(0,p.v2d_new)(0,25)},Z=function(e){I(e)},ee=function(e){},te=function(e,t){x(e,t)},ne=function(e){W(e,"OPTIONS_GRAPHICS")},ae=function(e){G(e)},oe=function(e){Y(e)},ie=function(e,t){K(e,t)},re=function(e){X(e,"OPTIONS_FPS",0)},_e=function(e){q(e)},se=function(e){Q(e),function(e){return z(e)}(e)&&((0,R.video_fadefx_is_fading)()||(((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,N.sound_play)((0,D.soundfactory_get)("select")),(0,R.video_show_fps)(!(0,R.video_is_fps_visible)())),(0,P.input_button_pressed)(_,P.IB_RIGHT)&&(0,R.video_is_fps_visible)()&&((0,N.sound_play)((0,D.soundfactory_get)("select")),(0,R.video_show_fps)(!1)),(0,P.input_button_pressed)(_,P.IB_LEFT)&&((0,R.video_is_fps_visible)()||((0,N.sound_play)((0,D.soundfactory_get)("select")),(0,R.video_show_fps)(!0)))))},ce=function(e,t){var n,a=[];J(e,t),(n=(0,f.font_create)(8)).position=(0,p.v2d_new)(175,e.font.position.y),a[0]=(0,T.lang_get)("OPTIONS_YES"),a[1]=(0,T.lang_get)("OPTIONS_NO"),(0,R.video_is_fps_visible)()?(0,f.font_set_text)(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):(0,f.font_set_text)(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),(0,f.font_render)(n,t),(0,f.font_destroy)(n)},de=function(e){W(e,"OPTIONS_GAME")},le=function(e){G(e)},ue=function(e){Y(e)},pe=function(e,t){K(e,t)},fe=function(e){X(e,"OPTIONS_LANGUAGE",1)},ge=function(e){q(e)},me=function(e){Q(e),function(e){return z(e)}(e)&&((0,R.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,N.sound_play)((0,D.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_LANGSELECT)))},ve=function(e,t){J(e,t)},he=function(e){X(e,"OPTIONS_STAGESELECT",2)},be=function(e){q(e)},ye=function(e){Q(e),function(e){return z(e)}(e)&&((0,R.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,N.sound_play)((0,D.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_STAGESELECT)))},Ee=function(e,t){J(e,t)},Ie=function(e){X(e,"OPTIONS_CREDITS",3)},xe=function(e){q(e)},we=function(e){Q(e),function(e){return z(e)}(e)&&((0,R.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,N.sound_play)((0,D.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_CREDITS)))},Se=function(e,t){J(e,t)},ke=function(e){X(e,"OPTIONS_BACK",4)},Oe=function(e){q(e)},Re=function(e){Q(e),function(e){return z(e)}(e)&&((0,R.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,N.sound_play)((0,D.soundfactory_get)("select")),a=!0))},Le=function(e,t){J(e,t)},Ne=function(){var e,t,n,a,o,i,r,_;return n=b(re,_e,se,ce),t=b(ne,ae,oe,ie),y(t,n),o=b(fe,ge,me,ve),i=b(Ie,xe,we,Se),r=b(he,be,ye,Ee),a=b(de,le,ue,pe),y(a,o),y(a,r),y(a,i),_=b(ke,Oe,Re,Le),e=b($,Z,ee,te),y(e,t),y(e,a),y(e,_),e}},9931:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound_is_playing=t.sound_stop=t.sound_play_ex=t.sound_play=t.sound_load=t.music_is_playing=t.music_get_volume=t.music_set_volume=t.music_resume=t.music_pause=t.music_stop=t.music_play=t.music_load=t.audio_release=t.audio_update=t.audio_init=void 0;var a=n(9386),o=n(3450),i=n(7898),r=null;t.audio_init=function(){},t.audio_update=function(){},t.audio_release=function(){},t.music_load=function(e){(0,i.logfile_message)("music_load('%s') ".concat(e));var t=new Audio;return t.src=e,(0,o.resourcemanager_add_music)(e,t),t},t.music_play=function(e,n){if((0,t.music_is_playing)()&&(0,t.music_stop)(),null!=e){e.loop=!!n;try{e.play()}catch(e){}}r=e},t.music_stop=function(){null!=r&&r.pause(),r=null},t.music_pause=function(){null==r||r.paused||r.pause()},t.music_resume=function(){null!=r&&r.paused&&r.play()},t.music_set_volume=function(e){null!=r&&(e>1&&(e=1),e<0&&(e=0),r.volume=e)},t.music_get_volume=function(){return null!=r?r.volume:0},t.music_is_playing=function(){return null!=r&&!r.paused},t.sound_load=function(e,t){t=a.DATA_ROOT+t;var n=new Audio;n.src=t;var i=new Audio;i.src=t;var r=new Audio;r.src=t;var _=new Audio;return _.src=t,(0,o.resourcemanager_add_sample)(e,n),(0,o.resourcemanager_add_sample)(e+"2",i),(0,o.resourcemanager_add_sample)(e+"3",r),(0,o.resourcemanager_add_sample)(e+"4",_),n},t.sound_play=function(e){(0,t.sound_play_ex)(e)},t.sound_play_ex=function(e){e&&e.play&&e.play()},t.sound_stop=function(e){e&&e.pause()},t.sound_is_playing=function(e){return!!e&&!e.paused}},8251:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandline_parse=void 0,n(7898);var a=n(5286);t.commandline_parse=function(e){var t={};return t.video_resolution=(0,a.preferences_get_video_resolution)(),t.smooth_graphics=(0,a.preferences_get_smooth_graphics)(),t.fullscreen=(0,a.preferences_get_fullscreen)(),t.show_fps=(0,a.preferences_get_show_fps)(),t.language=(0,a.preferences_get_language)(),t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=o("video_resolution")?o("video_resolution"):t.video_resolution,t.smooth_graphics=o("smooth_graphics")?o("smooth_graphics"):t.smooth_graphics,t.fullscreen=o("fullscreen")?o("fullscreen"):t.fullscreen,t.show_fps=o("show_fps")?o("show_fps"):t.show_fps,t.color_depth=o("color_depth")?o("color_depth"):t.color_depth,t.level=o("level")?o("level"):t.level,t.quest=o("quest")?o("quest"):t.quest,t.language=o("language")?o("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t};var o=function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null}},5197:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.engine_init=void 0;var a=n(9931),o=n(8251),i=n(7774),r=n(6038),_=n(5286),s=n(3450),c=n(2667),d=n(1817),l=n(4470),u=n(9880),p=n(532),f=n(4163),g=n(2954),m=n(642),v=n(4054),h=n(5971),b=n(6378),y=n(5176);t.engine_init=function(e){I();var t=(0,o.commandline_parse)(e);console.log("COMMAND LINE",t),x(t),(0,u.sprite_init)().then((function(){(0,y.font_init)(),w(t,(function(){S(),k(t),E()}))}))};var E=function(){var e;(0,g.runAnimation)((function(){(0,f.timer_update)(),(0,i.input_update)(),(e=(0,c.scenestack_top)())&&(e.update(),e==(0,c.scenestack_top)()&&e.render()),(0,d.screenshot_update)(),(0,m.video_render)(),(0,i.input_render)()}))},I=function(){(0,_.preferences_init)()},x=function(e){(0,f.timer_init)(),(0,m.video_init)(O(),e.video_resolution,e.smooth_graphics,e.fullscreen,e.color_depth,e.show_fps),(0,a.audio_init)(),(0,i.input_init)(),(0,s.resourcemanager_init)()},w=function(e,t){(0,l.soundfactory_init)(),(0,b.enemy_objects_init)(),(0,p.storyboard_init)(),(0,d.screenshot_init)(),(0,r.lang_init)(e.language,(function(){(0,c.scenestack_init)(),t()}))},S=function(){(0,h.player_set_lives)(h.PLAYER_INITIAL_LIVES),(0,h.player_set_score)(0)},k=function(e){e.custom_level?((0,v.level_setfile)(e.custom_level_path),(0,c.scenestack_push)((0,p.storyboard_get_scene)(p.SCENE_LEVEL))):(0,c.scenestack_push)((0,p.storyboard_get_scene)(p.SCENE_INTRO))},O=function(){return""}},9386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=t.PI=t.INT_MAX=t.INFINITY_FLT=t.INFINITY=t.EPSILON=t.GAME_WEBSITE=t.GAME_WIP_VERSION=t.GAME_SUB_VERSION=t.GAME_VERSION=t.GAME_TITLE=t.DATA_ROOT=void 0,t.DATA_ROOT="",t.GAME_TITLE="Open Sonic",t.GAME_VERSION=1,t.GAME_SUB_VERSION=1,t.GAME_WIP_VERSION=1,t.GAME_WEBSITE="http://opensnc.sourceforge.net",t.EPSILON=1e-5,t.INFINITY=1<<30,t.INFINITY_FLT=1/0,t.INT_MAX=999999999,t.PI=Math.PI,t.IF_NONE=0,t.IF_HFLIP=!0,t.IF_VFLIP=!0},5443:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hashtable_music_t_add=t.hashtable_music_t_create=t.hashtable_sound_t_find=t.hashtable_sound_t_add=t.hashtable_sound_t_create=t.hashtable_image_t_add=t.hashtable_image_t_create=t.hashtable_sprites=t.hashtable_spriteinfo_t_find=t.hashtable_spriteinfo_t_add=t.hashtable_spriteinfo_t_create=void 0;var n={};t.hashtable_spriteinfo_t_create=function(){return n.sprites={},n.sprites},t.hashtable_spriteinfo_t_add=function(e,t,a){n.sprites[t]=a},t.hashtable_spriteinfo_t_find=function(e,t){return console.log(n.sprites,t),n.sprites[t]},t.hashtable_sprites=function(){return n.sprites},t.hashtable_image_t_create=function(){return n.images={},n.images},t.hashtable_image_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_create=function(){return n.samples={},n.samples},t.hashtable_sound_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_find=function(e,t){return n.samples[t]},t.hashtable_music_t_create=function(){return n.musics={},n.musics},t.hashtable_music_t_add=function(e,t,n){e[t]=n}},7709:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.image_destroy=t.image_pixelperfect_collision=t.image_clear=t.image_rgb=t.image_putpixel=t.image_blit=t.image_draw=t.image_rectfill=t.image_load=t.image_create=t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=void 0;var a=n(642);t.IF_NONE=0,t.IF_HFLIP=1,t.IF_VFLIP=2;var o={};t.image_create=function(e,t){return(0,a.video_get_backbuffer)().createImageData(e,t)},t.image_load=function(e){return new Promise((function(t,n){if(o[e])return t(o[e]);var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return o[e]=a,t(a)}))}))},t.image_rectfill=function(e,t,n,a,o,i){e.fillStyle=i,e.fillRect(t,n,a-t,o-n)},t.image_draw=function(e,t,n,a){t.putImageData(e,n,a)},t.image_blit=function(e,t,n,a,o,i,r,_){if(!e||!t)return!1;t.drawImage(e,n,a,r,_,o,i,r,_)},t.image_putpixel=function(e,t,n,a,o){t.fillStyle=o,t.fillRect(n,a,n+1,a+1)},t.image_rgb=function(e,t,n){return"rgb(".concat(e,", ").concat(t,", ").concat(n,")")},t.image_clear=function(e,t,n,a){for(var o=0;o<e.data.length;o+=4)e.data[o]=t,e.data[o+1]=n,e.data[o+2]=a},t.image_pixelperfect_collision=function(e,t,n,a,o,i){return!0},t.image_destroy=function(e){e&&(e.data,e=null)}},7774:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.input_ignore=t.input_simulate_button_down=t.input_button_howlong=t.input_button_up=t.input_button_pressed=t.input_button_down=t.input_destroy=t.input_create_user=t.input_create_joystick=t.input_create_mouse=t.input_create_keyboard=t.input_create_computer=t.input_is_joystick_ignored=t.input_ignore_joystick=t.input_joystick_available=t.input_release=t.input_render=t.input_update=t.input_init=t.KEY_P=t.KEY_G=t.KEY_Y=t.KEY_Z=t.KEY_A=t.KEY_D=t.KEY_S=t.KEY_W=t.KEY_B=t.KEY_N=t.KEY_F12=t.KEY_TILDA=t.KEY_ESC=t.KEY_ENTER=t.KEY_LCONTROL=t.KEY_SPACE=t.KEY_LEFT=t.KEY_RIGHT=t.KEY_DOWN=t.KEY_UP=t.input_device_t=t.IB_FIRE5=t.IB_FIRE4=t.IB_FIRE3=t.IB_FIRE2=t.IB_FIRE1=t.IB_RIGHT=t.IB_LEFT=t.IB_DOWN=t.IB_UP=t.inputbutton_t=void 0,t.input_get_xy=t.input_clear=t.input_is_ignored=t.input_restore=void 0;var a,o,i=n(7898),r=n(5823),_=n(4163),s=n(2878),c=n(642),d=n(794);!function(e){e[e.IB_UP=1]="IB_UP",e[e.IB_DOWN=2]="IB_DOWN",e[e.IB_RIGHT=3]="IB_RIGHT",e[e.IB_LEFT=4]="IB_LEFT",e[e.IB_FIRE1=5]="IB_FIRE1",e[e.IB_FIRE2=6]="IB_FIRE2",e[e.IB_FIRE3=7]="IB_FIRE3",e[e.IB_FIRE4=8]="IB_FIRE4",e[e.IB_FIRE5=9]="IB_FIRE5"}(a||(t.inputbutton_t=a={})),t.IB_UP=a.IB_UP,t.IB_DOWN=a.IB_DOWN,t.IB_LEFT=a.IB_LEFT,t.IB_RIGHT=a.IB_RIGHT,t.IB_FIRE1=a.IB_FIRE1,t.IB_FIRE2=a.IB_FIRE2,t.IB_FIRE3=a.IB_FIRE3,t.IB_FIRE4=a.IB_FIRE4,t.IB_FIRE5=a.IB_FIRE5,function(e){e[e.IT_KEYBOARD=1]="IT_KEYBOARD",e[e.IT_MOUSE=2]="IT_MOUSE",e[e.IT_COMPUTER=3]="IT_COMPUTER",e[e.IT_JOYSTICK=4]="IT_JOYSTICK",e[e.IT_USER=5]="IT_USER"}(o||(t.input_device_t=o={})),t.KEY_UP=38,t.KEY_DOWN=40,t.KEY_RIGHT=39,t.KEY_LEFT=37,t.KEY_SPACE=32,t.KEY_LCONTROL=17,t.KEY_ENTER=13,t.KEY_ESC=27,t.KEY_TILDA=192,t.KEY_F12=123,t.KEY_N=78,t.KEY_B=66,t.KEY_W=87,t.KEY_S=83,t.KEY_D=68,t.KEY_A=65,t.KEY_Z=90,t.KEY_Y=89,t.KEY_G=71,t.KEY_P=80;var l=null,u=!1,p=!1,f=!1,g={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},m=null,v=null,h=null,b=null,y=null,E=null,I=null,x=null,w={x:0,y:0},S={left:!1,middle:!1,right:!1};t.input_init=function(){(0,i.logfile_message)("input_init()"),l=null,(0,c.video_get_canvas)().addEventListener("contextmenu",(function(e){if(2===e.button)return e.preventDefault(),!1}),!1),(0,c.video_get_canvas)().addEventListener("mousemove",(function(e){w=(0,c.video_getMousePos)((0,c.video_get_canvas)(),e)}),!1),(0,c.video_get_canvas)().addEventListener("mousedown",(function(e){switch(e.which){case 1:S.left=!0;break;case 2:S.middle=!0;break;case 3:S.right=!0}}),!1),(0,c.video_get_canvas)().addEventListener("mouseup",(function(e){switch(e.which){case 1:S.left=!1;break;case 2:S.middle=!1;break;case 3:S.right=!1}}),!1),u=!1,p=!1,I=(0,r.osspec_canGamepad)(),console.log("canGamepad",I),(f=(0,r.osspec_isTouch)())&&(console.log("21111",(0,c.video_get_canvas)()),(h=new d.default({container:(0,c.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2||t.pageY<window.innerHeight/2)})),(b=new d.default({container:(0,c.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY<window.innerHeight/2)})),(y=new d.default({container:(0,c.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2||t.pageY>window.innerHeight/2)})),(E=new d.default({container:(0,c.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY>window.innerHeight/2)}))),m=R(g)},t.input_update=function(){var e,n,a=(0,_.timer_get_delta)();for(n=l;n;n=n.next){for(e=0;e<9;e++)n.data.oldstate[e]=n.data.state[e];for(e=0;e<9;e++)(0,t.input_button_down)(n.data,e)?n.data.howlong[e]+=a:n.data.howlong[e]=0;switch(n.data.type){case o.IT_KEYBOARD:n.data.state[t.IB_UP]=m.up,n.data.state[t.IB_DOWN]=m.down,n.data.state[t.IB_LEFT]=m.left,n.data.state[t.IB_RIGHT]=m.right,n.data.state[t.IB_FIRE1]=m.space,n.data.state[t.IB_FIRE2]=m.lcontrol,n.data.state[t.IB_FIRE3]=m.enter,n.data.state[t.IB_FIRE4]=m.esc,n.data.state[t.IB_FIRE5]=m.tilda;break;case o.IT_MOUSE:n.data.x=w.x,n.data.y=w.y,n.data.state[t.IB_FIRE1]=S.left,n.data.state[t.IB_FIRE3]=S.middle,n.data.state[t.IB_FIRE2]=S.right;break;case o.IT_COMPUTER:for(e=0;e<9;e++)n.data.state[e]=!1;break;case o.IT_JOYSTICK:(0,t.input_joystick_available)()&&(n.data.state[t.IB_UP]=v[0].stick[0].axis[1].d1,n.data.state[t.IB_DOWN]=v[0].stick[0].axis[1].d2,n.data.state[t.IB_LEFT]=v[0].stick[0].axis[0].d1,n.data.state[t.IB_RIGHT]=v[0].stick[0].axis[0].d2,n.data.state[t.IB_FIRE1]=v[0].button[0].b,n.data.state[t.IB_FIRE2]=v[0].button[1].b,n.data.state[t.IB_FIRE3]=v[0].button[2].b,n.data.state[t.IB_FIRE4]=v[0].button[3].b);break;case o.IT_USER:n.data.state[t.IB_UP]=m.up,n.data.state[t.IB_DOWN]=m.down,n.data.state[t.IB_LEFT]=m.left,n.data.state[t.IB_RIGHT]=m.right,n.data.state[t.IB_FIRE1]=m.space,n.data.state[t.IB_FIRE2]=m.lcontrol,n.data.state[t.IB_FIRE3]=m.enter,n.data.state[t.IB_FIRE4]=m.esc,f&&(n.data.state[t.IB_UP]=h.up(),n.data.state[t.IB_DOWN]=h.down(),n.data.state[t.IB_LEFT]=h.left(),n.data.state[t.IB_RIGHT]=h.right(),n.data.state[t.IB_FIRE1]=b._pressed,n.data.state[t.IB_FIRE4]=y._pressed,n.data.state[t.IB_FIRE2]=E._pressed),I&&(x=L()),x&&(n.data.state[t.IB_UP]=x.buttons[12].pressed,n.data.state[t.IB_DOWN]=x.buttons[13].pressed,n.data.state[t.IB_LEFT]=x.buttons[14].pressed,n.data.state[t.IB_RIGHT]=x.buttons[15].pressed,n.data.state[t.IB_FIRE1]=x.buttons[0].pressed,n.data.state[t.IB_FIRE2]=x.buttons[1].pressed,n.data.state[t.IB_FIRE3]=x.buttons[2].pressed,n.data.state[t.IB_FIRE4]=x.buttons[3].pressed)}}},t.input_render=function(){h&&h.render((0,c.video_get_backbuffer)()),b&&b.render((0,c.video_get_backbuffer)()),y&&y.render((0,c.video_get_backbuffer)()),E&&E.render((0,c.video_get_backbuffer)())},t.input_release=function(){},t.input_joystick_available=function(){return u&&!p},t.input_ignore_joystick=function(e){p=e},t.input_is_joystick_ignored=function(){return p},t.input_create_computer=function(){for(var e={type:o.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return k(e),e},t.input_create_keyboard=function(e){for(var n={type:o.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},a=0;a<9;a++)n.state[a]=n.oldstate[a]=!1,n.howlong[a]=0;if(e)for(n.keybmap=[],a=0;a<9;a++)n.keybmap[a]=e[a];else n.keybmap[t.IB_UP]=t.KEY_UP,n.keybmap[t.IB_DOWN]=t.KEY_DOWN,n.keybmap[t.IB_RIGHT]=t.KEY_RIGHT,n.keybmap[t.IB_LEFT]=t.KEY_LEFT,n.keybmap[t.IB_FIRE1]=t.KEY_SPACE,n.keybmap[t.IB_FIRE2]=t.KEY_LCONTROL,n.keybmap[t.IB_FIRE3]=t.KEY_ENTER,n.keybmap[t.IB_FIRE4]=t.KEY_ESC,n.keybmap[t.IB_FIRE5]=t.KEY_TILDA;return k(n),n},t.input_create_mouse=function(){for(var e={type:o.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return k(e),e},t.input_create_joystick=function(){if(!(0,t.input_joystick_available)())return(0,i.logfile_message)("WARNING: called input_create_joystick(), but no joystick is available!"),null;for(var e={type:o.IT_JOYSTICK,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;return k(e),e},t.input_create_user=function(){for(var e={type:o.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;return e.keybmap=[],e.keybmap[t.IB_UP]=t.KEY_UP,e.keybmap[t.IB_DOWN]=t.KEY_DOWN,e.keybmap[t.IB_RIGHT]=t.KEY_RIGHT,e.keybmap[t.IB_LEFT]=t.KEY_LEFT,e.keybmap[t.IB_FIRE1]=t.KEY_SPACE,e.keybmap[t.IB_FIRE2]=t.KEY_LCONTROL,e.keybmap[t.IB_FIRE3]=t.KEY_ENTER,e.keybmap[t.IB_FIRE4]=t.KEY_ESC,k(e),e},t.input_destroy=function(e){O(e),e=null},t.input_button_down=function(e,t){return!!t&&!!e.enabled&&e.state[t]},t.input_button_pressed=function(e,t){return!!t&&!!e.enabled&&e.state[t]&&!e.oldstate[t]},t.input_button_up=function(e,t){return!t||!!e.enabled&&!e.state[t]&&e.oldstate[t]},t.input_button_howlong=function(e,t){return e.enabled?e.howlong[t]:0},t.input_simulate_button_down=function(e,t){e.state[t]=!0},t.input_ignore=function(e){e.enabled=!1},t.input_restore=function(e){e.enabled=!0},t.input_is_ignored=function(e){return!e.enabled},t.input_clear=function(e){for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1},t.input_get_xy=function(e){return(0,s.v2d_new)(e.x,e.y)};var k=function(e){l={data:e,next:l}},O=function(e){var t,n;if(l.data==e)n=l.next,l=null,l=n;else{for(t=l;t.next&&t.next.data!=e;)t=t.next;t.next&&(n=t.next.next,t.next=null,t.next=n)}},R=function(e){var t=Object.create(null);function n(n){if(e.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;t[e[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),t},L=function(){return"undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)}},6038:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lang_get=t.lang_getstring=t.lang_loadfile=t.lang_release=t.lang_init=void 0;var a=n(7898),o=n(3450),i="data/languages/english.json",r={};t.lang_init=function(e,n){(0,a.logfile_message)("Initializing the language module"),i=e||i,(0,t.lang_loadfile)(i).then((function(){(0,a.logfile_message)("lang_init() ok!"),n()}))},t.lang_release=function(){},t.lang_loadfile=function(e){return new Promise((function(t,n){(0,a.logfile_message)('lang_loadfile("%s")... '.concat(e)),(0,o.resourcemanager_getJsonFile)(e).then((function(e){r=e,t(e)}))}))},t.lang_getstring=function(e){return r[e]||e},t.lang_get=function(e){return(0,t.lang_getstring)(e)}},7898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logfile_fatal_error=t.logfile_message=void 0,t.logfile_message=function(e){console.log(e)},t.logfile_fatal_error=function(e){console.log("FATAL ERROR",e)}},5823:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.osspec_canGamepad=t.osspec_isTouch=void 0,t.osspec_isTouch=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},t.osspec_canGamepad=function(){return"undefined"!=typeof navigator&&"getGamepads"in navigator}},5286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.preferences_set_language=t.preferences_set_show_fps=t.preferences_set_smooth_graphics=t.preferences_set_fullscreen=t.preferences_set_video_resolution=t.preferences_get_language=t.preferences_get_show_fps=t.preferences_get_smooth_graphics=t.preferences_get_fullscreen=t.preferences_get_video_resolution=t.preferences_init=void 0;var a=n(7898),o={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""};t.preferences_init=function(){(0,a.logfile_message)("preferences_init()"),i()},t.preferences_get_video_resolution=function(){return o.video_resolution},t.preferences_get_fullscreen=function(){return o.fullscreen},t.preferences_get_smooth_graphics=function(){return o.smooth_graphics},t.preferences_get_show_fps=function(){return o.show_fps},t.preferences_get_language=function(){return o.language},t.preferences_set_video_resolution=function(e){o.video_resolution=e,r()},t.preferences_set_fullscreen=function(e){o.fullscreen=e,r()},t.preferences_set_smooth_graphics=function(e){o.smooth_graphics=e,r()},t.preferences_set_show_fps=function(e){o.show_fps=e,r()},t.preferences_set_language=function(e){o.language=e,r()};var i=function(){if(o.video_resolution="TINY",o.fullscreen=!1,o.smooth_graphics=!1,o.show_fps=!1,o.language="data/languages/english.json","undefined"!=typeof window)for(var e in o){var t=window.localStorage.getItem(e)?localStorage.getItem(e):o[e];"false"==t&&(t=!1),"true"==t&&(t=!0),o[e]=t}console.log("PREFERENCES",o)},r=function(){if(console.log("SAVE PREFERENCES"),"undefined"!=typeof window)for(var e in o)console.log("SAVE PREVERFENCE",e,o),o[e],window.localStorage.setItem(e,o[e])}},6093:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quest_unload=t.quest_load=void 0;var a=n(9386),o=n(7709),i=n(7898),r=n(3450);t.quest_load=function(e){return new Promise((function(t,n){var a={file:e,name:"",author:"",version:"",description:"",image:null,level_count:0,levels:[],level_path:[],show_ending:!1};(0,i.logfile_message)("quest_load('%s') ".concat(e)),(0,r.resourcemanager_getJsonFile)(e).then(_).then((function(e){e&&(a=e),(0,i.logfile_message)("load_quest() ok!"),t(a)}))}))},t.quest_unload=function(e){return null};var _=function(e){return new Promise((function(t,n){var i,r={file:"",name:e.name||"",author:e.author||"Open Sonic",version:e.version||"0",description:e.description||"",show_ending:e.show_ending||!1,image:"",levels:e.levels||[],level_count:e.levels?e.levels.length:0,level_path:e.levels||[]};(i=e.image,new Promise((function(e,t){var n=i||"data/images/null.png";n=a.DATA_ROOT+n,(0,o.image_load)(n).then((function(t){e(t)}))}))).then((function(e){r.image=e,t(r)}))}))}},3450:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resourcemanager_add_music=t.resourcemanager_add_sample=t.resourcemanager_add_image=t.resourcemanager_init=t.resourcemanager_getJsonFile=t.resourcemanager_getJsonFiles=void 0;var a=n(9386),o=n(5443),i={},r={},_={},s={};t.resourcemanager_getJsonFiles=function(e){return Promise.all(e.map(t.resourcemanager_getJsonFile))},t.resourcemanager_getJsonFile=function(e){return e=a.DATA_ROOT+e,new Promise((function(t,n){if(s[e])t(s[e]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(t){console.log("error parsing json",e)}s[e]=n,t(n)}},a.send(null)}}))},t.resourcemanager_init=function(){i=(0,o.hashtable_image_t_create)(),r=(0,o.hashtable_sound_t_create)(),_=(0,o.hashtable_music_t_create)()},t.resourcemanager_add_image=function(e,t){(0,o.hashtable_image_t_add)(i,e,t)},t.resourcemanager_add_sample=function(e,t){(0,o.hashtable_sound_t_add)(r,e,t)},t.resourcemanager_add_music=function(e,t){(0,o.hashtable_music_t_add)(_,e,t)}},2667:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scenestack_empty=t.scenestack_top=t.scenestack_pop=t.scenestack_push=t.scenestack_release=t.scenestack_init=void 0;var n=[],a=0;t.scenestack_init=function(){a=0;for(var e=0;e<16;e++)n[e]=null},t.scenestack_release=function(){for(;!(0,t.scenestack_empty)();)(0,t.scenestack_pop)()},t.scenestack_push=function(e){n[a++]=e,e&&e.init()},t.scenestack_pop=function(){n[a-1].release(),n[a-1]=null,a--},t.scenestack_top=function(){return n[a-1]},t.scenestack_empty=function(){return 0===a}},1817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.screenshot_release=t.screenshot_update=t.screenshot_init=void 0,t.screenshot_init=function(){},t.screenshot_update=function(){},t.screenshot_release=function(){}},4470:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundfactory_get=t.soundfactory_release=t.soundfactory_init=void 0;var a=n(9931),o=n(5443),i=n(7898),r=n(3450),_={};t.soundfactory_init=function(){s()},t.soundfactory_release=function(){},t.soundfactory_get=function(e){var t=(0,o.hashtable_sound_t_find)(_,e);return(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"2"),(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"3"),(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"4")))),t};var s=function(){(0,i.logfile_message)("soundfactory: loading the samples table..."),(0,r.resourcemanager_getJsonFile)("data/config/samples.json").then((function(e){c(e)}))},c=function(e){for(var t in e)_[t]=d(t,e[t])},d=function(e,t){var n=l();return n.data=(0,a.sound_load)(e,t),n.data2=(0,a.sound_load)(e,t),n},l=function(){return{data:null,data2:null}}},9880:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sprite_info_destroy=t.sprite_create=t.sprite_get_image=t.sprite_get_animation=t.sprite_init=void 0;var a=n(9386),o=n(5443),i=n(7709),r=n(7898),_=n(3450),s=n(2878),c=n(642),d={},l=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],u=0,p=[];t.sprite_init=function(){return new Promise((function(e,t){var n;for((0,r.logfile_message)("Loading sprites..."),d=(0,o.hashtable_spriteinfo_t_create)(),n=0;n<l.length;n++)l[n]="data/sprites/"+l[n]+".json";(0,c.video_renderLoading)("Loading...",0),(0,_.resourcemanager_getJsonFiles)(l).then((function(t){for(console.log("GOT ALL SPRITE JSON FILES"),n=0;n<t.length;n++)for(var a in t[n])t[n][a].name=a,p.push(t[n][a]);y(p).then((function(){(0,r.logfile_message)("All sprites have been loaded!"),d=(0,o.hashtable_sprites)(),e(d)}))}))}))},t.sprite_get_animation=function(e,t){var n;return null!=(n=d[e])?n.animation_data[t]:null},t.sprite_get_image=function(e,t){return e?e.frame_data[e.data[t]]:0},t.sprite_create=function(e){return new Promise((function(t,n){g(e).then(t)}))},t.sprite_info_destroy=function(e){var t;if(null!=e.source_file&&(e.source_file=null),null!=e.frame_data){for(t=0;t<e.frame_count;t++)(0,i.image_destroy)(e.frame_data[t]);e.frame_data=null}if(null!=e.animation_data){for(t=0;t<e.animation_count;t++)e.animation_data[t]=f(e.animation_data[t]);e.animation_data=null}e=null};var f=function(e){return null!=e&&(null!=e.data&&(e.data=null),e=null),null},g=function(e){return new Promise((function(t,n){var a=m(),o=E(a,e);o=function(e){var t,n,a;for((e.frame_w>e.rect_w||e.frame_h>e.rect_h)&&(e.frame_w=Math.min(e.frame_w,e.rect_w),e.frame_h=Math.min(e.frame_h,e.rect_h)),(e.rect_w%e.frame_w>0||e.rect_h%e.frame_h>0)&&(e.rect_w=e.rect_w%e.frame_w>0?e.rect_w-e.rect_w%e.frame_w+e.frame_w:e.rect_w,e.rect_h=e.rect_h%e.frame_h>0?e.rect_h-e.rect_h%e.frame_h+e.frame_h:e.rect_h),a=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),t=0;t<e.animation_count;t++)for(n=0;n<e.animation_data[t].frame_count;n++)e.animation_data[t].data[n]>=0&&e.animation_data[t].data[n]<a||(e.animation_data[t].data[n]=Math.min(e.animation_data[t].data[n],0,a-1));return e}(o),v(o).then((function(n){o=b(n),x(e.name,o),u++,(0,c.video_renderLoading)("Loading...",u/p.length),t(o)}))}))},m=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:(0,s.v2d_new)(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},v=function(e){return new Promise((function(t,n){(0,i.image_load)(e.source_file).then((function(n){e.frame_count=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),e.frame_data=[],e=h(e,n),t(e)}))}))},h=function(e,t){for(var n=0,a=0,o=0;o<e.frame_count;o++)e.frame_data[o]={data:t,sx:n+e.rect_x,sy:a+e.rect_y,swidth:e.frame_w,sheight:e.frame_h,x:0,y:0,width:e.frame_w,height:e.frame_h},(n+=e.frame_w)>=e.rect_w&&(n=0,a+=e.frame_h);return e},b=function(e){for(var t=0;t<e.animation_count;t++)e.animation_data[t].frame_data=e.frame_data,e.animation_data[t].hot_spot=e.hot_spot;return e},y=function(e){return Promise.all(e.map(g))},E=function(e,t){if(e.source_file=a.DATA_ROOT+t.source_file,e.rect_x=t.source_rect.xpos,e.rect_y=t.source_rect.ypos,e.rect_w=t.source_rect.width,e.rect_h=t.source_rect.height,e.frame_w=t.frame_size.width,e.frame_h=t.frame_size.height,t.hot_spot&&(e.hot_spot.x=t.hot_spot.xpos,e.hot_spot.y=t.hot_spot.ypos),t.animations){e.animation_count=t.animations.length;for(var n=0;n<e.animation_count;n++)e.animation_data[n]=I(w(),t.animations[n]),0==e.animation_data[n].frame_count&&(0,r.logfile_message)("Animation error: invalid 'data' field. You must specify the frames of the animations")}return e},I=function(e,t){return e.repeat=t.repeat,e.fps=t.fps,e.data=t.data,e.frame_count=t.data.length,e},x=function(e,t){(0,o.hashtable_spriteinfo_t_add)((0,o.hashtable_sprites)(),e,t)},w=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:(0,s.v2d_new)(0,0),frame_data:null}}},532:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storyboard_get_scene=t.storyboard_release=t.storyboard_init=t.SCENE_STAGESELECT=t.SCENE_OPTIONS=t.SCENE_CREDITS=t.SCENE_LANGSELECT=t.SCENE_CONFIRMBOX=t.SCENE_QUESTOVER=t.SCENE_MENU=t.SCENE_ENDOFDEMO=t.SCENE_QUEST=t.SCENE_GAMEOVER=t.SCENE_PAUSE=t.SCENE_LEVEL=t.SCENE_INTRO=void 0;var a=n(5858),o=n(2930),i=n(2318),r=n(6698),_=n(2342),s=n(5316),c=n(4054),d=n(4344),l=n(3494),u=n(3985),p=n(7307),f=n(7504),g=n(9879);t.SCENE_INTRO=0,t.SCENE_LEVEL=1,t.SCENE_PAUSE=2,t.SCENE_GAMEOVER=3,t.SCENE_QUEST=4,t.SCENE_ENDOFDEMO=5,t.SCENE_MENU=6,t.SCENE_QUESTOVER=7,t.SCENE_CONFIRMBOX=8,t.SCENE_LANGSELECT=9,t.SCENE_CREDITS=10,t.SCENE_OPTIONS=11,t.SCENE_STAGESELECT=12;var m=[];t.storyboard_init=function(){for(var e=0;e<256;e++)m[e]=null;m[t.SCENE_LEVEL]=v(c.level_init,c.level_update,c.level_render,c.level_release),m[t.SCENE_PAUSE]=v(u.pause_init,u.pause_update,u.pause_render,u.pause_release),m[t.SCENE_GAMEOVER]=v(r.gameover_init,r.gameover_update,r.gameover_render,r.gameover_release),m[t.SCENE_QUEST]=v(p.quest_init,p.quest_update,p.quest_render,p.quest_release),m[t.SCENE_MENU]=v(d.menu_init,d.menu_update,d.menu_render,d.menu_release),m[t.SCENE_INTRO]=v(_.intro_init,_.intro_update,_.intro_render,_.intro_release),m[t.SCENE_ENDOFDEMO]=v(i.endofdemo_init,i.endofdemo_update,i.endofdemo_render,i.endofdemo_release),m[t.SCENE_QUESTOVER]=v(f.questover_init,f.questover_update,f.questover_render,f.questover_release),m[t.SCENE_CONFIRMBOX]=v(a.confirmbox_init,a.confirmbox_update,a.confirmbox_render,a.confirmbox_release),m[t.SCENE_LANGSELECT]=v(s.langselect_init,s.langselect_update,s.langselect_render,s.langselect_release),m[t.SCENE_CREDITS]=v(o.credits_init,o.credits_update,o.credits_render,o.credits_release),m[t.SCENE_OPTIONS]=v(l.options_init,l.options_update,l.options_render,l.options_release),m[t.SCENE_STAGESELECT]=v(g.stageselect_init,g.stageselect_update,g.stageselect_render,g.stageselect_release)},t.storyboard_release=function(){for(var e=0;e<256;e++)m[e]&&h(m[e])},t.storyboard_get_scene=function(e){return console.log("GET SCENE",e),m[e]};var v=function(e,t,n,a){return{init:e,update:t,render:n,release:a}},h=function(e){}},4163:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timer_get_fps=t.timer_get_ticks=t.timer_get_delta=t.timer_release=t.timer_update=t.timer_init=void 0;var a=n(7898),o=0,i=0,r=0,_=0,s=0,c=0;t.timer_init=function(){(0,a.logfile_message)("timer_init()"),o=0,i=0,r=0,s=0,_=(0,t.timer_get_ticks)()},t.timer_update=function(){var e=0,n=0;for(n=0;n<10;)n=(e=(0,t.timer_get_ticks)())>_?e-_:0,_=e>=_?_:e;n=Math.min(n,16),s=.001*n,o++,(i+=n)>=1e3&&(r=o,o=0,i=0),_=(0,t.timer_get_ticks)()},t.timer_release=function(){(0,a.logfile_message)("timer_release()")},t.timer_get_delta=function(){return s},t.timer_get_ticks=function(){var e=d();return e<c&&(c=e),e-c},t.timer_get_fps=function(){return r};var d=function(){return Math.floor(Date.now())}},2954:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.old_school_angle=t.swap=t.circular_collision=t.bounding_box=t.clip=t.random=t.isInArray=t.isArray=t.isspace=t.runAnimation=void 0;var a=n(9386),o=n(2878);t.runAnimation=function(e){var t=null;requestAnimationFrame((function n(a){var o=!1;if(null!=t){var i=Math.min(a-t,100)/1e3;o=!1===e(i)}t=a,o||requestAnimationFrame(n)}))},t.isspace=function(e){return" "==e},t.isArray=function(e){return void 0!==e&&e&&e.constructor===Array},t.isInArray=function(e,t){return t.indexOf(e)>-1},t.random=function(e){return(0,t.clip)(Math.random()*e,1,e)},t.clip=function(e,t,n){return Math.min(Math.max(e,t),n)},t.bounding_box=function(e,t){return e[0]<t[2]&&e[2]>t[0]&&e[1]<t[3]&&e[3]>t[1]},t.circular_collision=function(e,t,n,a){return(0,o.v2d_magnitude)((0,o.v2d_subtract)(e,n))<=t+a},t.swap=function(e,t){return i(e,t,e.length)},t.old_school_angle=function(e){return e>=0&&e<a.PI/4-a.EPSILON?0:e>=a.PI/4-a.EPSILON&&e<a.PI/2-a.EPSILON?a.PI/4:e>=a.PI/2-a.EPSILON&&e<a.PI/2+a.EPSILON?a.PI/2:e>=a.PI/2+a.EPSILON&&e<a.PI-a.EPSILON?3*a.PI/4:e>=a.PI-a.EPSILON&&e<a.PI+a.EPSILON?a.PI:e>=a.PI+a.EPSILON&&e<3*a.PI/2-a.EPSILON?5*a.PI/4:e>=3*a.PI/2-a.EPSILON&&e<3*a.PI/2+a.EPSILON?3*a.PI/2:e>3*a.PI/2+a.EPSILON&&e<=7*a.PI/4+a.EPSILON?7*a.PI/4:0};var i=function(e,t,n){var a,o,i=e,r=t;for(a=0;a<n;a++)o=i[a],i[a]=r[a],r[a]=o;return[i[a],r[a]]}},2878:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.v2d_lerp=t.v2d_normalize=t.v2d_rotate=t.v2d_dotproduct=t.v2d_magnitude=t.v2d_multiply=t.v2d_subtract=t.v2d_add=t.v2d_new=void 0;var a=n(9386),o=n(2954);t.v2d_new=function(e,t){return{x:e,y:t}},t.v2d_add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},t.v2d_subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.v2d_multiply=function(e,t){return{x:t*e.x,y:t*e.y}},t.v2d_magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.v2d_dotproduct=function(e,t){return e.x*t.x+e.y*t.y},t.v2d_rotate=function(e,t){var n=e.x,a=e.y;return{x:n*Math.cos(t)-a*Math.sin(t),y:a*Math.cos(t)+n*Math.sin(t)}},t.v2d_normalize=function(e){var n=(0,t.v2d_magnitude)(e);return n>a.EPSILON?(0,t.v2d_new)(e.x/n,e.y/n):(0,t.v2d_new)(0,0)},t.v2d_lerp=function(e,n,a){var i=(0,o.clip)(a,0,1),r=1-i;return(0,t.v2d_new)(e.x*r+n.x*i,e.y*r+n.y*i)}},642:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.video_getMousePos=t.video_get_window_size=t.video_changemode=t.video_show_fps=t.video_is_fps_visible=t.video_is_fullscreen=t.video_is_smooth=t.video_get_resolution=t.video_get_backbuffer=t.video_get_canvas=t.video_getCameraY=t.video_getCameraX=t.video_setCameraY=t.video_setFlipX=t.video_setCameraX=t.video_renderLoading=t.video_clearDisplay=t.video_fadefx_is_fading=t.video_fadefx_over=t.video_fadefx_out=t.video_fadefx_in=t.video_render=t.video_getScale=t.video_init=t.VIDEO_SCALE=t.VIDEO_SCREEN_H=t.VIDEO_SCREEN_W=t.VIDEORESOLUTION_EDT=t.VIDEORESOLUTION_MAX=t.VIDEORESOLUTION_2X=t.VIDEORESOLUTION_1X=void 0;var a,o,i,r,_=n(4163),s=n(2954),c=n(2878);t.VIDEORESOLUTION_1X=0,t.VIDEORESOLUTION_2X=1,t.VIDEORESOLUTION_MAX=2,t.VIDEORESOLUTION_EDT=3,t.VIDEO_SCREEN_W=480,t.VIDEO_SCREEN_H=271;var d,l,u,p,f,g=!1,m=!1,v=!1,h=0,b=0;t.VIDEO_SCALE=1;var y=1,E=1;t.video_init=function(e,n,r,_,s,c){(0,t.video_changemode)(n,r,_),(0,t.video_show_fps)(c),(a=document.getElementById("canvas"))?(o=a.getContext("2d"),y=a.width/t.VIDEO_SCREEN_W,E=a.height/t.VIDEO_SCREEN_H,o.scale(a.width/t.VIDEO_SCREEN_W,a.height/t.VIDEO_SCREEN_H)):(a=document.createElement("canvas"),o=a.getContext("2d"),a.width=t.VIDEO_SCREEN_W,a.height=t.VIDEO_SCREEN_H,document.body.appendChild(a)),y=t.VIDEO_SCREEN_W/window.innerWidth,E=y,o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,console.log("PIXEL RATIO",window.devicePixelRatio),console.log("VIDEO_SCREEN_W",t.VIDEO_SCREEN_W),console.log("VIDEO_SCREEN_H",t.VIDEO_SCREEN_H),console.log("CANVAS",a.width,a.height),console.log("WINDOW",window.innerWidth),console.log("SCALE",y),i=o,(0,t.video_clearDisplay)()},t.video_getScale=function(){return(0,c.v2d_new)(y,E)},t.video_render=function(){if(l=!1,0!=d)if((p+=(0,_.timer_get_delta)())<f){var e=void 0;e=1.25*p/f*100,e=(0,s.clip)(e,0,100),e=1==d?100-e:e,e/=100,(0,t.video_get_backbuffer)().fillStyle=u,(0,t.video_get_backbuffer)().globalAlpha=e,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)}else 2==d&&((0,t.video_get_backbuffer)().fillStyle=u,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)),d=0,f=p=0,u=null,l=!0;(0,t.video_get_backbuffer)().globalAlpha=1,(0,t.video_is_fps_visible)()&&((0,t.video_get_backbuffer)().font="14px Arial",(0,t.video_get_backbuffer)().fillStyle="white",(0,t.video_get_backbuffer)().fillText((0,_.timer_get_fps)(),t.VIDEO_SCREEN_W-30,20))},t.video_fadefx_in=function(e,t){0==d&&(d=1,l=!1,u=e,p=0,f=t)},t.video_fadefx_out=function(e,t){0==d&&(d=2,l=!1,u=e,p=0,f=t)},t.video_fadefx_over=function(){return l},t.video_fadefx_is_fading=function(){return 0!=d},t.video_clearDisplay=function(e){o.fillStyle=e||"rgb(0, 0, 0)",o.fillRect(0,0,a.width,a.height)},t.video_renderLoading=function(e,n){(0,t.video_clearDisplay)();var a=(0,t.video_get_backbuffer)();a.beginPath(),a.rect(130,t.VIDEO_SCREEN_H/2-20,210,20),a.fillStyle="black",a.fill(),a.lineWidth=1,a.strokeStyle="white",a.stroke(),n=n<1?0:n>202?202:202/n,a.beginPath(),a.rect(134,t.VIDEO_SCREEN_H/2-17,n,14),a.fillStyle="white",a.fill(),a.lineWidth=1,a.strokeStyle="black",a.stroke(),a.font="14px Arial",a.fillStyle="white",a.fillText(e,130,t.VIDEO_SCREEN_H/2-30)},t.video_setCameraX=function(e){return h=e},t.video_setFlipX=function(e){return e},t.video_setCameraY=function(e){return b=e},t.video_getCameraX=function(){return h},t.video_getCameraY=function(){return b},t.video_get_canvas=function(){return a},t.video_get_backbuffer=function(){return i},t.video_get_resolution=function(){return r},t.video_is_smooth=function(){return g},t.video_is_fullscreen=function(){return m},t.video_is_fps_visible=function(){return v},t.video_show_fps=function(e){v=e},t.video_changemode=function(e,t,n){r=e,m=n,g=t},t.video_get_window_size=function(){var e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;switch(r){case t.VIDEORESOLUTION_1X:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_2X:e=2*t.VIDEO_SCREEN_W,n=2*t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_MAX:case t.VIDEORESOLUTION_EDT:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H}return(0,c.v2d_new)(e,n)},t.video_getMousePos=function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}},3031:function(e,t,n){var a=this;Object.defineProperty(t,"__esModule",{value:!0}),t.actor_bullet_movement=t.actor_eightdirections_movement=t.actor_particle_movement=t.actor_platform_movement=t.actor_handle_acceleration=t.actor_handle_jumping=t.actor_handle_slopes=t.actor_handle_floor_collision=t.actor_handle_ceil_collision=t.actor_handle_wall_collision=t.actor_handle_carrying=t.actor_handle_collision_detectors=t.actor_handle_clouds=t.actor_get_collision_detectors=t.actor_corners_disable_detection=t.actor_corners_restore_slope_priority=t.actor_corners_set_slope_priority=t.actor_corners_restore_floor_priority=t.actor_corners_set_floor_priority=t.actor_corners_ex=t.actor_corners=t.actor_render_corners=t.actor_brick_collision=t.actor_pixelperfect_collision=t.actor_orientedbox_collision=t.actor_collision=t.actor_animation_finished=t.actor_change_animation=t.actor_change_animation_speed_factor=t.actor_change_animation_frame=t.actor_image=t.actor_move=t.actor_render_repeat_xy=t.actor_render=t.actor_destroy=t.actor_create=void 0;var o=n(9386),i=n(2878),r=n(7774),_=n(7709),s=n(642),c=n(4163),d=n(9880),l=n(2954),u=n(8707),p=.5,f=!0,g=!0,m=!1,v=!1,h=!1,b=!1;t.actor_create=function(){return{spawn_point:(0,i.v2d_new)(0,0),position:(0,i.v2d_new)(0,0),angle:0,speed:(0,i.v2d_new)(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:(0,i.v2d_new)(0,0),carried_by:null,carry_offset:(0,i.v2d_new)(0,0),carrying:null}},t.actor_destroy=function(e){e.input&&(0,r.input_destroy)(e.input),e=null},t.actor_render=function(e,n){var a;if(n&&e&&(e.visible&&e.animation)){if(e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,c.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),e.position,!(a=(0,t.actor_image)(e)))return!1;e.mirror&&I((0,s.video_get_backbuffer)(),e.position.x-(n.x-s.VIDEO_SCREEN_W/2));var o=e.position.x-(n.x-s.VIDEO_SCREEN_W/2),i=e.position.y-(n.y-s.VIDEO_SCREEN_H/2),r=e.mirror?e.angle:-e.angle;e.angle&&((0,s.video_get_backbuffer)().translate(o,i),(0,s.video_get_backbuffer)().rotate(r),(0,s.video_get_backbuffer)().translate(-o,-i)),(0,s.video_get_backbuffer)().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,~~(e.position.x-e.hot_spot.x-(n.x-s.VIDEO_SCREEN_W/2)),~~(e.position.y-e.hot_spot.y-(n.y-s.VIDEO_SCREEN_H/2)),a.width*s.VIDEO_SCALE,a.height*s.VIDEO_SCALE),e.angle&&((0,s.video_get_backbuffer)().translate(o,i),(0,s.video_get_backbuffer)().rotate(-r),(0,s.video_get_backbuffer)().translate(-o,-i)),e.mirror&&I((0,s.video_get_backbuffer)(),e.position.x-(n.x-s.VIDEO_SCREEN_W/2))}},t.actor_render_repeat_xy=function(e,n,a,r){var _=(0,i.v2d_new)(0,0);if(e.visible&&e.animation){isNaN(e.animation_frame)&&(e.animation_frame=0,e.animation.fps=1),e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,c.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1);var d=(0,t.actor_image)(e);if(!d)return!1;_.x=e.position.x%(a?d.width:o.INT_MAX)-e.hot_spot.x-(n.x-s.VIDEO_SCREEN_W/2)-(a?d.width:0),_.y=e.position.y%(r?d.height:o.INT_MAX)-e.hot_spot.y-(n.y-s.VIDEO_SCREEN_H/2)-(r?d.height:0);for(var l=a?s.VIDEO_SCREEN_W/d.width+3:1,u=r?s.VIDEO_SCREEN_H/d.height+3:1,p=0;p<l;p++)for(var f=0;f<u;f++)(0,s.video_get_backbuffer)().drawImage(d.data,d.sx,d.sy,d.swidth,d.sheight,_.x+p*d.width,_.y+f*d.height,d.width*s.VIDEO_SCALE,d.height*s.VIDEO_SCALE)}},t.actor_move=function(e,t){t||(t={x:0,y:0}),t.x=t.x||0,t.y=t.y||0,Math.abs(t.x)<o.EPSILON&&(t.x=0),e.position.x+=t.x*Math.cos(e.angle)+t.y*Math.sin(e.angle),e.position.y+=t.y*Math.cos(e.angle)-t.x*Math.sin(e.angle)},t.actor_image=function(e){return(0,d.sprite_get_image)(e.animation,~~e.animation_frame)},t.actor_change_animation_frame=function(e,t){return e.animation_frame=(0,l.clip)(t,0,e.animation.frame_count),e},t.actor_change_animation_speed_factor=function(e,t){return e.animation_speed_factor=Math.max(0,t),e},t.actor_change_animation=function(e,t){return!(!e||!t)&&(e.animation!=t&&(e.animation=t,e.hot_spot=t.hot_spot,e.animation_frame=0,e.animation_speed_factor=1),e)},t.actor_animation_finished=function(e){var t=e.animation_frame+e.animation.fps*e.animation_speed_factor*(0,c.timer_get_delta)();return!e.animation.repeat&&t>e.animation.frame_count-1},t.actor_collision=function(e,n){var a=0,r=[];if(r[0]=[(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0)],r[1]=[(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0),(0,i.v2d_new)(0,0)],r[0][0]=(0,i.v2d_subtract)(e.position,(0,i.v2d_rotate)(e.hot_spot,-e.angle)),r[0][1]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)((0,t.actor_image)(e).width,0),-e.angle)),r[0][2]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)((0,t.actor_image)(e).width,(0,t.actor_image)(e).height),-e.angle)),r[0][3]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)(0,(0,t.actor_image)(e).height),-e.angle)),r[1][0]=(0,i.v2d_subtract)(n.position,(0,i.v2d_rotate)(n.hot_spot,0)),r[1][1]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)((0,t.actor_image)(n).width,0),0)),r[1][2]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)((0,t.actor_image)(n).width,(0,t.actor_image)(n).height),0)),r[1][3]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)(0,(0,t.actor_image)(n).height),0)),(Math.abs(e.angle)<o.EPSILON||Math.abs(e.angle-o.PI/2)<o.EPSILON||Math.abs(e.angle-o.PI)<o.EPSILON||Math.abs(e.angle-3*o.PI/2)<o.EPSILON)&&a++,(Math.abs(n.angle)<o.EPSILON||Math.abs(n.angle-o.PI/2)<o.EPSILON||Math.abs(n.angle-o.PI)<o.EPSILON||Math.abs(n.angle-3*o.PI/2)<o.EPSILON)&&a++,a){for(var _=[],s=[],c=0;c<2;c++){_[c]=[];var d=Math.min(r[c][0].x,r[c][1].x),u=Math.min(r[c][0].y,r[c][1].y),p=Math.max(r[c][2].x,r[c][3].x),f=Math.max(r[c][2].y,r[c][3].y);_[c][0]=d,_[c][1]=u,_[c][2]=p,_[c][3]=f,d>p&&(s=(0,l.swap)(_[c][0],_[c][2]),_[c][0]=s[0],_[c][2]=s[1]),u>f&&(s=(0,l.swap)(_[c][1],_[c][3]),_[c][1]=s[0],_[c][3]=s[1])}return(0,l.bounding_box)(_[0],_[1])}var g=[],m=[Math.max((0,t.actor_image)(e).width,(0,t.actor_image)(e).height),Math.max((0,t.actor_image)(n).width,(0,t.actor_image)(n).height)];for(c=0;c<2;c++)g[c]=(0,i.v2d_multiply)((0,i.v2d_add)(r[c][0],r[c][2]),.5);return(0,l.circular_collision)(g[0],m[0],g[1],m[1])},t.actor_orientedbox_collision=function(e,t){var n=(0,i.v2d_new)(0,0),o=(0,i.v2d_new)(0,0),r=(0,i.v2d_new)(0,0),_=(0,i.v2d_new)(0,0),s=[],c=[];return s=E(a,e,s),c=E(a,t,c),n.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),n.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),o.x=Math.min(c[0].x,Math.min(c[1].x,Math.min(c[2].x,c[3].x))),o.y=Math.min(c[0].y,Math.min(c[1].y,Math.min(c[2].y,c[3].y))),r.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-n.x,r.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-n.y,_.x=Math.max(c[0].x,Math.max(c[1].x,Math.max(c[2].x,c[3].x)))-o.x,_.y=Math.max(c[0].y,Math.max(c[1].y,Math.max(c[2].y,c[3].y)))-o.y,n.x+r.x>=o.x&&n.x<=o.x+_.x&&n.y+r.y>=o.y&&n.y<=o.y+_.y},t.actor_pixelperfect_collision=function(e,n){var a,i,r,s;return Math.abs(e.angle)<o.EPSILON&&Math.abs(n.angle)<o.EPSILON?!!(0,t.actor_collision)(e,n)&&(a=e.position.x-e.hot_spot.x,i=e.position.y-e.hot_spot.y,r=n.position.x-n.hot_spot.x,s=n.position.y-n.hot_spot.y,(0,_.image_pixelperfect_collision)((0,t.actor_image)(e),(0,t.actor_image)(n),a,i,r,s)):!!(0,t.actor_orientedbox_collision)(e,n)},t.actor_brick_collision=function(e,n){var a=(0,i.v2d_subtract)(e.position,(0,i.v2d_rotate)(e.hot_spot,e.angle)),o=(0,i.v2d_add)(a,(0,i.v2d_rotate)((0,i.v2d_new)((0,t.actor_image)(e).w,(0,t.actor_image)(e).h),e.angle)),r=[a.x,a.y,o.x,o.y],_=[n.x,n.y,n.x+n.brick_ref.image.width,n.y+n.brick_ref.image.height];return(0,l.bounding_box)(r,_)},t.actor_render_corners=function(e,n,a,o){var r=[],c=(0,i.v2d_subtract)(o,(0,i.v2d_new)(s.VIDEO_SCREEN_W/2,s.VIDEO_SCREEN_H/2)),d=(0,t.actor_image)(e).width,l=(0,t.actor_image)(e).height,u=(0,i.v2d_subtract)(e.position,c),f=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(0,-l+a),-e.angle)),g=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(0,-a),-e.angle)),m=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(-d/2+a,-l*p),-e.angle)),v=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(d/2-a,-l*p),-e.angle)),h=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(-d/2+a,-l+a),-e.angle)),b=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(d/2-a,-l+a),-e.angle)),y=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(-d/2+a,-a),-e.angle)),E=(0,i.v2d_add)(u,(0,i.v2d_rotate)((0,i.v2d_new)(d/2-a,-a),-e.angle)),I=[f.x-n,f.y-n,f.x+n,f.y+n],x=[g.x-n,g.y-n,g.x+n,g.y+n],w=[m.x-n,m.y-n,m.x+n,m.y+n],S=[v.x-n,v.y-n,v.x+n,v.y+n],k=[h.x-n,h.y-n,h.x+n,h.y+n],O=[b.x-n,b.y-n,b.x+n,b.y+n],R=[y.x-n,y.y-n,y.x+n,y.y+n],L=[E.x-n,E.y-n,E.x+n,E.y+n];r[0]=(0,_.image_rgb)(255,255,255),r[1]=(0,_.image_rgb)(0,128,255),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),I[0],I[1],I[2],I[3],r[0]),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),x[0],x[1],x[2],x[3],r[0]),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),w[0],w[1],w[2],w[3],r[0]),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),S[0],S[1],S[2],S[3],r[0]),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),R[0],R[1],R[2],R[3],(0,_.image_rgb)(0,255,0)),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),L[0],L[1],L[2],L[3],(0,_.image_rgb)(255,0,0)),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),O[0],O[1],O[2],O[3],r[1]),(0,_.image_rectfill)((0,s.video_get_backbuffer)(),k[0],k[1],k[2],k[3],r[1])},t.actor_corners=function(e,n,a,o,r,_,s,c,d,l,u,f){var g=(0,t.actor_image)(e).width,m=(0,t.actor_image)(e).height,v=e.position,h=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(0,-m+a),-e.angle)),b=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(0,-a),-e.angle)),y=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(-g/2+a,-m*p),-e.angle)),E=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(g/2-a,-m*p),-e.angle)),I=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(-g/2+a,-m+a),-e.angle)),x=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(g/2-a,-m+a),-e.angle)),w=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(-g/2+a,-a),-e.angle)),S=(0,i.v2d_add)(v,(0,i.v2d_rotate)((0,i.v2d_new)(g/2-a,-a),-e.angle));return(0,t.actor_corners_ex)(e,n,h,x,E,S,b,w,y,I,o,r,_,s,c,d,l,u,f)},t.actor_corners_ex=function(e,t,n,a,o,i,r,_,s,c,d,l,u,p,f,g,m,v,h){var b=[n.x-t,n.y-t,n.x+t,n.y+t],E=[r.x-t,r.y-t,r.x+t,r.y+t],I=[s.x-t,s.y-t,s.x+t,s.y+t],x=[o.x-t,o.y-t,o.x+t,o.y+t],w=[c.x-t,c.y-t,c.x+t,c.y+t],S=[a.x-t,a.y-t,a.x+t,a.y+t],k=[_.x-t,_.y-t,_.x+t,_.y+t],O=[i.x-t,i.y-t,i.x+t,i.y+t];return d&&(n&&(l=y(d,b)),r&&(g=y(d,E)),s&&(v=y(d,I)),o&&(p=y(d,x)),c&&(h=y(d,w)),a&&(u=y(d,S)),_&&(m=y(d,k)),i&&(f=y(d,O))),{up:l,down:g,left:v,right:p,upleft:h,upright:u,downleft:m,downright:f}},t.actor_corners_set_floor_priority=function(e){f=e},t.actor_corners_restore_floor_priority=function(){(0,t.actor_corners_set_floor_priority)(!0)},t.actor_corners_set_slope_priority=function(e){g=e},t.actor_corners_restore_slope_priority=function(){(0,t.actor_corners_set_slope_priority)(!0)},t.actor_corners_disable_detection=function(e,t,n,a){m=e,v=t,h=n,b=a},t.actor_get_collision_detectors=function(e,n,a,r,_,s,c,d,l,u){var p,f,g,m=(0,t.actor_image)(e).width,v=(0,t.actor_image)(e).height,h=!(Math.abs(e.angle)<o.EPSILON||Math.abs(e.angle-o.PI/2)<o.EPSILON||Math.abs(e.angle-o.PI)<o.EPSILON||Math.abs(e.angle-3*o.PI/2)<o.EPSILON),b=e.position;return h?(p=1,f=.7,g=.25):(p=.7,f=.5,g=.25),{up:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(0,-v*p+n),-e.angle)),down:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(0,-n),-e.angle)),left:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(-m*g+n,-v*f),-e.angle)),right:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(m*g-n,-v*f),-e.angle)),upleft:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(-m*g+n,-v*p+n),-e.angle)),upright:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(m*g-n,-v*p+n),-e.angle)),downleft:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(-m*g+n,-n),-e.angle)),downright:(0,i.v2d_add)(b,(0,i.v2d_rotate)((0,i.v2d_new)(m*g-n,-n),-e.angle))}},t.actor_handle_clouds=function(e,t,n,a,o,i,r,_,s,c){var d,l=[n,a,o,s,c];for(d=0;d<l.length;d++){var p=l[d];p&&p.brick_ref&&p.brick_ref.property==u.BRK_CLOUD&&(p=null,l[d]=p)}if(r&&r.brick_ref&&r.brick_ref.property==u.BRK_CLOUD){var f=Math.min(15,r.brick_ref.image.height/3);e.speed.y>=0&&e.position.y<r.y+t+1+f||(_&&_==r&&(_=null),i&&i==r&&(i=null),r=null)}return{up:l[0],upright:l[1],right:l[2],left:l[3],upleft:l[4],downright:i,down:r,downleft:_}},t.actor_handle_collision_detectors=function(e,n,a,o,i,r,_,s,c,d,l,u,p,f,g,m,v,h){return(0,t.actor_corners_ex)(e,2,a,o,i,r,_,s,c,d,n,l,u,p,f,g,m,v,h)},t.actor_handle_carrying=function(e,t){var n=(0,c.timer_get_delta)();if(null!=e.carried_by){var a=e.carried_by;t&&0==t.brick_ref.angle&&a.speed.y>=5?(e.position=(0,i.v2d_new)(e.carried_by.position.x,e.carried_by.position.y),e.carried_by.carrying=null,e.carried_by=null):(e.speed=(0,i.v2d_new)(0,0),e.mirror=a.mirror,e.angle=0,e.position=(0,i.v2d_subtract)((0,i.v2d_add)(a.position,(0,i.v2d_multiply)(a.speed,n)),e.carry_offset))}},t.actor_handle_wall_collision=function(e,t,n,a,i,r){r&&r.brick_ref.angle%90==0&&(e.speed.x>o.EPSILON||a.x>r.x)&&(e.speed.x=0,e.position.x=r.x+(t.x-a.x)),i&&i.brick_ref.angle%90==0&&(e.speed.x<-o.EPSILON||n.x<i.x+i.brick_ref.image.width)&&(e.speed.x=0,e.position.x=i.x+i.brick_ref.image.width+(t.x-n.x))},t.actor_handle_ceil_collision=function(e,t,n,a){a&&a.brick_ref.angle%90==0&&e.speed.y<-o.EPSILON&&(e.position.y=a.y+a.brick_ref.image.height+(t.y-n.y),e.speed.y=10)},t.actor_handle_floor_collision=function(e,n,a,r,s,d,l,u,p){var f;if((0,c.timer_get_delta)(),u&&!e.is_jumping)if(f=u.brick_ref.angle,e.speed.y=r.y=0,e.angle=f*o.PI/180,0==f)e.position.y=s.y+n;else if(f>0&&f<90)console.log("brick_ref",u.brick_ref),s.y=u.y+u.brick_ref.image.height-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=s.y+n,e.mirror,_.IF_HFLIP;else if(90==f){if(Math.abs(e.speed.x)>5){var g=p?p.brick_ref.angle:-1;p&&g>=f&&g<f+90?(s.y=u.x,e.position.x=s.y+n):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(6.5*n,0)),e.is_jumping=!0,e.speed=(0,i.v2d_new)(0,-.7*Math.abs(e.speed.x)))}else e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(5*n,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,_.IF_HFLIP}else f>90&&f<180?Math.abs(e.speed.x)>5?(s.y=u.y-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=s.y-n):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(0,-15*n)),e.is_jumping=!0):180==f?e.speed.x>5&&!(e.mirror&_.IF_HFLIP)||e.speed.x<-5&&e.mirror&_.IF_HFLIP?(s.y=u.y+u.brick_ref.image.height,e.position.y=s.y-n):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(0,-20*n)),e.is_jumping=!0,e.speed.x=0):f>180&&f<270?Math.abs(e.speed.x)>5?(s.y=u.y+u.brick_ref.image.height-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=s.y-n):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(0,-15*n)),e.is_jumping=!0):270==f?(Math.abs(e.speed.x)>5?(g=l?l.brick_ref.angle:-1,l&&g>f-90&&g<=f?(s.y=u.x+u.brick_ref.image.width,e.position.x=s.y-n):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(-6.5*n,0)),e.is_jumping=!0,e.speed=(0,i.v2d_new)(0,-.7*Math.abs(e.speed.x)))):(e.angle=a,(0,t.actor_move)(e,(0,i.v2d_new)(-5*n,0)),e.is_jumping=!0,e.ignore_horizontal=!1),e.mirror,_.IF_HFLIP):f>270&&f<360&&(s.y=u.y-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=s.y+n,e.mirror,_.IF_HFLIP)},t.actor_handle_slopes=function(e,t){var n,a,i=t.brick_ref.angle,r=(0,c.timer_get_delta)();e.is_jumping||(i>0&&i<90?(n=Math.min(1,Math.tan(i*o.PI/180)),Math.abs(e.speed.y)>o.EPSILON?e.speed.x=-3*n*e.speed.y:(a=(e.mirror&_.IF_HFLIP?2:.8)*n,e.speed.x=Math.max(e.speed.x-a*e.acceleration*r,-e.maxspeed))):i>270&&i<360&&(n=Math.min(1,-Math.tan(i*o.PI/180)),Math.abs(e.speed.y)>o.EPSILON?e.speed.x=3*n*e.speed.y:(a=(e.mirror&_.IF_HFLIP?.8:2)*n,e.speed.x=Math.min(e.speed.x+a*e.acceleration*r,e.maxspeed))))},t.actor_handle_jumping=function(e,n,a,o,_){var s=o.brick_ref.angle;!(0,r.input_button_down)(e.input,r.IB_FIRE1)||(0,r.input_button_down)(e.input,r.IB_DOWN)||_||(e.angle=a,e.is_jumping=!0,0==s?e.speed.y=-e.jump_strength:s>0&&s<90?(e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=-.7*e.jump_strength):90==s?((0,t.actor_move)(e,(0,i.v2d_new)(20*n,0)),e.speed.x=Math.min(e.speed.x,-e.jump_strength),e.speed.y=-e.jump_strength/2):s>90&&s<180?((0,t.actor_move)(e,(0,i.v2d_new)(0,-20*n)),e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=e.jump_strength):180==s?((0,t.actor_move)(e,(0,i.v2d_new)(0,-20*n)),e.speed.x*=-1,e.speed.y=e.jump_strength):s>180&&s<270?((0,t.actor_move)(e,(0,i.v2d_new)(0,-20*n)),e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=e.jump_strength):270==s?((0,t.actor_move)(e,(0,i.v2d_new)(-20*n,0)),e.speed.x=Math.max(e.speed.x,e.jump_strength),e.speed.y=-e.jump_strength/2):s>270&&s<360&&(e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=-.7*e.jump_strength))},t.actor_handle_acceleration=function(e,t,n){var a=(0,c.timer_get_delta)();if((0,r.input_button_down)(e.input,r.IB_LEFT)&&!(0,r.input_button_down)(e.input,r.IB_RIGHT))e.ignore_horizontal||(0,r.input_button_down)(e.input,r.IB_DOWN)||(e.speed.x=Math.max(e.speed.x-(1-t)*e.acceleration*a,-e.maxspeed),e.mirror=_.IF_HFLIP);else if((0,r.input_button_down)(e.input,r.IB_RIGHT)&&!(0,r.input_button_down)(e.input,r.IB_LEFT))e.ignore_horizontal||(0,r.input_button_down)(e.input,r.IB_DOWN)||(e.speed.x=Math.min(e.speed.x+(1-t)*e.acceleration*a,e.maxspeed),e.mirror=_.IF_NONE);else if(n){var i=0,s=n.brick_ref.angle;s%90==0?i=90==s&&e.mirror&_.IF_HFLIP&&e.speed.x<0||270==s&&!(e.mirror&_.IF_HFLIP)&&e.speed.x>0?e.speed.x>o.EPSILON?1:-e.speed.x>o.EPSILON?-1:0:e.speed.x>o.EPSILON?-1:-e.speed.x>o.EPSILON?1:0:(s>90&&s<180||s>180&&s<270)&&(i=e.speed.x>o.EPSILON?-1:-e.speed.x>o.EPSILON?1:0),e.speed.x+=1*i*e.acceleration*a}},t.actor_platform_movement=function(e,n,a){var r,_,s,d,l,u,p,f,g,m,v,h,b,y,E,I,x=(0,i.v2d_new)(0,0),w=(0,c.timer_get_delta)(),S=e.position,k=(0,t.actor_get_collision_detectors)(e,-2,r,_,s,d,l,u,p,f);r=k.up,_=k.upright,s=k.right,d=k.downright,l=k.down,u=k.downleft,p=k.left,f=k.upleft,g=(k=(0,t.actor_handle_collision_detectors)(e,n,r,_,s,d,l,u,p,f,g,m,v,h,b,y,E,I)).up,m=k.upright,v=k.right,h=k.downright,b=k.down,y=k.downleft,E=k.left,I=k.upleft;var O=(0,t.actor_handle_clouds)(e,-2,g,m,v,h,b,y,E,I);return g=O.up,m=O.upright,v=O.right,E=O.left,I=O.upleft,b=O.down,y=O.downleft,h=O.downright,(0,t.actor_handle_carrying)(e,b),null!=e.carried_by?(0,i.v2d_new)(0,0):((0,t.actor_handle_wall_collision)(e,S,p,s,E,v),b?(e.is_jumping=!1,e.ignore_horizontal=!1,(0,t.actor_handle_jumping)(e,-2,0,b,g)):e.angle=0,x.y=Math.abs(e.speed.y)>o.EPSILON?e.speed.y*w+1*a*.5*(w*w):0,e.speed.y=Math.min(e.speed.y+1*a*w,480),(0,t.actor_handle_ceil_collision)(e,S,r,g),(0,t.actor_handle_floor_collision)(e,-2,0,x,S,0,y,b,h),x.x=Math.abs(e.speed.x)>o.EPSILON?e.speed.x*w+1*e.acceleration*.5*(w*w):0,(0,t.actor_handle_acceleration)(e,0,b),Math.abs(e.speed.x)<o.EPSILON&&(e.speed.x=x.x=0),x)},t.actor_particle_movement=function(e,t){var n=(0,c.timer_get_delta)(),a=(0,i.v2d_new)(0,0);return a.x=e.speed.x*n,a.y=e.speed.y*n+.5*t*n*n,e.speed.y+=t*n,a},t.actor_eightdirections_movement=function(e){var t=(0,c.timer_get_delta)(),n=(0,i.v2d_new)(0,0);return e.input?((0,r.input_button_down)(e.input,r.IB_RIGHT)&&!(0,r.input_button_down)(e.input,r.IB_LEFT)&&(e.speed.x=Math.min(e.speed.x+e.acceleration*t,e.maxspeed)),(0,r.input_button_down)(e.input,r.IB_LEFT)&&!(0,r.input_button_down)(e.input,r.IB_RIGHT)&&(e.speed.x=Math.max(e.speed.x-e.acceleration*t,-e.maxspeed)),!(0,r.input_button_down)(e.input,r.IB_LEFT)&&!(0,r.input_button_down)(e.input,r.IB_RIGHT)&&Math.abs(e.speed.x)>o.EPSILON&&(e.speed.x>0?e.speed.x=Math.max(e.speed.x-e.acceleration*t,0):e.speed.x=Math.min(e.speed.x+e.acceleration*t,0)),(0,r.input_button_down)(e.input,r.IB_DOWN)&&!(0,r.input_button_down)(e.input,r.IB_UP)&&(e.speed.y=Math.min(e.speed.y+e.acceleration*t,e.maxspeed)),(0,r.input_button_down)(e.input,r.IB_UP)&&!(0,r.input_button_down)(e.input,r.IB_DOWN)&&(e.speed.y=Math.max(e.speed.y-e.acceleration*t,-e.maxspeed)),!(0,r.input_button_down)(e.input,r.IB_UP)&&!(0,r.input_button_down)(e.input,r.IB_DOWN)&&Math.abs(e.speed.y)>o.EPSILON&&(e.speed.y>0?e.speed.y=Math.max(e.speed.y-e.acceleration*t,0):e.speed.y=Math.min(e.speed.y+e.acceleration*t,0))):e.speed=(0,i.v2d_new)(0,0),n.x=Math.abs(e.speed.x)>o.EPSILON?e.speed.x*t+.5*e.acceleration*t*t:0,n.y=0,e.speed.x=n.x,e.speed.y=n.y,n},t.actor_bullet_movement=function(e){var t=(0,c.timer_get_delta)(),n=(0,i.v2d_new)(0,0);return n.x=e.speed.x*t,n.y=0,n};var y=function(e,t){var n,a,i,r,_,s,c,d=null,p=!1;for(n=e;n&&!p;n=n.next)if(n.data){if(n.data.brick_ref.property==u.BRK_NONE||!n.data.enabled)continue;if(n.data.brick_ref.property==u.BRK_CLOUD&&d&&d.brick_ref.property==u.BRK_OBSTACLE)continue;if(n.data.brick_ref.behavior==u.BRB_CIRCULAR&&d&&d.brick_ref.behavior!=u.BRB_CIRCULAR&&n.data.y>=d.y)continue;if(h&&0==n.data.brick_ref.angle)continue;if(b&&180==n.data.brick_ref.angle)continue;if(v&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(m&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var y=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if((0,l.bounding_box)(t,y))if(n.data.brick_ref.behavior!=u.BRB_CIRCULAR&&d&&d.brick_ref.behavior==u.BRB_CIRCULAR&&n.data.y<=d.y)d=n.data;else if(n.data.brick_ref.property==u.BRK_OBSTACLE&&d&&d.brick_ref.property==u.BRK_CLOUD)d=n.data;else if(n.data.brick_ref.property==u.BRK_CLOUD&&d&&d.brick_ref.property==u.BRK_CLOUD)n.data.y>d.y&&(d=n.data);else if(n.data.brick_ref.angle%90==0)g&&d?f?d.brick_ref.angle%180!=0&&(d=n.data):d.brick_ref.angle%180==0&&(d=n.data):d=n.data;else if(g)for(a=n.data.brick_ref.angle,s=Math.tan(a*o.PI/180),r=t[0];r<=t[2]&&!p;r++)for(_=t[1];_<=t[3]&&!p;_++){switch(i=!1,~~(a/90)%4){case 0:c=y[3]+s*(y[0]-r),i=y[0]<=r&&r<=y[2]&&c<=_&&_<=y[3];break;case 1:c=y[3]-s*(y[2]-r),i=y[0]<=r&&r<=y[2]&&y[1]<=_&&_<=c;break;case 2:c=y[3]-s*(y[0]-r),i=y[0]<=r&&r<=y[2]&&y[1]<=_&&_<=c;break;case 3:c=y[3]+s*(y[2]-r),i=y[0]<=r&&r<=y[2]&&c<=_&&_<=y[3]}i&&(d=n.data,p=!0)}}return d},E=function(e,n,a){var o,r,_,s,c,d,l,u,p;return _=-n.angle,o=(0,t.actor_image)(n).width,r=(0,t.actor_image)(n).height,u=n.hot_spot,p=n.position,s=(0,i.v2d_subtract)((0,i.v2d_new)(0,0),u),c=(0,i.v2d_subtract)((0,i.v2d_new)(o,0),u),d=(0,i.v2d_subtract)((0,i.v2d_new)(o,r),u),l=(0,i.v2d_subtract)((0,i.v2d_new)(0,r),u),a[0]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(s,_)),a[1]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(c,_)),a[2]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(d,_)),a[3]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(l,_)),a},I=function(e,t){return e.translate(t,0),e.scale(-1,1),e.translate(-t,0),e}},3339:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.background_render_fg=t.background_render_bg=t.background_update=t.background_unload=t.background_load=void 0;var a=n(9386),o=n(2878),i=n(9880),r=n(642),_=n(7898),s=n(4163),c=n(3450),d=n(2954),l=n(3031);t.background_load=function(e){return console.log("background_load",e),new Promise((function(t,n){(0,_.logfile_message)("background_load(".concat(e,")")),(0,c.resourcemanager_getJsonFile)(e).then(m).then((function(e){t({data:e,length:e.length})}))}))},t.background_unload=function(e){return(0,_.logfile_message)("background_unload()"),null},t.background_update=function(e){if(!e)return!1;for(var t=0;t<e.length;t++){var n=e.data[t];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},t.background_render_bg=function(e,t){u(e,t,!1)},t.background_render_fg=function(e,t){u(e,t,!0)};var u=function(e,t,n){if(e){var a,i,_=(0,o.v2d_new)(r.VIDEO_SCREEN_W/2,r.VIDEO_SCREEN_H/2),s=(0,o.v2d_subtract)(t,_);for(a=0;a<e.length;a++)i=e.data[a],(!n&&i.zindex<=.5||n&&i.zindex>.5)&&(i.actor.position.x+=s.x*i.actor.speed.x,i.actor.position.y+=s.y*i.actor.speed.y,(0,l.actor_render_repeat_xy)(i.actor,_,i.repeat_x,i.repeat_y),i.actor.position.y-=s.y*i.actor.speed.y,i.actor.position.x-=s.x*i.actor.speed.x)}},p=function(e){},f=function(e){var t=e,n=e.background,a=(0,s.timer_get_delta)();n.actor.position.x+=t.speed_x*a,n.actor.position.y+=t.speed_y*a},g=function(e){var t,n,a,o=e,i=e.background,r=(0,s.timer_get_delta)();t=o.timer+=r,n=Math.sin(o.angularspeed_x*t+o.initialphase_x),a=Math.cos(o.angularspeed_y*t+o.initialphase_y),i.actor.position.x+=-o.angularspeed_x*o.amplitude_x*n*r,i.actor.position.y+=o.angularspeed_y*o.amplitude_y*a*r},m=function(e){var t=e.bg;return Promise.all(t.map(v))},v=function(e,t){return new Promise((function(t,n){var r,_,s,c={actor:(0,l.actor_create)(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0};switch(c.actor.spawn_point.x=e.initial_position.xpos,c.actor.spawn_point.y=e.initial_position.ypos,c.actor.position=(0,o.v2d_new)(c.actor.spawn_point.x,c.actor.spawn_point.y),c.actor.speed.x=e.scroll_speed.xspeed,c.actor.speed.y=e.scroll_speed.yspeed,e.behavior&&(0,d.isArray)(e.behavior)?e.behavior[0]:e.behavior){case"DEFAULT":c.strategy&&(c.strategy=(c.strategy,null)),c.strategy={background:c,update:p};break;case"LINEAR":c.strategy&&(c.strategy=(c.strategy,null)),c.strategy=(r=c,_=e.behavior[1],s=e.behavior[2],{background:r,update:f,speed_x:_,speed_y:s});break;case"CIRCULAR":c.strategy&&(c.strategy=(c.strategy,null)),c.strategy=function(e,t,n,o,i,r,_){return{background:e,update:g,timer:0,amplitude_x:t,amplitude_y:n,angularspeed_x:2*a.PI*o,angularspeed_y:2*a.PI*i,initialphase_x:r*a.PI/180,initialphase_y:_*a.PI/180}}(c,e.behavior[1],e.behavior[2],e.behavior[3],e.behavior[4],e.behavior[5],e.behavior[6])}c.repeat_x=e.repeat_x,c.repeat_y=e.repeat_y,e.zindex&&(c.zindex=e.zindex),(0,i.sprite_create)(e.sprite).then((function(e){c.data=e,c.actor.animation=e,c.actor.animation.data=[0],t(c)}))}))}},8707:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.brick_get_behavior_name=t.brick_get_property_name=t.brick_image=t.brick_animate=t.brick_size=t.brick_get=t.brick_unload=t.brick_load=t.BRB_FALL_TIME=t.BRICK_MAXVALUES=t.BRS_ACTIVE=t.BRS_DEAD=t.BRS_IDLE=t.BRB_FALL=t.BRB_BREAKABLE=t.BRB_CIRCULAR=t.BRB_DEFAULT=t.BRICKBEHAVIOR_MAXARGS=t.BRK_CLOUD=t.BRK_OBSTACLE=t.BRK_NONE=void 0;var a=n(9880),o=n(3450),i=n(4163),r=n(7898),_=n(2954);t.BRK_NONE=0,t.BRK_OBSTACLE=1,t.BRK_CLOUD=2,t.BRICKBEHAVIOR_MAXARGS=5,t.BRB_DEFAULT=0,t.BRB_CIRCULAR=1,t.BRB_BREAKABLE=2,t.BRB_FALL=3,t.BRS_IDLE=0,t.BRS_DEAD=1,t.BRS_ACTIVE=2,t.BRICK_MAXVALUES=3,t.BRB_FALL_TIME=1;var s=0,c=[];t.brick_load=function(e){return new Promise((function(t,n){(0,r.logfile_message)("brickdata_load('%s') ".concat(e)),(0,o.resourcemanager_getJsonFile)(e).then(l).then((function(e){c=e})).then(t)}))},t.brick_unload=function(){var e;for((0,r.logfile_message)("brickdata_unload()"),e=0;e<s;e++)c[e]=d(c[e]);s=0,(0,r.logfile_message)("brickdata_unload() ok")},t.brick_get=function(e){return c[e]},t.brick_size=function(){return s},t.brick_animate=function(e){var t=e.brick_ref.data;if(null!=t&&t.animation_data.length){t.animation_data[0].repeat;var n=t.animation_data[0].frame_count;e.animation_frame+=t.animation_data[0].fps*(0,i.timer_get_delta)(),e.animation_frame>t.animation_data[0].frame_count-1&&(e.animation_frame=0),n=~~e.animation_frame,e.brick_ref.image=t.frame_data[t.animation_data[0].data[n]]}return e},t.brick_image=function(e){return e.brick_ref.image},t.brick_get_property_name=function(e){switch(e){case t.BRK_NONE:return"PASSABLE";case t.BRK_OBSTACLE:return"OBSTACLE";case t.BRK_CLOUD:return"CLOUD";default:return"Unknown"}},t.brick_get_behavior_name=function(e){switch(e){case t.BRB_DEFAULT:return"DEFAULT";case t.BRB_CIRCULAR:return"CIRCULAR";case t.BRB_BREAKABLE:return"BREAKABLE";case t.BRB_FALL:return"FALL";default:return"Unknown"}};var d=function(e){return null!=e&&null!=e.data&&(0,a.sprite_info_destroy)(e.data),null},l=function(e){var t=e.bricks;return Promise.all(t.map(u))},u=function(e){return new Promise((function(n,o){var i=function(){for(var e={data:null,image:null,property:t.BRK_NONE,angle:0,behavior:t.BRB_DEFAULT,zindex:.5,behavior_arg:[]},n=0;n<t.BRICKBEHAVIOR_MAXARGS;n++)e.behavior_arg[n]=0;return e}(),c=e.type;"OBSTACLE"==c?i.property=t.BRK_OBSTACLE:"PASSABLE"==c?i.property=t.BRK_NONE:"CLOUD"==c?i.property=t.BRK_CLOUD:(0,r.logfile_message)("Can't read brick attributes: unknown brick type ".concat(c)),"DEFAULT"==(c=(0,_.isArray)(e.behavior)?e.behavior[0]:e.behavior)?i.behavior=t.BRB_DEFAULT:"CIRCULAR"==c?i.behavior=t.BRB_CIRCULAR:"BREAKABLE"==c?i.behavior=t.BRB_BREAKABLE:"FALL"==c?i.behavior=t.BRB_FALL:(0,r.logfile_message)("Can't read brick attributes: unknown brick type ".concat(c));for(var d=0;d<t.BRICKBEHAVIOR_MAXARGS;d++)i.behavior_arg[d]=e.behavior[1+d];i.behavior_arg[i.behavior_arg.length-1]=0,i.angle=e.angle,e.zindex&&(i.zindex=e.zindex),(0,a.sprite_create)(e.sprite).then((function(e){i.data=e,i.image=e.frame_data[0],s++,n(i)}))}))}},2985:(e,t,n)=>{t.kX=t.gY=t.H1=t.vY=t.q1=t.Xq=t.LF=t.qO=void 0;var a=n(9386),o=n(2954),i=n(2878),r=n(4163),_=n(642),s=n(4054),c={is_locked:!1,position:(0,i.v2d_new)(0,0),dest:(0,i.v2d_new)(0,0),speed:0,region_topleft:(0,i.v2d_new)(0,0),region_bottomright:(0,i.v2d_new)(0,0),dest_region_topleft:(0,i.v2d_new)(0,0),dest_region_bottomright:(0,i.v2d_new)(0,0),region_topleft_speed:0,region_bottomright_speed:0};t.qO=function(){c.is_locked=!1,c.speed=0,c.region_topleft_speed=0,c.region_bottomright_speed=0,c.position=c.dest=(0,i.v2d_new)(0,0),c.region_topleft.x=c.dest_region_topleft.x=_.VIDEO_SCREEN_W/2,c.region_topleft.y=c.dest_region_topleft.y=_.VIDEO_SCREEN_H/2,c.region_bottomright.x=c.dest_region_bottomright.x=(0,s.level_size)().x-_.VIDEO_SCREEN_W/2,c.region_bottomright.y=c.dest_region_bottomright.y=(0,s.level_size)().y-_.VIDEO_SCREEN_H/2},t.LF=function(){var e,t=(0,r.timer_get_delta)();l(),e=(0,i.v2d_subtract)(c.dest,c.position),(0,i.v2d_magnitude)(e)>10&&(e=(0,i.v2d_normalize)(e),c.position.x+=e.x*c.speed*t,c.position.y+=e.y*c.speed*t),e=(0,i.v2d_subtract)(c.dest_region_topleft,c.region_topleft),(0,i.v2d_magnitude)(e)>10&&(e=(0,i.v2d_normalize)(e),c.region_topleft.x+=e.x*c.region_topleft_speed*t,c.region_topleft.y+=e.y*c.region_topleft_speed*t),e=(0,i.v2d_subtract)(c.dest_region_bottomright,c.region_bottomright),(0,i.v2d_magnitude)(e)>10&&(e=(0,i.v2d_normalize)(e),c.region_bottomright.x+=e.x*c.region_bottomright_speed*t,c.region_bottomright.y+=e.y*c.region_bottomright_speed*t),c.position.x=(0,o.clip)(c.position.x,c.region_topleft.x,c.region_bottomright.x),c.position.y=(0,o.clip)(c.position.y,c.region_topleft.y,c.region_bottomright.y)},t.Xq=function(){},t.q1=function(e,t){e.x<c.region_topleft.x&&(e.x=c.region_topleft.x),e.y<c.region_topleft.y&&(e.y=c.region_topleft.y),e.x>c.region_bottomright.x&&(e.x=c.region_bottomright.x),e.y>c.region_bottomright.y&&(e.y=c.region_bottomright.y),c.dest=e,t>a.EPSILON?c.speed=(0,i.v2d_magnitude)((0,i.v2d_subtract)(c.position,c.dest))/t:c.position=c.dest,c.position.x=e.x,c.position.y=e.y},t.vY=function(e,t,n,a){c.is_locked=!0,d(e,t,n,a)},t.H1=function(){c.is_locked=!1},t.gY=function(){return(0,i.v2d_new)(c.position.x,c.position.y)},t.kX=function(e){var t=(0,i.v2d_new)(e.x,e.y);c.dest=c.position=t};var d=function(e,t,n,a){c.dest_region_topleft.x=Math.max(Math.min(e,n),_.VIDEO_SCREEN_W/2),c.dest_region_topleft.y=Math.max(Math.min(t,a),_.VIDEO_SCREEN_H/2),c.dest_region_bottomright.x=Math.min(Math.max(e,n),(0,s.level_size)().x-_.VIDEO_SCREEN_W/2),c.dest_region_bottomright.y=Math.min(Math.max(t,a),(0,s.level_size)().y-_.VIDEO_SCREEN_H/2),c.region_topleft_speed=(0,i.v2d_magnitude)((0,i.v2d_subtract)(c.region_topleft,c.dest_region_topleft))/.25,c.region_bottomright_speed=(0,i.v2d_magnitude)((0,i.v2d_subtract)(c.region_bottomright,c.dest_region_bottomright))/.25},l=function(){c.is_locked||d(-a.INFINITY,-a.INFINITY,a.INFINITY,a.INFINITY)}},2594:(e,t,n)=>{t.Rt=t.at=t.bw=t.Vu=t.pQ=t.PC=t.o9=t.Pr=t.gb=t.f7=t.Zf=t.nN=t.jw=t.Bh=t.be=t.Zy=t.qh=t.pp=t.xW=t.Vj=t.xe=t.Gd=t.wN=t.Nx=t.jy=t.uN=t.ko=t.jQ=t.rm=t.H7=t._q=t.tk=t.Mo=t.NE=t.Sr=t.bW=t.kG=t.C_=t.z8=t.tq=t.vP=t.ZG=t.Dk=t.Or=t.eM=t.e0=t.oM=t.vJ=void 0,t.tx=t.wU=t.tl=t._y=t.rJ=t.Hx=t.vo=t.cV=t.M7=t.Xb=t.$q=t.X=t.Bs=t.Bq=t.mb=t.iR=t.tG=t.S0=t.DM=t.so=t.Qs=t.fm=t.EQ=t.C8=t.lL=t.OQ=t.Wm=t.EO=t.zm=t.ty=t.vc=t.d8=t.b0=t.k_=t.mH=t.mw=t.VJ=t.uV=t.uW=void 0;var a,o=n(4054),i=n(4878),r=n(3446),_=n(9930),s=n(8102),c=n(3658),d=n(649),l=n(4598),u=n(9412),p=n(8397),f=n(8514),g=n(7813),m=n(8523),v=n(8092),h=n(3842),b=n(581),y=n(6052),E=n(9294),I=n(4667),x=n(9024),w=n(3465),S=n(2796),k=n(2918),O=n(4060),R=n(3110);t.vJ=0,t.oM=1,t.e0=2,t.eM=3,t.Or=4,t.Dk=5,t.ZG=6,t.vP=7,t.tq=8,t.z8=9,t.C_=10,t.kG=11,t.bW=12,t.Sr=13,t.NE=15,t.Mo=16,t.tk=17,t._q=18,t.H7=19,t.rm=20,t.jQ=21,t.ko=22,t.uN=23,t.jy=24,t.Nx=25,t.wN=26,t.Gd=27,t.xe=28,t.Vj=29,t.xW=30,t.pp=31,t.qh=32,t.Zy=33,t.be=34,t.Bh=35,t.jw=36,t.nN=37,t.Zf=38,t.f7=39,t.gb=40,t.Pr=41,t.o9=42,t.PC=43,t.pQ=44,t.Vu=45,t.bw=46,t.at=47,t.Rt=48,t.uW=49,t.uV=50,t.VJ=51,t.mw=52,t.mH=53,t.k_=54,t.b0=55,t.d8=56,t.vc=57,t.ty=58,t.zm=59,t.EO=60,t.Wm=61,t.OQ=62,t.lL=63,t.C8=64,t.EQ=65,t.fm=66,t.Qs=67,t.so=68,t.DM=69,t.S0=70,t.tG=71,t.iR=72,t.mb=73,t.Bq=74,t.Bs=75,t.X=76,t.$q=77,t.Xb=78,t.M7=79,t.cV=80,t.vo=81,function(e){e[e.IS_IDLE=0]="IS_IDLE",e[e.IS_DEAD=1]="IS_DEAD"}(a||(a={})),t.Hx=a.IS_IDLE,t.rJ=a.IS_DEAD,t._y=function(e){var n=null;switch(e){case t.vJ:n=(0,w.ring_create)();break;case t.oM:n=(0,I.lifebox_create)();break;case t.e0:n=(0,I.ringbox_create)();break;case t.eM:n=(0,I.starbox_create)();break;case t.Or:n=(0,I.speedbox_create)();break;case t.Dk:n=(0,I.glassesbox_create)();break;case t.ZG:n=(0,I.shieldbox_create)();break;case t.o9:n=(0,I.fireshieldbox_create)();break;case t.Xb:n=(0,I.thundershieldbox_create)();break;case t.M7:n=(0,I.watershieldbox_create)();break;case t.cV:n=(0,I.acidshieldbox_create)();break;case t.vo:n=(0,I.windshieldbox_create)();break;case t.vP:n=(0,I.trapbox_create)();break;case t.tq:n=(0,I.emptybox_create)();break;case t.z8:n=(0,l.crushedbox_create)();break;case t.C_:n=(0,E.icon_create)();break;case t.kG:n=(0,h.falglasses_create)();break;case t.bW:n=(0,v.explosion_create)();break;case t.Sr:n=(0,b.flyingtext_create)();break;case t.NE:n=(0,i.animal_create)();break;case t.Mo:n=(0,x.loopright_create)();break;case t.tk:n=(0,x.looptop_create)();break;case t._q:n=(0,x.loopleft_create)();break;case t.H7:n=(0,x.loopnone_create)();break;case t.Zy:n=(0,x.loopfloor_create)();break;case t.be:n=(0,x.loopfloornone_create)();break;case t.Bh:n=(0,x.loopfloortop_create)();break;case t.rm:n=(0,k.yellowspring_create)();break;case t.k_:n=(0,k.byellowspring_create)();break;case t.uV:n=(0,k.tryellowspring_create)();break;case t.Rt:n=(0,k.ryellowspring_create)();break;case t.mw:n=(0,k.bryellowspring_create)();break;case t.mH:n=(0,k.blyellowspring_create)();break;case t.uW:n=(0,k.lyellowspring_create)();break;case t.VJ:n=(0,k.tlyellowspring_create)();break;case t.jQ:n=(0,k.redspring_create)();break;case t.at:n=(0,k.bredspring_create)();break;case t.PC:n=(0,k.trredspring_create)();break;case t.ko:n=(0,k.rredspring_create)();break;case t.Vu:n=(0,k.brredspring_create)();break;case t.bw:n=(0,k.blredspring_create)();break;case t.uN:n=(0,k.lredspring_create)();break;case t.pQ:n=(0,k.tlredspring_create)();break;case t.b0:n=(0,k.bluespring_create)();break;case t.OQ:n=(0,k.bbluespring_create)();break;case t.ty:n=(0,k.trbluespring_create)();break;case t.d8:n=(0,k.rbluespring_create)();break;case t.EO:n=(0,k.brbluespring_create)();break;case t.Wm:n=(0,k.blbluespring_create)();break;case t.vc:n=(0,k.lbluespring_create)();break;case t.zm:n=(0,k.tlbluespring_create)();break;case t.jy:n=(0,s.bluering_create)();break;case t.Nx:n=(0,O.switch_create)();break;case t.wN:o.PLAYERS.length>1&&(n=(0,g.door_create)());break;case t.Gd:n=(0,R.teleporter_create)();break;case t.xe:n=(0,_.bigring_create)();break;case t.Vj:n=(0,d.checkpointorb_create)();break;case t.xW:n=(0,y.goalsign_create)();break;case t.pp:n=(0,m.endsign_create)();break;case t.qh:n=(0,r.animalprison_create)();break;case t.jw:n=(0,c.bumper_create)();break;case t.nN:n=(0,u.horizontaldanger_create)();break;case t.Bs:n=(0,u.verticaldanger_create)();break;case t.X:n=(0,u.horizontalfiredanger_create)();break;case t.$q:n=(0,u.verticalfiredanger_create)();break;case t.Zf:n=(0,S.floorspikes_create)();break;case t.lL:n=(0,S.ceilingspikes_create)();break;case t.C8:n=(0,S.leftwallspikes_create)();break;case t.EQ:n=(0,S.rightwallspikes_create)();break;case t.fm:n=(0,S.periodic_floorspikes_create)();break;case t.Qs:n=(0,S.periodic_ceilingspikes_create)();break;case t.so:n=(0,S.periodic_leftwallspikes_create)();break;case t.DM:n=(0,S.periodic_rightwallspikes_create)();break;case t.f7:n=(0,f.surge_dnadoor_create)();break;case t.S0:n=(0,f.neon_dnadoor_create)();break;case t.tG:n=(0,f.charge_dnadoor_create)();break;case t.iR:n=(0,f.surge_horizontal_dnadoor_create)();break;case t.mb:n=(0,f.neon_horizontal_dnadoor_create)();break;case t.Bq:n=(0,f.charge_horizontal_dnadoor_create)();break;case t.gb:case t.Pr:n=(0,p.dangerouspower_create)()}return null!=n&&(n.type=e,n.state=t.Hx,n.init(n)),n},t.tl=function(e){return null},t.wU=function(e,t,n,a,o,i){e.update(e,t,n,a,o,i)},t.tx=function(e,t){e.render(e,t)}},8529:(e,t,n)=>{t.E=void 0;var a=n(2878),o=n(3031);t.E=function(e){return{init:i,release:r,update:_,render:s,get_object_instance:c,basic:!0,object:e}};var i=function(e){},r=function(e){},_=function(e,t,n,a,o,i){},s=function(e,t){var n=e.get_object_instance(e).actor,i=n.position;n.position=(0,a.v2d_new)(parseInt(n.position.x,10),parseInt(n.position.y,10)),(0,o.actor_render)(n,t),n.position=i},c=function(e){return e.object}},6432:(e,t)=>{t.m=void 0,t.m=function(e){var t=e.decorated_machine;return t.get_object_instance(t)}},5858:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.confirmbox_selected_option=t.confirmbox_alert=t.confirmbox_release=t.confirmbox_render=t.confirmbox_update=t.confirmbox_init=void 0;var a=n(2878),o=n(4163),i=n(642),r=n(7709),_=n(9880),s=n(7774),c=n(9931),d=n(2667),l=n(4470),u=n(3031),p=n(5176),f=null,g=null,m=null,v=[],h=null,b=null,y=[],E=0,I=-1,x=!1,w=!1,S=null;t.confirmbox_init=function(){var e;for(f=(0,_.sprite_get_image)((0,_.sprite_get_animation)("SD_CONFIRMBOX",0),0),g=(0,a.v2d_new)((i.VIDEO_SCREEN_W-f.width)/2,i.VIDEO_SCREEN_H),S=(0,s.input_create_user)(),h=(0,u.actor_create)(),h=(0,u.actor_change_animation)(h,(0,_.sprite_get_animation)("SD_TITLEFOOT",0)),m=(0,p.font_create)(8),(0,p.font_set_text)(m,b),(0,p.font_set_width)(m,164),e=0;e<E;e++)v[e]=[],v[e][0]=(0,p.font_create)(8),v[e][1]=(0,p.font_create)(8),(0,p.font_set_text)(v[e][0],y[e]),(0,p.font_set_text)(v[e][1],"<color=ffff00>%s</color>",y[e]);I=0,x=!0,w=!1},t.confirmbox_update=function(){var e,t=(0,o.timer_get_delta)(),n=5*i.VIDEO_SCREEN_H;if(x&&(g.y<=(i.VIDEO_SCREEN_H-f.height)/2?x=!1:g.y-=n*t),w){if(g.y>=i.VIDEO_SCREEN_H)return w=!1,void(0,d.scenestack_pop)();g.y+=n*t}for(h.position=(0,a.v2d_new)(g.x+I*f.width/E+10,g.y+.75*f.height-1),m.position=(0,a.v2d_new)(g.x+10,g.y+10),e=0;e<E;e++)v[e][0].position=(0,a.v2d_new)(g.x+e*f.width/E+25,g.y+.75*f.height),v[e][1].position=v[e][0].position;x||w||((0,s.input_button_pressed)(S,s.IB_LEFT)?((0,c.sound_play)((0,l.soundfactory_get)("choose")),I=((I-1)%E+E)%E):(0,s.input_button_pressed)(S,s.IB_RIGHT)?((0,c.sound_play)((0,l.soundfactory_get)("choose")),I=(I+1)%E):((0,s.input_button_pressed)(S,s.IB_FIRE1)||(0,s.input_button_pressed)(S,s.IB_FIRE3))&&((0,c.sound_play)((0,l.soundfactory_get)("select")),w=!0))},t.confirmbox_render=function(){var e,t,n=(0,a.v2d_new)(i.VIDEO_SCREEN_W/2,i.VIDEO_SCREEN_H/2);for((0,i.video_clearDisplay)(),(0,i.video_get_backbuffer)().drawImage(f.data,f.sx,f.sy,f.swidth,f.sheight,g.x,g.y,f.swidth,f.sheight),(0,p.font_render)(m,n),e=0;e<E;e++)t=e==I?1:0,(0,p.font_render)(v[e][t],n);(0,u.actor_render)(h,n)},t.confirmbox_release=function(){(0,u.actor_destroy)(h),(0,s.input_destroy)(S),(0,p.font_destroy)(m),(0,r.image_destroy)(null)},t.confirmbox_alert=function(e,t,n){I=-1,b=e,y[0]=t,n?(y[1]=n,E=2):E=1},t.confirmbox_selected_option=function(){if(-1!=I){var e=I+1;return I=-1,e}return 0}},2930:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.credits_release=t.credits_render=t.credits_update=t.credits_init=void 0;var a=n(2878),o=n(642),i=n(9931),r=n(6038),_=n(7774),s=n(7709),c=n(4163),d=n(2667),l=n(4470),u=n(5176),p=n(3339),f=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],g=null,m=!1,v=null,h=null,b=null,y=null,E=0,I=null;t.credits_init=function(){m=!1,y=(0,_.input_create_user)(),v=(0,u.font_create)(4),console.log(v),(0,u.font_set_text)(v,(0,r.lang_get)("CREDITS_TITLE")),v.position.x=o.VIDEO_SCREEN_W/2-100,v.position.y=5,b=(0,u.font_create)(8),(0,u.font_set_text)(b,(0,r.lang_get)("CREDITS_KEY")),b.position.x=10,b.position.y=o.VIDEO_SCREEN_H-(0,u.font_get_charsize)(b).y-5,h=(0,u.font_create)(8);for(var e=0;e<f.length;e++){var t=f[e],n=t.match(/\$[A-Z_\d]\w+/m);if(n){for(var a=0;a<n.length;a++){var i=n[a].slice(1),c=(0,r.lang_get)(i);c&&(t=t.replace("$"+i,c))}f[e]=t}}(0,u.font_set_text)(h,f.join(""),"%s"),(0,u.font_set_width)(h,300),h.position.x=10,h.position.y=o.VIDEO_SCREEN_H,E=1;var d=(0,u.font_get_text)(h);for(e=0;e<d.length;e++)"\n"==d[e]&&E++;E+=10,g=(0,s.image_create)(o.VIDEO_SCREEN_W,30),(0,p.background_load)("data/themes/credits.bg.json").then((function(e){I=e,console.log(I),(0,o.video_fadefx_in)((0,s.image_rgb)(0,0,0),1)})),(0,o.video_fadefx_in)((0,s.image_rgb)(0,0,0),1)},t.credits_update=function(){var e=(0,c.timer_get_delta)();if((0,p.background_update)(I),h.position.y-=3*(0,u.font_get_charsize)(h).y*e,h.position.y<-E*((0,u.font_get_charsize)(h).y+(0,u.font_get_charspacing)(h).y)&&(h.position.y=o.VIDEO_SCREEN_H),m||(0,o.video_fadefx_is_fading)()||((0,_.input_button_pressed)(y,_.IB_FIRE3)?((0,i.sound_play)((0,l.soundfactory_get)("select")),m=!0):(0,_.input_button_pressed)(y,_.IB_FIRE4)&&((0,i.sound_play)((0,l.soundfactory_get)("return")),m=!0)),!(0,i.music_is_playing)()){var t=(0,i.music_load)("data/music/options.mp4");(0,i.music_play)(t,!0)}if(m){if((0,o.video_fadefx_over)())return void(0,d.scenestack_pop)();(0,o.video_fadefx_out)((0,s.image_rgb)(0,0,0),1)}},t.credits_render=function(){(0,o.video_clearDisplay)();var e=(0,a.v2d_new)(o.VIDEO_SCREEN_W/2,o.VIDEO_SCREEN_H/2);(0,p.background_render_bg)(I,e),(0,p.background_render_fg)(I,e),(0,u.font_render)(h,e),(0,o.video_get_backbuffer)().fillRect(0,0,g.width,g.height),(0,o.video_get_backbuffer)().fillRect(0,o.VIDEO_SCREEN_H-20,g.width,g.height),(0,u.font_render)(v,e),(0,u.font_render)(b,e)},t.credits_release=function(){I=(0,p.background_unload)(I),(0,s.image_destroy)(g),(0,u.font_destroy)(v),(0,u.font_destroy)(h),(0,u.font_destroy)(b),(0,_.input_destroy)(y)}},2318:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.endofdemo_release=t.endofdemo_render=t.endofdemo_update=t.endofdemo_init=void 0;var a=n(9386),o=n(2878),i=n(642),r=n(7709),_=n(9880),s=n(6038),c=n(4163),d=n(2667),l=n(532),u=n(5176),p=n(3031),f=10,g=0,m=null,v=null,h=[];t.endofdemo_init=function(){var e;for(g=(0,c.timer_get_ticks)(),(m=(0,u.font_create)(8)).position=(0,o.v2d_new)(5,35),v=(0,u.font_create)(4),(0,u.font_set_text)(v,(0,s.lang_get)("ENDOFDEMO_TITLE")),v.position=(0,o.v2d_new)((i.VIDEO_SCREEN_W-(0,u.font_get_charsize)(v).x*(0,u.font_get_text)(v))/2,5),e=0;e<f;e++)h[e]=(0,p.actor_create)(),h[e].spawn_point=h[e].position=(0,o.v2d_new)(i.VIDEO_SCREEN_W*e/f+15,215),(0,p.actor_change_animation)(h[e],(0,_.sprite_get_animation)(e%2==1?"SD_BLUERING":"SD_RING",0));(0,i.video_fadefx_in)((0,r.image_rgb)(0,0,0),2)},t.endofdemo_update=function(){var e,t=(0,c.timer_get_ticks)(),n=Math.max(0,(3-(t-g))/1e3);if((0,u.font_set_text)(m,(0,s.lang_get)("ENDOFDEMO_TEXT"),a.GAME_TITLE,a.GAME_WEBSITE,n),t>=g+3){if((0,i.video_fadefx_over)())return(0,d.scenestack_pop)(),void(0,d.scenestack_push)((0,l.storyboard_get_scene)(l.SCENE_QUESTOVER));(0,i.video_fadefx_out)((0,r.image_rgb)(0,0,0),2)}for(e=0;e<f;e++)h[e].position.y=h[e].spawn_point.y+10*Math.sin(a.PI*(.001*t)+2*a.PI/f*e)},t.endofdemo_render=function(){var e,t=(0,o.v2d_new)(i.VIDEO_SCREEN_W/2,i.VIDEO_SCREEN_H/2);for((0,i.video_clearDisplay)(),e=0;e<f;e++)(0,p.actor_render)(h[e],t);(0,u.font_render)(v,t),(0,u.font_render)(m,t)},t.endofdemo_release=function(){var e;for(e=0;e<f;e++)(0,p.actor_destroy)(h[e]);(0,u.font_destroy)(v),(0,u.font_destroy)(m)}},6698:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gameover_release=t.gameover_render=t.gameover_update=t.gameover_init=void 0;var a=n(2878),o=n(2667),i=n(7709),r=n(642),_=n(4163),s=n(7307),c=n(5176),d=[],l=0;t.gameover_init=function(){l=0,d[0]=(0,c.font_create)(7),d[0].position=(0,a.v2d_new)(-50,112),(0,c.font_set_text)(d[0],"GAME"),d[1]=(0,c.font_create)(7),d[1].position=(0,a.v2d_new)(298,112),(0,c.font_set_text)(d[1],"OVER")},t.gameover_update=function(){var e=(0,_.timer_get_delta)();if((l+=e)>5){if((0,r.video_fadefx_over)())return(0,s.quest_abort)(),void(0,o.scenestack_pop)();(0,r.video_fadefx_out)((0,i.image_rgb)(0,0,0),2)}d[0].position.x+=200*e,d[0].position.x>80&&(d[0].position.x=80),d[1].position.x-=200*e,d[1].position.x<168&&(d[1].position.x=168)},t.gameover_render=function(){(0,r.video_clearDisplay)();var e=(0,a.v2d_new)(r.VIDEO_SCREEN_W/2,r.VIDEO_SCREEN_H/2);(0,c.font_render)(d[0],e),(0,c.font_render)(d[1],e)},t.gameover_release=function(){(0,i.image_destroy)(null),(0,c.font_destroy)(d[1]),(0,c.font_destroy)(d[0]),(0,s.quest_abort)()}},2342:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.intro_release=t.intro_render=t.intro_update=t.intro_init=void 0;var a=n(2878),o=n(4163),i=n(2667),r=n(532),_=n(642),s=n(7709),c=n(3339),d=0,l=null;t.intro_init=function(){d=0,(0,c.background_load)("data/themes/intro.bg.json").then((function(e){l=e,(0,_.video_fadefx_in)((0,s.image_rgb)(0,0,0),1)}))},t.intro_update=function(){if(l&&(d+=(0,o.timer_get_delta)(),(0,c.background_update)(l),d>=3)){if((0,_.video_fadefx_over)())return(0,i.scenestack_pop)(),void(0,i.scenestack_push)((0,r.storyboard_get_scene)(r.SCENE_MENU));(0,_.video_fadefx_out)((0,s.image_rgb)(0,0,0),1)}},t.intro_render=function(){if(l){var e=(0,a.v2d_new)(_.VIDEO_SCREEN_W/2,_.VIDEO_SCREEN_H/2);(0,c.background_render_bg)(l,e),(0,c.background_render_fg)(l,e)}},t.intro_release=function(){l=null}},5316:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.langselect_release=t.langselect_render=t.langselect_update=t.langselect_init=void 0;var a=n(9386),o=n(2878),i=n(2667),r=n(5286),_=n(7898),s=n(642),c=n(7709),d=n(9880),l=n(9931),u=n(6038),p=n(7774),f=n(4163),g=n(3450),m=n(4470),v=n(5176),h=n(3031),b=n(3339),y=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],E=1,I=1,x=!1,w=0,S=[],k=[],O=null,R=null,L=0,N=null,D=null,T=0,P=null;t.langselect_init=function(){L=0,x=!1,T=0,D=(0,p.input_create_user)(),O=(0,v.font_create)(8),S[0]=(0,v.font_create)(4),(0,v.font_set_text)(S[0],"SELECT YOUR"),S[0].position.x=(s.VIDEO_SCREEN_W-(0,v.font_get_text)(S[0]).length*(0,v.font_get_charsize)(S[0]).x)/2-140,S[0].position.y=10,S[1]=(0,v.font_create)(4),(0,v.font_set_text)(S[1],"LANGUAGE"),S[1].position.x=(s.VIDEO_SCREEN_W-(0,v.font_get_text)(S[1]).length*(0,v.font_get_charsize)(S[1]).x)/2-120,S[1].position.y=S[0].position.y+(0,v.font_get_charsize)(S[1]).y+10+10,S[2]=(0,v.font_create)(8),(0,v.font_set_text)(S[2],(0,u.lang_get)("MENU_CQ_BACK")),S[2].position.x=10,S[2].position.y=s.VIDEO_SCREEN_H-1.5*(0,v.font_get_charsize)(S[2]).y,(0,b.background_load)("data/themes/langselect.bg.json").then((function(e){P=e,(0,s.video_fadefx_in)((0,c.image_rgb)(0,0,0),1)})),N=(0,h.actor_create)(),(0,h.actor_change_animation)(N,(0,d.sprite_get_animation)("SD_TITLEFOOT",0)),B(),(0,s.video_fadefx_in)((0,c.image_rgb)(0,0,0),1)},t.langselect_update=function(){var e=(0,f.timer_get_delta)();if(T+=e,(0,b.background_update)(P),N&&k.length&&(N.position=(0,o.v2d_new)(k[0][L].position.x,k[0][L].position.y),N.position.x-=15,N.position.x+=5*Math.cos(2*a.PI*T)),!x&&!(0,s.video_fadefx_is_fading)()){if((0,p.input_button_pressed)(D,p.IB_DOWN)&&(L=(L+1)%w,(0,l.sound_play)((0,m.soundfactory_get)("choose"))),(0,p.input_button_pressed)(D,p.IB_UP)&&(L=((L-1)%w+w)%w,(0,l.sound_play)((0,m.soundfactory_get)("choose"))),(0,p.input_button_pressed)(D,p.IB_FIRE1)||(0,p.input_button_pressed)(D,p.IB_FIRE3)){if(!R)return;var t=R[L].filepath;(0,_.logfile_message)("Loading language ".concat(R[L].title," ").concat(t)),(0,u.lang_loadfile)("data/languages/english.json"),(0,u.lang_loadfile)(t),M(t),(0,l.sound_play)((0,m.soundfactory_get)("select"))}(0,p.input_button_pressed)(D,p.IB_FIRE4)&&((0,l.sound_play)((0,m.soundfactory_get)("return")),x=!0)}if(E=Math.floor(1+L/8),I=Math.floor(1+Math.max(0,w-1)/8),(0,v.font_set_text)(O,"page %d/%d",E,I),O.position.x=s.VIDEO_SCREEN_W-(0,v.font_get_text)(O).length*(0,v.font_get_charsize)(O).x-10,O.position.y=s.VIDEO_SCREEN_H-(0,v.font_get_charsize)(O).y-3,!(0,l.music_is_playing)()){var n=(0,l.music_load)("data/music/options.mp4");(0,l.music_play)(n,!0)}if(x){if((0,s.video_fadefx_over)())return void(0,i.scenestack_pop)();(0,s.video_fadefx_out)((0,c.image_rgb)(0,0,0),1)}},t.langselect_render=function(){var e,t=(0,o.v2d_new)(s.VIDEO_SCREEN_W/2,s.VIDEO_SCREEN_H/2);for((0,s.video_clearDisplay)(),(0,b.background_render_bg)(P,t),(0,b.background_render_fg)(P,t),(0,v.font_render)(S[0],t),(0,v.font_render)(S[1],t),(0,v.font_render)(S[2],t),I>1&&(0,v.font_render)(O,t),e=8*(E-1);e<8*E;e++)y[e]&&k.length>1&&(0,v.font_render)(k[L==e?1:0][e],t);(0,h.actor_render)(N,t)},t.langselect_release=function(){C(),P=(0,b.background_unload)(P),(0,h.actor_destroy)(N),(0,v.font_destroy)(S[0]),(0,v.font_destroy)(S[1]),(0,v.font_destroy)(O),(0,p.input_destroy)(D)};var M=function(e){(0,r.preferences_set_language)(e)},B=function(){(0,_.logfile_message)("load_lang_list()"),(0,g.resourcemanager_getJsonFiles)(y).then((function(e){w=(R=e).length,k[0]=[],k[1]=[];for(var t=0;t<w;t++)R[t].filepath=y[t],k[0][t]=(0,v.font_create)(8),k[1][t]=(0,v.font_create)(8),(0,v.font_set_text)(k[0][t],R[t].LANG_LANGUAGE),(0,v.font_set_text)(k[1][t],R[t].LANG_LANGUAGE),k[0][t].position=(0,o.v2d_new)(25,75+t%8*20),k[1][t].position=(0,o.v2d_new)(25,75+t%8*20)}))},C=function(){var e;for((0,_.logfile_message)("unload_lang_list()"),e=0;e<w;e++)(0,v.font_destroy)(k[0][e]),(0,v.font_destroy)(k[1][e]);k[0]=null,k[1]=null,R=null,w=0}},3985:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pause_release=t.pause_render=t.pause_update=t.pause_init=void 0;var a=n(5858),o=n(7307),i=n(9386),r=n(2667),_=n(532),s=n(2878),c=n(642),d=n(9931),l=n(7709),u=n(7774),p=n(6038),f=n(9880),g=n(4163),m=null,v=!1,h=!1,b=0;t.pause_init=function(){m=(0,u.input_create_user)(),v=!1,h=!1,b=0},t.pause_update=function(){if((0,u.input_button_pressed)(m,u.IB_FIRE4))return(0,p.lang_getstring)("CBOX_QUIT_QUESTION"),(0,p.lang_getstring)("CBOX_QUIT_OPTION1"),(0,p.lang_getstring)("CBOX_QUIT_OPTION2"),void(0,r.scenestack_push)((0,_.storyboard_get_scene)(_.SCENE_CONFIRMBOX));if(1==(0,a.confirmbox_selected_option)()&&(h=!0),h)return(0,c.video_fadefx_over)()?((0,r.scenestack_pop)(),(0,r.scenestack_pop)(),void(0,o.quest_abort)()):void(0,c.video_fadefx_out)((0,l.image_rgb)(0,0,0),1);if(v){if((0,u.input_button_pressed)(m,u.IB_FIRE3))return(0,d.music_resume)(),void(0,r.scenestack_pop)()}else(0,u.input_button_up)(m,u.IB_FIRE3)&&(v=!0)},t.pause_render=function(){var e=(0,f.sprite_get_image)((0,f.sprite_get_animation)("SD_PAUSE",0),0),t=1+.5*Math.abs(Math.cos(i.PI/2*b));(0,s.v2d_new)((c.VIDEO_SCREEN_W-e.width)/2-(t-1)*e.width/2,(c.VIDEO_SCREEN_H-e.height)/2-(t-1)*e.height/2),h||(b+=(0,g.timer_get_delta)())},t.pause_release=function(){(0,l.image_destroy)(null),(0,u.input_destroy)(m)}},7307:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quest_getvalue=t.quest_setvalue=t.quest_getname=t.quest_abort=t.quest_setlevel=t.quest_run=t.quest_release=t.quest_render=t.quest_update=t.quest_init=t.QUESTVALUE_GLASSES=t.QUESTVALUE_BIGRINGS=t.QUESTVALUE_TOTALTIME=t.questvalue_t=void 0;var a,o=n(4054),i=n(2667),r=n(6093),_=n(2954),s=n(532),c=n(7898),d=n(5971);!function(e){e[e.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",e[e.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",e[e.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(a||(t.questvalue_t=a={})),t.QUESTVALUE_TOTALTIME=a.QUESTVALUE_TOTALTIME,t.QUESTVALUE_BIGRINGS=a.QUESTVALUE_BIGRINGS,t.QUESTVALUE_GLASSES=a.QUESTVALUE_GLASSES;var l=null,u=0,p=!1,f=[];t.quest_init=function(){var e;for(p=!1,e=0;e<3;e++)f[e]=0},t.quest_update=function(){if(0!=l.level_count)return u<l.level_count&&!p?((0,o.level_setfile)(l.level_path[u]),(0,i.scenestack_push)((0,s.storyboard_get_scene)(s.SCENE_LEVEL)),void u++):((0,i.scenestack_pop)(),void(p?(0,i.scenestack_push)((0,s.storyboard_get_scene)(s.SCENE_MENU)):l.show_ending?(0,i.scenestack_push)((0,s.storyboard_get_scene)(s.SCENE_ENDOFDEMO)):(0,i.scenestack_push)((0,s.storyboard_get_scene)(s.SCENE_QUESTOVER))));(0,c.logfile_message)("Quest '%s' has no levels. ".concat(l.file))},t.quest_render=function(){},t.quest_release=function(){(0,r.quest_unload)(l)},t.quest_run=function(e,n){void 0===n&&(n=!1),l=e,(0,d.player_set_lives)(d.PLAYER_INITIAL_LIVES),(0,d.player_set_score)(0),(0,c.logfile_message)("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),(0,t.quest_setlevel)(0)},t.quest_setlevel=function(e){u=Math.max(0,e)},t.quest_abort=function(){p=!0},t.quest_getname=function(){return"NO_QUEST_NAME"},t.quest_setvalue=function(e,t){var n=(0,_.clip)(e,0,2);f[n]=t},t.quest_getvalue=function(e){var t=(0,_.clip)(e,0,2);return f[t]}},7504:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.questover_release=t.questover_render=t.questover_update=t.questover_init=void 0;var a=n(7307),o=n(2667),i=n(532),r=n(2878),_=n(9386),s=n(642),c=n(7709),d=n(9880),l=n(9931),u=n(7774),p=n(6038),f=n(4163),g=n(3031),m=n(5176),v=n(5971),h=null,b=null,y=null,E=null,I=!1;t.questover_init=function(){(0,f.timer_get_ticks)(),I=!1,(h=(0,m.font_create)(8)).position=(0,r.v2d_new)(5,35),b=(0,m.font_create)(4),(0,m.font_set_text)(b,(0,p.lang_get)("QUESTCLEARED_TITLE")),b.position=(0,r.v2d_new)((s.VIDEO_SCREEN_W-(0,m.font_get_charsize)(b).x*(0,m.font_get_text)(b).length)/2,5),y=(0,g.actor_create)(),(0,g.actor_change_animation)(y,(0,d.sprite_get_animation)("SD_SONIC",24)),y.position=(0,r.v2d_new)(20,150),(0,l.music_play)((0,l.music_load)("data/music/invincible.mp4"),!1),E=(0,u.input_create_user)(),(0,s.video_fadefx_in)((0,c.image_rgb)(0,0,0),2)},t.questover_update=function(){var e=(0,a.quest_getname)(),t=(0,v.player_get_score)(),n=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)/3600,r=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)/60%60,d=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)%60,l=(0,a.quest_getvalue)(a.QUESTVALUE_GLASSES),g=(0,a.quest_getvalue)(a.QUESTVALUE_BIGRINGS);if((0,f.timer_get_ticks)(),(0,m.font_set_text)(h,(0,p.lang_get)("QUESTCLEARED_TEXT"),e,t,n,r,d,l,g,_.GAME_TITLE,_.GAME_WEBSITE),(0,u.input_button_pressed)(E,u.IB_FIRE1)&&(I=!0),I){if((0,s.video_fadefx_over)())return(0,o.scenestack_pop)(),void(0,o.scenestack_push)((0,i.storyboard_get_scene)(i.SCENE_MENU));(0,s.video_fadefx_out)((0,c.image_rgb)(0,0,0),2)}},t.questover_render=function(){var e=(0,r.v2d_new)(s.VIDEO_SCREEN_W/2,s.VIDEO_SCREEN_H/2);(0,s.video_clearDisplay)(),(0,m.font_render)(b,e),(0,m.font_render)(h,e),(0,g.actor_render)(y,e)},t.questover_release=function(){(0,u.input_destroy)(E),(0,g.actor_destroy)(y),(0,m.font_destroy)(b),(0,m.font_destroy)(h)}},9879:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stageselect_release=t.stageselect_render=t.stageselect_update=t.stageselect_init=void 0;var a=n(4054),o=n(2667),i=n(532),r=n(2878),_=n(9386),s=n(7898),c=n(642),d=n(7709),l=n(9931),u=n(6038),p=n(7774),f=n(9880),g=n(3450),m=n(4163),v=n(4470),h=n(5176),b=n(3031),y=n(5971),E=n(3339),I=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],x=1,w=1,S=null,k=null,O=null,R=null,L=null,N=0,D=null,T=null,P=[],M=0,B=0,C=[];t.stageselect_init=function(){B=0,N=0,T=0,L=(0,p.input_create_user)(),S=(0,h.font_create)(4),(0,h.font_set_text)(S,(0,u.lang_get)("STAGESELECT_TITLE")),S.position.x=(c.VIDEO_SCREEN_W-(0,h.font_get_text)(S).length*(0,h.font_get_charsize)(S).x)/2-150,S.position.y=10,k=(0,h.font_create)(8),(0,h.font_set_text)(k,(0,u.lang_get)("STAGESELECT_MSG")),k.position.x=10,k.position.y=c.VIDEO_SCREEN_H-1.5*(0,h.font_get_charsize)(k).y,O=(0,h.font_create)(8),(0,h.font_set_text)(O,(0,u.lang_get)("STAGESELECT_PAGE"),0,0),O.position.x=c.VIDEO_SCREEN_W-(0,h.font_get_text)(O).length*(0,h.font_get_charsize)(O).x-10,O.position.y=40,(0,E.background_load)("data/themes/levelselect.bg.json").then((function(e){D=e})),R=(0,b.actor_create)(),(0,b.actor_change_animation)(R,(0,f.sprite_get_animation)("SD_TITLEFOOT",0)),A(),(0,c.video_fadefx_in)((0,d.image_rgb)(0,0,0),1)},t.stageselect_update=function(){var e=(0,m.timer_get_delta)();if(N+=e,(0,E.background_update)(D),C.length){if(R.position=(0,r.v2d_new)(C[B].position.x,C[B].position.y),R.position.x+=3*Math.cos(2*_.PI*N)-20,x=Math.floor(B/8+1),w=Math.floor(M/8+(M%8==0?0:1)),(0,h.font_set_text)(O,(0,u.lang_get)("STAGESELECT_PAGE"),x,w),O.position.x=c.VIDEO_SCREEN_W-(0,h.font_get_text)(O).length*(0,h.font_get_charsize)(O).x-10,2==T)(0,c.video_fadefx_is_fading)()||(0,l.music_stop)();else if(!(0,l.music_is_playing)()){var t=(0,l.music_load)("data/music/options.mp4");(0,l.music_play)(t,!0)}switch(T){case 0:(0,c.video_fadefx_is_fading)()||((0,p.input_button_pressed)(L,p.IB_DOWN)&&(B=(B+1)%M,(0,l.sound_play)((0,v.soundfactory_get)("choose"))),(0,p.input_button_pressed)(L,p.IB_UP)&&(B=((B-1)%M+M)%M,(0,l.sound_play)((0,v.soundfactory_get)("choose"))),((0,p.input_button_pressed)(L,p.IB_FIRE1)||(0,p.input_button_pressed)(L,p.IB_FIRE3))&&((0,s.logfile_message)("Loading level ".concat(P[B].name," ").concat(P[B].filepath)),(0,a.level_setfile)(P[B].filepath),(0,l.sound_play)((0,v.soundfactory_get)("select")),T=2),(0,p.input_button_pressed)(L,p.IB_FIRE4)&&((0,l.sound_play)((0,v.soundfactory_get)("return")),T=1));break;case 1:if((0,c.video_fadefx_over)())return void(0,o.scenestack_pop)();(0,c.video_fadefx_out)((0,d.image_rgb)(0,0,0),1);break;case 2:if((0,c.video_fadefx_over)())return(0,y.player_set_lives)(y.PLAYER_INITIAL_LIVES),(0,y.player_set_score)(0),(0,o.scenestack_push)((0,i.storyboard_get_scene)(i.SCENE_LEVEL)),void(T=3);(0,c.video_fadefx_out)((0,d.image_rgb)(0,0,0),1);break;case 3:(0,c.video_fadefx_in)((0,d.image_rgb)(0,0,0),1),T=0}}},t.stageselect_render=function(){var e,t=(0,r.v2d_new)(c.VIDEO_SCREEN_W/2,c.VIDEO_SCREEN_H/2);for((0,E.background_render_bg)(D,t),(0,E.background_render_fg)(D,t),(0,h.font_render)(S,t),(0,h.font_render)(k,t),w>1&&(0,h.font_render)(O,t),e=8*(x-1);e<8*x;e++)P[e]&&((0,h.font_set_text)(C[e],B==e?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",P[e].name,(0,u.lang_get)("STAGESELECT_ACT"),P[e].act),(0,h.font_render)(C[e],t));(0,b.actor_render)(R,t)},t.stageselect_release=function(){j(),D=(0,E.background_unload)(D),(0,b.actor_destroy)(R),(0,h.font_destroy)(S),(0,h.font_destroy)(k),(0,h.font_destroy)(O),(0,p.input_destroy)(L)};var A=function(){(0,s.logfile_message)("load_stage_list()"),(0,g.resourcemanager_getJsonFiles)(I).then((function(e){M=(P=e).length;for(var t=0;t<M;t++)C[t]=(0,h.font_create)(8),C[t].position=(0,r.v2d_new)(25,60+t%8*20),P[t].filepath=I[t]}))},j=function(){}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(0,n(5197).engine_init)({Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null,Xquest:null,Xlanguage:null})})();