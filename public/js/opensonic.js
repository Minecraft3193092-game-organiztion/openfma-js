(()=>{"use strict";var e={689:(e,t,n)=>{n.r(t),n.d(t,{IB_DOWN:()=>W,IB_FIRE1:()=>U,IB_FIRE2:()=>Y,IB_FIRE3:()=>z,IB_FIRE4:()=>X,IB_FIRE5:()=>q,IB_LEFT:()=>K,IB_RIGHT:()=>G,IB_UP:()=>B,KEY_A:()=>j,KEY_B:()=>R,KEY_D:()=>C,KEY_DOWN:()=>x,KEY_ENTER:()=>O,KEY_ESC:()=>N,KEY_F12:()=>D,KEY_G:()=>F,KEY_LCONTROL:()=>k,KEY_LEFT:()=>w,KEY_N:()=>T,KEY_P:()=>V,KEY_RIGHT:()=>I,KEY_S:()=>M,KEY_SPACE:()=>S,KEY_TILDA:()=>L,KEY_UP:()=>E,KEY_W:()=>P,KEY_Y:()=>A,KEY_Z:()=>H,input_button_down:()=>fe,input_button_howlong:()=>ve,input_button_pressed:()=>ge,input_button_up:()=>me,input_clear:()=>xe,input_create_computer:()=>se,input_create_joystick:()=>le,input_create_keyboard:()=>ce,input_create_mouse:()=>de,input_create_user:()=>pe,input_destroy:()=>ue,input_get_xy:()=>Ie,input_ignore:()=>be,input_ignore_joystick:()=>re,input_init:()=>te,input_is_ignored:()=>Ee,input_is_joystick_ignored:()=>_e,input_joystick_available:()=>oe,input_release:()=>ie,input_render:()=>ae,input_restore:()=>ye,input_simulate_button_down:()=>he,input_update:()=>ne});var a=n(898),i=n(823),o=n(163),r=n(878),_=n(642);function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(i=a.key,o=void 0,o=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!==s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i),"symbol"===s(o)?o:String(o)),a)}var i,o}var d,l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var t,n,a;return t=e,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var n=(0,_.video_getScale)();e*=n.x,t*=n.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var n=(0,_.video_getScale)();e*=n.x,t*=n.y,!0===this._pressed&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,n=e.clientY;return this._onDown(t,n)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",e)){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var n=t.pageX,a=t.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length){var a=t[n];e.preventDefault();var i=a.pageX,o=a.pageY;return this._onMove(i,o)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}])&&c(t.prototype,n),a&&c(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();(d=l.prototype).addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},d.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},d.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;n++){var a=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}};var p,u,f,g,m,v,h,b,y,E=38,x=40,I=39,w=37,S=32,k=17,O=13,N=27,L=192,D=123,T=78,R=66,P=87,M=83,C=68,j=65,H=90,A=89,F=71,V=80,B=1,W=2,G=3,K=4,U=5,Y=6,z=7,X=8,q=9,$=null,Q=!1,J={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},Z={x:0,y:0},ee={left:!1,middle:!1,right:!1},te=function(){(0,a.logfile_message)("input_init()"),$=null,(0,_.video_get_canvas)().addEventListener("contextmenu",(function(e){if(2===e.button)return e.preventDefault(),!1}),!1),(0,_.video_get_canvas)().addEventListener("mousemove",(function(e){Z=(0,_.video_getMousePos)((0,_.video_get_canvas)(),e)}),!1),(0,_.video_get_canvas)().addEventListener("mousedown",(function(e){switch(e.which){case 1:ee.left=!0;break;case 2:ee.middle=!0;break;case 3:ee.right=!0}}),!1),(0,_.video_get_canvas)().addEventListener("mouseup",(function(e){switch(e.which){case 1:ee.left=!1;break;case 2:ee.middle=!1;break;case 3:ee.right=!1}}),!1),p=!1,u=!1,b=(0,i.KP)(),console.log("canGamepad",b),(Q=(0,i.nw)())&&(console.log("21111",(0,_.video_get_canvas)()),(g=new l({container:(0,_.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2||t.pageY<window.innerHeight/2)})),(m=new l({container:(0,_.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY<window.innerHeight/2)})),(v=new l({container:(0,_.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2||t.pageY>window.innerHeight/2)})),(h=new l({container:(0,_.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY>window.innerHeight/2)}))),f=ke(J)},ne=function(){var e,t,n=(0,o.timer_get_delta)();for(t=$;t;t=t.next){for(e=0;e<9;e++)t.data.oldstate[e]=t.data.state[e];for(e=0;e<9;e++)fe(t.data,e)?t.data.howlong[e]+=n:t.data.howlong[e]=0;switch(t.data.type){case 1:t.data.state[B]=f.up,t.data.state[W]=f.down,t.data.state[K]=f.left,t.data.state[G]=f.right,t.data.state[U]=f.space,t.data.state[Y]=f.lcontrol,t.data.state[z]=f.enter,t.data.state[X]=f.esc,t.data.state[q]=f.tilda;break;case 4:t.data.x=Z.x,t.data.y=Z.y,t.data.state[U]=ee.left,t.data.state[z]=ee.middle,t.data.state[Y]=ee.right;break;case 2:for(e=0;e<9;e++)t.data.state[e]=!1;break;case 3:oe()&&(t.data.state[B]=joy[0].stick[0].axis[1].d1,t.data.state[W]=joy[0].stick[0].axis[1].d2,t.data.state[K]=joy[0].stick[0].axis[0].d1,t.data.state[G]=joy[0].stick[0].axis[0].d2,t.data.state[U]=joy[0].button[0].b,t.data.state[Y]=joy[0].button[1].b,t.data.state[z]=joy[0].button[2].b,t.data.state[X]=joy[0].button[3].b);break;case 0:t.data.state[B]=f.up,t.data.state[W]=f.down,t.data.state[K]=f.left,t.data.state[G]=f.right,t.data.state[U]=f.space,t.data.state[Y]=f.lcontrol,t.data.state[z]=f.enter,t.data.state[X]=f.esc,Q&&(t.data.state[B]=g.up(),t.data.state[W]=g.down(),t.data.state[K]=g.left(),t.data.state[G]=g.right(),t.data.state[U]=m._pressed,t.data.state[X]=v._pressed,t.data.state[Y]=h._pressed),b&&(y=Oe()),y&&(t.data.state[B]=y.buttons[12].pressed,t.data.state[W]=y.buttons[13].pressed,t.data.state[K]=y.buttons[14].pressed,t.data.state[G]=y.buttons[15].pressed,t.data.state[U]=y.buttons[0].pressed,t.data.state[Y]=y.buttons[1].pressed,t.data.state[z]=y.buttons[2].pressed,t.data.state[X]=y.buttons[3].pressed)}}},ae=function(){g&&g.render((0,_.video_get_backbuffer)()),m&&m.render((0,_.video_get_backbuffer)()),v&&v.render((0,_.video_get_backbuffer)()),h&&h.render((0,_.video_get_backbuffer)())},ie=function(){},oe=function(){return p&&!u},re=function(e){u=e},_e=function(){return u},se=function(){var e,t={type:2,enabled:!0};for(t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return we(t),t},ce=function(e){var t,n={type:1,enabled:!0};for(n.dx=n.dy=n.x=n.y=0,n.state=[],n.oldstate=[],n.howlong=[],t=0;t<9;t++)n.state[t]=n.oldstate[t]=!1,n.howlong[t]=0;if(e)for(n.keybmap=[],t=0;t<9;t++)n.keybmap[t]=e[t];else n.keybmap[B]=E,n.keybmap[W]=x,n.keybmap[G]=I,n.keybmap[K]=w,n.keybmap[U]=S,n.keybmap[Y]=k,n.keybmap[z]=O,n.keybmap[X]=N,n.keybmap[q]=L;return we(n),n},de=function(){var e,t={type:4,enabled:!0};for(t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return we(t),t},le=function(){if(!oe())return(0,a.logfile_message)("WARNING: called input_create_joystick(), but no joystick is available!"),null;var e,t={type:3,enabled:!0};for(t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return we(t),t},pe=function(){var e={type:0,enabled:!0};e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[];for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return e.keybmap=[],e.keybmap[B]=E,e.keybmap[W]=x,e.keybmap[G]=I,e.keybmap[K]=w,e.keybmap[U]=S,e.keybmap[Y]=k,e.keybmap[z]=O,e.keybmap[X]=N,we(e),e},ue=function(e){Se(e),e=null},fe=function(e,t){return!!t&&!!e.enabled&&e.state[parseInt(t,10)]},ge=function(e,t){return!!t&&!!e.enabled&&e.state[parseInt(t,10)]&&!e.oldstate[parseInt(t,10)]},me=function(e,t){return!t||!!e.enabled&&!e.state[parseInt(t,10)]&&e.oldstate[parseInt(t,10)]},ve=function(e,t){return e.enabled?e.howlong[parseInt(t,10)]:0},he=function(e,t){e.state[parseInt(t,10)]=!0},be=function(e){e.enabled=!1},ye=function(e){e.enabled=!0},Ee=function(e){return!e.enabled},xe=function(e){for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1},Ie=function(e){return(0,r.v2d_new)(e.x,e.y)},we=function(e){var t={};t.data=e,t.next=$,$=t},Se=function(e){var t,n;if($.data==e)n=$.next,$=null,$=n;else{for(t=$;t.next&&t.next.data!=e;)t=t.next;t.next&&(n=t.next.next,t.next=null,t.next=n)}},ke=function(e){var t=Object.create(null);function n(n){if(e.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;t[e[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),t},Oe=function(){return"undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)}},120:(e,t,n)=>{n.d(t,{$C:()=>O,$c:()=>M,B$:()=>H,HI:()=>b,HN:()=>h,Ib:()=>L,Ix:()=>I,K1:()=>C,SI:()=>P,TK:()=>k,Tl:()=>E,ih:()=>S,jP:()=>R,jW:()=>N,kj:()=>D,lY:()=>w,nG:()=>j,q8:()=>x,rE:()=>T,xG:()=>A,z7:()=>y});var a=n(386),i=n(878),o=n(689),r=n(709),_=n(642),s=n(163),c=n(880),d=n(954),l=n(429),p=void 0,u=!0,f=!1,g=!1,m=!1,v=!1,h=function(){var e={};return e.spawn_point=(0,i.v2d_new)(0,0),e.position=(0,i.v2d_new)(e.spawn_point.x,e.spawn_point.y),e.angle=0,e.speed=(0,i.v2d_new)(0,0),e.maxspeed=0,e.acceleration=0,e.jump_strength=0,e.is_jumping=!1,e.ignore_horizontal=!1,e.input=null,e.animation=null,e.animation_frame=0,e.animation_speed_factor=1,e.mirror=!1,e.visible=!0,e.alpha=1,e.hot_spot=(0,i.v2d_new)(0,0),e.carried_by=null,e.carry_offset=(0,i.v2d_new)(0,0),e.carrying=null,e},b=function(e){e.input&&(0,o.input_destroy)(e.input),e=null},y=function(e,t){var n;if(t&&e&&(e.visible&&e.animation)){if(e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),e.position,!(n=I(e)))return!1;e.mirror&&B((0,_.video_get_backbuffer)(),parseInt(e.position.x-(t.x-_.VIDEO_SCREEN_W/2),10));var a=parseInt(e.position.x-(t.x-_.VIDEO_SCREEN_W/2),10),i=parseInt(e.position.y-(t.y-_.VIDEO_SCREEN_H/2),10),o=e.mirror?e.angle:-e.angle;e.angle&&((0,_.video_get_backbuffer)().translate(a,i),(0,_.video_get_backbuffer)().rotate(o),(0,_.video_get_backbuffer)().translate(-a,-i)),(0,_.video_get_backbuffer)().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,parseInt(e.position.x-e.hot_spot.x-(t.x-_.VIDEO_SCREEN_W/2),10),parseInt(e.position.y-e.hot_spot.y-(t.y-_.VIDEO_SCREEN_H/2),10),n.width*_.VIDEO_SCALE,n.height*_.VIDEO_SCALE),e.angle&&((0,_.video_get_backbuffer)().translate(a,i),(0,_.video_get_backbuffer)().rotate(-o),(0,_.video_get_backbuffer)().translate(-a,-i)),e.mirror&&B((0,_.video_get_backbuffer)(),parseInt(e.position.x-(t.x-_.VIDEO_SCREEN_W/2),10))}},E=function(e,t,n,i){var o,r,c,d,l,p={};if(e.visible&&e.animation){if(isNaN(e.animation_frame)&&(e.animation_frame=0,e.animation.fps=1),e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),!(l=I(e)))return!1;for(p.x=e.position.x%(n?l.width:a.INT_MAX)-e.hot_spot.x-(t.x-_.VIDEO_SCREEN_W/2)-(n?l.width:0),p.y=e.position.y%(i?l.height:a.INT_MAX)-e.hot_spot.y-(t.y-_.VIDEO_SCREEN_H/2)-(i?l.height:0),c=n?_.VIDEO_SCREEN_W/l.width+3:1,d=i?_.VIDEO_SCREEN_H/l.height+3:1,o=0;o<c;o++)for(r=0;r<d;r++)(0,_.video_get_backbuffer)().drawImage(l.data,l.sx,l.sy,l.swidth,l.sheight,p.x+o*l.width,p.y+r*l.height,l.width*_.VIDEO_SCALE,l.height*_.VIDEO_SCALE)}},x=function(e,t){t||(t={x:0,y:0}),t.x=t.x||0,t.y=t.y||0,Math.abs(t.x)<a.EPSILON&&(t.x=0),e.position.x+=t.x*Math.cos(e.angle)+t.y*Math.sin(e.angle),e.position.y+=t.y*Math.cos(e.angle)-t.x*Math.sin(e.angle)},I=function(e){return(0,c.sprite_get_image)(e.animation,parseInt(e.animation_frame,10))},w=function(e,t){return e.animation_frame=(0,d.clip)(t,0,e.animation.frame_count),e},S=function(e,t){return e.animation_speed_factor=Math.max(0,t),e},k=function(e,t){return!(!e||!t)&&(e.animation!=t&&(e.animation=t,e.hot_spot=t.hot_spot,e.animation_frame=0,e.animation_speed_factor=1),e)},O=function(e){var t=e.animation_frame+e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)();return!e.animation.repeat&&t>e.animation.frame_count-1},N=function(e,t){var n=0,o=0,r=[];if(r[0]=[],r[1]=[],r[0][0]=(0,i.v2d_subtract)(e.position,(0,i.v2d_rotate)(e.hot_spot,-e.angle)),r[0][1]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)(I(e).width,0),-e.angle)),r[0][2]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)(I(e).width,I(e).height),-e.angle)),r[0][3]=(0,i.v2d_add)(r[0][0],(0,i.v2d_rotate)((0,i.v2d_new)(0,I(e).height),-e.angle)),r[1][0]=(0,i.v2d_subtract)(t.position,(0,i.v2d_rotate)(t.hot_spot,0)),r[1][1]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)(I(t).width,0),0)),r[1][2]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)(I(t).width,I(t).height),0)),r[1][3]=(0,i.v2d_add)(r[1][0],(0,i.v2d_rotate)((0,i.v2d_new)(0,I(t).height),0)),o+=Math.abs(e.angle)<a.EPSILON||Math.abs(e.angle-a.PI/2)<a.EPSILON||Math.abs(e.angle-a.PI)<a.EPSILON||Math.abs(e.angle-3*a.PI/2)<a.EPSILON,o+=Math.abs(0)<a.EPSILON||Math.abs(0-a.PI/2)<a.EPSILON||Math.abs(0-a.PI)<a.EPSILON||Math.abs(0-3*a.PI/2)<a.EPSILON){var _=[],s=[];for(n=0;n<2;n++)_[n]=[],_[n][0]=Math.min(r[n][0].x,r[n][1].x),_[n][1]=Math.min(r[n][0].y,r[n][1].y),_[n][2]=Math.max(r[n][2].x,r[n][3].x),_[n][3]=Math.max(r[n][2].y,r[n][3].y),_[n][0]>_[n][2]&&(s=(0,d.swap)(_[n][0],_[n][2]),_[n][0]=s[0],_[n][2]=s[1]),_[n][1]>_[n][3]&&(s=(0,d.swap)(_[n][1],_[n][3]),_[n][1]=s[0],_[n][3]=s[1]);return(0,d.bounding_box)(_[0],_[1])}var c=[],l=[Math.max(I(e).width,I(e).height),Math.max(I(t).width,I(t).height)];for(n=0;n<2;n++)c[n]=(0,i.v2d_multiply)((0,i.v2d_add)(r[n][0],r[n][2]),.5);return(0,d.circular_collision)(c[0],l[0],c[1],l[1])},L=function(e,t){var n,i,o,_;return Math.abs(e.angle)<a.EPSILON&&Math.abs(t.angle)<a.EPSILON?!!N(e,t)&&(n=parseInt(e.position.x-e.hot_spot.x,10),i=parseInt(e.position.y-e.hot_spot.y,10),o=parseInt(t.position.x-t.hot_spot.x,10),_=parseInt(t.position.y-t.hot_spot.y,10),(0,r.image_pixelperfect_collision)(I(e),I(t),n,i,o,_)):!!function(e,t){var n={},a={},i={},o={},r=[],_=[];return r=V(p,e,r),_=V(p,t,_),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),a.x=Math.min(_[0].x,Math.min(_[1].x,Math.min(_[2].x,_[3].x))),a.y=Math.min(_[0].y,Math.min(_[1].y,Math.min(_[2].y,_[3].y))),i.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,i.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,o.x=Math.max(_[0].x,Math.max(_[1].x,Math.max(_[2].x,_[3].x)))-a.x,o.y=Math.max(_[0].y,Math.max(_[1].y,Math.max(_[2].y,_[3].y)))-a.y,n.x+i.x>=a.x&&n.x<=a.x+o.x&&n.y+i.y>=a.y&&n.y<=a.y+o.y}(e,t)},D=function(e,t,n,a,o,r,_,s,c,d,l,p){var u=I(e).width,f=I(e).height,g=e.position,m=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(0,-f+n),-e.angle)),v=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(0,-n),-e.angle)),h=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(-u/2+n,.5*-f),-e.angle)),b=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(u/2-n,.5*-f),-e.angle)),y=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(-u/2+n,-f+n),-e.angle)),E=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(u/2-n,-f+n),-e.angle)),x=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(-u/2+n,-n),-e.angle)),w=(0,i.v2d_add)(g,(0,i.v2d_rotate)((0,i.v2d_new)(u/2-n,-n),-e.angle));return T(e,t,m,E,b,w,v,x,h,y,a,o,r,_,s,c,d,l,p)},T=function(e,t,n,a,i,o,r,_,s,c,d,l,p,u,f,g,m,v,h){var b=[n.x-t,n.y-t,n.x+t,n.y+t],y=[r.x-t,r.y-t,r.x+t,r.y+t],E=[s.x-t,s.y-t,s.x+t,s.y+t],x=[i.x-t,i.y-t,i.x+t,i.y+t],I=[c.x-t,c.y-t,c.x+t,c.y+t],w=[a.x-t,a.y-t,a.x+t,a.y+t],S=[_.x-t,_.y-t,_.x+t,_.y+t],k=[o.x-t,o.y-t,o.x+t,o.y+t];return d&&(n&&(l=F(d,b)),r&&(g=F(d,y)),s&&(v=F(d,E)),i&&(u=F(d,x)),c&&(h=F(d,I)),a&&(p=F(d,w)),_&&(m=F(d,S)),o&&(f=F(d,k))),{up:l,down:g,left:v,right:u,upleft:h,upright:p,downleft:m,downright:f}},R=function(e){u=e},P=function(){R(!0)},M=function(e,t,n,a){f=e,g=t,m=n,v=a},C=function(e,t,n,a,i,o,r,_,s,c){var d,p=[n,a,i,s,c];for(d=0;d<p.length;d++){var u=p[d];u&&u.brick_ref&&u.brick_ref.property==l.p2&&(u=null,p[d]=u)}if(r&&r.brick_ref&&r.brick_ref.property==l.p2){var f=Math.min(15,r.brick_ref.image.height/3);e.speed.y>=0&&e.position.y<r.y+t+1+f||(_&&_==r&&(_=null),o&&o==r&&(o=null),r=null)}return{up:p[0],upright:p[1],right:p[2],left:p[3],upleft:p[4],downright:o,down:r,downleft:_}},j=function(e,t,n){var r,_,c,d,l,p,u,f,g,m,v,h=(0,i.v2d_new)(0,0),b=(0,s.timer_get_delta)(),y=e.position,E=function(e,t,n,o,r,_,s,c,d,l){var p,u,f,g=I(e).width,m=I(e).height,v=!(Math.abs(e.angle)<a.EPSILON||Math.abs(e.angle-a.PI/2)<a.EPSILON||Math.abs(e.angle-a.PI)<a.EPSILON||Math.abs(e.angle-3*a.PI/2)<a.EPSILON),h=e.position;return v?(p=1,u=.7,f=.25):(p=.7,u=.5,f=.25),{up:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(0,-m*p+t),-e.angle)),down:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(0,2),-e.angle)),left:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(-g*f+t,-m*u),-e.angle)),right:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(g*f-t,-m*u),-e.angle)),upleft:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(-g*f+t,-m*p+t),-e.angle)),upright:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(g*f-t,-m*p+t),-e.angle)),downleft:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(-g*f+t,2),-e.angle)),downright:(0,i.v2d_add)(h,(0,i.v2d_rotate)((0,i.v2d_new)(g*f-t,2),-e.angle))}}(e,-2);E=function(e,t,n,a,i,o,r,_,s,c,d,l,p,u,f,g,m,v){return T(e,2,n,a,i,o,r,_,s,c,t,d,l,p,u,f,g,m,v)}(e,t,r=E.up,E.upright,_=E.right,E.downright,E.down,E.downleft,c=E.left,E.upleft,d,l,p,u,f,g,m,v),d=E.up,l=E.upright,p=E.right,u=E.downright,f=E.down,g=E.downleft,m=E.left,v=E.upleft;var w=C(e,-2,d,l,p,u,f,g,m,v);return d=w.up,l=w.upright,p=w.right,m=w.left,v=w.upleft,f=w.down,g=w.downleft,u=w.downright,function(e,t){var n=(0,s.timer_get_delta)();if(null!=e.carried_by){var a=e.carried_by;t&&0==t.brick_ref.angle&&parseInt(a.speed.y,10)>=5?(e.position=(0,i.v2d_new)(e.carried_by.position.x,e.carried_by.position.y),e.carried_by.carrying=null,e.carried_by=null):(e.speed=(0,i.v2d_new)(0,0),e.mirror=a.mirror,e.angle=0,e.position=(0,i.v2d_subtract)((0,i.v2d_add)(a.position,(0,i.v2d_multiply)(a.speed,n)),e.carry_offset))}}(e,f),null!=e.carried_by?(0,i.v2d_new)(0,0):(function(e,t,n,i,o,r){r&&r.brick_ref.angle%90==0&&(e.speed.x>a.EPSILON||i.x>r.x)&&(e.speed.x=0,e.position.x=r.x+(t.x-i.x)),o&&o.brick_ref.angle%90==0&&(e.speed.x<-a.EPSILON||n.x<o.x+o.brick_ref.image.width)&&(e.speed.x=0,e.position.x=o.x+o.brick_ref.image.width+(t.x-n.x))}(e,y,c,_,m,p),f?(e.is_jumping=!1,e.ignore_horizontal=!1,function(e,t,n,a,r){var _=a.brick_ref.angle;!(0,o.input_button_down)(e.input,o.IB_FIRE1)||(0,o.input_button_down)(e.input,o.IB_DOWN)||r||(e.angle=0,e.is_jumping=!0,0==_?e.speed.y=-e.jump_strength:_>0&&_<90?(e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=-.7*e.jump_strength):90==_?(actor.move(e,(0,i.v2d_new)(-40,0)),e.speed.x=Math.min(e.speed.x,-e.jump_strength),e.speed.y=-e.jump_strength/2):_>90&&_<180?(actor.move(e,(0,i.v2d_new)(0,40)),e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=e.jump_strength):180==_?(actor.move(e,(0,i.v2d_new)(0,40)),e.speed.x*=-1,e.speed.y=e.jump_strength):_>180&&_<270?(actor.move(e,(0,i.v2d_new)(0,40)),e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=e.jump_strength):270==_?(actor.move(e,(0,i.v2d_new)(40,0)),e.speed.x=Math.max(e.speed.x,e.jump_strength),e.speed.y=-e.jump_strength/2):_>270&&_<360&&(e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=-.7*e.jump_strength))}(e,0,0,f,d)):e.angle=0,h.y=Math.abs(e.speed.y)>a.EPSILON?e.speed.y*b+1*n*.5*(b*b):0,e.speed.y=Math.min(e.speed.y+1*n*b,480),function(e,t,n,i){i&&i.brick_ref.angle%90==0&&e.speed.y<-a.EPSILON&&(e.position.y=i.y+i.brick_ref.image.height+(t.y-n.y),e.speed.y=10)}(e,y,r,d),function(e,t,n,o,r,_,c,d,l){var p;if((0,s.timer_get_delta)(),d&&!e.is_jumping)if(p=d.brick_ref.angle,e.speed.y=o.y=0,e.angle=p*a.PI/180,0==p)e.position.y=r.y+t;else if(p>0&&p<90)r.y=d.y+d.brick_ref.image.height-(e.position.x-d.x)*Math.tan(e.angle),e.position.y=r.y+t,e.mirror,a.IF_HFLIP;else if(90==p){if(Math.abs(e.speed.x)>5){var u=l?l.brick_ref.angle:-1;l&&u>=p&&u<p+90?(r.y=d.x,e.position.x=r.y+t):(e.angle=0,x(e,(0,i.v2d_new)(-13,0)),e.is_jumping=!0,e.speed=(0,i.v2d_new)(0,-.7*Math.abs(e.speed.x)))}else e.angle=0,x(e,(0,i.v2d_new)(-10,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,a.IF_HFLIP}else if(p>90&&p<180)Math.abs(e.speed.x)>5?(r.y=d.y-(e.position.x-d.x)*Math.tan(e.angle),e.position.y=r.y-t):(e.angle=0,x(e,(0,i.v2d_new)(0,30)),e.is_jumping=!0);else if(180==p)e.speed.x>5&&!(e.mirror&a.IF_HFLIP)||e.speed.x<-5&&e.mirror&a.IF_HFLIP?(r.y=d.y+d.brick_ref.image.height,e.position.y=r.y-t):(e.angle=0,x(e,(0,i.v2d_new)(0,40)),e.is_jumping=!0,e.speed.x=0);else if(p>180&&p<270)Math.abs(e.speed.x)>5?(r.y=d.y+d.brick_ref.image.height-(e.position.x-d.x)*Math.tan(e.angle),e.position.y=r.y-t):(e.angle=0,x(e,(0,i.v2d_new)(0,30)),e.is_jumping=!0);else if(270==p){if(Math.abs(e.speed.x)>5){var f=c?c.brick_ref.angle:-1;c&&f>p-90&&f<=p?(r.y=d.x+d.brick_ref.image.width,e.position.x=r.y-t):(e.angle=0,x(e,(0,i.v2d_new)(13,0)),e.is_jumping=!0,e.speed=(0,i.v2d_new)(0,-.7*Math.abs(e.speed.x)))}else e.angle=0,x(e,(0,i.v2d_new)(10,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,a.IF_HFLIP}else p>270&&p<360&&(r.y=d.y-(e.position.x-d.x)*Math.tan(e.angle),e.position.y=r.y+t,e.mirror,a.IF_HFLIP)}(e,-2,0,h,y,0,g,f,u),h.x=Math.abs(e.speed.x)>a.EPSILON?e.speed.x*b+1*e.acceleration*.5*(b*b):0,function(e,t,n){var i=(0,s.timer_get_delta)();if((0,o.input_button_down)(e.input,o.IB_LEFT)&&!(0,o.input_button_down)(e.input,o.IB_RIGHT))e.ignore_horizontal||(0,o.input_button_down)(e.input,o.IB_DOWN)||(e.speed.x=Math.max(e.speed.x-1*e.acceleration*i,-e.maxspeed),e.mirror=a.IF_HFLIP);else if((0,o.input_button_down)(e.input,o.IB_RIGHT)&&!(0,o.input_button_down)(e.input,o.IB_LEFT))e.ignore_horizontal||(0,o.input_button_down)(e.input,o.IB_DOWN)||(e.speed.x=Math.min(e.speed.x+1*e.acceleration*i,e.maxspeed),e.mirror=IF_NONE);else if(n){var r=0,_=n.brick_ref.angle;_%90==0?r=90==_&&e.mirror&a.IF_HFLIP&&e.speed.x<0||270==_&&!(e.mirror&a.IF_HFLIP)&&e.speed.x>0?e.speed.x>a.EPSILON?1:-e.speed.x>a.EPSILON?-1:0:e.speed.x>a.EPSILON?-1:-e.speed.x>a.EPSILON?1:0:(_>90&&_<180||_>180&&_<270)&&(r=e.speed.x>a.EPSILON?-1:-e.speed.x>a.EPSILON?1:0),e.speed.x+=1*r*e.acceleration*i}}(e,0,f),Math.abs(e.speed.x)<a.EPSILON&&(e.speed.x=h.x=0),h)},H=function(e,t){var n=(0,s.timer_get_delta)(),a=(0,i.v2d_new)(0,0);return a.x=e.speed.x*n,a.y=e.speed.y*n+.5*t*n*n,e.speed.y+=t*n,a},A=function(e){var t=(0,s.timer_get_delta)(),n=(0,i.v2d_new)(0,0);return e.input?((0,o.input_button_down)(e.input,o.IB_RIGHT)&&!(0,o.input_button_down)(e.input,o.IB_LEFT)&&(e.speed.x=Math.min(e.speed.x+e.acceleration*t,e.maxspeed)),(0,o.input_button_down)(e.input,o.IB_LEFT)&&!(0,o.input_button_down)(e.input,o.IB_RIGHT)&&(e.speed.x=Math.max(e.speed.x-e.acceleration*t,-e.maxspeed)),!(0,o.input_button_down)(e.input,o.IB_LEFT)&&!(0,o.input_button_down)(e.input,o.IB_RIGHT)&&Math.abs(e.speed.x)>a.EPSILON&&(e.speed.x>0?e.speed.x=Math.max(e.speed.x-e.acceleration*t,0):e.speed.x=Math.min(e.speed.x+e.acceleration*t,0)),(0,o.input_button_down)(e.input,o.IB_DOWN)&&!(0,o.input_button_down)(e.input,o.IB_UP)&&(e.speed.y=Math.min(e.speed.y+e.acceleration*t,e.maxspeed)),(0,o.input_button_down)(e.input,o.IB_UP)&&!(0,o.input_button_down)(e.input,o.IB_DOWN)&&(e.speed.y=Math.max(e.speed.y-e.acceleration*t,-e.maxspeed)),!(0,o.input_button_down)(e.input,o.IB_UP)&&!(0,o.input_button_down)(e.input,o.IB_DOWN)&&Math.abs(e.speed.y)>a.EPSILON&&(e.speed.y>0?e.speed.y=Math.max(e.speed.y-e.acceleration*t,0):e.speed.y=Math.min(e.speed.y+e.acceleration*t,0))):e.speed=(0,i.v2d_new)(0,0),n.x=Math.abs(e.speed.x)>a.EPSILON?e.speed.x*t+.5*e.acceleration*t*t:0,n.y=0,e.speed.x=n.x,e.speed.y=n.y,n},F=function(e,t){var n,i,o,r,_,s,c,p=null,h=!1;for(n=e;n&&!h;n=n.next)if(n.data){if(n.data.brick_ref.property==l.Bs||!n.data.enabled)continue;if(n.data.brick_ref.property==l.p2&&p&&p.brick_ref.property==l.Pi)continue;if(n.data.brick_ref.behavior==l.w6&&p&&p.brick_ref.behavior!=l.w6&&n.data.y>=p.y)continue;if(m&&0==n.data.brick_ref.angle)continue;if(v&&180==n.data.brick_ref.angle)continue;if(g&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(f&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var b=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if((0,d.bounding_box)(t,b))if(n.data.brick_ref.behavior!=l.w6&&p&&p.brick_ref.behavior==l.w6&&n.data.y<=p.y)p=n.data;else if(n.data.brick_ref.property==l.Pi&&p&&p.brick_ref.property==l.p2)p=n.data;else if(n.data.brick_ref.property==l.p2&&p&&p.brick_ref.property==l.p2)n.data.y>p.y&&(p=n.data);else if(n.data.brick_ref.angle%90==0)p?u?p.brick_ref.angle%180!=0&&(p=n.data):p.brick_ref.angle%180==0&&(p=n.data):p=n.data;else for(i=n.data.brick_ref.angle,s=Math.tan(i*a.PI/180),r=t[0];r<=t[2]&&!h;r++)for(_=t[1];_<=t[3]&&!h;_++){switch(o=!1,parseInt(i/90,10)%4){case 0:c=b[3]+s*(b[0]-r),o=b[0]<=r&&r<=b[2]&&c<=_&&_<=b[3];break;case 1:c=b[3]-s*(b[2]-r),o=b[0]<=r&&r<=b[2]&&b[1]<=_&&_<=c;break;case 2:c=b[3]-s*(b[0]-r),o=b[0]<=r&&r<=b[2]&&b[1]<=_&&_<=c;break;case 3:c=b[3]+s*(b[2]-r),o=b[0]<=r&&r<=b[2]&&c<=_&&_<=b[3]}o&&(p=n.data,h=!0)}}return p},V=function(e,t,n){var a,o,r,_,s,c,d,l,p;return r=-t.angle,a=I(t).width,o=I(t).height,l=t.hot_spot,p=t.position,_=(0,i.v2d_subtract)((0,i.v2d_new)(0,0),l),s=(0,i.v2d_subtract)((0,i.v2d_new)(a,0),l),c=(0,i.v2d_subtract)((0,i.v2d_new)(a,o),l),d=(0,i.v2d_subtract)((0,i.v2d_new)(0,o),l),n[0]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(_,r)),n[1]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(s,r)),n[2]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(c,r)),n[3]=(0,i.v2d_add)(p,(0,i.v2d_rotate)(d,r)),n},B=function(e,t){return e.translate(t,0),e.scale(-1,1),e.translate(-t,0),e}},51:(e,t,n)=>{n.d(t,{A4:()=>f,Ed:()=>m,mw:()=>g,pW:()=>u,vm:()=>p});var a=n(386),i=n(878),o=n(880),r=n(642),_=n(898),s=n(163),c=n(450),d=n(954),l=n(120),p=function(e){return new Promise((function(t,n){(0,_.logfile_message)("background_load('%s')",e),(0,c.resourcemanager_getJsonFile)(e).then(E).then((function(e){t(e)}))}))},u=function(e){return(0,_.logfile_message)("background_unload()"),null},f=function(e){if(!e)return!1;var t,n;for(t=0;t<e.length;t++)(n=e[t]).strategy&&n.strategy.update&&n.strategy.update(n.strategy)},g=function(e,t){v(e,t,!1)},m=function(e,t){v(e,t,!0)},v=function(e,t,n){if(e){var a,o,_=(0,i.v2d_new)(r.VIDEO_SCREEN_W/2,r.VIDEO_SCREEN_H/2),s=(0,i.v2d_subtract)(t,_);for(a=0;a<e.length;a++)o=e[a],(!n&&o.zindex<=.5||n&&o.zindex>.5)&&(o.actor.position.x+=s.x*o.actor.speed.x,o.actor.position.y+=s.y*o.actor.speed.y,(0,l.Tl)(o.actor,_,o.repeat_x,o.repeat_y),o.actor.position.y-=s.y*o.actor.speed.y,o.actor.position.x-=s.x*o.actor.speed.x)}},h=function(e){},b=function(e){var t=e,n=e.background,a=(0,s.timer_get_delta)();n.actor.position.x+=t.speed_x*a,n.actor.position.y+=t.speed_y*a},y=function(e){var t,n,a,i=e,o=e.background,r=(0,s.timer_get_delta)();t=i.timer+=r,n=Math.sin(i.angularspeed_x*t+i.initialphase_x),a=Math.cos(i.angularspeed_y*t+i.initialphase_y),o.actor.position.x+=-i.angularspeed_x*i.amplitude_x*n*r,o.actor.position.y+=i.angularspeed_y*i.amplitude_y*a*r},E=function(e){var t=e.bg;return Promise.all(t.map(x))},x=function(e,t){return new Promise((function(t,n){var r,_=function(){var e={};return e.actor=(0,l.HN)(),e.data=null,e.strategy=null,e.repeat_x=!1,e.repeat_y=!1,e.zindex=0,e}();switch(_.actor.spawn_point.x=e.initial_position.xpos,_.actor.spawn_point.y=e.initial_position.ypos,_.actor.position=(0,i.v2d_new)(_.actor.spawn_point.x,_.actor.spawn_point.y),_.actor.speed.x=e.scroll_speed.xspeed,_.actor.speed.y=e.scroll_speed.yspeed,e.behavior&&(0,d.isArray)(e.behavior)?e.behavior[0]:e.behavior){case"DEFAULT":_.strategy&&(_.strategy=(_.strategy,null)),_.strategy=((r={}).background=_,r.update=h,r);break;case"LINEAR":_.strategy&&(_.strategy=(_.strategy,null)),_.strategy=function(e,t,n){var a={},i=a;return i.background=e,i.update=b,a.speed_x=t,a.speed_y=n,i}(_,e.behavior[1],e.behavior[2]);break;case"CIRCULAR":_.strategy&&(_.strategy=(_.strategy,null)),_.strategy=function(e,t,n,i,o,r,_){var s={},c=s;return c.background=e,c.update=y,s.timer=0,s.amplitude_x=t,s.amplitude_y=n,s.angularspeed_x=2*a.PI*i,s.angularspeed_y=2*a.PI*o,s.initialphase_x=r*a.PI/180,s.initialphase_y=_*a.PI/180,c}(_,e.behavior[1],e.behavior[2],e.behavior[3],e.behavior[4],e.behavior[5],e.behavior[6])}_.repeat_x=e.repeat_x,_.repeat_y=e.repeat_y,e.zindex&&(_.zindex=e.zindex),(0,o.sprite_create)(e.sprite).then((function(e){_.data=e,_.actor.animation=e,_.actor.animation.data=[0],_.actor.image=_.actor.animation.frame_data[0],t(_)}))}))}},429:(e,t,n)=>{n.d(t,{Bs:()=>s,CH:()=>g,Dx:()=>v,Nf:()=>p,Pi:()=>c,Qb:()=>S,Uz:()=>m,Vd:()=>b,Yj:()=>f,b9:()=>O,bM:()=>k,gY:()=>y,kJ:()=>l,m$:()=>w,mT:()=>I,p2:()=>d,q4:()=>h,w6:()=>u});var a=n(880),i=n(450),o=n(163),r=n(898),_=n(954),s=0,c=1,d=2,l=5,p=0,u=1,f=2,g=3,m=0,v=1,h=2,b=3,y=1,E=0,x=[],I=function(e){return new Promise((function(t,n){(0,r.logfile_message)("brickdata_load('%s')",e),(0,i.resourcemanager_getJsonFile)(e).then(N).then((function(e){x=e})).then(t)}))},w=function(e){return x[e]},S=function(){return E},k=function(e){var t=e.brick_ref.data;if(null!=t&&t.animation_data.length){t.animation_data[0].repeat;var n=t.animation_data[0].frame_count;e.animation_frame+=t.animation_data[0].fps*(0,o.timer_get_delta)(),e.animation_frame>t.animation_data[0].frame_count-1&&(e.animation_frame=0),n=parseInt(e.animation_frame,10),e.brick_ref.image=t.frame_data[t.animation_data[0].data[n]]}return e},O=function(e){return e.brick_ref.image},N=function(e){var t=e.bricks;return Promise.all(t.map(L))},L=function(e){return new Promise((function(t,n){var i=function(){var e,t={data:null,image:null};for(t.property=s,t.angle=0,t.behavior=p,t.zindex=.5,t.behavior_arg=[],e=0;e<l;e++)t.behavior_arg[e]=0;return t}(),o=e.type;"OBSTACLE"==o?i.property=c:"PASSABLE"==o?i.property=s:"CLOUD"==o?i.property=d:(0,r.logfile_message)("Can't read brick attributes: unknown brick type '%s'",o),"DEFAULT"==(o=(0,_.isArray)(e.behavior)?e.behavior[0]:e.behavior)?i.behavior=p:"CIRCULAR"==o?i.behavior=u:"BREAKABLE"==o?i.behavior=f:"FALL"==o?i.behavior=g:(0,r.logfile_message)("Can't read brick attributes: unknown brick type '%s'",o);for(var m=0;m<l;m++)i.behavior_arg[m]=e.behavior[1+m];i.behavior_arg[i.behavior_arg.length-1]=0,i.angle=e.angle,e.zindex&&(i.zindex=e.zindex),(0,a.sprite_create)(e.sprite).then((function(e){i.data=e,i.image=e.frame_data[0],E++,t(i)}))}))}},235:(e,t,n)=>{n.r(t),n.d(t,{ES_DEAD:()=>Ce,ES_IDLE:()=>Me,enemy_add_child:()=>Ne,enemy_create:()=>xe,enemy_destroy:()=>Ie,enemy_get_child:()=>Oe,enemy_get_list_of_names:()=>Ee,enemy_get_observed_player:()=>De,enemy_get_parent:()=>ke,enemy_objects_init:()=>be,enemy_observe_active_player:()=>Pe,enemy_observe_current_player:()=>Re,enemy_observe_player:()=>Te,enemy_release:()=>ye,enemy_remove_child:()=>Le,enemy_render:()=>Se,enemy_update:()=>we});var a,i=n(898),o=n(880),r=n(689),_=n(450),s=n(218),c=n(120),d=n(798),l=n(878),p=function(e){},u=function(e){},f=function(e,t,n,a,i,o){},g=function(e,t){var n=e.get_object_instance(e).actor,a=n.position;n.position=(0,l.v2d_new)(parseInt(n.position.x,10),parseInt(n.position.y,10)),(0,c.z7)(n,t),n.position=a},m=function(e){return e.object},v=function(e){return e.reference_to_current_state},h=function e(t,n){return null!=t?t.name?t:e(t.next,n):null},b=function(e){var t=e.decorated_machine;return t.get_object_instance(t)},y=n(163),E=function(e){var t=e.decorated_machine;t.init(t)},x=function(e){},I=function(e,t,n,a,i,o){var r,_=e.decorated_machine,s=e,c=e.get_object_instance(e),d=(0,y.timer_get_delta)();r=(0,l.v2d_multiply)(s.speed,d),c.actor.position=(0,l.v2d_add)(c.actor.position,r),_.update(_,t,n,a,i,o)},w=function(e,t){var n=e.decorated_machine;n.render(n,t)},S=n(931),k=n(470),O=n(971),N=function(e){var t=e.decorated_machine;t&&t.init(t)},L=function(e){},D=function(e,t,n,a,i,o){var r,_=e.decorated_machine,p=e,u=e.get_object_instance(e);for(r=0;r<n;r++){var f=t[r];f&&(0,c.Ib)(u.actor,f.actor)&&((0,O.player_attacking)(f)||f.invincible?(f.actor.is_jumping&&(0,O.player_bounce)(f),(0,s.level_add_to_score)(p.score),(0,s.level_create_item)(d.bW,(0,l.v2d_add)(u.actor.position,(0,l.v2d_new)(0,-15))),(0,s.level_create_animal)(u.actor.position),(0,S.sound_play)((0,k.soundfactory_get)("destroy")),u.state=Ce):f.hit(f))}_&&_.update(_,t,n,a,i,o)},T=function(e,t){var n=e.decorated_machine;n.render(n,t)},R=n(386),P=n(429),M=function(e){var t=e.decorated_machine;t.init(t)},C=function(e){},j=function(e,t,n,a,i,o){var r=e.decorated_machine,_=e,s=e.get_object_instance(e).actor,d=(0,y.timer_get_delta)(),l=null,p=null,u=null,f=null,g=null,m=null,v=null,h=null,b=.001*(0,y.timer_get_ticks)(),E=s.position;s.position.x+=-_.amplitude_x*_.angularspeed_x*Math.sin(_.initialphase_x+_.angularspeed_x*b)*d,s.position.y+=_.amplitude_y*_.angularspeed_y*Math.cos(_.initialphase_y+_.angularspeed_y*b)*d;var x=(0,c.kj)(s,0,0,a,l,p,u,f,g,m,v,h);l=x.up,p=x.upright,u=x.right,f=x.downright,g=x.down,m=x.downleft,v=x.left,h=x.upleft;var I=(0,c.K1)(s,0,l,p,u,f,g,m,v,h);l=I.up,p=I.upright,u=I.right,f=I.downright,g=I.down,m=I.downleft,v=I.left,h=I.upleft,null!=u&&s.position.x>E.x&&(s.position.x=s.hot_spot.x-(0,c.Ix)(s).width+u.x),null!=v&&s.position.x<E.x&&(s.position.x=s.hot_spot.x+v.x+(0,P.b9)(v).width),null!=g&&s.position.y>E.y&&(s.position.y=s.hot_spot.y-(0,c.Ix)(s).height+g.y),null!=l&&s.position.y<E.y&&(s.position.y=s.hot_spot.y+l.y+(0,P.b9)(l).height),r.update(r,t,n,a,i,o)},H=function(e,t){var n=e.decorated_machine;n.render(n,t)},A=function(e){var t=e.decorated_machine;t.init(t)},F=function(e){},V=function(e,t,n,a,i,o){var r=e.decorated_machine,_=e.get_object_instance(e).actor;(0,c.q8)(_,(0,c.nG)(_,a,(0,s.level_gravity)())),r.update(r,t,n,a,i,o)},B=function(e,t){var n=e.decorated_machine;n.render(n,t)},W=function(e,t){var n={};return n.init=G,n.release=K,n.update=U,n.render=Y,n.get_object_instance=b,n.decorated_machine=e,n.look_strategy=t,n},G=function(e){var t=e.decorated_machine;t.init(t)},K=function(e){},U=function(e,t,n,a,i,o){var r=e.decorated_machine,_=e;t[0]&&_.look_strategy(_,t[0]),r.update(r,t,n,a,i,o)},Y=function(e,t){var n=e.decorated_machine;n.render(n,t)},z=function(e){var t=e;t.get_object_instance(t).actor.mirror&=~R.IF_HFLIP},X=function(e){var t=e;t.get_object_instance(t).actor.mirror|=R.IF_HFLIP},q=function(e){var t=e,n=t.get_object_instance(t),a=De(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=~R.IF_HFLIP:n.actor.mirror|=R.IF_HFLIP)},$=function(e){var t=e,n=t.get_object_instance(t);n.actor.position.x>e.old_x?n.actor.mirror&=~R.IF_HFLIP:n.actor.mirror|=R.IF_HFLIP,e.old_x=n.actor.position.x},Q=function(e){var t=e.decorated_machine;t.init(t)},J=function(e){},Z=function(e,t,n,a,i,o){var r=e.decorated_machine,_=e,s=e.get_object_instance(e),c=De(s);if(c){var d=(0,l.v2d_subtract)(c.actor.position,s.actor.position);if((0,l.v2d_magnitude)(d)>=5){var p=(0,y.timer_get_delta)(),u=(0,l.v2d_normalize)(d),f=(0,l.v2d_multiply)(u,_.speed*p);s.actor.position=(0,l.v2d_add)(s.actor.position,f)}}r.update(r,t,n,a,i,o)},ee=function(e,t){var n=e.decorated_machine;n.render(n,t)},te=function(e){var t=e.decorated_machine;oe(e),t.init(t)},ne=function(e){},ae=function(e,t,n,a,i,o){oe(e)},ie=function(e,t){var n=e.decorated_machine;n.render(n,t)},oe=function(e){var t=e,n=e.get_object_instance(e);(0,c.TK)(n.actor,t.anim)},re=function(e){var t=e.decorated_machine;t.init(t)},_e=function(e){},se=function(e,t,n,a,i,o){var r=e.decorated_machine,_=e,s=e.get_object_instance(e).actor,d=(0,y.timer_get_delta)(),l=null,p=null,u=null,f=null,g=null,m=null,v=null,h=null;s.position.x+=_.direction*_.speed*d;var b=(0,c.kj)(s,2,-2,a,l,p,u,f,g,m,v,h);l=b.up,p=b.upright,u=b.right,f=b.downright,g=b.down,m=b.downleft,v=b.left,h=b.upleft;var E=(0,c.K1)(s,-2,l,p,u,f,g,m,v,h);l=E.up,p=E.upright,u=E.right,f=E.downright,g=E.down,m=E.downleft,v=E.left,h=E.upleft,null!=u&&_.direction>0&&(s.position.x=s.hot_spot.x-(0,c.Ix)(s).width+u.x,_.direction=-1),null!=v&&_.direction<0&&(s.position.x=s.hot_spot.x+v.x+(0,P.b9)(v).width,_.direction=1),null!=g&&(null==f&&null!=m?_.direction=-1:null==m&&null!=f&&(_.direction=1)),r.update(r,t,n,a,i,o)},ce=function(e,t){var n=e.decorated_machine;n.render(n,t)},de={},le=[{command:"set_animation",action:function(e,t,n){var a,r,_,s;return 2==t?(a=e,r=n[0],_=n[1],(s={}).init=te,s.release=ne,s.update=ae,s.render=ie,s.get_object_instance=b,s.decorated_machine=a,s.anim=(0,o.sprite_get_animation)(r,_),e=s):(0,i.logfile_fatal_error)("Object script error - set_animation expects two parameters: sprite_name, animation_id"),e}},{command:"set_obstacle",action:function(e,t,n){1==t?e=objectdecorator_setobstacle_new(e,n[0],0):2==t?e=objectdecorator_setobstacle_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]")}},{command:"set_alpha",action:function(e,t,n){1==t?e=objectdecorator_setalpha_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))")}},{command:"hide",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,0):(0,i.logfile_fatal_error)("Object script error - hide expects no parameters")}},{command:"show",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,1):(0,i.logfile_fatal_error)("Object script error - show expects no parameters")}},{command:"enemy",action:function(e,t,n){var a,o,r;return 1==t?(a=e,o=n,(r={}).init=N,r.release=L,r.update=D,r.render=T,r.get_object_instance=b,r.decorated_machine=a,r.score=o,e=r):(0,i.logfile_fatal_error)("Object script error - enemy expects one parameter: score"),e}},{command:"lock_camera",action:function(e,t,n){4==t?e=objectdecorator_lockcamera_new(e,n[0],n[1],n[2],n[3]):(0,i.logfile_fatal_error)("Object script error - lock_camera expects four parameters: x1, y1, x2, y2")}},{command:"move_player",action:function(e,t,n){2==t?e=objectdecorator_moveplayer_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - move_player expects two parameters: speed_x, speed_y")}},{command:"hit_player",action:function(e,t,n){0==t?e=objectdecorator_hitplayer_new(e):(0,i.logfile_fatal_error)("Object script error - hit_player expects no parameters")}},{command:"burn_player",action:function(e,t,n){0==t?e=objectdecorator_burnplayer_new(e):(0,i.logfile_fatal_error)("Object script error - burn_player expects no parameters")}},{command:"shock_player",action:function(e,t,n){0==t?e=objectdecorator_shockplayer_new(e):(0,i.logfile_fatal_error)("Object script error - shock_player expects no parameters")}},{command:"acid_player",action:function(e,t,n){0==t?e=objectdecorator_acidplayer_new(e):(0,i.logfile_fatal_error)("Object script error - acid_player expects no parameters")}},{command:"add_rings",action:function(e,t,n){1==t?e=objectdecorator_addrings_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - add_rings expects one parameter: number_of_rings")}},{command:"add_to_score",action:function(e,t,n){1==t?e=objectdecorator_addtoscore_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - add_to_score expects one parameter: score")}},{command:"set_player_animation",action:function(e,t,n){2==t?e=objectdecorator_setplayeranimation_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - set_player_animation expects two parameters: sprite_name, animation_id")}},{command:"enable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_enableplayermovement_new(e):(0,i.logfile_fatal_error)("Object script error - enable_player_movement expects no parameters")}},{command:"disable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_disableplayermovement_new(e):(0,i.logfile_fatal_error)("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayerxspeed_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - set_player_xspeed expects one parameter: speed")}},{command:"set_player_yspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayeryspeed_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - set_player_yspeed expects one parameter: speed")}},{command:"set_player_position",action:function(e,t,n){2==t?e=objectdecorator_setplayerposition_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - set_player_position expects two parameters: xpos, ypos")}},{command:"bounce_player",action:function(e,t,n){0==t?e=objectdecorator_bounceplayer_new(e):(0,i.logfile_fatal_error)("Object script error - bounce_player expects no parameters")}},{command:"observe_player",action:function(e,t,n){1==t?e=objectdecorator_observeplayer_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - observe_player expects one parameter: player_name")}},{command:"observe_current_player",action:function(e,t,n){0==t?e=objectdecorator_observecurrentplayer_new(e):(0,i.logfile_fatal_error)("Object script error - observe_current_player expects no parameters")}},{command:"observe_active_player",action:function(e,t,n){0==t?e=objectdecorator_observeactiveplayer_new(e):(0,i.logfile_fatal_error)("Object script error - observe_active_player expects no parameters")}},{command:"observe_all_players",action:ge},{command:"observe_next_player",action:ge},{command:"attach_to_player",action:function(e,t,n){0==t?e=objectdecorator_attachtoplayer_new(e,0,0):1==t?e=objectdecorator_attachtoplayer_new(e,n[0],0):2==t?e=objectdecorator_attachtoplayer_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]")}},{command:"springfy_player",action:function(e,t,n){0==t?e=objectdecorator_springfyplayer_new(e):(0,i.logfile_fatal_error)("Object script error - springfy_player expects no parameters")}},{command:"roll_player",action:function(e,t,n){0==t?e=objectdecorator_rollplayer_new(e):(0,i.logfile_fatal_error)("Object script error - roll_player expects no parameters")}},{command:"walk",action:function(e,t,n){var a,o,r;return 1==t?(a=e,o=n,(r={}).init=re,r.release=_e,r.update=se,r.render=ce,r.get_object_instance=b,r.decorated_machine=a,r.speed=o,r.direction=-1,e=r):(0,i.logfile_fatal_error)("Object script error - walk expects one parameter: speed"),e}},{command:"gravity",action:function(e,t,n){var a,o,r;return 0==t?(a=e,r=o={},o.init=A,o.release=F,o.update=V,o.render=B,o.get_object_instance=b,r.decorated_machine=a,e=o):(0,i.logfile_fatal_error)("Object script error - gravity expects no parameters"),e}},{command:"jump",action:function(e,t,n){1==t?e=objectdecorator_jump_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - jump expects one parameter: jump_strength")}},{command:"move",action:me},{command:"bullet_trajectory",action:me},{command:"elliptical_trajectory",action:function(e,t,n){var a,o,r,_,s,c,d,l;return t>=4&&t<=6?(a=e,o=n[0],r=n[1],_=n[2],s=n[3],c=n[4],d=n[5],(l={}).init=M,l.release=C,l.update=j,l.render=H,l.get_object_instance=b,l.decorated_machine=a,l.amplitude_x=o,l.amplitude_y=r,l.angularspeed_x=_*(2*R.PI),l.angularspeed_y=s*(2*R.PI),l.initialphase_x=c*R.PI/180,l.initialphase_y=d*R.PI/180,e=l):(0,i.logfile_fatal_error)("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),e}},{command:"mosquito_movement",action:function(e,t,n){var a,o,r;return 1==t?(a=e,o=n,(r={}).init=Q,r.release=J,r.update=Z,r.render=ee,r.get_object_instance=b,r.decorated_machine=a,r.speed=o,e=r):(0,i.logfile_fatal_error)("Object script error - mosquito_movement expects one parameter: speed"),e}},{command:"look_left",action:function(e,t,n){0==t?e=W(e,z):(0,i.logfile_fatal_error)("Object script error - look_left expects no parameters")}},{command:"look_right",action:function(e,t,n){0==t?e=W(e,X):(0,i.logfile_fatal_error)("Object script error - look_right expects no parameters")}},{command:"look_at_player",action:function(e,t,n){return 0==t?e=W(e,q):(0,i.logfile_fatal_error)("Object script error - look_at_player expects no parameters"),e}},{command:"look_at_walking_direction",action:function(e,t,n){return 0==t?e=W(e,$):(0,i.logfile_fatal_error)("Object script error - look_at_walking_direction expects no parameters"),e}},{command:"create_item",action:function(e,t,n){3==t?e=objectdecorator_createitem_new(e,n[0],n[1],n[2]):(0,i.logfile_fatal_error)("Object script error - create_item expects three parameters: item_id, offset_x, offset_y")}},{command:"change_closest_object_state",action:function(e,t,n){2==t?e=objectdecorator_changeclosestobjectstate_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name")}},{command:"create_child",action:function(e,t,n){3==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],""):4==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],n[3]):(0,i.logfile_fatal_error)("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]")}},{command:"change_child_state",action:function(e,t,n){2==t?e=objectdecorator_changechildstate_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - change_child_state expects two parameters: child_name, new_state_name")}},{command:"change_parent_state",action:function(e,t,n){1==t?e=objectdecorator_changeparentstate_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - change_parent_state expects one parameter: new_state_name")}},{command:"destroy",action:function(e,t,n){0==t?e=objectdecorator_destroy_new(e):(0,i.logfile_fatal_error)("Object script error - destroy expects no parameters")}},{command:"change_state",action:function(e,t,n){1==t?e=objectdecorator_ontimeout_new(e,0,n[0]):(0,i.logfile_fatal_error)("Object script error - change_state expects one parameter: new_state_name")}},{command:"on_timeout",action:function(e,t,n){2==t?e=objectdecorator_ontimeout_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name")}},{command:"on_collision",action:function(e,t,n){2==t?e=objectdecorator_oncollision_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - on_collision expects two parameters: object_name, new_state_name")}},{command:"on_animation_finished",action:function(e,t,n){1==t?e=objectdecorator_onanimationfinished_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_animation_finished expects one parameter: new_state_name")}},{command:"on_random_event",action:function(e,t,n){2==t?e=objectdecorator_onrandomevent_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name")}},{command:"on_player_collision",action:function(e,t,n){1==t?e=objectdecorator_onplayercollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_player_collision expects one parameter: new_state_name")}},{command:"on_player_attack",action:function(e,t,n){1==t?e=objectdecorator_onplayerattack_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_player_attack expects one parameter: new_state_name")}},{command:"on_player_rect_collision",action:function(e,t,n){5==t?e=objectdecorator_onplayerrectcollision_new(e,n[0],n[1],n[2],n[3],n[4]):(0,i.logfile_fatal_error)("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name")}},{command:"on_no_shield",action:function(e,t,n){1==t?e=objectdecorator_onnoshield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_no_shield expects one parameter: new_state_name")}},{command:"on_shield",action:function(e,t,n){1==t?e=objectdecorator_onshield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_shield expects one parameter: new_state_name")}},{command:"on_fire_shield",action:function(e,t,n){1==t?e=objectdecorator_onfireshield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_fire_shield expects one parameter: new_state_name")}},{command:"on_thunder_shield",action:function(e,t,n){1==t?e=objectdecorator_onthundershield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_thunder_shield expects one parameter: new_state_name")}},{command:"on_water_shield",action:function(e,t,n){1==t?e=objectdecorator_onwatershield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_water_shield expects one parameter: new_state_name")}},{command:"on_acid_shield",action:function(e,t,n){1==t?e=objectdecorator_onacidshield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_acid_shield expects one parameter: new_state_name")}},{command:"on_wind_shield",action:function(e,t,n){1==t?e=objectdecorator_onwindshield_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_wind_shield expects one parameter: new_state_name")}},{command:"on_brick_collision",action:function(e,t,n){1==t?e=objectdecorator_onbrickcollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_brick_collision expects one parameter: new_state_name")}},{command:"on_floor_collision",action:function(e,t,n){1==t?e=objectdecorator_onfloorcollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_floor_collision expects one parameter: new_state_name")}},{command:"on_ceiling_collision",action:function(e,t,n){1==t?e=objectdecorator_onceilingcollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_ceiling_collision expects one parameter: new_state_name")}},{command:"on_left_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onleftwallcollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_left_wall_collision expects one parameter: new_state_name")}},{command:"on_right_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onrightwallcollision_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - on_right_wall_collision expects one parameter: new_state_name")}},{command:"show_dialog_box",action:function(e,t,n){2==t?e=objectdecorator_showdialogbox_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - show_dialog_box expects two parameters: title, message")}},{command:"hide_dialog_box",action:function(e,t,n){0==t?e=objectdecorator_hidedialogbox_new(e):(0,i.logfile_fatal_error)("Object script error - hide_dialog_box expects no parameters")}},{command:"clear_level",action:function(e,t,n){0==t?e=objectdecorator_clearlevel_new(e):(0,i.logfile_fatal_error)("Object script error - clear_level expects no parameters")}},{command:"play_sample",action:function(e,t,n){1==t?e=objectdecorator_playsample_new(e,n[0],1,0,1,0):2==t?e=objectdecorator_playsample_new(e,n[0],n[1],0,1,0):3==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],1,0):4==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],0):5==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],n[4]):(0,i.logfile_fatal_error)("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]")}},{command:"play_music",action:function(e,t,n){1==t?e=objectdecorator_playmusic_new(e,n[0],0):2==t?e=objectdecorator_playmusic_new(e,n[0],n[1]):(0,i.logfile_fatal_error)("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]")}},{command:"play_level_music",action:function(e,t,n){0==t?e=objectdecorator_playlevelmusic_new(e):(0,i.logfile_fatal_error)("Object script error - play_level_music expects no parameters")}},{command:"set_music_volume",action:function(e,t,n){1==t?e=objectdecorator_setmusicvolume_new(e,n[0]):(0,i.logfile_fatal_error)("Object script error - set_music_volume expects one parameter: volume")}},{command:null,action:null}],pe=function(e,t){return function(e,t){var n,o,r,_=t;if(0===_.state){var s=e.state.name;for(_.state,_.vm.state_list=(o=_.vm,r=e.state.list,null==h(o.state_list,r)&&(o.state_list=function(e,t,n){var a,i,o,r={};return r.name=t,r.data=(a=n,(o=i={}).init=p,o.release=u,o.update=f,o.render=g,o.get_object_instance=m,o.basic=!0,i.object=a,o),r.next=e,r}(o.state_list,r,o.owner)),o.state_list),_.vm=function(e,t){var n=h(e.state_list,t);return null!=n?e.reference_to_current_state=n.data:(0,i.logfile_message)('Object script error: can\'t find state "%s".',t),e}(_.vm,s),n=v(_.vm),a=0,function(e,t){a<1024?(de[a]={},de[a].stmt=e,de[a].machine=t,a++):(0,i.logfile_message)("Object script error: you may write %d commands or less per state",1024)}(e.state.list,n);a-- >0;)n=ue(de[a].stmt,de[a].machine);n&&n.init(n)}return _.vm.reference_to_current_state=n,e.destroy_if_far_from_play_area&&(_.preserve=!1),e.always_active&&(_.always_active=!0),e.hide_unless_in_editor_mode&&(_.hide_unless_in_editor_mode=!0),_}(t,e)};function ue(e,t){var n,a,i,o,r=e;for(a=r.length,n=0;n<a;n++)o=(i=r[n])[1]&&void 0!==i[1]?i[1].length?i[1].length:1:0,t=fe(t,i[0],o,i[1]);return t}function fe(e,t,n,a){for(var i=0,o=le[i++];null!=o.command&&null!=o.action;)o.command==t&&(e=o.action(e,n,a)),o=le[i++];return e}function ge(e,t,n){0==t?e=objectdecorator_observeallplayers_new(e):(0,i.logfile_fatal_error)("Object script error - observe_all_players expects no parameters")}function me(e,t,n){var a,o,r,_;return 2==t?(a=e,o=n[0],r=n[1],(_={}).init=E,_.release=x,_.update=I,_.render=w,_.get_object_instance=b,_.decorated_machine=a,_.speed=(0,l.v2d_new)(o,r),e=_):(0,i.logfile_fatal_error)("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),e}var ve,he=[],be=function(){(0,i.logfile_message)("Loading objects scripts..."),ve=null,(0,_.resourcemanager_getJsonFile)("data/objects/enemies.json").then((function(e){Ae(ve,e),ve=e}))},ye=function(){},Ee=function(e){return he.name},xe=function(e){return je(e)},Ie=function(e){},we=function(e,t,n,a,i,o){if(e){var r=v(e.vm);r.update(r,t,n,a,i,o)}},Se=function(e,t){if(e){var n=v(e.vm);(!e.hide_unless_in_editor_mode||e.hide_unless_in_editor_mode&&(0,s.level_editmode)())&&n.render(n,t)}},ke=function(e){return e.parent},Oe=function(e,t){return We(e.children,t)},Ne=function(e,t,n){e.children=Ve(e.children,t,n),n.parent=e,n.created_from_editor=!1},Le=function(e,t){e.children=Be(e.children,t)},De=function(e){return null!=e.observed_player?e.observed_player:(0,s.level_player)()},Te=function(e,t){e.observed_player=t},Re=function(e){e.observed_player=(0,s.level_player)()},Pe=function(e){e.observed_player=null},Me=0,Ce=1,je=function(e){var t,n={},a={};return n.name=e,n.state=Me,n.actor=(0,c.HN)(),n.actor.input=(0,r.input_create_computer)(),n.actor=(0,c.TK)(n.actor,(0,o.sprite_get_animation)("SD_QUESTIONMARK",0)),n.preserve=!0,n.obstacle=!1,n.obstacle_angle=0,n.always_active=!1,n.hide_unless_in_editor_mode=!1,n.vm=((t={}).owner=n,t.state_list=null,t.reference_to_current_state=null,t),n.created_from_editor=!0,n.parent=null,n.children=Fe(),n.observed_player=null,a.in_object_name=e,a.out_object_block=null,a.out_object_block=He(ve,a),null!=a.out_object_block?n=pe(n,a.out_object_block):(0,i.logfile_message)("Object '%s' does not exist",e),n},He=function(e,t){var n=e[t.in_object_name];return n?(t.in_object_name,n):((0,i.logfile_message)("Object script error: unknown keyword '%s'",n),0)},Ae=function(e,t){return e},Fe=function(){return null},Ve=function(e,t,n){var a={};return a.name=t,a.data=n,a.next=e,a},Be=function(e,t){var n,a;if(null!=e){if(e.data==t)return a=e.next,e.name=null,e=null,a;for(n=e;null!=n.next&&n.next.data!=t;)n=n.next;return null!=n.next&&(a=n.next.next,n.next.name=null,n.next=null,n.next=a),e}return null},We=function(e,t){for(var n=e;null!=n;){if(0==strcmp(n.name,t))return n.data;n=n.next}return null}},176:(e,t,n)=>{n.r(t),n.d(t,{font_create:()=>l,font_destroy:()=>p,font_get_charsize:()=>g,font_get_charspacing:()=>m,font_get_text:()=>f,font_init:()=>d,font_render:()=>h,font_set_text:()=>u,font_set_width:()=>v});var a=n(898),i=n(954),o=n(878),r=n(38),_=n(880),s=n(642),c=[],d=function(){var e,t,n,i=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for((0,a.logfile_message)("font_init()"),e=0;e<i.length;e++)for(c[e]={ch:[]},n="FT_FONT"+e,t=0;t<i[e].length;t++)c[e].ch[i[e][t]]=(0,_.sprite_get_image)((0,_.sprite_get_animation)(n,0),t);(0,a.logfile_message)("font_init() ok")},l=function(e){var t,n={};for(n.type=(0,i.clip)(e,0,9),n.text=null,n.width=0,n.visible=!0,n.hspace=n.vspace=1,n.value=[],n.position=(0,o.v2d_new)(0,0),t=0;t<5;t++)n.value[t]=0;return n},p=function(e){},u=function(e,t){if(!e)return!1;for(var n,a=arguments.length,i=new Array(a>2?a-2:0),o=2;o<a;o++)i[o-2]=arguments[o];for(n=0;n<i.length;n++)i[n]=""+i[n];var _=(t=""+t).match(/\$[A-Z_\d]\w+/g);if(_)for(n=0;n<_.length;n++){var s=_[n].slice(1),c=(0,r.lang_get)(s);c&&(t=t.replace("$"+s,c))}if(_=t.match(/\%[s]+/g))for(n=0;n<_.length;n++)if(i[n]){var d=i[n].match(/\$[A-Z_\d]\w+/g);d&&(i[n]=d[0].slice(1)),t=t.replace("%s",(0,r.lang_get)(i[n]))}if(_=t.match(/\%[d]+/g))for(n=0;n<_.length;n++)i[n]&&(t=t.replace("%d",""+i[n]));return e.text=""+t,e},f=function(e){return e.text?e.text:""},g=function(e){return b(e)},m=function(e){return(0,o.v2d_new)(e.hspace,e.vspace)},v=function(e,t){e.width=Math.max(0,t)},h=function(e,t){var n,a,o,r,_,d=0,l=0,p=[],u=0,f=0;p[f++]={r:!1,g:0,b:0};var g=b(e);if(n=g.x,a=g.y,e&&e.visible&&e.text)for(u=0;u<e.text.length;u++){if(o=e.text[u],_=!1,(0,i.isspace)(e.text[u-1])){var m=void 0,v=!1,h=0,x=e.text.slice(u),I=(x=(x=x.replace("(","")).replace(")","")).split(" ")[0];for(m=0;m<I.length;m++)"<"==I[m]&&(v=!0),v||h++,">"==I[m]&&(v=!1);_=e.width>0&&d+(n+e.hspace)*h-e.hspace>e.width}if("<"==o){var w=e.text.slice(u,u+7);if("<color="==w){var S,k,O;u+=7;var N=e.text.slice(u,u+6);S=E(N.slice(0,2)),k=E(N.slice(2,4)),O=E(N.slice(4,6)),p[f++]={r:S,g:k,b:O},u+=7,o=e.text[u]}"</color"==w&&(u+=8,o=e.text[u],f>=2&&f--)}_&&(d=0,l+=a+e.vspace),"\n"!=o?(r=c[e.type].ch[o])?(d+=r.width,(0,i.isspace)(e.text[u-1]),y((0,s.video_get_backbuffer)(),r,parseInt(e.position.x+d-(t.x-s.VIDEO_SCREEN_W/2),10),parseInt(e.position.y+l-(t.y-s.VIDEO_SCREEN_H/2),10),p[f-1].r,p[f-1].g,p[f-1].b)):d+=n+e.hspace:(d=0,l+=a+e.vspace)}},b=function(e){var t,n;if(e)for(t=0;t<256;t++)if(c[e.type]&&null!=(n=c[e.type].ch[t]))return(0,o.v2d_new)(n.width,n.height);return(0,o.v2d_new)(16,16)},y=function(e,t,n,a,i,o,r){var _=t.data;e.drawImage(_,t.sx,t.sy,t.swidth,t.sheight,n,a-2,t.width*s.VIDEO_SCALE,t.height*s.VIDEO_SCALE)},E=function(e){return(e=e.toLowerCase())>="0"&&e<="9"?e-"0":e>="a"&&e<="f"?e-"a"+10:255}},798:(e,t,n)=>{n.d(t,{rJ:()=>un,Hx:()=>pn,cV:()=>Ha,NE:()=>kn,OQ:()=>ba,xe:()=>Fn,Wm:()=>ha,bw:()=>aa,jy:()=>Cn,b0:()=>pa,mH:()=>da,EO:()=>va,at:()=>ia,Vu:()=>na,mw:()=>ca,jw:()=>zn,k_:()=>la,lL:()=>ya,Vj:()=>Vn,z8:()=>xn,nN:()=>Xn,gb:()=>Qn,f7:()=>$n,tG:()=>Na,S0:()=>Oa,wN:()=>Hn,qh:()=>Gn,pp:()=>Wn,bW:()=>wn,Pr:()=>Jn,X:()=>Pa,o9:()=>Zn,Sr:()=>Sn,Dk:()=>bn,xW:()=>Bn,iR:()=>La,Bq:()=>Ta,mb:()=>Da,C_:()=>In,vc:()=>fa,oM:()=>gn,Zy:()=>Kn,be:()=>Un,Bh:()=>Yn,_q:()=>Ln,tk:()=>Nn,H7:()=>Dn,Mo:()=>On,uN:()=>Mn,C8:()=>Ea,uW:()=>ra,Qs:()=>wa,so:()=>Sa,DM:()=>ka,fm:()=>Ia,d8:()=>ua,jQ:()=>Rn,vJ:()=>fn,e0:()=>mn,ko:()=>Pn,EQ:()=>xa,Rt:()=>oa,ZG:()=>yn,Or:()=>hn,Zf:()=>qn,eM:()=>vn,Nx:()=>jn,Gd:()=>An,Xb:()=>Ca,zm:()=>ma,pQ:()=>ta,VJ:()=>sa,vP:()=>En,ty:()=>ga,PC:()=>ea,uV:()=>_a,Bs:()=>Ra,$q:()=>Ma,M7:()=>ja,vo:()=>Aa,rm:()=>Tn,_y:()=>Fa,tl:()=>Va,tx:()=>Wa,wU:()=>Ba});var a=n(218),i=n(120),o=n(880),r=n(954),_=n(689),s=n(386),c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.HN)(),e.actor.maxspeed=145+(0,r.random)(21),e.actor.input=(0,_.input_create_computer)(),t.is_running=!1,t.animal_id=(0,r.random)(12),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ANIMAL",0))},d=function(e){(0,i.HI)(e.actor)},l=function(e,t,n,c,d,l){var p,u,f,g,m=e,v=e.actor,h=2*m.animal_id+(m.is_running?1:0);(0,_.input_simulate_button_down)(v.input,_.IB_FIRE1),v.jump_strength=1.3*(200+(0,r.random)(50)),v.speed.x>s.EPSILON?(v.speed.x=v.maxspeed,v.mirror=s.IF_NONE):v.speed.x<-s.EPSILON&&(v.speed.x=-v.maxspeed,v.mirror=s.IF_HFLIP),(0,i.TK)(v,(0,o.sprite_get_animation)("SD_ANIMAL",h));var b=(0,i.kj)(v,2,-2,c,p,null,g,null,u,null,f,null);p=b.up,b.upright,g=b.right,b.downright,u=b.down,b.downleft,f=b.left,b.upleft;var y=(0,i.K1)(v,-2,p,null,g,null,u,null,f,null);p=y.up,y.upright,g=y.right,y.downright,u=y.down,y.downleft,f=y.left,y.upleft,u&&!m.is_running&&(m.is_running=!0,v.speed.x=((0,r.random)(2)?-1:1)*v.maxspeed),f&&!p&&(v.speed.x=v.maxspeed),g&&!p&&(v.speed.x=-v.maxspeed),!m.is_running&&(u&&p||f&&g)&&(e.state=un),(0,i.q8)(v,(0,i.nG)(v,c,(0,a.level_gravity)()))},p=function(e,t){(0,i.z7)(e.actor,t)},u=n(931),f=n(470),g=n(163),m=n(878),v=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),E(e,x()),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ENDLEVEL",0))},h=function(e){(0,i.HI)(e.actor),E(e,null)},b=function(e,t,n,a,i,o){var r=e;r.state.handle(r.state,e,t,n)},y=function(e,t){(0,i.z7)(e.actor,t)},E=function(e,t){e.state=t},x=function(){var e={},t=e;return e.handle=I,t.being_hit=!1,t.hit_count=0,e},I=function(e,t,n,a){var r,_,s,c=e,d=t.actor;for(r=0;r<a;r++){var l=n[r];O(t,l)&&!c.being_hit&&(c.being_hit=!0,(0,i.TK)(d,(0,o.sprite_get_animation)("SD_ENDLEVEL",1)),(0,u.sound_play)((0,f.soundfactory_get)("boss hit")),l.bounce(l),l.actor.speed.x*=-.5,++c.hit_count>=3&&E(t,(_=void 0,s=void 0,s=_={},_.handle=w,s.explode_timer=0,s.break_timer=0,_)))}(0,i.$C)(d)&&c.being_hit&&((0,i.TK)(d,(0,o.sprite_get_animation)("SD_ENDLEVEL",0)),c.being_hit=!1)},w=function(e,t,n,o){var _,s=e,c=t.actor,d=(0,g.timer_get_delta)();if(s.explode_timer+=d,s.break_timer+=d,s.explode_timer>=.1){var l=(0,m.v2d_new)(c.position.x-c.hot_spot.x+(0,r.random)((0,i.Ix)(c).width),c.position.y-c.hot_spot.y+(0,r.random)((0,i.Ix)(c).height/2));(0,a.level_create_item)(wn,l),(0,u.sound_play)((0,f.soundfactory_get)("explode")),s.explode_timer=0}s.break_timer>=2&&E(t,((_={}).handle=S,_))},S=function(e,t,n,_){for(var s,c=t.actor,d=0;d<20;d++){var l=(0,m.v2d_new)(c.position.x-c.hot_spot.x+(0,r.random)((0,i.Ix)(c).width),c.position.y-c.hot_spot.y+(0,r.random)((0,i.Ix)(c).height/2));(0,a.level_create_animal)(l)}(0,a.level_clear)(c),(0,i.TK)(c,(0,o.sprite_get_animation)("SD_ENDLEVEL",2)),E(t,((s={}).handle=k,s))},k=function(e,t,n,a){},O=function(e,t){if(e&&t){var n=[],a=[],o=e.actor,_=t.actor;return n[0]=_.position.x-_.hot_spot.x,n[1]=_.position.y-_.hot_spot.y,n[2]=n[0]+(0,i.Ix)(_).width,n[3]=n[1]+(0,i.Ix)(_).height,a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y,a[2]=a[0]+(0,i.Ix)(o).width-10,a[3]=a[1]+(0,i.Ix)(o).height/2,t.attacking(t)&&(0,r.bounding_box)(n,a)&&(0,i.Ib)(o,_)}},N=n(971),L=n(943),D=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_disappearing=!1,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_BLUERING",0))},T=function(e){(0,i.HI)(e.actor)},R=function(e,t,n,o,r,_){var s;for(s=0;s<n;s++){var c=t[s];c&&!c.dying&&(0,i.jW)(c.actor,e.actor)&&(e.state=un,(0,N.player_set_rings)((0,N.player_get_rings)()+50),(0,a.level_add_to_secret_bonus)(5e3),(0,u.sound_play)((0,f.soundfactory_get)("big ring")),(0,a.level_call_dialogbox)("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),(0,L.quest_setvalue)(L.QUESTVALUE_BIGRINGS,(0,L.quest_getvalue)(L.QUESTVALUE_BIGRINGS)+1))}},P=function(e,t){(0,i.z7)(e.actor,t)},M=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_disappearing=!1,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_BLUERING",0))},C=function(e,t,n,r,_,s){var c=(0,a.level_player)(),d=e,l=e.actor;l.visible=c.got_glasses||(0,a.level_editmode)(),d.is_disappearing?(0,i.$C)(l)&&(e.state=un):!c.dying&&c.got_glasses&&(0,i.jW)(l,c.actor)&&((0,i.TK)(l,(0,o.sprite_get_animation)("SD_BLUERING",1)),(0,N.player_set_rings)((0,N.player_get_rings)()+5),(0,u.sound_play)((0,f.soundfactory_get)("blue ring")),d.is_disappearing=!0)},j=function(e,t){(0,i.z7)(e.actor,t)},H=function(e){(0,i.HI)(e.actor)},A=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.getting_hit=!1,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_BUMPER",0))},F=function(e,t,n,a,r,_){var s,c=e,d=e.actor;for(s=0;s<n;s++){var l=t[s];l&&!l.dying&&(0,i.Ib)(l.actor,d)&&(c.getting_hit||(c.getting_hit=!0,(0,i.TK)(d,(0,o.sprite_get_animation)("SD_BUMPER",1)),(0,u.sound_play)((0,f.soundfactory_get)("bumper")),W(e,l)))}c.getting_hit&&actor_animation_finished(d)&&(c.getting_hit=!1,(0,i.TK)(d,(0,o.sprite_get_animation)("SD_BUMPER",0)))},V=function(e,t){(0,i.z7)(e.actor,t)},B=function(e){(0,i.HI)(e.actor)},W=function(e,t){var n,a,i,o=e.actor;(n=t.actor_speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=(0,m.v2d_multiply)((0,m.v2d_normalize)((0,m.v2d_subtract)(o.position,t.actor_position)),v2d_magnitude(n)),i=(0,m.v2d_multiply)(a,1),t.actor_speed=(0,m.v2d_multiply)((0,m.v2d_add)(n,(0,m.v2d_multiply)(i,-1e4)),1/10001),o.speed=(0,m.v2d_multiply)((0,m.v2d_add)(n,i),1/10001),t.flying=!1,t.landing=!1,t.climbing=!1,t.spring=!1},G=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_active=!1,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_CHECKPOINT",0))},K=function(e,t,n,r,_,s){var c,d=e,l=e.actor;if(d.is_active)(0,i.$C)(l)&&(0,i.TK)(l,(0,o.sprite_get_animation)("SD_CHECKPOINT",2));else for(c=0;c<n;c++){var p=t[c];if(p&&!p.dying&&(0,i.Ib)(p.actor,l)){d.is_active=!0,(0,u.sound_play)((0,f.soundfactory_get)("checkpoint")),(0,a.level_set_spawn_point)(l.position),(0,i.TK)(l,(0,o.sprite_get_animation)("SD_CHECKPOINT",1));break}}},U=function(e,t){(0,i.z7)(e.actor,t)},Y=function(e){(0,i.HI)(e.actor)},z=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ITEMBOX",10))},X=function(e,t,n,a,i,o){},q=function(e,t){(0,i.z7)(e.actor,t)},$=function(e){(0,i.HI)(e.actor)},Q=function(e,t){var n={},a=n;return n.init=J,n.release=te,n.update=Z,n.render=ee,a.sprite_name=e,a.player_is_vulnerable=t,n},J=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)(t.sprite_name,0))},Z=function(e,t,n,o,r,_){var s,c=e,d=e.actor;for(s=0;s<n;s++){var l=t[s];l&&(l.dying||l.blinking||l.invincible||!(0,i.jW)(d,l.actor)||c.player_is_vulnerable(l)&&l.hit(l))}d.visible=(0,a.level_editmode)()},ee=function(e,t){(0,i.z7)(e.actor,t)},te=function(e){(0,i.HI)(e.actor)},ne=function(e){return!0},ae=function(e){return e.shield_type!=N.SH_FIRESHIELD},ie=function(e,t){e.actor_speed=t},oe=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_DANGPOWER",0))},re=function(e,t,n,a,o,r){var _,s=(0,g.timer_get_delta)(),c=e.actor,d=(0,m.v2d_multiply)(c.speed,s);for(_=0;_<n;_++){var l=t[_];l&&!l.dying&&(0,i.jW)(c,l.actor)&&(l.hit(l),e.state=un)}c.position=(0,m.v2d_add)(c.position,d)},_e=function(e,t){(0,i.z7)(e.actor,t)},se=function(e){(0,i.HI)(e.actor)},ce=function(e,t){var n={},a=n;return n.init=de,n.release=ue,n.update=le,n.render=pe,a.authorized_player_type=e,a.is_vertical_door=t,n},de=function(e){var t,n,a=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.HN)(),n=parseInt(a.authorized_player_type,10),t=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",(0,i.TK)(e.actor,(0,o.sprite_get_animation)(t,n))},le=function(e,t,n,a,o,_){var s,c,d={},l=e.actor,p=!1,u=!1,f=(0,g.timer_get_delta)(),m=[],v=[];for(e.obstacle=!0,c=0;c<n;c++){var h=t[c];h&&(h.dying||h.actor_carrying||h.actor_carried_by||!fe(h,e)||(h.type==d.authorized_player_type?(e.obstacle=!1,u=(0,i.Ib)(l,h.actor)):p=!0))}if(p&&(e.obstacle=!0),e.obstacle?l.alpha=Math.min(1,l.alpha+2*f):u&&(l.alpha=Math.max(.4,l.alpha-2*f)),u)for(m[0]=l.position.x-l.hot_spot.x-5,m[1]=l.position.y-l.hot_spot.y-5,m[2]=m[0]+(0,i.Ix)(l).width+10,m[3]=m[1]+(0,i.Ix)(l).height+10,s=o;null!=s;s=s.next)s.data.type==e.type&&(v[0]=s.data.actor_position.x-s.data.actor_hot_spot.x-5,v[1]=s.data.actor_position.y-s.data.actor_hot_spot.y-5,v[2]=v[0]+(0,i.Ix)(s.data.actor).width+10,v[3]=v[1]+(0,i.Ix)(s.data.actor).height+10,(0,r.bounding_box)(m,v)&&(s.data.actor_alpha<l.alpha?l.alpha=s.data.actor_alpha:s.data.actor_alpha=l.alpha))},pe=function(e,t){(0,i.z7)(e.actor,t)},ue=function(e){(0,i.HI)(e.actor)},fe=function(e,t){var n=[],a=[],o=e.actor,_=t.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+(0,i.Ix)(o).width,n[3]=n[1]+(0,i.Ix)(o).height,a[0]=_.position.x-_.hot_spot.x,a[1]=_.position.y-_.hot_spot.y-3,a[2]=a[0]+(0,i.Ix)(_).width,a[3]=a[1]+(0,i.Ix)(_).height+3,(0,r.bounding_box)(n,a)},ge=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_closed=!0,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_DOOR",0))},me=function(e,t,n,a,o,r){var _=e,s=e.actor,c=(0,g.timer_get_delta)();_.is_closed?s.position.y=parseInt(Math.min(s.position.y+2e3*c,s.spawn_point.y),10):s.position.y=parseInt(Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*(0,i.Ix)(s).height),10)},ve=function(e,t){(0,i.z7)(e.actor,t)},he=function(e){(0,i.HI)(e.actor)},be=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.HN)(),t.who=null,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ENDSIGN",0))},ye=function(e,t,n,r,_,s){var c,d=e,l=e.actor;if(null==d.who)for(c=0;c<n;c++){var p=t[c];p&&!p.dying&&(0,i.Ib)(p.actor,l)&&(d.who=p,(0,u.sound_play)((0,f.soundfactory_get)("end sign")),(0,i.TK)(l,(0,o.sprite_get_animation)("SD_ENDSIGN",1)),(0,a.level_clear)(e.actor))}else if((0,i.$C)(l)){var g=2+d.who.type;(0,i.TK)(l,(0,o.sprite_get_animation)("SD_ENDSIGN",g))}},Ee=function(e,t){(0,i.z7)(e.actor,t)},xe=function(e){(0,i.HI)(e.actor)},Ie=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_EXPLOSION",(0,r.random)(2)))},we=function(e,t,n,a,o,r){(0,i.$C)(e.actor)&&(e.state=un)},Se=function(e,t){(0,i.z7)(e.actor,t)},ke=function(e){(0,i.HI)(e.actor)},Oe=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=actor.create(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_GLASSES",4)),e.actor.hot_spot.y*=.5},Ne=function(e,t,n,o,r,_){var c=e.actor,d=(0,g.timer_get_delta)();c.angle+=Math.sign(c.speed.x)*(6*s.PI*d),c.position=(0,m.v2d_add)(c.position,(0,i.B$)(c,(0,a.level_gravity)()))},Le=function(e,t){(0,i.z7)(e.actor,t)},De=function(e){(0,i.HI)(e.actor)},Te=n(176),Re=function(e,t){var n=e;(0,Te.font_set_text)(n.font,t)},Pe=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.HN)(),t.elapsed_time=0,t.font=(0,Te.font_create)(0),(0,Te.font_set_text)(t.font,"0"),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_RING",0)),e.actor.visible=!1},Me=function(e,t,n,a,i,o){var r=e,_=(0,g.timer_get_delta)();r.elapsed_time+=_,r.elapsed_time<.5?e.actor.position.y-=100*_:r.elapsed_time>2&&(e.state=un),r.font.position=e.actor.position},Ce=function(e,t){var n=e;(0,Te.font_render)(n.font,t)},je=function(e){var t=e;(0,i.HI)(e.actor),(0,Te.font_destroy)(t.font)},He=function(e,t,n,a){var i,o,r=s.INFINITY_FLT,_=null;for(i=t;i;i=i.next)i.data&&i.data.type==n&&(o=(0,m.v2d_subtract)(i.data.actor.position,e.actor.position),(0,m.v2d_magnitude)(o)<r&&(_=i.data,r=(0,m.v2d_magnitude)(o)));return a&&(a.dist=r),_},Ae=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",0))},Fe=function(e,t,n,a,r,_){var s,c=He(e,r,Wn,null);s=null!=c?c.actor.position.x>e.actor.position.x?0:1:0,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",s))},Ve=function(e,t){(0,i.z7)(e.actor,t)},Be=function(e){(0,i.HI)(e.actor)},We=n(709),Ge=function(e,t){(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ICON",t))},Ke=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,i.HN)(),t.elapsed_time=0,Ge(e,0)},Ue=function(e,t,n,o,_,s){var c=e,d=e.actor,l=(0,g.timer_get_delta)();if(c.elapsed_time+=l,c.elapsed_time<1)d.position.y-=40*l;else if(c.elapsed_time>=2.5){var p,u,f,v=parseInt(d.position.x-d.hot_spot.x,10),h=parseInt(d.position.y-d.hot_spot.y,10),b=(0,i.Ix)(d);for(p=0;p<b.h;p++)for(u=0;u<b.w;u++)f=(0,We.image_create)(1,1),(0,We.image_clear)(f,255,255,255),(0,a.level_create_particle)(f,(0,m.v2d_new)(v+u,h+p),(0,m.v2d_new)(u-b.width/2+((0,r.random)(b.width)-b.width/2),p-(0,r.random)(b.height/2)),!1);e.state=un}},Ye=function(e,t){(0,i.z7)(e.actor,t)},ze=function(e){(0,i.HI)(e.actor)},Xe=function(e,t){(0,a.level_add_to_score)(100),(0,N.player_set_lives)((0,N.player_get_lives)()+1),(0,a.level_override_music)((0,f.soundfactory_get)("1up"))},qe=function(e,t){(0,a.level_add_to_score)(100),(0,N.player_set_rings)((0,N.player_get_rings)()+10),(0,u.sound_play)((0,f.soundfactory_get)("ring"))},$e=function(e,t){(0,a.level_add_to_score)(100),t.invincible=!0,t.invtimer=0,(0,u.music_play)((0,u.music_load)("data/music/invincible.mp4"),0)},Qe=function(e,t){(0,a.level_add_to_score)(100),t.got_speedshoes=!0,t.speedshoes_timer=0,(0,u.music_play)((0,u.music_load)("data/music/speed.mp4"),0)},Je=function(e,t){(0,a.level_add_to_score)(100),t.got_glasses=!0},Ze=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_SHIELD,(0,u.sound_play)((0,f.soundfactory_get)("shield"))},et=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_FIRESHIELD,(0,u.sound_play)((0,f.soundfactory_get)("fire shield"))},tt=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_THUNDERSHIELD,(0,u.sound_play)((0,f.soundfactory_get)("thunder shield"))},nt=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_WATERSHIELD,(0,u.sound_play)((0,f.soundfactory_get)("water shield"))},at=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_ACIDSHIELD,(0,u.sound_play)((0,f.soundfactory_get)("acid shield"))},it=function(e,t){(0,a.level_add_to_score)(100),t.shield_type=N.SH_WINDSHIELD,audio.sound_play((0,f.soundfactory_get)("wind shield"))},ot=function(e,t){player_hit(t)},rt=function(e,t){(0,a.level_add_to_score)(100)},_t=function(e,t){var n={},a=n;return n.init=st,n.release=lt,n.update=ct,n.render=dt,a.on_destroy=e,a.anim_id=t,n},st=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.HN)(),(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ITEMBOX",t.anim_id))},ct=function(e,t,n,r,_,s){var c,d=e.actor,l=e;for(c=0;c<n;c++){var p=t[c];if(p&&!(p.actor.is_jumping&&p.actor.speed.y<-10)&&e.state===pn&&pt(e,p)&&(0,N.player_attacking)(p)){console.log("ITEM BOX HIT");var g=(0,a.level_create_item)(In,(0,m.v2d_add)(d.position,(0,m.v2d_new)(0,-5)));g.change_animation(g,l.anim_id),(0,a.level_create_item)(wn,(0,m.v2d_add)(d.position,(0,m.v2d_new)(0,-20))),(0,a.level_create_item)(xn,d.position),(0,u.sound_play)((0,f.soundfactory_get)("destroy")),p.actor.is_jumping&&p.bounce(p),l.on_destroy(e,p),e.state=un}}l.anim_id=l.anim_id<t.length?(0,a.level_player_id)():l.anim_id,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_ITEMBOX",l.anim_id))},dt=function(e,t){(0,i.z7)(e.actor,t)},lt=function(e){(0,i.HI)(e.actor)},pt=function(e,t){var n,a=e.actor.position;return n=(0,i.jW)(e.actor,t.actor),e.actor.position=a,n},ut=function(e,t){var n={},a=n;return n.init=ft,n.release=gt,n.update=mt,n.render=vt,a.on_collision=e,a.sprite_name=t,n},ft=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.HN)(),e.actor=(0,i.TK)(e.actor,(0,o.sprite_get_animation)(t.sprite_name,0))},gt=function(e){},mt=function(e,t,n,a,o,r){var _,s=e,c=e.actor;for(c.visible=!1,_=0;_<n;_++){var d=t[_];d&&(0,i.jW)(c,d.actor)&&(d.at_loopfloortop=ht(e,o,d),s.on_collision(d))}},vt=function(e,t){(0,i.z7)(e.actor,t)},ht=function(e,t,n){var a=He(e,t,Yn,null);return null!=a&&(0,i.jW)(n.actor,a.actor)},bt=function(e){e.disable_wall|=N.PLAYER_WALL_LEFT,e.entering_loop=!0,e.bring_to_back=!1},yt=function(e){if(!e.flying){var t=e.actor.speed.x>0;e.disable_wall&=~(N.PLAYER_WALL_LEFT|N.PLAYER_WALL_RIGHT),e.disable_wall|=t?N.PLAYER_WALL_RIGHT:N.PLAYER_WALL_LEFT,e.bring_to_back=t}},Et=function(e){e.disable_wall|=N.PLAYER_WALL_RIGHT,e.entering_loop=!0,e.bring_to_back=!0},xt=function(e){e.entering_loop||(e.disable_wall=N.PLAYER_WALL_NONE,e.bring_to_back=!1)},It=function(e){e.at_loopfloortop||e.flying||(e.disable_wall|=N.PLAYER_WALL_BOTTOM,e.entering_loop=!0,e.bring_to_back=!0)},wt=function(e){e.at_loopfloortop||e.entering_loop||e.flying||(e.disable_wall&=~N.PLAYER_WALL_BOTTOM,e.bring_to_back=!1)},St=function(e){if(!e.flying)if(e.disable_wall&N.PLAYER_WALL_BOTTOM){var t=e.actor.speed.x>0;e.disable_wall&=~(N.PLAYER_WALL_LEFT|N.PLAYER_WALL_RIGHT),e.disable_wall|=t?N.PLAYER_WALL_RIGHT:N.PLAYER_WALL_LEFT,e.bring_to_back=!0}else e.disable_wall&=~(N.PLAYER_WALL_LEFT|N.PLAYER_WALL_RIGHT),e.bring_to_back=!0},kt=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.HN)(),e.actor.maxspeed=220+(0,r.random)(140),e.actor.jump_strength=1.2*(350+(0,r.random)(50)),e.actor.input=(0,_.input_create_computer)(),t.is_disappearing=!1,t.is_moving=!1,t.life_time=0,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_RING",0))},Ot=function(e){},Nt=function(e,t,n,s,c,d){var l,p=(0,g.timer_get_delta)(),m=e,v=e.actor;for(l=0;l<n;l++){var h=t[l];if(h&&(!m.is_moving||m.is_moving&&!h.getting_hit&&m.life_time>=.5)&&!m.is_disappearing&&!h.dying&&(0,i.jW)(v,h.actor)){(0,N.player_set_rings)((0,N.player_get_rings)()+1),m.is_disappearing=!0,(0,u.sound_play)((0,f.soundfactory_get)("ring"));break}}if(m.is_disappearing)(0,i.TK)(v,(0,o.sprite_get_animation)("SD_RING",1)),(0,i.$C)(v)&&(e.state=un);else if(m.is_moving){if((0,_.input_simulate_button_down)(v.input,_.IB_FIRE1),e.preserve=!1,m.life_time+=p,m.life_time>5){var b=240+(0,r.random)(20);v.visible=parseInt(((0,g.timer_get_ticks)(),10))<b/2,m.life_time>8&&(e.state=un)}(0,i.q8)(v,(0,i.nG)(v,s,(0,a.level_gravity)()))}},Lt=function(e,t){(0,i.z7)(e.actor,t)},Dt=function(e,t,n){var a={},i=a;return a.init=Tt,a.release=Rt,a.update=Pt,a.render=Mt,i.collision=e,i.anim_id=t,i.cycle_length=n,a},Tt=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.timer=0,t.hidden=!1,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_SPIKES",t.anim_id))},Rt=function(e){(0,i.HI)(e.actor)},Pt=function(e,t,n,a,i,o){var r,_=e,s=(0,g.timer_get_delta)();if(_.timer+=s,_.timer>=.5*_.cycle_length&&(_.timer=0,_.hidden=!_.hidden,(0,u.sound_play)((0,f.soundfactory_get)(_.hidden?"spikes disappearing":"spikes appearing"))),e.obstacle=!_.hidden,e.actor.visible=!_.hidden,!_.hidden)for(r=0;r<n;r++){var c=t[r];if(c&&!c.dying&&!c.blinking&&!c.invincible&&_.collision(e,c)){var d=(0,f.soundfactory_get)("spikes hit");(0,u.sound_is_playing)(d)||(0,u.sound_play)(d),(0,N.player_hit)(c)}}},Mt=function(e,t){(0,i.z7)(e.actor,t)},Ct=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+(0,i.Ix)(a).width,n[3]=n[1]+(0,i.Ix)(a).height,(0,r.bounding_box)(n,t)},jt=function(e,t){var n,a=[],o=e.actor;return a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y-5,a[2]=a[0]+(0,i.Ix)(o).width-10,a[3]=a[1]+10,n=t.actor.position.y-t.actor.hot_spot.y+(0,i.Ix)(t.actor).height,Ct(t,a)&&n<o.position.y-o.hot_spot.y+(0,i.Ix)(o).height/2},Ht=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+(0,i.Ix)(a).height-5,n[2]=n[0]+(0,i.Ix)(a).width-10,n[3]=n[1]+10,Ct(t,n)},At=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+(0,i.Ix)(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,i.Ix)(a).height-10,Ct(t,n)},Ft=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,i.Ix)(a).height-10,Ct(t,n)},Vt=function(e,t,n){var a={};return a.init=Bt,a.release=Wt,a.update=Gt,a.render=Kt,a.on_bump=e,a.sprite_name=t,a.strength=n,a},Bt=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_bumping=!1,t.bang_timer=0,(0,i.TK)(e.actor,(0,o.sprite_get_animation)(t.sprite_name,0))},Wt=function(e){},Gt=function(e,t,n,a,r,_){var s,c=e,d=(0,g.timer_get_delta)();for(c.bang_timer+=d,s=0;s<n;s++){var l=t[s];l&&!l.dying&&(0,i.Ib)(l.actor,e.actor)&&c.on_bump(e,l)}c.is_bumping&&(0,i.$C)(e.actor)&&((0,i.TK)(e.actor,(0,o.sprite_get_animation)(c.sprite_name,0)),c.is_bumping=!1)},Kt=function(e,t){(0,i.z7)(e.actor,t)},Ut=function(e,t){t.actor.speed.y>=1&&!t.actor.carrying&&!t.actor.carried_by&&zt(e,t)},Yt=function(e,t){zt(e,t)},zt=function(e,t){var n=e;e.is_bumping=!0,function(e,t){var n=(0,g.timer_get_delta)(),a=[],i=[];a[0]=t.x*e.actor.speed.x>=0,a[1]=t.y*e.actor.speed.y>=0,i[0]=t.x*e.actor.speed.x<=0&&Math.abs(t.x)>s.EPSILON,i[1]=t.y*e.actor.speed.y<=0&&Math.abs(t.y)>s.EPSILON,Math.abs(t.y)>s.EPSILON&&(e.spring=!0),e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1,(Math.abs(t.x)>Math.abs(e.actor.speed.x)&&a[0]||i[0])&&(e.actor.speed.x=t.x),(Math.abs(t.y)>Math.abs(e.actor.speed.y)&&a[1]||i[1])&&(e.actor.speed.y=t.y,e.actor.position.y+=e.actor.speed.y*n)}(t,e.strength),(0,i.TK)(n.actor,(0,o.sprite_get_animation)(e.sprite_name,1)),e.strength.x>s.EPSILON?t.actor.mirror&=~s.IF_HFLIP:e.strength.x<-s.EPSILON&&(t.actor.mirror|=s.IF_HFLIP),e.bang_timer>.2&&((0,u.sound_play)((0,f.soundfactory_get)("spring")),e.bang_timer=0)},Xt=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_disabled=!1,t.is_active=!1,t.timer=0,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_TELEPORTER",0))},qt=function(e,t,n,r,s,c){var d,l=e,p=e.actor,u=(0,g.timer_get_delta)(),f=0;if(l.is_active){if(l.timer+=u,l.timer>=3){var v=l.who;for((0,_.input_restore)(v.actor.input),(0,a.level_set_camera_focus)(v.actor),d=0;d<n;d++){var h=t[d];if(h!=v){var b=(0,m.v2d_add)(p.position,(0,m.v2d_new)(40*f++-20,-30));Jt(h,b)}}l.is_active=!1,l.is_disabled=!0}(0,i.TK)(p,(0,o.sprite_get_animation)("SD_TELEPORTER",1))}else(0,i.TK)(p,(0,o.sprite_get_animation)("SD_TELEPORTER",0))},$t=function(e,t){(0,i.z7)(e.actor,t)},Qt=function(e){(0,i.HI)(e.actor)},Jt=function(e,t){e&&(e.actor.position=t,e.actor.speed=(0,m.v2d_new)(0,0),e.actor.is_jumping=!1,e.flying=!1,e.climbing=!1,e.getting_hit=!1,e.spring=!1,e.actor.angle=0,e.disable_wall=N.PLAYER_WALL_NONE,e.entering_loop=!1,e.at_loopfloortop=!1,e.bring_to_back=!1)},Zt=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.HN)(),t.is_pressed=!1,t.partner=null,(0,i.TK)(e.actor,(0,o.sprite_get_animation)("SD_SWITCH",0))},en=function(e){(0,i.HI)(e.actor)},tn=function(e,t,n,a,i,o){var r,_,s=e,c={},d={};s.partner=null,r=He(e,i,Hn,c),_=He(e,i,An,d),null!=r&&c.dist<d.dist&&(s.partner=r),null!=_&&d.dist<c.dist&&(s.partner=_),null==s.partner?an(e,r,t,n,on,rn):s.partner==r?an(e,r,t,n,_n,sn):s.partner==_&&an(e,_,t,n,cn,dn)},nn=function(e,t){(0,i.z7)(e.actor,t)},an=function(e,t,n,a,r,_){var s,c=!0,d=e,l=e.actor;for(s=0;s<a;s++){var p=n[s];ln(e,p)&&(c=!1,d.is_pressed||(r(t,p),(0,u.sound_play)((0,f.soundfactory_get)("switch")),(0,i.TK)(l,(0,o.sprite_get_animation)("SD_SWITCH",1)),d.is_pressed=!0))}c&&d.is_pressed&&(_(t),(0,i.TK)(l,(0,o.sprite_get_animation)("SD_SWITCH",0)),d.is_pressed=!1)},on=function(e,t){},rn=function(e){},_n=function(e,t){!function(e){e.is_closed=!1,(0,u.sound_play)((0,f.soundfactory_get)("open door"))}(e)},sn=function(e){!function(e){e.is_closed=!0,(0,u.sound_play)((0,f.soundfactory_get)("close door"))}(e)},cn=function(e,t){!function(e,t){var n=e,i=e.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=t,(0,_.input_ignore)(t.actor.input),(0,a.level_set_camera_focus)(i),(0,u.sound_play)((0,f.soundfactory_get)("teleporter")))}(e,t)},dn=function(e){},ln=function(e,t){if(!e)return!1;if(!t)return!1;var n=[],a=[];return n[0]=e.actor.position.x-e.actor.hot_spot.x,n[1]=e.actor.position.y-e.actor.hot_spot.y,n[2]=n[0]+(0,i.Ix)(e.actor).width,n[3]=n[1]+(0,i.Ix)(e.actor).height,a[0]=t.actor.position.x-t.actor.hot_spot.x+.3*(0,i.Ix)(t.actor).width,a[1]=t.actor.position.y-t.actor.hot_spot.y+.5*(0,i.Ix)(t.actor).height,a[2]=a[0]+.4*(0,i.Ix)(t.actor).width,a[3]=a[1]+.5*(0,i.Ix)(t.actor).height,!t.dying&&!t.climbing&&!t.flying&&(0,r.bounding_box)(n,a)},pn=0,un=1,fn=0,gn=1,mn=2,vn=3,hn=4,bn=5,yn=6,En=7,xn=9,In=10,wn=12,Sn=13,kn=15,On=16,Nn=17,Ln=18,Dn=19,Tn=20,Rn=21,Pn=22,Mn=23,Cn=24,jn=25,Hn=26,An=27,Fn=28,Vn=29,Bn=30,Wn=31,Gn=32,Kn=33,Un=34,Yn=35,zn=36,Xn=37,qn=38,$n=39,Qn=40,Jn=41,Zn=42,ea=43,ta=44,na=45,aa=46,ia=47,oa=48,ra=49,_a=50,sa=51,ca=52,da=53,la=54,pa=55,ua=56,fa=57,ga=58,ma=59,va=60,ha=61,ba=62,ya=63,Ea=64,xa=65,Ia=66,wa=67,Sa=68,ka=69,Oa=70,Na=71,La=72,Da=73,Ta=74,Ra=75,Pa=76,Ma=77,Ca=78,ja=79,Ha=80,Aa=81,Fa=function(e){var t=null;switch(e){case fn:t=function(){var e={};return e.init=kt,e.release=Ot,e.update=Nt,e.render=Lt,e}();break;case gn:t=_t(Xe,0);break;case mn:t=_t(qe,3);break;case vn:t=_t($e,4);break;case hn:t=_t(Qe,5);break;case bn:t=_t(Je,6);break;case yn:t=_t(Ze,7);break;case Zn:t=_t(et,11);break;case Ca:t=_t(tt,12);break;case ja:t=_t(nt,13);break;case Ha:t=_t(at,14);break;case Aa:t=_t(it,15);break;case En:t=_t(ot,8);break;case 8:t=_t(rt,9);break;case xn:t=function(){var e={};return e.init=z,e.release=$,e.update=X,e.render=q,e}();break;case In:t=function(){var e={};return e.init=Ke,e.release=ze,e.update=Ue,e.render=Ye,e.change_animation=Ge,e}();break;case 11:t=function(){var e={};return e.init=Oe,e.release=De,e.update=Ne,e.render=Le,e}();break;case wn:t=function(){var e={};return e.init=Ie,e.release=ke,e.update=we,e.render=Se,e}();break;case Sn:t=function(){var e={};return e.init=Pe,e.release=je,e.update=Me,e.render=Ce,e.set_text=Re,e}();break;case kn:t=function(){var e={};return e.init=c,e.release=d,e.update=l,e.render=p,e}();break;case On:t=ut(bt,"SD_LOOPRIGHT");break;case Nn:t=ut(yt,"SD_LOOPMIDDLE");break;case Ln:t=ut(Et,"SD_LOOPLEFT");break;case Dn:t=ut(xt,"SD_LOOPNONE");break;case Kn:t=ut(It,"SD_LOOPFLOOR");break;case Un:t=ut(wt,"SD_LOOPFLOORNONE");break;case Yn:t=ut(St,"SD_LOOPFLOORTOP");break;case Tn:t=Vt(Ut,"SD_YELLOWSPRING",(0,m.v2d_new)(0,-500));break;case la:t=Vt(Yt,"SD_BYELLOWSPRING",(0,m.v2d_new)(0,500));break;case _a:t=Vt(Yt,"SD_TRYELLOWSPRING",(0,m.v2d_new)(400,-600));break;case oa:t=Vt(Yt,"SD_RYELLOWSPRING",(0,m.v2d_new)(600,0));break;case ca:t=Vt(Yt,"SD_BRYELLOWSPRING",(0,m.v2d_new)(400,600));break;case da:t=Vt(Yt,"SD_BLYELLOWSPRING",(0,m.v2d_new)(-400,600));break;case ra:t=Vt(Yt,"SD_LYELLOWSPRING",(0,m.v2d_new)(-600,0));break;case sa:t=Vt(Yt,"SD_TLYELLOWSPRING",(0,m.v2d_new)(-400,-600));break;case Rn:t=Vt(Ut,"SD_REDSPRING",(0,m.v2d_new)(0,-750));break;case ia:t=Vt(Yt,"SD_BREDSPRING",(0,m.v2d_new)(0,750));break;case ea:t=Vt(Yt,"SD_TRREDSPRING",(0,m.v2d_new)(800,-1e3));break;case Pn:t=Vt(Yt,"SD_RREDSPRING",(0,m.v2d_new)(1200,0));break;case na:t=Vt(Yt,"SD_BRREDSPRING",(0,m.v2d_new)(800,1e3));break;case aa:t=Vt(Yt,"SD_BLREDSPRING",(0,m.v2d_new)(-800,1e3));break;case Mn:t=Vt(Yt,"SD_LREDSPRING",(0,m.v2d_new)(-1200,0));break;case ta:t=Vt(Yt,"SD_TLREDSPRING",(0,m.v2d_new)(-800,-1e3));break;case pa:t=Vt(Ut,"SD_BLUESPRING",(0,m.v2d_new)(0,-1500));break;case ba:t=Vt(Yt,"SD_BBLUESPRING",(0,m.v2d_new)(0,1500));break;case ga:t=Vt(Yt,"SD_TRBLUESPRING",(0,m.v2d_new)(1800,-1500));break;case ua:t=Vt(Yt,"SD_RBLUESPRING",(0,m.v2d_new)(2e3,0));break;case va:t=Vt(Yt,"SD_BRBLUESPRING",(0,m.v2d_new)(1800,1500));break;case ha:t=Vt(Yt,"SD_BLBLUESPRING",(0,m.v2d_new)(-1800,1500));break;case fa:t=Vt(Yt,"SD_LBLUESPRING",(0,m.v2d_new)(-2e3,0));break;case ma:t=Vt(Yt,"SD_TLBLUESPRING",(0,m.v2d_new)(-1800,-1500));break;case Cn:t=function(){var e={};return e.init=M,e.release=H,e.update=C,e.render=j,e}();break;case jn:t=function(){var e={};return e.init=Zt,e.release=en,e.update=tn,e.render=nn,e}();break;case Hn:a.PLAYERS.length>1&&(t=function(){var e={};return e.init=ge,e.release=he,e.update=me,e.render=ve,e}());break;case An:t=function(){var e={};return e.init=Xt,e.release=Qt,e.update=qt,e.render=$t,e}();break;case Fn:t=function(){var e={};return e.init=D,e.release=T,e.update=R,e.render=P,e}();break;case Vn:t=function(){var e={};return e.init=G,e.release=Y,e.update=K,e.render=U,e}();break;case Bn:t=function(){var e={};return e.init=Ae,e.release=Be,e.update=Fe,e.render=Ve,e}();break;case Wn:t=function(){var e={};return e.init=be,e.release=xe,e.update=ye,e.render=Ee,e}();break;case Gn:t=function(){var e={},t=e;return e.init=v,e.release=h,e.update=b,e.render=y,t.state=null,e}();break;case zn:t=function(){var e={};return e.init=A,e.release=B,e.update=F,e.render=V,e}();break;case Xn:t=Q("SD_DANGER",ne);break;case Ra:t=Q("SD_VERTICALDANGER",ne);break;case Pa:t=Q("SD_FIREDANGER",ae);break;case Ma:t=Q("SD_VERTICALFIREDANGER",ae);break;case qn:t=Dt(jt,0,s.INFINITY_FLT);break;case ya:t=Dt(Ht,2,s.INFINITY_FLT);break;case Ea:t=Dt(At,1,s.INFINITY_FLT);break;case xa:t=Dt(Ft,3,s.INFINITY_FLT);break;case Ia:t=Dt(jt,0,5);break;case wa:t=Dt(Ht,2,5);break;case Sa:t=Dt(At,1,5);break;case ka:t=Dt(Ft,3,5);break;case $n:t=ce(N.PL_SONIC,!0);break;case Oa:t=ce(N.PL_TAILS,!0);break;case Na:t=ce(N.PL_KNUCKLES,!0);break;case La:t=ce(N.PL_SONIC,!1);break;case Da:t=ce(N.PL_TAILS,!1);break;case Ta:t=ce(N.PL_KNUCKLES,!1);break;case Qn:case Jn:t=function(){var e={};return e.init=oe,e.release=se,e.update=re,e.render=_e,e.dangerouspower_set_speed=ie,e}()}return null!=t&&(t.type=e,t.state=pn,t.init(t)),t},Va=function(e){return null},Ba=function(e,t,n,a,i,o){e.update(e,t,n,a,i,o)},Wa=function(e,t){e.render(e,t)}},971:(e,t,n)=>{n.r(t),n.d(t,{PLAYER_INITIAL_LIVES:()=>b,PLAYER_JUMP_SENSITIVITY:()=>D,PLAYER_MAX_BLINK:()=>k,PLAYER_MAX_INVINCIBILITY:()=>O,PLAYER_MAX_INVSTAR:()=>y,PLAYER_MAX_SPEEDSHOES:()=>N,PLAYER_WALL_BOTTOM:()=>w,PLAYER_WALL_LEFT:()=>S,PLAYER_WALL_NONE:()=>E,PLAYER_WALL_RIGHT:()=>I,PLAYER_WALL_TOP:()=>x,PL_KNUCKLES:()=>P,PL_SONIC:()=>T,PL_TAILS:()=>R,SH_ACIDSHIELD:()=>F,SH_FIRESHIELD:()=>j,SH_NONE:()=>M,SH_SHIELD:()=>C,SH_THUNDERSHIELD:()=>H,SH_WATERSHIELD:()=>A,SH_WINDSHIELD:()=>V,TAILS_MAX_FLIGHT:()=>L,player_attacking:()=>Q,player_bounce:()=>$,player_create:()=>G,player_destroy:()=>K,player_get_lives:()=>Z,player_get_rings:()=>J,player_get_score:()=>ee,player_get_sprite_name:()=>te,player_hit:()=>X,player_kill:()=>q,player_platform_movement:()=>z,player_render:()=>Y,player_set_lives:()=>ae,player_set_rings:()=>ne,player_set_score:()=>ie,player_update:()=>U});var a,i,o=n(120),r=n(429),_=n(798),s=n(931),c=n(470),d=n(689),l=n(880),p=n(709),u=n(898),f=n(163),g=n(878),m=n(386),v=n(954),h=n(218),b=5,y=5,E=0,x=1,I=2,w=4,S=8,k=4,O=23,N=23,L=10,D=.88,T=0,R=1,P=2,M=0,C=1,j=2,H=3,A=4,F=5,V=6,B=0,W=0,G=function(e){var t,n={};switch((0,u.logfile_message)("player_create(%d)",e),e){case T:n.name="Surge";break;case R:n.name="Neon";break;case P:n.name="Charge";break;default:n.name="Unknown"}for(n.type=e,n.actor=(0,o.HN)(),n.disable_movement=!1,n.in_locked_area=!1,n.at_some_border=!1,n.attacking=Q,n.bounce=$,n.spin=n.spin_dash=n.braking=n.flying=n.climbing=n.landing=n.spring=!1,n.is_fire_jumping=!1,n.getting_hit=n.dying=n.dead=n.blinking=!1,n.on_moveable_platform=!1,n.lock_accel=0,n.flight_timer=n.blink_timer=n.death_timer=0,n.disable_jump_for=0,n.glasses=(0,o.HN)(),n.got_glasses=!0,n.shield=(0,o.HN)(),n.shield_type=M,n.invincible=!1,n.invtimer=0,n.invstar=[],t=0;t<y;t++)n.invstar[t]=(0,o.HN)(),n.invstar[t]=(0,o.TK)(n.invstar[t],(0,l.sprite_get_animation)("SD_INVSTAR",0));switch(n.got_speedshoes=!1,n.speedshoes_timer=0,n.disable_wall=E,n.entering_loop=!1,n.at_loopfloortop=!1,n.bring_to_back=!1,n.type){case T:n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=(0,d.input_create_user)(),n.actor=(0,o.TK)(n.actor,(0,l.sprite_get_animation)(oe(T),0));break;case R:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,d.input_create_user)(),n.actor=(0,o.TK)(n.actor,(0,l.sprite_get_animation)(oe(R),0));break;case P:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,d.input_create_user)(),n.actor=(0,o.TK)(n.actor,(0,l.sprite_get_animation)(oe(P),0))}return i=1,a=0,(0,u.logfile_message)("player_create() ok"),n},K=function(){},U=function(e,t,n){var a=e.actor;return e.blinking&&(e.blink_timer+=(0,f.timer_get_delta)(),a.visible=(0,f.timer_get_ticks)()%250<125,e.blink_timer>=k&&(e.getting_hit=e.blinking=!1,a.visible=!0)),e.disable_movement?e.spin?e.actor=(0,o.TK)(e.actor,(0,l.sprite_get_animation)(oe(e.type),3)):e.spring&&(e.actor=(0,o.TK)(e.actor,(0,l.sprite_get_animation)(oe(e.type),13))):(0,o.q8)(a,z(e,t,n,(0,h.level_gravity)())),e},Y=function(e,t){if(e){var n=e.actor;if(n){var a,i,r=n.hot_spot,_=n.position,s=(0,g.v2d_new)(0,0),c=(0,g.v2d_new)(0,0),d=[],p=n.angle;if(e.invincible){var u=(0,l.sprite_get_animation)("SD_INVSTAR",0).frame_count;for(e.invtimer+=(0,f.timer_get_delta)(),a=0;a<y;a++)d[a]=720*(0,f.timer_get_ticks)()*.001+(a+1)*(360/y),c.x=30*Math.cos(d[a]*m.PI/180),c.y=((0,f.timer_get_ticks)()+400*a)%2e3/40,c=(0,g.v2d_rotate)(c,p),e.invstar[a].position.x=n.position.x+c.x,e.invstar[a].position.y=n.position.y-c.y+5,(0,o.lY)(e.invstar[a],(0,v.random)(u))}for(e.got_glasses&&re(e),e.shield_type!=M&&se(e),e.type,a=0;a<y&&e.invincible;a++)d[a]%360>=180&&(0,o.z7)(e.invstar[a],t);for(i=n.angle,n.angle=n.is_jumping||e.spin?i:(0,v.old_school_angle)(i),(0,o.z7)(n,t),n.angle=i,e.got_glasses&&(0,o.z7)(e.glasses,t),e.shield_type!=M&&(0,o.z7)(e.shield,t),a=0;a<y&&e.invincible;a++)d[a]%360<180&&(0,o.z7)(e.invstar[a],t);switch(e.type){case T:break;case R:n.is_jumping&&n.animation==(0,l.sprite_get_animation)(oe(R),3)&&(n.position=(0,g.v2d_new)(_.x,_.y),n.angle=p,n.hot_spot=r,e.shield_type!=M&&(e.shield.angle=0,e.shield.hot_spot=s))}}}},z=function(e,t,n,a){var i,_,u,b,y,E,k,O,M,C,j,H,A,F,V,B,W,G,K,U,Y=e.actor,z=oe(e.type),X=(0,f.timer_get_delta)(),q=480,$=0,Q=1,J=Y.maxspeed,Z=(0,g.v2d_new)(0,0),ee=!1,te=e.actor.animation==(0,l.sprite_get_animation)(z,1),ne=!1,ae=!1,ie=!1,re=null,_e=(0,o.Ix)(Y).width,se=(0,o.Ix)(Y).height,de=!(Math.abs(Y.angle)<m.EPSILON||Math.abs(Y.angle-m.PI/2)<m.EPSILON||Math.abs(Y.angle-m.PI)<m.EPSILON||Math.abs(Y.angle-3*m.PI/2)<m.EPSILON),le=-2,pe=0,ue=0,fe=0,ge=Y.position;switch(e.type){case T:de?(pe=1,ue=.8,fe=.5):(pe=.7,ue=.5,fe=.4);break;case R:case P:de?(pe=1,ue=.7,fe=.25):(pe=.7,ue=.5,fe=.25)}if(A=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(0,-se*pe+le),-Y.angle)),W=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(0,2),-Y.angle)),K=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,-se*ue),-Y.angle)),V=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,-se*ue),-Y.angle)),U=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,-se*pe+le),-Y.angle)),F=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,-se*pe+le),-Y.angle)),G=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-_e*fe+le,2),-Y.angle)),B=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(_e*fe-le,2),-Y.angle)),e.type==R&&Y.carrying&&Math.abs(Y.angle)<m.EPSILON){var me=(0,o.Ix)(Y.carrying).height,ve=Y.speed.y>5?.7*me:0;G.y+=ve,B.y+=ve,W.y+=ve,K.y+=me*ue+(0,v.random)(me)-.5*me,V.y=K.y}(0,o.$c)(e.disable_wall&S,e.disable_wall&I,e.disable_wall&w,e.disable_wall&x),(0,o.jP)(!(e.disable_wall&w));var he=(0,o.rE)(Y,2,A,F,V,B,W,G,K,U,n,b,O,E,M,y,C,k,j);if(b=he.up,y=he.down,k=he.left,E=he.right,j=he.upleft,O=he.upright,C=he.downleft,M=he.downright,(0,o.SI)(),e.dying)return Y.speed.x=0,Y.speed.y=Math.min(q,Y.speed.y+a*X),Y.mirror=null,Y.angle=0,Y.visible=!0,e.blinking=!1,e.death_timer+=X,e.dead=e.death_timer>=2.5,Y=(0,o.TK)(Y,(0,l.sprite_get_animation)(z,8)),(0,g.v2d_new)(0,Y.speed.y*X+.5*a*X*X);if(e.dead)return(0,g.v2d_new)(0,0);var be=(0,o.K1)(Y,le,b,O,E,M,y,C,k,j);switch(b=be.up,O=be.upright,E=be.right,k=be.left,j=be.upleft,y=be.down,C=be.downleft,M=be.downright,e.type){case T:Y.carry_offset=(0,g.v2d_new)(Y.mirror&m.IF_HFLIP?7:-9,-40);break;case R:case P:Y.carry_offset=(0,g.v2d_new)(Y.mirror&m.IF_HFLIP?7:-7,-42)}if(null!=Y.carried_by){var ye,Ee=null,xe=0,Ie=0,we=Y.carried_by;for(ye=0;ye<t.length;ye++)if(t[ye]==e){Ie=ye;break}for(ye=0;ye<t.length;ye++)if(t[ye].actor==we){Ee=t[ye],xe=ye,e.disable_wall=Ee.disable_wall,e.entering_loop=Ee.entering_loop,e.at_loopfloortop=Ee.at_loopfloortop,e.bring_to_back=Ee.bring_to_back;break}if(Ee&&(Ee.type==R&&!Ee.flying||Ee.getting_hit||Ee.dying||Ee.dead))Y.position=(0,g.v2d_new)(Y.carried_by.position.x,Y.carried_by.position.y),Y.carried_by.carrying=null,Y.carried_by=null;else{if(!(y&&0==y.brick_ref.angle&&parseInt(we.speed.y,10)>=5||e.getting_hit||e.dying||e.dead)){var Se=Ie<xe?(0,g.v2d_multiply)(we.speed,X):(0,g.v2d_new)(0,0);return Y.speed=(0,g.v2d_new)(0,0),Y.mirror=we.mirror,Y.angle=0,(Y=(0,o.TK)(Y,(0,l.sprite_get_animation)(z,25))).position=(0,g.v2d_subtract)((0,g.v2d_add)(we.position,Se),Y.carry_offset),(0,g.v2d_new)(0,0)}Y.position=(0,g.v2d_new)(Y.carried_by.position.x,Y.carried_by.position.y),Y.carried_by.carrying=null,Y.carried_by=null}}if(e.entering_loop=!1,e.got_speedshoes&&(e.speedshoes_timer>N?e.got_speedshoes=!1:(J*=1.5,e.speedshoes_timer+=X)),ce(e)&&Y.is_jumping&&(e.disable_wall&=~w),e.spring&&(y&&parseInt(Y.speed.y,10)>=0||e.flying||e.climbing)&&(e.spring=!1),i=(E&&(0,d.input_button_down)(Y.input,d.IB_RIGHT)||k&&(0,d.input_button_down)(Y.input,d.IB_LEFT))&&y,e.on_moveable_platform=(0,g.v2d_magnitude)((0,h.level_brick_move_actor)(y,Y))>m.EPSILON,(u=y&&(Y.angle>0&&Y.angle<m.PI/2&&Y.speed.x>0||Y.angle>3*m.PI/2&&Y.angle<2*m.PI&&Y.speed.x<0))&&(j||O)||Math.abs(Y.angle)<m.EPSILON||Math.abs(Y.angle-m.PI)<m.EPSILON){if(E&&E.brick_ref.angle%90==0&&(Y.speed.x>m.EPSILON||V.x>E.x)&&(!u||u&&90!=E.brick_ref.angle)&&(Y.speed.x=0,Y.position.x=E.x+(ge.x-V.x),!Y.is_jumping&&!e.flying&&!e.climbing&&Math.abs(Y.speed.y)<m.EPSILON&&(re=(0,l.sprite_get_animation)(z,i?14:0)),u))return(0,g.v2d_new)(-5,0);if(k&&k.brick_ref.angle%90==0&&(Y.speed.x<-m.EPSILON||K.x<k.x+k.brick_ref.image.width)&&(!u||u&&270!=k.brick_ref.angle)&&(Y.speed.x=0,Y.position.x=k.x+k.brick_ref.image.width+(ge.x-K.x),!Y.is_jumping&&!e.flying&&!e.climbing&&Math.abs(Y.speed.y)<m.EPSILON&&(re=(0,l.sprite_get_animation)(z,i?14:0)),u))return(0,g.v2d_new)(5,0);Y.position.x<=Y.hot_spot.x&&(e.spin=!1,ae=!0,Y.position.x<Y.hot_spot.x&&(Y.speed.x=0,Y.position.x=Y.hot_spot.x,y&&(i=!0,re=(0,l.sprite_get_animation)(z,1)))),Y.position.x>=(0,h.level_size)().x-((0,o.Ix)(Y).width-Y.hot_spot.x)&&(e.spin=!1,ne=!0,Y.position.x>(0,h.level_size)().x-((0,o.Ix)(Y).width-Y.hot_spot.x)&&(Y.speed.x=0,Y.position.x=(0,h.level_size)().x-((0,o.Ix)(Y).width-Y.hot_spot.x),y&&(i=!0,re=(0,l.sprite_get_animation)(z,1))))}if(!e.climbing){if(y){var ke,Oe,Ne=y.brick_ref.angle;if(ee=!0,Y.ignore_horizontal=!1,e.is_fire_jumping=!1,Y.is_jumping=!1,y.brick_ref&&y.brick_ref.behavior==r.CH&&y.state==r.Uz&&(y.state=r.q4),Math.abs(Y.speed.x)<m.EPSILON){if(Ne%180==0&&(e.spin=!1),(0,d.input_button_down)(Y.input,d.IB_DOWN))e.spin_dash||(re=(0,l.sprite_get_animation)(z,4)),(0,d.input_button_pressed)(Y.input,d.IB_FIRE1)&&(re=(0,l.sprite_get_animation)(z,6),e.spin_dash=!0,(0,s.sound_play)((0,c.soundfactory_get)("charge")));else if(!i)if((0,d.input_button_down)(Y.input,d.IB_UP))te&&e.at_some_border||(re=(0,l.sprite_get_animation)(z,5));else if(ce(e))re=(0,l.sprite_get_animation)(z,0);else{var Le=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(-8,0),-Y.angle)),De=(0,g.v2d_add)(ge,(0,g.v2d_rotate)((0,g.v2d_new)(5,0),-Y.angle)),Te=(0,g.v2d_new)(0,0),Re=(0,o.rE)(Y,2,Te,Te,Te,De,Te,Le,Te,Te,n,null,null,null,void 0,null,void 0,null,null);Re.downleft&&Re.downright||e.on_moveable_platform?(0,d.input_button_down)(Y.input,d.IB_LEFT)&&(ae||e.at_some_border)||(0,d.input_button_down)(Y.input,d.IB_RIGHT)&&(ne||e.at_some_border)?(Y.mirror=ae?m.IF_HFLIP:m.IF_NONE,re=(0,l.sprite_get_animation)(z,1)):re=(0,l.sprite_get_animation)(z,0):re=(0,l.sprite_get_animation)(z,10)}if(e.spin_dash){var Pe,Me,Ce,je,He=Y.mirror&m.IF_HFLIP?1:-1;for(Pe=0;Pe<3;Pe++)(0,v.random)(128),je=(0,p.image_create)(1,1),(0,p.image_clear)(je,255,255,255),Me=(0,g.v2d_new)(He*(7+(0,v.random)(7)),2),Ce=(0,g.v2d_new)(He*(50+(0,v.random)(200)),-(0,v.random)(200)),(0,h.level_create_particle)(je,(0,g.v2d_add)(Y.position,Me),Ce,!0);((0,d.input_button_up)(Y.input,d.IB_DOWN)||(0,h.level_editmode)())&&(e.spin=!0,e.spin_dash=!1,(!(Y.mirror&m.IF_HFLIP)||k||ae)&&(Y.mirror&m.IF_HFLIP||E||ne)||(Y.speed.x=(Y.mirror&m.IF_HFLIP?-1:1)*J*1.35),(0,s.sound_play)((0,c.soundfactory_get)("release")),e.disable_jump_for=.05)}}else if((0,d.input_button_down)(Y.input,d.IB_DOWN)&&(e.spin||(0,s.sound_play)((0,c.soundfactory_get)("roll")),e.spin=!0),e.spin||e.braking){if(e.spin)re=(0,l.sprite_get_animation)(z,3);else if(e.braking){var Ae,Fe,Ve,Be=Y.mirror&m.IF_HFLIP?1:-1;(0,v.random)(128),Ve=(0,p.image_create)(1,1),Ae=(0,g.v2d_new)(Be*(10-(0,v.random)(21)),0),Fe=(0,g.v2d_new)(Be*(50+(0,v.random)(200)),-(0,v.random)(200)),(0,h.level_create_particle)(Ve,(0,g.v2d_add)(Y.position,Ae),Fe,!0),re=(0,l.sprite_get_animation)(z,7),Math.abs(Y.speed.x)<10&&(e.braking=!1)}}else{var We=.75*J,Ge=.35*J;Math.abs(Y.speed.x)<We?!i&&Y.speed.y>=0&&(re=(0,l.sprite_get_animation)(z,1),Y=(0,o.ih)(Y,.5+Math.abs(Y.speed.x)/We*1.5)):re=(0,l.sprite_get_animation)(z,2),Math.abs(Y.speed.x)>=Ge&&((0,d.input_button_down)(Y.input,d.IB_RIGHT)&&Y.speed.x<0||(0,d.input_button_down)(Y.input,d.IB_LEFT)&&Y.speed.x>0)&&((0,s.sound_play)((0,c.soundfactory_get)("brake")),e.braking=!0)}if(e.disable_jump_for=Math.max(e.disable_jump_for-X,0),Math.abs(Y.speed.x)<m.EPSILON&&(e.disable_jump_for=0),ke=!e.spin_dash,(0,d.input_button_down)(Y.input,d.IB_FIRE1)&&e.disable_jump_for<=0&&!(0,d.input_button_down)(Y.input,d.IB_DOWN)&&!b&&!e.landing&&ke&&!Y.is_jumping&&((0,s.sound_play)((0,c.soundfactory_get)("jump")),Y.angle=0,Y.is_jumping=!0,e.is_fire_jumping=!0,ie=!0,e.spin=!1,re=(0,l.sprite_get_animation)(z,3),0==Ne?Y.speed.y=1*-Y.jump_strength:Ne>0&&Ne<90?Ne>45?(Y.speed.x=Math.min(Y.speed.x,-.7*Y.jump_strength*1),Y.speed.y=-.7*Y.jump_strength*1):(Y.speed.x*=Y.speed.x>0?.5:1,Y.speed.y=1*-Y.jump_strength):90==Ne?((0,o.q8)(Y,(0,g.v2d_new)(-40,0)),Y.speed.x=Math.min(Y.speed.x,1*-Y.jump_strength),Y.speed.y=-Y.jump_strength/2*1):Ne>90&&Ne<180?((0,o.q8)(Y,(0,g.v2d_new)(0,40)),Y.speed.x=Math.min(Y.speed.x,-.7*Y.jump_strength*1),Y.speed.y=1*Y.jump_strength):180==Ne?((0,o.q8)(Y,(0,g.v2d_new)(0,40)),Y.speed.x*=-1,Y.speed.y=1*Y.jump_strength):Ne>180&&Ne<270?((0,o.q8)(Y,(0,g.v2d_new)(0,40)),Y.speed.x=Math.max(Y.speed.x,.7*Y.jump_strength*1),Y.speed.y=1*Y.jump_strength):270==Ne?((0,o.q8)(Y,(0,g.v2d_new)(40,0)),Y.speed.x=Math.max(Y.speed.x,1*Y.jump_strength),Y.speed.y=-Y.jump_strength/2*1):Ne>270&&Ne<360&&(Ne<315?(Y.speed.x=Math.max(Y.speed.x,.7*Y.jump_strength*1),Y.speed.y=-.7*Y.jump_strength*1):(Y.speed.x*=Y.speed.x<0?.5:1,Y.speed.y=1*-Y.jump_strength))),!Y.is_jumping){var Ke;Ne>0&&Ne<90?(Ke=.8*Math.min(1,Math.tan(Ne*m.PI/180)),Math.abs(Y.speed.y)>m.EPSILON?Y.speed.x=ee&&Ne<=45?Y.speed.x:Math.max(-1.2*J,-1*Ke*Y.speed.y):(Oe=(Y.mirror&m.IF_HFLIP?2:1)*Ke,e.braking&&Ne<45?Oe*=8*(Y.speed.x<0?-.5:1):Math.abs(Y.speed.x)<5&&(Oe*=25*Math.sin(Ne*m.PI/180),e.lock_accel=2),Y.speed.x=Math.max(Y.speed.x-700*Oe*X,-1.2*J))):Ne>270&&Ne<360&&(Ke=.8*Math.min(1,-Math.tan(Ne*m.PI/180)),Math.abs(Y.speed.y)>m.EPSILON?Y.speed.x=ee&&Ne>=315?Y.speed.x:Math.min(1.2*J,1*Ke*Y.speed.y):(Oe=(Y.mirror&m.IF_HFLIP?1:2)*Ke,e.braking&&Ne>315?Oe*=8*(Y.speed.x>0?-.5:1):Math.abs(Y.speed.x)<5&&(Oe*=25*-Math.sin(Ne*m.PI/180),e.lock_accel=1),Y.speed.x=Math.min(Y.speed.x+700*Oe*X,1.2*J)))}Ne%90==0&&(e.lock_accel=0),C&&M&&Math.abs(Y.speed.x)<40&&C.brick_ref.angle>270&&C.brick_ref.angle<360&&M.brick_ref.angle>0&&M.brick_ref.angle<90&&((0,d.input_button_down)(Y.input,d.IB_LEFT)||(0,d.input_button_down)(Y.input,d.IB_RIGHT)||(Y.speed.x=0))}else e.braking=!1,e.lock_accel=0,e.spin_dash&&(e.spin_dash=!1,re=(0,l.sprite_get_animation)(z,1)),Y.animation!=(0,l.sprite_get_animation)(z,0)&&Y.animation!=(0,l.sprite_get_animation)(z,10)&&Y.animation!=(0,l.sprite_get_animation)(z,5)||(re=(0,l.sprite_get_animation)(z,1)),(e.spring||te||Y.speed.y<0)&&(e.spin=!1),ce(e)||(Y.angle=0);if(y||e.is_fire_jumping&&Y.speed.y<-Y.jump_strength*D&&(0,d.input_button_up)(Y.input,d.IB_FIRE1)&&(Y.speed.y*=.7),e.type==R&&e.flying?(Q=e.flight_timer<L?.15:.8,q*=.3):Q=1,Z.y=Math.abs(Y.speed.y)>m.EPSILON?Y.speed.y*X+a*Q*.5*(X*X):0,e.type==P&&e.flying||(Y.speed.y=Math.min(Y.speed.y+a*Q*X,q)),_=b&&b.brick_ref.angle%90!=0&&Math.abs(Y.angle)<m.EPSILON,b&&(b.brick_ref.angle%90==0||_)&&Y.speed.y<-m.EPSILON&&(Y.position.y=b.y+b.brick_ref.image.height+(ge.y-A.y),Y.speed.y=10,b.brick_ref.behavior==r.w6&&Math.sin(b.brick_ref.behavior_arg[3]*b.value[0])>0))return Y.speed.y=100,(0,g.v2d_add)(Z,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(b,Y),X));if((H=y)&&!Y.is_jumping){var Ue=H.brick_ref.angle;if(Y.speed.y=Z.y=0,Y.angle=Ue*m.PI/180,0==Ue){var Ye=(0,h.level_brick_move_actor)(y,Y);ge.y=H.y,$=0,Ye.y>m.EPSILON?Z.y+=Ye.y*X:Y.position.y=ge.y+le+1}else if(Ue>0&&Ue<90)ge.y=parseInt(H.y+H.brick_ref.image.height-(Y.position.x-H.x)*Math.tan(Y.angle),10),Y.speed.x<0&&(ge.y+=2),Y.position.y=ge.y+le,Y.mirror&m.IF_HFLIP||($=.2);else if(90==Ue){if(Math.abs(Y.speed.x)>5){var ze=M?M.brick_ref.angle:-1;M&&ze>=Ue&&ze<Ue+90?e.flying||(Y.position.x=H.x+le):(Y.angle=0,Y.is_jumping=!0,e.spin||e.flying||(re=(0,l.sprite_get_animation)(z,1)),ce(e)||(e.flying||(0,o.q8)(Y,(0,g.v2d_new)(-13,0)),Y.speed=(0,g.v2d_new)(0,-.9*Math.abs(Y.speed.x))))}else Y.angle=0,e.flying||(0,o.q8)(Y,(0,g.v2d_new)(-10,0)),Y.is_jumping=!0,Y.ignore_horizontal=!1;Y.mirror&m.IF_HFLIP||($=1.5)}else Ue>90&&Ue<180?(Math.abs(Y.speed.x)>5?(ge.y=H.y-(Y.position.x-H.x)*Math.tan(Y.angle),Y.position.y=ge.y-le):(Y.angle=0,(0,o.q8)(Y,(0,g.v2d_new)(0,30)),Y.is_jumping=!0),$=1.5):180==Ue?(Math.abs(Y.speed.x)>5?(ge.y=H.y+H.brick_ref.image.height,Y.position.y=ge.y-le,(Y.speed.x>0&&!M||Y.speed.x<0&&!C)&&((0,o.q8)(Y,(0,g.v2d_new)(0,-30)),Y.is_jumping=!0,Y.speed.x*=-1,Y.mirror=Y.speed.x<0?m.IF_HFLIP:m.IF_NONE,Y.angle=0)):(Y.angle=0,(0,o.q8)(Y,(0,g.v2d_new)(0,40)),Y.is_jumping=!0,Y.speed.x=0),$=1.2):Ue>180&&Ue<270?(Math.abs(Y.speed.x)>5?(ge.y=H.y+H.brick_ref.image.height-(Y.position.x-H.x)*Math.tan(Y.angle),Y.position.y=ge.y-le):(Y.angle=0,(0,o.q8)(Y,(0,g.v2d_new)(0,30)),Y.is_jumping=!0),$=1.5):270==Ue?(Math.abs(Y.speed.x)>5?(ze=C?C.brick_ref.angle:-1,C&&ze>Ue-90&&ze<=Ue?e.flying||(Y.position.x=H.x+H.brick_ref.image.width-le):(Y.angle=0,Y.is_jumping=!0,e.spin||e.flying||(re=(0,l.sprite_get_animation)(z,1)),ce(e)||(e.flying||(0,o.q8)(Y,(0,g.v2d_new)(13,0)),Y.speed=(0,g.v2d_new)(0,-.9*Math.abs(Y.speed.x))))):(Y.angle=0,e.flying||(0,o.q8)(Y,(0,g.v2d_new)(10,0)),Y.is_jumping=!0,Y.ignore_horizontal=!1),Y.mirror&m.IF_HFLIP&&($=1.5)):Ue>270&&Ue<360&&(ge.y=H.y-(Y.position.x-H.x)*Math.tan(Y.angle),Y.speed.x>0&&(ge.y+=2),Y.position.y=ge.y+le,Y.mirror&m.IF_HFLIP&&($=.2))}if(Z.x=Math.abs(Y.speed.x)>m.EPSILON?Y.speed.x*X+(1-$)*Y.acceleration*.5*(X*X):0,!(0,d.input_button_down)(Y.input,d.IB_LEFT)||(0,d.input_button_down)(Y.input,d.IB_RIGHT)||e.spin||e.braking||e.landing||e.getting_hit||1==e.lock_accel||ae)if(!(0,d.input_button_down)(Y.input,d.IB_RIGHT)||(0,d.input_button_down)(Y.input,d.IB_LEFT)||e.spin||e.braking||e.landing||e.getting_hit||2==e.lock_accel||ne){if(y){var Xe,qe=0,$e=y.brick_ref.angle;Xe=e.spin?.65:e.braking?4.5:e.landing?.6:1,$e%90==0?qe=90==$e?-1:270==$e?1:Y.speed.x>m.EPSILON?-1:-Y.speed.x>m.EPSILON?1:0:($e>90&&$e<180||$e>180&&$e<270)&&(qe=Y.speed.x>m.EPSILON?-1:-Y.speed.x>m.EPSILON?1:0),Y.speed.x+=qe*Xe*Y.acceleration*X}}else Y.ignore_horizontal||!(Y.is_jumping||e.spring||te)&&(0,d.input_button_down)(Y.input,d.IB_DOWN)||(Y.mirror=!1,$=Y.speed.x<0?-1:$,Y.speed.x<=1.1*J&&(Y.speed.x=Math.min(Y.speed.x+(1-$)*Y.acceleration*X,J)));else Y.ignore_horizontal||!(Y.is_jumping||e.spring||te)&&(0,d.input_button_down)(Y.input,d.IB_DOWN)||(Y.mirror=m.IF_HFLIP,$=Y.speed.x>0?-1:$,Y.speed.x>=1.1*-J&&(Y.speed.x=Math.max(Y.speed.x-(1-$)*Y.acceleration*X,-J)))}switch(e.spring&&(re=(0,l.sprite_get_animation)(z,Y.speed.y<=0?13:1),Y.speed.y>0&&(e.spring=!1,Y.is_jumping=!1)),e.getting_hit&&(y?e.getting_hit=!1:re=(0,l.sprite_get_animation)(z,11)),e.type){case T:break;case R:if(e.flight_timer+=X,y&&90!=y.brick_ref.angle&&270!=y.brick_ref.angle&&(e.flying=!1,e.flight_timer=0),(Y.is_jumping&&Y.speed.y>-Y.jump_strength/3&&!ie&&!e.getting_hit||e.flying)&&(0,d.input_button_pressed)(Y.input,d.IB_FIRE1)&&!e.getting_hit&&e.flight_timer<L&&(e.flying||(e.flight_timer=0),Y.speed.y=.1*-(0,h.level_gravity)(),e.flying=!0,Y.is_jumping=!1,e.is_fire_jumping=!1),e.flying)if(re=(0,l.sprite_get_animation)(z,Y.carrying?16:20),Y.speed.x=(0,v.clip)(Y.speed.x,-Y.maxspeed/2,Y.maxspeed/2),e.flight_timer>=L){var Qe=(0,c.soundfactory_get)("tired of flying");(0,s.sound_is_playing)(Qe)||(0,s.sound_play)(Qe),re=(0,l.sprite_get_animation)(z,19)}else{var Je,Ze;for(ce(e)&&(Y.angle=0),Je=(0,c.soundfactory_get)("flying"),(0,s.sound_is_playing)(Je)||(0,s.sound_play)(Je),Ze=0;Ze<t.length&&null==Y.carrying;Ze++)if(t[Ze]!=e&&parseInt(Y.speed.y,10)<=0){var et=[t[Ze].actor.position.x+.3*(0,o.Ix)(t[Ze].actor).width,t[Ze].actor.position.y,t[Ze].actor.position.x+.7*(0,o.Ix)(t[Ze].actor).width,t[Ze].actor.position.y+.2*(0,o.Ix)(t[Ze].actor).height],tt=[Y.position.x+.3*(0,o.Ix)(Y).width,Y.position.y+.7*(0,o.Ix)(Y).height,Y.position.x+.7*(0,o.Ix)(Y).width,Y.position.y+(0,o.Ix)(Y).height],nt=(0,v.bounding_box)(et,tt),at=!(null!=t[Ze].actor.carried_by||t[Ze].dying||t[Ze].dead||t[Ze].climbing||t[Ze].landing||t[Ze].getting_hit);nt&&at&&!y&&(Y.carrying=t[Ze].actor,t[Ze].actor.carried_by=Y,t[Ze].spin=t[Ze].spin_dash=t[Ze].braking=t[Ze].flying=t[Ze].spring=t[Ze].on_moveable_platform=!1,(0,s.sound_play)((0,c.soundfactory_get)("touch the wall")))}}else Y.animation==(0,l.sprite_get_animation)(z,Y.carrying?16:20)&&(re=(0,l.sprite_get_animation)(z,1));break;case P:if((Y.is_jumping&&Y.speed.y>-.7*Y.jump_strength||e.flying)&&(0,d.input_button_pressed)(Y.input,d.IB_FIRE1)&&!y&&!e.getting_hit&&(Y.speed.y=50,e.flying=!0,Y.is_jumping=!1,e.is_fire_jumping=!1,Y.speed.x=Y.mirror&m.IF_HFLIP?Math.min(-100,Y.speed.x):Math.max(100,Y.speed.x)),e.flying){var it=(0,d.input_button_down)(Y.input,d.IB_LEFT)&&Y.speed.x>0||(0,d.input_button_down)(Y.input,d.IB_RIGHT)&&Y.speed.x<0,ot=y&&Math.abs(y.brick_ref.angle*m.PI/180-0)<m.EPSILON;if(it+=Y.animation==(0,l.sprite_get_animation)(z,21)&&!(0,o.$C)(Y),ot||Y.animation==(0,l.sprite_get_animation)(z,19)||e.landing||(Y.mirror&m.IF_HFLIP?(re=(0,l.sprite_get_animation)(z,it?21:20),Y.speed.x=Math.max(Y.speed.x-.5*Y.acceleration*X,-J/2)):(re=(0,l.sprite_get_animation)(z,it?21:20),Y.speed.x=Math.min(Y.speed.x+.5*Y.acceleration*X,J/2))),ot)e.landing=!0,Y.is_jumping=!1,re=(0,l.sprite_get_animation)(z,19),Y.speed.y=0,Z.y=0,e.climbing=!1;else if((0,d.input_button_up)(Y.input,d.IB_FIRE1))e.flying=!1,re=(0,l.sprite_get_animation)(z,18);else{var rt,_t=[k,C,E,M,y];for(rt=0;rt<_t.length;rt++)(H=_t[rt])&&H.brick_ref.angle%90!=0&&(e.flying=!1,e.landing=!1)}ot||b||(k&&k.brick_ref.angle%90==0||E&&E.brick_ref.angle%90==0)&&(e.climbing=!0,e.flying=!1,(0,s.sound_play)((0,c.soundfactory_get)("touch the ground")))}if(e.landing&&(Math.abs(Y.speed.x)<m.EPSILON||!y)&&(e.flying=e.landing=!1),e.climbing){var st=(0,g.v2d_new)(0,0);if(Y.speed.x=Z.x=0,k&&!E&&(Y.mirror|=m.IF_HFLIP),E&&!k&&(Y.mirror&=~m.IF_HFLIP),st=(0,g.v2d_add)(st,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(k,Y),X)),((st=(0,g.v2d_add)(st,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(E,Y),X))).y<=0&&!b||st.y>=0&&!y||!k&&E)&&(Z=(0,g.v2d_add)(Z,st)),k||E)if((0,d.input_button_pressed)(Y.input,d.IB_FIRE1)){var ct=(0,l.sprite_get_animation)(z,17),dt=(0,l.sprite_get_animation)(z,22);Y.animation!=ct&&Y.animation!=dt||(e.climbing=!1,Y.is_jumping=!0,e.is_fire_jumping=!0,Y.speed.x=.7*(Y.mirror&m.IF_HFLIP?1:-1)*Y.jump_strength,Y.speed.y=-.5*Y.jump_strength,k&&!E&&(Y.mirror&=~m.IF_HFLIP),!k&&E&&(Y.mirror|=m.IF_HFLIP),re=(0,l.sprite_get_animation)(z,3),(0,s.sound_play)((0,c.soundfactory_get)("jump")))}else(0,d.input_button_down)(Y.input,d.IB_UP)?b||(Z.y=.1*-J*X,re=(0,l.sprite_get_animation)(z,17)):(0,d.input_button_down)(Y.input,d.IB_DOWN)?y?e.climbing=!1:(Z.y=.1*J*X,re=(0,l.sprite_get_animation)(z,17)):re=(0,l.sprite_get_animation)(z,22);else(H=Y.mirror&m.IF_HFLIP?C:M)?(re=(0,l.sprite_get_animation)(z,23),Y.ignore_horizontal=!0,Z=(0,g.v2d_add)(Z,(0,g.v2d_multiply)((0,h.level_brick_move_actor)(H,Y),X)),(0,o.$C)(Y)&&(e.climbing=!1,Y.ignore_horizontal=!1,Y.speed=(0,g.v2d_new)((Y.mirror&m.IF_HFLIP?-1:1)*J*.15,-(0,h.level_gravity)()/12.5),Z.x=5*(Y.mirror&m.IF_HFLIP?-1:1))):(e.climbing=!1,Y.is_jumping=!0,re=(0,l.sprite_get_animation)(z,3))}}return e.at_some_border=!1,re&&(Y=(0,o.TK)(Y,re)),Math.abs(Y.speed.x)<4&&(e.braking=!1,(!(0,d.input_button_down)(Y.input,d.IB_RIGHT)&&!(0,d.input_button_down)(Y.input,d.IB_LEFT)||(0,d.input_button_down)(Y.input,d.IB_RIGHT)&&(0,d.input_button_down)(Y.input,d.IB_LEFT)||e.spin||e.landing)&&(Z.x=0,Y.speed.x=0)),Z.x+=(0,h.level_brick_move_actor)(y,Y).x*X,Z.x=Y.position.x<=Y.hot_spot.x&&Y.speed.x<0?0:Z.x,Z.x=Y.position.x>=(0,h.level_size)().x-((0,o.Ix)(Y).width-Y.hot_spot.x)&&Y.speed.x>0?0:Z.x,Z},X=function(e){var t,n,i=e.actor,r=!1;if(!e.blinking&&!e.dying&&!e.invincible)if(_e(e),e.shield_type!=M)r=!0,e.shield_type=M,(0,s.sound_play)((0,c.soundfactory_get)("death"));else if(a>0){for(r=!0,n=0;n<Math.min(J(),15);n++)(t=(0,h.level_create_item)(_.vJ,i.position)).is_moving=!0,t.actor.speed.x=t.actor.maxspeed*((0,v.random)(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+(0,v.random)(t.actor.jump_strength);ne(0),(0,s.sound_play)((0,c.soundfactory_get)("ringless"))}else q(e);r&&(e.getting_hit=!0,e.flying=e.landing=e.climbing=e.spring=!1,e.is_fire_jumping=!1,e.spin_dash=e.spin=!1,e.blinking=!0,e.blink_timer=0,i.speed.x=i.mirror&m.IF_HFLIP?200:-200,i.speed.y=-.75*i.jump_strength,(0,o.q8)(i,(0,g.v2d_new)(0,-5)))},q=function(e){e.dying||(_e(e),e.shield_type=M,e.invincible=!1,e.got_speedshoes=!1,e.dying=!0,e.death_timer=0,e.spring=!1,e.actor.speed.y=1.2*-e.actor.jump_strength,e.flying=e.climbing=e.landing=!1,e.is_fire_jumping=!1,e.spin=e.spin_dash=!1,e.blinking=!1,(0,s.sound_play)((0,c.soundfactory_get)("death")))},$=function(e){(0,d.input_simulate_button_down)(e.actor.input,d.IB_FIRE1),e.spring=!1,e.actor.speed.y=-e.actor.jump_strength,e.actor.is_jumping=!0,e.is_fire_jumping=!1,e.flying=!1},Q=function(e){var t=(0,l.sprite_get_animation)(oe(e.type),3);return e.spin||e.spin_dash||e.actor.animation==t||e.type==P&&(e.landing||e.flying)},J=function(){return a},Z=function(){return B},ee=function(){return W},te=function(e){return oe(e.type)},ne=function(e){a=(0,v.clip)(e,0,9999),e/100>=i&&(i+=1,ae(Z()+1),(0,h.level_override_music)((0,c.soundfactory_get)("1up")))},ae=function(e){B=e},ie=function(e){W=e},oe=function(e){switch(e){case T:return"SD_SONIC";case R:return"SD_TAILS";case P:return"SD_KNUCKLES";default:return"null"}},re=function(e){if(e&&e.actor){var t=0,n=e.actor.mirror&m.IF_HFLIP,a=!0,i=(0,v.old_school_angle)(e.actor.angle),r=(0,g.v2d_new)(0,0),_=(0,g.v2d_subtract)(e.actor.position,(0,g.v2d_rotate)((0,g.v2d_new)(0,e.actor.hot_spot.y),-i)),s=e.actor.animation;switch(e.type){case T:if(s==(0,l.sprite_get_animation)(oe(T),0))r=(0,g.v2d_new)(3,24),t=1;else if(s==(0,l.sprite_get_animation)(oe(T),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=2,r=(0,g.v2d_new)(5,23);break;case 1:t=2,r=(0,g.v2d_new)(4,25);break;case 2:t=1,r=(0,g.v2d_new)(7,25);break;case 3:case 4:t=1,r=(0,g.v2d_new)(5,23);break;case 5:t=1,r=(0,g.v2d_new)(4,24);break;case 6:t=2,r=(0,g.v2d_new)(6,24);break;case 7:t=2,r=(0,g.v2d_new)(6,23)}else if(s==(0,l.sprite_get_animation)(oe(T),2))t=1,r=(0,g.v2d_new)(8,26);else if(s==(0,l.sprite_get_animation)(oe(T),5))t=3,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,19):(0,g.v2d_new)(-1,21);else if(s==(0,l.sprite_get_animation)(oe(T),7))t=1,r=parseInt(e.actor.animation_frame,10)<2?(0,g.v2d_new)(8,26):(0,g.v2d_new)(10,28);else if(s==(0,l.sprite_get_animation)(oe(T),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(1,22);break;case 1:r=(0,g.v2d_new)(-1,23);break;case 2:r=(0,g.v2d_new)(1,23)}else s==(0,l.sprite_get_animation)(oe(T),11)?(t=3,r=(0,g.v2d_new)(-4,30)):s==(0,l.sprite_get_animation)(oe(T),12)?(t=3,r=(0,g.v2d_new)(1,19)):s==(0,l.sprite_get_animation)(oe(T),13)?(t=3,r=(0,g.v2d_new)(4,13)):s==(0,l.sprite_get_animation)(oe(T),14)?(t=1,r=(0,g.v2d_new)(12,31)):s==(0,l.sprite_get_animation)(oe(T),15)?(t=0,r=(0,g.v2d_new)(3,23)):s==(0,l.sprite_get_animation)(oe(T),25)?(t=0,r=(0,g.v2d_new)(3,22)):a=!1;break;case R:if(s==(0,l.sprite_get_animation)(oe(R),0))r=(0,g.v2d_new)(5,34),t=1;else if(s==(0,l.sprite_get_animation)(oe(R),1))switch(t=2,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(2,33);break;case 1:case 5:r=(0,g.v2d_new)(3,33);break;case 2:r=(0,g.v2d_new)(8,33);break;case 3:case 7:r=(0,g.v2d_new)(3,32);break;case 4:r=(0,g.v2d_new)(1,33);break;case 6:r=(0,g.v2d_new)(7,33)}else if(s==(0,l.sprite_get_animation)(oe(R),2))t=2,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(7,35):(0,g.v2d_new)(6,34);else if(s==(0,l.sprite_get_animation)(oe(R),4))t=1,r=(0,g.v2d_new)(9,44);else if(s==(0,l.sprite_get_animation)(oe(R),5))t=1,r=(0,g.v2d_new)(7,32);else if(s==(0,l.sprite_get_animation)(oe(R),7))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(2,33):(0,g.v2d_new)(4,33);else if(s==(0,l.sprite_get_animation)(oe(R),10))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(5,33);break;case 1:r=(0,g.v2d_new)(6,33)}else if(s==(0,l.sprite_get_animation)(oe(R),11))t=1,r=(0,g.v2d_new)(1,33);else if(s==(0,l.sprite_get_animation)(oe(R),12))t=1,r=(0,g.v2d_new)(6,28);else if(s==(0,l.sprite_get_animation)(oe(R),13))t=3,r=(0,g.v2d_new)(2,17);else if(s==(0,l.sprite_get_animation)(oe(R),14))t=1,r=(0,g.v2d_new)(9,35);else if(s==(0,l.sprite_get_animation)(oe(R),15))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:case 8:case 9:case 10:r=(0,g.v2d_new)(5,34);break;default:r=(0,g.v2d_new)(5,33)}else s==(0,l.sprite_get_animation)(oe(R),16)?(t=1,r=(0,g.v2d_new)(8,37)):s==(0,l.sprite_get_animation)(oe(R),19)?(t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(9,39):(0,g.v2d_new)(9,40)):s==(0,l.sprite_get_animation)(oe(R),20)?(t=1,r=(0,g.v2d_new)(8,39)):s==(0,l.sprite_get_animation)(oe(R),25)?(t=1,r=(0,g.v2d_new)(0,23)):a=!1;break;case P:if(s==(0,l.sprite_get_animation)(oe(P),0))t=1,r=(0,g.v2d_new)(1,24);else if(s==(0,l.sprite_get_animation)(oe(P),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,r=(0,g.v2d_new)(5,29);break;case 1:t=2,r=(0,g.v2d_new)(5,29);break;case 2:t=2,r=(0,g.v2d_new)(8,29);break;case 3:t=2,r=(0,g.v2d_new)(9,28);break;case 4:t=1,r=(0,g.v2d_new)(6,28);break;case 5:t=1,r=(0,g.v2d_new)(6,29);break;case 6:t=1,r=(0,g.v2d_new)(5,28);break;case 7:t=1,r=(0,g.v2d_new)(4,27)}else if(s==(0,l.sprite_get_animation)(oe(P),2))t=1,r=(0,g.v2d_new)(7,29);else if(s==(0,l.sprite_get_animation)(oe(P),4))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,31):(0,g.v2d_new)(0,40);else if(s==(0,l.sprite_get_animation)(oe(P),5))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(0,21):(0,g.v2d_new)(-1,21);else if(s==(0,l.sprite_get_animation)(oe(P),7))t=0,r=(0,g.v2d_new)(-2,27);else if(s==(0,l.sprite_get_animation)(oe(P),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(9,30);break;case 1:r=(0,g.v2d_new)(8,27)}else if(s==(0,l.sprite_get_animation)(oe(P),11))t=1,r=(0,g.v2d_new)(-3,27);else if(s==(0,l.sprite_get_animation)(oe(P),12))t=1,r=(0,g.v2d_new)(5,24);else if(s==(0,l.sprite_get_animation)(oe(P),13))t=3,r=(0,g.v2d_new)(-1,16);else if(s==(0,l.sprite_get_animation)(oe(P),14))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,r=(0,g.v2d_new)(5,29);break;case 1:t=2,r=(0,g.v2d_new)(5,29);break;case 2:t=2,r=(0,g.v2d_new)(8,29);break;case 3:t=2,r=(0,g.v2d_new)(9,28);break;case 4:t=1,r=(0,g.v2d_new)(6,28);break;case 5:t=1,r=(0,g.v2d_new)(6,29);break;case 6:t=1,r=(0,g.v2d_new)(5,28);break;case 7:t=1,r=(0,g.v2d_new)(4,27)}else if(s==(0,l.sprite_get_animation)(oe(P),15))t=0,r=(0,g.v2d_new)(1,23);else if(s==(0,l.sprite_get_animation)(oe(P),16))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(6,23);break;case 1:r=(0,g.v2d_new)(5,20);break;case 2:r=(0,g.v2d_new)(0,22)}else if(s==(0,l.sprite_get_animation)(oe(P),17))switch(t=3,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(-1,22);break;case 1:r=(0,g.v2d_new)(-2,20);break;case 2:r=(0,g.v2d_new)(0,21);break;case 3:r=(0,g.v2d_new)(-1,24);break;case 4:r=(0,g.v2d_new)(0,23);break;case 5:r=(0,g.v2d_new)(0,22)}else if(s==(0,l.sprite_get_animation)(oe(P),18))t=1,r=0==parseInt(e.actor.animation_frame,10)?(0,g.v2d_new)(6,23):(0,g.v2d_new)(5,20);else if(s==(0,l.sprite_get_animation)(oe(P),19))t=1,r=(0,g.v2d_new)(8,44);else if(s==(0,l.sprite_get_animation)(oe(P),20))t=1,r=(0,g.v2d_new)(8,39);else if(s==(0,l.sprite_get_animation)(oe(P),21))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:r=(0,g.v2d_new)(-8,41);break;case 1:r=(0,g.v2d_new)(0,43);break;case 2:r=(0,g.v2d_new)(10,41)}else if(s==(0,l.sprite_get_animation)(oe(P),22))t=3,r=(0,g.v2d_new)(0,22);else if(s==(0,l.sprite_get_animation)(oe(P),23))switch(parseInt(e.actor.animation_frame,10)){case 0:t=3,r=(0,g.v2d_new)(7,17);break;case 1:t=3,r=(0,g.v2d_new)(11,15);break;case 2:t=0,r=(0,g.v2d_new)(12,13)}else s==(0,l.sprite_get_animation)(oe(P),25)?(t=0,r=(0,g.v2d_new)(0,23)):a=!1}return r.x*=n?-1:1,e.glasses=(0,o.TK)(e.glasses,(0,l.sprite_get_animation)("SD_GLASSES",t)),e.glasses.position=(0,g.v2d_add)(_,(0,g.v2d_rotate)(r,-i)),e.glasses.angle=i,e.glasses.mirror=e.actor.mirror,e.glasses.visible=a&&e.actor.visible,e}},_e=function(e){},se=function(e){var t=e.shield,n=e.actor,a=(0,g.v2d_new)(0,0);switch(e.shield_type){case C:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_SHIELD",0));break;case j:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_FIRESHIELD",0));break;case H:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_THUNDERSHIELD",0));break;case A:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_WATERSHIELD",0));break;case F:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_ACIDSHIELD",0));break;case V:a=(0,g.v2d_new)(0,-22),t.position=(0,g.v2d_add)(n.position,(0,g.v2d_rotate)(a,-(0,v.old_school_angle)(n.angle))),t=(0,o.TK)(t,(0,l.sprite_get_animation)("SD_WINDSHIELD",0))}},ce=function(e){return e.disable_wall!==E}},458:(e,t,n)=>{n.r(t),n.d(t,{confirmbox_alert:()=>D,confirmbox_init:()=>k,confirmbox_release:()=>L,confirmbox_render:()=>N,confirmbox_selected_option:()=>T,confirmbox_update:()=>O});var a,i,o,r,_,s,c,d,l,p=n(878),u=n(163),f=n(642),g=n(709),m=n(880),v=n(689),h=n(931),b=n(667),y=n(470),E=n(120),x=n(176),I=[],w=[],S=-1,k=function(){var e;for(a=(0,m.sprite_get_image)((0,m.sprite_get_animation)("SD_CONFIRMBOX",0),0),i=(0,p.v2d_new)((f.VIDEO_SCREEN_W-a.width)/2,f.VIDEO_SCREEN_H),l=(0,v.input_create_user)(),r=(0,E.HN)(),r=(0,E.TK)(r,(0,m.sprite_get_animation)("SD_TITLEFOOT",0)),o=(0,x.font_create)(8),(0,x.font_set_text)(o,_),(0,x.font_set_width)(o,164),e=0;e<s;e++)I[e]=[],I[e][0]=(0,x.font_create)(8),I[e][1]=(0,x.font_create)(8),(0,x.font_set_text)(I[e][0],w[e]),(0,x.font_set_text)(I[e][1],"<color=ffff00>%s</color>",w[e]);S=0,c=!0,d=!1},O=function(){var e,t=(0,u.timer_get_delta)(),n=5*f.VIDEO_SCREEN_H;if(c&&(i.y<=(f.VIDEO_SCREEN_H-a.height)/2?c=!1:i.y-=n*t),d){if(i.y>=f.VIDEO_SCREEN_H)return d=!1,void(0,b.scenestack_pop)();i.y+=n*t}for(r.position=(0,p.v2d_new)(i.x+S*a.width/s+10,i.y+.75*a.height-1),o.position=(0,p.v2d_new)(i.x+10,i.y+10),e=0;e<s;e++)I[e][0].position=(0,p.v2d_new)(i.x+e*a.width/s+25,i.y+.75*a.height),I[e][1].position=I[e][0].position;c||d||((0,v.input_button_pressed)(l,v.IB_LEFT)?((0,h.sound_play)((0,y.soundfactory_get)("choose")),S=((S-1)%s+s)%s):(0,v.input_button_pressed)(l,v.IB_RIGHT)?((0,h.sound_play)((0,y.soundfactory_get)("choose")),S=(S+1)%s):((0,v.input_button_pressed)(l,v.IB_FIRE1)||(0,v.input_button_pressed)(l,v.IB_FIRE3))&&((0,h.sound_play)((0,y.soundfactory_get)("select")),d=!0))},N=function(){var e,t,n=(0,p.v2d_new)(f.VIDEO_SCREEN_W/2,f.VIDEO_SCREEN_H/2);for((0,f.video_clearDisplay)(),(0,f.video_get_backbuffer)().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,i.x,i.y,a.swidth,a.sheight),(0,x.font_render)(o,n),e=0;e<s;e++)t=e==S?1:0,(0,x.font_render)(I[e][t],n);(0,E.z7)(r,n)},L=function(){(0,E.HI)(r),(0,v.input_destroy)(l),(0,x.font_destroy)(o),(0,g.image_destroy)(void 0)},D=function(e,t,n){S=-1,_=e,w[0]=t,n?(w[1]=n,s=2):s=1},T=function(){if(-1!=S){var e=S+1;return S=-1,e}return 0}},491:(e,t,n)=>{n.r(t),n.d(t,{credits_init:()=>w,credits_release:()=>O,credits_render:()=>k,credits_update:()=>S});var a,i,o,r,_,s,c,d,l=n(878),p=n(386),u=n(642),f=n(931),g=n(38),m=n(689),v=n(709),h=n(163),b=n(667),y=n(470),E=n(176),x=n(51),I=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],w=function(){i=!1,s=(0,m.input_create_user)(),o=(0,E.font_create)(4),console.log(o),(0,E.font_set_text)(o,(0,g.lang_get)("CREDITS_TITLE")),o.position.x=u.VIDEO_SCREEN_W/2-100,o.position.y=5,_=(0,E.font_create)(8),(0,E.font_set_text)(_,(0,g.lang_get)("CREDITS_KEY")),_.position.x=10,_.position.y=u.VIDEO_SCREEN_H-(0,E.font_get_charsize)(_).y-5,r=(0,E.font_create)(8);for(var e=0;e<I.length;e++){var t=I[e],n=t.match(/\$[A-Z_\d]\w+/m);if(n){for(var l=0;l<n.length;l++){var p=n[l].slice(1),f=(0,g.lang_get)(p);f&&(t=t.replace("$"+p,f))}I[e]=t}}I=I.join(""),(0,E.font_set_text)(r,I,"%s"),(0,E.font_set_width)(r,300),r.position.x=10,r.position.y=u.VIDEO_SCREEN_H,c=1;for(var h=(0,E.font_get_text)(r),b=0;b<h.length;b++)"\n"==h[b]&&c++;c+=10,a=(0,v.image_create)(u.VIDEO_SCREEN_W,30),d=(0,x.vm)("data/themes/credits.bg.json").then((function(e){d=e,console.log(d),(0,u.video_fadefx_in)((0,v.image_rgb)(0,0,0),1)})),(0,u.video_fadefx_in)((0,v.image_rgb)(0,0,0),1)},S=function(){var e=(0,h.timer_get_delta)();if((0,x.A4)(d),r.position.y-=3*(0,E.font_get_charsize)(r).y*e,r.position.y<-c*((0,E.font_get_charsize)(r).y+(0,E.font_get_charspacing)(r).y)&&(r.position.y=u.VIDEO_SCREEN_H),i||(0,u.video_fadefx_is_fading)()||((0,m.input_button_pressed)(s,m.IB_FIRE3)?((0,f.sound_play)((0,y.soundfactory_get)("select")),i=!0):(0,m.input_button_pressed)(s,m.IB_FIRE4)&&((0,f.sound_play)((0,y.soundfactory_get)("return")),i=!0)),!(0,f.music_is_playing)()){var t=music_load("data/music/options.mp4");(0,f.music_play)(t,p.INFINITY)}if(i){if((0,u.video_fadefx_over)())return void(0,b.scenestack_pop)();(0,u.video_fadefx_out)((0,v.image_rgb)(0,0,0),1)}},k=function(){(0,u.video_clearDisplay)();var e=(0,l.v2d_new)(u.VIDEO_SCREEN_W/2,u.VIDEO_SCREEN_H/2);(0,x.mw)(d,e),(0,x.Ed)(d,e),(0,E.font_render)(r,e),(0,u.video_get_backbuffer)().fillRect(0,0,a.width,a.height),(0,u.video_get_backbuffer)().fillRect(0,u.VIDEO_SCREEN_H-20,a.width,a.height),(0,E.font_render)(o,e),(0,E.font_render)(_,e)},O=function(){d=(0,x.pW)(d),(0,v.image_destroy)(a),(0,E.font_destroy)(o),(0,E.font_destroy)(r),(0,E.font_destroy)(_),(0,m.input_destroy)(s)}},497:(e,t,n)=>{n.r(t),n.d(t,{endofdemo_init:()=>b,endofdemo_release:()=>x,endofdemo_render:()=>E,endofdemo_update:()=>y});var a,i,o,r=n(386),_=n(878),s=n(642),c=n(709),d=n(880),l=n(38),p=n(163),u=n(667),f=n(532),g=n(176),m=n(120),v=10,h=[],b=function(){var e;for(a=(0,p.timer_get_ticks)(),(i=(0,g.font_create)(8)).position=(0,_.v2d_new)(5,35),o=(0,g.font_create)(4),(0,g.font_set_text)(o,(0,l.lang_get)("ENDOFDEMO_TITLE")),o.position=(0,_.v2d_new)((s.VIDEO_SCREEN_W-parseInt((0,g.font_get_charsize)(o).x,10)*(0,g.font_get_text)(o)).length/2,5),e=0;e<v;e++)h[e]=(0,m.HN)(),h[e].spawn_point=h[e].position=(0,_.v2d_new)(s.VIDEO_SCREEN_W*e/v+15,215),(0,m.TK)(h[e],(0,d.sprite_get_animation)(e%2==1?"SD_BLUERING":"SD_RING",0));(0,s.video_fadefx_in)((0,c.image_rgb)(0,0,0),2)},y=function(){var e,t=(0,p.timer_get_ticks)(),n=Math.max(0,(3-parseInt(t-a,10))/1e3);if((0,g.font_set_text)(i,(0,l.lang_get)("ENDOFDEMO_TEXT"),r.GAME_TITLE,r.GAME_WEBSITE,n),t>=a+3){if((0,s.video_fadefx_over)())return(0,u.scenestack_pop)(),void(0,u.scenestack_push)((0,f.storyboard_get_scene)(f.SCENE_QUESTOVER));(0,s.video_fadefx_out)((0,c.image_rgb)(0,0,0),2)}for(e=0;e<v;e++)h[e].position.y=h[e].spawn_point.y+10*Math.sin(r.PI*(.001*t)+2*r.PI/v*e)},E=function(){var e,t=(0,_.v2d_new)(s.VIDEO_SCREEN_W/2,s.VIDEO_SCREEN_H/2);for((0,s.video_clearDisplay)(),e=0;e<v;e++)(0,m.z7)(h[e],t);(0,g.font_render)(o,t),(0,g.font_render)(i,t)},x=function(){var e;for(e=0;e<v;e++)(0,m.HI)(h[e]);(0,g.font_destroy)(o),(0,g.font_destroy)(i)}},493:(e,t,n)=>{n.r(t),n.d(t,{gameover_init:()=>p,gameover_release:()=>g,gameover_render:()=>f,gameover_update:()=>u});var a,i=n(878),o=n(667),r=n(709),_=n(642),s=n(163),c=n(943),d=n(176),l=[],p=function(){a=0,l[0]=(0,d.font_create)(7),l[0].position=(0,i.v2d_new)(-50,112),(0,d.font_set_text)(l[0],"GAME"),l[1]=(0,d.font_create)(7),l[1].position=(0,i.v2d_new)(298,112),(0,d.font_set_text)(l[1],"OVER")},u=function(){var e=(0,s.timer_get_delta)();if((a+=e)>5){if((0,_.video_fadefx_over)())return(0,c.quest_abort)(),void(0,o.scenestack_pop)();(0,_.video_fadefx_out)((0,r.image_rgb)(0,0,0),2)}l[0].position.x+=200*e,l[0].position.x>80&&(l[0].position.x=80),l[1].position.x-=200*e,l[1].position.x<168&&(l[1].position.x=168)},f=function(){(0,_.video_clearDisplay)();var e=(0,i.v2d_new)(_.VIDEO_SCREEN_W/2,_.VIDEO_SCREEN_H/2);(0,d.font_render)(l[0],e),(0,d.font_render)(l[1],e)},g=function(){(0,r.image_destroy)(void 0),(0,d.font_destroy)(l[1]),(0,d.font_destroy)(l[0]),(0,c.quest_abort)()}},550:(e,t,n)=>{n.r(t),n.d(t,{intro_init:()=>p,intro_release:()=>g,intro_render:()=>f,intro_update:()=>u});var a,i,o=n(878),r=n(163),_=n(667),s=n(532),c=n(642),d=n(709),l=n(51),p=function(){a=0,(0,l.vm)("data/themes/intro.bg.json").then((function(e){i=e,(0,c.video_fadefx_in)((0,d.image_rgb)(0,0,0),1)}))},u=function(){if(i&&(a+=(0,r.timer_get_delta)(),(0,l.A4)(i),a>=3)){if((0,c.video_fadefx_over)())return(0,_.scenestack_pop)(),void(0,_.scenestack_push)((0,s.storyboard_get_scene)(s.SCENE_MENU));(0,c.video_fadefx_out)((0,d.image_rgb)(0,0,0),1)}},f=function(){if(i){var e=(0,o.v2d_new)(c.VIDEO_SCREEN_W/2,c.VIDEO_SCREEN_H/2);(0,l.mw)(i,e),(0,l.Ed)(i,e)}},g=function(){i=null}},609:(e,t,n)=>{n.r(t),n.d(t,{langselect_init:()=>M,langselect_release:()=>H,langselect_render:()=>j,langselect_update:()=>C});var a,i,o,r,_,s,c,d,l,p,u=n(386),f=n(878),g=n(667),m=n(286),v=n(898),h=n(642),b=n(709),y=n(880),E=n(931),x=n(38),I=n(689),w=n(163),S=n(450),k=n(470),O=n(176),N=n(120),L=n(51),D=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],T=1,R=[],P=[],M=function(){s=0,i=!1,l=0,d=(0,I.input_create_user)(),r=(0,O.font_create)(8),R[0]=(0,O.font_create)(4),(0,O.font_set_text)(R[0],"SELECT YOUR"),R[0].position.x=(h.VIDEO_SCREEN_W-(0,O.font_get_text)(R[0]).length*(0,O.font_get_charsize)(R[0]).x)/2-140,R[0].position.y=10,R[1]=(0,O.font_create)(4),(0,O.font_set_text)(R[1],"LANGUAGE"),R[1].position.x=(h.VIDEO_SCREEN_W-(0,O.font_get_text)(R[1]).length*(0,O.font_get_charsize)(R[1]).x)/2-120,R[1].position.y=R[0].position.y+(0,O.font_get_charsize)(R[1]).y+10+10,R[2]=(0,O.font_create)(8),(0,O.font_set_text)(R[2],(0,x.lang_get)("MENU_CQ_BACK")),R[2].position.x=10,R[2].position.y=h.VIDEO_SCREEN_H-1.5*(0,O.font_get_charsize)(R[2]).y,p=(0,L.vm)("data/themes/langselect.bg.json").then((function(e){p=e,(0,h.video_fadefx_in)((0,b.image_rgb)(0,0,0),1)})),c=(0,N.HN)(),(0,N.TK)(c,(0,y.sprite_get_animation)("SD_TITLEFOOT",0)),F(),(0,h.video_fadefx_in)((0,b.image_rgb)(0,0,0),1)},C=function(){var e=(0,w.timer_get_delta)();if(l+=e,(0,L.A4)(p),c&&P.length&&(c.position=(0,f.v2d_new)(P[0][s].position.x,P[0][s].position.y),c.position.x-=15,c.position.x+=5*Math.cos(2*u.PI*l)),!i&&!(0,h.video_fadefx_is_fading)()){if((0,I.input_button_pressed)(d,I.IB_DOWN)&&(s=(s+1)%o,(0,E.sound_play)((0,k.soundfactory_get)("choose"))),(0,I.input_button_pressed)(d,I.IB_UP)&&(s=((s-1)%o+o)%o,(0,E.sound_play)((0,k.soundfactory_get)("choose"))),(0,I.input_button_pressed)(d,I.IB_FIRE1)||(0,I.input_button_pressed)(d,I.IB_FIRE3)){if(!_)return;var t=_[s].filepath;(0,v.logfile_message)('Loading language "%s", "%s"',_[s].title,t),(0,x.lang_loadfile)("data/languages/english.json"),(0,x.lang_loadfile)(t),A(t),(0,E.sound_play)((0,k.soundfactory_get)("select"))}(0,I.input_button_pressed)(d,I.IB_FIRE4)&&((0,E.sound_play)((0,k.soundfactory_get)("return")),i=!0)}if(a=Math.floor(1+s/8),T=Math.floor(1+Math.max(0,o-1)/8),(0,O.font_set_text)(r,"page %d/%d",a,T),r.position.x=h.VIDEO_SCREEN_W-(0,O.font_get_text)(r).length*(0,O.font_get_charsize)(r).x-10,r.position.y=h.VIDEO_SCREEN_H-(0,O.font_get_charsize)(r).y-3,!(0,E.music_is_playing)()){var n=(0,E.music_load)("data/music/options.mp4");(0,E.music_play)(n,u.INFINITY)}if(i){if((0,h.video_fadefx_over)())return void(0,g.scenestack_pop)();(0,h.video_fadefx_out)((0,b.image_rgb)(0,0,0),1)}},j=function(){var e,t=(0,f.v2d_new)(h.VIDEO_SCREEN_W/2,h.VIDEO_SCREEN_H/2);for((0,h.video_clearDisplay)(),(0,L.mw)(p,t),(0,L.Ed)(p,t),(0,O.font_render)(R[0],t),(0,O.font_render)(R[1],t),(0,O.font_render)(R[2],t),T>1&&(0,O.font_render)(r,t),e=8*(a-1);e<8*a;e++)D[e]&&P.length>1&&(0,O.font_render)(P[s==e?1:0][e],t);(0,N.z7)(c,t)},H=function(){V(),p=(0,L.pW)(p),(0,N.HI)(c),(0,O.font_destroy)(R[0]),(0,O.font_destroy)(R[1]),(0,O.font_destroy)(r),(0,I.input_destroy)(d)},A=function(e){(0,m.preferences_set_language)(e)},F=function(){(0,v.logfile_message)("load_lang_list()"),(0,S.resourcemanager_getJsonFiles)(D).then((function(e){o=(_=e).length,P[0]=[],P[1]=[];for(var t=0;t<o;t++)_[t].filepath=D[t],P[0][t]=(0,O.font_create)(8),P[1][t]=(0,O.font_create)(8),(0,O.font_set_text)(P[0][t],_[t].LANG_LANGUAGE),(0,O.font_set_text)(P[1][t],_[t].LANG_LANGUAGE),P[0][t].position=(0,f.v2d_new)(25,75+t%8*20),P[1][t].position=(0,f.v2d_new)(25,75+t%8*20)}))},V=function(){var e;for((0,v.logfile_message)("unload_lang_list()"),e=0;e<o;e++)(0,O.font_destroy)(P[0][e]),(0,O.font_destroy)(P[1][e]);P[0]=null,P[1]=null,_=null,o=0}},218:(e,t,n)=>{n.r(t),n.d(t,{PLAYERS:()=>Lt,level_add_to_score:()=>Zt,level_add_to_secret_bonus:()=>on,level_boss_battle:()=>sn,level_brick_move_actor:()=>hn,level_call_dialogbox:()=>rn,level_clear:()=>an,level_create_animal:()=>bn,level_create_brick:()=>fn,level_create_enemy:()=>mn,level_create_item:()=>gn,level_create_particle:()=>vn,level_editmode:()=>$t,level_get_brick_id:()=>xn,level_get_brick_list:()=>En,level_getfile:()=>Kt,level_gravity:()=>un,level_hide_dialogbox:()=>_n,level_init:()=>Yt,level_kill_all_baddies:()=>cn,level_lock_camera:()=>dn,level_override_music:()=>tn,level_player:()=>Qt,level_player_id:()=>Jt,level_release:()=>qt,level_render:()=>Xt,level_render_entities:()=>yn,level_restore_music:()=>pn,level_save:()=>Ut,level_set_camera_focus:()=>Jn,level_set_spawn_point:()=>nn,level_setfile:()=>Gt,level_size:()=>en,level_spawn_players:()=>In,level_unlock_camera:()=>ln,level_update:()=>zt});var a,i,o,r,_,s,c,d,l,p,u,f,g,m,v,h,b,y,E,x,I,w,S,k,O,N,L,D,T,R,P,M,C,j,H,A,F,V,B,W,G,K,U,Y,z,X,q,$,Q,J,Z,ee,te,ne,ae,ie,oe,re,_e,se,ce,de,le,pe=n(458),ue=n(931),fe=n(470),ge=n(386),me=n(709),ve=n(689),he=n(898),be=n(880),ye=n(163),Ee=n(954),xe=n(878),Ie=n(642),we=n(120),Se=n(429),ke={is_locked:!1,position:{x:0,y:0},dest:{x:0,y:0},speed:0,region_topleft:{x:0,y:0},region_bottomright:{x:0,y:0},dest_region_topleft:{x:0,y:0},dest_region_bottomright:{x:0,y:0},region_topleft_speed:0,region_bottomright_speed:0},Oe=function(e,t){e.x<ke.region_topleft.x&&(e.x=ke.region_topleft.x),e.y<ke.region_topleft.y&&(e.y=ke.region_topleft.y),e.x>ke.region_bottomright.x&&(e.x=ke.region_bottomright.x),e.y>ke.region_bottomright.y&&(e.y=ke.region_bottomright.y),ke.dest=e,t>ge.EPSILON?ke.speed=(0,xe.v2d_magnitude)((0,xe.v2d_subtract)(ke.position,ke.dest))/t:ke.position=ke.dest,ke.position.x=parseInt(e.x,10),ke.position.y=parseInt(e.y,10)},Ne=function(){return(0,xe.v2d_new)(ke.position.x,ke.position.y)},Le=function(e){var t=(0,xe.v2d_new)(e.x,e.y);ke.dest=ke.position=t},De=function(e,t,n,a){ke.dest_region_topleft.x=Math.max(Math.min(e,n),Ie.VIDEO_SCREEN_W/2),ke.dest_region_topleft.y=Math.max(Math.min(t,a),Ie.VIDEO_SCREEN_H/2),ke.dest_region_bottomright.x=Math.min(Math.max(e,n),en().x-Ie.VIDEO_SCREEN_W/2),ke.dest_region_bottomright.y=Math.min(Math.max(t,a),en().y-Ie.VIDEO_SCREEN_H/2),ke.region_topleft_speed=(0,xe.v2d_magnitude)((0,xe.v2d_subtract)(ke.region_topleft,ke.dest_region_topleft))/.25,ke.region_bottomright_speed=(0,xe.v2d_magnitude)((0,xe.v2d_subtract)(ke.region_bottomright,ke.dest_region_bottomright))/.25},Te=n(235),Re=n(176),Pe=n(798),Me=[],Ce=function(){return a},je=function(e){return a>0?(e=(0,Ee.clip)(e,0,a-1),Me[e]):null},He=function e(t){return null!=t&&(t.next=e(t.next),t=null,t=null),t},Ae=!1,Fe=[ve.KEY_UP,ve.KEY_DOWN,ve.KEY_RIGHT,ve.KEY_LEFT,ve.KEY_N,ve.KEY_B,ve.KEY_LCONTROL,ve.KEY_F12],Ve=[ve.KEY_W,ve.KEY_S,ve.KEY_D,ve.KEY_A,ve.KEY_Z,ve.KEY_Y,ve.KEY_G,ve.KEY_P],Be={},We={},Ge=0,Ke=0,Ue=[Pe.vJ,Pe.oM,Pe.e0,Pe.eM,Pe.Or,Pe.Dk,Pe.vP,Pe.ZG,Pe.o9,Pe.Xb,Pe.M7,Pe.cV,Pe.vo,Pe.Mo,Pe.tk,Pe._q,Pe.H7,Pe.rm,Pe.k_,Pe.Rt,Pe.uW,Pe.uV,Pe.VJ,Pe.mw,Pe.mH,Pe.jQ,Pe.at,Pe.ko,Pe.uN,Pe.PC,Pe.pQ,Pe.Vu,Pe.bw,Pe.b0,Pe.OQ,Pe.d8,Pe.vc,Pe.ty,Pe.zm,Pe.EO,Pe.Wm,Pe.jy,Pe.Nx,Pe.wN,Pe.Gd,Pe.xe,Pe.Vj,Pe.xW,Pe.pp,Pe.qh,Pe.Zy,Pe.be,Pe.Bh,Pe.jw,Pe.nN,Pe.Bs,Pe.X,Pe.$q,Pe.Zf,Pe.lL,Pe.C8,Pe.EQ,Pe.fm,Pe.Qs,Pe.so,Pe.DM,Pe.f7,Pe.S0,Pe.tG,Pe.iR,Pe.mb,Pe.Bq,-1],Ye=0,ze=function(){return Ae},Xe=function(){console.log("SAVE");var e=Kt();Ut(e),(0,ue.sound_play)((0,fe.soundfactory_get)("level saved"))},qe=function(){var e,t=(0,ye.timer_get_delta)();e=(0,ve.input_button_down)(s,ve.IB_FIRE3)?3750:750,((0,ve.input_button_down)(s,ve.IB_UP)||(0,ve.input_button_down)(c,ve.IB_UP))&&(Be.y-=e*t),((0,ve.input_button_down)(s,ve.IB_DOWN)||(0,ve.input_button_down)(c,ve.IB_DOWN))&&(Be.y+=e*t),((0,ve.input_button_down)(s,ve.IB_LEFT)||(0,ve.input_button_down)(c,ve.IB_LEFT))&&(Be.x-=e*t),((0,ve.input_button_down)(s,ve.IB_RIGHT)||(0,ve.input_button_down)(c,ve.IB_RIGHT))&&(Be.x+=e*t),Be.x=parseInt(Math.max(Be.x,Ie.VIDEO_SCREEN_W/2),10),Be.y=parseInt(Math.max(Be.y,Ie.VIDEO_SCREEN_H/2),10),Le(Be)},$e=function(e){switch(e){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},Qe=function(e,t){var n;switch(e){case 1:n=(0,Se.m$)(t);break;case 2:n=(0,Pe._y)(t),(0,Pe.tl)(n)}return""},Je=function e(){Ge=0,Ke=0,4==(d=1==d?2:2==d?3:3==d?4:4==d?1:d)&&0==Ce()&&e()},Ze=function e(){Ge=0,Ke=0,4==(d=2==d?1:3==d?2:4==d?3:1==d?4:d)&&0==Ce()&&e()},et=function e(){var t;switch(d){case 1:t=(0,Se.Qb)(),Ge=(Ge+1)%t,null==(0,Se.m$)(Ge)&&e();break;case 2:Ge=Ue[Ke=(Ke+1)%(t=u)];break;case 3:Ge=(Ge+1)%(t=g);break;case 4:t=Ce(),Ge=(Ge+1)%t}},tt=function e(){var t;switch(d){case 1:t=(0,Se.Qb)(),Ge=(Ge-1+t)%t,null==(0,Se.m$)(Ge)&&e();break;case 2:Ge=Ue[Ke=(Ke-1+(t=u))%t];break;case 3:Ge=(Ge-1+(t=g))%t;break;case 4:t=Ce(),Ge=(Ge-1+t)%t}},nt=function(e){var t;for(t=0;t<u;t++)if(e==Ue[t])return t;return-1},at=function e(t,n,a){var i=null,o=(0,xe.v2d_new)(0,0);switch(t){case 1:null!=(0,Se.m$)(n)&&(i=(0,Se.m$)(n).image);break;case 2:var r=(0,Pe._y)(n);null!=r&&(i=(0,we.Ix)(r.actor),(o=r.actor.hot_spot).y-=2,(0,Pe.tl)(r));break;case 3:var _=(0,Te.enemy_create)(ot(n));null!=_&&(i=(0,we.Ix)(_.actor),(o=_.actor.hot_spot).y-=2,(0,Te.enemy_destroy)(_));break;case 4:var s;for(s=je(n);s;s=s.next)e(EDITORGRP_ENTITY_TO_EDT(s.entity.type),s.entity.id,(0,xe.v2d_add)(a,s.entity.position))}null!=i&&(0,me.image_blit)(i.data,(0,Ie.video_get_backbuffer)(),i.sx,i.sy,parseInt(a.x-o.x,10),parseInt(a.y-o.y,10),i.swidth,i.sheight)},it=function(e){var t;for(t=0;t<g;t++)if(e==f[t])return t;return-1},ot=function(e){return null},rt=function(){Ye=!1},_t=function(){},st=function(){(0,ve.input_button_pressed)(c,ve.IB_FIRE3)&&(Ye=!Ye)},ct=function(e){var t=(0,xe.v2d_subtract)(Be,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2)),n=parseInt(t.x%1,10),a=parseInt(t.y%1,10),i=-n+1*parseInt(e.x/1,10),o=-a+1*parseInt(e.y/1,10);return(0,xe.v2d_add)(t,(0,xe.v2d_new)(i,o))},dt=function(e,t,n,a){var i={};return i.type=e?1:2,i.obj_type=t,i.obj_id=n,i.obj_position=a,i},lt=function(e,t,n){var a={};return a.type=e?3:4,a.obj_position=t,a.obj_old_position=n,a},pt=function(){v=ft(v),m=null,h=null},ut=function e(t){console.log("REGISTER",t);var n,a=!1;if(4!=t.obj_type){var i,o,r;for((r={}).action=t,r.in_group=a,r.in_group&&(r.group_key=n),null!=(i=h)&&(i.next=ft(i.next)),o=m;null!=o.next;)o=o.next;o.next=r,r.prev=o,r.next=null,h=r}else{var _,s=48879;for(a=!0,n=s++,_=je(t.obj_id);_;_=_.next){var c=_.entity,d=EDITORGRP_ENTITY_TO_EDT(c.type);e(dt(!0,d,c.id,(0,xe.v2d_add)(c.position,t.obj_position)))}a=!1}},ft=function(e){var t,n;for(t=e;null!=t;)n=t.next,t=null,t=n;return null},gt=function e(){var t,n;h!=v&&(t=h,h=h.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&e(),(n=t.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,vt(n))},mt=function e(){var t,n;null!=h.next&&((t=h=h.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&e(),n=t.action,vt(n))},vt=function e(t){if(console.log("COMMIT",t),1==t.type)switch(t.obj_type){case 1:fn(t.obj_id,t.obj_position);break;case 2:gn(t.obj_id,t.obj_position);break;case 3:mn(ot(t.obj_id),t.obj_position);break;case 4:var n;for(n=je(t.obj_id);n;n=n.next){var a=n.entity,i=EDITORGRP_ENTITY_TO_EDT(a.type);e(dt(!0,i,a.id,(0,xe.v2d_add)(a.position,t.obj_position)))}}else if(2==t.type)switch(t.obj_type){case 1:var o,r=(0,Se.m$)(t.obj_id);for(o=b;o;o=o.next)o.data.brick_ref==r&&(0,xe.v2d_magnitude)((0,xe.v2d_subtract)((0,xe.v2d_new)(o.data.x,o.data.y),t.obj_position))<ge.EPSILON&&(o.data.state=Se.Dx);break;case 2:var _,s=t.obj_id;for(_=item_list;_;_=_.next)_.data.type==s&&(0,xe.v2d_magnitude)((0,xe.v2d_subtract)(_.data.actor.position,t.obj_position))<ge.EPSILON&&(_.data.state=IS_DEAD);break;case 3:var c,d=t.obj_id;for(c=enemy_list;c;c=c.next)it(c.data.name)==d&&(0,xe.v2d_magnitude)((0,xe.v2d_subtract)(c.data.actor.position,t.obj_position))<ge.EPSILON&&(c.data.state=ES_DEAD)}else 3==t.type?(nn(t.obj_position),In()):4==t.type&&(nn(t.obj_old_position),In())},ht=n(38),bt=n(450),yt=n(667),Et=n(532),xt=n(51),It=function(e,t){kt(e,t,!0),(0,we.z7)(e.actor,t),kt(e,t,!1)},wt=function(e){return 1==e.state},St=function(e,t){var n;for(n=0;n<t.length&&1!=e.state;n++)if(t[n]&&(0,we.Ib)(e.actor,t[n].actor))return!(!t[n].attacking(t[n])&&!t[n].invincible&&(t[n].hit(t[n]),1));return!1},kt=function(e,t,n){var a=e.actor,i=.001*(0,ye.timer_get_ticks)();if(3===e.type){var o,r=(0,xe.v2d_new)(0,0);if((0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_INVSTAR",0),1),1!=e.state)for(o=0;o<5;o++)r.x=a.position.x+20*Math.cos(2*ge.PI*i+2*o*ge.PI/5),r.y=a.position.y+20*Math.sin(ge.PI*i+2*o*ge.PI/5)}},Ot=n(971),Nt=n(943),Lt=[0,1,2],Dt=Ie.VIDEO_SCREEN_W,Tt="data/levels/blue_ocean_1.json",Rt=null,Pt=[],Mt=[],Ct=[],jt=[],Ht={position:{x:0,y:0}},At=[],Ft=[],Vt=[],Bt=[],Wt=[],Gt=function(e){Tt=e,(0,he.logfile_message)("level_setfile('%s')",e)},Kt=function(){return Tt},Ut=function(e){var t,n,a,i,o,r={name:y,act:S,theme:x,bgtheme:I,grouptheme:w,spawn_point:D,music:E,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};ea()&&(r.boss={id:F.type,x:F.actor.spawn_point.x,y:F.actor.spawn_point.y,rx:F.rect_x,ry:F.rect_y,rw:F.rect_w,rh:F.rect_h});var _=[];for(a=Rt;a;a=a.next)_.push({id:Sn(a.data),xpos:a.data.sx,ypos:a.data.sy});r.bricklist=_;var s=[];for(i=Pt;i;i=i.next)i.data&&s.push({id:i.data.type,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y});r.itemlist=s;var c=[];for(o=Mt;o;o=o.next)o.data&&o.data.created_from_editor&&c.push({id:o.data.name,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.enemylist=c;var d=[];for(t=0,n=Wt.length;t<n;t++)d.push({xpos:Wt[t].rect_x,ypos:Wt[t].rect_y,width:Wt[t].rect_w,height:Wt[t].rect_h,title:Wt[t].title,message:Wt[t].message});r.dialogbox=d;var l=e.split("/");l=l[l.length-1],console.log("saveFile",e,r),(0,he.logfile_message)("level_save() ok")},Yt=function(){var e;Dt=Ie.VIDEO_SCREEN_W,(0,he.logfile_message)("level_init()"),Rt=null,Pt=[],jt=[],k=800,O=N=0,L=0,le=0,R=null,U=!1,M=!1,C="",Y=z=X=0,Ft=J=Z=0,q=$=!1,Q=!1,j=null,Rn(),(0,he.logfile_message)("editor_init()"),b=En(),Ae=!1,u=Ue.length,d=1,Ge=0,i=(0,Ie.video_get_resolution)(),o=(0,Ie.video_is_smooth)(),f=(0,Te.enemy_get_list_of_names)(g),r=(0,me.image_load)("data/images/editorbg.png"),s=(0,ve.input_create_keyboard)(Fe),c=(0,ve.input_create_keyboard)(Ve),_=(0,ve.input_create_mouse)(),l=(0,Re.font_create)(8),p=(0,Re.font_create)(8),function(){var e;for(a=0,e=0;e<501;e++)Me[e]=null}(),rt(),(0,he.logfile_message)("editor_init() ok"),ta(Tt).then((function(){for((0,he.logfile_message)("Creating players..."),e=0;e<Lt.length;e++){var t=(0,Ot.player_create)(Lt[e]);t.hit=Ot.player_hit,t.kill=Ot.player_kill,t.set_rings=Ot.player_set_rings,t.get_rings=Ot.player_get_rings,t.got_glasses=!1,jt.push(t)}for(Fn(),H=jt[A=0],ke.is_locked=!1,ke.speed=0,ke.region_topleft_speed=0,ke.region_bottomright_speed=0,ke.position=ke.dest=(0,xe.v2d_new)(0,0),ke.region_topleft.x=ke.dest_region_topleft.x=Ie.VIDEO_SCREEN_W/2,ke.region_topleft.y=ke.dest_region_topleft.y=Ie.VIDEO_SCREEN_H/2,ke.region_bottomright.x=ke.dest_region_bottomright.x=en().x-Ie.VIDEO_SCREEN_W/2,ke.region_bottomright.y=ke.dest_region_bottomright.y=en().y-Ie.VIDEO_SCREEN_H/2,Le(H.actor.position),Jn(H.actor),(0,Ot.player_set_rings)(0),V=!1,B=!1,(0,he.logfile_message)("Loading hud..."),(W=(0,we.HN)()).position=(0,xe.v2d_new)(16,7),W=(0,we.TK)(W,(0,be.sprite_get_animation)("SD_MAINGUI",0)),(G=(0,we.HN)()).position=(0,xe.v2d_new)(16,Ie.VIDEO_SCREEN_H-23),G=(0,we.TK)(G,(0,be.sprite_get_animation)("SD_LIFEGUI",0)),(K=(0,Re.font_create)(0)).position=(0,xe.v2d_add)(G.position,(0,xe.v2d_new)(32,11)),e=0;e<3;e++)At[e]=(0,Re.font_create)(2),At[e].position=(0,xe.v2d_add)(W.position,(0,xe.v2d_new)(42,16*e+2));for((ae=(0,we.HN)()).position=(0,xe.v2d_new)(0,-240),ae=(0,we.TK)(ae,(0,be.sprite_get_animation)("SD_LEVELOP",0)),(ie=(0,we.HN)()).position=(0,xe.v2d_new)(260,250),ie=(0,we.TK)(ie,(0,be.sprite_get_animation)("SD_LEVELACT",S-1)),(oe=(0,Re.font_create)(3)).position=(0,xe.v2d_new)(330,50),(0,Re.font_set_text)(oe,"%s",y.toUpperCase()),(0,Re.font_set_width)(oe,180),ee=(0,Re.font_create)(4),te=(0,Re.font_create)(7),ne=(0,we.HN)(),e=0;e<3;e++)Vt[e]=(0,Re.font_create)(2),Bt[e]=(0,we.HN)();re=!1,_e=0,(se=(0,we.HN)()).position.y=Ie.VIDEO_SCREEN_H,se=(0,we.TK)(se,(0,be.sprite_get_animation)("SD_DIALOGBOX",0)),ce=(0,Re.font_create)(8),de=(0,Re.font_create)(8)}))},zt=function(){var e,t;L+=(0,ye.timer_get_delta)();var n,a,r,u,f,g,y,E=!1,x=!1,I=!1,w=(0,ye.timer_get_delta)();if(qn(),zn(),Xn(),ze())!function(){b||(b=En());var e,t,n,a,r,u=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ARROW",0),0),f=(0,Re.font_get_charsize)(l).x,g=(0,Re.font_get_charsize)(l).y,m=(0,xe.v2d_subtract)(Be,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2));if((0,ve.input_button_down)(s,ve.IB_FIRE3)&&(0,ve.input_button_pressed)(s,ve.IB_FIRE4)&&Xe(),(0,ve.input_button_down)(s,ve.IB_FIRE4))return(0,he.logfile_message)("editor_disable()"),pt(),Ae=!1,(0,Ie.video_changemode)(i,o,(0,Ie.video_is_fullscreen)()),void(0,he.logfile_message)("editor_disable() ok");if((0,ve.input_button_down)(s,ve.IB_FIRE3)?(((0,ve.input_button_pressed)(s,ve.IB_FIRE1)||(0,ve.input_button_pressed)(_,ve.IB_DOWN))&&Je(),((0,ve.input_button_pressed)(s,ve.IB_FIRE2)||(0,ve.input_button_pressed)(_,ve.IB_UP))&&Ze()):(((0,ve.input_button_pressed)(s,ve.IB_FIRE1)||(0,ve.input_button_pressed)(_,ve.IB_DOWN))&&et(),((0,ve.input_button_pressed)(s,ve.IB_FIRE2)||(0,ve.input_button_pressed)(_,ve.IB_UP))&&tt()),We.x=(0,Ee.clip)((0,ve.input_get_xy)(_).x,0,Ie.VIDEO_SCREEN_W-u.width),We.y=(0,Ee.clip)((0,ve.input_get_xy)(_).y,0,Ie.VIDEO_SCREEN_H-u.height),(0,ve.input_button_pressed)(_,ve.IB_FIRE1)&&(0,ve.input_button_down)(s,ve.IB_FIRE3)){var v=ct(We),h=lt(!0,v,spawn_point);vt(h),ut(h)}if((0,ve.input_button_pressed)(_,ve.IB_FIRE1)&&!(0,ve.input_button_down)(s,ve.IB_FIRE3)){var y=dt(!0,d,Ge,ct(We));vt(y),ut(y)}if(e=(0,ve.input_button_pressed)(_,ve.IB_FIRE3),t=(0,ve.input_button_pressed)(_,ve.IB_FIRE2),e||t)switch(console.log(e,t,d,1),d){case 1:for(n=b;n;n=n.next){var E=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],x=[We.x+m.x,We.y+m.y,We.x+m.x+1,We.y+m.y+1];if((0,Ee.bounding_box)(E,x)){if(!e){var I=dt(!1,1,xn(n.data),(0,xe.v2d_new)(n.data.x,n.data.y));vt(I),ut(I);break}Ge=xn(n.data)}}break;case 2:for(a=item_list;a;a=a.next){var w=[a.data.actor.position.x-a.data.actor.hot_spot.x,a.data.actor.position.y-a.data.actor.hot_spot.y,a.data.actor.position.x-a.data.actor.hot_spot.x+(0,we.Ix)(a.data.actor).width,a.data.actor.position.y-a.data.actor.hot_spot.y+(0,we.Ix)(a.data.actor).height],S=[We.x+m.x,We.y+m.y,We.x+m.x+1,We.y+m.y+1];if((0,Ee.bounding_box)(w,S)){if(!e){var k=dt(!1,2,a.data.type,a.data.actor.position);vt(k),ut(k);break}var O=nt(a.data.type);O>=0&&(Ke=O,Ge=Ue[O])}}break;case 3:for(r=enemy_list;r;r=r.next){var N=[r.data.actor.position.x-r.data.actor.hot_spot.x,r.data.actor.position.y-r.data.actor.hot_spot.y,r.data.actor.position.x-r.data.actor.hot_spot.x+(0,we.Ix)(r.data.actor).width,r.data.actor.position.y-r.data.actor.hot_spot.y+(0,we.Ix)(r.data.actor).height],L=[We.x+m.x,We.y+m.y,We.x+m.x+1,We.y+m.y+1],D=it(r.data.name);if(D>=0&&(0,Ee.bounding_box)(N,L)){if(!e){var T=dt(!1,3,D,r.data.actor.position);vt(T),ut(T);break}Ge=D}}}(0,ve.input_button_down)(s,ve.IB_FIRE3)&&((0,ve.input_button_pressed)(c,ve.IB_FIRE1)?gt():(0,ve.input_button_pressed)(c,ve.IB_FIRE2)&&mt()),st(),qe(),(0,Re.font_set_text)(l,"%d,%d",parseInt(ct(We).x,10),parseInt(ct(We).y,10)),l.position.x=(0,Ee.clip)(parseInt(We.x,10),10,Ie.VIDEO_SCREEN_W-f*(0,Re.font_get_text)(l).length-10),l.position.y=(0,Ee.clip)(parseInt(We.y-3*g,10),10,Ie.VIDEO_SCREEN_H-10),p.position=(0,xe.v2d_new)(10,10),3!=d?(0,Re.font_set_text)(p,"<color=ffff00>%s %d</color>\n%s",$e(d),Ge,Qe(d,Ge)):(0,Re.font_set_text)(p,'<color=ffff00>%s "%s"</color>\n%s',$e(d),ot(Ge),Qe(d,Ge))}();else{for(I=L<5,e=0;e<jt.length&&!I;e++)jt[e]&&(I=jt[e].dead);if(H&&H.actor&&(0,ve.input_button_pressed)(H.actor.input,ve.IB_FIRE4)&&!I){console.log("QUIT");var S=[];return T.pause(),S[0]=(0,ht.lang_getstring)("CBOX_QUIT_QUESTION"),S[1]=(0,ht.lang_getstring)("CBOX_QUIT_OPTION1"),S[2]=(0,ht.lang_getstring)("CBOX_QUIT_OPTION2"),(0,pe.confirmbox_alert)(S[0],S[1],S[2]),void(0,yt.scenestack_push)((0,Et.storyboard_get_scene)(Et.SCENE_CONFIRMBOX))}if(1==(t=(0,pe.confirmbox_selected_option)())?M=!0:2==t&&(0,ue.music_play)(T,!0),M)return(0,Ie.video_fadefx_over)()?((0,yt.scenestack_pop)(),void(0,Nt.quest_abort)()):void(0,Ie.video_fadefx_out)((0,me.image_rgb)(0,0,0),1);if((0,ve.input_button_pressed)(s,ve.IB_FIRE5))return(0,he.logfile_message)("editor_enable()"),(v={}).in_group=!1,v.prev=null,v.next=null,m=v,h=v,Ae=!0,Be.x=parseInt(Ne().x,10),Be.y=parseInt(Ne().y,10),We=(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2),i=(0,Ie.video_get_resolution)(),o=(0,Ie.video_is_smooth)(),(0,Ie.video_changemode)(Ie.VIDEORESOLUTION_EDT,!1,(0,Ie.video_is_fullscreen)()),void(0,he.logfile_message)("editor_enable() ok");for(x=L<5,e=0;e<jt.length&&!x;e++)x=jt[e].dying||jt[e].dead;if(H&&(0,ve.input_button_pressed)(H.actor.input,ve.IB_FIRE3)&&!x)return H.spin_dash=H.braking=!1,(0,ue.music_pause)(),void(0,yt.scenestack_push)((0,Et.storyboard_get_scene)(Et.SCENE_PAUSE));W=(0,we.TK)(W,(0,be.sprite_get_animation)("SD_MAINGUI",(0,Ot.player_get_rings)()>0?0:1)),G=(0,we.TK)(G,(0,be.sprite_get_animation)("SD_LIFEGUI",A)),K=(0,Re.font_set_text)(K,"%d",(0,Ot.player_get_lives)()),(0,Re.font_set_text)(At[0],"%d",(0,Ot.player_get_score)());var k=parseInt(L%60,10);if(k<10&&(k="0"+k),(0,Re.font_set_text)(At[1],"%s",parseInt(L/60,10)+":"+k),(0,Re.font_set_text)(At[2],"%d",(0,Ot.player_get_rings)()),ae&&(L<5?L<1.5?(ae.position.y+=360*w,ae.position.y>-2&&(ae.position.y=-2),oe.position.x-=320*w,oe.position.x<140&&(oe.position.x=140),ie.position.y-=200*w,ie.position.y<200&&(ie.position.y=200)):L>3.5&&(ae.position.x-=320*w):(ae.visible=!1,oe.visible=!1,ie.visible=!1)),U){var O=0,D=(0,ye.timer_get_ticks)(),R=(0,fe.soundfactory_get)("ring count"),C=(0,fe.soundfactory_get)("cash"),re=(0,fe.soundfactory_get)("glasses");if(D>=Y+2e3){for(e=0;e<jt.length;e++)jt[e]&&(jt[e].actor.speed.x=0);for(ee.position.x=Math.min(ee.position.x+800*w,30),te.position.x=Math.min(te.position.x+700*w,12),ne.position.x=Math.max(ne.position.x-700*w,250),e=0;e<3;e++)Bt[e].position.x=Math.min(Bt[e].position.x+(400-50*e)*w,50),Vt[e].position.x=Math.max(Vt[e].position.x-(400-50*e)*w,230);O=Z-(Ft+J),(0,Re.font_set_text)(Vt[0],"%d",parseInt(Ft,10)),(0,Re.font_set_text)(Vt[1],"%d",parseInt(J,10)),(0,Re.font_set_text)(Vt[2],"%d",parseInt(O,10)),Q||((0,ue.music_stop)(),(0,ue.sound_play)((0,fe.soundfactory_get)("goal")),Q=!0)}if(D>=Y+6e3&&!q)if(Ft=Math.max(0,Ft-400*w),J=Math.max(0,J-2e3*w),Ft>0||J>0)R&&D>=X&&(X=D+100,(0,ue.sound_play)(R));else for(q=!0,z=D+4e3,(0,ue.sound_play)(C),e=0;e<jt.length;e++)if(jt[e].got_glasses){(0,ue.sound_play)(re);break}q&&D>=z&&($=!0)}for(Hn(),jn(),E=!1,e=0;e<jt.length;e++)jt[e].dying&&(E=!0);for(f=Un(),n=Gn(),a=null,(0,xt.A4)(j),g=Pt;g;g=g.next)if(g.data&&g.data.actor){var _e=g.data.actor.position.x,se=g.data.actor.position.y,ce=(0,we.Ix)(g.data.actor).width,de=(0,we.Ix)(g.data.actor).height;if(Zn(_e,se,ce,de,Dt)){if((0,Pe.wU)(g.data,jt,3,n,Pt,Mt),g.data.obstacle){var le=void 0,Le=void 0,Me=(0,xe.v2d_add)(g.data.actor.hot_spot,(0,xe.v2d_new)(0,-1)),Ce=(0,we.Ix)(g.data.actor),je=Vn(Ce.width,Ce.height-1,(0,xe.v2d_subtract)(g.data.actor.position,Me),0);je.brick_ref.zindex=g.data.bring_to_back?.4:.5,(le={}).next=a,le.data=je,a=le,(Le={}).next=n,Le.data=je,n=Le}}else g.data.preserve||(g.data.state=Pe.rJ)}for(y=Mt;y;y=y.next)if(y.data){var He=y.data.actor.position.x,Fe=y.data.actor.position.y,Ve=(0,we.Ix)(y.data.actor).width,Ye=(0,we.Ix)(y.data.actor).height;if(Zn(He,Fe,Ve,Ye,Dt)||y.data.always_active){if(H&&H.actor&&!(0,ve.input_is_ignored)(H.actor.input)&&(E||U||(0,Te.enemy_update)(y.data,jt,jt.length,n,f,Mt)),y.data.obstacle){var at=void 0,rt=void 0,_t=(0,xe.v2d_add)(y.data.actor.hot_spot,(0,xe.v2d_new)(0,-1)),ft=(0,we.Ix)(y.data.actor),bt=Vn(ft.width,ft.height-1,(0,xe.v2d_subtract)(y.data.actor.position,_t),y.data.obstacle_angle);(at={}).next=a,at.data=bt,a=at,(rt={}).next=n,rt.data=bt,n=rt}}else y.data.preserve?Zn(y.data.actor.spawn_point.x,y.data.actor.spawn_point.y,Ve,Ye,Dt)||(y.data.actor.position=(0,xe.v2d_new)(y.data.actor.spawn_point.x,y.data.actor.spawn_point.y)):y.data.state=Pe.rJ}if(ea()&&H&&H.actor){var It,kt=H.actor,Lt=[kt.position.x,kt.position.y,kt.position.x+1,kt.position.y+1],Tt=[F.rect_x,F.rect_y,F.rect_x+F.rect_w,F.rect_y+F.rect_h];if(E||function(e,t,n){var a=e.actor,i=null,o=null,r=null,_=null,s=null,c=null,d=null,l=null,p=[],u=(0,we.kj)(a,2,-2,n,i,o,r,_,s,c,d,l);i=u.up,o=u.upright,r=u.right,_=u.downright,s=u.down,c=u.downleft,d=u.left,l=u.upleft;var f=(0,we.K1)(a,-2,i,o,r,_,s,c,d,l);if(i=f.up,o=f.upright,r=f.right,_=f.downright,s=f.down,c=f.downleft,d=f.left,l=f.upleft,p[0]=i,p[1]=o,p[2]=r,p[3]=_,p[4]=s,p[5]=c,p[6]=d,p[7]=l,sn())switch(e.hp<=0&&1!=e.state&&(cn(),e.state=1),e.type){case 0:!function(e,t,n,a){var i=Qt(),o=.001*(0,ye.timer_get_ticks)(),r=e.actor,_=e.value[0],s=e.value[1];if(1==e.state){if(e.bring_to_front=!0,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,ye.timer_get_delta)(),o>=s+.15){var c=(0,xe.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.Ix)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.Ix)(r).height));gn(Pe.bW,c),r.position.y<=r.spawn_point.y+1.5*Ie.VIDEO_SCREEN_H&&(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),s=o}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?(0,ve.input_simulate_button_down)(r.input,ve.IB_RIGHT):3==e.direction&&(0,ve.input_simulate_button_down)(r.input,ve.IB_LEFT),r.position.y=r.spawn_point.y+20*Math.cos(ge.PI*o),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,(0,we.q8)(r,(0,we.xG)(r)),o>=_+2/e.initial_hp*e.hp&&(mn([0,3][parseInt((0,Ee.random)(2),10)],r.position).actor.speed.y=-150-(0,Ee.random)(50),_=o),St(e,t)&&r.animation==(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,e.hp--),(0,we.$C)(r)&&(0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=_,e.value[1]=s}(e,t);break;case 1:!function(e,t,n,a){var i,o=Qt(),r=e.actor,_=.001*(0,ye.timer_get_ticks)(),s=(0,ye.timer_get_delta)(),c=e.value[0],d=e.value[1],l=e.value[2];switch(e.state){case 0:if(e.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(ge.PI*_),(0,we.$C)(r)&&actor.change_animation(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),_>=c+5){var p,u=(0,xe.v2d_new)(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);u=(0,xe.v2d_multiply)((0,xe.v2d_normalize)(u),200),(p=gn(Pe.gb,r.position)).dangerouspower_set_speed(p,u),(0,ue.sound_play)((0,fe.soundfactory_get)("big shot")),c=_}if(_>=d+15){var f=e.rect_x+e.rect_w/2;e.direction=r.position.x>f?3:1,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,d=_}break;case 2:var g=e.rect_x+100,m=e.rect_x+e.rect_w-100,v=m-g+(r.position.x-g),h=3==e.direction?-1:1;r.position.x+=200*h*s,r.position.y=r.spawn_point.y-100*Math.sin(ge.PI/(m-g)*v),(0,we.$C)(r)&&(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==h&&r.position.x<=g||1==h&&r.position.x>=m)&&((0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",4)),r.position.y+=100*(0,ye.timer_get_delta)(),_>=l+.15){var b=(0,xe.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.Ix)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.Ix)(r).height));gn(Pe.bW,b),r.position.y<=r.spawn_point.y+1.5*Ie.VIDEO_SCREEN_H&&(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),l=_}}i=r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",1)||r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",3),St(e,t)&&!i&&1!=e.state&&(r.animation=(0,be.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),e.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP}(e,t);break;case 2:!function(e,t,n,a){var i=Qt(),o=.001*(0,ye.timer_get_ticks)(),r=e.actor,_=e.value[0],s=e.value[1],c=e.value[2];if(1==e.state){if(e.bring_to_front=!0,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,ye.timer_get_delta)(),o>=s+.15){var d=(0,xe.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.Ix)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.Ix)(r).height));gn(Pe.bW,d),r.position.y<=r.spawn_point.y+1.5*Ie.VIDEO_SCREEN_H&&(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),s=o}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?(0,ve.input_simulate_button_down)(r.input,ve.IB_RIGHT):3==e.direction&&(0,ve.input_simulate_button_down)(r.input,ve.IB_LEFT),r.position.y=r.spawn_point.y+20*Math.cos(ge.PI*o),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,(0,we.q8)(r,(0,we.xG)(r)),o>=_+2/e.initial_hp*e.hp&&(mn(["9","6"][parseInt((0,Ee.random)(2),10)],r.position).actor.speed.y=-150-(0,Ee.random)(50),_=o),o>=c+3/e.initial_hp*e.hp&&(gn(Pe.Pr,r.position).actor.speed.y=100,(0,ue.sound_play)((0,fe.soundfactory_get)("fire")),c=o),St(e,t)&&r.animation==(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),i.actor.speed.x*=-1,i.actor.speed.y=100,e.hp--),(0,we.$C)(r)&&(0,we.TK)(r,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=_,e.value[1]=s,e.value[2]=c}(e,t);break;case 3:!function(e,t,n,a){var i,o=Qt(),r=e.actor,_=.001*(0,ye.timer_get_ticks)(),s=(0,ye.timer_get_delta)(),c=e.value[0],d=e.value[1],l=e.value[2],p=e.value[3];switch(e.state){case 0:if(e.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(ge.PI*_),(0,we.$C)(r)&&(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),_>=c+4){var u,f=(0,xe.v2d_new)(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);f=(0,xe.v2d_multiply)((0,xe.v2d_normalize)(f),200),(u=gn(Pe.gb,r.position)).dangerouspower_set_speed(u,f),(0,ue.sound_play)((0,fe.soundfactory_get)("big shot")),c=_}if(_>=d+8){var g=e.rect_x+e.rect_w/2;e.direction=r.position.x>g?3:1,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,d=_}break;case 2:var m=e.rect_x+100,v=e.rect_x+e.rect_w-100,h=v-m+(r.position.x-m),b=3==e.direction?-1:1;r.position.x+=200*b*s,r.position.y=r.spawn_point.y-100*Math.sin(ge.PI/(v-m)*h),_>=p+.2&&(gn(Pe.Pr,r.position).actor.speed.y=-200,(0,ue.sound_play)((0,fe.soundfactory_get)("fire")),p=_),(0,we.$C)(r)&&(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==b&&r.position.x<=m||1==b&&r.position.x>=v)&&((0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,we.TK)(r,(0,be.sprite_get_animation)("SD_MECHASHADOW",4)),r.position.y+=100*(0,ye.timer_get_delta)(),_>=l+.15){var y=(0,xe.v2d_new)(r.position.x-r.hot_spot.x+(0,Ee.random)((0,we.Ix)(r).width),r.position.y-r.hot_spot.y+(0,Ee.random)((0,we.Ix)(r).height));gn(Pe.bW,y),r.position.y<=r.spawn_point.y+1.5*Ie.VIDEO_SCREEN_H&&(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),l=_}}i=r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",1)||r.animation==(0,be.sprite_get_animation)("SD_MECHASHADOW",3),St(e,t)&&!i&&1!=e.state&&(r.animation=(0,be.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,ue.sound_play)((0,fe.soundfactory_get)("boss hit")),e.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==e.direction?ge.IF_NONE:ge.IF_HFLIP,e.value[0]=c,e.value[1]=d,e.value[2]=l,e.value[3]=p}(e,t)}}(F,jt,Rt),!wt(F)&&(0,Ee.bounding_box)(Lt,Tt)&&(V=!0,B=!0),!wt(F))for(e=0;e<jt.length;e++)(jt[e]!=H||H.actor.carrying)&&((It=jt[e].actor).position.x>F.rect_x-30&&It.position.x<F.rect_x&&(It.position.x=F.rect_x-30,It.speed.x=0),It.position.x>F.rect_x+F.rect_w&&It.position.x<F.rect_x+F.rect_w+30&&(It.position.x=F.rect_x+F.rect_w+30,It.speed.x=0));(wt(F)||H.dying)&&(V=!1,T&&((0,ue.music_set_volume)((0,ue.music_get_volume)()-.5*w),(0,ue.music_get_volume)()<ge.EPSILON&&((0,ue.music_stop)(),(0,ue.music_set_volume)(1),P=!0)))}for(e=0;e<jt.length;e++)(0,ve.input_ignore)(jt[e].actor.input);for(H&&H.actor&&L>=3.5&&(0,ve.input_restore)(H.actor.input),e=0;e<jt.length;e++){var Ct=jt[e].actor.position.x,Wt=jt[e].actor.position.y,Gt=(0,we.Ix)(jt[e].actor).width,Kt=(0,we.Ix)(jt[e].actor).height,Ut=jt[e].actor.hot_spot.y;if(e!=A&&(jt[e].getting_hit&&An(e),jt[e].dying&&(An(e),Ht!=jt[e].actor&&Oe(jt[e].actor.position,0))),jt[e].dead){if(!((0,Ot.player_get_lives)()>1))return(0,yt.scenestack_pop)(),void(0,yt.scenestack_push)((0,Et.storyboard_get_scene)(Et.SCENE_GAMEOVER));if((0,Ie.video_fadefx_over)())return(0,Ot.player_set_lives)((0,Ot.player_get_lives)()-1),void kn();(0,Ie.video_fadefx_out)((0,me.image_rgb)(0,0,0),1)}if($){if((0,Ie.video_fadefx_over)())return void(0,yt.scenestack_pop)();(0,Ie.video_fadefx_out)((0,me.image_rgb)(0,0,0),1)}(Zn(Ct,Wt,Gt,Kt,Dt/4)||jt[e].dying)&&(!E||jt[e].dying||jt[e].getting_hit)&&(0,Ot.player_update)(jt[e],jt,n),jt[e].actor.position.y<Ut&&!jt[e].dying?(jt[e].actor.position.y=Ut,jt[e].actor.speed.y=0):jt[e].actor.position.y>N-(Kt-Ut)&&Zn(Ct,Wt,Gt,Kt,Dt/4)&&(0,Ot.player_kill)(jt[e])}if(E||U||(L+=(0,ye.timer_get_delta)()/1e3,H&&(0,ve.input_button_pressed)(H.actor.input,ve.IB_FIRE2)&&(!(Math.abs(H.actor.speed.y)<ge.EPSILON)||H.on_moveable_platform||V||H.disable_movement||H.in_locked_area?(0,ue.sound_play)((0,fe.soundfactory_get)("deny")):An((A+1)%3))),ea()&&V){var Yt=H.actor;Yt&&(Yt.position.x<F.rect_x?(Yt.position.x=F.rect_x,Yt.speed.x=Math.max(0,Yt.speed.x)):Yt.position.x>F.rect_x+F.rect_w&&(Yt.position.x=F.rect_x+F.rect_w,Yt.speed.x=Math.min(Yt.speed.x,0)),Yt.position.y=(0,Ee.clip)(Yt.position.y,F.rect_y,F.rect_y+F.rect_h))}for(Pn(n),r=n;r;r=r.next){if(r.data&&r.data.brick_ref.behavior==Se.Yj){var zt=r.data.brick_ref.image.width,Xt=r.data.brick_ref.image.height,qt=[r.data.x,r.data.y,r.data.x+zt,r.data.y+Xt],$t=[r.data.x,r.data.y,r.data.x+zt,r.data.y+Xt];for(e=0;e<jt.length;e++)if(jt[e]&&(qt[0]=jt[e].actor.position.x-jt[e].actor.hot_spot.x-3,qt[1]=jt[e].actor.position.y-jt[e].actor.hot_spot.y-3,qt[2]=qt[0]+(0,we.Ix)(jt[e].actor).width+6,qt[3]=qt[1]+(0,we.Ix)(jt[e].actor).height+6,(jt[e].spin_dash||jt[e].spin||jt[e].type==Ot.PL_KNUCKLES)&&(0,Ee.bounding_box)(qt,$t))){var Jt,Zt,en=void 0,tn=void 0;for(Zt=Math.max(r.data.brick_ref.behavior_arg[0],1),Jt=Math.max(r.data.brick_ref.behavior_arg[1],1),en=0;en<Zt;en++)for(tn=0;tn<Jt;tn++){var nn=(0,xe.v2d_new)(r.data.x+en*zt/Zt,r.data.y+tn*Xt/Jt),an=(0,xe.v2d_new)(.3*-jt[e].actor.speed.x,-100-(0,Ee.random)(50)),on=(0,me.image_create)(zt/Zt,Xt/Jt);Math.abs(an.x)>ge.EPSILON&&(an.x+=(an.x>0?1:-1)*(0,Ee.random)(50)),vn(on,nn,an,!1)}(0,ue.sound_play)((0,fe.soundfactory_get)("break")),r.data.state=Se.Dx}}if(r.data&&r.data.brick_ref.behavior==Se.CH&&r.data.state==Se.q4){var rn=r.data;if(rn.value[1]+=(0,ye.timer_get_delta)(),rn.value[1]>=Se.gY){var _n,dn,ln=void 0,pn=void 0,un=0!=parseInt(rn.brick_ref.behavior_arg[2],10),fn=rn.brick_ref.image;for(_n=Math.max(rn.brick_ref.behavior_arg[0],1),dn=Math.max(rn.brick_ref.behavior_arg[1],1),ln=0;ln<_n;ln++)for(pn=0;pn<dn;pn++){var hn=(0,xe.v2d_new)(rn.x+ln*fn.width/_n,rn.y+pn*fn.height/dn),bn=(0,xe.v2d_new)(0,20+20*pn+20*(un?ln:_n-ln)),yn=(0,me.image_create)(fn.width/_n,fn.height/dn);vn(yn,hn,bn,!1)}(0,ue.sound_play)((0,fe.soundfactory_get)("break")),rn.state=Se.Dx}}Qn(r.data)}for(r=a;r;r=u)u=r.next,$n(r.data),r=null;if(a=null,Kn(n),Yn(f),H&&H.actor&&Jn(H.actor),U)Oe((0,xe.v2d_add)(Ht.position,(0,xe.v2d_new)(0,-90)),.17);else if(V){var In=[F.rect_x+Ie.VIDEO_SCREEN_W/2,F.rect_x+F.rect_w-Ie.VIDEO_SCREEN_W/2],wn=(0,xe.v2d_new)((0,Ee.clip)(Ht.position.x,In[0],In[1]),Ht.position.y);Oe((0,xe.v2d_add)(wn,(0,xe.v2d_new)(0,-90)),.17)}else E||Oe(Ht.position,.1);!function(){var e,t=(0,ye.timer_get_delta)();ke.is_locked||De(-ge.INFINITY,-ge.INFINITY,ge.INFINITY,ge.INFINITY),e=(0,xe.v2d_subtract)(ke.dest,ke.position),(0,xe.v2d_magnitude)(e)>10&&(e=(0,xe.v2d_normalize)(e),ke.position.x+=e.x*ke.speed*t,ke.position.y+=e.y*ke.speed*t),e=(0,xe.v2d_subtract)(ke.dest_region_topleft,ke.region_topleft),(0,xe.v2d_magnitude)(e)>10&&(e=(0,xe.v2d_normalize)(e),ke.region_topleft.x+=e.x*ke.region_topleft_speed*t,ke.region_topleft.y+=e.y*ke.region_topleft_speed*t),e=(0,xe.v2d_subtract)(ke.dest_region_bottomright,ke.region_bottomright),(0,xe.v2d_magnitude)(e)>10&&(e=(0,xe.v2d_normalize)(e),ke.region_bottomright.x+=e.x*ke.region_bottomright_speed*t,ke.region_bottomright.y+=e.y*ke.region_bottomright_speed*t)}()}Cn()},Xt=function(){if((0,Ie.video_clearDisplay)(),ze())return t=(0,xe.v2d_subtract)(Be,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2)),Ie.VIDEO_SCREEN_W,r.width,Ie.VIDEO_SCREEN_H,r.height,function(){if(Ye){var e,t,n,a,i=(0,xe.v2d_subtract)(Be,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2));for(n=(0,me.image_create)(1,1),a=(0,me.image_rgb)(0,128,160),(0,me.image_clear)(n,0,0,0),e=0;e<n.height;e++)(0,me.image_putpixel)(n,(0,Ie.video_get_backbuffer)(),n.width-1,e,a);for(e=0;e<n.width;e++)(0,me.image_putpixel)(n,(0,Ie.video_get_backbuffer)(),e,n.height-1,a);for(e=0;e<=Ie.VIDEO_SCREEN_W/1;e++)for(t=0;t<=Ie.VIDEO_SCREEN_H/1;t++)(0,xe.v2d_subtract)(ct((0,xe.v2d_new)(e*n.width,t*n.height)),i);(0,me.image_destroy)(n)}}(),yn(),at(d,Ge,(0,xe.v2d_subtract)(ct(We),t)),e=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ARROW",0),0),(0,me.image_blit)(e.data,(0,Ie.video_get_backbuffer)(),e.sx,e.sy,parseInt(We.x,10),parseInt(We.y,10),e.width,e.height),(0,Re.font_render)(l,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2)),void(0,Re.font_render)(p,(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2));var e,t;(0,xt.mw)(j,Ne()),On(),(0,xt.Ed)(j,Ne()),Ln()},qt=function(){var e;for((0,he.logfile_message)("level_release()"),(0,me.image_destroy)(C),wn(),e=0;e<jt.length;e++)(0,Ot.player_destroy)(jt[e]);for((0,he.logfile_message)("editor_release()"),_t(),function(){var e;for(e=0;e<a;e++)Me[e]=He(Me[e]);a=0}(),(0,ve.input_destroy)(c),(0,ve.input_destroy)(s),(0,ve.input_destroy)(_),(0,Re.font_destroy)(p),(0,Re.font_destroy)(l),Ae=!1,d=2,Ge=0,(0,he.logfile_message)("editor_release() ok"),(0,we.HI)(G),(0,we.HI)(W),(0,Re.font_destroy)(K),e=0;e<jt.length;e++)(0,Re.font_destroy)(At[e]);for((0,we.HI)(ae),(0,we.HI)(ie),(0,Re.font_destroy)(oe),(0,Re.font_destroy)(ee),(0,Re.font_destroy)(te),(0,we.HI)(ne),e=0;e<3;e++)(0,Re.font_destroy)(Vt[e]),(0,we.HI)(Bt[e]);(0,Re.font_destroy)(ce),(0,Re.font_destroy)(de),(0,we.HI)(se),(0,he.logfile_message)("level_release() ok")},$t=function(){return ze()},Qt=function(){return H},Jt=function(){return A},Zt=function(e){var t;e=Math.max(0,e),(0,Ot.player_set_score)((0,Ot.player_get_score)()+e),(t=gn(Pe.Sr,(0,xe.v2d_add)(H.actor.position,(0,xe.v2d_new)(-9,0)))).set_text(t,e)},en=function(){return(0,xe.v2d_new)(O,N)},tn=function(e){T&&(0,ue.music_stop)(),R=e,(0,ue.sound_play)(R)},nn=function(e){D=(0,xe.v2d_new)(e.x,e.y)},an=function(e){var t;if(!U){for(U=!0,Y=(0,ye.timer_get_ticks)(),Ft=10*(0,Ot.player_get_rings)(),Z+=Ft,t=0;t<jt.length;t++)jt[t]&&jt[t].got_glasses&&on(5e3);for((0,Ot.player_set_score)((0,Ot.player_get_score)()+Z),t=0;t<jt.length;t++)jt[t]&&((0,ve.input_ignore)(jt[t].actor.input),jt[t].spin_dash=!1);for(Jn(e),_n(),(ee=(0,Re.font_set_text)(ee,"TEAM SONIC")).position=(0,xe.v2d_new)(-500,20),(te=(0,Re.font_set_text)(te,"GOT THROUGH")).position=(0,xe.v2d_new)(-500,46),(ne=(0,we.TK)(ne,(0,be.sprite_get_animation)("SD_LEVELACT",S-1))).position=(0,xe.v2d_new)(820,25),t=0;t<3;t++)Bt[t].position=(0,xe.v2d_new)(-500,120+20*t),Vt[t].position=(0,xe.v2d_new)(820,120+20*t);Bt[0]=(0,we.TK)(Bt[0],(0,be.sprite_get_animation)("SD_RINGBONUS",0)),Bt[1]=(0,we.TK)(Bt[1],(0,be.sprite_get_animation)("SD_SECRETBONUS",0)),Bt[2]=(0,we.TK)(Bt[2],(0,be.sprite_get_animation)("SD_TOTAL",0))}},on=function(e){J+=e,Z+=e},rn=function(e,t){(!re||(0,Re.font_get_text)(ce)||(0,Re.font_get_text)(de))&&(re=!0,_e=(0,ye.timer_get_ticks)(),(0,Re.font_set_text)(ce,e),(0,Re.font_set_text)(de,t),(0,Re.font_set_width)(de,260))},_n=function(){re=!1},sn=function(){return B},cn=function(){var e,t;for(e=Mt;e;e=e.next)(t=e.data)&&(t.state=1)},dn=function(e,t,n,a){!function(e,t,n,a){ke.is_locked=!0,De(e,t,n,a)}(e+Ie.VIDEO_SCREEN_W/2,t+Ie.VIDEO_SCREEN_H/2,n-Ie.VIDEO_SCREEN_W/2,a-Ie.VIDEO_SCREEN_H/2)},ln=function(){ke.is_locked=!1},pn=function(){null!=T&&(0,ue.music_stop)()},un=function(){return k},fn=function(e,t){var n,a;for((a={}).data={},a.data.brick_ref=(0,Se.m$)(e),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(t.x,10),a.data.y=a.data.sy=parseInt(t.y,10),a.data.enabled=!0,a.data.state=Se.Uz,a.data.value=[],n=0;n<Se.Vd;n++)a.data.value[n]=0;return Wn(a),a.data},gn=function(e,t){var n={};return n.data=(0,Pe._y)(e),n.data&&(n.data.actor.spawn_point=(0,xe.v2d_new)(t.x,t.y),n.data.actor.position=(0,xe.v2d_new)(t.x,t.y)),n.next=Pt,Pt=n,n.data},mn=function(e,t){var n,a=(0,xe.v2d_new)(t.x,t.y);return(n={}).data=(0,Te.enemy_create)(e),n.data.actor.spawn_point=(0,xe.v2d_new)(a.x,a.y),n.data.actor.position=(0,xe.v2d_new)(a.x,a.y),n.next=Mt,Mt=n,n.data},vn=function(e,t,n,a){var i,o;ze()?(0,me.image_destroy)(e):((i={}).image=e,i.position=t,i.speed=n,i.destroy_on_brick=a,(o={}).data=i,o.next=Ct,Ct=o)},hn=function(e,t){var n,a,i,o,r,_;return e?(n=e.value[0],e.brick_ref.behavior===Se.w6?(a=e.brick_ref.behavior_arg[0],i=e.brick_ref.behavior_arg[1],o=e.brick_ref.behavior_arg[2]*(2*ge.PI),r=e.brick_ref.behavior_arg[3]*(2*ge.PI),_=e.brick_ref.behavior_arg[4]*ge.PI/180,(0,xe.v2d_new)(-a*o*Math.sin(o*n+_),i*r*Math.cos(r*n+_))):(0,xe.v2d_new)(0,0)):(0,xe.v2d_new)(0,0)},bn=function(e){return gn(Pe.NE,e)},yn=function(){On()},En=function(){return Rt},xn=function(e){return Sn(e)},In=function(){Fn()},wn=function(){var e,t,n,a,i,o;for((0,he.logfile_message)("level_unload()"),T.pause(),(0,he.logfile_message)("releasing brick list..."),e=Rt;e;e=t)t=e.next,e.data=null,e=null;for(Rt=null,(0,he.logfile_message)("releasing item list..."),n=Pt;n;n=a)a=n.next,(0,Pe.tl)(n.data),n=null;for(Pt=null,(0,he.logfile_message)("releasing enemy list..."),i=Mt;i;i=o)o=i.next,(0,Te.enemy_destroy)(i.data),i=null;Mt=null,ea()&&((0,he.logfile_message)("releasing the boss..."),function(e){(0,we.HI)(e.actor)}(F),F=null),(0,he.logfile_message)("unloading the brickset..."),(0,he.logfile_message)("unloading the background..."),(0,he.logfile_message)("level_unload() ok")},Sn=function(e){var t;for(t=0;t<(0,Se.Qb)();t++)if(e.brick_ref==(0,Se.m$)(t))return t;return-1},kn=function(){var e=D;qt(),Yt(),D=e},On=function(){var e,t,n,a,i={};for(t=e=Gn();t;t=t.next)t.data&&t.data.brick_ref.zindex<.5&&(t.data=(0,Se.bM)(t.data),i=(0,Se.b9)(t.data),(0,Ie.video_get_backbuffer)().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,t.data.x-(parseInt(Ne().x,10)-Ie.VIDEO_SCREEN_W/2),t.data.y-(parseInt(Ne().y,10)-Ie.VIDEO_SCREEN_H/2),i.width*Ie.VIDEO_SCALE,i.height*Ie.VIDEO_SCALE));for(Nn(!0),t=e;t;t=t.next)if(t.data){var o=t.data.brick_ref;Math.abs(o.zindex-.5)<ge.EPSILON&&o.property!=Se.Pi&&(t.data=(0,Se.bM)(t.data),i=(0,Se.b9)(t.data),(0,Ie.video_get_backbuffer)().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,t.data.x-(parseInt(Ne().x,10)-Ie.VIDEO_SCREEN_W/2),t.data.y-(parseInt(Ne().y,10)-Ie.VIDEO_SCREEN_H/2),i.width*Ie.VIDEO_SCALE,i.height*Ie.VIDEO_SCALE))}for(n=Pt;n;n=n.next)n.data&&n.data.bring_to_back&&(0,Pe.tx)(n.data,Ne());for(t=e;t;t=t.next)if(t.data){var r=t.data.brick_ref;Math.abs(r.zindex-.5)<ge.EPSILON&&r.property==Se.Pi&&(t.data=(0,Se.bM)(t.data),i=(0,Se.b9)(t.data),(0,Ie.video_get_backbuffer)().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,t.data.x-(parseInt(Ne().x,10)-Ie.VIDEO_SCREEN_W/2),t.data.y-(parseInt(Ne().y,10)-Ie.VIDEO_SCREEN_H/2),i.width*Ie.VIDEO_SCALE,i.height*Ie.VIDEO_SCALE))}for(ea()&&!F.bring_to_front&&It(F,Ne()),a=Mt;a;a=a.next)(0,Te.enemy_render)(a.data,Ne());for(Nn(!1),ea()&&F.bring_to_front&&It(F,Ne()),n=Pt;n;n=n.next)n.data&&(0,Pe.tx)(n.data,Ne());for(Mn(),t=e;t;t=t.next)t.data&&t.data.brick_ref.zindex>.5&&(t.data=(0,Se.bM)(t.data),i=(0,Se.b9)(t.data),(0,Ie.video_get_backbuffer)().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,t.data.x-(parseInt(Ne().x,10)-Ie.VIDEO_SCREEN_W/2),t.data.y-(parseInt(Ne().y,10)-Ie.VIDEO_SCREEN_H/2),i.width*Ie.VIDEO_SCALE,i.height*Ie.VIDEO_SCALE));Kn(e)},Nn=function(e){if(H){var t;for(t=jt.length-1;t>=0;t--)jt[t]!=H&&!!jt[t].bring_to_back==e&&(0,Ot.player_render)(jt[t],Ne());!!H.bring_to_back==e&&(0,Ot.player_render)(H,Ne())}},Ln=function(){var e,t=(0,xe.v2d_new)(Ie.VIDEO_SCREEN_W/2,Ie.VIDEO_SCREEN_H/2);if(U)for((0,we.z7)(ne,t),(0,Re.font_render)(ee,t),(0,Re.font_render)(te,t),e=0;e<3;e++)(0,we.z7)(Bt[e],t),(0,Re.font_render)(Vt[e],t);else{for((0,we.z7)(W,t),(0,we.z7)(G,t),(0,Re.font_render)(K,t),e=0;e<3;e++)(0,Re.font_render)(At[e],t);Dn()}L<2.5&&(0,Ie.video_clearDisplay)("rgb(0,0,0)"),(0,we.z7)(ae,t),(0,we.z7)(ie,t),(0,Re.font_render)(oe,t),Tn(t)},Dn=function(){var e,t=[],n=[],a=0,i=.001*(0,ye.timer_get_ticks)();for(e=0;e<10;e++)n[e]=!0;if(H){switch(H.got_glasses&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",6),0)),H.shield_type){case Ot.SH_SHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",7),0);break;case Ot.SH_FIRESHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",11),0);break;case Ot.SH_THUNDERSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",12),0);break;case Ot.SH_WATERSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",13),0);break;case Ot.SH_ACIDSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",14),0);break;case Ot.SH_WINDSHIELD:t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",15),0)}if(H.invincible&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",4),0),H.invtimer>=.75*Ot.PLAYER_MAX_INVINCIBILITY)){var o=(Ot.PLAYER_MAX_INVINCIBILITY-H.invtimer)/(.25*Ot.PLAYER_MAX_INVINCIBILITY);n[a-1]=Math.sin(.5*ge.PI*i/(o+.1))>=0}if(H.got_speedshoes&&(t[a++]=(0,be.sprite_get_image)((0,be.sprite_get_animation)("SD_ICON",5),0),H.speedshoes_timer>=.75*Ot.PLAYER_MAX_SPEEDSHOES)){var r=(Ot.PLAYER_MAX_SPEEDSHOES-H.speedshoes_timer)/(.25*Ot.PLAYER_MAX_SPEEDSHOES);n[a-1]=Math.sin(.5*ge.PI*i/(r+.1))>=0}}for(e=0;e<a;e++)n[e]&&(0,me.image_blit)(t[e].data,(0,Ie.video_get_backbuffer)(),t[e].sx,t[e].sy,Ie.VIDEO_SCREEN_W-(t[e].width+5)*(e+1),5,t[e].swidth,t[e].sheight)},Tn=function(e){(0,we.z7)(se,e),(0,Re.font_render)(ce,e),(0,Re.font_render)(de,e)},Rn=function(){Ct=null},Pn=function(e){var t,n,a,i,o,r=(0,ye.timer_get_delta)(),_=k,s=null;for(a=Ct;a;a=i)if(o=a.data){if(n=Zn(o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height,Dt),t=!1,o.destroy_on_brick&&n&&o.speed.y>0){var c=[o.position.x,o.position.y,o.position.x+o.image.width,o.position.y+o.image.height],d=void 0;for(d=e;d&&!t;d=d.next){var l=d.data;if(l&&l.brick_ref.property==Se.Pi&&0==l.brick_ref.angle){var p=[l.x,l.y,l.x+l.brick_ref.image.width,l.y+l.brick_ref.image.height];(0,Ee.bounding_box)(c,p)&&(t=!0)}}}!n||t?s?s.next=i:Ct=i:(o.position.x+=o.speed.x*r,o.position.y+=o.speed.y*r+.5*_*(r*r),o.speed.y+=_*r,s=a)}},Mn=function(){var e,t,n=(0,xe.v2d_new)(Ne().x-Ie.VIDEO_SCREEN_W/2,Ne().y-Ie.VIDEO_SCREEN_H/2);for(e=Ct;e;e=e.next)(t=e.data)&&(0,me.image_draw)(t.image,(0,Ie.video_get_backbuffer)(),parseInt(t.position.x-n.x,10),parseInt(t.position.y-n.y,10),ge.IF_NONE)},Cn=function(){null==T||U||P||(0,ue.music_is_playing)()||(R=null,(0,ue.music_play)(T,!0))},jn=function(){if(se){var e=(0,ye.timer_get_delta)(),t=(0,ye.timer_get_ticks)();if(re){if(t>=_e+7e3)return void(re=!1);se.position.x=(Ie.VIDEO_SCREEN_W-(0,we.Ix)(se).width)/2,se.position.y=Math.max(se.position.y-100*e,Ie.VIDEO_SCREEN_H-1.3*(0,we.Ix)(se).height)}else se.position.y=Math.min(se.position.y+100*e,Ie.VIDEO_SCREEN_H);ce.position=(0,xe.v2d_add)(se.position,(0,xe.v2d_new)(2,10)),de.position=(0,xe.v2d_add)(se.position,(0,xe.v2d_new)(2,23))}},Hn=function(){if(H&&H.actor){var e,t=[],n=[];if(!(L<2))for(t[0]=H.actor.position.x,t[1]=H.actor.position.y,t[2]=t[0]+(0,we.Ix)(H.actor).width,t[3]=t[1]+(0,we.Ix)(H.actor).height,e=0;e<le;e++)if(!Wt[e].disabled&&(n[0]=Wt[e].rect_x,n[1]=Wt[e].rect_y,n[2]=n[0]+Wt[e].rect_w,n[3]=n[1]+Wt[e].rect_h,(0,Ee.bounding_box)(t,n))){Wt[e].disabled=!0,rn(Wt[e].title,Wt[e].message);break}}},An=function(e){H.spin_dash=H.braking=!1,jt[A=e]&&(H=jt[A],Jn(H.actor),(0,ve.input_restore)(H.actor.input))},Fn=function(){var e,t;for(e=0;e<jt.length;e++)t=parseInt(D.x,10)<=O/2?2-e:e,jt[e].actor.mirror=parseInt(D.x,10)<=O/2?ge.IF_NONE:ge.IF_HFLIP,jt[e].actor.spawn_point.x=jt[e].actor.position.x=D.x+15*t,jt[e].actor.spawn_point.y=jt[e].actor.position.y=D.y},Vn=function(e,t,n,a){var i,o={},r={data:null};for(r.image=(0,me.image_create)(e,t),r.angle=a,r.property=Se.Pi,r.behavior=Se.Nf,r.zindex=.5,r.behavior_arg=[],i=0;i<Se.kJ;i++)r.behavior_arg[i]=0;for(o.brick_ref=r,o.animation_frame=0,o.enabled=!0,o.x=o.sx=parseInt(n.x,10),o.y=o.sy=parseInt(n.y,10),o.value=[],i=0;i<Se.Vd;i++)o.value[i]=0;return o},Bn=function(e,t){var n=e.brick_ref,a=t.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var i=[0,100,50];return i[n.property]-i[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:e.sy-t.sy},Wn=function(e){var t;if(Rt)if(Bn(e.data,Rt.data)>=0)e.next=Rt,Rt=e;else{for(t=Rt;t.next&&Bn(t.next.data,e.data)>0;)t=t.next;e.next=t.next,t.next=e}else e.next=null,Rt=e},Gn=function(){var e,t,n,a,i,o,r=[];for(e=Rt;e;e=e.next)e.data&&e.data.brick_ref&&e.data.brick_ref.image&&(n=Math.min(e.data.x,e.data.sx),a=Math.min(e.data.y,e.data.sy),i=e.data.brick_ref.image.width,o=e.data.brick_ref.image.height,(Zn(n,a,i,o,2*Dt)||e.data.brick_ref.behavior==Se.w6)&&((t={}).data=e.data,t.next=r,r=t));return r},Kn=function(e){for(var t;e;)t=e.next,e=null,e=t},Un=function(){var e,t,n,a,i,o,r,_=null;for(e=Pt;e;e=e.next)e.data&&(r=(0,we.Ix)(e.data.actor))&&(n=parseInt(e.data.actor.position.x,10),a=parseInt(e.data.actor.position.y,10),i=r.width,o=r.height,Zn(n,a,i,o,Dt)&&((t={}).data=e.data,t.next=_,_=t));return _},Yn=function(e){for(var t;e;)t=e.next,e=null,e=t},zn=function(){var e,t;if(Pt)for(Pt.data&&Pt.data.state==Pe.rJ&&(t=Pt.next,(0,Pe.tl)(Pt.data),Pt=t),e=Pt;e&&e.next;e=e.next)e.next&&e.next.data&&e.next.data.state==Pe.rJ&&(t=e.next,e.next=t.next,(0,Pe.tl)(t.data),t=null)},Xn=function(){var e,t;if(Mt)for(Mt&&Mt.data&&Mt.data.state==Te.ES_DEAD&&(t=Mt.next,(0,Te.enemy_destroy)(Mt.data),Mt=null,Mt=t),e=Mt;e&&e.next;e=e.next)e&&e.next&&e.next.data&&e.next.data.state==Te.ES_DEAD&&(t=e.next,e.next=t.next,(0,Te.enemy_destroy)(t.data),t=null)},qn=function(){var e,t;if(Rt)for(Rt.data&&Rt.data.state==Se.Dx&&(t=Rt.next,Rt.data=null,Rt=null,Rt=t),e=Rt;e&&e.next;e=e.next)e.next.data.state==Se.Dx&&(t=e.next,e.next=t.next,t.data=null,t=null)},$n=function(e){(0,me.image_destroy)(e.brick_ref.image),e.brick_ref=null,e=null},Qn=function(e){var t,n,a,i,o,r;e&&(e.value[0]+=(0,ye.timer_get_delta)(),t=e.value[0],e.brick_ref.behavior===Se.w6)&&(n=e.brick_ref.behavior_arg[0],a=e.brick_ref.behavior_arg[1],i=e.brick_ref.behavior_arg[2]*(2*ge.PI),o=e.brick_ref.behavior_arg[3]*(2*ge.PI),r=e.brick_ref.behavior_arg[4]*ge.PI/180,e.x=e.sx+Math.round(n*Math.cos(i*t+r)),e.y=e.sy+Math.round(a*Math.sin(o*t+r)))},Jn=function(e){Ht={position:{x:e.position.x,y:e.position.y}}},Zn=function(e,t,n,a,i){var o=Ne(),r=[e,t,e+n,t+a],_=[o.x-Ie.VIDEO_SCREEN_W/2-i,o.y-Ie.VIDEO_SCREEN_H/2-i,o.x+Ie.VIDEO_SCREEN_W/2+i,o.y+Ie.VIDEO_SCREEN_H/2+i];return(0,Ee.bounding_box)(r,_)},ea=function(){return null!=F},ta=function(e){return y="Untitled",E="",x="",I="",w="",D=(0,xe.v2d_new)(0,0),le=0,F=null,S=1,new Promise((function(t,n){(0,he.logfile_message)('level_load("%s")',e),(0,bt.resourcemanager_getJsonFile)(e).then(na).then((function(){T=(0,ue.music_load)(E),function(){var e,t,n;for(e=t=-ge.INFINITY,n=Rt;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(e=Math.max(e,n.data.sx+(0,Se.b9)(n.data).width),t=Math.max(t,n.data.sy+(0,Se.b9)(n.data).height));O=Math.max(e,Ie.VIDEO_SCREEN_W),N=Math.max(t,Ie.VIDEO_SCREEN_H)}(),(0,he.logfile_message)("level_load() ok"),t()}))}))},na=function(e){var t;for(x=e.theme,I=e.bgtheme,w=e.grouptheme,E=e.music,y=e.name,e.author,e.version,e.requires,S=e.act,D=e.spawn_point,e.readonly,e.boss&&(F=function(e,t,n,a,i,o){var r,_,s={};for(s.type=e,s.state=0,s.rect_x=n,s.rect_y=a,s.rect_w=i,s.rect_h=o,s.value=[],r=0;r<10;r++)s.value[r]=0;switch(s.bring_to_front=!1,s.actor=_=(0,we.HN)(),_.spawn_point=(0,xe.v2d_new)(t.x,t.y),_.position=(0,xe.v2d_new)(t.x,t.y),_.input=(0,ve.input_create_computer)(),e){case 0:case 2:(0,we.TK)(_,(0,be.sprite_get_animation)("SD_SIMPLEBOSS",0)),s.initial_hp=s.hp=3,s.direction=3,_.maxspeed=100,_.acceleration=100;break;case 1:case 3:(0,we.TK)(_,(0,be.sprite_get_animation)("SD_MECHASHADOW",0)),s.initial_hp=s.hp=10,s.direction=3,_.maxspeed=100,_.acceleration=100}return s}(e.boss.id,(0,xe.v2d_new)(e.boss.x,e.boss.y),e.boss.rx,e.boss.ry,e.boss.rw,e.boss.rh),console.log("BOSS",F)),t=0;t<e.dialogbox.length;t++){var n={disabled:!1};n.rect_x=e.dialogbox[t].xpos,n.rect_y=e.dialogbox[t].ypos,n.rect_w=e.dialogbox[t].width,n.rect_h=e.dialogbox[t].height,n.title=(0,ht.lang_get)(e.dialogbox[t].title),n.message=(0,ht.lang_get)(e.dialogbox[t].message),Wt.push(n),le=Wt.length}for(t=0;t<e.enemylist.length;t++)mn(e.enemylist[t].id,(0,xe.v2d_new)(e.enemylist[t].xpos,e.enemylist[t].ypos));return new Promise((function(n,a){(0,Se.mT)(e.theme).then((function(a){for(var i=0;i<e.bricklist.length;i++)fn(e.bricklist[i].id,(0,xe.v2d_new)(e.bricklist[i].xpos,e.bricklist[i].ypos));(0,xt.vm)(e.bgtheme).then((function(a){for(j=a,t=0;t<e.itemlist.length;t++)Pt[t]=gn(e.itemlist[t].id,(0,xe.v2d_new)(e.itemlist[t].xpos,e.itemlist[t].ypos));n()}))}))}))}},344:(e,t,n)=>{n.r(t),n.d(t,{menu_init:()=>Y,menu_release:()=>q,menu_render:()=>X,menu_update:()=>z});var a,i,o,r,_,s,c,d,l,p,u,f,g,m,v,h,b,y,E,x,I,w,S=n(943),k=n(93),O=n(667),N=n(532),L=n(386),D=n(878),T=n(689),R=n(642),P=n(709),M=n(931),C=n(163),j=n(38),H=n(470),A=n(880),F=n(120),V=n(176),B=n(51),W=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],G=3,K=[],U=[],Y=function(){var e,t;for(b=!1,a=0,_=.001*(0,C.timer_get_ticks)(),s=!1,o=null,i=(0,T.input_create_user)(),(0,T.input_ignore)(i),Q(),w=(0,M.music_load)("data/music/title.mp4"),(0,M.music_play)(w,!0),r=(0,B.vm)("data/themes/menu.bg.json").then((function(e){r=e,(0,R.video_fadefx_in)((0,P.image_rgb)(0,0,0),1)})),u=!0,f=(0,F.HN)(),(f=(0,F.TK)(f,(0,A.sprite_get_animation)("SD_TITLESURGE",0))).position.x=(R.VIDEO_SCREEN_W-(0,F.Ix)(f).width)/2+5,f.position.y=-15,g=(0,F.HN)(),(g=(0,F.TK)(g,(0,A.sprite_get_animation)("SD_TITLEBG",0))).position.x=(R.VIDEO_SCREEN_W-(0,F.Ix)(g).width)/2,g.position.y=f.position.y+25,m=(0,F.HN)(),(m=(0,F.TK)(m,(0,A.sprite_get_animation)("SD_TITLEGAMENAME",0))).position.x=(R.VIDEO_SCREEN_W-(0,F.Ix)(m).width)/2,m.position.y=f.position.y+(0,F.Ix)(f).height-9,(v=(0,V.font_create)(8)).position=(0,D.v2d_new)(3,R.VIDEO_SCREEN_H-12),(0,V.font_set_text)(v,"%s",L.GAME_WEBSITE),(h=(0,V.font_create)(0)).position=(0,D.v2d_new)(R.VIDEO_SCREEN_W-75,3),(0,V.font_set_text)(h,"V%d.%d.%d",L.GAME_VERSION,L.GAME_SUB_VERSION,L.GAME_WIP_VERSION),d=0,p=(0,F.HN)(),p=(0,F.TK)(p,(0,A.sprite_get_animation)("SD_TITLEFOOT",0)),(c=[])[0]=(0,j.lang_getstring)("MENU_1PGAME"),c[1]=(0,j.lang_getstring)("MENU_TUTORIAL"),c[2]=(0,j.lang_getstring)("MENU_CUSTOMQUESTS"),c[3]=(0,j.lang_getstring)("MENU_OPTIONS"),G=c.length,l=[],e=0;e<2;e++)for(t=0;t<G;t++)l[t]||(l[t]=[]),l[t][e]=(0,V.font_create)(e),l[t][e].position=(0,D.v2d_new)(R.VIDEO_SCREEN_W/2-(0,F.Ix)(g).width/5,m.position.y+65+10*t),(0,V.font_set_text)(l[t][e],c[t]);K[0]=(0,V.font_create)(8),K[0].position=(0,D.v2d_new)(5,3),K[1]=(0,V.font_create)(8),K[1].position=(0,D.v2d_new)(5,R.VIDEO_SCREEN_H-13),(y=(0,V.font_create)(8)).position=(0,D.v2d_new)(5,170),(0,R.video_fadefx_in)((0,P.image_rgb)(0,0,0),1.5)},z=function(){var e,t=.001*(0,C.timer_get_ticks)();if(null!=o&&(0,R.video_fadefx_over)())return(0,O.scenestack_pop)(),void(0,O.scenestack_push)(o);switch(t<=_+2?(0,T.input_ignore)(i):s||((0,T.input_restore)(i),s=!0),(0,B.A4)(r),a){case 0:u&&(0,F.$C)(f)&&(u=!1,f=(0,F.TK)(f,(0,A.sprite_get_animation)("SD_TITLESURGE",1)),(0,T.input_restore)(i)),m.visible=!u,p.position.x=l[d][0].position.x-20+3*Math.cos(2*L.PI*t),p.position.y=l[d][0].position.y,(0,T.input_button_pressed)(i,T.IB_UP)&&((0,M.sound_play)((0,H.soundfactory_get)("choose")),d--),(0,T.input_button_pressed)(i,T.IB_DOWN)&&((0,M.sound_play)((0,H.soundfactory_get)("choose")),d++),d=(d%G+G)%G,((0,T.input_button_pressed)(i,T.IB_FIRE1)||(0,T.input_button_pressed)(i,T.IB_FIRE3))&&((0,M.sound_play)((0,H.soundfactory_get)("select")),$(d));break;case 1:for((0,T.input_button_pressed)(i,T.IB_FIRE4)&&((0,M.sound_play)((0,H.soundfactory_get)("return")),a=0),e=0;e<x;e++)U[e].position=(0,D.v2d_new)(30,20+e%14*10),U[e].visible=J(e)==J(E);if(p.position.x=10,p.position.y=U[E].position.y,(0,T.input_button_pressed)(i,T.IB_UP)&&((0,M.sound_play)((0,H.soundfactory_get)("choose")),E--),(0,T.input_button_pressed)(i,T.IB_DOWN)&&((0,M.sound_play)((0,H.soundfactory_get)("choose")),E++),E=(E%x+x)%x,(0,V.font_set_text)(K[0],(0,j.lang_get)("MENU_CQ_SELECT"),J(E),Z()),(0,V.font_set_text)(K[1],(0,j.lang_get)("MENU_CQ_BACK")),(0,V.font_set_text)(y,(0,j.lang_get)("MENU_CQ_INFO"),I[E].version,I[E].name,I[E].author,I[E].description),(0,T.input_button_pressed)(i,T.IB_FIRE1)||(0,T.input_button_pressed)(i,T.IB_FIRE3))return(0,M.sound_play)((0,H.soundfactory_get)("select")),void ee(I[E])}},X=function(){var e,t=(0,D.v2d_new)(R.VIDEO_SCREEN_W/2,R.VIDEO_SCREEN_H/2);if((0,R.video_clearDisplay)(),!b||!(0,R.video_fadefx_over)())switch((0,B.mw)(r,t),(0,B.Ed)(r,t),a){case 0:for(e=0;e<G;e++)(0,V.font_render)(l[e][e==d?1:0],t);(0,F.z7)(p,t),(0,V.font_render)(v,t),(0,V.font_render)(h,t),(0,F.z7)(g,t),u&&(0,R.video_clearDisplay)(),(0,F.z7)(f,t),(0,F.z7)(m,t);break;case 1:var n=I[E].image;for((0,V.font_render)(y,t),(0,P.image_blit)(n,(0,R.video_get_backbuffer)(),0,0,R.VIDEO_SCREEN_W-n.width-25,parseInt(U[0].position.y,10),n.width,n.height),(0,V.font_render)(K[0],t),(0,V.font_render)(K[1],t),e=0;e<x;e++)(0,V.font_render)(U[e],t);(0,F.z7)(p,t)}},q=function(){var e,t;for(w.pause(),(0,V.font_destroy)(v),(0,V.font_destroy)(h),e=0;e<2;e++)for(t=0;t<G;t++)(0,V.font_destroy)(l[t][e]);(0,F.HI)(g),(0,F.HI)(m),(0,F.HI)(f),(0,F.HI)(p),(0,T.input_destroy)(i)},$=function(e){var t=W[0];switch(e){case 0:return void(0,k.CS)(t).then((function(e){ee(e)}));case 1:return void(0,k.CS)("data/quests/tutorial.json").then((function(e){ee(e)}));case 2:a=1,E=0;break;case 3:return o=(0,N.storyboard_get_scene)(N.SCENE_OPTIONS),void(0,R.video_fadefx_out)((0,P.image_rgb)(0,0,0),.5)}},Q=function(){var e;for(x=W.length,I=[],e=0;e<x;e++)!function(t){(0,k.CS)(W[e]).then((function(e){U[t]=(0,V.font_create)(8),I[t]=e,(0,V.font_set_text)(U[t],e.name)}))}(e)},J=function(e){return Math.floor(e/14+1)},Z=function(){return Math.floor(x/14+(x%14==0?0:1))},ee=function(e){(0,S.quest_run)(e,!1),o=(0,N.storyboard_get_scene)(N.SCENE_QUEST),(0,T.input_ignore)(i),(0,R.video_fadefx_out)((0,P.image_rgb)(0,0,0),.5)}},494:(e,t,n)=>{n.r(t),n.d(t,{options_init:()=>A,options_release:()=>B,options_render:()=>V,options_update:()=>F});var a,i,o,r,_,s,c,d,l,p,u=n(878),f=n(176),g=function e(t){var n;if(t)for(t.init(t),n=0;n<t.child_count;n++)e(t.child[n])},m=function e(t){var n;if(t){for(n=0;n<t.child_count;n++)e(t.child[n]);t.update(t)}},v=function e(t,n){var a;if(t){for(a=0;a<t.child_count;a++)e(t.child[a],n);t.render(t,n)}},h=function e(t){var n,a=0;if(t){for(n=0;n<t.child_count;n++)a+=e(t.child[n]);return 1+a}return 0},b=function(e,t,n,a){var i={};return i.init=e,i.release=t,i.update=n,i.render=a,i.font=null,i.data=null,i.parent=null,i.child_count=0,i.child=[],i},y=function(e,t){e.child_count<10&&(e.child[e.child_count++]=t,t.parent=e)},E=function(e){if(e.font=(0,f.font_create)(8),(0,f.font_set_text)(e.font,"LABEL"),null!=e.parent){var t,n,a=0,i=null!=e.parent.font?(0,f.font_get_charsize)(e.parent.font):(0,u.v2d_new)(12,12);for(t=0;t<e.parent.child_count&&e.parent.child[t]!=e;t++);for(n=0;n<t;n++)a+=h(e.parent.child[n])-1;e.font.position={x:e.parent.font.position.x,y:e.parent.font.position.y},e.font.position.x+=3*i.x,e.font.position.y+=(1+a+t)*i.y*2}},x=function(e){(0,f.font_destroy)(e.font)},I=function(e,t){(0,f.font_render)(e.font,t)},w=n(386),S=n(667),k=n(532),O=n(286),N=n(642),L=n(709),D=n(931),T=n(470),R=n(38),P=n(689),M=n(880),C=n(163),j=n(120),H=n(51),A=function(){l=0,a=!1,c=0,_=(0,P.input_create_user)(),s=null,i=!0,o=(0,f.font_create)(4),(0,f.font_set_text)(o,(0,R.lang_get)("OPTIONS_TITLE")),o.position.x=N.VIDEO_SCREEN_W/2-100,o.position.y=10,d=(0,H.vm)("data/themes/options.bg.json").then((function(e){d=e})),r=(0,j.HN)(),(0,j.TK)(r,(0,M.sprite_get_animation)("SD_TITLEFOOT",0)),r.position=(0,u.v2d_new)(-50,-50),p=De(),g(p)},F=function(){var e=(0,C.timer_get_delta)();if(c+=e,(0,f.font_set_text)(o,(0,R.lang_get)("OPTIONS_TITLE")),i&&((0,N.video_fadefx_in)((0,L.image_rgb)(0,0,0),1),i=!1),(0,H.A4)(d),a||null!=s||(0,N.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_DOWN)&&(l=(l+1)%5,(0,D.sound_play)((0,T.soundfactory_get)("choose"))),(0,P.input_button_pressed)(_,P.IB_UP)&&(l=((l-1)%5+5)%5,(0,D.sound_play)((0,T.soundfactory_get)("choose"))),(0,P.input_button_pressed)(_,P.IB_FIRE4)&&((0,D.sound_play)((0,T.soundfactory_get)("return")),a=!0)),m(p),a)(0,N.video_fadefx_is_fading)()||(0,D.music_stop)();else if(!(0,D.music_is_playing)()&&c>=.2){var t=(0,D.music_load)("data/music/options.mp4");(0,D.music_play)(t,w.INFINITY)}if(a){if((0,N.video_fadefx_over)())return W(),(0,S.scenestack_pop)(),void(0,S.scenestack_push)((0,k.storyboard_get_scene)(k.SCENE_MENU));(0,N.video_fadefx_out)((0,L.image_rgb)(0,0,0),1)}if(null!=s){if((0,N.video_fadefx_over)())return W(),(0,S.scenestack_push)(s),s=null,void(i=!0);(0,N.video_fadefx_out)((0,L.image_rgb)(0,0,0),1)}},V=function(){var e=(0,u.v2d_new)(N.VIDEO_SCREEN_W/2,N.VIDEO_SCREEN_H/2);(0,H.mw)(d,e),(0,H.Ed)(d,e),(0,f.font_render)(o,e),v(p,e),(0,j.z7)(r,e)},B=function(){(0,j.HI)(r),(0,f.font_destroy)(o),(0,P.input_destroy)(_)},W=function(){(0,O.preferences_set_video_resolution)((0,N.video_get_resolution)()),(0,O.preferences_set_fullscreen)((0,N.video_is_fullscreen)()),(0,O.preferences_set_smooth_graphics)((0,N.video_is_smooth)()),(0,O.preferences_set_show_fps)((0,N.video_is_fps_visible)())},G=function(e,t){E(e),e.data=t,(0,f.font_set_text)(e.font,(0,R.lang_get)(t))},K=function(e){e.data=null,x(e)},U=function(e){(0,f.font_set_text)(e.font,(0,R.lang_get)(e.data))},Y=function(e,t){I(e,t)},z=function(e,t,n){var a;E(e),(0,f.font_set_text)(e.font,(0,R.lang_get)(t)),e.data={},(a=e.data).option_index=n,a.lang_key=t},X=function(e){e.data=null,x(e)},q=function(e){var t=e.data;return l==t.option_index},$=function(e){var t=e.data;(0,f.font_set_text)(e.font,(0,R.lang_get)(t.lang_key)),q(e)&&((0,f.font_set_text)(e.font,"<color=ffff00>%s</color>",(0,R.lang_get)(t.lang_key)),r.position=(0,u.v2d_add)(e.font.position,(0,u.v2d_new)(3*Math.cos(2*w.PI*c)-20,0)))},Q=function(e,t){I(e,t)},J=function(e){E(e),(0,f.font_set_text)(e.font,""),e.font.position=(0,u.v2d_new)(0,25)},Z=function(e){x(e)},ee=function(e){},te=function(e,t){I(e,t)},ne=function(e){G(e,"OPTIONS_GRAPHICS")},ae=function(e){K(e)},ie=function(e){U(e)},oe=function(e,t){Y(e,t)},re=function(e){z(e,"OPTIONS_FPS",0)},_e=function(e){X(e)},se=function(e){$(e),function(e){return q(e)}(e)&&((0,N.video_fadefx_is_fading)()||(((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,D.sound_play)((0,T.soundfactory_get)("select")),(0,N.video_show_fps)(!(0,N.video_is_fps_visible)())),(0,P.input_button_pressed)(_,P.IB_RIGHT)&&(0,N.video_is_fps_visible)()&&((0,D.sound_play)((0,T.soundfactory_get)("select")),(0,N.video_show_fps)(!1)),(0,P.input_button_pressed)(_,P.IB_LEFT)&&((0,N.video_is_fps_visible)()||((0,D.sound_play)((0,T.soundfactory_get)("select")),(0,N.video_show_fps)(!0)))))},ce=function(e,t){var n,a=[];Q(e,t),(n=(0,f.font_create)(8)).position=(0,u.v2d_new)(175,e.font.position.y),a[0]=(0,R.lang_get)("OPTIONS_YES"),a[1]=(0,R.lang_get)("OPTIONS_NO"),(0,N.video_is_fps_visible)()?(0,f.font_set_text)(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):(0,f.font_set_text)(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),(0,f.font_render)(n,t),(0,f.font_destroy)(n)},de=function(e){G(e,"OPTIONS_GAME")},le=function(e){K(e)},pe=function(e){U(e)},ue=function(e,t){Y(e,t)},fe=function(e){z(e,"OPTIONS_LANGUAGE",1)},ge=function(e){X(e)},me=function(e){$(e),function(e){return q(e)}(e)&&((0,N.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,D.sound_play)((0,T.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_LANGSELECT)))},ve=function(e,t){Q(e,t)},he=function(e){z(e,"OPTIONS_STAGESELECT",2)},be=function(e){X(e)},ye=function(e){$(e),function(e){return q(e)}(e)&&((0,N.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,D.sound_play)((0,T.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_STAGESELECT)))},Ee=function(e,t){Q(e,t)},xe=function(e){z(e,"OPTIONS_CREDITS",3)},Ie=function(e){X(e)},we=function(e){$(e),function(e){return q(e)}(e)&&((0,N.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,D.sound_play)((0,T.soundfactory_get)("select")),s=(0,k.storyboard_get_scene)(k.SCENE_CREDITS)))},Se=function(e,t){Q(e,t)},ke=function(e){z(e,"OPTIONS_BACK",4)},Oe=function(e){X(e)},Ne=function(e){$(e),function(e){return q(e)}(e)&&((0,N.video_fadefx_is_fading)()||((0,P.input_button_pressed)(_,P.IB_FIRE1)||(0,P.input_button_pressed)(_,P.IB_FIRE3))&&((0,D.sound_play)((0,T.soundfactory_get)("select")),a=!0))},Le=function(e,t){Q(e,t)},De=function(){var e,t,n,a,i,o,r,_;return n=b(re,_e,se,ce),t=b(ne,ae,ie,oe),y(t,n),i=b(fe,ge,me,ve),o=b(xe,Ie,we,Se),r=b(he,be,ye,Ee),a=b(de,le,pe,ue),y(a,i),y(a,r),y(a,o),_=b(ke,Oe,Ne,Le),e=b(J,Z,ee,te),y(e,t),y(e,a),y(e,_),e}},263:(e,t,n)=>{n.r(t),n.d(t,{pause_init:()=>b,pause_release:()=>x,pause_render:()=>E,pause_update:()=>y});var a,i,o,r,_=n(458),s=n(943),c=n(386),d=n(667),l=n(532),p=n(878),u=n(642),f=n(709),g=n(689),m=n(38),v=n(880),h=n(163),b=function(){a=(0,g.input_create_user)(),i=!1,o=!1,r=0},y=function(){var e;if((0,g.input_button_pressed)(a,g.IB_FIRE4))return(0,m.lang_getstring)("CBOX_QUIT_QUESTION",e[0],sizeof(e[0])),(0,m.lang_getstring)("CBOX_QUIT_OPTION1",e[1],sizeof(e[1])),(0,m.lang_getstring)("CBOX_QUIT_OPTION2",e[2],sizeof(e[2])),(0,_.confirmbox_alert)(e[0],e[1],e[2]),void(0,d.scenestack_push)((0,l.storyboard_get_scene)(l.SCENE_CONFIRMBOX));if(1==(0,_.confirmbox_selected_option)()&&(o=!0),o)return(0,u.video_fadefx_over)()?((0,d.scenestack_pop)(),(0,d.scenestack_pop)(),void(0,s.quest_abort)()):void(0,u.video_fadefx_out)(image.rgb(0,0,0),1);if(i){if((0,g.input_button_pressed)(a,g.IB_FIRE3))return audio.music_resume(),void(0,d.scenestack_pop)()}else(0,g.input_button_up)(a,g.IB_FIRE3)&&(i=!0)},E=function(){var e=(0,v.sprite_get_image)((0,v.sprite_get_animation)("SD_PAUSE",0),0),t=1+.5*Math.abs(Math.cos(c.PI/2*r));(0,p.v2d_new)((u.VIDEO_SCREEN_W-e.width)/2-(t-1)*e.width/2,(u.VIDEO_SCREEN_H-e.height)/2-(t-1)*e.height/2),o||(r+=(0,h.timer_get_delta)())},x=function(){(0,f.image_destroy)(void 0),(0,g.input_destroy)(a)}},943:(e,t,n)=>{n.r(t),n.d(t,{QUESTVALUE_BIGRINGS:()=>I,QUESTVALUE_GLASSES:()=>w,QUESTVALUE_TOTALTIME:()=>x,quest_abort:()=>y,quest_getname:()=>E,quest_getvalue:()=>k,quest_init:()=>f,quest_release:()=>v,quest_render:()=>m,quest_run:()=>h,quest_setlevel:()=>b,quest_setvalue:()=>S,quest_update:()=>g});var a,i,o,r=n(218),_=n(667),s=n(93),c=n(954),d=n(532),l=n(898),p=n(971),u={TOTALTIME:0,BIGRINGS:0,GLASSES:0},f=function(){var e;for(o=!1,e=0;e<3;e++)u[e]=0},g=function(){return 0==a.level_count?((0,l.logfile_message)("Quest '%s' has no levels.",a.file),void game_quit()):i<a.level_count&&!o?((0,r.level_setfile)(a.level_path[i]),(0,_.scenestack_push)((0,d.storyboard_get_scene)(d.SCENE_LEVEL)),void i++):((0,_.scenestack_pop)(),void(o?(0,_.scenestack_push)((0,d.storyboard_get_scene)(d.SCENE_MENU)):a.show_ending?(0,_.scenestack_push)((0,d.storyboard_get_scene)(d.SCENE_ENDOFDEMO)):(0,_.scenestack_push)((0,d.storyboard_get_scene)(d.SCENE_QUESTOVER))))},m=function(){},v=function(){(0,s.X5)(a)},h=function(e,t){void 0===t&&(t=!1),a=e,(0,p.player_set_lives)(p.PLAYER_INITIAL_LIVES),(0,p.player_set_score)(0),(0,l.logfile_message)("Running quest %s, '%s'...",e.file,e.name),b(0)},b=function(e){i=Math.max(0,e)},y=function(){o=!0},E=function(){return"NO_QUEST_NAME"},x=0,I=0,w=0,S=function(e,t){var n=(0,c.clip)(parseInt(e,10),0,2);u[n]=t},k=function(e){var t=(0,c.clip)(parseInt(e,10),0,2);return u[t]}},692:(e,t,n)=>{n.r(t),n.d(t,{questover_init:()=>I,questover_release:()=>k,questover_render:()=>S,questover_update:()=>w});var a,i,o,r,_,s=n(943),c=n(667),d=n(532),l=n(878),p=n(386),u=n(642),f=n(709),g=n(880),m=n(931),v=n(689),h=n(38),b=n(163),y=n(120),E=n(176),x=n(971),I=function(){(0,b.timer_get_ticks)(),_=!1,(a=(0,E.font_create)(8)).position=(0,l.v2d_new)(5,35),i=(0,E.font_create)(4),(0,E.font_set_text)(i,(0,h.lang_get)("QUESTCLEARED_TITLE")),i.position=(0,l.v2d_new)((u.VIDEO_SCREEN_W,parseInt((0,E.font_get_charsize)(i).x*(0,E.font_get_text)(i)).length,10),5),o=(0,y.HN)(),(0,y.TK)(o,(0,g.sprite_get_animation)("SD_SONIC",24)),o.position=(0,l.v2d_new)(20,150),(0,m.music_play)((0,m.music_load)("data/music/invincible.mp4"),0),r=(0,v.input_create_user)(),(0,u.video_fadefx_in)((0,f.image_rgb)(0,0,0),2)},w=function(){var e=(0,s.quest_getname)(),t=(0,x.player_get_score)(),n=(0,s.quest_getvalue)("QUESTVALUE_TOTALTIME")/3600,i=parseInt((0,s.quest_getvalue)("QUESTVALUE_TOTALTIME")/60%60,10),o=parseInt((0,s.quest_getvalue)("QUESTVALUE_TOTALTIME")%60,10),l=(0,s.quest_getvalue)("QUESTVALUE_GLASSES"),g=(0,s.quest_getvalue)("QUESTVALUE_BIGRINGS");if((0,b.timer_get_ticks)(),(0,E.font_set_text)(a,(0,h.lang_get)("QUESTCLEARED_TEXT"),e,t,n,i,o,l,g,p.GAME_TITLE,p.GAME_WEBSITE),(0,v.input_button_pressed)(r,v.IB_FIRE1)&&(_=!0),_){if((0,u.video_fadefx_over)())return(0,c.scenestack_pop)(),void(0,c.scenestack_push)((0,d.storyboard_get_scene)(d.SCENE_MENU));(0,u.video_fadefx_out)((0,f.image_rgb)(0,0,0),2)}},S=function(){var e=(0,l.v2d_new)(u.VIDEO_SCREEN_W/2,u.VIDEO_SCREEN_H/2);(0,u.video_clearDisplay)(),(0,E.font_render)(i,e),(0,E.font_render)(a,e),(0,y.z7)(o,e)},k=function(){(0,v.input_destroy)(r),(0,y.HI)(o),(0,E.font_destroy)(i),(0,E.font_destroy)(a)}},223:(e,t,n)=>{n.r(t),n.d(t,{stageselect_init:()=>H,stageselect_release:()=>V,stageselect_render:()=>F,stageselect_update:()=>A});var a,i,o,r,_,s,c,d,l,p=n(218),u=n(667),f=n(532),g=n(878),m=n(386),v=n(898),h=n(642),b=n(709),y=n(931),E=n(38),x=n(689),I=n(880),w=n(450),S=n(163),k=n(470),O=n(176),N=n(120),L=n(971),D=n(51),T=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],R=1,P=[],M=0,C=0,j=[],H=function(){C=0,c=0,l=0,s=(0,x.input_create_user)(),i=(0,O.font_create)(4),(0,O.font_set_text)(i,(0,E.lang_get)("STAGESELECT_TITLE")),i.position.x=(h.VIDEO_SCREEN_W-(0,O.font_get_text)(i).length*(0,O.font_get_charsize)(i).x)/2-150,i.position.y=10,o=(0,O.font_create)(8),(0,O.font_set_text)(o,(0,E.lang_get)("STAGESELECT_MSG")),o.position.x=10,o.position.y=h.VIDEO_SCREEN_H-1.5*(0,O.font_get_charsize)(o).y,r=(0,O.font_create)(8),(0,O.font_set_text)(r,(0,E.lang_get)("STAGESELECT_PAGE"),0,0),r.position.x=h.VIDEO_SCREEN_W-(0,O.font_get_text)(r).length*(0,O.font_get_charsize)(r).x-10,r.position.y=40,(0,D.vm)("data/themes/levelselect.bg.json").then((function(e){d=e})),_=(0,N.HN)(),(0,N.TK)(_,(0,I.sprite_get_animation)("SD_TITLEFOOT",0)),B(),(0,h.video_fadefx_in)((0,b.image_rgb)(0,0,0),1)},A=function(){var e=(0,S.timer_get_delta)();if(c+=e,(0,D.A4)(d),j.length){if(_.position=(0,g.v2d_new)(j[C].position.x,j[C].position.y),_.position.x+=3*Math.cos(2*m.PI*c)-20,a=Math.floor(C/8+1),R=Math.floor(M/8+(M%8==0?0:1)),(0,O.font_set_text)(r,(0,E.lang_get)("STAGESELECT_PAGE"),a,R),r.position.x=h.VIDEO_SCREEN_W-(0,O.font_get_text)(r).length*(0,O.font_get_charsize)(r).x-10,2==l)(0,h.video_fadefx_is_fading)()||(0,y.music_stop)();else if(!(0,y.music_is_playing)()){var t=(0,y.music_load)("data/music/options.mp4");(0,y.music_play)(t,m.INFINITY)}switch(l){case 0:(0,h.video_fadefx_is_fading)()||((0,x.input_button_pressed)(s,x.IB_DOWN)&&(C=(C+1)%M,(0,y.sound_play)((0,k.soundfactory_get)("choose"))),(0,x.input_button_pressed)(s,x.IB_UP)&&(C=((C-1)%M+M)%M,(0,y.sound_play)((0,k.soundfactory_get)("choose"))),((0,x.input_button_pressed)(s,x.IB_FIRE1)||(0,x.input_button_pressed)(s,x.IB_FIRE3))&&((0,v.logfile_message)('Loading level "%s", "%s"',P[C].name,P[C].filepath),(0,p.level_setfile)(P[C].filepath),(0,y.sound_play)((0,k.soundfactory_get)("select")),l=2),(0,x.input_button_pressed)(s,x.IB_FIRE4)&&((0,y.sound_play)((0,k.soundfactory_get)("return")),l=1));break;case 1:if((0,h.video_fadefx_over)())return void(0,u.scenestack_pop)();(0,h.video_fadefx_out)((0,b.image_rgb)(0,0,0),1);break;case 2:if((0,h.video_fadefx_over)())return(0,L.player_set_lives)(L.PLAYER_INITIAL_LIVES),(0,L.player_set_score)(0),(0,u.scenestack_push)((0,f.storyboard_get_scene)(f.SCENE_LEVEL)),void(l=3);(0,h.video_fadefx_out)((0,b.image_rgb)(0,0,0),1);break;case 3:(0,h.video_fadefx_in)((0,b.image_rgb)(0,0,0),1),l=0}}},F=function(){var e,t=(0,g.v2d_new)(h.VIDEO_SCREEN_W/2,h.VIDEO_SCREEN_H/2);for((0,D.mw)(d,t),(0,D.Ed)(d,t),(0,O.font_render)(i,t),(0,O.font_render)(o,t),R>1&&(0,O.font_render)(r,t),e=8*(a-1);e<8*a;e++)P[e]&&((0,O.font_set_text)(j[e],C==e?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",P[e].name,(0,E.lang_get)("STAGESELECT_ACT"),P[e].act),(0,O.font_render)(j[e],t));(0,N.z7)(_,t)},V=function(){W(),d=(0,D.pW)(d),(0,N.HI)(_),(0,O.font_destroy)(i),(0,O.font_destroy)(o),(0,O.font_destroy)(r),(0,x.input_destroy)(s)},B=function(){(0,v.logfile_message)("load_stage_list()"),(0,w.resourcemanager_getJsonFiles)(T).then((function(e){M=(P=e).length;for(var t=0;t<M;t++)j[t]=(0,O.font_create)(8),j[t].position=(0,g.v2d_new)(25,60+t%8*20),P[t].filepath=T[t]}))},W=function(){}},931:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound_is_playing=t.sound_stop=t.sound_play_ex=t.sound_play=t.sound_load=t.music_is_playing=t.music_get_volume=t.music_set_volume=t.music_resume=t.music_pause=t.music_stop=t.music_play=t.music_load=t.audio_release=t.audio_update=t.audio_init=void 0;var a=n(386),i=n(450),o=n(898),r=null;t.audio_init=function(){},t.audio_update=function(){},t.audio_release=function(){},t.music_load=function(e){(0,o.logfile_message)("music_load('%s') ".concat(e));var t=new Audio;return t.src=e,(0,i.resourcemanager_add_music)(e,t),t},t.music_play=function(e,n){if((0,t.music_is_playing)()&&(0,t.music_stop)(),null!=e){e.loop=!!n;try{e.play()}catch(e){}}r=e},t.music_stop=function(){null!=r&&r.pause(),r=null},t.music_pause=function(){null==r||r.paused||r.pause()},t.music_resume=function(){null!=r&&r.paused&&r.play()},t.music_set_volume=function(e){null!=r&&(e>1&&(e=1),e<0&&(e=0),r.volume=e)},t.music_get_volume=function(){return null!=r?r.volume:0},t.music_is_playing=function(){return null!=r&&!r.paused},t.sound_load=function(e,t){t=a.DATA_ROOT+t;var n=new Audio;n.src=t;var o=new Audio;o.src=t;var r=new Audio;r.src=t;var _=new Audio;return _.src=t,(0,i.resourcemanager_add_sample)(e,n),(0,i.resourcemanager_add_sample)(e+"2",o),(0,i.resourcemanager_add_sample)(e+"3",r),(0,i.resourcemanager_add_sample)(e+"4",_),n},t.sound_play=function(e){(0,t.sound_play_ex)(e)},t.sound_play_ex=function(e){e&&e.play&&e.play()},t.sound_stop=function(e){e&&e.pause()},t.sound_is_playing=function(e){return!!e&&!e.paused}},251:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandline_parse=void 0,n(898);var a=n(286);t.commandline_parse=function(e){var t={};return t.video_resolution=(0,a.preferences_get_video_resolution)(),t.smooth_graphics=(0,a.preferences_get_smooth_graphics)(),t.fullscreen=(0,a.preferences_get_fullscreen)(),t.show_fps=(0,a.preferences_get_show_fps)(),t.language=(0,a.preferences_get_language)(),t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=i("video_resolution")?i("video_resolution"):t.video_resolution,t.smooth_graphics=i("smooth_graphics")?i("smooth_graphics"):t.smooth_graphics,t.fullscreen=i("fullscreen")?i("fullscreen"):t.fullscreen,t.show_fps=i("show_fps")?i("show_fps"):t.show_fps,t.color_depth=i("color_depth")?i("color_depth"):t.color_depth,t.level=i("level")?i("level"):t.level,t.quest=i("quest")?i("quest"):t.quest,t.language=i("language")?i("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t};var i=function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null}},197:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.engine_init=void 0;var a=n(931),i=n(251),o=n(689),r=n(38),_=n(286),s=n(450),c=n(667),d=n(817),l=n(470),p=n(880),u=n(532),f=n(163),g=n(954),m=n(642),v=n(218),h=n(971),b=n(235),y=n(176);t.engine_init=function(e){x();var t=(0,i.commandline_parse)(e);console.log("COMMAND LINE",t),I(t),(0,p.sprite_init)().then((function(){(0,y.font_init)(),w(t,(function(){S(),k(t),E()}))}))};var E=function(){var e;(0,g.runAnimation)((function(){(0,f.timer_update)(),(0,o.input_update)(),(e=(0,c.scenestack_top)())&&(e.update(),e==(0,c.scenestack_top)()&&e.render()),(0,d.screenshot_update)(),(0,m.video_render)(),(0,o.input_render)()}))},x=function(){(0,_.preferences_init)()},I=function(e){(0,f.timer_init)(),(0,m.video_init)(O(),e.video_resolution,e.smooth_graphics,e.fullscreen,e.color_depth,e.show_fps),(0,a.audio_init)(),(0,o.input_init)(),(0,s.resourcemanager_init)()},w=function(e,t){(0,l.soundfactory_init)(),(0,b.enemy_objects_init)(),(0,u.storyboard_init)(),(0,d.screenshot_init)(),(0,r.lang_init)(e.language,(function(){(0,c.scenestack_init)(),t()}))},S=function(){(0,h.player_set_lives)(h.PLAYER_INITIAL_LIVES),(0,h.player_set_score)(0)},k=function(e){e.custom_level?((0,v.level_setfile)(e.custom_level_path),(0,c.scenestack_push)((0,u.storyboard_get_scene)(u.SCENE_LEVEL))):(0,c.scenestack_push)((0,u.storyboard_get_scene)(u.SCENE_INTRO))},O=function(){return""}},386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=t.PI=t.INT_MAX=t.INFINITY_FLT=t.INFINITY=t.EPSILON=t.GAME_WEBSITE=t.GAME_WIP_VERSION=t.GAME_SUB_VERSION=t.GAME_VERSION=t.GAME_TITLE=t.DATA_ROOT=void 0,t.DATA_ROOT="",t.GAME_TITLE="Open Sonic",t.GAME_VERSION=1,t.GAME_SUB_VERSION=1,t.GAME_WIP_VERSION=1,t.GAME_WEBSITE="http://opensnc.sourceforge.net",t.EPSILON=1e-4,t.INFINITY=99999999,t.INFINITY_FLT=1/0,t.INT_MAX=999999999,t.PI=Math.PI,t.IF_NONE=0,t.IF_HFLIP=!0,t.IF_VFLIP=!0},443:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hashtable_music_t_add=t.hashtable_music_t_create=t.hashtable_sound_t_find=t.hashtable_sound_t_add=t.hashtable_sound_t_create=t.hashtable_image_t_add=t.hashtable_image_t_create=t.hashtable_sprites=t.hashtable_spriteinfo_t_find=t.hashtable_spriteinfo_t_add=t.hashtable_spriteinfo_t_create=void 0;var n={};t.hashtable_spriteinfo_t_create=function(){return n.sprites={},n.sprites},t.hashtable_spriteinfo_t_add=function(e,t,a){n.sprites[t]=a},t.hashtable_spriteinfo_t_find=function(e,t){return console.log(n.sprites,t),n.sprites[t]},t.hashtable_sprites=function(){return n.sprites},t.hashtable_image_t_create=function(){return n.images={},n.images},t.hashtable_image_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_create=function(){return n.samples={},n.samples},t.hashtable_sound_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_find=function(e,t){return n.samples[t]},t.hashtable_music_t_create=function(){return n.musics={},n.musics},t.hashtable_music_t_add=function(e,t,n){e[t]=n}},709:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.image_destroy=t.image_pixelperfect_collision=t.image_clear=t.image_rgb=t.image_putpixel=t.image_blit=t.image_draw=t.image_rectfill=t.image_load=t.image_create=void 0;var a=n(642),i={};t.image_create=function(e,t){return(0,a.video_get_backbuffer)().createImageData(e,t)},t.image_load=function(e){return new Promise((function(t,n){if(i[e])return t(i[e]);var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return i[e]=a,t(a)}))}))},t.image_rectfill=function(e,t,n,a,i,o){e.fillStyle=o,e.fillRect(t,n,a-t,i-n)},t.image_draw=function(e,t,n,a){t.putImageData(e,n,a)},t.image_blit=function(e,t,n,a,i,o,r,_){if(!e||!t)return!1;t.drawImage(e,n,a,r,_,i,o,r,_)},t.image_putpixel=function(e,t,n,a,i){t.fillStyle=i,t.fillRect(n,a,n+1,a+1)},t.image_rgb=function(e,t,n){return"rgb(".concat(e,", ").concat(t,", ").concat(n,")")},t.image_clear=function(e,t,n,a){for(var i=0;i<e.data.length;i+=4)e.data[i]=t,e.data[i+1]=n,e.data[i+2]=a},t.image_pixelperfect_collision=function(e,t,n,a,i,o){return!0},t.image_destroy=function(e){e&&(e.data,e=null)}},38:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lang_get=t.lang_getstring=t.lang_loadfile=t.lang_release=t.lang_init=void 0;var a=n(898),i=n(450),o="data/languages/english.json",r={};t.lang_init=function(e,n){(0,a.logfile_message)("Initializing the language module"),o=e||o,(0,t.lang_loadfile)(o).then((function(){(0,a.logfile_message)("lang_init() ok!"),n()}))},t.lang_release=function(){},t.lang_loadfile=function(e){return new Promise((function(t,n){(0,a.logfile_message)('lang_loadfile("%s")... '.concat(e)),(0,i.resourcemanager_getJsonFile)(e).then((function(e){r=e,t(e)}))}))},t.lang_getstring=function(e){return r[e]||e},t.lang_get=function(e){return(0,t.lang_getstring)(e)}},898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logfile_fatal_error=t.logfile_message=void 0,t.logfile_message=function(e){console.log(e)},t.logfile_fatal_error=function(e){console.log("FATAL ERROR",e)}},823:(e,t)=>{t.KP=t.nw=void 0,t.nw=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},t.KP=function(){return"undefined"!=typeof navigator&&"getGamepads"in navigator}},286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.preferences_set_language=t.preferences_set_show_fps=t.preferences_set_smooth_graphics=t.preferences_set_fullscreen=t.preferences_set_video_resolution=t.preferences_get_language=t.preferences_get_show_fps=t.preferences_get_smooth_graphics=t.preferences_get_fullscreen=t.preferences_get_video_resolution=t.preferences_init=void 0;var a=n(898),i={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""};t.preferences_init=function(){(0,a.logfile_message)("preferences_init()"),o()},t.preferences_get_video_resolution=function(){return i.video_resolution},t.preferences_get_fullscreen=function(){return i.fullscreen},t.preferences_get_smooth_graphics=function(){return i.smooth_graphics},t.preferences_get_show_fps=function(){return i.show_fps},t.preferences_get_language=function(){return i.language},t.preferences_set_video_resolution=function(e){i.video_resolution=e,r()},t.preferences_set_fullscreen=function(e){i.fullscreen=e,r()},t.preferences_set_smooth_graphics=function(e){i.smooth_graphics=e,r()},t.preferences_set_show_fps=function(e){i.show_fps=e,r()},t.preferences_set_language=function(e){i.language=e,r()};var o=function(){if(i.video_resolution="TINY",i.fullscreen=!1,i.smooth_graphics=!1,i.show_fps=!1,i.language="data/languages/english.json","undefined"!=typeof window)for(var e in i){var t=window.localStorage.getItem(e)?localStorage.getItem(e):i[e];"false"==t&&(t=!1),"true"==t&&(t=!0),i[e]=t}console.log("PREFERENCES",i)},r=function(){if(console.log("SAVE PREFERENCES"),"undefined"!=typeof window)for(var e in i)console.log("SAVE PREVERFENCE",e,i),i[e],window.localStorage.setItem(e,i[e])}},93:(e,t,n)=>{t.X5=t.CS=void 0;var a=n(386),i=n(709),o=n(898),r=n(450);t.CS=function(e){return new Promise((function(t,n){var a={file:e,name:"",author:"",version:"",description:"",image:null,level_count:0,levels:[],level_path:[],show_ending:!1};(0,o.logfile_message)("quest_load('%s') ".concat(e)),(0,r.resourcemanager_getJsonFile)(e).then(_).then((function(e){e&&(a=e),(0,o.logfile_message)("load_quest() ok!"),t(a)}))}))},t.X5=function(){return null};var _=function(e){return new Promise((function(t,n){var o,r={file:"",name:e.name||"",author:e.author||"Open Sonic",version:e.version||"0",description:e.description||"",show_ending:e.show_ending||!1,image:"",levels:e.levels||[],level_count:e.levels?e.levels.length:0,level_path:e.levels||[]};(o=e.image,new Promise((function(e,t){var n=o||"data/images/null.png";n=a.DATA_ROOT+n,(0,i.image_load)(n).then((function(t){e(t)}))}))).then((function(e){r.image=e,t(r)}))}))}},450:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resourcemanager_add_music=t.resourcemanager_add_sample=t.resourcemanager_add_image=t.resourcemanager_init=t.resourcemanager_getJsonFile=t.resourcemanager_getJsonFiles=void 0;var a=n(386),i=n(443),o={},r={},_={},s={};t.resourcemanager_getJsonFiles=function(e){return Promise.all(e.map(t.resourcemanager_getJsonFile))},t.resourcemanager_getJsonFile=function(e){return e=a.DATA_ROOT+e,new Promise((function(t,n){if(s[e])t(s[e]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(t){console.log("error parsing json",e)}s[e]=n,t(n)}},a.send(null)}}))},t.resourcemanager_init=function(){o=(0,i.hashtable_image_t_create)(),r=(0,i.hashtable_sound_t_create)(),_=(0,i.hashtable_music_t_create)()},t.resourcemanager_add_image=function(e,t){(0,i.hashtable_image_t_add)(o,e,t)},t.resourcemanager_add_sample=function(e,t){(0,i.hashtable_sound_t_add)(r,e,t)},t.resourcemanager_add_music=function(e,t){(0,i.hashtable_music_t_add)(_,e,t)}},667:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scenestack_empty=t.scenestack_top=t.scenestack_pop=t.scenestack_push=t.scenestack_release=t.scenestack_init=void 0;var n=[],a=0;t.scenestack_init=function(){a=0;for(var e=0;e<16;e++)n[e]=null},t.scenestack_release=function(){for(;!(0,t.scenestack_empty)();)(0,t.scenestack_pop)()},t.scenestack_push=function(e){n[a++]=e,e&&e.init()},t.scenestack_pop=function(){n[a-1].release(),n[a-1]=null,a--},t.scenestack_top=function(){return n[a-1]},t.scenestack_empty=function(){return 0===a}},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.screenshot_release=t.screenshot_update=t.screenshot_init=void 0,t.screenshot_init=function(){},t.screenshot_update=function(){},t.screenshot_release=function(){}},470:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundfactory_get=t.soundfactory_release=t.soundfactory_init=void 0;var a=n(931),i=n(443),o=n(898),r=n(450),_={};t.soundfactory_init=function(){s()},t.soundfactory_release=function(){},t.soundfactory_get=function(e){var t=(0,i.hashtable_sound_t_find)(_,e);return(0,a.sound_is_playing)(t)&&(t=(0,i.hashtable_sound_t_find)(_,e+"2"),(0,a.sound_is_playing)(t)&&(t=(0,i.hashtable_sound_t_find)(_,e+"3"),(0,a.sound_is_playing)(t)&&(t=(0,i.hashtable_sound_t_find)(_,e+"4")))),t};var s=function(){(0,o.logfile_message)("soundfactory: loading the samples table..."),(0,r.resourcemanager_getJsonFile)("data/config/samples.json").then((function(e){c(e)}))},c=function(e){for(var t in e)_[t]=d(t,e[t])},d=function(e,t){var n=l();return n.data=(0,a.sound_load)(e,t),n.data2=(0,a.sound_load)(e,t),n},l=function(){return{data:null,data2:null}}},880:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sprite_info_destroy=t.sprite_create=t.sprite_get_image=t.sprite_get_animation=t.sprite_init=void 0;var a=n(386),i=n(443),o=n(709),r=n(898),_=n(450),s=n(878),c=n(642),d={},l=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],p=0,u=[];t.sprite_init=function(){return new Promise((function(e,t){var n;for((0,r.logfile_message)("Loading sprites..."),d=(0,i.hashtable_spriteinfo_t_create)(),n=0;n<l.length;n++)l[n]="data/sprites/"+l[n]+".json";(0,c.video_renderLoading)("Loading...",0),(0,_.resourcemanager_getJsonFiles)(l).then((function(t){for(console.log("GOT ALL SPRITE JSON FILES"),n=0;n<t.length;n++)for(var a in t[n])t[n][a].name=a,u.push(t[n][a]);y(u).then((function(){(0,r.logfile_message)("All sprites have been loaded!"),d=(0,i.hashtable_sprites)(),e(d)}))}))}))},t.sprite_get_animation=function(e,t){var n;return null!=(n=d[e])?n.animation_data[t]:null},t.sprite_get_image=function(e,t){return e?e.frame_data[e.data[t]]:0},t.sprite_create=function(e){return new Promise((function(t,n){g(e).then(t)}))},t.sprite_info_destroy=function(e){var t;if(null!=e.source_file&&(e.source_file=null),null!=e.frame_data){for(t=0;t<e.frame_count;t++)(0,o.image_destroy)(e.frame_data[t]);e.frame_data=null}if(null!=e.animation_data){for(t=0;t<e.animation_count;t++)e.animation_data[t]=f(e.animation_data[t]);e.animation_data=null}e=null};var f=function(e){return null!=e&&(null!=e.data&&(e.data=null),e=null),null},g=function(e){return new Promise((function(t,n){var a=m(),i=E(a,e);i=function(e){var t,n,a;for((e.frame_w>e.rect_w||e.frame_h>e.rect_h)&&(e.frame_w=Math.min(e.frame_w,e.rect_w),e.frame_h=Math.min(e.frame_h,e.rect_h)),(e.rect_w%e.frame_w>0||e.rect_h%e.frame_h>0)&&(e.rect_w=e.rect_w%e.frame_w>0?e.rect_w-e.rect_w%e.frame_w+e.frame_w:e.rect_w,e.rect_h=e.rect_h%e.frame_h>0?e.rect_h-e.rect_h%e.frame_h+e.frame_h:e.rect_h),a=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),t=0;t<e.animation_count;t++)for(n=0;n<e.animation_data[t].frame_count;n++)e.animation_data[t].data[n]>=0&&e.animation_data[t].data[n]<a||(e.animation_data[t].data[n]=Math.min(e.animation_data[t].data[n],0,a-1));return e}(i),v(i).then((function(n){i=b(n),I(e.name,i),p++,(0,c.video_renderLoading)("Loading...",p/u.length),t(i)}))}))},m=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:(0,s.v2d_new)(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},v=function(e){return new Promise((function(t,n){(0,o.image_load)(e.source_file).then((function(n){e.frame_count=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),e.frame_data=[],e=h(e,n),t(e)}))}))},h=function(e,t){for(var n=0,a=0,i=0;i<e.frame_count;i++)e.frame_data[i]={data:t,sx:n+e.rect_x,sy:a+e.rect_y,swidth:e.frame_w,sheight:e.frame_h,x:0,y:0,width:e.frame_w,height:e.frame_h},(n+=e.frame_w)>=e.rect_w&&(n=0,a+=e.frame_h);return e},b=function(e){for(var t=0;t<e.animation_count;t++)e.animation_data[t].frame_data=e.frame_data,e.animation_data[t].hot_spot=e.hot_spot;return e},y=function(e){return Promise.all(e.map(g))},E=function(e,t){if(e.source_file=a.DATA_ROOT+t.source_file,e.rect_x=t.source_rect.xpos,e.rect_y=t.source_rect.ypos,e.rect_w=t.source_rect.width,e.rect_h=t.source_rect.height,e.frame_w=t.frame_size.width,e.frame_h=t.frame_size.height,t.hot_spot&&(e.hot_spot.x=t.hot_spot.xpos,e.hot_spot.y=t.hot_spot.ypos),t.animations){e.animation_count=t.animations.length;for(var n=0;n<e.animation_count;n++)e.animation_data[n]=x(w(),t.animations[n]),0==e.animation_data[n].frame_count&&(0,r.logfile_message)("Animation error: invalid 'data' field. You must specify the frames of the animations")}return e},x=function(e,t){return e.repeat=t.repeat,e.fps=t.fps,e.data=t.data,e.frame_count=t.data.length,e},I=function(e,t){(0,i.hashtable_spriteinfo_t_add)((0,i.hashtable_sprites)(),e,t)},w=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:(0,s.v2d_new)(0,0),frame_data:null}}},532:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storyboard_get_scene=t.storyboard_release=t.storyboard_init=t.SCENE_STAGESELECT=t.SCENE_OPTIONS=t.SCENE_CREDITS=t.SCENE_LANGSELECT=t.SCENE_CONFIRMBOX=t.SCENE_QUESTOVER=t.SCENE_MENU=t.SCENE_ENDOFDEMO=t.SCENE_QUEST=t.SCENE_GAMEOVER=t.SCENE_PAUSE=t.SCENE_LEVEL=t.SCENE_INTRO=void 0;var a=n(458),i=n(491),o=n(497),r=n(493),_=n(550),s=n(609),c=n(218),d=n(344),l=n(494),p=n(263),u=n(943),f=n(692),g=n(223);t.SCENE_INTRO=0,t.SCENE_LEVEL=1,t.SCENE_PAUSE=2,t.SCENE_GAMEOVER=3,t.SCENE_QUEST=4,t.SCENE_ENDOFDEMO=5,t.SCENE_MENU=6,t.SCENE_QUESTOVER=7,t.SCENE_CONFIRMBOX=8,t.SCENE_LANGSELECT=9,t.SCENE_CREDITS=10,t.SCENE_OPTIONS=11,t.SCENE_STAGESELECT=12;var m=[];t.storyboard_init=function(){for(var e=0;e<256;e++)m[e]=null;m[t.SCENE_LEVEL]=v(c.level_init,c.level_update,c.level_render,c.level_release),m[t.SCENE_PAUSE]=v(p.pause_init,p.pause_update,p.pause_render,p.pause_release),m[t.SCENE_GAMEOVER]=v(r.gameover_init,r.gameover_update,r.gameover_render,r.gameover_release),m[t.SCENE_QUEST]=v(u.quest_init,u.quest_update,u.quest_render,u.quest_release),m[t.SCENE_MENU]=v(d.menu_init,d.menu_update,d.menu_render,d.menu_release),m[t.SCENE_INTRO]=v(_.intro_init,_.intro_update,_.intro_render,_.intro_release),m[t.SCENE_ENDOFDEMO]=v(o.endofdemo_init,o.endofdemo_update,o.endofdemo_render,o.endofdemo_release),m[t.SCENE_QUESTOVER]=v(f.questover_init,f.questover_update,f.questover_render,f.questover_release),m[t.SCENE_CONFIRMBOX]=v(a.confirmbox_init,a.confirmbox_update,a.confirmbox_render,a.confirmbox_release),m[t.SCENE_LANGSELECT]=v(s.langselect_init,s.langselect_update,s.langselect_render,s.langselect_release),m[t.SCENE_CREDITS]=v(i.credits_init,i.credits_update,i.credits_render,i.credits_release),m[t.SCENE_OPTIONS]=v(l.options_init,l.options_update,l.options_render,l.options_release),m[t.SCENE_STAGESELECT]=v(g.stageselect_init,g.stageselect_update,g.stageselect_render,g.stageselect_release)},t.storyboard_release=function(){for(var e=0;e<256;e++)m[e]&&h(m[e])},t.storyboard_get_scene=function(e){return console.log("GET SCENE",e),m[e]};var v=function(e,t,n,a){return{init:e,update:t,render:n,release:a}},h=function(e){}},163:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timer_get_fps=t.timer_get_ticks=t.timer_get_delta=t.timer_release=t.timer_update=t.timer_init=void 0;var a=n(898),i=0,o=0,r=0,_=0,s=0,c=0;t.timer_init=function(){(0,a.logfile_message)("timer_init()"),i=0,o=0,r=0,s=0,_=(0,t.timer_get_ticks)()},t.timer_update=function(){var e=0,n=0;for(n=0;n<10;)n=(e=(0,t.timer_get_ticks)())>_?e-_:0,_=e>=_?_:e;n=Math.min(n,16),s=.001*n,i++,(o+=n)>=1e3&&(r=i,i=0,o=0),_=(0,t.timer_get_ticks)()},t.timer_release=function(){(0,a.logfile_message)("timer_release()")},t.timer_get_delta=function(){return s},t.timer_get_ticks=function(){var e=d();return e<c&&(c=e),e-c},t.timer_get_fps=function(){return r};var d=function(){return Math.floor(Date.now())}},954:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.old_school_angle=t.swap=t.circular_collision=t.bounding_box=t.clip=t.random=t.isInArray=t.isArray=t.isspace=t.runAnimation=void 0;var a=n(386),i=n(878);t.runAnimation=function(e){var t=null;requestAnimationFrame((function n(a){var i=!1;if(null!=t){var o=Math.min(a-t,100)/1e3;i=!1===e(o)}t=a,i||requestAnimationFrame(n)}))},t.isspace=function(e){return" "==e},t.isArray=function(e){return void 0!==e&&e&&e.constructor===Array},t.isInArray=function(e,t){return t.indexOf(e)>-1},t.random=function(e){return(0,t.clip)(Math.random()*e,1,e)},t.clip=function(e,t,n){return Math.min(Math.max(e,t),n)},t.bounding_box=function(e,t){return e[0]<t[2]&&e[2]>t[0]&&e[1]<t[3]&&e[3]>t[1]},t.circular_collision=function(e,t,n,a){return(0,i.v2d_magnitude)((0,i.v2d_subtract)(e,n))<=t+a},t.swap=function(e,t){return o(e,t,e.length)},t.old_school_angle=function(e){return e>=0&&e<a.PI/4-a.EPSILON?0:e>=a.PI/4-a.EPSILON&&e<a.PI/2-a.EPSILON?a.PI/4:e>=a.PI/2-a.EPSILON&&e<a.PI/2+a.EPSILON?a.PI/2:e>=a.PI/2+a.EPSILON&&e<a.PI-a.EPSILON?3*a.PI/4:e>=a.PI-a.EPSILON&&e<a.PI+a.EPSILON?a.PI:e>=a.PI+a.EPSILON&&e<3*a.PI/2-a.EPSILON?5*a.PI/4:e>=3*a.PI/2-a.EPSILON&&e<3*a.PI/2+a.EPSILON?3*a.PI/2:e>3*a.PI/2+a.EPSILON&&e<=7*a.PI/4+a.EPSILON?7*a.PI/4:0};var o=function(e,t,n){var a,i,o=e,r=t;for(a=0;a<n;a++)i=o[a],o[a]=r[a],r[a]=i;return[o[a],r[a]]}},878:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.v2d_lerp=t.v2d_normalize=t.v2d_rotate=t.v2d_dotproduct=t.v2d_magnitude=t.v2d_multiply=t.v2d_subtract=t.v2d_add=t.v2d_new=void 0;var a=n(386),i=n(954);t.v2d_new=function(e,t){return{x:e,y:t}},t.v2d_add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},t.v2d_subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.v2d_multiply=function(e,t){return{x:t*e.x,y:t*e.y}},t.v2d_magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.v2d_dotproduct=function(e,t){return e.x*t.x+e.y*t.y},t.v2d_rotate=function(e,t){var n=e.x,a=e.y;return{x:n*Math.cos(t)-a*Math.sin(t),y:a*Math.cos(t)+n*Math.sin(t)}},t.v2d_normalize=function(e){var n=(0,t.v2d_magnitude)(e);return n>a.EPSILON?(0,t.v2d_new)(e.x/n,e.y/n):(0,t.v2d_new)(0,0)},t.v2d_lerp=function(e,n,a){var o=(0,i.clip)(a,0,1),r=1-o;return(0,t.v2d_new)(e.x*r+n.x*o,e.y*r+n.y*o)}},642:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.video_getMousePos=t.video_get_window_size=t.video_changemode=t.video_show_fps=t.video_is_fps_visible=t.video_is_fullscreen=t.video_is_smooth=t.video_get_resolution=t.video_get_backbuffer=t.video_get_canvas=t.video_getCameraY=t.video_getCameraX=t.video_setCameraY=t.video_setFlipX=t.video_setCameraX=t.video_renderLoading=t.video_clearDisplay=t.video_fadefx_is_fading=t.video_fadefx_over=t.video_fadefx_out=t.video_fadefx_in=t.video_render=t.video_getScale=t.video_init=t.VIDEO_SCALE=t.VIDEO_SCREEN_H=t.VIDEO_SCREEN_W=t.VIDEORESOLUTION_EDT=t.VIDEORESOLUTION_MAX=t.VIDEORESOLUTION_2X=t.VIDEORESOLUTION_1X=void 0;var a,i,o,r,_=n(163),s=n(954),c=n(878);t.VIDEORESOLUTION_1X=0,t.VIDEORESOLUTION_2X=1,t.VIDEORESOLUTION_MAX=2,t.VIDEORESOLUTION_EDT=3,t.VIDEO_SCREEN_W=480,t.VIDEO_SCREEN_H=271;var d,l,p,u,f,g=!1,m=!1,v=!1,h=0,b=0;t.VIDEO_SCALE=1;var y=1,E=1;t.video_init=function(e,n,r,_,s,c){(0,t.video_changemode)(n,r,_),(0,t.video_show_fps)(c),(a=document.getElementById("canvas"))?(i=a.getContext("2d"),y=a.width/t.VIDEO_SCREEN_W,E=a.height/t.VIDEO_SCREEN_H,i.scale(a.width/t.VIDEO_SCREEN_W,a.height/t.VIDEO_SCREEN_H)):(a=document.createElement("canvas"),i=a.getContext("2d"),a.width=t.VIDEO_SCREEN_W,a.height=t.VIDEO_SCREEN_H,document.body.appendChild(a)),y=t.VIDEO_SCREEN_W/window.innerWidth,E=y,i.imageSmoothingEnabled=!1,i.mozImageSmoothingEnabled=!1,console.log("PIXEL RATIO",window.devicePixelRatio),console.log("VIDEO_SCREEN_W",t.VIDEO_SCREEN_W),console.log("VIDEO_SCREEN_H",t.VIDEO_SCREEN_H),console.log("CANVAS",a.width,a.height),console.log("WINDOW",window.innerWidth),console.log("SCALE",y),o=i,(0,t.video_clearDisplay)()},t.video_getScale=function(){return(0,c.v2d_new)(y,E)},t.video_render=function(){if(l=!1,0!=d)if((u+=(0,_.timer_get_delta)())<f){var e=void 0;e=1.25*u/f*100,e=(0,s.clip)(e,0,100),e=1==d?100-e:e,e/=100,(0,t.video_get_backbuffer)().fillStyle=p,(0,t.video_get_backbuffer)().globalAlpha=e,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)}else 2==d&&((0,t.video_get_backbuffer)().fillStyle=p,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)),d=0,f=u=0,p=null,l=!0;(0,t.video_get_backbuffer)().globalAlpha=1,(0,t.video_is_fps_visible)()&&((0,t.video_get_backbuffer)().font="14px Arial",(0,t.video_get_backbuffer)().fillStyle="white",(0,t.video_get_backbuffer)().fillText((0,_.timer_get_fps)(),t.VIDEO_SCREEN_W-30,20))},t.video_fadefx_in=function(e,t){0==d&&(d=1,l=!1,p=e,u=0,f=t)},t.video_fadefx_out=function(e,t){0==d&&(d=2,l=!1,p=e,u=0,f=t)},t.video_fadefx_over=function(){return l},t.video_fadefx_is_fading=function(){return 0!=d},t.video_clearDisplay=function(e){i.fillStyle=e||"rgb(0, 0, 0)",i.fillRect(0,0,a.width,a.height)},t.video_renderLoading=function(e,n){(0,t.video_clearDisplay)();var a=(0,t.video_get_backbuffer)();a.beginPath(),a.rect(130,t.VIDEO_SCREEN_H/2-20,210,20),a.fillStyle="black",a.fill(),a.lineWidth=1,a.strokeStyle="white",a.stroke(),n=n<1?0:n>202?202:202/n,a.beginPath(),a.rect(134,t.VIDEO_SCREEN_H/2-17,n,14),a.fillStyle="white",a.fill(),a.lineWidth=1,a.strokeStyle="black",a.stroke(),a.font="14px Arial",a.fillStyle="white",a.fillText(e,130,t.VIDEO_SCREEN_H/2-30)},t.video_setCameraX=function(e){return h=e},t.video_setFlipX=function(e){return e},t.video_setCameraY=function(e){return b=e},t.video_getCameraX=function(){return h},t.video_getCameraY=function(){return b},t.video_get_canvas=function(){return a},t.video_get_backbuffer=function(){return o},t.video_get_resolution=function(){return r},t.video_is_smooth=function(){return g},t.video_is_fullscreen=function(){return m},t.video_is_fps_visible=function(){return v},t.video_show_fps=function(e){v=e},t.video_changemode=function(e,t,n){r=e,m=n,g=t},t.video_get_window_size=function(){var e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;switch(r){case t.VIDEORESOLUTION_1X:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_2X:e=2*t.VIDEO_SCREEN_W,n=2*t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_MAX:case t.VIDEORESOLUTION_EDT:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H}return(0,c.v2d_new)(e,n)},t.video_getMousePos=function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}}},t={};function n(a){var i=t[a];if(void 0!==i)return i.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(0,n(197).engine_init)({Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null,Xquest:null,Xlanguage:null})})();