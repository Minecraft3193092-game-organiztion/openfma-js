(()=>{"use strict";var e={794:(e,t,n)=>{function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,i=void 0,i=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!==a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(r),"symbol"===a(i)?i:String(i)),o)}var r,i}n.r(t),n.d(t,{default:()=>_});var r,i=n(642),_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var t,n,a;return t=e,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var n=(0,i.video_getScale)();e*=n.x,t*=n.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var n=(0,i.video_getScale)();e*=n.x,t*=n.y,!0===this._pressed&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,n=e.clientY;return this._onDown(t,n)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",e)){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var n=t.pageX,a=t.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length){var a=t[n];e.preventDefault();var o=a.pageX,r=a.pageY;return this._onMove(o,r)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}])&&o(t.prototype,n),a&&o(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();(r=_.prototype).addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},r.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},r.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;n++){var a=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}}},7266:(e,t,n)=>{n.r(t),n.d(t,{PLAYERS:()=>vt,level_add_to_score:()=>Gt,level_add_to_secret_bonus:()=>Kt,level_boss_battle:()=>qt,level_brick_move_actor:()=>rn,level_call_dialogbox:()=>Xt,level_clear:()=>Wt,level_create_animal:()=>_n,level_create_brick:()=>tn,level_create_enemy:()=>an,level_create_item:()=>nn,level_create_particle:()=>on,level_editmode:()=>Ct,level_get_brick_id:()=>dn,level_get_brick_list:()=>sn,level_getfile:()=>Pt,level_gravity:()=>en,level_hide_dialogbox:()=>zt,level_init:()=>jt,level_kill_all_baddies:()=>Qt,level_lock_camera:()=>$t,level_override_music:()=>Vt,level_player:()=>Ft,level_player_id:()=>Ht,level_release:()=>Mt,level_render:()=>Bt,level_render_entities:()=>cn,level_restore_music:()=>Zt,level_save:()=>Dt,level_set_camera_focus:()=>Hn,level_set_spawn_point:()=>Yt,level_setfile:()=>kt,level_size:()=>Ut,level_spawn_players:()=>ln,level_unlock_camera:()=>Jt,level_update:()=>At});var a,o,r,i,_,c,s,d,l,u,p,f,g,m,v,h,b,E,I,y,x,S,w,L,O,R,T,N,k,P,D,j,A,B,M,C,F,H,G,U,V,Y,W,K,X,z,q,Q,$,J,Z,ee,te,ne,ae,oe,re,ie,_e,ce,se,de,le=n(5858),ue=n(9931),pe=n(4470),fe=n(9386),ge=n(7709),me=n(7774),ve=n(7898),he=n(9880),be=n(4163),Ee=n(2954),Ie=n(2878),ye=n(642),xe=n(3031),Se=n(8707),we=n(2985),Le=n(1459),Oe=n(2530),Re=n(2594),Te=n(4392),Ne=!1,ke=[me.KEY_UP,me.KEY_DOWN,me.KEY_RIGHT,me.KEY_LEFT,me.KEY_N,me.KEY_B,me.KEY_LCONTROL,me.KEY_F12],Pe=[me.KEY_W,me.KEY_S,me.KEY_D,me.KEY_A,me.KEY_Z,me.KEY_Y,me.KEY_G,me.KEY_P],De={},je={},Ae=0,Be=0,Me=[Re.IT_RING,Re.IT_LIFEBOX,Re.IT_RINGBOX,Re.IT_STARBOX,Re.IT_SPEEDBOX,Re.IT_GLASSESBOX,Re.IT_TRAPBOX,Re.IT_SHIELDBOX,Re.IT_FIRESHIELDBOX,Re.IT_THUNDERSHIELDBOX,Re.IT_WATERSHIELDBOX,Re.IT_ACIDSHIELDBOX,Re.IT_WINDSHIELDBOX,Re.IT_LOOPRIGHT,Re.IT_LOOPMIDDLE,Re.IT_LOOPLEFT,Re.IT_LOOPNONE,Re.IT_YELLOWSPRING,Re.IT_BYELLOWSPRING,Re.IT_RYELLOWSPRING,Re.IT_LYELLOWSPRING,Re.IT_TRYELLOWSPRING,Re.IT_TLYELLOWSPRING,Re.IT_BRYELLOWSPRING,Re.IT_BLYELLOWSPRING,Re.IT_REDSPRING,Re.IT_BREDSPRING,Re.IT_RREDSPRING,Re.IT_LREDSPRING,Re.IT_TRREDSPRING,Re.IT_TLREDSPRING,Re.IT_BRREDSPRING,Re.IT_BLREDSPRING,Re.IT_BLUESPRING,Re.IT_BBLUESPRING,Re.IT_RBLUESPRING,Re.IT_LBLUESPRING,Re.IT_TRBLUESPRING,Re.IT_TLBLUESPRING,Re.IT_BRBLUESPRING,Re.IT_BLBLUESPRING,Re.IT_BLUERING,Re.IT_SWITCH,Re.IT_DOOR,Re.IT_TELEPORTER,Re.IT_BIGRING,Re.IT_CHECKPOINT,Re.IT_GOAL,Re.IT_ENDSIGN,Re.IT_ENDLEVEL,Re.IT_LOOPFLOOR,Re.IT_LOOPFLOORNONE,Re.IT_LOOPFLOORTOP,Re.IT_BUMPER,Re.IT_DANGER,Re.IT_VDANGER,Re.IT_FIREDANGER,Re.IT_VFIREDANGER,Re.IT_SPIKES,Re.IT_CEILSPIKES,Re.IT_LWSPIKES,Re.IT_RWSPIKES,Re.IT_PERSPIKES,Re.IT_PERCEILSPIKES,Re.IT_PERLWSPIKES,Re.IT_PERRWSPIKES,Re.IT_DNADOOR,Re.IT_DNADOORNEON,Re.IT_DNADOORCHARGE,Re.IT_HDNADOOR,Re.IT_HDNADOORNEON,Re.IT_HDNADOORCHARGE,-1],Ce=0,Fe=function(){return Ne},He=function(){var e=Pt();Dt(e),(0,ue.sound_play)((0,pe.soundfactory_get)("level saved"))},Ge=function(){var e,t=(0,be.timer_get_delta)();e=(0,me.input_button_down)(_,me.IB_FIRE3)?3750:750,((0,me.input_button_down)(_,me.IB_UP)||(0,me.input_button_down)(c,me.IB_UP))&&(De.y-=e*t),((0,me.input_button_down)(_,me.IB_DOWN)||(0,me.input_button_down)(c,me.IB_DOWN))&&(De.y+=e*t),((0,me.input_button_down)(_,me.IB_LEFT)||(0,me.input_button_down)(c,me.IB_LEFT))&&(De.x-=e*t),((0,me.input_button_down)(_,me.IB_RIGHT)||(0,me.input_button_down)(c,me.IB_RIGHT))&&(De.x+=e*t),De.x=parseInt(Math.max(De.x,ye.VIDEO_SCREEN_W/2),10),De.y=parseInt(Math.max(De.y,ye.VIDEO_SCREEN_H/2),10),(0,we.kX)(De)},Ue=function(e){switch(e){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},Ve=function(e,t){var n;switch(e){case 1:n=(0,Se.brick_get)(t);break;case 2:n=(0,Re.item_create)(t),(0,Re.item_destroy)(n)}return""},Ye=function e(){Ae=0,Be=0,4==(s=1==s?2:2==s?3:3==s?4:4==s?1:s)&&0==(0,Te.p5)()&&e()},We=function e(){Ae=0,Be=0,4==(s=2==s?1:3==s?2:4==s?3:1==s?4:s)&&0==(0,Te.p5)()&&e()},Ke=function e(){var t;switch(s){case 1:t=(0,Se.brick_size)(),Ae=(Ae+1)%t,null==(0,Se.brick_get)(Ae)&&e();break;case 2:Ae=Me[Be=(Be+1)%(t=u)];break;case 3:Ae=(Ae+1)%(t=f);break;case 4:t=(0,Te.p5)(),Ae=(Ae+1)%t}},Xe=function e(){var t;switch(s){case 1:t=(0,Se.brick_size)(),Ae=(Ae-1+t)%t,null==(0,Se.brick_get)(Ae)&&e();break;case 2:Ae=Me[Be=(Be-1+(t=u))%t];break;case 3:Ae=(Ae-1+(t=f))%t;break;case 4:t=(0,Te.p5)(),Ae=(Ae-1+t)%t}},ze=function(e){var t;for(t=0;t<u;t++)if(e==Me[t])return t;return-1},qe=function e(t,n,a){var o=null,r=(0,Ie.v2d_new)(0,0);switch(t){case 1:null!=(0,Se.brick_get)(n)&&(o=(0,Se.brick_get)(n).image);break;case 2:var i=(0,Re.item_create)(n);null!=i&&(o=(0,xe.actor_image)(i.actor),(r=i.actor.hot_spot).y-=2,(0,Re.item_destroy)(i));break;case 3:var _=(0,Le.enemy_create)($e(n));null!=_&&(o=(0,xe.actor_image)(_.actor),(r=_.actor.hot_spot).y-=2,(0,Le.enemy_destroy)(_));break;case 4:var c;for(c=(0,Te.ZM)(n);c;c=c.next)e(EDITORGRP_ENTITY_TO_EDT(c.entity.type),c.entity.id,(0,Ie.v2d_add)(a,c.entity.position))}null!=o&&(0,ge.image_blit)(o.data,(0,ye.video_get_backbuffer)(),o.sx,o.sy,parseInt(a.x-r.x,10),parseInt(a.y-r.y,10),o.swidth,o.sheight)},Qe=function(e){var t;for(t=0;t<f;t++)if(e==p[t])return t;return-1},$e=function(e){return null},Je=function(){(0,me.input_button_pressed)(c,me.IB_FIRE3)&&(Ce=!Ce)},Ze=function(e){var t=(0,Ie.v2d_subtract)(De,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2)),n=parseInt(t.x%1,10),a=parseInt(t.y%1,10),o=-n+1*parseInt(e.x/1,10),r=-a+1*parseInt(e.y/1,10);return(0,Ie.v2d_add)(t,(0,Ie.v2d_new)(o,r))},et=function(e,t,n,a){var o={};return o.type=e?1:2,o.obj_type=t,o.obj_id=n,o.obj_position=a,o},tt=function(e,t,n){var a={};return a.type=e?3:4,a.obj_position=t,a.obj_old_position=n,a},nt=function(){m=ot(m),g=null,v=null},at=function e(t){var n,a=!1;if(4!=t.obj_type){var o,r,i;for((i={}).action=t,i.in_group=a,i.in_group&&(i.group_key=n),null!=(o=v)&&(o.next=ot(o.next)),r=g;null!=r.next;)r=r.next;r.next=i,i.prev=r,i.next=null,v=i}else{var _,c=48879;for(a=!0,n=c++,_=(0,Te.ZM)(t.obj_id);_;_=_.next){var s=_.entity,d=EDITORGRP_ENTITY_TO_EDT(s.type);e(et(!0,d,s.id,(0,Ie.v2d_add)(s.position,t.obj_position)))}a=!1}},ot=function(e){var t,n;for(t=e;null!=t;)n=t.next,t=null,t=n;return null},rt=function e(){var t,n;v!=m&&(t=v,v=v.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&e(),(n=t.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,_t(n))},it=function e(){var t,n;null!=v.next&&((t=v=v.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&e(),n=t.action,_t(n))},_t=function e(t){if(1==t.type)switch(t.obj_type){case 1:tn(t.obj_id,t.obj_position);break;case 2:nn(t.obj_id,t.obj_position);break;case 3:an($e(t.obj_id),t.obj_position);break;case 4:var n;for(n=(0,Te.ZM)(t.obj_id);n;n=n.next){var a=n.entity,o=EDITORGRP_ENTITY_TO_EDT(a.type);e(et(!0,o,a.id,(0,Ie.v2d_add)(a.position,t.obj_position)))}}else if(2==t.type)switch(t.obj_type){case 1:var r,i=(0,Se.brick_get)(t.obj_id);for(r=h;r;r=r.next)r.data.brick_ref==i&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)((0,Ie.v2d_new)(r.data.x,r.data.y),t.obj_position))<fe.EPSILON&&(r.data.state=Se.BRS_DEAD);break;case 2:var _,c=t.obj_id;for(_=item_list;_;_=_.next)_.data.type==c&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)(_.data.actor.position,t.obj_position))<fe.EPSILON&&(_.data.state=IS_DEAD);break;case 3:var s,d=t.obj_id;for(s=enemy_list;s;s=s.next)Qe(s.data.name)==d&&(0,Ie.v2d_magnitude)((0,Ie.v2d_subtract)(s.data.actor.position,t.obj_position))<fe.EPSILON&&(s.data.state=ES_DEAD)}else 3==t.type?(Yt(t.obj_position),ln()):4==t.type&&(Yt(t.obj_old_position),ln())},ct=n(6038),st=n(3450),dt=n(2667),lt=n(532),ut=n(3339),pt=n(2296),ft=n(3111),gt=n(5141),mt=n(7307),vt=[0,1,2],ht=ye.VIDEO_SCREEN_W,bt="data/levels/blue_ocean_1.json",Et=null,It=[],yt=[],xt=[],St=[],wt={position:{x:0,y:0}},Lt=[],Ot=[],Rt=[],Tt=[],Nt=[],kt=function(e){bt=e,(0,ve.logfile_message)('level_setfile("'.concat(e,'")'))},Pt=function(){return bt},Dt=function(e){var t,n,a,o,r,i={name:b,act:S,theme:I,bgtheme:y,grouptheme:x,spawn_point:T,music:E,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};Un()&&(i.boss={id:C.type,x:C.actor.spawn_point.x,y:C.actor.spawn_point.y,rx:C.rect_x,ry:C.rect_y,rw:C.rect_w,rh:C.rect_h});var _=[];for(a=Et;a;a=a.next)_.push({id:pn(a.data),xpos:a.data.sx,ypos:a.data.sy});i.bricklist=_;var c=[];for(o=It;o;o=o.next)o.data&&c.push({id:o.data.type,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});i.itemlist=c;var s=[];for(r=yt;r;r=r.next)r.data&&r.data.created_from_editor&&s.push({id:r.data.name,xpos:r.data.actor.spawn_point.x,ypos:r.data.actor.spawn_point.y});i.enemylist=s;var d=[];for(t=0,n=Nt.length;t<n;t++)d.push({xpos:Nt[t].rect_x,ypos:Nt[t].rect_y,width:Nt[t].rect_w,height:Nt[t].rect_h,title:Nt[t].title,message:Nt[t].message});i.dialogbox=d;var l=e.split("/");l=l[l.length-1],(0,ve.logfile_message)("level_save() ok")},jt=function(){var e;ht=ye.VIDEO_SCREEN_W,(0,ve.logfile_message)("level_init()"),Et=null,It=[],St=[],w=800,L=O=0,R=0,de=0,k=null,Y=!1,D=!1,j="",W=K=X=0,Ot=$=J=0,z=q=!1,Q=!1,A=null,En(),(0,ve.logfile_message)("editor_init()"),h=sn(),Ne=!1,u=Me.length,s=1,Ae=0,a=(0,ye.video_get_resolution)(),o=(0,ye.video_is_smooth)(),p=(0,Le.enemy_get_list_of_names)(f),r=(0,ge.image_load)("data/images/editorbg.png"),_=(0,me.input_create_keyboard)(ke),c=(0,me.input_create_keyboard)(Pe),i=(0,me.input_create_mouse)(),d=(0,Oe.font_create)(8),l=(0,Oe.font_create)(8),(0,Te.r5)(),Ce=!1,(0,ve.logfile_message)("editor_init() ok"),Vn(bt).then((function(){for((0,ve.logfile_message)("Creating players..."),e=0;e<vt.length;e++){var t=(0,gt.player_create)(vt[e]);t.hit=gt.player_hit,t.kill=gt.player_kill,t.set_rings=gt.player_set_rings,t.get_rings=gt.player_get_rings,t.got_glasses=!1,St.push(t)}for(On(),B=St[M=0],(0,we.qO)(),(0,we.kX)(B.actor.position),Hn(B.actor),(0,gt.player_set_rings)(0),F=!1,H=!1,(0,ve.logfile_message)("Loading hud..."),(G=(0,xe.actor_create)()).position=(0,Ie.v2d_new)(16,7),G=(0,xe.actor_change_animation)(G,(0,he.sprite_get_animation)("SD_MAINGUI",0)),(U=(0,xe.actor_create)()).position=(0,Ie.v2d_new)(16,ye.VIDEO_SCREEN_H-23),U=(0,xe.actor_change_animation)(U,(0,he.sprite_get_animation)("SD_LIFEGUI",0)),(V=(0,Oe.font_create)(0)).position=(0,Ie.v2d_add)(U.position,(0,Ie.v2d_new)(32,11)),e=0;e<3;e++)Lt[e]=(0,Oe.font_create)(2),Lt[e].position=(0,Ie.v2d_add)(G.position,(0,Ie.v2d_new)(42,16*e+2));for((ne=(0,xe.actor_create)()).position=(0,Ie.v2d_new)(0,-240),ne=(0,xe.actor_change_animation)(ne,(0,he.sprite_get_animation)("SD_LEVELOP",0)),(ae=(0,xe.actor_create)()).position=(0,Ie.v2d_new)(260,250),ae=(0,xe.actor_change_animation)(ae,(0,he.sprite_get_animation)("SD_LEVELACT",S-1)),(oe=(0,Oe.font_create)(3)).position=(0,Ie.v2d_new)(330,50),(0,Oe.font_set_text)(oe,"%s",b.toUpperCase()),(0,Oe.font_set_width)(oe,180),Z=(0,Oe.font_create)(4),ee=(0,Oe.font_create)(7),te=(0,xe.actor_create)(),e=0;e<3;e++)Rt[e]=(0,Oe.font_create)(2),Tt[e]=(0,xe.actor_create)();re=!1,ie=0,(_e=(0,xe.actor_create)()).position.y=ye.VIDEO_SCREEN_H,_e=(0,xe.actor_change_animation)(_e,(0,he.sprite_get_animation)("SD_DIALOGBOX",0)),ce=(0,Oe.font_create)(8),se=(0,Oe.font_create)(8)}))},At=function(){var e,t;R+=(0,be.timer_get_delta)();var n,r,u,p,f,b,E,I=!1,y=!1,x=!1,S=(0,be.timer_get_delta)();if(Mn(),An(),Bn(),Fe())!function(){h||(h=sn());var e,t,n,r,u,p=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ARROW",0),0),f=(0,Oe.font_get_charsize)(d).x,g=(0,Oe.font_get_charsize)(d).y,m=(0,Ie.v2d_subtract)(De,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2));if((0,me.input_button_down)(_,me.IB_FIRE3)&&(0,me.input_button_pressed)(_,me.IB_FIRE4)&&He(),(0,me.input_button_down)(_,me.IB_FIRE4))return(0,ve.logfile_message)("editor_disable()"),nt(),Ne=!1,(0,ye.video_changemode)(a,o,(0,ye.video_is_fullscreen)()),void(0,ve.logfile_message)("editor_disable() ok");if((0,me.input_button_down)(_,me.IB_FIRE3)?(((0,me.input_button_pressed)(_,me.IB_FIRE1)||(0,me.input_button_pressed)(i,me.IB_DOWN))&&Ye(),((0,me.input_button_pressed)(_,me.IB_FIRE2)||(0,me.input_button_pressed)(i,me.IB_UP))&&We()):(((0,me.input_button_pressed)(_,me.IB_FIRE1)||(0,me.input_button_pressed)(i,me.IB_DOWN))&&Ke(),((0,me.input_button_pressed)(_,me.IB_FIRE2)||(0,me.input_button_pressed)(i,me.IB_UP))&&Xe()),je.x=(0,Ee.clip)((0,me.input_get_xy)(i).x,0,ye.VIDEO_SCREEN_W-p.width),je.y=(0,Ee.clip)((0,me.input_get_xy)(i).y,0,ye.VIDEO_SCREEN_H-p.height),(0,me.input_button_pressed)(i,me.IB_FIRE1)&&(0,me.input_button_down)(_,me.IB_FIRE3)){var v=Ze(je),b=tt(!0,v,spawn_point);_t(b),at(b)}if((0,me.input_button_pressed)(i,me.IB_FIRE1)&&!(0,me.input_button_down)(_,me.IB_FIRE3)){var E=et(!0,s,Ae,Ze(je));_t(E),at(E)}if(e=(0,me.input_button_pressed)(i,me.IB_FIRE3),t=(0,me.input_button_pressed)(i,me.IB_FIRE2),e||t)switch(s){case 1:for(n=h;n;n=n.next){var I=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],y=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1];if((0,Ee.bounding_box)(I,y)){if(!e){var x=et(!1,1,dn(n.data),(0,Ie.v2d_new)(n.data.x,n.data.y));_t(x),at(x);break}Ae=dn(n.data)}}break;case 2:for(r=item_list;r;r=r.next){var S=[r.data.actor.position.x-r.data.actor.hot_spot.x,r.data.actor.position.y-r.data.actor.hot_spot.y,r.data.actor.position.x-r.data.actor.hot_spot.x+(0,xe.actor_image)(r.data.actor).width,r.data.actor.position.y-r.data.actor.hot_spot.y+(0,xe.actor_image)(r.data.actor).height],w=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1];if((0,Ee.bounding_box)(S,w)){if(!e){var L=et(!1,2,r.data.type,r.data.actor.position);_t(L),at(L);break}var O=ze(r.data.type);O>=0&&(Be=O,Ae=Me[O])}}break;case 3:for(u=enemy_list;u;u=u.next){var R=[u.data.actor.position.x-u.data.actor.hot_spot.x,u.data.actor.position.y-u.data.actor.hot_spot.y,u.data.actor.position.x-u.data.actor.hot_spot.x+(0,xe.actor_image)(u.data.actor).width,u.data.actor.position.y-u.data.actor.hot_spot.y+(0,xe.actor_image)(u.data.actor).height],T=[je.x+m.x,je.y+m.y,je.x+m.x+1,je.y+m.y+1],N=Qe(u.data.name);if(N>=0&&(0,Ee.bounding_box)(R,T)){if(!e){var k=et(!1,3,N,u.data.actor.position);_t(k),at(k);break}Ae=N}}}(0,me.input_button_down)(_,me.IB_FIRE3)&&((0,me.input_button_pressed)(c,me.IB_FIRE1)?rt():(0,me.input_button_pressed)(c,me.IB_FIRE2)&&it()),Je(),Ge(),(0,Oe.font_set_text)(d,"%d,%d",parseInt(Ze(je).x,10),parseInt(Ze(je).y,10)),d.position.x=(0,Ee.clip)(parseInt(je.x,10),10,ye.VIDEO_SCREEN_W-f*(0,Oe.font_get_text)(d).length-10),d.position.y=(0,Ee.clip)(parseInt(je.y-3*g,10),10,ye.VIDEO_SCREEN_H-10),l.position=(0,Ie.v2d_new)(10,10),3!=s?(0,Oe.font_set_text)(l,"<color=ffff00>%s %d</color>\n%s",Ue(s),Ae,Ve(s,Ae)):(0,Oe.font_set_text)(l,'<color=ffff00>%s "%s"</color>\n%s',Ue(s),$e(Ae),Ve(s,Ae))}();else{for(x=R<5,e=0;e<St.length&&!x;e++)St[e]&&(x=St[e].dead);if(B&&B.actor&&(0,me.input_button_pressed)(B.actor.input,me.IB_FIRE4)&&!x){var w=[];return N.pause(),w[0]=(0,ct.lang_getstring)("CBOX_QUIT_QUESTION"),w[1]=(0,ct.lang_getstring)("CBOX_QUIT_OPTION1"),w[2]=(0,ct.lang_getstring)("CBOX_QUIT_OPTION2"),(0,le.confirmbox_alert)(w[0],w[1],w[2]),void(0,dt.scenestack_push)((0,lt.storyboard_get_scene)(lt.SCENE_CONFIRMBOX))}if(1==(t=(0,le.confirmbox_selected_option)())?D=!0:2==t&&(0,ue.music_play)(N,!0),D)return(0,ye.video_fadefx_over)()?((0,dt.scenestack_pop)(),void(0,mt.quest_abort)()):void(0,ye.video_fadefx_out)((0,ge.image_rgb)(0,0,0),1);if((0,me.input_button_pressed)(_,me.IB_FIRE5))return(0,ve.logfile_message)("editor_enable()"),(m={}).in_group=!1,m.prev=null,m.next=null,g=m,v=m,Ne=!0,De.x=parseInt((0,we.gY)().x,10),De.y=parseInt((0,we.gY)().y,10),je=(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2),a=(0,ye.video_get_resolution)(),o=(0,ye.video_is_smooth)(),(0,ye.video_changemode)(ye.VIDEORESOLUTION_EDT,!1,(0,ye.video_is_fullscreen)()),void(0,ve.logfile_message)("editor_enable() ok");for(y=R<5,e=0;e<St.length&&!y;e++)y=St[e].dying||St[e].dead;if(B&&(0,me.input_button_pressed)(B.actor.input,me.IB_FIRE3)&&!y)return B.spin_dash=B.braking=!1,(0,ue.music_pause)(),void(0,dt.scenestack_push)((0,lt.storyboard_get_scene)(lt.SCENE_PAUSE));G=(0,xe.actor_change_animation)(G,(0,he.sprite_get_animation)("SD_MAINGUI",(0,gt.player_get_rings)()>0?0:1)),U=(0,xe.actor_change_animation)(U,(0,he.sprite_get_animation)("SD_LIFEGUI",M)),V=(0,Oe.font_set_text)(V,"%d",(0,gt.player_get_lives)()),(0,Oe.font_set_text)(Lt[0],"%d",(0,gt.player_get_score)());var L=parseInt(R%60,10);if(L<10&&(L="0"+L),(0,Oe.font_set_text)(Lt[1],"%s",parseInt(R/60,10)+":"+L),(0,Oe.font_set_text)(Lt[2],"%d",(0,gt.player_get_rings)()),ne&&(R<5?R<1.5?(ne.position.y+=360*S,ne.position.y>-2&&(ne.position.y=-2),oe.position.x-=320*S,oe.position.x<140&&(oe.position.x=140),ae.position.y-=200*S,ae.position.y<200&&(ae.position.y=200)):R>3.5&&(ne.position.x-=320*S):(ne.visible=!1,oe.visible=!1,ae.visible=!1)),Y){var T=0,k=(0,be.timer_get_ticks)(),j=(0,pe.soundfactory_get)("ring count"),re=(0,pe.soundfactory_get)("cash"),ie=(0,pe.soundfactory_get)("glasses");if(k>=W+2e3){for(e=0;e<St.length;e++)St[e]&&(St[e].actor.speed.x=0);for(Z.position.x=Math.min(Z.position.x+800*S,30),ee.position.x=Math.min(ee.position.x+700*S,12),te.position.x=Math.max(te.position.x-700*S,250),e=0;e<3;e++)Tt[e].position.x=Math.min(Tt[e].position.x+(400-50*e)*S,50),Rt[e].position.x=Math.max(Rt[e].position.x-(400-50*e)*S,230);T=J-(Ot+$),(0,Oe.font_set_text)(Rt[0],"%d",parseInt(Ot,10)),(0,Oe.font_set_text)(Rt[1],"%d",parseInt($,10)),(0,Oe.font_set_text)(Rt[2],"%d",parseInt(T,10)),Q||((0,ue.music_stop)(),(0,ue.sound_play)((0,pe.soundfactory_get)("goal")),Q=!0)}if(k>=W+6e3&&!z)if(Ot=Math.max(0,Ot-400*S),$=Math.max(0,$-2e3*S),Ot>0||$>0)j&&k>=X&&(X=k+100,(0,ue.sound_play)(j));else for(z=!0,K=k+4e3,(0,ue.sound_play)(re),e=0;e<St.length;e++)if(St[e].got_glasses){(0,ue.sound_play)(ie);break}z&&k>=K&&(q=!0)}for(wn(),Sn(),I=!1,e=0;e<St.length;e++)St[e].dying&&(I=!0);for(f=Dn(),n=kn(),r=null,(0,ut.background_update)(A),b=It;b;b=b.next)if(b.data&&b.data.actor){var _e=b.data.actor.position.x,ce=b.data.actor.position.y,se=(0,xe.actor_image)(b.data.actor).width,de=(0,xe.actor_image)(b.data.actor).height;if(Gn(_e,ce,se,de,ht)){if((0,Re.item_update)(b.data,St,3,n,It,yt),b.data.obstacle){var Te=void 0,ke=void 0,Pe=(0,Ie.v2d_add)(b.data.actor.hot_spot,(0,Ie.v2d_new)(0,-1)),Ce=(0,xe.actor_image)(b.data.actor),qe=Rn(Ce.width,Ce.height-1,(0,Ie.v2d_subtract)(b.data.actor.position,Pe),0);qe.brick_ref.zindex=b.data.bring_to_back?.4:.5,(Te={}).next=r,Te.data=qe,r=Te,(ke={}).next=n,ke.data=qe,n=ke}}else b.data.preserve||(b.data.state=Re.IS_DEAD)}for(E=yt;E;E=E.next)if(E.data){var ot=E.data.actor.position.x,st=E.data.actor.position.y,ft=(0,xe.actor_image)(E.data.actor).width,vt=(0,xe.actor_image)(E.data.actor).height;if(Gn(ot,st,ft,vt,ht)||E.data.always_active){if(B&&B.actor&&!(0,me.input_is_ignored)(B.actor.input)&&(I||Y||(0,Le.enemy_update)(E.data,St,St.length,n,f,yt)),E.data.obstacle){var bt=void 0,xt=void 0,Nt=(0,Ie.v2d_add)(E.data.actor.hot_spot,(0,Ie.v2d_new)(0,-1)),kt=(0,xe.actor_image)(E.data.actor),Pt=Rn(kt.width,kt.height-1,(0,Ie.v2d_subtract)(E.data.actor.position,Nt),E.data.obstacle_angle);(bt={}).next=r,bt.data=Pt,r=bt,(xt={}).next=n,xt.data=Pt,n=xt}}else E.data.preserve?Gn(E.data.actor.spawn_point.x,E.data.actor.spawn_point.y,ft,vt,ht)||(E.data.actor.position=(0,Ie.v2d_new)(E.data.actor.spawn_point.x,E.data.actor.spawn_point.y)):E.data.state=Re.IS_DEAD}if(Un()&&B&&B.actor){var Dt,jt=B.actor,At=[jt.position.x,jt.position.y,jt.position.x+1,jt.position.y+1],Bt=[C.rect_x,C.rect_y,C.rect_x+C.rect_w,C.rect_y+C.rect_h];if(I||(0,pt.fU)(C,St,Et),!(0,pt.xi)(C)&&(0,Ee.bounding_box)(At,Bt)&&(F=!0,H=!0),!(0,pt.xi)(C))for(e=0;e<St.length;e++)(St[e]!=B||B.actor.carrying)&&((Dt=St[e].actor).position.x>C.rect_x-30&&Dt.position.x<C.rect_x&&(Dt.position.x=C.rect_x-30,Dt.speed.x=0),Dt.position.x>C.rect_x+C.rect_w&&Dt.position.x<C.rect_x+C.rect_w+30&&(Dt.position.x=C.rect_x+C.rect_w+30,Dt.speed.x=0));((0,pt.xi)(C)||B.dying)&&(F=!1,N&&((0,ue.music_set_volume)((0,ue.music_get_volume)()-.5*S),(0,ue.music_get_volume)()<fe.EPSILON&&((0,ue.music_stop)(),(0,ue.music_set_volume)(1),P=!0)))}for(e=0;e<St.length;e++)(0,me.input_ignore)(St[e].actor.input);for(B&&B.actor&&R>=3.5&&(0,me.input_restore)(B.actor.input),e=0;e<St.length;e++){var Mt=St[e].actor.position.x,Ct=St[e].actor.position.y,Ft=(0,xe.actor_image)(St[e].actor).width,Ht=(0,xe.actor_image)(St[e].actor).height,Gt=St[e].actor.hot_spot.y;if(e!=M&&(St[e].getting_hit&&Ln(e),St[e].dying&&(Ln(e),wt!=St[e].actor&&(0,we.q1)(St[e].actor.position,0))),St[e].dead){if(!((0,gt.player_get_lives)()>1))return(0,dt.scenestack_pop)(),void(0,dt.scenestack_push)((0,lt.storyboard_get_scene)(lt.SCENE_GAMEOVER));if((0,ye.video_fadefx_over)())return(0,gt.player_set_lives)((0,gt.player_get_lives)()-1),void fn();(0,ye.video_fadefx_out)((0,ge.image_rgb)(0,0,0),1)}if(q){if((0,ye.video_fadefx_over)())return void(0,dt.scenestack_pop)();(0,ye.video_fadefx_out)((0,ge.image_rgb)(0,0,0),1)}(Gn(Mt,Ct,Ft,Ht,ht/4)||St[e].dying)&&(!I||St[e].dying||St[e].getting_hit)&&(0,gt.player_update)(St[e],St,n),St[e].actor.position.y<Gt&&!St[e].dying?(St[e].actor.position.y=Gt,St[e].actor.speed.y=0):St[e].actor.position.y>O-(Ht-Gt)&&Gn(Mt,Ct,Ft,Ht,ht/4)&&(0,gt.player_kill)(St[e])}if(I||Y||(R+=(0,be.timer_get_delta)()/1e3,B&&(0,me.input_button_pressed)(B.actor.input,me.IB_FIRE2)&&(!(Math.abs(B.actor.speed.y)<fe.EPSILON)||B.on_moveable_platform||F||B.disable_movement||B.in_locked_area?(0,ue.sound_play)((0,pe.soundfactory_get)("deny")):Ln((M+1)%3))),Un()&&F){var Ut=B.actor;Ut&&(Ut.position.x<C.rect_x?(Ut.position.x=C.rect_x,Ut.speed.x=Math.max(0,Ut.speed.x)):Ut.position.x>C.rect_x+C.rect_w&&(Ut.position.x=C.rect_x+C.rect_w,Ut.speed.x=Math.min(Ut.speed.x,0)),Ut.position.y=(0,Ee.clip)(Ut.position.y,C.rect_y,C.rect_y+C.rect_h))}for(In(n),u=n;u;u=u.next){if(u.data&&u.data.brick_ref.behavior==Se.BRB_BREAKABLE){var Vt=u.data.brick_ref.image.width,Yt=u.data.brick_ref.image.height,Wt=[u.data.x,u.data.y,u.data.x+Vt,u.data.y+Yt],Kt=[u.data.x,u.data.y,u.data.x+Vt,u.data.y+Yt];for(e=0;e<St.length;e++)if(St[e]&&(Wt[0]=St[e].actor.position.x-St[e].actor.hot_spot.x-3,Wt[1]=St[e].actor.position.y-St[e].actor.hot_spot.y-3,Wt[2]=Wt[0]+(0,xe.actor_image)(St[e].actor).width+6,Wt[3]=Wt[1]+(0,xe.actor_image)(St[e].actor).height+6,(St[e].spin_dash||St[e].spin||St[e].type==gt.PL_KNUCKLES)&&(0,Ee.bounding_box)(Wt,Kt))){var Xt,zt,qt=void 0,Qt=void 0;for(zt=Math.max(u.data.brick_ref.behavior_arg[0],1),Xt=Math.max(u.data.brick_ref.behavior_arg[1],1),qt=0;qt<zt;qt++)for(Qt=0;Qt<Xt;Qt++){var $t=(0,Ie.v2d_new)(u.data.x+qt*Vt/zt,u.data.y+Qt*Yt/Xt),Jt=(0,Ie.v2d_new)(.3*-St[e].actor.speed.x,-100-(0,Ee.random)(50)),Zt=(0,ge.image_create)(Vt/zt,Yt/Xt);Math.abs(Jt.x)>fe.EPSILON&&(Jt.x+=(Jt.x>0?1:-1)*(0,Ee.random)(50)),on(Zt,$t,Jt,!1)}(0,ue.sound_play)((0,pe.soundfactory_get)("break")),u.data.state=Se.BRS_DEAD}}if(u.data&&u.data.brick_ref.behavior==Se.BRB_FALL&&u.data.state==Se.BRS_ACTIVE){var en=u.data;if(en.value[1]+=(0,be.timer_get_delta)(),en.value[1]>=Se.BRB_FALL_TIME){var tn,nn,an=void 0,rn=void 0,_n=0!=parseInt(en.brick_ref.behavior_arg[2],10),cn=en.brick_ref.image;for(tn=Math.max(en.brick_ref.behavior_arg[0],1),nn=Math.max(en.brick_ref.behavior_arg[1],1),an=0;an<tn;an++)for(rn=0;rn<nn;rn++){var ln=(0,Ie.v2d_new)(en.x+an*cn.width/tn,en.y+rn*cn.height/nn),un=(0,Ie.v2d_new)(0,20+20*rn+20*(_n?an:tn-an)),pn=(0,ge.image_create)(cn.width/tn,cn.height/nn);on(pn,ln,un,!1)}(0,ue.sound_play)((0,pe.soundfactory_get)("break")),en.state=Se.BRS_DEAD}}Fn(u.data)}for(u=r;u;u=p)p=u.next,Cn(u.data),u=null;if(r=null,Pn(n),jn(f),B&&B.actor&&Hn(B.actor),Y)(0,we.q1)((0,Ie.v2d_add)(wt.position,(0,Ie.v2d_new)(0,-90)),.17);else if(F){var gn=[C.rect_x+ye.VIDEO_SCREEN_W/2,C.rect_x+C.rect_w-ye.VIDEO_SCREEN_W/2],mn=(0,Ie.v2d_new)((0,Ee.clip)(wt.position.x,gn[0],gn[1]),wt.position.y);(0,we.q1)((0,Ie.v2d_add)(mn,(0,Ie.v2d_new)(0,-90)),.17)}else I||(0,we.q1)(wt.position,.1);(0,we.LF)()}xn()},Bt=function(){if((0,ye.video_clearDisplay)(),Fe())return t=(0,Ie.v2d_subtract)(De,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2)),ye.VIDEO_SCREEN_W,r.width,ye.VIDEO_SCREEN_H,r.height,function(){if(Ce){var e,t,n,a,o=(0,Ie.v2d_subtract)(De,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2));for(n=(0,ge.image_create)(1,1),a=(0,ge.image_rgb)(0,128,160),(0,ge.image_clear)(n,0,0,0),e=0;e<n.height;e++)(0,ge.image_putpixel)(n,(0,ye.video_get_backbuffer)(),n.width-1,e,a);for(e=0;e<n.width;e++)(0,ge.image_putpixel)(n,(0,ye.video_get_backbuffer)(),e,n.height-1,a);for(e=0;e<=ye.VIDEO_SCREEN_W/1;e++)for(t=0;t<=ye.VIDEO_SCREEN_H/1;t++)(0,Ie.v2d_subtract)(Ze((0,Ie.v2d_new)(e*n.width,t*n.height)),o);(0,ge.image_destroy)(n)}}(),cn(),qe(s,Ae,(0,Ie.v2d_subtract)(Ze(je),t)),e=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ARROW",0),0),(0,ge.image_blit)(e.data,(0,ye.video_get_backbuffer)(),e.sx,e.sy,parseInt(je.x,10),parseInt(je.y,10),e.width,e.height),(0,Oe.font_render)(d,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2)),void(0,Oe.font_render)(l,(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2));var e,t;(0,ut.background_render_bg)(A,(0,we.gY)()),gn(),(0,ut.background_render_fg)(A,(0,we.gY)()),vn()},Mt=function(){var e;for((0,ve.logfile_message)("level_release()"),(0,ge.image_destroy)(j),un(),e=0;e<St.length;e++)(0,gt.player_destroy)(St[e]);for((0,we.Xq)(),(0,ve.logfile_message)("editor_release()"),(0,Te.tk)(),(0,me.input_destroy)(c),(0,me.input_destroy)(_),(0,me.input_destroy)(i),(0,Oe.font_destroy)(l),(0,Oe.font_destroy)(d),Ne=!1,s=2,Ae=0,(0,ve.logfile_message)("editor_release() ok"),(0,xe.actor_destroy)(U),(0,xe.actor_destroy)(G),(0,Oe.font_destroy)(V),e=0;e<St.length;e++)(0,Oe.font_destroy)(Lt[e]);for((0,xe.actor_destroy)(ne),(0,xe.actor_destroy)(ae),(0,Oe.font_destroy)(oe),(0,Oe.font_destroy)(Z),(0,Oe.font_destroy)(ee),(0,xe.actor_destroy)(te),e=0;e<3;e++)(0,Oe.font_destroy)(Rt[e]),(0,xe.actor_destroy)(Tt[e]);(0,Oe.font_destroy)(ce),(0,Oe.font_destroy)(se),(0,xe.actor_destroy)(_e),(0,ve.logfile_message)("level_release() ok")},Ct=function(){return Fe()},Ft=function(){return B},Ht=function(){return M},Gt=function(e){var t;e=Math.max(0,e),(0,gt.player_set_score)((0,gt.player_get_score)()+e),t=nn(Re.IT_FLYINGTEXT,(0,Ie.v2d_add)(B.actor.position,(0,Ie.v2d_new)(-9,0))),(0,ft.flyingtext_set_text)(t,e)},Ut=function(){return(0,Ie.v2d_new)(L,O)},Vt=function(e){N&&(0,ue.music_stop)(),k=e,(0,ue.sound_play)(k)},Yt=function(e){T=(0,Ie.v2d_new)(e.x,e.y)},Wt=function(e){var t;if(!Y){for(Y=!0,W=(0,be.timer_get_ticks)(),Ot=10*(0,gt.player_get_rings)(),J+=Ot,t=0;t<St.length;t++)St[t]&&St[t].got_glasses&&Kt(5e3);for((0,gt.player_set_score)((0,gt.player_get_score)()+J),t=0;t<St.length;t++)St[t]&&((0,me.input_ignore)(St[t].actor.input),St[t].spin_dash=!1);for(Hn(e),zt(),(Z=(0,Oe.font_set_text)(Z,"TEAM SONIC")).position=(0,Ie.v2d_new)(-500,20),(ee=(0,Oe.font_set_text)(ee,"GOT THROUGH")).position=(0,Ie.v2d_new)(-500,46),(te=(0,xe.actor_change_animation)(te,(0,he.sprite_get_animation)("SD_LEVELACT",S-1))).position=(0,Ie.v2d_new)(820,25),t=0;t<3;t++)Tt[t].position=(0,Ie.v2d_new)(-500,120+20*t),Rt[t].position=(0,Ie.v2d_new)(820,120+20*t);Tt[0]=(0,xe.actor_change_animation)(Tt[0],(0,he.sprite_get_animation)("SD_RINGBONUS",0)),Tt[1]=(0,xe.actor_change_animation)(Tt[1],(0,he.sprite_get_animation)("SD_SECRETBONUS",0)),Tt[2]=(0,xe.actor_change_animation)(Tt[2],(0,he.sprite_get_animation)("SD_TOTAL",0))}},Kt=function(e){$+=e,J+=e},Xt=function(e,t){(!re||(0,Oe.font_get_text)(ce)||(0,Oe.font_get_text)(se))&&(re=!0,ie=(0,be.timer_get_ticks)(),(0,Oe.font_set_text)(ce,e),(0,Oe.font_set_text)(se,t),(0,Oe.font_set_width)(se,260))},zt=function(){re=!1},qt=function(){return H},Qt=function(){var e,t;for(e=yt;e;e=e.next)(t=e.data)&&(t.state=1)},$t=function(e,t,n,a){(0,we.vY)(e+ye.VIDEO_SCREEN_W/2,t+ye.VIDEO_SCREEN_H/2,n-ye.VIDEO_SCREEN_W/2,a-ye.VIDEO_SCREEN_H/2)},Jt=function(){(0,we.H1)()},Zt=function(){null!=N&&(0,ue.music_stop)()},en=function(){return w},tn=function(e,t){var n,a;for((a={}).data={},a.data.brick_ref=(0,Se.brick_get)(e),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(t.x,10),a.data.y=a.data.sy=parseInt(t.y,10),a.data.enabled=!0,a.data.state=Se.BRS_IDLE,a.data.value=[],n=0;n<Se.BRICK_MAXVALUES;n++)a.data.value[n]=0;return Nn(a),a.data},nn=function(e,t){var n={};return n.data=(0,Re.item_create)(e),n.data&&(n.data.actor.spawn_point=(0,Ie.v2d_new)(t.x,t.y),n.data.actor.position=(0,Ie.v2d_new)(t.x,t.y)),n.next=It,It=n,n.data},an=function(e,t){var n,a=(0,Ie.v2d_new)(t.x,t.y);return(n={}).data=(0,Le.enemy_create)(e),n.data.actor.spawn_point=(0,Ie.v2d_new)(a.x,a.y),n.data.actor.position=(0,Ie.v2d_new)(a.x,a.y),n.next=yt,yt=n,n.data},on=function(e,t,n,a){var o,r;Fe()?(0,ge.image_destroy)(e):((o={}).image=e,o.position=t,o.speed=n,o.destroy_on_brick=a,(r={}).data=o,r.next=xt,xt=r)},rn=function(e,t){var n,a,o,r,i,_;return e?(n=e.value[0],e.brick_ref.behavior===Se.BRB_CIRCULAR?(a=e.brick_ref.behavior_arg[0],o=e.brick_ref.behavior_arg[1],r=e.brick_ref.behavior_arg[2]*(2*fe.PI),i=e.brick_ref.behavior_arg[3]*(2*fe.PI),_=e.brick_ref.behavior_arg[4]*fe.PI/180,(0,Ie.v2d_new)(-a*r*Math.sin(r*n+_),o*i*Math.cos(i*n+_))):(0,Ie.v2d_new)(0,0)):(0,Ie.v2d_new)(0,0)},_n=function(e){return nn(Re.IT_ANIMAL,e)},cn=function(){gn()},sn=function(){return Et},dn=function(e){return pn(e)},ln=function(){On()},un=function(){var e,t,n,a,o,r;for((0,ve.logfile_message)("level_unload()"),N.pause(),(0,ve.logfile_message)("releasing brick list..."),e=Et;e;e=t)t=e.next,e.data=null,e=null;for(Et=null,(0,ve.logfile_message)("releasing item list..."),n=It;n;n=a)a=n.next,(0,Re.item_destroy)(n.data),n=null;for(It=null,(0,ve.logfile_message)("releasing enemy list..."),o=yt;o;o=r)r=o.next,(0,Le.enemy_destroy)(o.data),o=null;yt=null,Un()&&((0,ve.logfile_message)("releasing the boss..."),(0,pt.uX)(C),C=null),(0,ve.logfile_message)("unloading the brickset..."),(0,ve.logfile_message)("unloading the background..."),(0,ve.logfile_message)("level_unload() ok")},pn=function(e){var t;for(t=0;t<(0,Se.brick_size)();t++)if(e.brick_ref==(0,Se.brick_get)(t))return t;return-1},fn=function(){var e=T;Mt(),jt(),T=e},gn=function(){var e,t,n,a,o={};for(t=e=kn();t;t=t.next)t.data&&t.data.brick_ref.zindex<.5&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,ye.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,we.gY)().x,10)-ye.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,we.gY)().y,10)-ye.VIDEO_SCREEN_H/2),o.width*ye.VIDEO_SCALE,o.height*ye.VIDEO_SCALE));for(mn(!0),t=e;t;t=t.next)if(t.data){var r=t.data.brick_ref;Math.abs(r.zindex-.5)<fe.EPSILON&&r.property!=Se.BRK_OBSTACLE&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,ye.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,we.gY)().x,10)-ye.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,we.gY)().y,10)-ye.VIDEO_SCREEN_H/2),o.width*ye.VIDEO_SCALE,o.height*ye.VIDEO_SCALE))}for(n=It;n;n=n.next)n.data&&n.data.bring_to_back&&(0,Re.item_render)(n.data,(0,we.gY)());for(t=e;t;t=t.next)if(t.data){var i=t.data.brick_ref;Math.abs(i.zindex-.5)<fe.EPSILON&&i.property==Se.BRK_OBSTACLE&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,ye.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,we.gY)().x,10)-ye.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,we.gY)().y,10)-ye.VIDEO_SCREEN_H/2),o.width*ye.VIDEO_SCALE,o.height*ye.VIDEO_SCALE))}for(Un()&&!C.bring_to_front&&(0,pt.GO)(C,(0,we.gY)()),a=yt;a;a=a.next)(0,Le.enemy_render)(a.data,(0,we.gY)());for(mn(!1),Un()&&C.bring_to_front&&(0,pt.GO)(C,(0,we.gY)()),n=It;n;n=n.next)n.data&&(0,Re.item_render)(n.data,(0,we.gY)());for(yn(),t=e;t;t=t.next)t.data&&t.data.brick_ref.zindex>.5&&(t.data=(0,Se.brick_animate)(t.data),o=(0,Se.brick_image)(t.data),(0,ye.video_get_backbuffer)().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt((0,we.gY)().x,10)-ye.VIDEO_SCREEN_W/2),t.data.y-(parseInt((0,we.gY)().y,10)-ye.VIDEO_SCREEN_H/2),o.width*ye.VIDEO_SCALE,o.height*ye.VIDEO_SCALE));Pn(e)},mn=function(e){if(B){var t;for(t=St.length-1;t>=0;t--)St[t]!=B&&!!St[t].bring_to_back==e&&(0,gt.player_render)(St[t],(0,we.gY)());!!B.bring_to_back==e&&(0,gt.player_render)(B,(0,we.gY)())}},vn=function(){var e,t=(0,Ie.v2d_new)(ye.VIDEO_SCREEN_W/2,ye.VIDEO_SCREEN_H/2);if(Y)for((0,xe.actor_render)(te,t),(0,Oe.font_render)(Z,t),(0,Oe.font_render)(ee,t),e=0;e<3;e++)(0,xe.actor_render)(Tt[e],t),(0,Oe.font_render)(Rt[e],t);else{for((0,xe.actor_render)(G,t),(0,xe.actor_render)(U,t),(0,Oe.font_render)(V,t),e=0;e<3;e++)(0,Oe.font_render)(Lt[e],t);hn()}R<2.5&&(0,ye.video_clearDisplay)("rgb(0,0,0)"),(0,xe.actor_render)(ne,t),(0,xe.actor_render)(ae,t),(0,Oe.font_render)(oe,t),bn(t)},hn=function(){var e,t=[],n=[],a=0,o=.001*(0,be.timer_get_ticks)();for(e=0;e<10;e++)n[e]=!0;if(B){switch(B.got_glasses&&(t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",6),0)),B.shield_type){case gt.SH_SHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",7),0);break;case gt.SH_FIRESHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",11),0);break;case gt.SH_THUNDERSHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",12),0);break;case gt.SH_WATERSHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",13),0);break;case gt.SH_ACIDSHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",14),0);break;case gt.SH_WINDSHIELD:t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",15),0)}if(B.invincible&&(t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",4),0),B.invtimer>=.75*gt.PLAYER_MAX_INVINCIBILITY)){var r=(gt.PLAYER_MAX_INVINCIBILITY-B.invtimer)/(.25*gt.PLAYER_MAX_INVINCIBILITY);n[a-1]=Math.sin(.5*fe.PI*o/(r+.1))>=0}if(B.got_speedshoes&&(t[a++]=(0,he.sprite_get_image)((0,he.sprite_get_animation)("SD_ICON",5),0),B.speedshoes_timer>=.75*gt.PLAYER_MAX_SPEEDSHOES)){var i=(gt.PLAYER_MAX_SPEEDSHOES-B.speedshoes_timer)/(.25*gt.PLAYER_MAX_SPEEDSHOES);n[a-1]=Math.sin(.5*fe.PI*o/(i+.1))>=0}}for(e=0;e<a;e++)n[e]&&(0,ge.image_blit)(t[e].data,(0,ye.video_get_backbuffer)(),t[e].sx,t[e].sy,ye.VIDEO_SCREEN_W-(t[e].width+5)*(e+1),5,t[e].swidth,t[e].sheight)},bn=function(e){(0,xe.actor_render)(_e,e),(0,Oe.font_render)(ce,e),(0,Oe.font_render)(se,e)},En=function(){xt=null},In=function(e){var t,n,a,o,r,i=(0,be.timer_get_delta)(),_=w,c=null;for(a=xt;a;a=o)if(r=a.data){if(n=Gn(r.position.x,r.position.y,r.position.x+r.image.width,r.position.y+r.image.height,ht),t=!1,r.destroy_on_brick&&n&&r.speed.y>0){var s=[r.position.x,r.position.y,r.position.x+r.image.width,r.position.y+r.image.height],d=void 0;for(d=e;d&&!t;d=d.next){var l=d.data;if(l&&l.brick_ref.property==Se.BRK_OBSTACLE&&0==l.brick_ref.angle){var u=[l.x,l.y,l.x+l.brick_ref.image.width,l.y+l.brick_ref.image.height];(0,Ee.bounding_box)(s,u)&&(t=!0)}}}!n||t?c?c.next=o:xt=o:(r.position.x+=r.speed.x*i,r.position.y+=r.speed.y*i+.5*_*(i*i),r.speed.y+=_*i,c=a)}},yn=function(){var e,t,n=(0,Ie.v2d_new)((0,we.gY)().x-ye.VIDEO_SCREEN_W/2,(0,we.gY)().y-ye.VIDEO_SCREEN_H/2);for(e=xt;e;e=e.next)(t=e.data)&&(0,ge.image_draw)(t.image,(0,ye.video_get_backbuffer)(),parseInt(t.position.x-n.x,10),parseInt(t.position.y-n.y,10),fe.IF_NONE)},xn=function(){null==N||Y||P||(0,ue.music_is_playing)()||(k=null,(0,ue.music_play)(N,!0))},Sn=function(){if(_e){var e=(0,be.timer_get_delta)(),t=(0,be.timer_get_ticks)();if(re){if(t>=ie+7e3)return void(re=!1);_e.position.x=(ye.VIDEO_SCREEN_W-(0,xe.actor_image)(_e).width)/2,_e.position.y=Math.max(_e.position.y-100*e,ye.VIDEO_SCREEN_H-1.3*(0,xe.actor_image)(_e).height)}else _e.position.y=Math.min(_e.position.y+100*e,ye.VIDEO_SCREEN_H);ce.position=(0,Ie.v2d_add)(_e.position,(0,Ie.v2d_new)(2,10)),se.position=(0,Ie.v2d_add)(_e.position,(0,Ie.v2d_new)(2,23))}},wn=function(){if(B&&B.actor){var e,t=[],n=[];if(!(R<2))for(t[0]=B.actor.position.x,t[1]=B.actor.position.y,t[2]=t[0]+(0,xe.actor_image)(B.actor).width,t[3]=t[1]+(0,xe.actor_image)(B.actor).height,e=0;e<de;e++)if(!Nt[e].disabled&&(n[0]=Nt[e].rect_x,n[1]=Nt[e].rect_y,n[2]=n[0]+Nt[e].rect_w,n[3]=n[1]+Nt[e].rect_h,(0,Ee.bounding_box)(t,n))){Nt[e].disabled=!0,Xt(Nt[e].title,Nt[e].message);break}}},Ln=function(e){B.spin_dash=B.braking=!1,St[M=e]&&(B=St[M],Hn(B.actor),(0,me.input_restore)(B.actor.input))},On=function(){var e,t;for(e=0;e<St.length;e++)t=parseInt(T.x,10)<=L/2?2-e:e,St[e].actor.mirror=parseInt(T.x,10)<=L/2?fe.IF_NONE:fe.IF_HFLIP,St[e].actor.spawn_point.x=St[e].actor.position.x=T.x+15*t,St[e].actor.spawn_point.y=St[e].actor.position.y=T.y},Rn=function(e,t,n,a){var o,r={},i={data:null};for(i.image=(0,ge.image_create)(e,t),i.angle=a,i.property=Se.BRK_OBSTACLE,i.behavior=Se.BRB_DEFAULT,i.zindex=.5,i.behavior_arg=[],o=0;o<Se.BRICKBEHAVIOR_MAXARGS;o++)i.behavior_arg[o]=0;for(r.brick_ref=i,r.animation_frame=0,r.enabled=!0,r.x=r.sx=parseInt(n.x,10),r.y=r.sy=parseInt(n.y,10),r.value=[],o=0;o<Se.BRICK_MAXVALUES;o++)r.value[o]=0;return r},Tn=function(e,t){var n=e.brick_ref,a=t.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var o=[0,100,50];return o[n.property]-o[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:e.sy-t.sy},Nn=function(e){var t;if(Et)if(Tn(e.data,Et.data)>=0)e.next=Et,Et=e;else{for(t=Et;t.next&&Tn(t.next.data,e.data)>0;)t=t.next;e.next=t.next,t.next=e}else e.next=null,Et=e},kn=function(){var e,t,n,a,o,r,i=[];for(e=Et;e;e=e.next)e.data&&e.data.brick_ref&&e.data.brick_ref.image&&(n=Math.min(e.data.x,e.data.sx),a=Math.min(e.data.y,e.data.sy),o=e.data.brick_ref.image.width,r=e.data.brick_ref.image.height,(Gn(n,a,o,r,2*ht)||e.data.brick_ref.behavior==Se.BRB_CIRCULAR)&&((t={}).data=e.data,t.next=i,i=t));return i},Pn=function(e){for(var t;e;)t=e.next,e=null,e=t},Dn=function(){var e,t,n,a,o,r,i,_=null;for(e=It;e;e=e.next)e.data&&(i=(0,xe.actor_image)(e.data.actor))&&(n=parseInt(e.data.actor.position.x,10),a=parseInt(e.data.actor.position.y,10),o=i.width,r=i.height,Gn(n,a,o,r,ht)&&((t={}).data=e.data,t.next=_,_=t));return _},jn=function(e){for(var t;e;)t=e.next,e=null,e=t},An=function(){var e,t;if(It)for(It.data&&It.data.state==Re.IS_DEAD&&(t=It.next,(0,Re.item_destroy)(It.data),It=t),e=It;e&&e.next;e=e.next)e.next&&e.next.data&&e.next.data.state==Re.IS_DEAD&&(t=e.next,e.next=t.next,(0,Re.item_destroy)(t.data),t=null)},Bn=function(){var e,t;if(yt)for(yt&&yt.data&&yt.data.state==Le.ES_DEAD&&(t=yt.next,(0,Le.enemy_destroy)(yt.data),yt=null,yt=t),e=yt;e&&e.next;e=e.next)e&&e.next&&e.next.data&&e.next.data.state==Le.ES_DEAD&&(t=e.next,e.next=t.next,(0,Le.enemy_destroy)(t.data),t=null)},Mn=function(){var e,t;if(Et)for(Et.data&&Et.data.state==Se.BRS_DEAD&&(t=Et.next,Et.data=null,Et=null,Et=t),e=Et;e&&e.next;e=e.next)e.next.data.state==Se.BRS_DEAD&&(t=e.next,e.next=t.next,t.data=null,t=null)},Cn=function(e){(0,ge.image_destroy)(e.brick_ref.image),e.brick_ref=null,e=null},Fn=function(e){var t,n,a,o,r,i;e&&(e.value[0]+=(0,be.timer_get_delta)(),t=e.value[0],e.brick_ref.behavior===Se.BRB_CIRCULAR)&&(n=e.brick_ref.behavior_arg[0],a=e.brick_ref.behavior_arg[1],o=e.brick_ref.behavior_arg[2]*(2*fe.PI),r=e.brick_ref.behavior_arg[3]*(2*fe.PI),i=e.brick_ref.behavior_arg[4]*fe.PI/180,e.x=e.sx+Math.round(n*Math.cos(o*t+i)),e.y=e.sy+Math.round(a*Math.sin(r*t+i)))},Hn=function(e){wt={position:{x:e.position.x,y:e.position.y}}},Gn=function(e,t,n,a,o){var r=(0,we.gY)(),i=[e,t,e+n,t+a],_=[r.x-ye.VIDEO_SCREEN_W/2-o,r.y-ye.VIDEO_SCREEN_H/2-o,r.x+ye.VIDEO_SCREEN_W/2+o,r.y+ye.VIDEO_SCREEN_H/2+o];return(0,Ee.bounding_box)(i,_)},Un=function(){return null!=C},Vn=function(e){return b="Untitled",E="",I="",y="",x="",T=(0,Ie.v2d_new)(0,0),de=0,C=null,S=1,new Promise((function(t,n){(0,ve.logfile_message)('level_load("%s")',e),(0,st.resourcemanager_getJsonFile)(e).then(Yn).then((function(){N=(0,ue.music_load)(E),function(){var e,t,n;for(e=t=-fe.INFINITY,n=Et;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(e=Math.max(e,n.data.sx+(0,Se.brick_image)(n.data).width),t=Math.max(t,n.data.sy+(0,Se.brick_image)(n.data).height));L=Math.max(e,ye.VIDEO_SCREEN_W),O=Math.max(t,ye.VIDEO_SCREEN_H)}(),(0,ve.logfile_message)("level_load() ok"),t()}))}))},Yn=function(e){var t;for(I=e.theme,y=e.bgtheme,x=e.grouptheme,E=e.music,b=e.name,e.author,e.version,e.requires,S=e.act,T=e.spawn_point,e.readonly,e.boss&&(C=(0,pt.s8)(e.boss.id,(0,Ie.v2d_new)(e.boss.x,e.boss.y),e.boss.rx,e.boss.ry,e.boss.rw,e.boss.rh)),t=0;t<e.dialogbox.length;t++){var n={disabled:!1};n.rect_x=e.dialogbox[t].xpos,n.rect_y=e.dialogbox[t].ypos,n.rect_w=e.dialogbox[t].width,n.rect_h=e.dialogbox[t].height,n.title=(0,ct.lang_get)(e.dialogbox[t].title),n.message=(0,ct.lang_get)(e.dialogbox[t].message),Nt.push(n),de=Nt.length}for(t=0;t<e.enemylist.length;t++)an(e.enemylist[t].id,(0,Ie.v2d_new)(e.enemylist[t].xpos,e.enemylist[t].ypos));return new Promise((function(n,a){(0,Se.brick_load)(e.theme).then((function(a){for(var o=0;o<e.bricklist.length;o++)tn(e.bricklist[o].id,(0,Ie.v2d_new)(e.bricklist[o].xpos,e.bricklist[o].ypos));(0,ut.background_load)(e.bgtheme).then((function(a){for(A=a,t=0;t<e.itemlist.length;t++)It[t]=nn(e.itemlist[t].id,(0,Ie.v2d_new)(e.itemlist[t].xpos,e.itemlist[t].ypos));n()}))}))}))}},9931:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sound_is_playing=t.sound_stop=t.sound_play_ex=t.sound_play=t.sound_load=t.music_is_playing=t.music_get_volume=t.music_set_volume=t.music_resume=t.music_pause=t.music_stop=t.music_play=t.music_load=t.audio_release=t.audio_update=t.audio_init=void 0;var a=n(9386),o=n(3450),r=n(7898),i=null;t.audio_init=function(){},t.audio_update=function(){},t.audio_release=function(){},t.music_load=function(e){(0,r.logfile_message)('music_load("'.concat(e,'")'));var t=new Audio;return t.src=e,(0,o.resourcemanager_add_music)(e,t),t},t.music_play=function(e,n){if((0,t.music_is_playing)()&&(0,t.music_stop)(),null!=e){e.loop=!!n;try{e.play()}catch(e){}}i=e},t.music_stop=function(){null!=i&&i.pause(),i=null},t.music_pause=function(){null==i||i.paused||i.pause()},t.music_resume=function(){null!=i&&i.paused&&i.play()},t.music_set_volume=function(e){null!=i&&(e>1&&(e=1),e<0&&(e=0),i.volume=e)},t.music_get_volume=function(){return null!=i?i.volume:0},t.music_is_playing=function(){return null!=i&&!i.paused},t.sound_load=function(e,t){t=a.DATA_ROOT+t;var n=new Audio;n.src=t;var r=new Audio;r.src=t;var i=new Audio;i.src=t;var _=new Audio;return _.src=t,(0,o.resourcemanager_add_sample)(e,n),(0,o.resourcemanager_add_sample)(e+"2",r),(0,o.resourcemanager_add_sample)(e+"3",i),(0,o.resourcemanager_add_sample)(e+"4",_),n},t.sound_play=function(e){(0,t.sound_play_ex)(e)},t.sound_play_ex=function(e){e&&e.play&&e.play()},t.sound_stop=function(e){e&&e.pause()},t.sound_is_playing=function(e){return!!e&&!e.paused}},8251:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commandline_parse=void 0,n(7898);var a=n(5286);t.commandline_parse=function(e){var t={};return t.video_resolution=(0,a.preferences_get_video_resolution)(),t.smooth_graphics=(0,a.preferences_get_smooth_graphics)(),t.fullscreen=(0,a.preferences_get_fullscreen)(),t.show_fps=(0,a.preferences_get_show_fps)(),t.language=(0,a.preferences_get_language)(),t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=o("video_resolution")?o("video_resolution"):t.video_resolution,t.smooth_graphics=o("smooth_graphics")?o("smooth_graphics"):t.smooth_graphics,t.fullscreen=o("fullscreen")?o("fullscreen"):t.fullscreen,t.show_fps=o("show_fps")?o("show_fps"):t.show_fps,t.color_depth=o("color_depth")?o("color_depth"):t.color_depth,t.level=o("level")?o("level"):t.level,t.quest=o("quest")?o("quest"):t.quest,t.language=o("language")?o("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t};var o=function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null}},5197:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.engine_init=void 0;var a=n(9931),o=n(8251),r=n(7774),i=n(6038),_=n(5286),c=n(3450),s=n(2667),d=n(1817),l=n(4470),u=n(9880),p=n(532),f=n(4163),g=n(2954),m=n(642),v=n(7266),h=n(5141),b=n(1459),E=n(2530);t.engine_init=function(e){y();var t=(0,o.commandline_parse)(e);x(t),(0,u.sprite_init)().then((function(){(0,E.font_init)(),S(t,(function(){w(),L(t),I()}))}))};var I=function(){var e;(0,g.runAnimation)((function(){(0,f.timer_update)(),(0,r.input_update)(),(e=(0,s.scenestack_top)())&&(e.update(),e==(0,s.scenestack_top)()&&e.render()),(0,d.screenshot_update)(),(0,m.video_render)(),(0,r.input_render)()}))},y=function(){(0,_.preferences_init)()},x=function(e){(0,f.timer_init)(),(0,m.video_init)(O(),e.video_resolution,e.smooth_graphics,e.fullscreen,e.color_depth,e.show_fps),(0,a.audio_init)(),(0,r.input_init)(),(0,c.resourcemanager_init)()},S=function(e,t){(0,l.soundfactory_init)(),(0,b.enemy_objects_init)(),(0,p.storyboard_init)(),(0,d.screenshot_init)(),(0,i.lang_init)(e.language,(function(){(0,s.scenestack_init)(),t()}))},w=function(){(0,h.player_set_lives)(h.PLAYER_INITIAL_LIVES),(0,h.player_set_score)(0)},L=function(e){e.custom_level?((0,v.level_setfile)(e.custom_level_path),(0,s.scenestack_push)((0,p.storyboard_get_scene)(p.SCENE_LEVEL))):(0,s.scenestack_push)((0,p.storyboard_get_scene)(p.SCENE_INTRO))},O=function(){return""}},9386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=t.PI=t.INT_MAX=t.INFINITY_FLT=t.INFINITY=t.EPSILON=t.GAME_WEBSITE=t.GAME_WIP_VERSION=t.GAME_SUB_VERSION=t.GAME_VERSION=t.GAME_TITLE=t.DATA_ROOT=void 0,t.DATA_ROOT="",t.GAME_TITLE="Open Sonic",t.GAME_VERSION=1,t.GAME_SUB_VERSION=1,t.GAME_WIP_VERSION=1,t.GAME_WEBSITE="http://opensnc.sourceforge.net",t.EPSILON=1e-5,t.INFINITY=1<<30,t.INFINITY_FLT=1/0,t.INT_MAX=999999999,t.PI=Math.PI,t.IF_NONE=0,t.IF_HFLIP=1,t.IF_VFLIP=1},5443:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hashtable_music_t_add=t.hashtable_music_t_create=t.hashtable_sound_t_find=t.hashtable_sound_t_add=t.hashtable_sound_t_create=t.hashtable_image_t_add=t.hashtable_image_t_create=t.hashtable_sprites=t.hashtable_spriteinfo_t_find=t.hashtable_spriteinfo_t_add=t.hashtable_spriteinfo_t_create=void 0;var n={};t.hashtable_spriteinfo_t_create=function(){return n.sprites={},n.sprites},t.hashtable_spriteinfo_t_add=function(e,t,a){n.sprites[t]=a},t.hashtable_spriteinfo_t_find=function(e,t){return n.sprites[t]},t.hashtable_sprites=function(){return n.sprites},t.hashtable_image_t_create=function(){return n.images={},n.images},t.hashtable_image_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_create=function(){return n.samples={},n.samples},t.hashtable_sound_t_add=function(e,t,n){e[t]=n},t.hashtable_sound_t_find=function(e,t){return n.samples[t]},t.hashtable_music_t_create=function(){return n.musics={},n.musics},t.hashtable_music_t_add=function(e,t,n){e[t]=n}},7709:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.image_destroy=t.image_pixelperfect_collision=t.image_clear=t.image_rgb=t.image_line=t.image_putpixel=t.image_blit=t.image_draw=t.image_rectfill=t.image_load=t.image_create=t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=void 0;var a=n(642);t.IF_NONE=0,t.IF_HFLIP=1,t.IF_VFLIP=2;var o={};t.image_create=function(e,t){return(0,a.video_get_backbuffer)().createImageData(e,t)},t.image_load=function(e){return new Promise((function(t,n){if(o[e])return t(o[e]);var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return o[e]=a,t(a)}))}))},t.image_rectfill=function(e,t,n,a,o,r){e.fillStyle=r,e.fillRect(t,n,a-t,o-n)},t.image_draw=function(e,t,n,a){t.putImageData(e,n,a)},t.image_blit=function(e,t,n,a,o,r,i,_){if(!e||!t)return!1;t.drawImage(e,n,a,i,_,o,r,i,_)},t.image_putpixel=function(e,t,n,a,o){t.fillStyle=o,t.fillRect(n,a,n+1,a+1)},t.image_line=function(e,t,n,a,o,r){e.beginPath(),e.moveTo(t,n),e.lineTo(a,o),e.stroke()},t.image_rgb=function(e,t,n){return"rgb(".concat(e,", ").concat(t,", ").concat(n,")")},t.image_clear=function(e,t,n,a){for(var o=0;o<e.data.length;o+=4)e.data[o]=t,e.data[o+1]=n,e.data[o+2]=a},t.image_pixelperfect_collision=function(e,t,n,a,o,r){return!0},t.image_destroy=function(e){e&&(e.data,e=null)}},7774:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.input_ignore=t.input_simulate_button_down=t.input_button_howlong=t.input_button_up=t.input_button_pressed=t.input_button_down=t.input_destroy=t.input_create_user=t.input_create_joystick=t.input_create_mouse=t.input_create_keyboard=t.input_create_computer=t.input_is_joystick_ignored=t.input_ignore_joystick=t.input_joystick_available=t.input_release=t.input_render=t.input_update=t.input_init=t.KEY_P=t.KEY_G=t.KEY_Y=t.KEY_Z=t.KEY_A=t.KEY_D=t.KEY_S=t.KEY_W=t.KEY_B=t.KEY_N=t.KEY_F12=t.KEY_TILDA=t.KEY_ESC=t.KEY_ENTER=t.KEY_LCONTROL=t.KEY_SPACE=t.KEY_LEFT=t.KEY_RIGHT=t.KEY_DOWN=t.KEY_UP=t.input_device_t=t.IB_FIRE5=t.IB_FIRE4=t.IB_FIRE3=t.IB_FIRE2=t.IB_FIRE1=t.IB_RIGHT=t.IB_LEFT=t.IB_DOWN=t.IB_UP=t.inputbutton_t=void 0,t.input_get_xy=t.input_clear=t.input_is_ignored=t.input_restore=void 0;var a,o,r=n(7898),i=n(5823),_=n(4163),c=n(2878),s=n(642),d=n(794);!function(e){e[e.IB_UP=1]="IB_UP",e[e.IB_DOWN=2]="IB_DOWN",e[e.IB_RIGHT=3]="IB_RIGHT",e[e.IB_LEFT=4]="IB_LEFT",e[e.IB_FIRE1=5]="IB_FIRE1",e[e.IB_FIRE2=6]="IB_FIRE2",e[e.IB_FIRE3=7]="IB_FIRE3",e[e.IB_FIRE4=8]="IB_FIRE4",e[e.IB_FIRE5=9]="IB_FIRE5"}(a||(t.inputbutton_t=a={})),t.IB_UP=a.IB_UP,t.IB_DOWN=a.IB_DOWN,t.IB_LEFT=a.IB_LEFT,t.IB_RIGHT=a.IB_RIGHT,t.IB_FIRE1=a.IB_FIRE1,t.IB_FIRE2=a.IB_FIRE2,t.IB_FIRE3=a.IB_FIRE3,t.IB_FIRE4=a.IB_FIRE4,t.IB_FIRE5=a.IB_FIRE5,function(e){e[e.IT_KEYBOARD=1]="IT_KEYBOARD",e[e.IT_MOUSE=2]="IT_MOUSE",e[e.IT_COMPUTER=3]="IT_COMPUTER",e[e.IT_JOYSTICK=4]="IT_JOYSTICK",e[e.IT_USER=5]="IT_USER"}(o||(t.input_device_t=o={})),t.KEY_UP=38,t.KEY_DOWN=40,t.KEY_RIGHT=39,t.KEY_LEFT=37,t.KEY_SPACE=32,t.KEY_LCONTROL=17,t.KEY_ENTER=13,t.KEY_ESC=27,t.KEY_TILDA=192,t.KEY_F12=123,t.KEY_N=78,t.KEY_B=66,t.KEY_W=87,t.KEY_S=83,t.KEY_D=68,t.KEY_A=65,t.KEY_Z=90,t.KEY_Y=89,t.KEY_G=71,t.KEY_P=80;var l=null,u=!1,p=!1,f=!1,g={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},m=null,v=null,h=null,b=null,E=null,I=null,y=null,x=null,S={x:0,y:0},w={left:!1,middle:!1,right:!1};t.input_init=function(){(0,r.logfile_message)("input_init()"),l=null,(0,s.video_get_canvas)().addEventListener("contextmenu",(function(e){if(2===e.button)return e.preventDefault(),!1}),!1),(0,s.video_get_canvas)().addEventListener("mousemove",(function(e){S=(0,s.video_getMousePos)((0,s.video_get_canvas)(),e)}),!1),(0,s.video_get_canvas)().addEventListener("mousedown",(function(e){switch(e.which){case 1:w.left=!0;break;case 2:w.middle=!0;break;case 3:w.right=!0}}),!1),(0,s.video_get_canvas)().addEventListener("mouseup",(function(e){switch(e.which){case 1:w.left=!1;break;case 2:w.middle=!1;break;case 3:w.right=!1}}),!1),u=!1,p=!1,y=(0,i.osspec_canGamepad)(),(f=(0,i.osspec_isTouch)())&&((h=new d.default({container:(0,s.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2||t.pageY<window.innerHeight/2)})),(b=new d.default({container:(0,s.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY<window.innerHeight/2)})),(E=new d.default({container:(0,s.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2||t.pageY>window.innerHeight/2)})),(I=new d.default({container:(0,s.video_get_canvas)(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY>window.innerHeight/2)}))),m=R(g)},t.input_update=function(){var e,n,a=(0,_.timer_get_delta)();for(n=l;n;n=n.next){for(e=0;e<9;e++)n.data.oldstate[e]=n.data.state[e];for(e=0;e<9;e++)(0,t.input_button_down)(n.data,e)?n.data.howlong[e]+=a:n.data.howlong[e]=0;switch(n.data.type){case o.IT_KEYBOARD:n.data.state[t.IB_UP]=m.up,n.data.state[t.IB_DOWN]=m.down,n.data.state[t.IB_LEFT]=m.left,n.data.state[t.IB_RIGHT]=m.right,n.data.state[t.IB_FIRE1]=m.space,n.data.state[t.IB_FIRE2]=m.lcontrol,n.data.state[t.IB_FIRE3]=m.enter,n.data.state[t.IB_FIRE4]=m.esc,n.data.state[t.IB_FIRE5]=m.tilda;break;case o.IT_MOUSE:n.data.x=S.x,n.data.y=S.y,n.data.state[t.IB_FIRE1]=w.left,n.data.state[t.IB_FIRE3]=w.middle,n.data.state[t.IB_FIRE2]=w.right;break;case o.IT_COMPUTER:for(e=0;e<9;e++)n.data.state[e]=!1;break;case o.IT_JOYSTICK:(0,t.input_joystick_available)()&&(n.data.state[t.IB_UP]=v[0].stick[0].axis[1].d1,n.data.state[t.IB_DOWN]=v[0].stick[0].axis[1].d2,n.data.state[t.IB_LEFT]=v[0].stick[0].axis[0].d1,n.data.state[t.IB_RIGHT]=v[0].stick[0].axis[0].d2,n.data.state[t.IB_FIRE1]=v[0].button[0].b,n.data.state[t.IB_FIRE2]=v[0].button[1].b,n.data.state[t.IB_FIRE3]=v[0].button[2].b,n.data.state[t.IB_FIRE4]=v[0].button[3].b);break;case o.IT_USER:n.data.state[t.IB_UP]=m.up,n.data.state[t.IB_DOWN]=m.down,n.data.state[t.IB_LEFT]=m.left,n.data.state[t.IB_RIGHT]=m.right,n.data.state[t.IB_FIRE1]=m.space,n.data.state[t.IB_FIRE2]=m.lcontrol,n.data.state[t.IB_FIRE3]=m.enter,n.data.state[t.IB_FIRE4]=m.esc,f&&(n.data.state[t.IB_UP]=h.up(),n.data.state[t.IB_DOWN]=h.down(),n.data.state[t.IB_LEFT]=h.left(),n.data.state[t.IB_RIGHT]=h.right(),n.data.state[t.IB_FIRE1]=b._pressed,n.data.state[t.IB_FIRE4]=E._pressed,n.data.state[t.IB_FIRE2]=I._pressed),y&&(x=T()),x&&(n.data.state[t.IB_UP]=x.buttons[12].pressed,n.data.state[t.IB_DOWN]=x.buttons[13].pressed,n.data.state[t.IB_LEFT]=x.buttons[14].pressed,n.data.state[t.IB_RIGHT]=x.buttons[15].pressed,n.data.state[t.IB_FIRE1]=x.buttons[0].pressed,n.data.state[t.IB_FIRE2]=x.buttons[1].pressed,n.data.state[t.IB_FIRE3]=x.buttons[2].pressed,n.data.state[t.IB_FIRE4]=x.buttons[3].pressed)}}},t.input_render=function(){h&&h.render((0,s.video_get_backbuffer)()),b&&b.render((0,s.video_get_backbuffer)()),E&&E.render((0,s.video_get_backbuffer)()),I&&I.render((0,s.video_get_backbuffer)())},t.input_release=function(){},t.input_joystick_available=function(){return u&&!p},t.input_ignore_joystick=function(e){p=e},t.input_is_joystick_ignored=function(){return p},t.input_create_computer=function(){for(var e={type:o.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return L(e),e},t.input_create_keyboard=function(e){for(var n={type:o.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},a=0;a<9;a++)n.state[a]=n.oldstate[a]=!1,n.howlong[a]=0;if(e)for(n.keybmap=[],a=0;a<9;a++)n.keybmap[a]=e[a];else n.keybmap[t.IB_UP]=t.KEY_UP,n.keybmap[t.IB_DOWN]=t.KEY_DOWN,n.keybmap[t.IB_RIGHT]=t.KEY_RIGHT,n.keybmap[t.IB_LEFT]=t.KEY_LEFT,n.keybmap[t.IB_FIRE1]=t.KEY_SPACE,n.keybmap[t.IB_FIRE2]=t.KEY_LCONTROL,n.keybmap[t.IB_FIRE3]=t.KEY_ENTER,n.keybmap[t.IB_FIRE4]=t.KEY_ESC,n.keybmap[t.IB_FIRE5]=t.KEY_TILDA;return L(n),n},t.input_create_mouse=function(){for(var e={type:o.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return L(e),e},t.input_create_joystick=function(){if(!(0,t.input_joystick_available)())return(0,r.logfile_message)("WARNING: called input_create_joystick(), but no joystick is available!"),null;for(var e={type:o.IT_JOYSTICK,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;return L(e),e},t.input_create_user=function(){for(var e={type:o.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;return e.keybmap=[],e.keybmap[t.IB_UP]=t.KEY_UP,e.keybmap[t.IB_DOWN]=t.KEY_DOWN,e.keybmap[t.IB_RIGHT]=t.KEY_RIGHT,e.keybmap[t.IB_LEFT]=t.KEY_LEFT,e.keybmap[t.IB_FIRE1]=t.KEY_SPACE,e.keybmap[t.IB_FIRE2]=t.KEY_LCONTROL,e.keybmap[t.IB_FIRE3]=t.KEY_ENTER,e.keybmap[t.IB_FIRE4]=t.KEY_ESC,L(e),e},t.input_destroy=function(e){O(e),e=null},t.input_button_down=function(e,t){return!!t&&!!e.enabled&&e.state[t]},t.input_button_pressed=function(e,t){return!!t&&!!e.enabled&&e.state[t]&&!e.oldstate[t]},t.input_button_up=function(e,t){return!t||!!e.enabled&&!e.state[t]&&e.oldstate[t]},t.input_button_howlong=function(e,t){return e.enabled?e.howlong[t]:0},t.input_simulate_button_down=function(e,t){e.state[t]=!0},t.input_ignore=function(e){e.enabled=!1},t.input_restore=function(e){e.enabled=!0},t.input_is_ignored=function(e){return!e.enabled},t.input_clear=function(e){for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1},t.input_get_xy=function(e){return(0,c.v2d_new)(e.x,e.y)};var L=function(e){l={data:e,next:l}},O=function(e){var t,n;if(l.data==e)n=l.next,l=null,l=n;else{for(t=l;t.next&&t.next.data!=e;)t=t.next;t.next&&(n=t.next.next,t.next=null,t.next=n)}},R=function(e){var t=Object.create(null);function n(n){if(e.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;t[e[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),t},T=function(){return"undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)}},6038:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.lang_get=t.lang_getstring=t.lang_loadfile=t.lang_release=t.lang_init=void 0;var a=n(7898),o=n(3450),r="data/languages/english.json",i={};t.lang_init=function(e,n){(0,a.logfile_message)("Initializing the language module"),r=e||r,(0,t.lang_loadfile)(r).then((function(){(0,a.logfile_message)("lang_init() ok!"),n()}))},t.lang_release=function(){},t.lang_loadfile=function(e){return new Promise((function(t,n){(0,a.logfile_message)('lang_loadfile("'.concat(e,'")...')),(0,o.resourcemanager_getJsonFile)(e).then((function(e){i=e,t(e)}))}))},t.lang_getstring=function(e){return i[e]||e},t.lang_get=function(e){return(0,t.lang_getstring)(e)}},7898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logfile_fatal_error=t.logfile_message=void 0,t.logfile_message=function(e){console.log(e)},t.logfile_fatal_error=function(e){console.log("FATAL ERROR",e)}},5823:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.osspec_canGamepad=t.osspec_isTouch=void 0,t.osspec_isTouch=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},t.osspec_canGamepad=function(){return"undefined"!=typeof navigator&&"getGamepads"in navigator}},5286:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.preferences_set_language=t.preferences_set_show_fps=t.preferences_set_smooth_graphics=t.preferences_set_fullscreen=t.preferences_set_video_resolution=t.preferences_get_language=t.preferences_get_show_fps=t.preferences_get_smooth_graphics=t.preferences_get_fullscreen=t.preferences_get_video_resolution=t.preferences_init=void 0;var a=n(7898),o={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""};t.preferences_init=function(){(0,a.logfile_message)("preferences_init()"),r()},t.preferences_get_video_resolution=function(){return o.video_resolution},t.preferences_get_fullscreen=function(){return o.fullscreen},t.preferences_get_smooth_graphics=function(){return o.smooth_graphics},t.preferences_get_show_fps=function(){return o.show_fps},t.preferences_get_language=function(){return o.language},t.preferences_set_video_resolution=function(e){o.video_resolution=e,i()},t.preferences_set_fullscreen=function(e){o.fullscreen=e,i()},t.preferences_set_smooth_graphics=function(e){o.smooth_graphics=e,i()},t.preferences_set_show_fps=function(e){o.show_fps=e,i()},t.preferences_set_language=function(e){o.language=e,i()};var r=function(){if(o.video_resolution="TINY",o.fullscreen=!1,o.smooth_graphics=!1,o.show_fps=!1,o.language="data/languages/english.json","undefined"!=typeof window)for(var e in o){var t=window.localStorage.getItem(e)?localStorage.getItem(e):o[e];"false"==t&&(t=!1),"true"==t&&(t=!0),o[e]=t}},i=function(){if("undefined"!=typeof window)for(var e in o)o[e],window.localStorage.setItem(e,o[e])}},6093:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quest_unload=t.quest_load=void 0;var a=n(9386),o=n(7709),r=n(7898),i=n(3450);t.quest_load=function(e){return new Promise((function(t,n){var a={file:e,name:"",author:"",version:"",description:"",image:null,level_count:0,levels:[],level_path:[],show_ending:!1};(0,r.logfile_message)('quest_load("'.concat(e,'")')),(0,i.resourcemanager_getJsonFile)(e).then(_).then((function(e){e&&(a=e),(0,r.logfile_message)("load_quest() ok!"),t(a)}))}))},t.quest_unload=function(e){return null};var _=function(e){return new Promise((function(t,n){var r,i={file:"",name:e.name||"",author:e.author||"Open Sonic",version:e.version||"0",description:e.description||"",show_ending:e.show_ending||!1,image:"",levels:e.levels||[],level_count:e.levels?e.levels.length:0,level_path:e.levels||[]};(r=e.image,new Promise((function(e,t){var n=r||"data/images/null.png";n=a.DATA_ROOT+n,(0,o.image_load)(n).then((function(t){e(t)}))}))).then((function(e){i.image=e,t(i)}))}))}},3450:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.resourcemanager_add_music=t.resourcemanager_add_sample=t.resourcemanager_add_image=t.resourcemanager_init=t.resourcemanager_getJsonFile=t.resourcemanager_getJsonFiles=void 0;var a=n(9386),o=n(5443),r={},i={},_={},c={};t.resourcemanager_getJsonFiles=function(e){return Promise.all(e.map(t.resourcemanager_getJsonFile))},t.resourcemanager_getJsonFile=function(e){return e=a.DATA_ROOT+e,new Promise((function(t,n){if(c[e])t(c[e]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(e){}c[e]=n,t(n)}},a.send(null)}}))},t.resourcemanager_init=function(){r=(0,o.hashtable_image_t_create)(),i=(0,o.hashtable_sound_t_create)(),_=(0,o.hashtable_music_t_create)()},t.resourcemanager_add_image=function(e,t){(0,o.hashtable_image_t_add)(r,e,t)},t.resourcemanager_add_sample=function(e,t){(0,o.hashtable_sound_t_add)(i,e,t)},t.resourcemanager_add_music=function(e,t){(0,o.hashtable_music_t_add)(_,e,t)}},2667:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.scenestack_empty=t.scenestack_top=t.scenestack_pop=t.scenestack_push=t.scenestack_release=t.scenestack_init=void 0;var n=[],a=0;t.scenestack_init=function(){a=0;for(var e=0;e<16;e++)n[e]=null},t.scenestack_release=function(){for(;!(0,t.scenestack_empty)();)(0,t.scenestack_pop)()},t.scenestack_push=function(e){n[a++]=e,e&&e.init()},t.scenestack_pop=function(){n[a-1].release(),n[a-1]=null,a--},t.scenestack_top=function(){return n[a-1]},t.scenestack_empty=function(){return 0===a}},1817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.screenshot_release=t.screenshot_update=t.screenshot_init=void 0,t.screenshot_init=function(){},t.screenshot_update=function(){},t.screenshot_release=function(){}},4470:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.soundfactory_get=t.soundfactory_release=t.soundfactory_init=void 0;var a=n(9931),o=n(5443),r=n(7898),i=n(3450),_={};t.soundfactory_init=function(){c()},t.soundfactory_release=function(){},t.soundfactory_get=function(e){var t=(0,o.hashtable_sound_t_find)(_,e);return(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"2"),(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"3"),(0,a.sound_is_playing)(t)&&(t=(0,o.hashtable_sound_t_find)(_,e+"4")))),t};var c=function(){(0,r.logfile_message)("soundfactory: loading the samples table..."),(0,i.resourcemanager_getJsonFile)("data/config/samples.json").then((function(e){s(e)}))},s=function(e){for(var t in e)_[t]=d(t,e[t])},d=function(e,t){var n=l();return n.data=(0,a.sound_load)(e,t),n.data2=(0,a.sound_load)(e,t),n},l=function(){return{data:null,data2:null}}},9880:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sprite_info_destroy=t.sprite_create=t.sprite_get_image=t.sprite_get_animation=t.sprite_init=void 0;var a=n(9386),o=n(5443),r=n(7709),i=n(7898),_=n(3450),c=n(2878),s=n(642),d={},l=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],u=0,p=[];t.sprite_init=function(){return new Promise((function(e,t){var n;for((0,i.logfile_message)("Loading sprites..."),d=(0,o.hashtable_spriteinfo_t_create)(),n=0;n<l.length;n++)l[n]="data/sprites/"+l[n]+".json";(0,s.video_renderLoading)("Loading...",0),(0,_.resourcemanager_getJsonFiles)(l).then((function(t){for(n=0;n<t.length;n++)for(var a in t[n])t[n][a].name=a,p.push(t[n][a]);E(p).then((function(){(0,i.logfile_message)("All sprites have been loaded!"),d=(0,o.hashtable_sprites)(),e(d)}))}))}))},t.sprite_get_animation=function(e,t){var n;return null!=(n=d[e])?n.animation_data[t]:null},t.sprite_get_image=function(e,t){return e?e.frame_data[e.data[t]]:0},t.sprite_create=function(e){return new Promise((function(t,n){g(e).then(t)}))},t.sprite_info_destroy=function(e){var t;if(null!=e.source_file&&(e.source_file=null),null!=e.frame_data){for(t=0;t<e.frame_count;t++)(0,r.image_destroy)(e.frame_data[t]);e.frame_data=null}if(null!=e.animation_data){for(t=0;t<e.animation_count;t++)e.animation_data[t]=f(e.animation_data[t]);e.animation_data=null}e=null};var f=function(e){return null!=e&&(null!=e.data&&(e.data=null),e=null),null},g=function(e){return new Promise((function(t,n){var a=m(),o=I(a,e);o=function(e){var t,n,a;for((e.frame_w>e.rect_w||e.frame_h>e.rect_h)&&(e.frame_w=Math.min(e.frame_w,e.rect_w),e.frame_h=Math.min(e.frame_h,e.rect_h)),(e.rect_w%e.frame_w>0||e.rect_h%e.frame_h>0)&&(e.rect_w=e.rect_w%e.frame_w>0?e.rect_w-e.rect_w%e.frame_w+e.frame_w:e.rect_w,e.rect_h=e.rect_h%e.frame_h>0?e.rect_h-e.rect_h%e.frame_h+e.frame_h:e.rect_h),a=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),t=0;t<e.animation_count;t++)for(n=0;n<e.animation_data[t].frame_count;n++)e.animation_data[t].data[n]>=0&&e.animation_data[t].data[n]<a||(e.animation_data[t].data[n]=Math.min(e.animation_data[t].data[n],0,a-1));return e}(o),v(o).then((function(n){o=b(n),x(e.name,o),u++,(0,s.video_renderLoading)("Loading...",u/p.length),t(o)}))}))},m=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:(0,c.v2d_new)(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},v=function(e){return new Promise((function(t,n){(0,r.image_load)(e.source_file).then((function(n){e.frame_count=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),e.frame_data=[],e=h(e,n),t(e)}))}))},h=function(e,t){for(var n=0,a=0,o=0;o<e.frame_count;o++)e.frame_data[o]={data:t,sx:n+e.rect_x,sy:a+e.rect_y,swidth:e.frame_w,sheight:e.frame_h,x:0,y:0,width:e.frame_w,height:e.frame_h},(n+=e.frame_w)>=e.rect_w&&(n=0,a+=e.frame_h);return e},b=function(e){for(var t=0;t<e.animation_count;t++)e.animation_data[t].frame_data=e.frame_data,e.animation_data[t].hot_spot=e.hot_spot;return e},E=function(e){return Promise.all(e.map(g))},I=function(e,t){if(e.source_file=a.DATA_ROOT+t.source_file,e.rect_x=t.source_rect.xpos,e.rect_y=t.source_rect.ypos,e.rect_w=t.source_rect.width,e.rect_h=t.source_rect.height,e.frame_w=t.frame_size.width,e.frame_h=t.frame_size.height,t.hot_spot&&(e.hot_spot.x=t.hot_spot.xpos,e.hot_spot.y=t.hot_spot.ypos),t.animations){e.animation_count=t.animations.length;for(var n=0;n<e.animation_count;n++)e.animation_data[n]=y(S(),t.animations[n]),0==e.animation_data[n].frame_count&&(0,i.logfile_message)("Animation error: invalid 'data' field. You must specify the frames of the animations")}return e},y=function(e,t){return e.repeat=t.repeat,e.fps=t.fps,e.data=t.data,e.frame_count=t.data.length,e},x=function(e,t){(0,o.hashtable_spriteinfo_t_add)((0,o.hashtable_sprites)(),e,t)},S=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:(0,c.v2d_new)(0,0),frame_data:null}}},532:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.storyboard_get_scene=t.storyboard_release=t.storyboard_init=t.SCENE_STAGESELECT=t.SCENE_OPTIONS=t.SCENE_CREDITS=t.SCENE_LANGSELECT=t.SCENE_CONFIRMBOX=t.SCENE_QUESTOVER=t.SCENE_MENU=t.SCENE_ENDOFDEMO=t.SCENE_QUEST=t.SCENE_GAMEOVER=t.SCENE_PAUSE=t.SCENE_LEVEL=t.SCENE_INTRO=void 0;var a=n(5858),o=n(2930),r=n(2318),i=n(6698),_=n(2342),c=n(5316),s=n(7266),d=n(9185),l=n(2833),u=n(3985),p=n(7307),f=n(7504),g=n(9879);t.SCENE_INTRO=0,t.SCENE_LEVEL=1,t.SCENE_PAUSE=2,t.SCENE_GAMEOVER=3,t.SCENE_QUEST=4,t.SCENE_ENDOFDEMO=5,t.SCENE_MENU=6,t.SCENE_QUESTOVER=7,t.SCENE_CONFIRMBOX=8,t.SCENE_LANGSELECT=9,t.SCENE_CREDITS=10,t.SCENE_OPTIONS=11,t.SCENE_STAGESELECT=12;var m=[];t.storyboard_init=function(){for(var e=0;e<256;e++)m[e]=null;m[t.SCENE_LEVEL]=v(s.level_init,s.level_update,s.level_render,s.level_release),m[t.SCENE_PAUSE]=v(u.pause_init,u.pause_update,u.pause_render,u.pause_release),m[t.SCENE_GAMEOVER]=v(i.gameover_init,i.gameover_update,i.gameover_render,i.gameover_release),m[t.SCENE_QUEST]=v(p.quest_init,p.quest_update,p.quest_render,p.quest_release),m[t.SCENE_MENU]=v(d.menu_init,d.menu_update,d.menu_render,d.menu_release),m[t.SCENE_INTRO]=v(_.intro_init,_.intro_update,_.intro_render,_.intro_release),m[t.SCENE_ENDOFDEMO]=v(r.endofdemo_init,r.endofdemo_update,r.endofdemo_render,r.endofdemo_release),m[t.SCENE_QUESTOVER]=v(f.questover_init,f.questover_update,f.questover_render,f.questover_release),m[t.SCENE_CONFIRMBOX]=v(a.confirmbox_init,a.confirmbox_update,a.confirmbox_render,a.confirmbox_release),m[t.SCENE_LANGSELECT]=v(c.langselect_init,c.langselect_update,c.langselect_render,c.langselect_release),m[t.SCENE_CREDITS]=v(o.credits_init,o.credits_update,o.credits_render,o.credits_release),m[t.SCENE_OPTIONS]=v(l.options_init,l.options_update,l.options_render,l.options_release),m[t.SCENE_STAGESELECT]=v(g.stageselect_init,g.stageselect_update,g.stageselect_render,g.stageselect_release)},t.storyboard_release=function(){for(var e=0;e<256;e++)m[e]&&h(m[e])},t.storyboard_get_scene=function(e){return m[e]};var v=function(e,t,n,a){return{init:e,update:t,render:n,release:a}},h=function(e){}},4163:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.timer_get_fps=t.timer_get_ticks=t.timer_get_delta=t.timer_release=t.timer_update=t.timer_init=void 0;var a=n(7898),o=0,r=0,i=0,_=0,c=0,s=0;t.timer_init=function(){(0,a.logfile_message)("timer_init()"),o=0,r=0,i=0,c=0,_=(0,t.timer_get_ticks)()},t.timer_update=function(){var e=0,n=0;for(n=0;n<10;)n=(e=(0,t.timer_get_ticks)())>_?e-_:0,_=e>=_?_:e;n=Math.min(n,16),c=.001*n,o++,(r+=n)>=1e3&&(i=o,o=0,r=0),_=(0,t.timer_get_ticks)()},t.timer_release=function(){(0,a.logfile_message)("timer_release()")},t.timer_get_delta=function(){return c},t.timer_get_ticks=function(){var e=d();return e<s&&(s=e),e-s},t.timer_get_fps=function(){return i};var d=function(){return Math.floor(Date.now())}},2954:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.old_school_angle=t.swap=t.circular_collision=t.bounding_box=t.clip=t.random=t.isInArray=t.isArray=t.isspace=t.runAnimation=void 0;var a=n(9386),o=n(2878);t.runAnimation=function(e){var t=null;requestAnimationFrame((function n(a){var o=!1;if(null!=t){var r=Math.min(a-t,100)/1e3;o=!1===e(r)}t=a,o||requestAnimationFrame(n)}))},t.isspace=function(e){return" "==e},t.isArray=function(e){return void 0!==e&&e&&e.constructor===Array},t.isInArray=function(e,t){return t.indexOf(e)>-1},t.random=function(e){return~~(0,t.clip)(Math.random()*e,0,e)},t.clip=function(e,t,n){return Math.min(Math.max(e,t),n)},t.bounding_box=function(e,t){return e[0]<t[2]&&e[2]>t[0]&&e[1]<t[3]&&e[3]>t[1]},t.circular_collision=function(e,t,n,a){return(0,o.v2d_magnitude)((0,o.v2d_subtract)(e,n))<=t+a},t.swap=function(e,t){return r(e,t,e.length)},t.old_school_angle=function(e){return e>=0&&e<a.PI/4-a.EPSILON?0:e>=a.PI/4-a.EPSILON&&e<a.PI/2-a.EPSILON?a.PI/4:e>=a.PI/2-a.EPSILON&&e<a.PI/2+a.EPSILON?a.PI/2:e>=a.PI/2+a.EPSILON&&e<a.PI-a.EPSILON?3*a.PI/4:e>=a.PI-a.EPSILON&&e<a.PI+a.EPSILON?a.PI:e>=a.PI+a.EPSILON&&e<3*a.PI/2-a.EPSILON?5*a.PI/4:e>=3*a.PI/2-a.EPSILON&&e<3*a.PI/2+a.EPSILON?3*a.PI/2:e>3*a.PI/2+a.EPSILON&&e<=7*a.PI/4+a.EPSILON?7*a.PI/4:0};var r=function(e,t,n){var a,o,r=e,i=t;for(a=0;a<n;a++)o=r[a],r[a]=i[a],i[a]=o;return[r[a],i[a]]}},2878:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.v2d_lerp=t.v2d_normalize=t.v2d_rotate=t.v2d_dotproduct=t.v2d_magnitude=t.v2d_multiply=t.v2d_subtract=t.v2d_add=t.v2d_new=void 0;var a=n(9386),o=n(2954);t.v2d_new=function(e,t){return{x:e,y:t}},t.v2d_add=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},t.v2d_subtract=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.v2d_multiply=function(e,t){return{x:t*e.x,y:t*e.y}},t.v2d_magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.v2d_dotproduct=function(e,t){return e.x*t.x+e.y*t.y},t.v2d_rotate=function(e,t){var n=e.x,a=e.y;return{x:n*Math.cos(t)-a*Math.sin(t),y:a*Math.cos(t)+n*Math.sin(t)}},t.v2d_normalize=function(e){var n=(0,t.v2d_magnitude)(e);return n>a.EPSILON?(0,t.v2d_new)(e.x/n,e.y/n):(0,t.v2d_new)(0,0)},t.v2d_lerp=function(e,n,a){var r=(0,o.clip)(a,0,1),i=1-r;return(0,t.v2d_new)(e.x*i+n.x*r,e.y*i+n.y*r)}},642:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.video_getMousePos=t.video_get_window_size=t.video_changemode=t.video_show_fps=t.video_is_fps_visible=t.video_is_fullscreen=t.video_is_smooth=t.video_get_resolution=t.video_get_backbuffer=t.video_get_canvas=t.video_getCameraY=t.video_getCameraX=t.video_setCameraY=t.video_setFlipX=t.video_setCameraX=t.video_renderLoading=t.video_clearDisplay=t.video_fadefx_is_fading=t.video_fadefx_over=t.video_fadefx_out=t.video_fadefx_in=t.video_render=t.video_getScale=t.video_init=t.VIDEO_SCALE=t.VIDEO_SCREEN_H=t.VIDEO_SCREEN_W=t.VIDEORESOLUTION_EDT=t.VIDEORESOLUTION_MAX=t.VIDEORESOLUTION_2X=t.VIDEORESOLUTION_1X=void 0;var a,o,r,i,_=n(4163),c=n(2954),s=n(2878);t.VIDEORESOLUTION_1X=0,t.VIDEORESOLUTION_2X=1,t.VIDEORESOLUTION_MAX=2,t.VIDEORESOLUTION_EDT=3,t.VIDEO_SCREEN_W=480,t.VIDEO_SCREEN_H=271;var d,l,u,p,f,g=!1,m=!1,v=!1,h=0,b=0;t.VIDEO_SCALE=1;var E=1,I=1;t.video_init=function(e,n,i,_,c,s){(0,t.video_changemode)(n,i,_),(0,t.video_show_fps)(s),(a=document.getElementById("canvas"))?(o=a.getContext("2d"),E=a.width/t.VIDEO_SCREEN_W,I=a.height/t.VIDEO_SCREEN_H,o.scale(a.width/t.VIDEO_SCREEN_W,a.height/t.VIDEO_SCREEN_H)):(a=document.createElement("canvas"),o=a.getContext("2d"),a.width=t.VIDEO_SCREEN_W,a.height=t.VIDEO_SCREEN_H,document.body.appendChild(a)),E=t.VIDEO_SCREEN_W/window.innerWidth,I=E,o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,r=o,(0,t.video_clearDisplay)()},t.video_getScale=function(){return(0,s.v2d_new)(E,I)},t.video_render=function(){if(l=!1,0!=d)if((p+=(0,_.timer_get_delta)())<f){var e=void 0;e=1.25*p/f*100,e=(0,c.clip)(e,0,100),e=1==d?100-e:e,e/=100,(0,t.video_get_backbuffer)().fillStyle=u,(0,t.video_get_backbuffer)().globalAlpha=e,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)}else 2==d&&((0,t.video_get_backbuffer)().fillStyle=u,(0,t.video_get_backbuffer)().fillRect(0,0,a.width,a.height)),d=0,f=p=0,u=null,l=!0;(0,t.video_get_backbuffer)().globalAlpha=1,(0,t.video_is_fps_visible)()&&((0,t.video_get_backbuffer)().font="14px Arial",(0,t.video_get_backbuffer)().fillStyle="white",(0,t.video_get_backbuffer)().fillText((0,_.timer_get_fps)(),t.VIDEO_SCREEN_W-30,20))},t.video_fadefx_in=function(e,t){0==d&&(d=1,l=!1,u=e,p=0,f=t)},t.video_fadefx_out=function(e,t){0==d&&(d=2,l=!1,u=e,p=0,f=t)},t.video_fadefx_over=function(){return l},t.video_fadefx_is_fading=function(){return 0!=d},t.video_clearDisplay=function(e){o.fillStyle=e||"rgb(0, 0, 0)",o.fillRect(0,0,a.width,a.height)},t.video_renderLoading=function(e,n){(0,t.video_clearDisplay)();var a=(0,t.video_get_backbuffer)();a.beginPath(),a.rect(130,t.VIDEO_SCREEN_H/2-20,210,20),a.fillStyle="black",a.fill(),a.lineWidth=1,a.strokeStyle="white",a.stroke(),n=n<1?0:n>202?202:202/n,a.beginPath(),a.rect(134,t.VIDEO_SCREEN_H/2-17,n,14),a.fillStyle="white",a.fill(),a.lineWidth=1,a.strokeStyle="black",a.stroke(),a.font="14px Arial",a.fillStyle="white",a.fillText(e,130,t.VIDEO_SCREEN_H/2-30)},t.video_setCameraX=function(e){return h=e},t.video_setFlipX=function(e){return e},t.video_setCameraY=function(e){return b=e},t.video_getCameraX=function(){return h},t.video_getCameraY=function(){return b},t.video_get_canvas=function(){return a},t.video_get_backbuffer=function(){return r},t.video_get_resolution=function(){return i},t.video_is_smooth=function(){return g},t.video_is_fullscreen=function(){return m},t.video_is_fps_visible=function(){return v},t.video_show_fps=function(e){v=e},t.video_changemode=function(e,t,n){i=e,m=n,g=t},t.video_get_window_size=function(){var e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;switch(i){case t.VIDEORESOLUTION_1X:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_2X:e=2*t.VIDEO_SCREEN_W,n=2*t.VIDEO_SCREEN_H;break;case t.VIDEORESOLUTION_MAX:case t.VIDEORESOLUTION_EDT:e=t.VIDEO_SCREEN_W,n=t.VIDEO_SCREEN_H}return(0,s.v2d_new)(e,n)},t.video_getMousePos=function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}},3031:function(e,t,n){var a=this;Object.defineProperty(t,"__esModule",{value:!0}),t.actor_bullet_movement=t.actor_eightdirections_movement=t.actor_particle_movement=t.actor_platform_movement=t.actor_handle_acceleration=t.actor_handle_jumping=t.actor_handle_slopes=t.actor_handle_floor_collision=t.actor_handle_ceil_collision=t.actor_handle_wall_collision=t.actor_handle_carrying=t.actor_handle_collision_detectors=t.actor_handle_clouds=t.actor_get_collision_detectors=t.actor_corners_disable_detection=t.actor_corners_restore_slope_priority=t.actor_corners_set_slope_priority=t.actor_corners_restore_floor_priority=t.actor_corners_set_floor_priority=t.actor_corners_ex=t.actor_corners=t.actor_render_corners=t.actor_brick_collision=t.actor_pixelperfect_collision=t.actor_orientedbox_collision=t.actor_collision=t.actor_animation_finished=t.actor_change_animation=t.actor_change_animation_speed_factor=t.actor_change_animation_frame=t.actor_image=t.actor_move=t.actor_render_repeat_xy=t.actor_render=t.actor_destroy=t.actor_create=void 0;var o=n(9386),r=n(2878),i=n(7774),_=n(7709),c=n(642),s=n(4163),d=n(9880),l=n(2954),u=n(8707),p=.5,f=!0,g=!0,m=0,v=0,h=0,b=0;t.actor_create=function(){return{spawn_point:(0,r.v2d_new)(0,0),position:(0,r.v2d_new)(0,0),angle:0,speed:(0,r.v2d_new)(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:(0,r.v2d_new)(0,0),carried_by:null,carry_offset:(0,r.v2d_new)(0,0),carrying:null}},t.actor_destroy=function(e){e.input&&(0,i.input_destroy)(e.input),e=null},t.actor_render=function(e,n){var a;if(n&&e&&(e.visible&&e.animation)){if(e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),e.position,!(a=(0,t.actor_image)(e)))return!1;e.mirror&&y((0,c.video_get_backbuffer)(),e.position.x-(n.x-c.VIDEO_SCREEN_W/2));var o=e.position.x-(n.x-c.VIDEO_SCREEN_W/2),r=e.position.y-(n.y-c.VIDEO_SCREEN_H/2),i=e.mirror?e.angle:-e.angle;e.angle&&((0,c.video_get_backbuffer)().translate(o,r),(0,c.video_get_backbuffer)().rotate(i),(0,c.video_get_backbuffer)().translate(-o,-r)),(0,c.video_get_backbuffer)().drawImage(a.data,a.sx,a.sy,a.swidth,a.sheight,~~(e.position.x-e.hot_spot.x-(n.x-c.VIDEO_SCREEN_W/2)),~~(e.position.y-e.hot_spot.y-(n.y-c.VIDEO_SCREEN_H/2)),a.width*c.VIDEO_SCALE,a.height*c.VIDEO_SCALE),e.angle&&((0,c.video_get_backbuffer)().translate(o,r),(0,c.video_get_backbuffer)().rotate(-i),(0,c.video_get_backbuffer)().translate(-o,-r)),e.mirror&&y((0,c.video_get_backbuffer)(),e.position.x-(n.x-c.VIDEO_SCREEN_W/2))}},t.actor_render_repeat_xy=function(e,n,a,i){var _=(0,r.v2d_new)(0,0);if(e.visible&&e.animation){isNaN(e.animation_frame)&&(e.animation_frame=0,e.animation.fps=1),e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1);var d=(0,t.actor_image)(e);if(!d)return!1;_.x=e.position.x%(a?d.width:o.INT_MAX)-e.hot_spot.x-(n.x-c.VIDEO_SCREEN_W/2)-(a?d.width:0),_.y=e.position.y%(i?d.height:o.INT_MAX)-e.hot_spot.y-(n.y-c.VIDEO_SCREEN_H/2)-(i?d.height:0);for(var l=a?c.VIDEO_SCREEN_W/d.width+3:1,u=i?c.VIDEO_SCREEN_H/d.height+3:1,p=0;p<l;p++)for(var f=0;f<u;f++)(0,c.video_get_backbuffer)().drawImage(d.data,d.sx,d.sy,d.swidth,d.sheight,~~(_.x+p*d.width),~~(_.y+f*d.height),d.width*c.VIDEO_SCALE,d.height*c.VIDEO_SCALE)}},t.actor_move=function(e,t){t||(t={x:0,y:0}),t.x=t.x||0,t.y=t.y||0,Math.abs(t.x)<o.EPSILON&&(t.x=0),e.position.x+=t.x*Math.cos(e.angle)+t.y*Math.sin(e.angle),e.position.y+=t.y*Math.cos(e.angle)-t.x*Math.sin(e.angle)},t.actor_image=function(e){return(0,d.sprite_get_image)(e.animation,~~e.animation_frame)},t.actor_change_animation_frame=function(e,t){return e.animation_frame=(0,l.clip)(t,0,e.animation.frame_count),e},t.actor_change_animation_speed_factor=function(e,t){return e.animation_speed_factor=Math.max(0,t),e},t.actor_change_animation=function(e,t){return!(!e||!t)&&(e.animation!=t&&(e.animation=t,e.hot_spot=t.hot_spot,e.animation_frame=0,e.animation_speed_factor=1),e)},t.actor_animation_finished=function(e){var t=e.animation_frame+e.animation.fps*e.animation_speed_factor*(0,s.timer_get_delta)();return!e.animation.repeat&&t>e.animation.frame_count-1},t.actor_collision=function(e,n){var a=0,i=[];if(i[0]=[(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0)],i[1]=[(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0),(0,r.v2d_new)(0,0)],i[0][0]=(0,r.v2d_subtract)(e.position,(0,r.v2d_rotate)(e.hot_spot,-e.angle)),i[0][1]=(0,r.v2d_add)(i[0][0],(0,r.v2d_rotate)((0,r.v2d_new)((0,t.actor_image)(e).width,0),-e.angle)),i[0][2]=(0,r.v2d_add)(i[0][0],(0,r.v2d_rotate)((0,r.v2d_new)((0,t.actor_image)(e).width,(0,t.actor_image)(e).height),-e.angle)),i[0][3]=(0,r.v2d_add)(i[0][0],(0,r.v2d_rotate)((0,r.v2d_new)(0,(0,t.actor_image)(e).height),-e.angle)),i[1][0]=(0,r.v2d_subtract)(n.position,(0,r.v2d_rotate)(n.hot_spot,0)),i[1][1]=(0,r.v2d_add)(i[1][0],(0,r.v2d_rotate)((0,r.v2d_new)((0,t.actor_image)(n).width,0),0)),i[1][2]=(0,r.v2d_add)(i[1][0],(0,r.v2d_rotate)((0,r.v2d_new)((0,t.actor_image)(n).width,(0,t.actor_image)(n).height),0)),i[1][3]=(0,r.v2d_add)(i[1][0],(0,r.v2d_rotate)((0,r.v2d_new)(0,(0,t.actor_image)(n).height),0)),(Math.abs(e.angle)<o.EPSILON||Math.abs(e.angle-o.PI/2)<o.EPSILON||Math.abs(e.angle-o.PI)<o.EPSILON||Math.abs(e.angle-3*o.PI/2)<o.EPSILON)&&a++,(Math.abs(n.angle)<o.EPSILON||Math.abs(n.angle-o.PI/2)<o.EPSILON||Math.abs(n.angle-o.PI)<o.EPSILON||Math.abs(n.angle-3*o.PI/2)<o.EPSILON)&&a++,a){for(var _=[],c=[],s=0;s<2;s++){_[s]=[];var d=Math.min(i[s][0].x,i[s][1].x),u=Math.min(i[s][0].y,i[s][1].y),p=Math.max(i[s][2].x,i[s][3].x),f=Math.max(i[s][2].y,i[s][3].y);_[s][0]=d,_[s][1]=u,_[s][2]=p,_[s][3]=f,d>p&&(c=(0,l.swap)(_[s][0],_[s][2]),_[s][0]=c[0],_[s][2]=c[1]),u>f&&(c=(0,l.swap)(_[s][1],_[s][3]),_[s][1]=c[0],_[s][3]=c[1])}return(0,l.bounding_box)(_[0],_[1])}var g=[],m=[Math.max((0,t.actor_image)(e).width,(0,t.actor_image)(e).height),Math.max((0,t.actor_image)(n).width,(0,t.actor_image)(n).height)];for(s=0;s<2;s++)g[s]=(0,r.v2d_multiply)((0,r.v2d_add)(i[s][0],i[s][2]),.5);return(0,l.circular_collision)(g[0],m[0],g[1],m[1])},t.actor_orientedbox_collision=function(e,t){var n=(0,r.v2d_new)(0,0),o=(0,r.v2d_new)(0,0),i=(0,r.v2d_new)(0,0),_=(0,r.v2d_new)(0,0),c=[],s=[];return c=I(a,e,c),s=I(a,t,s),n.x=Math.min(c[0].x,Math.min(c[1].x,Math.min(c[2].x,c[3].x))),n.y=Math.min(c[0].y,Math.min(c[1].y,Math.min(c[2].y,c[3].y))),o.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),o.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),i.x=Math.max(c[0].x,Math.max(c[1].x,Math.max(c[2].x,c[3].x)))-n.x,i.y=Math.max(c[0].y,Math.max(c[1].y,Math.max(c[2].y,c[3].y)))-n.y,_.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-o.x,_.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-o.y,n.x+i.x>=o.x&&n.x<=o.x+_.x&&n.y+i.y>=o.y&&n.y<=o.y+_.y},t.actor_pixelperfect_collision=function(e,n){var a,r,i,c;return Math.abs(e.angle)<o.EPSILON&&Math.abs(n.angle)<o.EPSILON?!!(0,t.actor_collision)(e,n)&&(a=e.position.x-e.hot_spot.x,r=e.position.y-e.hot_spot.y,i=n.position.x-n.hot_spot.x,c=n.position.y-n.hot_spot.y,(0,_.image_pixelperfect_collision)((0,t.actor_image)(e),(0,t.actor_image)(n),a,r,i,c)):!!(0,t.actor_orientedbox_collision)(e,n)},t.actor_brick_collision=function(e,n){var a=(0,r.v2d_subtract)(e.position,(0,r.v2d_rotate)(e.hot_spot,e.angle)),o=(0,r.v2d_add)(a,(0,r.v2d_rotate)((0,r.v2d_new)((0,t.actor_image)(e).w,(0,t.actor_image)(e).h),e.angle)),i=[a.x,a.y,o.x,o.y],_=[n.x,n.y,n.x+n.brick_ref.image.width,n.y+n.brick_ref.image.height];return(0,l.bounding_box)(i,_)},t.actor_render_corners=function(e,n,a,o){var i=[],s=(0,r.v2d_subtract)(o,(0,r.v2d_new)(c.VIDEO_SCREEN_W/2,c.VIDEO_SCREEN_H/2)),d=(0,t.actor_image)(e).width,l=(0,t.actor_image)(e).height,u=(0,r.v2d_subtract)(e.position,s),f=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(0,-l+a),-e.angle)),g=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(0,-a),-e.angle)),m=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(-d/2+a,-l*p),-e.angle)),v=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(d/2-a,-l*p),-e.angle)),h=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(-d/2+a,-l+a),-e.angle)),b=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(d/2-a,-l+a),-e.angle)),E=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(-d/2+a,-a),-e.angle)),I=(0,r.v2d_add)(u,(0,r.v2d_rotate)((0,r.v2d_new)(d/2-a,-a),-e.angle)),y=[f.x-n,f.y-n,f.x+n,f.y+n],x=[g.x-n,g.y-n,g.x+n,g.y+n],S=[m.x-n,m.y-n,m.x+n,m.y+n],w=[v.x-n,v.y-n,v.x+n,v.y+n],L=[h.x-n,h.y-n,h.x+n,h.y+n],O=[b.x-n,b.y-n,b.x+n,b.y+n],R=[E.x-n,E.y-n,E.x+n,E.y+n],T=[I.x-n,I.y-n,I.x+n,I.y+n];i[0]=(0,_.image_rgb)(255,255,255),i[1]=(0,_.image_rgb)(0,128,255),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),y[0],y[1],y[2],y[3],i[0]),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),x[0],x[1],x[2],x[3],i[0]),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),S[0],S[1],S[2],S[3],i[0]),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),w[0],w[1],w[2],w[3],i[0]),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),R[0],R[1],R[2],R[3],(0,_.image_rgb)(0,255,0)),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),T[0],T[1],T[2],T[3],(0,_.image_rgb)(255,0,0)),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),O[0],O[1],O[2],O[3],i[1]),(0,_.image_rectfill)((0,c.video_get_backbuffer)(),L[0],L[1],L[2],L[3],i[1])},t.actor_corners=function(e,n,a,o,i,_,c,s,d,l,u,f){var g=(0,t.actor_image)(e).width,m=(0,t.actor_image)(e).height,v=e.position,h=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(0,-m+a),-e.angle)),b=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(0,-a),-e.angle)),E=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(-g/2+a,-m*p),-e.angle)),I=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(g/2-a,-m*p),-e.angle)),y=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(-g/2+a,-m+a),-e.angle)),x=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(g/2-a,-m+a),-e.angle)),S=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(-g/2+a,-a),-e.angle)),w=(0,r.v2d_add)(v,(0,r.v2d_rotate)((0,r.v2d_new)(g/2-a,-a),-e.angle));return(0,t.actor_corners_ex)(e,n,h,x,I,w,b,S,E,y,o,i,_,c,s,d,l,u,f)},t.actor_corners_ex=function(e,t,n,a,o,r,i,_,c,s,d,l,u,p,f,g,m,v,h){var b=[n.x-t,n.y-t,n.x+t,n.y+t],I=[i.x-t,i.y-t,i.x+t,i.y+t],y=[c.x-t,c.y-t,c.x+t,c.y+t],x=[o.x-t,o.y-t,o.x+t,o.y+t],S=[s.x-t,s.y-t,s.x+t,s.y+t],w=[a.x-t,a.y-t,a.x+t,a.y+t],L=[_.x-t,_.y-t,_.x+t,_.y+t],O=[r.x-t,r.y-t,r.x+t,r.y+t];return d&&(n&&(l=E(d,b)),i&&(g=E(d,I)),c&&(v=E(d,y)),o&&(p=E(d,x)),s&&(h=E(d,S)),a&&(u=E(d,w)),_&&(m=E(d,L)),r&&(f=E(d,O))),{up:l,down:g,left:v,right:p,upleft:h,upright:u,downleft:m,downright:f}},t.actor_corners_set_floor_priority=function(e){f=e},t.actor_corners_restore_floor_priority=function(){(0,t.actor_corners_set_floor_priority)(!0)},t.actor_corners_set_slope_priority=function(e){g=e},t.actor_corners_restore_slope_priority=function(){(0,t.actor_corners_set_slope_priority)(!0)},t.actor_corners_disable_detection=function(e,t,n,a){m=e,v=t,h=n,b=a},t.actor_get_collision_detectors=function(e,n,a,i,_,c,s,d,l,u){var p,f,g,m=(0,t.actor_image)(e).width,v=(0,t.actor_image)(e).height,h=!(Math.abs(e.angle)<o.EPSILON||Math.abs(e.angle-o.PI/2)<o.EPSILON||Math.abs(e.angle-o.PI)<o.EPSILON||Math.abs(e.angle-3*o.PI/2)<o.EPSILON),b=e.position;return h?(p=1,f=.7,g=.25):(p=.7,f=.5,g=.25),{up:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(0,-v*p+n),-e.angle)),down:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(0,-n),-e.angle)),left:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(-m*g+n,-v*f),-e.angle)),right:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(m*g-n,-v*f),-e.angle)),upleft:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(-m*g+n,-v*p+n),-e.angle)),upright:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(m*g-n,-v*p+n),-e.angle)),downleft:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(-m*g+n,-n),-e.angle)),downright:(0,r.v2d_add)(b,(0,r.v2d_rotate)((0,r.v2d_new)(m*g-n,-n),-e.angle))}},t.actor_handle_clouds=function(e,t,n,a,o,r,i,_,c,s){var d,l=[n,a,o,c,s];for(d=0;d<l.length;d++){var p=l[d];p&&p.brick_ref&&p.brick_ref.property==u.BRK_CLOUD&&(p=null,l[d]=p)}if(i&&i.brick_ref&&i.brick_ref.property==u.BRK_CLOUD){var f=Math.min(15,i.brick_ref.image.height/3);e.speed.y>=0&&e.position.y<i.y+t+1+f||(_&&_==i&&(_=null),r&&r==i&&(r=null),i=null)}return{up:l[0],upright:l[1],right:l[2],left:l[3],upleft:l[4],downright:r,down:i,downleft:_}},t.actor_handle_collision_detectors=function(e,n,a,o,r,i,_,c,s,d,l,u,p,f,g,m,v,h){return(0,t.actor_corners_ex)(e,2,a,o,r,i,_,c,s,d,n,l,u,p,f,g,m,v,h)},t.actor_handle_carrying=function(e,t){var n=(0,s.timer_get_delta)();if(null!=e.carried_by){var a=e.carried_by;t&&0==t.brick_ref.angle&&a.speed.y>=5?(e.position=(0,r.v2d_new)(e.carried_by.position.x,e.carried_by.position.y),e.carried_by.carrying=null,e.carried_by=null):(e.speed=(0,r.v2d_new)(0,0),e.mirror=a.mirror,e.angle=0,e.position=(0,r.v2d_subtract)((0,r.v2d_add)(a.position,(0,r.v2d_multiply)(a.speed,n)),e.carry_offset))}},t.actor_handle_wall_collision=function(e,t,n,a,r,i){i&&i.brick_ref.angle%90==0&&(e.speed.x>o.EPSILON||a.x>i.x)&&(e.speed.x=0,e.position.x=i.x+(t.x-a.x)),r&&r.brick_ref.angle%90==0&&(e.speed.x<-o.EPSILON||n.x<r.x+r.brick_ref.image.width)&&(e.speed.x=0,e.position.x=r.x+r.brick_ref.image.width+(t.x-n.x))},t.actor_handle_ceil_collision=function(e,t,n,a){a&&a.brick_ref.angle%90==0&&e.speed.y<-o.EPSILON&&(e.position.y=a.y+a.brick_ref.image.height+(t.y-n.y),e.speed.y=10)},t.actor_handle_floor_collision=function(e,n,a,i,c,d,l,u,p){var f;if((0,s.timer_get_delta)(),u&&!e.is_jumping)if(f=u.brick_ref.angle,e.speed.y=i.y=0,e.angle=f*o.PI/180,0==f)e.position.y=c.y+n;else if(f>0&&f<90)c.y=u.y+u.brick_ref.image.height-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=c.y+n,e.mirror,_.IF_HFLIP;else if(90==f){if(Math.abs(e.speed.x)>5){var g=p?p.brick_ref.angle:-1;p&&g>=f&&g<f+90?(c.y=u.x,e.position.x=c.y+n):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(6.5*n,0)),e.is_jumping=!0,e.speed=(0,r.v2d_new)(0,-.7*Math.abs(e.speed.x)))}else e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(5*n,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,_.IF_HFLIP}else f>90&&f<180?Math.abs(e.speed.x)>5?(c.y=u.y-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=c.y-n):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(0,-15*n)),e.is_jumping=!0):180==f?e.speed.x>5&&!(e.mirror&_.IF_HFLIP)||e.speed.x<-5&&e.mirror&_.IF_HFLIP?(c.y=u.y+u.brick_ref.image.height,e.position.y=c.y-n):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(0,-20*n)),e.is_jumping=!0,e.speed.x=0):f>180&&f<270?Math.abs(e.speed.x)>5?(c.y=u.y+u.brick_ref.image.height-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=c.y-n):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(0,-15*n)),e.is_jumping=!0):270==f?(Math.abs(e.speed.x)>5?(g=l?l.brick_ref.angle:-1,l&&g>f-90&&g<=f?(c.y=u.x+u.brick_ref.image.width,e.position.x=c.y-n):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(-6.5*n,0)),e.is_jumping=!0,e.speed=(0,r.v2d_new)(0,-.7*Math.abs(e.speed.x)))):(e.angle=a,(0,t.actor_move)(e,(0,r.v2d_new)(-5*n,0)),e.is_jumping=!0,e.ignore_horizontal=!1),e.mirror,_.IF_HFLIP):f>270&&f<360&&(c.y=u.y-(e.position.x-u.x)*Math.tan(e.angle),e.position.y=c.y+n,e.mirror,_.IF_HFLIP)},t.actor_handle_slopes=function(e,t){var n,a,r=t.brick_ref.angle,i=(0,s.timer_get_delta)();e.is_jumping||(r>0&&r<90?(n=Math.min(1,Math.tan(r*o.PI/180)),Math.abs(e.speed.y)>o.EPSILON?e.speed.x=-3*n*e.speed.y:(a=(e.mirror&_.IF_HFLIP?2:.8)*n,e.speed.x=Math.max(e.speed.x-a*e.acceleration*i,-e.maxspeed))):r>270&&r<360&&(n=Math.min(1,-Math.tan(r*o.PI/180)),Math.abs(e.speed.y)>o.EPSILON?e.speed.x=3*n*e.speed.y:(a=(e.mirror&_.IF_HFLIP?.8:2)*n,e.speed.x=Math.min(e.speed.x+a*e.acceleration*i,e.maxspeed))))},t.actor_handle_jumping=function(e,n,a,o,_){var c=o.brick_ref.angle;!(0,i.input_button_down)(e.input,i.IB_FIRE1)||(0,i.input_button_down)(e.input,i.IB_DOWN)||_||(e.angle=a,e.is_jumping=!0,0==c?e.speed.y=-e.jump_strength:c>0&&c<90?(e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=-.7*e.jump_strength):90==c?((0,t.actor_move)(e,(0,r.v2d_new)(20*n,0)),e.speed.x=Math.min(e.speed.x,-e.jump_strength),e.speed.y=-e.jump_strength/2):c>90&&c<180?((0,t.actor_move)(e,(0,r.v2d_new)(0,-20*n)),e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=e.jump_strength):180==c?((0,t.actor_move)(e,(0,r.v2d_new)(0,-20*n)),e.speed.x*=-1,e.speed.y=e.jump_strength):c>180&&c<270?((0,t.actor_move)(e,(0,r.v2d_new)(0,-20*n)),e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=e.jump_strength):270==c?((0,t.actor_move)(e,(0,r.v2d_new)(-20*n,0)),e.speed.x=Math.max(e.speed.x,e.jump_strength),e.speed.y=-e.jump_strength/2):c>270&&c<360&&(e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=-.7*e.jump_strength))},t.actor_handle_acceleration=function(e,t,n){var a=(0,s.timer_get_delta)();if((0,i.input_button_down)(e.input,i.IB_LEFT)&&!(0,i.input_button_down)(e.input,i.IB_RIGHT))e.ignore_horizontal||(0,i.input_button_down)(e.input,i.IB_DOWN)||(e.speed.x=Math.max(e.speed.x-(1-t)*e.acceleration*a,-e.maxspeed),e.mirror=_.IF_HFLIP);else if((0,i.input_button_down)(e.input,i.IB_RIGHT)&&!(0,i.input_button_down)(e.input,i.IB_LEFT))e.ignore_horizontal||(0,i.input_button_down)(e.input,i.IB_DOWN)||(e.speed.x=Math.min(e.speed.x+(1-t)*e.acceleration*a,e.maxspeed),e.mirror=_.IF_NONE);else if(n){var r=0,c=n.brick_ref.angle;c%90==0?r=90==c&&e.mirror&_.IF_HFLIP&&e.speed.x<0||270==c&&!(e.mirror&_.IF_HFLIP)&&e.speed.x>0?e.speed.x>o.EPSILON?1:-e.speed.x>o.EPSILON?-1:0:e.speed.x>o.EPSILON?-1:-e.speed.x>o.EPSILON?1:0:(c>90&&c<180||c>180&&c<270)&&(r=e.speed.x>o.EPSILON?-1:-e.speed.x>o.EPSILON?1:0),e.speed.x+=1*r*e.acceleration*a}},t.actor_platform_movement=function(e,n,a){var i,_,c,d,l,u,p,f,g,m,v,h,b,E,I,y,x=(0,r.v2d_new)(0,0),S=(0,s.timer_get_delta)(),w=e.position,L=(0,t.actor_get_collision_detectors)(e,-2,i,_,c,d,l,u,p,f);i=L.up,_=L.upright,c=L.right,d=L.downright,l=L.down,u=L.downleft,p=L.left,f=L.upleft,g=(L=(0,t.actor_handle_collision_detectors)(e,n,i,_,c,d,l,u,p,f,g,m,v,h,b,E,I,y)).up,m=L.upright,v=L.right,h=L.downright,b=L.down,E=L.downleft,I=L.left,y=L.upleft;var O=(0,t.actor_handle_clouds)(e,-2,g,m,v,h,b,E,I,y);return g=O.up,m=O.upright,v=O.right,I=O.left,y=O.upleft,b=O.down,E=O.downleft,h=O.downright,(0,t.actor_handle_carrying)(e,b),null!=e.carried_by?(0,r.v2d_new)(0,0):((0,t.actor_handle_wall_collision)(e,w,p,c,I,v),b?(e.is_jumping=!1,e.ignore_horizontal=!1,(0,t.actor_handle_jumping)(e,-2,0,b,g)):e.angle=0,x.y=Math.abs(e.speed.y)>o.EPSILON?e.speed.y*S+1*a*.5*(S*S):0,e.speed.y=Math.min(e.speed.y+1*a*S,480),(0,t.actor_handle_ceil_collision)(e,w,i,g),(0,t.actor_handle_floor_collision)(e,-2,0,x,w,0,E,b,h),x.x=Math.abs(e.speed.x)>o.EPSILON?e.speed.x*S+1*e.acceleration*.5*(S*S):0,(0,t.actor_handle_acceleration)(e,0,b),Math.abs(e.speed.x)<o.EPSILON&&(e.speed.x=x.x=0),x)},t.actor_particle_movement=function(e,t){var n=(0,s.timer_get_delta)(),a=(0,r.v2d_new)(0,0);return a.x=e.speed.x*n,a.y=e.speed.y*n+.5*t*n*n,e.speed.y+=t*n,a},t.actor_eightdirections_movement=function(e){var t=(0,s.timer_get_delta)(),n=(0,r.v2d_new)(0,0);return e.input?((0,i.input_button_down)(e.input,i.IB_RIGHT)&&!(0,i.input_button_down)(e.input,i.IB_LEFT)&&(e.speed.x=Math.min(e.speed.x+e.acceleration*t,e.maxspeed)),(0,i.input_button_down)(e.input,i.IB_LEFT)&&!(0,i.input_button_down)(e.input,i.IB_RIGHT)&&(e.speed.x=Math.max(e.speed.x-e.acceleration*t,-e.maxspeed)),!(0,i.input_button_down)(e.input,i.IB_LEFT)&&!(0,i.input_button_down)(e.input,i.IB_RIGHT)&&Math.abs(e.speed.x)>o.EPSILON&&(e.speed.x>0?e.speed.x=Math.max(e.speed.x-e.acceleration*t,0):e.speed.x=Math.min(e.speed.x+e.acceleration*t,0)),(0,i.input_button_down)(e.input,i.IB_DOWN)&&!(0,i.input_button_down)(e.input,i.IB_UP)&&(e.speed.y=Math.min(e.speed.y+e.acceleration*t,e.maxspeed)),(0,i.input_button_down)(e.input,i.IB_UP)&&!(0,i.input_button_down)(e.input,i.IB_DOWN)&&(e.speed.y=Math.max(e.speed.y-e.acceleration*t,-e.maxspeed)),!(0,i.input_button_down)(e.input,i.IB_UP)&&!(0,i.input_button_down)(e.input,i.IB_DOWN)&&Math.abs(e.speed.y)>o.EPSILON&&(e.speed.y>0?e.speed.y=Math.max(e.speed.y-e.acceleration*t,0):e.speed.y=Math.min(e.speed.y+e.acceleration*t,0))):e.speed=(0,r.v2d_new)(0,0),n.x=Math.abs(e.speed.x)>o.EPSILON?e.speed.x*t+.5*e.acceleration*t*t:0,n.y=0,e.speed.x=n.x,e.speed.y=n.y,n},t.actor_bullet_movement=function(e){var t=(0,s.timer_get_delta)(),n=(0,r.v2d_new)(0,0);return n.x=e.speed.x*t,n.y=0,n};var E=function(e,t){var n,a,r,i,_,c,s,d=null,p=!1;for(n=e;n&&!p;n=n.next)if(n.data){if(n.data.brick_ref.property==u.BRK_NONE||!n.data.enabled)continue;if(n.data.brick_ref.property==u.BRK_CLOUD&&d&&d.brick_ref.property==u.BRK_OBSTACLE)continue;if(n.data.brick_ref.behavior==u.BRB_CIRCULAR&&d&&d.brick_ref.behavior!=u.BRB_CIRCULAR&&n.data.y>=d.y)continue;if(h&&0==n.data.brick_ref.angle)continue;if(b&&180==n.data.brick_ref.angle)continue;if(v&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(m&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var E=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if((0,l.bounding_box)(t,E))if(n.data.brick_ref.behavior!=u.BRB_CIRCULAR&&d&&d.brick_ref.behavior==u.BRB_CIRCULAR&&n.data.y<=d.y)d=n.data;else if(n.data.brick_ref.property==u.BRK_OBSTACLE&&d&&d.brick_ref.property==u.BRK_CLOUD)d=n.data;else if(n.data.brick_ref.property==u.BRK_CLOUD&&d&&d.brick_ref.property==u.BRK_CLOUD)n.data.y>d.y&&(d=n.data);else if(n.data.brick_ref.angle%90==0)g&&d?f?d.brick_ref.angle%180!=0&&(d=n.data):d.brick_ref.angle%180==0&&(d=n.data):d=n.data;else if(g)for(a=n.data.brick_ref.angle,c=Math.tan(a*o.PI/180),i=t[0];i<=t[2]&&!p;i++)for(_=t[1];_<=t[3]&&!p;_++){switch(r=!1,~~(a/90)%4){case 0:s=E[3]+c*(E[0]-i),r=E[0]<=i&&i<=E[2]&&s<=_&&_<=E[3];break;case 1:s=E[3]-c*(E[2]-i),r=E[0]<=i&&i<=E[2]&&E[1]<=_&&_<=s;break;case 2:s=E[3]-c*(E[0]-i),r=E[0]<=i&&i<=E[2]&&E[1]<=_&&_<=s;break;case 3:s=E[3]+c*(E[2]-i),r=E[0]<=i&&i<=E[2]&&s<=_&&_<=E[3]}r&&(d=n.data,p=!0)}}return d},I=function(e,n,a){var o,i,_,c,s,d,l,u,p;return _=-n.angle,o=(0,t.actor_image)(n).width,i=(0,t.actor_image)(n).height,u=n.hot_spot,p=n.position,c=(0,r.v2d_subtract)((0,r.v2d_new)(0,0),u),s=(0,r.v2d_subtract)((0,r.v2d_new)(o,0),u),d=(0,r.v2d_subtract)((0,r.v2d_new)(o,i),u),l=(0,r.v2d_subtract)((0,r.v2d_new)(0,i),u),a[0]=(0,r.v2d_add)(p,(0,r.v2d_rotate)(c,_)),a[1]=(0,r.v2d_add)(p,(0,r.v2d_rotate)(s,_)),a[2]=(0,r.v2d_add)(p,(0,r.v2d_rotate)(d,_)),a[3]=(0,r.v2d_add)(p,(0,r.v2d_rotate)(l,_)),a},y=function(e,t){return e.translate(t,0),e.scale(-1,1),e.translate(-t,0),e}},3339:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.background_render_fg=t.background_render_bg=t.background_update=t.background_unload=t.background_load=void 0;var a=n(9386),o=n(2878),r=n(9880),i=n(642),_=n(7898),c=n(4163),s=n(3450),d=n(2954),l=n(3031);t.background_load=function(e){return new Promise((function(t,n){(0,_.logfile_message)('background_load("'.concat(e,'")')),(0,s.resourcemanager_getJsonFile)(e).then(v).then((function(e){t({data:e,length:e.length})}))}))},t.background_unload=function(e){(0,_.logfile_message)("background_unload()");for(var t=0;t<e.length;t++)e.data[t]=p(e.data[t]);return null},t.background_update=function(e){if(!e)return!1;for(var t=0;t<e.length;t++){var n=e.data[t];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},t.background_render_bg=function(e,t){u(e,t,!1)},t.background_render_fg=function(e,t){u(e,t,!0)};var u=function(e,t,n){if(e){var a,r,_=(0,o.v2d_new)(i.VIDEO_SCREEN_W/2,i.VIDEO_SCREEN_H/2),c=(0,o.v2d_subtract)(t,_);for(a=0;a<e.length;a++)r=e.data[a],(!n&&r.zindex<=.5||n&&r.zindex>.5)&&(r.actor.position.x+=c.x*r.actor.speed.x,r.actor.position.y+=c.y*r.actor.speed.y,(0,l.actor_render_repeat_xy)(r.actor,_,r.repeat_x,r.repeat_y),r.actor.position.y-=c.y*r.actor.speed.y,r.actor.position.x-=c.x*r.actor.speed.x)}},p=function(e){return e.strategy=f(e.strategy),(0,r.sprite_info_destroy)(e.data),(0,l.actor_destroy)(e.actor),e=null,null},f=function(e){return null},g=function(e){},m=function(e){var t=e,n=e.background,a=(0,c.timer_get_delta)();n.actor.position.x+=t.speed_x*a,n.actor.position.y+=t.speed_y*a},v=function(e){var t=e.bg;return Promise.all(t.map(h))},h=function(e,t){return new Promise((function(t,n){var i,_,c,s,u,p={actor:(0,l.actor_create)(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0};switch(p.actor.spawn_point.x=e.initial_position.xpos,p.actor.spawn_point.y=e.initial_position.ypos,p.actor.position=(0,o.v2d_new)(p.actor.spawn_point.x,p.actor.spawn_point.y),p.actor.speed.x=e.scroll_speed.xspeed,p.actor.speed.y=e.scroll_speed.yspeed,e.behavior&&(0,d.isArray)(e.behavior)?e.behavior[0]:e.behavior){case"DEFAULT":p.strategy&&(p.strategy=f(p.strategy)),p.strategy={background:p,update:g};break;case"LINEAR":p.strategy&&(p.strategy=f(p.strategy)),p.strategy=(i=p,_=e.behavior[1],c=e.behavior[2],(u=s={background:i,update:m}).speed_x=_,u.speed_y=c,s);break;case"CIRCULAR":p.strategy&&(p.strategy=f(p.strategy)),p.strategy=function(e,t,n,o,r,i,_){var c={background:e,update:m},s=c;return s.timer=0,s.amplitude_x=t,s.amplitude_y=n,s.angularspeed_x=2*a.PI*o,s.angularspeed_y=2*a.PI*r,s.initialphase_x=i*a.PI/180,s.initialphase_y=_*a.PI/180,c}(p,e.behavior[1],e.behavior[2],e.behavior[3],e.behavior[4],e.behavior[5],e.behavior[6])}p.repeat_x=e.repeat_x,p.repeat_y=e.repeat_y,e.zindex&&(p.zindex=e.zindex),(0,r.sprite_create)(e.sprite).then((function(e){p.data=e,p.actor.animation=e,p.actor.animation.data=[0],t(p)}))}))}},2296:(e,t,n)=>{t.xi=t.GO=t.fU=t.uX=t.s8=void 0;var a=n(2954),o=n(9386),r=n(2878),i=n(4163),_=n(7774),c=n(9880),s=n(642),d=n(9931),l=n(4470),u=n(2594),p=n(7293),f=n(5141),g=n(3031),m=n(7266);t.s8=function(e,t,n,a,o,i){for(var s={type:e,state:0,direction:0,actor:(0,g.actor_create)(),bring_to_front:!1,initial_hp:0,hp:0,value:[],rect_x:n,rect_y:a,rect_w:o,rect_h:i},d=0;d<10;d++)s.value[d]=0;var l=s.actor;switch(l.spawn_point=(0,r.v2d_new)(t.x,t.y),l.position=(0,r.v2d_new)(t.x,t.y),l.input=(0,_.input_create_computer)(),e){case 0:case 2:(0,g.actor_change_animation)(l,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",0)),s.initial_hp=s.hp=3,s.direction=3,l.maxspeed=100,l.acceleration=100;break;case 1:case 3:(0,g.actor_change_animation)(l,(0,c.sprite_get_animation)("SD_MECHASHADOW",0)),s.initial_hp=s.hp=10,s.direction=3,l.maxspeed=100,l.acceleration=100}return s},t.uX=function(e){(0,g.actor_destroy)(e.actor)},t.fU=function(e,t,n){var a=e.actor,o=null,r=null,i=null,_=null,c=null,s=null,d=null,l=null,u=[],p=(0,g.actor_corners)(a,2,-2,n,o,r,i,_,c,s,d,l);o=p.up,r=p.upright,i=p.right,_=p.downright,c=p.down,s=p.downleft,d=p.left,l=p.upleft;var f=(0,g.actor_handle_clouds)(a,-2,o,r,i,_,c,s,d,l);if(o=f.up,r=f.upright,i=f.right,_=f.downright,c=f.down,s=f.downleft,d=f.left,l=f.upleft,u[0]=o,u[1]=r,u[2]=i,u[3]=_,u[4]=c,u[5]=s,u[6]=d,u[7]=l,(0,m.level_boss_battle)())switch(e.hp<=0&&1!=e.state&&((0,m.level_kill_all_baddies)(),e.state=1),e.type){case 0:b(e,t,n,u);break;case 1:E(e,t,n,u);break;case 2:I(e,t,n,u);break;case 3:y(e,t,n,u)}},t.GO=function(e,t){h(e,t,!0),(0,g.actor_render)(e.actor,t),h(e,t,!1)},t.xi=function(e){return 1==e.state};var v=function(e,t){var n;for(n=0;n<t.length&&1!=e.state;n++)if(t[n]&&(0,g.actor_pixelperfect_collision)(e.actor,t[n].actor))return!(!(0,f.player_attacking)(t[n])&&!t[n].invincible&&((0,f.player_hit)(t[n]),1));return!1},h=function(e,t,n){var a=e.actor,_=.001*(0,i.timer_get_ticks)();if(3===e.type){var s=void 0,d=(0,r.v2d_new)(0,0);if((0,c.sprite_get_image)((0,c.sprite_get_animation)("SD_INVSTAR",0),1),1!=e.state)for(s=0;s<5;s++)d.x=a.position.x+20*Math.cos(2*o.PI*_+2*s*o.PI/5),d.y=a.position.y+20*Math.sin(o.PI*_+2*s*o.PI/5)}},b=function(e,t,n,p){var f=(0,m.level_player)(),h=.001*(0,i.timer_get_ticks)(),b=e.actor,E=e.value[0],I=e.value[1];if(1==e.state){if(e.bring_to_front=!0,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",2)),b.position.y+=100*(0,i.timer_get_delta)(),h>=I+.15){var y=(0,r.v2d_new)(b.position.x-b.hot_spot.x+(0,a.random)((0,g.actor_image)(b).width),b.position.y-b.hot_spot.y+(0,a.random)((0,g.actor_image)(b).height));(0,m.level_create_item)(u.IT_EXPLOSION,y),b.position.y<=b.spawn_point.y+1.5*s.VIDEO_SCREEN_H&&(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),I=h}}else b.maxspeed=200-100/e.initial_hp*e.hp,b.acceleration=b.maxspeed,b.position.x<b.spawn_point.x-200&&(e.direction=1),b.position.x>b.spawn_point.x&&(e.direction=3),1==e.direction?(0,_.input_simulate_button_down)(b.input,_.IB_RIGHT):3==e.direction&&(0,_.input_simulate_button_down)(b.input,_.IB_LEFT),b.position.y=b.spawn_point.y+20*Math.cos(o.PI*h),b.mirror=1==e.direction?o.IF_NONE:o.IF_HFLIP,(0,g.actor_move)(b,(0,g.actor_eightdirections_movement)(b)),h>=E+2/e.initial_hp*e.hp&&((0,m.level_create_enemy)(["0","3"][(0,a.random)(2)],b.position).actor.speed.y=-150-(0,a.random)(50),E=h),v(e,t)&&b.animation==(0,c.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),f.actor.speed.x*=-1,f.actor.speed.y=100,e.hp--),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=E,e.value[1]=I},E=function(e,t,n,_){var f,h=(0,m.level_player)(),b=e.actor,E=.001*(0,i.timer_get_ticks)(),I=(0,i.timer_get_delta)(),y=e.value[0],x=e.value[1],S=e.value[2];switch(e.state){case 0:if(e.direction=h.actor.position.x<b.position.x?3:1,b.position.y=b.spawn_point.y+30*Math.cos(o.PI*E),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",0)),E>=y+5){var w,L=(0,r.v2d_new)(h.actor.position.x-b.position.x,h.actor.position.y-b.position.y);L=(0,r.v2d_multiply)((0,r.v2d_normalize)(L),200),w=(0,m.level_create_item)(u.IT_DANGPOWER,b.position),(0,p.dangerouspower_set_speed)(w,L),(0,d.sound_play)((0,l.soundfactory_get)("big shot")),y=E}if(E>=x+15){var O=e.rect_x+e.rect_w/2;e.direction=b.position.x>O?3:1,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,x=E}break;case 2:var R=e.rect_x+100,T=e.rect_x+e.rect_w-100,N=T-R+(b.position.x-R),k=3==e.direction?-1:1;b.position.x+=200*k*I,b.position.y=b.spawn_point.y-100*Math.sin(o.PI/(T-R)*N),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==k&&b.position.x<=R||1==k&&b.position.x>=T)&&((0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",4)),b.position.y+=100*(0,i.timer_get_delta)(),E>=S+.15){var P=(0,r.v2d_new)(b.position.x-b.hot_spot.x+(0,a.random)((0,g.actor_image)(b).width),b.position.y-b.hot_spot.y+(0,a.random)((0,g.actor_image)(b).height));(0,m.level_create_item)(u.IT_EXPLOSION,P),b.position.y<=b.spawn_point.y+1.5*s.VIDEO_SCREEN_H&&(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),S=E}}f=b.animation==(0,c.sprite_get_animation)("SD_MECHASHADOW",1)||b.animation==(0,c.sprite_get_animation)("SD_MECHASHADOW",3),v(e,t)&&!f&&1!=e.state&&(b.animation=(0,c.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),e.hp--,h.actor.speed.x*=-.5,h.actor.speed.y=h.actor.jump_strength),b.mirror=1==e.direction?o.IF_NONE:o.IF_HFLIP},I=function(e,t,n,p){var f=(0,m.level_player)(),h=.001*(0,i.timer_get_ticks)(),b=e.actor,E=e.value[0],I=e.value[1],y=e.value[2];if(1==e.state){if(e.bring_to_front=!0,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",2)),b.position.y+=100*(0,i.timer_get_delta)(),h>=I+.15){var x=(0,r.v2d_new)(b.position.x-b.hot_spot.x+(0,a.random)((0,g.actor_image)(b).width),b.position.y-b.hot_spot.y+(0,a.random)((0,g.actor_image)(b).height));(0,m.level_create_item)(u.IT_EXPLOSION,x),b.position.y<=b.spawn_point.y+1.5*s.VIDEO_SCREEN_H&&(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),I=h}}else b.maxspeed=200-100/e.initial_hp*e.hp,b.acceleration=b.maxspeed,b.position.x<b.spawn_point.x-200&&(e.direction=1),b.position.x>b.spawn_point.x&&(e.direction=3),1==e.direction?(0,_.input_simulate_button_down)(b.input,_.IB_RIGHT):3==e.direction&&(0,_.input_simulate_button_down)(b.input,_.IB_LEFT),b.position.y=b.spawn_point.y+20*Math.cos(o.PI*h),b.mirror=1==e.direction?o.IF_NONE:o.IF_HFLIP,(0,g.actor_move)(b,(0,g.actor_eightdirections_movement)(b)),h>=E+2/e.initial_hp*e.hp&&((0,m.level_create_enemy)(["9","6"][(0,a.random)(2)],b.position).actor.speed.y=-150-(0,a.random)(50),E=h),h>=y+3/e.initial_hp*e.hp&&((0,m.level_create_item)(u.IT_FIREBALL,b.position).actor.speed.y=100,(0,d.sound_play)((0,l.soundfactory_get)("fire")),y=h),v(e,t)&&b.animation==(0,c.sprite_get_animation)("SD_SIMPLEBOSS",0)&&((0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",1)),(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),f.actor.speed.x*=-1,f.actor.speed.y=100,e.hp--),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_SIMPLEBOSS",0)),e.value[0]=E,e.value[1]=I,e.value[2]=y},y=function(e,t,n,_){var f,h=(0,m.level_player)(),b=e.actor,E=.001*(0,i.timer_get_ticks)(),I=(0,i.timer_get_delta)(),y=e.value[0],x=e.value[1],S=e.value[2],w=e.value[3];switch(e.state){case 0:if(e.direction=h.actor.position.x<b.position.x?3:1,b.position.y=b.spawn_point.y+30*Math.cos(o.PI*E),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",0)),E>=y+4){var L,O=(0,r.v2d_new)(h.actor.position.x-b.position.x,h.actor.position.y-b.position.y);O=(0,r.v2d_multiply)((0,r.v2d_normalize)(O),200),L=(0,m.level_create_item)(u.IT_DANGPOWER,b.position),(0,p.dangerouspower_set_speed)(L,O),(0,d.sound_play)((0,l.soundfactory_get)("big shot")),y=E}if(E>=x+8){var R=e.rect_x+e.rect_w/2;e.direction=b.position.x>R?3:1,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",2)),e.state=2,x=E}break;case 2:var T=e.rect_x+100,N=e.rect_x+e.rect_w-100,k=N-T+(b.position.x-T),P=3==e.direction?-1:1;b.position.x+=200*P*I,b.position.y=b.spawn_point.y-100*Math.sin(o.PI/(N-T)*k),E>=w+.2&&((0,m.level_create_item)(u.IT_FIREBALL,b.position).actor.speed.y=-200,(0,d.sound_play)((0,l.soundfactory_get)("fire")),w=E),(0,g.actor_animation_finished)(b)&&(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",2)),(-1==P&&b.position.x<=T||1==P&&b.position.x>=N)&&((0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,(0,g.actor_change_animation)(b,(0,c.sprite_get_animation)("SD_MECHASHADOW",4)),b.position.y+=100*(0,i.timer_get_delta)(),E>=S+.15){var D=(0,r.v2d_new)(b.position.x-b.hot_spot.x+(0,a.random)((0,g.actor_image)(b).width),b.position.y-b.hot_spot.y+(0,a.random)((0,g.actor_image)(b).height));(0,m.level_create_item)(u.IT_EXPLOSION,D),b.position.y<=b.spawn_point.y+1.5*s.VIDEO_SCREEN_H&&(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),S=E}}f=b.animation==(0,c.sprite_get_animation)("SD_MECHASHADOW",1)||b.animation==(0,c.sprite_get_animation)("SD_MECHASHADOW",3),v(e,t)&&!f&&1!=e.state&&(b.animation=(0,c.sprite_get_animation)("SD_MECHASHADOW",2==e.state?3:1),(0,d.sound_play)((0,l.soundfactory_get)("boss hit")),e.hp--,h.actor.speed.x*=-.5,h.actor.speed.y=h.actor.jump_strength),b.mirror=1==e.direction?o.IF_NONE:o.IF_HFLIP,e.value[0]=y,e.value[1]=x,e.value[2]=S,e.value[3]=w}},8707:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.brick_get_behavior_name=t.brick_get_property_name=t.brick_image=t.brick_animate=t.brick_size=t.brick_get=t.brick_unload=t.brick_load=t.BRB_FALL_TIME=t.BRICK_MAXVALUES=t.BRS_ACTIVE=t.BRS_DEAD=t.BRS_IDLE=t.BRB_FALL=t.BRB_BREAKABLE=t.BRB_CIRCULAR=t.BRB_DEFAULT=t.BRICKBEHAVIOR_MAXARGS=t.BRK_CLOUD=t.BRK_OBSTACLE=t.BRK_NONE=void 0;var a=n(9880),o=n(3450),r=n(4163),i=n(7898),_=n(2954);t.BRK_NONE=0,t.BRK_OBSTACLE=1,t.BRK_CLOUD=2,t.BRICKBEHAVIOR_MAXARGS=5,t.BRB_DEFAULT=0,t.BRB_CIRCULAR=1,t.BRB_BREAKABLE=2,t.BRB_FALL=3,t.BRS_IDLE=0,t.BRS_DEAD=1,t.BRS_ACTIVE=2,t.BRICK_MAXVALUES=3,t.BRB_FALL_TIME=1;var c=0,s=[];t.brick_load=function(e){return new Promise((function(t,n){(0,i.logfile_message)('brickdata_load("'.concat(e,'")')),(0,o.resourcemanager_getJsonFile)(e).then(l).then((function(e){s=e})).then(t)}))},t.brick_unload=function(){var e;for((0,i.logfile_message)("brickdata_unload()"),e=0;e<c;e++)s[e]=d(s[e]);c=0,(0,i.logfile_message)("brickdata_unload() ok")},t.brick_get=function(e){return s[e]},t.brick_size=function(){return c},t.brick_animate=function(e){var t=e.brick_ref.data;if(null!=t&&t.animation_data.length){t.animation_data[0].repeat;var n=t.animation_data[0].frame_count;e.animation_frame+=t.animation_data[0].fps*(0,r.timer_get_delta)(),e.animation_frame>t.animation_data[0].frame_count-1&&(e.animation_frame=0),n=~~e.animation_frame,e.brick_ref.image=t.frame_data[t.animation_data[0].data[n]]}return e},t.brick_image=function(e){return e.brick_ref.image},t.brick_get_property_name=function(e){switch(e){case t.BRK_NONE:return"PASSABLE";case t.BRK_OBSTACLE:return"OBSTACLE";case t.BRK_CLOUD:return"CLOUD";default:return"Unknown"}},t.brick_get_behavior_name=function(e){switch(e){case t.BRB_DEFAULT:return"DEFAULT";case t.BRB_CIRCULAR:return"CIRCULAR";case t.BRB_BREAKABLE:return"BREAKABLE";case t.BRB_FALL:return"FALL";default:return"Unknown"}};var d=function(e){return null!=e&&null!=e.data&&(0,a.sprite_info_destroy)(e.data),null},l=function(e){var t=e.bricks;return Promise.all(t.map(u))},u=function(e){return new Promise((function(n,o){var r=function(){for(var e={data:null,image:null,property:t.BRK_NONE,angle:0,behavior:t.BRB_DEFAULT,zindex:.5,behavior_arg:[]},n=0;n<t.BRICKBEHAVIOR_MAXARGS;n++)e.behavior_arg[n]=0;return e}(),s=e.type;"OBSTACLE"==s?r.property=t.BRK_OBSTACLE:"PASSABLE"==s?r.property=t.BRK_NONE:"CLOUD"==s?r.property=t.BRK_CLOUD:(0,i.logfile_message)("Can't read brick attributes: unknown brick type ".concat(s)),"DEFAULT"==(s=(0,_.isArray)(e.behavior)?e.behavior[0]:e.behavior)?r.behavior=t.BRB_DEFAULT:"CIRCULAR"==s?r.behavior=t.BRB_CIRCULAR:"BREAKABLE"==s?r.behavior=t.BRB_BREAKABLE:"FALL"==s?r.behavior=t.BRB_FALL:(0,i.logfile_message)("Can't read brick attributes: unknown brick type ".concat(s));for(var d=0;d<t.BRICKBEHAVIOR_MAXARGS;d++)r.behavior_arg[d]=e.behavior[1+d];r.behavior_arg[r.behavior_arg.length-1]=0,r.angle=e.angle,e.zindex&&(r.zindex=e.zindex),(0,a.sprite_create)(e.sprite).then((function(e){r.data=e,r.image=e.frame_data[0],c++,n(r)}))}))}},2985:(e,t,n)=>{t.kX=t.gY=t.H1=t.vY=t.q1=t.Xq=t.LF=t.qO=void 0;var a=n(9386),o=n(2954),r=n(2878),i=n(4163),_=n(642),c=n(7266),s={is_locked:!1,position:(0,r.v2d_new)(0,0),dest:(0,r.v2d_new)(0,0),speed:0,region_topleft:(0,r.v2d_new)(0,0),region_bottomright:(0,r.v2d_new)(0,0),dest_region_topleft:(0,r.v2d_new)(0,0),dest_region_bottomright:(0,r.v2d_new)(0,0),region_topleft_speed:0,region_bottomright_speed:0};t.qO=function(){s.is_locked=!1,s.speed=0,s.region_topleft_speed=0,s.region_bottomright_speed=0,s.position=s.dest=(0,r.v2d_new)(0,0),s.region_topleft.x=s.dest_region_topleft.x=_.VIDEO_SCREEN_W/2,s.region_topleft.y=s.dest_region_topleft.y=_.VIDEO_SCREEN_H/2,s.region_bottomright.x=s.dest_region_bottomright.x=(0,c.level_size)().x-_.VIDEO_SCREEN_W/2,s.region_bottomright.y=s.dest_region_bottomright.y=(0,c.level_size)().y-_.VIDEO_SCREEN_H/2},t.LF=function(){var e,t=(0,i.timer_get_delta)();l(),e=(0,r.v2d_subtract)(s.dest,s.position),(0,r.v2d_magnitude)(e)>10&&(e=(0,r.v2d_normalize)(e),s.position.x+=e.x*s.speed*t,s.position.y+=e.y*s.speed*t),e=(0,r.v2d_subtract)(s.dest_region_topleft,s.region_topleft),(0,r.v2d_magnitude)(e)>10&&(e=(0,r.v2d_normalize)(e),s.region_topleft.x+=e.x*s.region_topleft_speed*t,s.region_topleft.y+=e.y*s.region_topleft_speed*t),e=(0,r.v2d_subtract)(s.dest_region_bottomright,s.region_bottomright),(0,r.v2d_magnitude)(e)>10&&(e=(0,r.v2d_normalize)(e),s.region_bottomright.x+=e.x*s.region_bottomright_speed*t,s.region_bottomright.y+=e.y*s.region_bottomright_speed*t),s.position.x=(0,o.clip)(s.position.x,s.region_topleft.x,s.region_bottomright.x),s.position.y=(0,o.clip)(s.position.y,s.region_topleft.y,s.region_bottomright.y)},t.Xq=function(){},t.q1=function(e,t){e.x<s.region_topleft.x&&(e.x=s.region_topleft.x),e.y<s.region_topleft.y&&(e.y=s.region_topleft.y),e.x>s.region_bottomright.x&&(e.x=s.region_bottomright.x),e.y>s.region_bottomright.y&&(e.y=s.region_bottomright.y),s.dest=e,t>a.EPSILON?s.speed=(0,r.v2d_magnitude)((0,r.v2d_subtract)(s.position,s.dest))/t:s.position=s.dest,s.position.x=e.x,s.position.y=e.y},t.vY=function(e,t,n,a){s.is_locked=!0,d(e,t,n,a)},t.H1=function(){s.is_locked=!1},t.gY=function(){return(0,r.v2d_new)(s.position.x,s.position.y)},t.kX=function(e){var t=(0,r.v2d_new)(e.x,e.y);s.dest=s.position=t};var d=function(e,t,n,a){s.dest_region_topleft.x=Math.max(Math.min(e,n),_.VIDEO_SCREEN_W/2),s.dest_region_topleft.y=Math.max(Math.min(t,a),_.VIDEO_SCREEN_H/2),s.dest_region_bottomright.x=Math.min(Math.max(e,n),(0,c.level_size)().x-_.VIDEO_SCREEN_W/2),s.dest_region_bottomright.y=Math.min(Math.max(t,a),(0,c.level_size)().y-_.VIDEO_SCREEN_H/2),s.region_topleft_speed=(0,r.v2d_magnitude)((0,r.v2d_subtract)(s.region_topleft,s.dest_region_topleft))/.25,s.region_bottomright_speed=(0,r.v2d_magnitude)((0,r.v2d_subtract)(s.region_bottomright,s.dest_region_bottomright))/.25},l=function(){s.is_locked||d(-a.INFINITY,-a.INFINITY,a.INFINITY,a.INFINITY)}},1459:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.enemy_observe_active_player=t.enemy_observe_current_player=t.enemy_observe_player=t.enemy_get_observed_player=t.enemy_remove_child=t.enemy_add_child=t.enemy_get_child=t.enemy_get_parent=t.enemy_render=t.enemy_update=t.enemy_destroy=t.enemy_create=t.enemy_get_list_of_names=t.enemy_release=t.enemy_objects_init=t.ES_DEAD=t.ES_IDLE=t.enemystate_t=void 0;var a,o=n(7898),r=n(9880),i=n(7774),_=n(3450),c=n(7266),s=n(3031),d=n(2141),l=n(9036);!function(e){e[e.ES_IDLE=0]="ES_IDLE",e[e.ES_DEAD=1]="ES_DEAD"}(a||(t.enemystate_t=a={})),t.ES_IDLE=a.ES_IDLE,t.ES_DEAD=a.ES_DEAD;var u=null,p=[];t.enemy_objects_init=function(){(0,o.logfile_message)("Loading objects scripts..."),u=null,(0,_.resourcemanager_getJsonFile)("data/objects/enemies.json").then((function(e){m(u,e),u=e}))},t.enemy_release=function(){u=null},t.enemy_get_list_of_names=function(e){return p},t.enemy_create=function(e){return f(e)},t.enemy_destroy=function(e){if(!e)return null;for(var n=e.children;n;n=n.next)n.data.parent=null;return h(e.children),null!=e.parent&&(0,t.enemy_remove_child)(e.parent,e),(0,d.object_vm_destroy)(e.vm),(0,s.actor_destroy)(e.actor),null},t.enemy_update=function(e,t,n,a,o,r){if(e){var i=(0,d.object_vm_get_reference_to_current_state)(e.vm);i.update(i,t,n,a,o,r)}},t.enemy_render=function(e,t){if(e){var n=(0,d.object_vm_get_reference_to_current_state)(e.vm);(!e.hide_unless_in_editor_mode||e.hide_unless_in_editor_mode&&(0,c.level_editmode)())&&n.render(n,t)}},t.enemy_get_parent=function(e){return e.parent},t.enemy_get_child=function(e,t){return I(e.children,t)},t.enemy_add_child=function(e,t,n){e.children=b(e.children,t,n),n.parent=e,n.created_from_editor=!1},t.enemy_remove_child=function(e,t){e.children=E(e.children,t)},t.enemy_get_observed_player=function(e){return null!=e.observed_player?e.observed_player:(0,c.level_player)()},t.enemy_observe_player=function(e,t){e.observed_player=t},t.enemy_observe_current_player=function(e){e.observed_player=(0,c.level_player)()},t.enemy_observe_active_player=function(e){e.observed_player=null};var f=function(e){var n={in_object_name:null,out_object_block:null},a={name:e,state:t.ES_IDLE,actor:(0,s.actor_create)(),preserve:!0,obstacle:!1,obstacle_angle:0,always_active:!1,hide_unless_in_editor_mode:!1,vm:null,created_from_editor:!0,parent:null,children:v(),observed_player:null};return a.actor.input=(0,i.input_create_computer)(),(0,s.actor_change_animation)(a.actor,(0,r.sprite_get_animation)("SD_QUESTIONMARK",0)),a.vm=(0,d.object_vm_create)(a),n.in_object_name=e,n.out_object_block=null,n.out_object_block=g(u,n),null!=n.out_object_block?a=(0,l.object_compiler_compile)(a,n.out_object_block):(0,o.logfile_message)("Object ".concat(e," does not exist")),a},g=function(e,t){var n=e[t.in_object_name];return n?(t.in_object_name,n):((0,o.logfile_message)("Object script error: unknown keyword ".concat(n)),0)},m=function(e,t){return e},v=function(){return null},h=function(e){return null!=e&&(h(e.next),e.name=null,e=null),null},b=function(e,t,n){return{name:t,data:n,next:e}},E=function(e,t){var n,a;if(null!=e){if(e.data==t)return a=e.next,e.name=null,e=null,a;for(n=e;null!=n.next&&n.next.data!=t;)n=n.next;return null!=n.next&&(a=n.next.next,n.next.name=null,n.next=null,n.next=a),e}return null},I=function(e,t){for(var n=e;null!=n;){if(n.name==t)return n.data;n=n.next}return null}},2530:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.font_render=t.font_set_width=t.font_get_charspacing=t.font_get_charsize=t.font_get_text=t.font_set_text=t.font_destroy=t.font_create=t.font_init=void 0;var a=n(7898),o=n(2954),r=n(2878),i=n(6038),_=n(9880),c=n(642),s=[],d={};t.font_init=function(){var e,t,n,o=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for((0,a.logfile_message)("font_init()"),e=0;e<o.length;e++)for(s[e]={ch:[]},n="FT_FONT"+e,t=0;t<o[e].length;t++)s[e].ch[o[e][t]]=(0,_.sprite_get_image)((0,_.sprite_get_animation)(n,0),t);(0,a.logfile_message)("font_init() ok")},t.font_create=function(e){for(var t={type:(0,o.clip)(e,0,9),text:null,width:0,visible:!0,hspace:1,vspace:1,value:[],position:(0,r.v2d_new)(0,0)},n=0;n<5;n++)t.value[n]=0;return t},t.font_destroy=function(e){e.text&&(e.text=null)},t.font_set_text=function(e,t){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];if(!e)return!1;for(var o=0;o<n.length;o++)n[o]=""+n[o];var r=(t=""+t).match(/\$[A-Z_\d]\w+/g);if(r)for(o=0;o<r.length;o++){var _=r[o].slice(1),c=(0,i.lang_get)(_);c&&(t=t.replace("$"+_,c))}if(r=t.match(/\%[s]+/g))for(o=0;o<r.length;o++)n[o]&&((_=n[o].match(/\$[A-Z_\d]\w+/g))&&(n[o]=_[0].slice(1)),t=t.replace("%s",(0,i.lang_get)(n[o])));if(r=t.match(/\%[d]+/g))for(o=0;o<r.length;o++)n[o]&&(t=t.replace("%d",""+n[o]));return e.text=""+t,e},t.font_get_text=function(e){return e.text?e.text:""},t.font_get_charsize=function(e){return l(e)},t.font_get_charspacing=function(e){return(0,r.v2d_new)(e.hspace,e.vspace)},t.font_set_width=function(e,t){e.width=Math.max(0,t)},t.font_render=function(e,t){var n,a,r,i,_,d=0,f=0,g=[],m=0,v=0;g[v++]={r:!1,g:0,b:0};var h=l(e);if(n=h.x,a=h.y,e&&e.visible&&e.text)for(m=0;m<e.text.length;m++){if(r=e.text[m],_=!1,(0,o.isspace)(e.text[m-1])){var b=void 0,E=!1,I=0,y=e.text.slice(m),x=(y=(y=y.replace("(","")).replace(")","")).split(" ")[0];for(b=0;b<x.length;b++)"<"==x[b]&&(E=!0),E||I++,">"==x[b]&&(E=!1);_=e.width>0&&d+(n+e.hspace)*I-e.hspace>e.width}if("<"==r){if("<color="==(E=e.text.slice(m,m+7))){var S,w,L;m+=7;var O=e.text.slice(m,m+6);S=p(O.slice(0,2)),w=p(O.slice(2,4)),L=p(O.slice(4,6)),g[v++]={r:S,g:w,b:L},m+=7,r=e.text[m]}"</color"==E&&(m+=8,r=e.text[m],v>=2&&v--)}_&&(d=0,f+=a+e.vspace),"\n"!=r?(i=s[e.type].ch[r])?(d+=i.width,(0,o.isspace)(e.text[m-1]),u((0,c.video_get_backbuffer)(),i,~~e.position.x+d-(t.x-c.VIDEO_SCREEN_W/2),~~e.position.y+f-(t.y-c.VIDEO_SCREEN_H/2),g[v-1])):d+=n+e.hspace:(d=0,f+=a+e.vspace)}};var l=function(e){var t,n;if(e)for(t=0;t<256;t++)if(s[e.type]&&null!=(n=s[e.type].ch[t]))return(0,r.v2d_new)(n.width,n.height);return(0,r.v2d_new)(16,16)},u=function(e,t,n,a,o){var r,i=t.data;o&&o.r&&(r=f(t.data),i=g(t.data,r,o.r,o.g,o.b)),e.drawImage(i,t.sx,t.sy,t.swidth,t.sheight,n,a-2,t.width*c.VIDEO_SCALE,t.height*c.VIDEO_SCALE)},p=function(e){var t=/^#?([a-f\d]{2})$/i.exec(e);return t?parseInt(t[1],16):null},f=function(e){if(d[e.src])return d[e.src];var t=e.width,n=e.height,a=[],o=document.createElement("canvas");o.width=t,o.height=n;var r=o.getContext("2d");r.drawImage(e,0,0);for(var i=r.getImageData(0,0,t,n).data,_=0;_<4;_++){var c=document.createElement("canvas");c.width=t,c.height=n;var s=c.getContext("2d");s.drawImage(e,0,0);for(var l=s.getImageData(0,0,t,n),u=l.data,p=0,f=i.length;p<f;p+=4)u[p]=0===_?i[p]:0,u[p+1]=1===_?i[p+1]:0,u[p+2]=2===_?i[p+2]:0,u[p+3]=i[p+3];s.putImageData(l,0,0);var g=new Image;g.src=c.toDataURL(),a.push(g)}return d[e.src]=a,a},g=function(e,t,n,a,o){var r=document.createElement("canvas");r.width=e.width,r.height=e.height;var i=r.getContext("2d");return i.globalAlpha=1,i.globalCompositeOperation="copy",i.drawImage(t[3],0,0),i.globalCompositeOperation="lighter",n>0&&(i.globalAlpha=n/255,i.drawImage(t[0],0,0)),a>0&&(i.globalAlpha=a/255,i.drawImage(t[1],0,0)),o>0&&(i.globalAlpha=o/255,i.drawImage(t[2],0,0)),r}},2594:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IT_RYELLOWSPRING=t.IT_BREDSPRING=t.IT_BLREDSPRING=t.IT_BRREDSPRING=t.IT_TLREDSPRING=t.IT_TRREDSPRING=t.IT_FIRESHIELDBOX=t.IT_FIREBALL=t.IT_DANGPOWER=t.IT_DNADOOR=t.IT_SPIKES=t.IT_DANGER=t.IT_BUMPER=t.IT_LOOPFLOORTOP=t.IT_LOOPFLOORNONE=t.IT_LOOPFLOOR=t.IT_ENDLEVEL=t.IT_ENDSIGN=t.IT_GOAL=t.IT_CHECKPOINT=t.IT_BIGRING=t.IT_TELEPORTER=t.IT_DOOR=t.IT_SWITCH=t.IT_BLUERING=t.IT_LREDSPRING=t.IT_RREDSPRING=t.IT_REDSPRING=t.IT_YELLOWSPRING=t.IT_LOOPNONE=t.IT_LOOPLEFT=t.IT_LOOPMIDDLE=t.IT_LOOPRIGHT=t.IT_ANIMAL=t.IT_PIXEL=t.IT_FLYINGTEXT=t.IT_EXPLOSION=t.IT_FALGLASSES=t.IT_ICON=t.IT_CRUSHEDBOX=t.IT_EMPTYBOX=t.IT_TRAPBOX=t.IT_SHIELDBOX=t.IT_GLASSESBOX=t.IT_SPEEDBOX=t.IT_STARBOX=t.IT_RINGBOX=t.IT_LIFEBOX=t.IT_RING=t.ITEMDATA_MAX=void 0,t.item_render=t.item_update=t.item_destroy=t.item_create=t.IS_DEAD=t.IS_IDLE=t.itemstate_t=t.IT_WINDSHIELDBOX=t.IT_ACIDSHIELDBOX=t.IT_WATERSHIELDBOX=t.IT_THUNDERSHIELDBOX=t.IT_VFIREDANGER=t.IT_FIREDANGER=t.IT_VDANGER=t.IT_HDNADOORCHARGE=t.IT_HDNADOORNEON=t.IT_HDNADOOR=t.IT_DNADOORCHARGE=t.IT_DNADOORNEON=t.IT_PERRWSPIKES=t.IT_PERLWSPIKES=t.IT_PERCEILSPIKES=t.IT_PERSPIKES=t.IT_RWSPIKES=t.IT_LWSPIKES=t.IT_CEILSPIKES=t.IT_BBLUESPRING=t.IT_BLBLUESPRING=t.IT_BRBLUESPRING=t.IT_TLBLUESPRING=t.IT_TRBLUESPRING=t.IT_LBLUESPRING=t.IT_RBLUESPRING=t.IT_BLUESPRING=t.IT_BYELLOWSPRING=t.IT_BLYELLOWSPRING=t.IT_BRYELLOWSPRING=t.IT_TLYELLOWSPRING=t.IT_TRYELLOWSPRING=t.IT_LYELLOWSPRING=void 0;var a,o=n(7266),r=n(8806),i=n(7006),_=n(1053),c=n(596),s=n(4324),d=n(3752),l=n(7105),u=n(785),p=n(7293),f=n(6330),g=n(1040),m=n(2672),v=n(2448),h=n(71),b=n(3111),E=n(8326),I=n(6214),y=n(2038),x=n(7100),S=n(7598),w=n(5876),L=n(7852),O=n(4231),R=n(8738);t.ITEMDATA_MAX=82,t.IT_RING=0,t.IT_LIFEBOX=1,t.IT_RINGBOX=2,t.IT_STARBOX=3,t.IT_SPEEDBOX=4,t.IT_GLASSESBOX=5,t.IT_SHIELDBOX=6,t.IT_TRAPBOX=7,t.IT_EMPTYBOX=8,t.IT_CRUSHEDBOX=9,t.IT_ICON=10,t.IT_FALGLASSES=11,t.IT_EXPLOSION=12,t.IT_FLYINGTEXT=13,t.IT_PIXEL=14,t.IT_ANIMAL=15,t.IT_LOOPRIGHT=16,t.IT_LOOPMIDDLE=17,t.IT_LOOPLEFT=18,t.IT_LOOPNONE=19,t.IT_YELLOWSPRING=20,t.IT_REDSPRING=21,t.IT_RREDSPRING=22,t.IT_LREDSPRING=23,t.IT_BLUERING=24,t.IT_SWITCH=25,t.IT_DOOR=26,t.IT_TELEPORTER=27,t.IT_BIGRING=28,t.IT_CHECKPOINT=29,t.IT_GOAL=30,t.IT_ENDSIGN=31,t.IT_ENDLEVEL=32,t.IT_LOOPFLOOR=33,t.IT_LOOPFLOORNONE=34,t.IT_LOOPFLOORTOP=35,t.IT_BUMPER=36,t.IT_DANGER=37,t.IT_SPIKES=38,t.IT_DNADOOR=39,t.IT_DANGPOWER=40,t.IT_FIREBALL=41,t.IT_FIRESHIELDBOX=42,t.IT_TRREDSPRING=43,t.IT_TLREDSPRING=44,t.IT_BRREDSPRING=45,t.IT_BLREDSPRING=46,t.IT_BREDSPRING=47,t.IT_RYELLOWSPRING=48,t.IT_LYELLOWSPRING=49,t.IT_TRYELLOWSPRING=50,t.IT_TLYELLOWSPRING=51,t.IT_BRYELLOWSPRING=52,t.IT_BLYELLOWSPRING=53,t.IT_BYELLOWSPRING=54,t.IT_BLUESPRING=55,t.IT_RBLUESPRING=56,t.IT_LBLUESPRING=57,t.IT_TRBLUESPRING=58,t.IT_TLBLUESPRING=59,t.IT_BRBLUESPRING=60,t.IT_BLBLUESPRING=61,t.IT_BBLUESPRING=62,t.IT_CEILSPIKES=63,t.IT_LWSPIKES=64,t.IT_RWSPIKES=65,t.IT_PERSPIKES=66,t.IT_PERCEILSPIKES=67,t.IT_PERLWSPIKES=68,t.IT_PERRWSPIKES=69,t.IT_DNADOORNEON=70,t.IT_DNADOORCHARGE=71,t.IT_HDNADOOR=72,t.IT_HDNADOORNEON=73,t.IT_HDNADOORCHARGE=74,t.IT_VDANGER=75,t.IT_FIREDANGER=76,t.IT_VFIREDANGER=77,t.IT_THUNDERSHIELDBOX=78,t.IT_WATERSHIELDBOX=79,t.IT_ACIDSHIELDBOX=80,t.IT_WINDSHIELDBOX=81,function(e){e[e.IS_IDLE=0]="IS_IDLE",e[e.IS_DEAD=1]="IS_DEAD"}(a||(t.itemstate_t=a={})),t.IS_IDLE=a.IS_IDLE,t.IS_DEAD=a.IS_DEAD,t.item_create=function(e){var n=null;switch(e){case t.IT_RING:n=(0,S.ring_create)();break;case t.IT_LIFEBOX:n=(0,y.lifebox_create)();break;case t.IT_RINGBOX:n=(0,y.ringbox_create)();break;case t.IT_STARBOX:n=(0,y.starbox_create)();break;case t.IT_SPEEDBOX:n=(0,y.speedbox_create)();break;case t.IT_GLASSESBOX:n=(0,y.glassesbox_create)();break;case t.IT_SHIELDBOX:n=(0,y.shieldbox_create)();break;case t.IT_FIRESHIELDBOX:n=(0,y.fireshieldbox_create)();break;case t.IT_THUNDERSHIELDBOX:n=(0,y.thundershieldbox_create)();break;case t.IT_WATERSHIELDBOX:n=(0,y.watershieldbox_create)();break;case t.IT_ACIDSHIELDBOX:n=(0,y.acidshieldbox_create)();break;case t.IT_WINDSHIELDBOX:n=(0,y.windshieldbox_create)();break;case t.IT_TRAPBOX:n=(0,y.trapbox_create)();break;case t.IT_EMPTYBOX:n=(0,y.emptybox_create)();break;case t.IT_CRUSHEDBOX:n=(0,l.crushedbox_create)();break;case t.IT_ICON:n=(0,I.icon_create)();break;case t.IT_FALGLASSES:n=(0,h.falglasses_create)();break;case t.IT_EXPLOSION:n=(0,v.explosion_create)();break;case t.IT_FLYINGTEXT:n=(0,b.flyingtext_create)();break;case t.IT_ANIMAL:n=(0,r.animal_create)();break;case t.IT_LOOPRIGHT:n=(0,x.loopright_create)();break;case t.IT_LOOPMIDDLE:n=(0,x.looptop_create)();break;case t.IT_LOOPLEFT:n=(0,x.loopleft_create)();break;case t.IT_LOOPNONE:n=(0,x.loopnone_create)();break;case t.IT_LOOPFLOOR:n=(0,x.loopfloor_create)();break;case t.IT_LOOPFLOORNONE:n=(0,x.loopfloornone_create)();break;case t.IT_LOOPFLOORTOP:n=(0,x.loopfloortop_create)();break;case t.IT_YELLOWSPRING:n=(0,L.yellowspring_create)();break;case t.IT_BYELLOWSPRING:n=(0,L.byellowspring_create)();break;case t.IT_TRYELLOWSPRING:n=(0,L.tryellowspring_create)();break;case t.IT_RYELLOWSPRING:n=(0,L.ryellowspring_create)();break;case t.IT_BRYELLOWSPRING:n=(0,L.bryellowspring_create)();break;case t.IT_BLYELLOWSPRING:n=(0,L.blyellowspring_create)();break;case t.IT_LYELLOWSPRING:n=(0,L.lyellowspring_create)();break;case t.IT_TLYELLOWSPRING:n=(0,L.tlyellowspring_create)();break;case t.IT_REDSPRING:n=(0,L.redspring_create)();break;case t.IT_BREDSPRING:n=(0,L.bredspring_create)();break;case t.IT_TRREDSPRING:n=(0,L.trredspring_create)();break;case t.IT_RREDSPRING:n=(0,L.rredspring_create)();break;case t.IT_BRREDSPRING:n=(0,L.brredspring_create)();break;case t.IT_BLREDSPRING:n=(0,L.blredspring_create)();break;case t.IT_LREDSPRING:n=(0,L.lredspring_create)();break;case t.IT_TLREDSPRING:n=(0,L.tlredspring_create)();break;case t.IT_BLUESPRING:n=(0,L.bluespring_create)();break;case t.IT_BBLUESPRING:n=(0,L.bbluespring_create)();break;case t.IT_TRBLUESPRING:n=(0,L.trbluespring_create)();break;case t.IT_RBLUESPRING:n=(0,L.rbluespring_create)();break;case t.IT_BRBLUESPRING:n=(0,L.brbluespring_create)();break;case t.IT_BLBLUESPRING:n=(0,L.blbluespring_create)();break;case t.IT_LBLUESPRING:n=(0,L.lbluespring_create)();break;case t.IT_TLBLUESPRING:n=(0,L.tlbluespring_create)();break;case t.IT_BLUERING:n=(0,c.bluering_create)();break;case t.IT_SWITCH:n=(0,O.switch_create)();break;case t.IT_DOOR:o.PLAYERS.length>1&&(n=(0,g.door_create)());break;case t.IT_TELEPORTER:n=(0,R.teleporter_create)();break;case t.IT_BIGRING:n=(0,_.bigring_create)();break;case t.IT_CHECKPOINT:n=(0,d.checkpointorb_create)();break;case t.IT_GOAL:n=(0,E.goalsign_create)();break;case t.IT_ENDSIGN:n=(0,m.endsign_create)();break;case t.IT_ENDLEVEL:n=(0,i.animalprison_create)();break;case t.IT_BUMPER:n=(0,s.bumper_create)();break;case t.IT_DANGER:n=(0,u.horizontaldanger_create)();break;case t.IT_VDANGER:n=(0,u.verticaldanger_create)();break;case t.IT_FIREDANGER:n=(0,u.horizontalfiredanger_create)();break;case t.IT_VFIREDANGER:n=(0,u.verticalfiredanger_create)();break;case t.IT_SPIKES:n=(0,w.floorspikes_create)();break;case t.IT_CEILSPIKES:n=(0,w.ceilingspikes_create)();break;case t.IT_LWSPIKES:n=(0,w.leftwallspikes_create)();break;case t.IT_RWSPIKES:n=(0,w.rightwallspikes_create)();break;case t.IT_PERSPIKES:n=(0,w.periodic_floorspikes_create)();break;case t.IT_PERCEILSPIKES:n=(0,w.periodic_ceilingspikes_create)();break;case t.IT_PERLWSPIKES:n=(0,w.periodic_leftwallspikes_create)();break;case t.IT_PERRWSPIKES:n=(0,w.periodic_rightwallspikes_create)();break;case t.IT_DNADOOR:n=(0,f.surge_dnadoor_create)();break;case t.IT_DNADOORNEON:n=(0,f.neon_dnadoor_create)();break;case t.IT_DNADOORCHARGE:n=(0,f.charge_dnadoor_create)();break;case t.IT_HDNADOOR:n=(0,f.surge_horizontal_dnadoor_create)();break;case t.IT_HDNADOORNEON:n=(0,f.neon_horizontal_dnadoor_create)();break;case t.IT_HDNADOORCHARGE:n=(0,f.charge_horizontal_dnadoor_create)();break;case t.IT_DANGPOWER:case t.IT_FIREBALL:n=(0,p.dangerouspower_create)()}return null!=n&&(n.type=e,n.state=t.IS_IDLE,n.init(n)),n},t.item_destroy=function(e){return null},t.item_update=function(e,t,n,a,o,r){e.update(e,t,n,a,o,r)},t.item_render=function(e,t){e.render(e,t)}},8806:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animal_create=void 0;var a=n(3031),o=n(9880),r=n(2954),i=n(7774),_=n(9386),c=n(2594),s=n(7266);t.animal_create=function(){return{init:d,release:l,update:u,render:p}};var d=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,a.actor_create)(),e.actor.maxspeed=145+(0,r.random)(21),e.actor.input=(0,i.input_create_computer)(),t.is_running=!1,t.animal_id=(0,r.random)(12),(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_ANIMAL",0))},l=function(e){(0,a.actor_destroy)(e.actor)},u=function(e,t,n,d,l,u){var p,f,g,m,v=e,h=e.actor,b=2*v.animal_id+(v.is_running?1:0);(0,i.input_simulate_button_down)(h.input,i.IB_FIRE1),h.jump_strength=1.3*(200+(0,r.random)(50)),h.speed.x>_.EPSILON?(h.speed.x=h.maxspeed,h.mirror=_.IF_NONE):h.speed.x<-_.EPSILON&&(h.speed.x=-h.maxspeed,h.mirror=_.IF_HFLIP),(0,a.actor_change_animation)(h,(0,o.sprite_get_animation)("SD_ANIMAL",b));var E=(0,a.actor_corners)(h,2,-2,d,p,null,m,null,f,null,g,null);p=E.up,E.upright,m=E.right,E.downright,f=E.down,E.downleft,g=E.left,E.upleft;var I=(0,a.actor_handle_clouds)(h,-2,p,null,m,null,f,null,g,null);p=I.up,I.upright,m=I.right,I.downright,f=I.down,I.downleft,g=I.left,I.upleft,f&&!v.is_running&&(v.is_running=!0,h.speed.x=((0,r.random)(2)?-1:1)*h.maxspeed),g&&!p&&(h.speed.x=h.maxspeed),m&&!p&&(h.speed.x=-h.maxspeed),!v.is_running&&(f&&p||g&&m)&&(e.state=c.IS_DEAD),(0,a.actor_move)(h,(0,a.actor_platform_movement)(h,d,(0,s.level_gravity)()))},p=function(e,t){(0,a.actor_render)(e.actor,t)}},7006:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.animalprison_create=void 0;var a=n(5141),o=n(9931),r=n(4470),i=n(3031),_=n(9880),c=n(4163),s=n(2954),d=n(2878),l=n(2594),u=n(7266);t.animalprison_create=function(){var e={init:p,release:f,update:g,render:m,state:null};return e};var p=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),v(e,h()),(0,i.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_ENDLEVEL",0))},f=function(e){(0,i.actor_destroy)(e.actor),v(e,null)},g=function(e,t,n,a,o,r){var i=e;i.state.handle(i.state,e,t,n)},m=function(e,t){(0,i.actor_render)(e.actor,t)},v=function(e,t){e.state=t},h=function(){var e={handle:b},t=e;return t.being_hit=!1,t.hit_count=0,e},b=function(e,t,n,c){for(var s,d,l=e,u=t.actor,p=0;p<c;p++){var f=n[p];x(t,f)&&!l.being_hit&&(l.being_hit=!0,(0,i.actor_change_animation)(u,(0,_.sprite_get_animation)("SD_ENDLEVEL",1)),(0,o.sound_play)((0,r.soundfactory_get)("boss hit")),(0,a.player_bounce)(f),f.actor.speed.x*=-.5,++l.hit_count>=3&&v(t,(s=void 0,d=void 0,d=s={handle:E},s.handle=E,d.explode_timer=0,d.break_timer=0,s)))}(0,i.actor_animation_finished)(u)&&l.being_hit&&((0,i.actor_change_animation)(u,(0,_.sprite_get_animation)("SD_ENDLEVEL",0)),l.being_hit=!1)},E=function(e,t,n,a){var _=e,p=t.actor,f=(0,c.timer_get_delta)();if(_.explode_timer+=f,_.break_timer+=f,_.explode_timer>=.1){var g=(0,d.v2d_new)(p.position.x-p.hot_spot.x+(0,s.random)((0,i.actor_image)(p).width),p.position.y-p.hot_spot.y+(0,s.random)((0,i.actor_image)(p).height/2));(0,u.level_create_item)(l.IT_EXPLOSION,g),(0,o.sound_play)((0,r.soundfactory_get)("explode")),_.explode_timer=0}_.break_timer>=2&&v(t,{handle:I})},I=function(e,t,n,a){for(var o=t.actor,r=0;r<20;r++){var c=(0,d.v2d_new)(o.position.x-o.hot_spot.x+(0,s.random)((0,i.actor_image)(o).width),o.position.y-o.hot_spot.y+(0,s.random)((0,i.actor_image)(o).height/2));(0,u.level_create_animal)(c)}(0,u.level_clear)(o),(0,i.actor_change_animation)(o,(0,_.sprite_get_animation)("SD_ENDLEVEL",2)),v(t,{handle:y})},y=function(e,t,n,a){},x=function(e,t){if(e&&t){var n=[],o=[],r=e.actor,_=t.actor;return n[0]=_.position.x-_.hot_spot.x,n[1]=_.position.y-_.hot_spot.y,n[2]=n[0]+(0,i.actor_image)(_).width,n[3]=n[1]+(0,i.actor_image)(_).height,o[0]=r.position.x-r.hot_spot.x+5,o[1]=r.position.y-r.hot_spot.y,o[2]=o[0]+(0,i.actor_image)(r).width-10,o[3]=o[1]+(0,i.actor_image)(r).height/2,(0,a.player_attacking)(t)&&(0,s.bounding_box)(n,o)&&(0,i.actor_pixelperfect_collision)(r,_)}}},1053:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bigring_create=void 0;var a=n(9931),o=n(4470),r=n(9880),i=n(3031),_=n(2594),c=n(5141),s=n(7266),d=n(7307);t.bigring_create=function(){return{init:l,release:u,update:p,render:f}};var l=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_BLUERING",0))},u=function(e){(0,i.actor_destroy)(e.actor)},p=function(e,t,n,r,l,u){for(var p=0;p<n;p++){var f=t[p];f&&!f.dying&&(0,i.actor_collision)(f.actor,e.actor)&&(e.state=_.IS_DEAD,(0,c.player_set_rings)((0,c.player_get_rings)()+50),(0,s.level_add_to_secret_bonus)(5e3),(0,a.sound_play)((0,o.soundfactory_get)("big ring")),(0,s.level_call_dialogbox)("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),(0,d.quest_setvalue)(d.QUESTVALUE_BIGRINGS,(0,d.quest_getvalue)(d.QUESTVALUE_BIGRINGS)+1))}},f=function(e,t){(0,i.actor_render)(e.actor,t)}},596:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bluering_create=void 0;var a=n(9931),o=n(4470),r=n(9880),i=n(3031),_=n(2594),c=n(5141),s=n(7266);t.bluering_create=function(){return{init:d,release:p,update:l,render:u}};var d=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),t.is_disappearing=!1,(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_BLUERING",0))},l=function(e,t,n,d,l,u){var p=(0,s.level_player)(),f=e,g=e.actor;g.visible=p.got_glasses||(0,s.level_editmode)(),f.is_disappearing?(0,i.actor_animation_finished)(g)&&(e.state=_.IS_DEAD):!p.dying&&p.got_glasses&&(0,i.actor_collision)(g,p.actor)&&((0,i.actor_change_animation)(g,(0,r.sprite_get_animation)("SD_BLUERING",1)),(0,c.player_set_rings)((0,c.player_get_rings)()+5),(0,a.sound_play)((0,o.soundfactory_get)("blue ring")),f.is_disappearing=!0)},u=function(e,t){(0,i.actor_render)(e.actor,t)},p=function(e){(0,i.actor_destroy)(e.actor)}},4324:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.bumper_create=void 0;var a=n(2878),o=n(9931),r=n(4470),i=n(3031),_=n(9880);t.bumper_create=function(){return{init:c,release:l,update:s,render:d}};var c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),t.getting_hit=!1,(0,i.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_BUMPER",0))},s=function(e,t,n,a,c,s){for(var d=e,l=e.actor,p=0;p<n;p++){var f=t[p];f&&!f.dying&&(0,i.actor_pixelperfect_collision)(f.actor,l)&&(d.getting_hit||(d.getting_hit=!0,(0,i.actor_change_animation)(l,(0,_.sprite_get_animation)("SD_BUMPER",1)),(0,o.sound_play)((0,r.soundfactory_get)("bumper")),u(e,f)))}d.getting_hit&&(0,i.actor_animation_finished)(l)&&(d.getting_hit=!1,(0,i.actor_change_animation)(l,(0,_.sprite_get_animation)("SD_BUMPER",0)))},d=function(e,t){(0,i.actor_render)(e.actor,t)},l=function(e){(0,i.actor_destroy)(e.actor)},u=function(e,t){var n,o,r,i=e.actor;(n=t.actor.speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),o=(0,a.v2d_multiply)((0,a.v2d_normalize)((0,a.v2d_subtract)(i.position,t.actor.position)),(0,a.v2d_magnitude)(n)),r=(0,a.v2d_multiply)(o,1),t.actor.speed=(0,a.v2d_multiply)((0,a.v2d_add)(n,(0,a.v2d_multiply)(r,-1e4)),1/10001),i.speed=(0,a.v2d_multiply)((0,a.v2d_add)(n,r),1/10001),t.flying=!1,t.landing=!1,t.climbing=!1,t.spring=!1}},3752:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkpointorb_create=void 0;var a=n(9931),o=n(4470),r=n(3031),i=n(9880),_=n(7266);t.checkpointorb_create=function(){return{init:c,release:l,update:s,render:d}};var c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,r.actor_create)(),t.is_active=!1,(0,r.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_CHECKPOINT",0))},s=function(e,t,n,c,s,d){var l=e,u=e.actor;if(l.is_active)(0,r.actor_animation_finished)(u)&&(0,r.actor_change_animation)(u,(0,i.sprite_get_animation)("SD_CHECKPOINT",2));else for(var p=0;p<n;p++){var f=t[p];if(f&&!f.dying&&(0,r.actor_pixelperfect_collision)(f.actor,u)){l.is_active=!0,(0,a.sound_play)((0,o.soundfactory_get)("checkpoint")),(0,_.level_set_spawn_point)(u.position),(0,r.actor_change_animation)(u,(0,i.sprite_get_animation)("SD_CHECKPOINT",1));break}}},d=function(e,t){(0,r.actor_render)(e.actor,t)},l=function(e){(0,r.actor_destroy)(e.actor)}},7105:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.crushedbox_create=void 0;var a=n(9880),o=n(3031);t.crushedbox_create=function(){return{init:r,release:c,update:i,render:_}};var r=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,o.actor_create)(),(0,o.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_ITEMBOX",10))},i=function(e,t,n,a,o,r){},_=function(e,t){(0,o.actor_render)(e.actor,t)},c=function(e){(0,o.actor_destroy)(e.actor)}},785:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.verticalfiredanger_create=t.horizontalfiredanger_create=t.verticaldanger_create=t.horizontaldanger_create=void 0;var a=n(5141),o=n(9880),r=n(3031),i=n(5141),_=n(7266);t.horizontaldanger_create=function(){return c("SD_DANGER",p)},t.verticaldanger_create=function(){return c("SD_VERTICALDANGER",p)},t.horizontalfiredanger_create=function(){return c("SD_FIREDANGER",f)},t.verticalfiredanger_create=function(){return c("SD_VERTICALFIREDANGER",f)};var c=function(e,t){var n={init:s,release:u,update:d,render:l},a=n;return n.init=s,n.release=u,n.update=d,n.render=l,a.sprite_name=e,a.player_is_vulnerable=t,n},s=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,r.actor_create)(),(0,r.actor_change_animation)(e.actor,(0,o.sprite_get_animation)(t.sprite_name,0))},d=function(e,t,n,o,i,c){for(var s=e,d=e.actor,l=0;l<n;l++){var u=t[l];u&&(u.dying||u.blinking||u.invincible||!(0,r.actor_collision)(d,u.actor)||s.player_is_vulnerable(u)&&(0,a.player_hit)(u))}d.visible=(0,_.level_editmode)()},l=function(e,t){(0,r.actor_render)(e.actor,t)},u=function(e){(0,r.actor_destroy)(e.actor)},p=function(e){return!0},f=function(e){return e.shield_type!=i.SH_FIRESHIELD}},7293:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dangerouspower_set_speed=t.dangerouspower_create=void 0;var a=n(5141),o=n(9880),r=n(4163),i=n(2878),_=n(3031),c=n(2594);t.dangerouspower_create=function(){return{init:s,release:u,update:d,render:l}},t.dangerouspower_set_speed=function(e,t){e.actor.speed=t};var s=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,_.actor_create)(),(0,_.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_DANGPOWER",0))},d=function(e,t,n,o,s,d){for(var l=(0,r.timer_get_delta)(),u=e.actor,p=(0,i.v2d_multiply)(u.speed,l),f=0;f<n;f++){var g=t[f];g&&!g.dying&&(0,_.actor_collision)(u,g.actor)&&((0,a.player_hit)(g),e.state=c.IS_DEAD)}u.position=(0,i.v2d_add)(u.position,p)},l=function(e,t){(0,_.actor_render)(e.actor,t)},u=function(e){(0,_.actor_destroy)(e.actor)}},6330:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.charge_horizontal_dnadoor_create=t.neon_horizontal_dnadoor_create=t.surge_horizontal_dnadoor_create=t.charge_dnadoor_create=t.neon_dnadoor_create=t.surge_dnadoor_create=void 0;var a=n(9880),o=n(4163),r=n(2954),i=n(3031),_=n(5141);t.surge_dnadoor_create=function(){return c(_.PL_SONIC,!0)},t.neon_dnadoor_create=function(){return c(_.PL_TAILS,!0)},t.charge_dnadoor_create=function(){return c(_.PL_KNUCKLES,!0)},t.surge_horizontal_dnadoor_create=function(){return c(_.PL_SONIC,!1)},t.neon_horizontal_dnadoor_create=function(){return c(_.PL_TAILS,!1)},t.charge_horizontal_dnadoor_create=function(){return c(_.PL_KNUCKLES,!1)};var c=function(e,t){var n={init:s,release:u,update:d,render:l},a=n;return a.authorized_player_type=e,a.is_vertical_door=t,n},s=function(e){var t,n,o=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.actor_create)(),n=o.authorized_player_type,t=o.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",(0,i.actor_change_animation)(e.actor,(0,a.sprite_get_animation)(t,n))},d=function(e,t,n,a,_,c){var s,d=e,l=e.actor,u=!1,f=!1,g=(0,o.timer_get_delta)(),m=[],v=[];e.obstacle=!0;for(var h=0;h<n;h++){var b=t[h];b&&(b.dying||b.actor.carrying||b.actor.carried_by||!p(b,e)||(b.type==d.authorized_player_type?(e.obstacle=!1,f=(0,i.actor_pixelperfect_collision)(l,b.actor)):u=!0))}if(u&&(e.obstacle=!0),e.obstacle?l.alpha=Math.min(1,l.alpha+2*g):f&&(l.alpha=Math.max(.4,l.alpha-2*g)),f)for(m[0]=l.position.x-l.hot_spot.x-5,m[1]=l.position.y-l.hot_spot.y-5,m[2]=m[0]+(0,i.actor_image)(l).width+10,m[3]=m[1]+(0,i.actor_image)(l).height+10,s=_;null!=s;s=s.next)s.data.type==e.type&&(v[0]=s.data.actor.position.x-s.data.actor.hot_spot.x-5,v[1]=s.data.actor.position.y-s.data.actor.hot_spot.y-5,v[2]=v[0]+(0,i.actor_image)(s.data.actor).width+10,v[3]=v[1]+(0,i.actor_image)(s.data.actor).height+10,(0,r.bounding_box)(m,v)&&(s.data.actor.alpha<l.alpha?l.alpha=s.data.actor.alpha:s.data.actor.alpha=l.alpha))},l=function(e,t){(0,i.actor_render)(e.actor,t)},u=function(e){(0,i.actor_destroy)(e.actor)},p=function(e,t){var n=[],a=[],o=e.actor,_=t.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+(0,i.actor_image)(o).width,n[3]=n[1]+(0,i.actor_image)(o).height,a[0]=_.position.x-_.hot_spot.x,a[1]=_.position.y-_.hot_spot.y-3,a[2]=a[0]+(0,i.actor_image)(_).width,a[3]=a[1]+(0,i.actor_image)(_).height+3,(0,r.bounding_box)(n,a)}},1040:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.door_close=t.door_open=t.door_create=void 0;var a=n(9931),o=n(4470),r=n(4163),i=n(3031),_=n(9880);t.door_create=function(){return{init:c,release:l,update:s,render:d}},t.door_open=function(e){e.is_closed=!1,(0,a.sound_play)((0,o.soundfactory_get)("open door"))},t.door_close=function(e){e.is_closed=!0,(0,a.sound_play)((0,o.soundfactory_get)("close door"))};var c=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,i.actor_create)(),t.is_closed=!0,(0,i.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_DOOR",0))},s=function(e,t,n,a,o,_){var c=e,s=e.actor,d=(0,r.timer_get_delta)();c.is_closed?s.position.y=Math.min(s.position.y+2e3*d,s.spawn_point.y):s.position.y=Math.max(s.position.y-2e3*d,s.spawn_point.y-.8*(0,i.actor_image)(s).height)},d=function(e,t){(0,i.actor_render)(e.actor,t)},l=function(e){(0,i.actor_destroy)(e.actor)}},2672:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.endsign_create=void 0;var a=n(9931),o=n(4470),r=n(9880),i=n(3031),_=n(7266);t.endsign_create=function(){return{init:c,release:l,update:s,render:d}};var c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.actor_create)(),t.who=null,(0,i.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ENDSIGN",0))},s=function(e,t,n,c,s,d){var l=e,u=e.actor;if(null==l.who){var p=void 0;for(p=0;p<n;p++){var f=t[p];f&&!f.dying&&(0,i.actor_pixelperfect_collision)(f.actor,u)&&(l.who=f,(0,a.sound_play)((0,o.soundfactory_get)("end sign")),(0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_ENDSIGN",1)),(0,_.level_clear)(e.actor))}}else if((0,i.actor_animation_finished)(u)){var g=2+l.who.type;(0,i.actor_change_animation)(u,(0,r.sprite_get_animation)("SD_ENDSIGN",g))}},d=function(e,t){(0,i.actor_render)(e.actor,t)},l=function(e){(0,i.actor_destroy)(e.actor)}},2448:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.explosion_create=void 0;var a=n(9880),o=n(2954),r=n(3031),i=n(2594);t.explosion_create=function(){return{init:_,release:d,update:c,render:s}};var _=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,r.actor_create)(),(0,r.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_EXPLOSION",(0,o.random)(2)))},c=function(e,t,n,a,o,_){(0,r.actor_animation_finished)(e.actor)&&(e.state=i.IS_DEAD)},s=function(e,t){(0,r.actor_render)(e.actor,t)},d=function(e){(0,r.actor_destroy)(e.actor)}},71:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.falglasses_set_speed=t.falglasses_create=void 0;var a=n(9386),o=n(9880),r=n(4163),i=n(2878),_=n(7266),c=n(3031);t.falglasses_create=function(){return{init:s,release:u,update:d,render:l}},t.falglasses_set_speed=function(e,t){null!=e.actor&&(e.actor.speed=t)};var s=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,c.actor_create)(),(0,c.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GLASSES",4)),e.actor.hot_spot.y*=.5},d=function(e,t,n,o,s,d){var l=e.actor,u=(0,r.timer_get_delta)();l.angle+=Math.sign(l.speed.x)*(6*a.PI*u),l.position=(0,i.v2d_add)(l.position,(0,c.actor_particle_movement)(l,(0,_.level_gravity)()))},l=function(e,t){(0,c.actor_render)(e.actor,t)},u=function(e){(0,c.actor_destroy)(e.actor)}},3111:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flyingtext_set_text=t.flyingtext_create=void 0;var a=n(9880),o=n(4163),r=n(3031),i=n(2530),_=n(2594);t.flyingtext_create=function(){return{init:c,release:l,update:s,render:d}},t.flyingtext_set_text=function(e,t){var n=e;(0,i.font_set_text)(n.font,t)};var c=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,r.actor_create)(),t.elapsed_time=0,t.font=(0,i.font_create)(0),(0,i.font_set_text)(t.font,"0"),(0,r.actor_change_animation)(e.actor,(0,a.sprite_get_animation)("SD_RING",0)),e.actor.visible=!1},s=function(e,t,n,a,r,i){var c=e,s=(0,o.timer_get_delta)();c.elapsed_time+=s,c.elapsed_time<.5?e.actor.position.y-=100*s:c.elapsed_time>2&&(e.state=_.IS_DEAD),c.font.position=e.actor.position},d=function(e,t){var n=e;(0,i.font_render)(n.font,t)},l=function(e){var t=e;(0,r.actor_destroy)(e.actor),(0,i.font_destroy)(t.font)}},8326:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.goalsign_create=void 0;var a=n(3031),o=n(9880),r=n(2594),i=n(5006);t.goalsign_create=function(){return{init:_,release:d,update:c,render:s}};var _=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,a.actor_create)(),(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",0))},c=function(e,t,n,_,c,s){var d,l=(0,i.find_closest_item)(e,c,r.IT_ENDSIGN,null);d=null!=l?l.actor.position.x>e.actor.position.x?0:1:0,(0,a.actor_change_animation)(e.actor,(0,o.sprite_get_animation)("SD_GOAL",d))},s=function(e,t){(0,a.actor_render)(e.actor,t)},d=function(e){(0,a.actor_destroy)(e.actor)}},6214:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.icon_change_animation=t.icon_create=void 0;var a=n(7709),o=n(3031),r=n(9880),i=n(4163),_=n(2954),c=n(2878),s=n(2594),d=n(7266);t.icon_create=function(){return{init:l,release:f,update:u,render:p}},t.icon_change_animation=function(e,t){(0,o.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ICON",t))};var l=function(e){var n=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=(0,o.actor_create)(),n.elapsed_time=0,(0,t.icon_change_animation)(e,0)},u=function(e,t,n,r,l,u){var p=e,f=e.actor,g=(0,i.timer_get_delta)();if(p.elapsed_time+=g,p.elapsed_time<1)f.position.y-=40*g;else if(p.elapsed_time>=2.5){var m=void 0,v=void 0,h=f.position.x-f.hot_spot.x,b=f.position.y-f.hot_spot.y,E=(0,o.actor_image)(f),I=void 0;for(m=0;m<E.h;m++)for(v=0;v<E.w;v++)I=(0,a.image_create)(1,1),(0,a.image_clear)(I,255,255,255),(0,d.level_create_particle)(I,(0,c.v2d_new)(h+v,b+m),(0,c.v2d_new)(v-E.width/2+((0,_.random)(E.width)-E.width/2),m-(0,_.random)(E.height/2)),!1);e.state=s.IS_DEAD}},p=function(e,t){(0,o.actor_render)(e.actor,t)},f=function(e){(0,o.actor_destroy)(e.actor)}},2038:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.windshieldbox_create=t.acidshieldbox_create=t.watershieldbox_create=t.thundershieldbox_create=t.fireshieldbox_create=t.emptybox_create=t.trapbox_create=t.shieldbox_create=t.glassesbox_create=t.speedbox_create=t.starbox_create=t.ringbox_create=t.lifebox_create=void 0;var a=n(2594),o=n(2878),r=n(9880),i=n(9931),_=n(4470),c=n(7266),s=n(3031),d=n(5141),l=n(6214);t.lifebox_create=function(){return w(u,0)},t.ringbox_create=function(){return w(p,3)},t.starbox_create=function(){return w(f,4)},t.speedbox_create=function(){return w(g,5)},t.glassesbox_create=function(){return w(m,6)},t.shieldbox_create=function(){return w(v,7)},t.trapbox_create=function(){return w(x,8)},t.emptybox_create=function(){return w(S,9)},t.fireshieldbox_create=function(){return w(h,11)},t.thundershieldbox_create=function(){return w(b,12)},t.watershieldbox_create=function(){return w(E,13)},t.acidshieldbox_create=function(){return w(I,14)},t.windshieldbox_create=function(){return w(y,15)};var u=function(e,t){(0,c.level_add_to_score)(100),(0,d.player_set_lives)((0,d.player_get_lives)()+1),(0,c.level_override_music)((0,_.soundfactory_get)("1up"))},p=function(e,t){(0,c.level_add_to_score)(100),(0,d.player_set_rings)((0,d.player_get_rings)()+10),(0,i.sound_play)((0,_.soundfactory_get)("ring"))},f=function(e,t){(0,c.level_add_to_score)(100),t.invincible=!0,t.invtimer=0,(0,i.music_play)((0,i.music_load)("data/music/invincible.mp4"),!1)},g=function(e,t){(0,c.level_add_to_score)(100),t.got_speedshoes=!0,t.speedshoes_timer=0,(0,i.music_play)((0,i.music_load)("data/music/speed.mp4"),!1)},m=function(e,t){(0,c.level_add_to_score)(100),t.got_glasses=!0},v=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_SHIELD,(0,i.sound_play)((0,_.soundfactory_get)("shield"))},h=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_FIRESHIELD,(0,i.sound_play)((0,_.soundfactory_get)("fire shield"))},b=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_THUNDERSHIELD,(0,i.sound_play)((0,_.soundfactory_get)("thunder shield"))},E=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_WATERSHIELD,(0,i.sound_play)((0,_.soundfactory_get)("water shield"))},I=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_ACIDSHIELD,(0,i.sound_play)((0,_.soundfactory_get)("acid shield"))},y=function(e,t){(0,c.level_add_to_score)(100),t.shield_type=d.SH_WINDSHIELD,(0,i.sound_play)((0,_.soundfactory_get)("wind shield"))},x=function(e,t){(0,d.player_hit)(t)},S=function(e,t){(0,c.level_add_to_score)(100)},w=function(e,t){var n={init:L,release:T,update:O,render:R},a=n;return a.on_destroy=e,a.anim_id=t,n},L=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,s.actor_create)(),(0,s.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ITEMBOX",t.anim_id))},O=function(e,t,n,u,p,f){for(var g=e.actor,m=e,v=0;v<n;v++){var h=t[v];if(h&&!(h.actor.is_jumping&&h.actor.speed.y<-10)&&e.state===a.IS_IDLE&&N(e,h)&&(0,d.player_attacking)(h)){var b=(0,c.level_create_item)(a.IT_ICON,(0,o.v2d_add)(g.position,(0,o.v2d_new)(0,-5)));(0,l.icon_change_animation)(b,m.anim_id),(0,c.level_create_item)(a.IT_EXPLOSION,(0,o.v2d_add)(g.position,(0,o.v2d_new)(0,-20))),(0,c.level_create_item)(a.IT_CRUSHEDBOX,g.position),(0,i.sound_play)((0,_.soundfactory_get)("destroy")),h.actor.is_jumping&&(0,d.player_bounce)(h),m.on_destroy(e,h),e.state=a.IS_DEAD}}m.anim_id=m.anim_id<t.length?(0,c.level_player_id)():m.anim_id,(0,s.actor_change_animation)(e.actor,(0,r.sprite_get_animation)("SD_ITEMBOX",m.anim_id))},R=function(e,t){(0,s.actor_render)(e.actor,t)},T=function(e){(0,s.actor_destroy)(e.actor)},N=function(e,t){var n,a=e.actor.position;return n=(0,s.actor_collision)(e.actor,t.actor),e.actor.position=a,n}},7100:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loopfloortop_create=t.loopfloornone_create=t.loopfloor_create=t.loopnone_create=t.loopleft_create=t.looptop_create=t.loopright_create=void 0;var a=n(5006),o=n(2594),r=n(5141),i=n(3031),_=n(9880);t.loopright_create=function(){return c(f,"SD_LOOPRIGHT")},t.looptop_create=function(){return c(g,"SD_LOOPMIDDLE")},t.loopleft_create=function(){return c(m,"SD_LOOPLEFT")},t.loopnone_create=function(){return c(v,"SD_LOOPNONE")},t.loopfloor_create=function(){return c(h,"SD_LOOPFLOOR")},t.loopfloornone_create=function(){return c(b,"SD_LOOPFLOORNONE")},t.loopfloortop_create=function(){return c(E,"SD_LOOPFLOORTOP")};var c=function(e,t){var n={init:s,release:d,update:l,render:u},a=n;return a.on_collision=e,a.sprite_name=t,n},s=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.actor_create)(),(0,i.actor_change_animation)(e.actor,(0,_.sprite_get_animation)(t.sprite_name,0))},d=function(e){(0,i.actor_destroy)(e.actor)},l=function(e,t,n,a,o,r){var _=e,c=e.actor;c.visible=!1;for(var s=0;s<n;s++){var d=t[s];d&&(0,i.actor_collision)(c,d.actor)&&(d.at_loopfloortop=p(e,o,d),_.on_collision(d))}},u=function(e,t){(0,i.actor_render)(e.actor,t)},p=function(e,t,n){var r=(0,a.find_closest_item)(e,t,o.IT_LOOPFLOORTOP,null);return null!=r&&(0,i.actor_collision)(n.actor,r.actor)},f=function(e){e.disable_wall|=r.PLAYER_WALL_LEFT,e.entering_loop=!0,e.bring_to_back=!1},g=function(e){if(!e.flying){var t=e.actor.speed.x>0;e.disable_wall&=~(r.PLAYER_WALL_LEFT|r.PLAYER_WALL_RIGHT),e.disable_wall|=t?r.PLAYER_WALL_RIGHT:r.PLAYER_WALL_LEFT,e.bring_to_back=t}},m=function(e){e.disable_wall|=r.PLAYER_WALL_RIGHT,e.entering_loop=!0,e.bring_to_back=!0},v=function(e){e.entering_loop||(e.disable_wall=r.PLAYER_WALL_NONE,e.bring_to_back=!1)},h=function(e){e.at_loopfloortop||e.flying||(e.disable_wall|=r.PLAYER_WALL_BOTTOM,e.entering_loop=!0,e.bring_to_back=!0)},b=function(e){e.at_loopfloortop||e.entering_loop||e.flying||(e.disable_wall&=~r.PLAYER_WALL_BOTTOM,e.bring_to_back=!1)},E=function(e){if(!e.flying)if(e.disable_wall&r.PLAYER_WALL_BOTTOM){var t=e.actor.speed.x>0;e.disable_wall&=~(r.PLAYER_WALL_LEFT|r.PLAYER_WALL_RIGHT),e.disable_wall|=t?r.PLAYER_WALL_RIGHT:r.PLAYER_WALL_LEFT,e.bring_to_back=!0}else e.disable_wall&=~(r.PLAYER_WALL_LEFT|r.PLAYER_WALL_RIGHT),e.bring_to_back=!0}},7598:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ring_start_bouncing=t.ring_create=void 0;var a=n(9931),o=n(4470),r=n(2594),i=n(3031),_=n(9880),c=n(4163),s=n(7774),d=n(2954),l=n(5141),u=n(7266);t.ring_create=function(){return{init:p,release:f,update:g,render:m}},t.ring_start_bouncing=function(e){e.is_moving=!0,e.actor.speed.x=e.actor.maxspeed*((0,d.random)(100)-50)/100,e.actor.speed.y=-e.actor.jump_strength+(0,d.random)(e.actor.jump_strength)};var p=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=(0,i.actor_create)(),e.actor.maxspeed=220+(0,d.random)(140),e.actor.jump_strength=1.2*(350+(0,d.random)(50)),e.actor.input=(0,s.input_create_computer)(),t.is_disappearing=!1,t.is_moving=!1,t.life_time=0,(0,i.actor_change_animation)(e.actor,(0,_.sprite_get_animation)("SD_RING",0))},f=function(e){(0,i.actor_destroy)(e.actor)},g=function(e,t,n,p,f,g){for(var m=(0,c.timer_get_delta)(),v=e,h=e.actor,b=0;b<n;b++){var E=t[b];if(E&&(!v.is_moving||v.is_moving&&!E.getting_hit&&v.life_time>=.5)&&!v.is_disappearing&&!E.dying&&(0,i.actor_collision)(h,E.actor)){(0,l.player_set_rings)((0,l.player_get_rings)()+1),v.is_disappearing=!0,(0,a.sound_play)((0,o.soundfactory_get)("ring"));break}}if(v.is_disappearing)(0,i.actor_change_animation)(h,(0,_.sprite_get_animation)("SD_RING",1)),(0,i.actor_animation_finished)(h)&&(e.state=r.IS_DEAD);else if(v.is_moving){if((0,s.input_simulate_button_down)(h.input,s.IB_FIRE1),e.preserve=!1,v.life_time+=m,v.life_time>5){var I=240+(0,d.random)(20);h.visible=(0,c.timer_get_ticks)()%I<I/2,v.life_time>8&&(e.state=r.IS_DEAD)}(0,i.actor_move)(h,(0,i.actor_platform_movement)(h,p,(0,u.level_gravity)()))}},m=function(e,t){(0,i.actor_render)(e.actor,t)}},5876:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.periodic_rightwallspikes_create=t.periodic_leftwallspikes_create=t.periodic_ceilingspikes_create=t.periodic_floorspikes_create=t.rightwallspikes_create=t.leftwallspikes_create=t.ceilingspikes_create=t.floorspikes_create=void 0;var a=n(9931),o=n(4470),r=n(9386),i=n(2954),_=n(4163),c=n(3031),s=n(9880),d=n(5141);t.floorspikes_create=function(){return l(v,0,r.INFINITY_FLT)},t.ceilingspikes_create=function(){return l(h,2,r.INFINITY_FLT)},t.leftwallspikes_create=function(){return l(b,1,r.INFINITY_FLT)},t.rightwallspikes_create=function(){return l(E,3,r.INFINITY_FLT)},t.periodic_floorspikes_create=function(){return l(v,0,5)},t.periodic_ceilingspikes_create=function(){return l(h,2,5)},t.periodic_leftwallspikes_create=function(){return l(b,1,5)},t.periodic_rightwallspikes_create=function(){return l(E,3,5)};var l=function(e,t,n){var a={init:u,release:p,update:f,render:g},o=a;return o.collision=e,o.anim_id=t,o.cycle_length=n,a},u=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,c.actor_create)(),t.timer=0,t.hidden=!1,(0,c.actor_change_animation)(e.actor,(0,s.sprite_get_animation)("SD_SPIKES",t.anim_id))},p=function(e){(0,c.actor_destroy)(e.actor)},f=function(e,t,n,r,i,c){var s=e,l=(0,_.timer_get_delta)();if(s.timer+=l,s.timer>=.5*s.cycle_length&&(s.timer=0,s.hidden=!s.hidden,(0,a.sound_play)((0,o.soundfactory_get)(s.hidden?"spikes disappearing":"spikes appearing"))),e.obstacle=!s.hidden,e.actor.visible=!s.hidden,!s.hidden)for(var u=0;u<n;u++){var p=t[u];if(p&&!p.dying&&!p.blinking&&!p.invincible&&s.collision(e,p)){var f=(0,o.soundfactory_get)("spikes hit");(0,a.sound_is_playing)(f)||(0,a.sound_play)(f),(0,d.player_hit)(p)}}},g=function(e,t){(0,c.actor_render)(e.actor,t)},m=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+(0,c.actor_image)(a).width,n[3]=n[1]+(0,c.actor_image)(a).height,(0,i.bounding_box)(n,t)},v=function(e,t){var n,a=[],o=e.actor;return a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y-5,a[2]=a[0]+(0,c.actor_image)(o).width-10,a[3]=a[1]+10,n=t.actor.position.y-t.actor.hot_spot.y+(0,c.actor_image)(t.actor).height,m(t,a)&&n<o.position.y-o.hot_spot.y+(0,c.actor_image)(o).height/2},h=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+(0,c.actor_image)(a).height-5,n[2]=n[0]+(0,c.actor_image)(a).width-10,n[3]=n[1]+10,m(t,n)},b=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+(0,c.actor_image)(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,c.actor_image)(a).height-10,m(t,n)},E=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+(0,c.actor_image)(a).height-10,m(t,n)}},7852:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tlbluespring_create=t.lbluespring_create=t.blbluespring_create=t.bbluespring_create=t.brbluespring_create=t.rbluespring_create=t.trbluespring_create=t.bluespring_create=t.tlredspring_create=t.lredspring_create=t.blredspring_create=t.bredspring_create=t.brredspring_create=t.rredspring_create=t.trredspring_create=t.redspring_create=t.tlyellowspring_create=t.lyellowspring_create=t.blyellowspring_create=t.byellowspring_create=t.bryellowspring_create=t.ryellowspring_create=t.tryellowspring_create=t.yellowspring_create=void 0;var a=n(9386),o=n(9931),r=n(4470),i=n(9880),_=n(4163),c=n(2878),s=n(3031);t.yellowspring_create=function(){return d(g,"SD_YELLOWSPRING",(0,c.v2d_new)(0,-500))},t.tryellowspring_create=function(){return d(m,"SD_TRYELLOWSPRING",(0,c.v2d_new)(400,-600))},t.ryellowspring_create=function(){return d(m,"SD_RYELLOWSPRING",(0,c.v2d_new)(600,0))},t.bryellowspring_create=function(){return d(m,"SD_BRYELLOWSPRING",(0,c.v2d_new)(400,600))},t.byellowspring_create=function(){return d(m,"SD_BYELLOWSPRING",(0,c.v2d_new)(0,500))},t.blyellowspring_create=function(){return d(m,"SD_BLYELLOWSPRING",(0,c.v2d_new)(-400,600))},t.lyellowspring_create=function(){return d(m,"SD_LYELLOWSPRING",(0,c.v2d_new)(-600,0))},t.tlyellowspring_create=function(){return d(m,"SD_TLYELLOWSPRING",(0,c.v2d_new)(-400,-600))},t.redspring_create=function(){return d(g,"SD_REDSPRING",(0,c.v2d_new)(0,-750))},t.trredspring_create=function(){return d(m,"SD_TRREDSPRING",(0,c.v2d_new)(800,-1e3))},t.rredspring_create=function(){return d(m,"SD_RREDSPRING",(0,c.v2d_new)(1200,0))},t.brredspring_create=function(){return d(m,"SD_BRREDSPRING",(0,c.v2d_new)(800,1e3))},t.bredspring_create=function(){return d(m,"SD_BREDSPRING",(0,c.v2d_new)(0,750))},t.blredspring_create=function(){return d(m,"SD_BLREDSPRING",(0,c.v2d_new)(-800,1e3))},t.lredspring_create=function(){return d(m,"SD_LREDSPRING",(0,c.v2d_new)(-1200,0))},t.tlredspring_create=function(){return d(m,"SD_TLREDSPRING",(0,c.v2d_new)(-800,-1e3))},t.bluespring_create=function(){return d(g,"SD_BLUESPRING",(0,c.v2d_new)(0,-1500))},t.trbluespring_create=function(){return d(m,"SD_TRBLUESPRING",(0,c.v2d_new)(1800,-1500))},t.rbluespring_create=function(){return d(m,"SD_RBLUESPRING",(0,c.v2d_new)(2e3,0))},t.brbluespring_create=function(){return d(m,"SD_BRBLUESPRING",(0,c.v2d_new)(1800,1500))},t.bbluespring_create=function(){return d(m,"SD_BBLUESPRING",(0,c.v2d_new)(0,1500))},t.blbluespring_create=function(){return d(m,"SD_BLBLUESPRING",(0,c.v2d_new)(-1800,1500))},t.lbluespring_create=function(){return d(m,"SD_LBLUESPRING",(0,c.v2d_new)(-2e3,0))},t.tlbluespring_create=function(){return d(m,"SD_TLBLUESPRING",(0,c.v2d_new)(-1800,-1500))};var d=function(e,t,n){var a={init:l,release:u,update:p,render:f},o=a;return o.on_bump=e,o.sprite_name=t,o.strength=n,a},l=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,s.actor_create)(),t.is_bumping=!1,t.bang_timer=0,(0,s.actor_change_animation)(e.actor,(0,i.sprite_get_animation)(t.sprite_name,0))},u=function(e){(0,s.actor_destroy)(e.actor)},p=function(e,t,n,a,o,r){var c=e,d=(0,_.timer_get_delta)();c.bang_timer+=d;for(var l=0;l<n;l++){var u=t[l];u&&!u.dying&&(0,s.actor_pixelperfect_collision)(u.actor,e.actor)&&c.on_bump(e,u)}c.is_bumping&&(0,s.actor_animation_finished)(e.actor)&&((0,s.actor_change_animation)(e.actor,(0,i.sprite_get_animation)(c.sprite_name,0)),c.is_bumping=!1)},f=function(e,t){(0,s.actor_render)(e.actor,t)},g=function(e,t){t.actor.speed.y>=1&&!t.actor.carrying&&!t.actor.carried_by&&v(e,t)},m=function(e,t){v(e,t)},v=function(e,t){var n=e;e.is_bumping=!0,function(e,t){var n=(0,_.timer_get_delta)(),o=[],r=[];o[0]=t.x*e.actor.speed.x>=0,o[1]=t.y*e.actor.speed.y>=0,r[0]=t.x*e.actor.speed.x<=0&&Math.abs(t.x)>a.EPSILON,r[1]=t.y*e.actor.speed.y<=0&&Math.abs(t.y)>a.EPSILON,Math.abs(t.y)>a.EPSILON&&(e.spring=!0),e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1,(Math.abs(t.x)>Math.abs(e.actor.speed.x)&&o[0]||r[0])&&(e.actor.speed.x=t.x),(Math.abs(t.y)>Math.abs(e.actor.speed.y)&&o[1]||r[1])&&(e.actor.speed.y=t.y,e.actor.position.y+=e.actor.speed.y*n)}(t,e.strength),(0,s.actor_change_animation)(n.actor,(0,i.sprite_get_animation)(e.sprite_name,1)),e.strength.x>a.EPSILON?t.actor.mirror&=~a.IF_HFLIP:e.strength.x<-a.EPSILON&&(t.actor.mirror|=a.IF_HFLIP),e.bang_timer>.2&&((0,o.sound_play)((0,r.soundfactory_get)("spring")),e.bang_timer=0)}},4231:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.switch_create=void 0;var a=n(1040),o=n(8738),r=n(5006),i=n(2594),_=n(9931),c=n(9880),s=n(4470),d=n(2954),l=n(3031);t.switch_create=function(){return{init:u,release:p,update:f,render:g}};var u=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,l.actor_create)(),t.is_pressed=!1,t.partner=null,(0,l.actor_change_animation)(e.actor,(0,c.sprite_get_animation)("SD_SWITCH",0))},p=function(e){(0,l.actor_destroy)(e.actor)},f=function(e,t,n,a,o,_){var c,s,d=e,l={},u={};d.partner=null,c=(0,r.find_closest_item)(e,o,i.IT_DOOR,l),s=(0,r.find_closest_item)(e,o,i.IT_TELEPORTER,u),null!=c&&l.dist<u.dist&&(d.partner=c),null!=s&&u.dist<l.dist&&(d.partner=s),null==d.partner?m(e,c,t,n,v,h):d.partner==c?m(e,c,t,n,b,E):d.partner==s&&m(e,s,t,n,I,y)},g=function(e,t){(0,l.actor_render)(e.actor,t)},m=function(e,t,n,a,o,r){for(var i=!0,d=e,u=e.actor,p=0;p<a;p++){var f=n[p];x(e,f)&&(i=!1,d.is_pressed||(o(t,f),(0,_.sound_play)((0,s.soundfactory_get)("switch")),(0,l.actor_change_animation)(u,(0,c.sprite_get_animation)("SD_SWITCH",1)),d.is_pressed=!0))}i&&d.is_pressed&&(r(t),(0,l.actor_change_animation)(u,(0,c.sprite_get_animation)("SD_SWITCH",0)),d.is_pressed=!1)},v=function(e,t){},h=function(e){},b=function(e,t){(0,a.door_open)(e)},E=function(e){(0,a.door_close)(e)},I=function(e,t){(0,o.teleporter_activate)(e,t)},y=function(e){},x=function(e,t){if(!e)return!1;if(!t)return!1;var n=[],a=[];return n[0]=e.actor.position.x-e.actor.hot_spot.x,n[1]=e.actor.position.y-e.actor.hot_spot.y,n[2]=n[0]+(0,l.actor_image)(e.actor).width,n[3]=n[1]+(0,l.actor_image)(e.actor).height,a[0]=t.actor.position.x-t.actor.hot_spot.x+.3*(0,l.actor_image)(t.actor).width,a[1]=t.actor.position.y-t.actor.hot_spot.y+.5*(0,l.actor_image)(t.actor).height,a[2]=a[0]+.4*(0,l.actor_image)(t.actor).width,a[3]=a[1]+.5*(0,l.actor_image)(t.actor).height,!t.dying&&!t.climbing&&!t.flying&&(0,d.bounding_box)(n,a)}},8738:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.teleporter_activate=t.teleporter_create=void 0;var a=n(9931),o=n(4470),r=n(7774),i=n(9880),_=n(4163),c=n(2878),s=n(3031),d=n(5141),l=n(7266);t.teleporter_create=function(){return{init:u,release:g,update:p,render:f}},t.teleporter_activate=function(e,t){var n=e,i=e.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=t,(0,r.input_ignore)(t.actor.input),(0,l.level_set_camera_focus)(i),(0,a.sound_play)((0,o.soundfactory_get)("teleporter")))};var u=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=(0,s.actor_create)(),t.is_disabled=!1,t.is_active=!1,t.timer=0,(0,s.actor_change_animation)(e.actor,(0,i.sprite_get_animation)("SD_TELEPORTER",0))},p=function(e,t,n,a,o,d){var u=e,p=e.actor,f=(0,_.timer_get_delta)(),g=0;if(u.is_active){if(u.timer+=f,u.timer>=3){var v=u.who;(0,r.input_restore)(v.actor.input),(0,l.level_set_camera_focus)(v.actor);for(var h=0;h<n;h++){var b=t[h];if(b!=v){var E=(0,c.v2d_add)(p.position,(0,c.v2d_new)(40*g++-20,-30));m(b,E)}}u.is_active=!1,u.is_disabled=!0}(0,s.actor_change_animation)(p,(0,i.sprite_get_animation)("SD_TELEPORTER",1))}else(0,s.actor_change_animation)(p,(0,i.sprite_get_animation)("SD_TELEPORTER",0))},f=function(e,t){(0,s.actor_render)(e.actor,t)},g=function(e){(0,s.actor_destroy)(e.actor)},m=function(e,t){e&&(e.actor.position=t,e.actor.speed=(0,c.v2d_new)(0,0),e.actor.is_jumping=!1,e.flying=!1,e.climbing=!1,e.getting_hit=!1,e.spring=!1,e.actor.angle=0,e.disable_wall=d.PLAYER_WALL_NONE,e.entering_loop=!1,e.at_loopfloortop=!1,e.bring_to_back=!1)}},5006:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.find_closest_item=void 0;var a=n(9386),o=n(2878);t.find_closest_item=function(e,t,n,r){for(var i=a.INFINITY_FLT,_=null,c=null,s=t;s;s=s.next)s.data&&s.data.type==n&&(c=(0,o.v2d_subtract)(s.data.actor.position,e.actor.position),(0,o.v2d_magnitude)(c)<i&&(_=s.data,i=(0,o.v2d_magnitude)(c)));return r&&(r.dist=i),_}},9036:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.object_compiler_compile=void 0;var a=n(7898),o=n(2141),r=n(253),i=n(3939),_=n(1565),c=n(355),s=n(375),d=n(9461),l=n(3683),u=n(3799),p=n(4194),f=n(1952),g=n(7011),m=n(3764),v=n(1741),h=n(9618),b=n(4248),E=n(175),I=n(9040),y=n(2384),x=n(5624),S=n(6458),w=n(5821),L=n(7637),O=n(937),R=n(3685),T=n(9803),N=n(567),k=n(1198),P=n(7589),D=n(9389),j=n(5125),A=n(3204),B=n(5352),M=0,C={},F=[{command:"set_animation",action:function(e,t,n){return 2==t?e=(0,k.objectdecorator_setanimation_new)(e,n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - set_animation expects two parameters: sprite_name, animation_id"),e}},{command:"set_obstacle",action:function(e,t,n){return 1==t?e=(0,P.objectdecorator_setobstacle_new)(e,+n[0],0):2==t?e=(0,P.objectdecorator_setobstacle_new)(e,+n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]"),e}},{command:"set_alpha",action:function(e,t,n){return 1==t?e=(0,N.objectdecorator_setalpha_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))"),e}},{command:"hide",action:function(e,t,n){return 0==t?e=(0,N.objectdecorator_setalpha_new)(e,0):(0,a.logfile_fatal_error)("Object script error - hide expects no parameters"),e}},{command:"show",action:function(e,t,n){return 0==t?e=(0,N.objectdecorator_setalpha_new)(e,1):(0,a.logfile_fatal_error)("Object script error - show expects no parameters"),e}},{command:"enemy",action:function(e,t,n){return 1==t?e=(0,h.objectdecorator_enemy_new)(e,+n):(0,a.logfile_fatal_error)("Object script error - enemy expects one parameter: score"),e}},{command:"lock_camera",action:function(e,t,n){return 4==t?e=(0,y.objectdecorator_lockcamera_new)(e,+n[0],+n[1],+n[2],+n[3]):(0,a.logfile_fatal_error)("Object script error - lock_camera expects four parameters: x1, y1, x2, y2"),e}},{command:"move_player",action:function(e,t,n){return 2==t?e=(0,w.objectdecorator_moveplayer_new)(e,+n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - move_player expects two parameters: speed_x, speed_y"),e}},{command:"hit_player",action:function(e,t,n){return 0==t?e=(0,E.objectdecorator_hitplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - hit_player expects no parameters"),e}},{command:"burn_player",action:function(e,t,n){return 0==t?e=(0,E.objectdecorator_burnplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - burn_player expects no parameters"),e}},{command:"shock_player",action:function(e,t,n){return 0==t?e=(0,E.objectdecorator_shockplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - shock_player expects no parameters"),e}},{command:"acid_player",action:function(e,t,n){return 0==t?e=(0,E.objectdecorator_acidplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - acid_player expects no parameters"),e}},{command:"add_rings",action:function(e,t,n){return 1==t?e=(0,r.objectdecorator_addrings_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - add_rings expects one parameter: number_of_rings"),e}},{command:"add_to_score",action:function(e,t,n){return 1==t?e=(0,i.objectdecorator_addtoscore_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - add_to_score expects one parameter: score"),e}},{command:"set_player_animation",action:function(e,t,n){return 2==t?e=(0,D.objectdecorator_setplayeranimation_new)(e,n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - set_player_animation expects two parameters: sprite_name, animation_id"),e}},{command:"enable_player_movement",action:function(e,t,n){return 0==t?e=(0,T.objectdecorator_enableplayermovement_new)(e):(0,a.logfile_fatal_error)("Object script error - enable_player_movement expects no parameters"),e}},{command:"disable_player_movement",action:function(e,t,n){0==t?e=(0,T.objectdecorator_disableplayermovement_new)(e):(0,a.logfile_fatal_error)("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(e,t,n){return 1==t?e=(0,A.objectdecorator_setplayerxspeed_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - set_player_xspeed expects one parameter: speed"),e}},{command:"set_player_yspeed",action:function(e,t,n){return 1==t?e=(0,A.objectdecorator_setplayeryspeed_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - set_player_yspeed expects one parameter: speed"),e}},{command:"set_player_position",action:function(e,t,n){return 2==t?e=(0,j.objectdecorator_setplayerposition_new)(e,+n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - set_player_position expects two parameters: xpos, ypos"),e}},{command:"bounce_player",action:function(e,t,n){return 0==t?e=(0,s.objectdecorator_bounceplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - bounce_player expects no parameters"),e}},{command:"observe_player",action:function(e,t,n){return 1==t?e=(0,L.objectdecorator_observeplayer_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - observe_player expects one parameter: player_name"),e}},{command:"observe_current_player",action:function(e,t,n){return 0==t?e=(0,L.objectdecorator_observecurrentplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - observe_current_player expects no parameters"),e}},{command:"observe_active_player",action:function(e,t,n){return 0==t?e=(0,L.objectdecorator_observeactiveplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - observe_active_player expects no parameters"),e}},{command:"observe_all_players",action:V},{command:"observe_next_player",action:V},{command:"attach_to_player",action:function(e,t,n){return 0==t?e=(0,_.objectdecorator_attachtoplayer_new)(e,0,0):1==t?e=(0,_.objectdecorator_attachtoplayer_new)(e,+n[0],0):2==t?e=(0,_.objectdecorator_attachtoplayer_new)(e,+n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]"),e}},{command:"springfy_player",action:function(e,t,n){return 0==t?e=(0,R.objectdecorator_springfyplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - springfy_player expects no parameters"),e}},{command:"roll_player",action:function(e,t,n){return 0==t?e=(0,R.objectdecorator_rollplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - roll_player expects no parameters"),e}},{command:"walk",action:function(e,t,n){return 1==t?e=(0,B.objectdecorator_walk_new)(e,+n):(0,a.logfile_fatal_error)("Object script error - walk expects one parameter: speed"),e}},{command:"gravity",action:function(e,t,n){return 0==t?e=(0,b.objectdecorator_gravity_new)(e):(0,a.logfile_fatal_error)("Object script error - gravity expects no parameters"),e}},{command:"jump",action:function(e,t,n){return 1==t?e=(0,I.objectdecorator_jump_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - jump expects one parameter: jump_strength"),e}},{command:"move",action:Y},{command:"bullet_trajectory",action:Y},{command:"elliptical_trajectory",action:function(e,t,n){return t>=4&&t<=6?e=(0,v.objectdecorator_ellipticaltrajectory_new)(e,+n[0],+n[1],+n[2],+n[3],+n[4],+n[5]):(0,a.logfile_fatal_error)("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),e}},{command:"mosquito_movement",action:function(e,t,n){return 1==t?e=(0,S.objectdecorator_mosquitomovement_new)(e,+n):(0,a.logfile_fatal_error)("Object script error - mosquito_movement expects one parameter: speed"),e}},{command:"look_left",action:function(e,t,n){return 0==t?e=(0,x.objectdecorator_lookleft_new)(e):(0,a.logfile_fatal_error)("Object script error - look_left expects no parameters"),e}},{command:"look_right",action:function(e,t,n){return 0==t?e=(0,x.objectdecorator_lookright_new)(e):(0,a.logfile_fatal_error)("Object script error - look_right expects no parameters"),e}},{command:"look_at_player",action:function(e,t,n){return 0==t?e=(0,x.objectdecorator_lookatplayer_new)(e):(0,a.logfile_fatal_error)("Object script error - look_at_player expects no parameters"),e}},{command:"look_at_walking_direction",action:function(e,t,n){return 0==t?e=(0,x.objectdecorator_lookatwalkingdirection_new)(e):(0,a.logfile_fatal_error)("Object script error - look_at_walking_direction expects no parameters"),e}},{command:"create_item",action:function(e,t,n){return 3==t?e=(0,f.objectdecorator_createitem_new)(e,+n[0],+n[1],+n[2]):(0,a.logfile_fatal_error)("Object script error - create_item expects three parameters: item_id, offset_x, offset_y"),e}},{command:"change_closest_object_state",action:function(e,t,n){return 2==t?e=(0,l.objectdecorator_changeclosestobjectstate_new)(e,n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name"),e}},{command:"create_child",action:function(e,t,n){return 3==t?e=(0,u.objectdecorator_createchild_new)(e,n[0],+n[1],+n[2],""):4==t?e=(0,u.objectdecorator_createchild_new)(e,n[0],+n[1],+n[2],n[3]):(0,a.logfile_fatal_error)("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]"),e}},{command:"change_child_state",action:function(e,t,n){return 2==t?e=(0,u.objectdecorator_changechildstate_new)(e,n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - change_child_state expects two parameters: child_name, new_state_name"),e}},{command:"change_parent_state",action:function(e,t,n){return 1==t?e=(0,u.objectdecorator_changeparentstate_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - change_parent_state expects one parameter: new_state_name"),e}},{command:"destroy",action:function(e,t,n){return 0==t?e=(0,g.objectdecorator_destroy_new)(e):(0,a.logfile_fatal_error)("Object script error - destroy expects no parameters"),e}},{command:"change_state",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_ontimeout_new)(e,0,n[0]):(0,a.logfile_fatal_error)("Object script error - change_state expects one parameter: new_state_name"),e}},{command:"on_timeout",action:function(e,t,n){return 2==t?e=(0,O.objectdecorator_ontimeout_new)(e,+n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name"),e}},{command:"on_collision",action:function(e,t,n){return 2==t?e=(0,O.objectdecorator_oncollision_new)(e,n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - on_collision expects two parameters: object_name, new_state_name"),e}},{command:"on_animation_finished",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onanimationfinished_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_animation_finished expects one parameter: new_state_name"),e}},{command:"on_random_event",action:function(e,t,n){return 2==t?e=(0,O.objectdecorator_onrandomevent_new)(e,+n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name"),e}},{command:"on_player_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onplayercollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_player_collision expects one parameter: new_state_name"),e}},{command:"on_player_attack",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onplayerattack_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_player_attack expects one parameter: new_state_name"),e}},{command:"on_player_rect_collision",action:function(e,t,n){return 5==t?e=(0,O.objectdecorator_onplayerrectcollision_new)(e,+n[0],+n[1],+n[2],+n[3],n[4]):(0,a.logfile_fatal_error)("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name"),e}},{command:"on_no_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onnoshield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_no_shield expects one parameter: new_state_name"),e}},{command:"on_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onshield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_shield expects one parameter: new_state_name"),e}},{command:"on_fire_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onfireshield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_fire_shield expects one parameter: new_state_name"),e}},{command:"on_thunder_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onthundershield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_thunder_shield expects one parameter: new_state_name"),e}},{command:"on_water_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onwatershield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_water_shield expects one parameter: new_state_name"),e}},{command:"on_acid_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onacidshield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_acid_shield expects one parameter: new_state_name"),e}},{command:"on_wind_shield",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onwindshield_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_wind_shield expects one parameter: new_state_name"),e}},{command:"on_brick_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onbrickcollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_brick_collision expects one parameter: new_state_name"),e}},{command:"on_floor_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onfloorcollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_floor_collision expects one parameter: new_state_name"),e}},{command:"on_ceiling_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onceilingcollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_ceiling_collision expects one parameter: new_state_name"),e}},{command:"on_left_wall_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onleftwallcollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_left_wall_collision expects one parameter: new_state_name"),e}},{command:"on_right_wall_collision",action:function(e,t,n){return 1==t?e=(0,O.objectdecorator_onrightwallcollision_new)(e,n[0]):(0,a.logfile_fatal_error)("Object script error - on_right_wall_collision expects one parameter: new_state_name"),e}},{command:"show_dialog_box",action:function(e,t,n){return 2==t?e=(0,m.objectdecorator_showdialogbox_new)(e,n[0],n[1]):(0,a.logfile_fatal_error)("Object script error - show_dialog_box expects two parameters: title, message"),e}},{command:"hide_dialog_box",action:function(e,t,n){return 0==t?e=(0,m.objectdecorator_hidedialogbox_new)(e):(0,a.logfile_fatal_error)("Object script error - hide_dialog_box expects no parameters"),e}},{command:"clear_level",action:function(e,t,n){return 0==t?e=(0,p.objectdecorator_clearlevel_new)(e):(0,a.logfile_fatal_error)("Object script error - clear_level expects no parameters"),e}},{command:"play_sample",action:function(e,t,n){return 1==t?e=(0,c.objectdecorator_playsample_new)(e,n[0],1,0,1,!1):2==t?e=(0,c.objectdecorator_playsample_new)(e,n[0],+n[1],0,1,!1):3==t?e=(0,c.objectdecorator_playsample_new)(e,n[0],+n[1],+n[2],1,!1):4==t||5==t?e=(0,c.objectdecorator_playsample_new)(e,n[0],+n[1],+n[2],+n[3],!1):(0,a.logfile_fatal_error)("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]"),e}},{command:"play_music",action:function(e,t,n){return 1==t||2==t?e=(0,c.objectdecorator_playmusic_new)(e,n[0],!1):(0,a.logfile_fatal_error)("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]"),e}},{command:"play_level_music",action:function(e,t,n){return 0==t?e=(0,c.objectdecorator_playlevelmusic_new)(e):(0,a.logfile_fatal_error)("Object script error - play_level_music expects no parameters"),e}},{command:"set_music_volume",action:function(e,t,n){return 1==t?e=(0,c.objectdecorator_setmusicvolume_new)(e,+n[0]):(0,a.logfile_fatal_error)("Object script error - set_music_volume expects one parameter: volume"),e}},{command:null,action:null}];function H(e,t){var n,a,o,r,i=e;for(a=i.length,n=0;n<a;n++)r=(o=i[n])[1]&&void 0!==o[1]?o[1].length?o[1].length:1:0,t=U(t,o[0],r,o[1]);return t}function G(e,t,n,a){return e(t,n,a)}function U(e,t,n,a){for(var o=0,r=F[o++];null!=r.command&&null!=r.action;)r.command==t&&(e=G(r.action,e,n,a)),r=F[o++];return e}function V(e,t,n){return 0==t?e=(0,L.objectdecorator_observeallplayers_new)(e):(0,a.logfile_fatal_error)("Object script error - observe_all_players expects no parameters"),e}function Y(e,t,n){return 2==t?e=(0,d.objectdecorator_bullettrajectory_new)(e,+n[0],+n[1]):(0,a.logfile_fatal_error)("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),e}t.object_compiler_compile=function(e,t){return function(e,t){var n,r=t;if(0===r.state){var i=e.state.name;for(r.state,r.vm.state_list=(0,o.object_vm_create_state)(r.vm,e.state.list),r.vm=(0,o.object_vm_set_current_state)(r.vm,i),n=(0,o.object_vm_get_reference_to_current_state)(r.vm),M=0,function(e,t){M<1024?(C[M]={},C[M].stmt=e,C[M].machine=t,M++):(0,a.logfile_message)("Object script error: you may write ".concat(1024," commands or less per state"))}(e.state.list,n);M-- >0;)n=H(C[M].stmt,C[M].machine);n&&n.init(n)}return r.vm.reference_to_current_state=n,e.destroy_if_far_from_play_area&&(r.preserve=!1),e.always_active&&(r.always_active=!0),e.hide_unless_in_editor_mode&&(r.hide_unless_in_editor_mode=!0),r}(t,e)}},253:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_addrings_new=void 0;var a=n(6432),o=n(5141);t.objectdecorator_addrings_new=function(e,t){var n={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.rings=t,n};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e;(0,o.player_set_rings)((0,o.player_get_rings)()+c.rings),_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)}},3939:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_addtoscore_new=void 0;var a=n(6432),o=n(7266);t.objectdecorator_addtoscore_new=function(e,t){var n={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.score=t,n};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e;(0,o.level_add_to_score)(c.score),_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)}},1565:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_attachtoplayer_new=void 0;var a=n(2878),o=n(6432),r=n(1459);t.objectdecorator_attachtoplayer_new=function(e,t,n){var r={init:i,release:_,update:c,render:s,get_object_instance:o.get_object_instance},d=r;return d.decorated_machine=e,d.offset=(0,a.v2d_new)(t,n),r};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,o,i,_){var c=e.decorated_machine,s=e,d=e.get_object_instance(e),l=(0,r.enemy_get_observed_player)(d);d.actor.position=(0,a.v2d_add)(l.actor.position,s.offset),c.update(c,t,n,o,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},355:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setmusicvolume_new=t.objectdecorator_playlevelmusic_new=t.objectdecorator_playmusic_new=t.objectdecorator_playsample_new=void 0;var a=n(6432),o=n(9931),r=n(2954),i=n(4470),_=n(7266);t.objectdecorator_playsample_new=function(e,t,n,a,o,r){return u(e,p(t,n,a,o,r))},t.objectdecorator_playmusic_new=function(e,t,n){return u(e,g(t,n))},t.objectdecorator_playlevelmusic_new=function(e){return u(e,v())},t.objectdecorator_setmusicvolume_new=function(e,t){return u(e,b(t))};var c=function(e){var t=e.decorated_machine;t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;_.strategy.update(_.strategy),i.update(i,t,n,a,o,r)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)},u=function(e,t){var n={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.strategy=t,n},p=function(e,t,n,a,o){return{update:f,sfx:(0,i.soundfactory_get)(e),vol:Math.min(t,0,1),pan:Math.min(n,-1,1),freq:a,loop:o}},f=function(e){var t=e;(0,o.sound_play_ex)(t.sfx)},g=function(e,t){return{update:m,mus:(0,o.music_load)(e),loop:t}},m=function(e){var t=e;(0,o.music_play)(t.mus,t.loop)},v=function(){return{update:h,mus:null,loop:!0}},h=function(e){(0,_.level_restore_music)()},b=function(e){return{update:E,vol:(0,r.clip)(e,0,1)}},E=function(e){var t=e;(0,o.music_set_volume)(t.vol)}},8529:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectbasicmachine_new=void 0;var a=n(2878),o=n(3031);t.objectbasicmachine_new=function(e){var t={init:r,release:i,update:_,render:c,get_object_instance:s};return t.object=e,t};var r=function(e){},i=function(e){},_=function(e,t,n,a,o,r){},c=function(e,t){var n=e.get_object_instance(e).actor,r=n.position;n.position=(0,a.v2d_new)(n.position.x,n.position.y),(0,o.actor_render)(n,t),n.position=r},s=function(e){return e.object}},6432:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.get_object_instance=void 0,t.get_object_instance=function(e){var t=e.decorated_machine;return t.get_object_instance(t)}},375:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_bounceplayer_new=void 0;var a=n(6432),o=n(1459),r=n(5141);t.objectdecorator_bounceplayer_new=function(e){var t={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance};return t.decorated_machine=e,t};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,i,_){var c=e.decorated_machine,s=(0,o.enemy_get_observed_player)(e.get_object_instance(e));(0,r.player_bounce)(s),c.update(c,t,n,a,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},9461:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_bullettrajectory_new=void 0;var a=n(6432),o=n(2878),r=n(4163);t.objectdecorator_bullettrajectory_new=function(e,t,n){var r={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},d=r;return d.decorated_machine=e,d.speed=(0,o.v2d_new)(t,n),r};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,i,_){var c=e.decorated_machine,s=e,d=e.get_object_instance(e),l=(0,r.timer_get_delta)(),u=(0,o.v2d_multiply)(s.speed,l);d.actor.position=(0,o.v2d_add)(d.actor.position,u),c.update(c,t,n,a,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},3683:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_changeclosestobjectstate_new=void 0;var a=n(6432),o=n(2878),r=n(9386),i=n(2141);t.objectdecorator_changeclosestobjectstate_new=function(e,t,n){var o={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},r=o;return r.decorated_machine=e,r.object_name=t,r.new_state_name=n,o};var _=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,o,r){var _=e.decorated_machine,c=e,s=e.get_object_instance(e),d=l(s,r,c.object_name,null);null!=d&&(0,i.object_vm_set_current_state)(d.vm,c.new_state_name),_.update(_,t,n,a,o,r)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)},l=function(e,t,n,a){var i,_,c=r.INFINITY_FLT,s=null;for(i=t;i;i=i.next)i.data.name==n&&(_=(0,o.v2d_subtract)(i.data.actor.position,e.actor.position),(0,o.v2d_magnitude)(_)<c&&(s=i.data,c=(0,o.v2d_magnitude)(_)));return a&&(a=c),s}},3799:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_changeparentstate_new=t.objectdecorator_changechildstate_new=t.objectdecorator_createchild_new=void 0;var a=n(6432),o=n(2878),r=n(7266),i=n(1459),_=n(2141);t.objectdecorator_createchild_new=function(e,t,n,r,i){var _={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},p=_;return p.decorated_machine=e,p.strategy=u,p.offset=(0,o.v2d_new)(n,r),p.object_name=t,p.child_name=i,p.new_state_name=null,_},t.objectdecorator_changechildstate_new=function(e,t,n){var r={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},i=r;return i.decorated_machine=e,i.strategy=p,i.offset=(0,o.v2d_new)(0,0),i.object_name=null,i.child_name=t,i.new_state_name=n,r},t.objectdecorator_changeparentstate_new=function(e,t){var n={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},r=n;return r.decorated_machine=e,r.strategy=f,r.offset=(0,o.v2d_new)(0,0),r.object_name=null,r.child_name=null,r.new_state_name=t,n};var c=function(e){var t=e.decorated_machine;t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;_.strategy(_),i.update(i,t,n,a,o,r)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)},u=function(e){var t=e,n=t.get_object_instance(t),a=(0,r.level_create_enemy)(e.object_name,(0,o.v2d_add)(n.actor.position,e.offset));null!=a&&(0,i.enemy_add_child)(n,e.child_name,a)},p=function(e){var t=e,n=t.get_object_instance(t),a=(0,i.enemy_get_child)(n,e.child_name);null!=a&&(0,_.object_vm_set_current_state)(a.vm,e.new_state_name)},f=function(e){var t=e,n=t.get_object_instance(t),a=(0,i.enemy_get_parent)(n);null!=a&&(0,_.object_vm_set_current_state)(a.vm,e.new_state_name)}},4194:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_clearlevel_new=void 0;var a=n(6432),o=n(7266);t.objectdecorator_clearlevel_new=function(e){var t={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance};return t.decorated_machine=e,t};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e.get_object_instance(e);(0,o.level_clear)(c.actor),_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)}},1952:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_createitem_new=void 0;var a=n(6432),o=n(2878),r=n(7266);t.objectdecorator_createitem_new=function(e,t,n,r){var d={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},l=d;return l.decorated_machine=e,l.item_id=t,l.offset=(0,o.v2d_new)(n,r),d};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,i,_){var c=e.decorated_machine,s=e,d=e.get_object_instance(e);(0,r.level_create_item)(s.item_id,(0,o.v2d_add)(d.actor.position,s.offset)),c.update(c,t,n,a,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},7011:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_destroy_new=void 0;var a=n(6432),o=n(1459);t.objectdecorator_destroy_new=function(e){var t={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance};return t.decorated_machine=e,t};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine;e.get_object_instance(e).state=o.ES_DEAD,_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)}},3764:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_hidedialogbox_new=t.objectdecorator_showdialogbox_new=void 0;var a=n(6432),o=n(7266);t.objectdecorator_showdialogbox_new=function(e,t,n){return r(e,t,n,d)},t.objectdecorator_hidedialogbox_new=function(e){return r(e,"dead","beef",l)};var r=function(e,t,n,o){var r={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},d=r;return d.decorated_machine=e,d.title=t,d.message=n,d.strategy=o,r},i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;_.strategy(_),i.update(i,t,n,a,o,r)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)},d=function(e){(0,o.level_call_dialogbox)(e.title,e.message)},l=function(e){(0,o.level_hide_dialogbox)()}},1741:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_ellipticaltrajectory_new=void 0;var a=n(6432),o=n(9386),r=n(4163),i=n(3031),_=n(8707);t.objectdecorator_ellipticaltrajectory_new=function(e,t,n,r,i,_,u){var p={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},f=p;return f.decorated_machine=e,f.amplitude_x=t,f.amplitude_y=n,f.angularspeed_x=r*(2*o.PI),f.angularspeed_y=i*(2*o.PI),f.initialphase_x=_*o.PI/180,f.initialphase_y=u*o.PI/180,p};var c=function(e){var t=e.decorated_machine;t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,o,c){var s=e.decorated_machine,d=e,l=e.get_object_instance(e).actor,u=(0,r.timer_get_delta)(),p=null,f=null,g=null,m=null,v=null,h=null,b=null,E=null,I=.001*(0,r.timer_get_ticks)(),y=l.position;l.position.x+=-d.amplitude_x*d.angularspeed_x*Math.sin(d.initialphase_x+d.angularspeed_x*I)*u,l.position.y+=d.amplitude_y*d.angularspeed_y*Math.cos(d.initialphase_y+d.angularspeed_y*I)*u;var x=(0,i.actor_corners)(l,0,0,a,p,f,g,m,v,h,b,E);p=x.up,f=x.upright,g=x.right,m=x.downright,v=x.down,h=x.downleft,b=x.left,E=x.upleft;var S=(0,i.actor_handle_clouds)(l,0,p,f,g,m,v,h,b,E);p=S.up,f=S.upright,g=S.right,m=S.downright,v=S.down,h=S.downleft,b=S.left,E=S.upleft,null!=g&&l.position.x>y.x&&(l.position.x=l.hot_spot.x-(0,i.actor_image)(l).width+g.x),null!=b&&l.position.x<y.x&&(l.position.x=l.hot_spot.x+b.x+(0,_.brick_image)(b).width),null!=v&&l.position.y>y.y&&(l.position.y=l.hot_spot.y-(0,i.actor_image)(l).height+v.y),null!=p&&l.position.y<y.y&&(l.position.y=l.hot_spot.y+p.y+(0,_.brick_image)(p).height),s.update(s,t,n,a,o,c)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)}},9618:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_enemy_new=void 0;var a=n(6432),o=n(2878),r=n(9931),i=n(4470),_=n(5141),c=n(3031),s=n(2594),d=n(1459),l=n(7266),u=n(5141);t.objectdecorator_enemy_new=function(e,t){var n={init:p,release:f,update:g,render:m,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.score=t,n};var p=function(e){var t=e.decorated_machine;t.init(t)},f=function(e){var t=e.decorated_machine;t.release(t)},g=function(e,t,n,a,p,f){for(var g=e.decorated_machine,m=e,v=e.get_object_instance(e),h=0;h<n;h++){var b=t[h];b&&(0,c.actor_pixelperfect_collision)(v.actor,b.actor)&&((0,_.player_attacking)(b)||b.invincible?(b.actor.is_jumping&&(0,_.player_bounce)(b),(0,l.level_add_to_score)(m.score),(0,l.level_create_item)(s.IT_EXPLOSION,(0,o.v2d_add)(v.actor.position,(0,o.v2d_new)(0,-15))),(0,l.level_create_animal)(v.actor.position),(0,r.sound_play)((0,i.soundfactory_get)("destroy")),v.state=d.ES_DEAD):(0,u.player_hit)(b))}g&&g.update(g,t,n,a,p,f)},m=function(e,t){var n=e.decorated_machine;n.render(n,t)}},4248:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_gravity_new=void 0;var a=n(6432),o=n(3031),r=n(7266);t.objectdecorator_gravity_new=function(e){var t={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance};return t.decorated_machine=e,t};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,i,_){var c=e.decorated_machine,s=e.get_object_instance(e).actor;(0,o.actor_move)(s,(0,o.actor_platform_movement)(s,a,(0,r.level_gravity)())),c.update(c,t,n,a,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},175:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_acidplayer_new=t.objectdecorator_shockplayer_new=t.objectdecorator_burnplayer_new=t.objectdecorator_hitplayer_new=void 0;var a=n(6432),o=n(1459),r=n(5141),i=n(5141);t.objectdecorator_hitplayer_new=function(e){return _(e,u)},t.objectdecorator_burnplayer_new=function(e){return _(e,p)},t.objectdecorator_shockplayer_new=function(e){return _(e,f)},t.objectdecorator_acidplayer_new=function(e){return _(e,g)};var _=function(e,t){var n={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.should_hit_the_player=t,n},c=function(e){var t=e.decorated_machine;t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,i,_){var c=e.decorated_machine,s=e,d=(0,o.enemy_get_observed_player)(e.get_object_instance(e));!d.invincible&&s.should_hit_the_player(d)&&(0,r.player_hit)(d),c.update(c,t,n,a,i,_)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)},u=function(e){return!0},p=function(e){return e.shield_type!=i.SH_FIRESHIELD&&e.shield_type!=i.SH_WATERSHIELD},f=function(e){return e.shield_type!=i.SH_THUNDERSHIELD},g=function(e){return e.shield_type!=i.SH_ACIDSHIELD}},9040:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_jump_new=void 0;var a=n(6432),o=n(3031);t.objectdecorator_jump_new=function(e,t){var n={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.jump_strength=t,n};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e.get_object_instance(e).actor;(0,o.actor_corners)(c,2,-4,a,null,null,null,null,null,null,null,null),(0,o.actor_handle_clouds)(c,-4,null,null,null,null,null,null,null,null),_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)}},2384:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_lockcamera_new=void 0;var a=n(6432),o=n(1459),r=n(2954),i=n(7709),_=n(7266);t.objectdecorator_lockcamera_new=function(e,t,n,o,r){var i={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},_=i;return _.decorated_machine=e,_.x1=Math.min(t,o),_.y1=Math.min(n,r),_.x2=Math.max(t,o),_.y2=Math.max(n,r),i};var c=function(e){var t=e.decorated_machine,n=e,a=Math.abs(n.x2-n.x1),o=Math.abs(n.y2-n.y1);n.cute_image=u(a,o),n.has_locked_somebody=!1,t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,i,c){var s,d,l,u,p,f=e.decorated_machine,g=e,m=e.get_object_instance(e),v=(0,o.enemy_get_observed_player)(m),h=m.actor;s=h.position.x+g.x1,d=h.position.y+g.y1,l=g.x2-g.x1,u=g.y2-g.y1;for(var b=0;b<n;b++)if(p=t[b].actor,t[b]!=v||null!=p.carrying)p.position.x>s-30&&p.position.x<s&&(p.position.x=s-30,p.speed.x=0),p.position.x>s+l&&p.position.x<s+l+30&&(p.position.x=s+l+30,p.speed.x=0);else{var E=[],I=[];E[0]=p.position.x,E[1]=p.position.y,E[2]=p.position.x+1,E[3]=p.position.y+1,I[0]=s,I[1]=d,I[2]=s+l,I[3]=d+u,(0,r.bounding_box)(E,I)&&(g.has_locked_somebody=!0,t[b].in_locked_area=!0,(0,_.level_lock_camera)(s,d,s+l,d+u))}g.has_locked_somebody&&((p=v.actor).position.x<s&&(p.position.x=s,p.speed.x=Math.max(0,p.speed.x),v.at_some_border=!0),p.position.x>s+l&&(p.position.x=s+l,p.speed.x=Math.min(0,p.speed.x),v.at_some_border=!0),p.position.y=Math.min(p.position.y,d,d+u)),f.update(f,t,n,a,i,c)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)},u=function(e,t){var n=(0,i.image_create)(e,t);return(0,i.image_rgb)(255,0,0),n}},5624:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_lookatwalkingdirection_new=t.objectdecorator_lookatplayer_new=t.objectdecorator_lookright_new=t.objectdecorator_lookleft_new=void 0;var a=n(6432),o=n(9386),r=n(1459);t.objectdecorator_lookleft_new=function(e){return i(e,l)},t.objectdecorator_lookright_new=function(e){return i(e,u)},t.objectdecorator_lookatplayer_new=function(e){return i(e,p)},t.objectdecorator_lookatwalkingdirection_new=function(e){return i(e,f)};var i=function(e,t){var n={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.look_strategy=t,n},_=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;_.look_strategy(_),i.update(i,t,n,a,o,r)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)},l=function(e){var t=e;t.get_object_instance(t).actor.mirror&=~o.IF_HFLIP},u=function(e){var t=e;t.get_object_instance(t).actor.mirror|=o.IF_HFLIP},p=function(e){var t=e,n=t.get_object_instance(t),a=(0,r.enemy_get_observed_player)(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=~o.IF_HFLIP:n.actor.mirror|=o.IF_HFLIP)},f=function(e){var t=e,n=t.get_object_instance(t);n.actor.position.x>e.old_x?n.actor.mirror&=~o.IF_HFLIP:n.actor.mirror|=o.IF_HFLIP,e.old_x=n.actor.position.x}},6458:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_mosquitomovement_new=void 0;var a=n(6432),o=n(4163),r=n(2878),i=n(1459);t.objectdecorator_mosquitomovement_new=function(e,t){var n={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.speed=t,n};var _=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,_,c){var s=e.decorated_machine,d=e,l=e.get_object_instance(e),u=(0,i.enemy_get_observed_player)(l);if(u){var p=(0,r.v2d_subtract)(u.actor.position,l.actor.position);if((0,r.v2d_magnitude)(p)>=5){var f=(0,o.timer_get_delta)(),g=(0,r.v2d_normalize)(p),m=(0,r.v2d_multiply)(g,d.speed*f);l.actor.position=(0,r.v2d_add)(l.actor.position,m)}}s.update(s,t,n,a,_,c)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)}},5821:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_moveplayer_new=void 0;var a=n(6432),o=n(2878),r=n(4163),i=n(1459);t.objectdecorator_moveplayer_new=function(e,t,n){var r={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},i=r;return i.decorated_machine=e,i.speed=(0,o.v2d_new)(t,n),r};var _=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,_,c){var s=e.decorated_machine,d=e,l=(0,r.timer_get_delta)(),u=(0,o.v2d_multiply)(d.speed,l),p=(0,i.enemy_get_observed_player)(e.get_object_instance(e));p.actor.position=(0,o.v2d_add)(p.actor.position,u),s.update(s,t,n,a,_,c)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)}},7637:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_observeallplayers_new=t.objectdecorator_observeactiveplayer_new=t.objectdecorator_observecurrentplayer_new=t.objectdecorator_observeplayer_new=void 0;var a=n(6432),o=n(1459);t.objectdecorator_observeplayer_new=function(e,t){var n=e.get_object_instance(e);return r(e,i(t,n,l))},t.objectdecorator_observecurrentplayer_new=function(e){var t=e.get_object_instance(e);return r(e,i("foo",t,u))},t.objectdecorator_observeactiveplayer_new=function(e){var t=e.get_object_instance(e);return r(e,i("bar",t,p))},t.objectdecorator_observeallplayers_new=function(e){var t=e.get_object_instance(e);return r(e,i("boo",t,f))};var r=function(e,t){var n={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.strategy=t,n},i=function(e,t,n){return{player_name:e,object:t,run:n}},_=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;_.strategy.run(_.strategy,t,n),i.update(i,t,n,a,o,r)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)},l=function(e,t,n){(0,o.enemy_observe_player)(e.object,null)},u=function(e,t,n){(0,o.enemy_observe_current_player)(e.object)},p=function(e,t,n){(0,o.enemy_observe_active_player)(e.object)},f=function(e,t,n){for(var a=(0,o.enemy_get_observed_player)(e.object),r=0;r<n;r++)if(t[r]==a){(0,o.enemy_observe_player)(e.object,t[(r+1)%n]);break}}},937:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_onrightwallcollision_new=t.objectdecorator_onleftwallcollision_new=t.objectdecorator_onceilingcollision_new=t.objectdecorator_onfloorcollision_new=t.objectdecorator_onbrickcollision_new=t.objectdecorator_onwindshield_new=t.objectdecorator_onacidshield_new=t.objectdecorator_onwatershield_new=t.objectdecorator_onthundershield_new=t.objectdecorator_onfireshield_new=t.objectdecorator_onshield_new=t.objectdecorator_onnoshield_new=t.objectdecorator_onplayerrectcollision_new=t.objectdecorator_onplayerattack_new=t.objectdecorator_onplayercollision_new=t.objectdecorator_onrandomevent_new=t.objectdecorator_onanimationfinished_new=t.objectdecorator_oncollision_new=t.objectdecorator_ontimeout_new=void 0;var a=n(2954),o=n(6432),r=n(2954),i=n(4163),_=(n(8707),n(3031)),c=n(5141),s=n(1459),d=n(2141);t.objectdecorator_ontimeout_new=function(e,t,n){return l(e,n,m(t))},t.objectdecorator_oncollision_new=function(e,t,n){return l(e,n,E(t))},t.objectdecorator_onanimationfinished_new=function(e,t){return l(e,t,S())},t.objectdecorator_onrandomevent_new=function(e,t,n){return l(e,n,R(t))},t.objectdecorator_onplayercollision_new=function(e,t){return l(e,t,P())},t.objectdecorator_onplayerattack_new=function(e,t){return l(e,t,B())},t.objectdecorator_onplayerrectcollision_new=function(e,t,n,a,o,r){return l(e,r,H(t,n,a,o))},t.objectdecorator_onnoshield_new=function(e,t){return l(e,t,Y(c.SH_NONE))},t.objectdecorator_onshield_new=function(e,t){return l(e,t,Y(c.SH_SHIELD))},t.objectdecorator_onfireshield_new=function(e,t){return l(e,t,Y(c.SH_FIRESHIELD))},t.objectdecorator_onthundershield_new=function(e,t){return l(e,t,Y(c.SH_THUNDERSHIELD))},t.objectdecorator_onwatershield_new=function(e,t){return l(e,t,Y(c.SH_WATERSHIELD))},t.objectdecorator_onacidshield_new=function(e,t){return l(e,t,Y(c.SH_ACIDSHIELD))},t.objectdecorator_onwindshield_new=function(e,t){return l(e,t,Y(c.SH_WINDSHIELD))},t.objectdecorator_onbrickcollision_new=function(e,t){return l(e,t,z())},t.objectdecorator_onfloorcollision_new=function(e,t){return l(e,t,J())},t.objectdecorator_onceilingcollision_new=function(e,t){return l(e,t,ne())},t.objectdecorator_onleftwallcollision_new=function(e,t){return l(e,t,ie())},t.objectdecorator_onrightwallcollision_new=function(e,t){return l(e,t,de())};var l=function(e,t,n){var a={init:u,release:p,update:f,render:g,get_object_instance:o.get_object_instance},r=a;return r.new_state_name=t,r.strategy=n,a},u=function(e){var t=e.decorated_machine;t.init(t)},p=function(e){var t=e.decorated_machine;t.release(t)},f=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e,c=e.get_object_instance(e);_.strategy.should_trigger_event(_.strategy,c,t,n,a,o,r)?(0,d.object_vm_set_current_state)(c.vm,_.new_state_name):i.update(i,t,n,a,o,r)},g=function(e,t){var n=e.decorated_machine;n.render(n,t)},m=function(e){var t={init:v,release:h,should_trigger_event:b},n=t;return n.timeout=e,n.timer=0,t},v=function(e){},h=function(e){},b=function(e,t,n,a,o,r,_){var c=e;return c.timer+=(0,i.timer_get_delta)(),c.timer>=c.timeout&&(c.timer=0,!0)},E=function(e){var t={init:I,release:y,should_trigger_event:x};return t.target_name=e,t},I=function(e){},y=function(e){},x=function(e,t,n,a,o,r,i){for(var c=e,s=i;null!=s;s=s.next)if(s.data.name==c.target_name&&(0,_.actor_pixelperfect_collision)(s.data.actor,t.actor))return!0;return!1},S=function(){return{init:w,release:L,should_trigger_event:O}},w=function(e){},L=function(e){},O=function(e,t,n,a,o,r,i){return(0,_.actor_animation_finished)(t.actor)},R=function(e){var t={init:T,release:N,should_trigger_event:k};return t.probability=Math.min(e,0,1),t},T=function(e){},N=function(e){},k=function(e,t,n,a,o,i,_){return 1e5*e.probability>(0,r.random)(1e5)},P=function(){return{init:D,release:j,should_trigger_event:A}},D=function(e){},j=function(e){},A=function(e,t,n,a,o,r,i){var c=(0,s.enemy_get_observed_player)(t);return(0,_.actor_pixelperfect_collision)(t.actor,c.actor)},B=function(){return{init:M,release:C,should_trigger_event:F}},M=function(e){},C=function(e){},F=function(e,t,n,a,o,r,i){var d=(0,s.enemy_get_observed_player)(t);return(0,c.player_attacking)(d)&&(0,_.actor_pixelperfect_collision)(t.actor,d.actor)},H=function(e,t,n,a){var o={init:G,release:U,should_trigger_event:V},r=o;return r.x1=Math.min(e,n),r.y1=Math.min(t,a),r.x2=Math.max(e,n),r.y2=Math.max(t,a),o},G=function(e){},U=function(e){},V=function(e,t,n,o,r,i,c){var d=e,l=t.actor,u=(0,s.enemy_get_observed_player)(t),p=u.actor,f=(0,_.actor_image)(p),g=[],m=[];return g[0]=l.position.x+d.x1,g[1]=l.position.y+d.y1,g[2]=l.position.x+d.x2,g[3]=l.position.y+d.y2,m[0]=p.position.x-p.hot_spot.x,m[1]=p.position.y-p.hot_spot.y,m[2]=p.position.x-p.hot_spot.x+f.w,m[3]=p.position.y-p.hot_spot.y+f.h,!u.dying&&(0,a.bounding_box)(g,m)},Y=function(e){var t={init:W,release:K,should_trigger_event:X};return t.shield_type=e,t},W=function(e){},K=function(e){},X=function(e,t,n,a,o,r,i){var _=e;return(0,s.enemy_get_observed_player)(t).shield_type==_.shield_type},z=function(){return{init:q,release:Q,should_trigger_event:$}},q=function(e){},Q=function(e){},$=function(e,t,n,a,o,r,i){var c=t.actor;(0,_.actor_corners)(c,1,0,o,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined)},J=function(){return{init:Z,release:ee,should_trigger_event:te}},Z=function(e){},ee=function(e){},te=function(e,t,n,a,o,r,i){var c=t.actor;(0,_.actor_corners)(c,1,0,o,void 0,void 0,void 0,undefined,undefined,undefined,void 0,void 0)},ne=function(){return{init:ae,release:oe,should_trigger_event:re}},ae=function(e){},oe=function(e){},re=function(e,t,n,a,o,r,i){var c=t.actor;(0,_.actor_corners)(c,1,0,o,undefined,undefined,void 0,void 0,void 0,void 0,void 0,undefined)},ie=function(){return{init:_e,release:ce,should_trigger_event:se}},_e=function(e){},ce=function(e){},se=function(e,t,n,a,o,r,i){var c=t.actor;(0,_.actor_corners)(c,1,0,o,void 0,void 0,void 0,void 0,void 0,void 0,undefined,undefined)},de=function(){return{init:le,release:ue,should_trigger_event:pe}},le=function(e){},ue=function(e){},pe=function(e,t,n,a,o,r,i){var c=t.actor;(0,_.actor_corners)(c,1,0,o,void 0,undefined,undefined,void 0,void 0,void 0,void 0,void 0)}},3685:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_rollplayer_new=t.objectdecorator_springfyplayer_new=void 0;var a=n(6432),o=n(1459);t.objectdecorator_springfyplayer_new=function(e){return r(e,d)},t.objectdecorator_rollplayer_new=function(e){return r(e,l)};var r=function(e,t){var n={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.update=t,n},i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e,s=(0,o.enemy_get_observed_player)(e.get_object_instance(e));c.update(s),_.update(_,t,n,a,r,i)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)},d=function(e){e.spring=!0,e.spin=!1,e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1},l=function(e){e.spin=!0,e.spring=!1,e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1}},9803:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_disableplayermovement_new=t.objectdecorator_enableplayermovement_new=void 0;var a=n(6432),o=n(1459);t.objectdecorator_enableplayermovement_new=function(e){return r(e,!0)},t.objectdecorator_disableplayermovement_new=function(e){return r(e,!1)};var r=function(e,t){var n={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.enable=t,n},i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e;(0,o.enemy_get_observed_player)(e.get_object_instance(e)).disable_movement=!c.enable,_.update(_,t,n,a,r,i)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},567:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setalpha_new=void 0;var a=n(6432);t.objectdecorator_setalpha_new=function(e,t){var n={init:o,release:r,update:i,render:_,get_object_instance:a.get_object_instance},c=n;return c.decorated_machine=e,c.alpha=Math.min(t,0,1),n};var o=function(e){var t=e.decorated_machine;t.init(t)},r=function(e){var t=e.decorated_machine;t.release(t)},i=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e;e.get_object_instance(e).actor.alpha=_.alpha,i.update(i,t,n,a,o,r)},_=function(e,t){var n=e.decorated_machine;n.render(n,t)}},1198:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setanimation_new=void 0;var a=n(6432),o=n(9880),r=n(3031);t.objectdecorator_setanimation_new=function(e,t,n){var r={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},d=r;return d.decorated_machine=e,d.anim=(0,o.sprite_get_animation)(t,n),r};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,o,r){var i=e.decorated_machine;d(e),i.update(i,t,n,a,o,r)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)},d=function(e){var t=e,n=e.get_object_instance(e);(0,r.actor_change_animation)(n.actor,t.anim)}},7589:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setobstacle_new=void 0;var a=n(6432);t.objectdecorator_setobstacle_new=function(e,t,n){var c={init:o,release:r,update:i,render:_,get_object_instance:a.get_object_instance},s=c;return s.decorated_machine=e,s.is_obstacle=t,s.angle=n,c};var o=function(e){var t=e.decorated_machine;t.init(t)},r=function(e){var t=e.decorated_machine;t.release(t)},i=function(e,t,n,a,o,r){var i=e.decorated_machine,_=e,c=e.get_object_instance(e);c.obstacle=_.is_obstacle,c.obstacle_angle=_.angle,i.update(i,t,n,a,o,r)},_=function(e,t){var n=e.decorated_machine;n.render(n,t)}},9389:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setplayeranimation_new=void 0;var a=n(6432),o=n(9880),r=n(3031),i=n(1459);t.objectdecorator_setplayeranimation_new=function(e,t,n){var r={init:_,release:c,update:s,render:d,get_object_instance:a.get_object_instance},i=r;return i.decorated_machine=e,i.anim=(0,o.sprite_get_animation)(t,n),r};var _=function(e){var t=e.decorated_machine;t.init(t)},c=function(e){var t=e.decorated_machine;t.release(t)},s=function(e,t,n,a,o,_){var c=e.decorated_machine,s=e,d=(0,i.enemy_get_observed_player)(e.get_object_instance(e));(0,r.actor_change_animation)(d.actor,s.anim),c.update(c,t,n,a,o,_)},d=function(e,t){var n=e.decorated_machine;n.render(n,t)}},5125:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setplayerposition_new=void 0;var a=n(6432),o=n(2878),r=n(1459);t.objectdecorator_setplayerposition_new=function(e,t,n){var r={init:i,release:_,update:c,render:s,get_object_instance:a.get_object_instance},d=r;return d.decorated_machine=e,d.offset=(0,o.v2d_new)(t,n),r};var i=function(e){var t=e.decorated_machine;t.init(t)},_=function(e){var t=e.decorated_machine;t.release(t)},c=function(e,t,n,a,i,_){var c=e.decorated_machine,s=e,d=e.get_object_instance(e);(0,r.enemy_get_observed_player)(d).actor.position=(0,o.v2d_add)(d.actor.position,s.offset),c.update(c,t,n,a,i,_)},s=function(e,t){var n=e.decorated_machine;n.render(n,t)}},3204:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_setplayeryspeed_new=t.objectdecorator_setplayerxspeed_new=void 0;var a=n(6432),o=n(1459);t.objectdecorator_setplayerxspeed_new=function(e,t){return s(e,t,d)},t.objectdecorator_setplayeryspeed_new=function(e,t){return s(e,t,l)};var r=function(e){var t=e.decorated_machine;t.init(t)},i=function(e){var t=e.decorated_machine;t.release(t)},_=function(e,t,n,a,r,i){var _=e.decorated_machine,c=e,s=(0,o.enemy_get_observed_player)(e.get_object_instance(e));c.strategy(s,c.speed),_.update(_,t,n,a,r,i)},c=function(e,t){var n=e.decorated_machine;n.render(n,t)},s=function(e,t,n){var o={init:r,release:i,update:_,render:c,get_object_instance:a.get_object_instance},s=o;return s.decorated_machine=e,s.speed=t,s.strategy=n,o},d=function(e,t){e.actor.speed.x=t},l=function(e,t){e.actor.speed.y=t}},5352:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.objectdecorator_walk_new=void 0;var a=n(6432),o=n(4163),r=n(2954),i=n(3031),_=n(8707);t.objectdecorator_walk_new=function(e,t){var n={init:c,release:s,update:d,render:l,get_object_instance:a.get_object_instance},o=n;return o.decorated_machine=e,o.speed=t,n};var c=function(e){var t=e.decorated_machine;e.direction=0==(0,r.random)(2)?-1:1,t.init(t)},s=function(e){var t=e.decorated_machine;t.release(t)},d=function(e,t,n,a,r,c){var s=e.decorated_machine,d=e,l=e.get_object_instance(e).actor,u=(0,o.timer_get_delta)(),p=null,f=null,g=null,m=null,v=null,h=null,b=null,E=null;l.position.x+=d.direction*d.speed*u;var I=(0,i.actor_corners)(l,2,-2,a,p,f,g,m,v,h,b,E);p=I.up,f=I.upright,g=I.right,m=I.downright,v=I.down,h=I.downleft,b=I.left,E=I.upleft;var y=(0,i.actor_handle_clouds)(l,-2,p,f,g,m,v,h,b,E);p=y.up,f=y.upright,g=y.right,m=y.downright,v=y.down,h=y.downleft,b=y.left,E=y.upleft,null!=g&&d.direction>0&&(l.position.x=l.hot_spot.x-(0,i.actor_image)(l).width+g.x,d.direction=-1),null!=b&&d.direction<0&&(l.position.x=l.hot_spot.x+b.x+(0,_.brick_image)(b).width,d.direction=1),null!=v&&(null==m&&null!=h?d.direction=-1:null==h&&null!=m&&(d.direction=1)),s.update(s,t,n,a,r,c)},l=function(e,t){var n=e.decorated_machine;n.render(n,t)}},2141:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.object_vm_set_current_state=t.object_vm_create_state=t.object_vm_get_reference_to_current_state=t.object_vm_destroy=t.object_vm_create=void 0;var a=n(7898),o=n(8529);t.object_vm_create=function(e){return{owner:e,state_list:null,reference_to_current_state:null}},t.object_vm_destroy=function(e){return e.state_list=i(e.state_list),e.reference_to_current_state=null,e.owner=null,null},t.object_vm_get_reference_to_current_state=function(e){return e.reference_to_current_state},t.object_vm_create_state=function(e,t){return null==_(e.state_list,t)&&(e.state_list=r(e.state_list,t,e.owner)),e.state_list},t.object_vm_set_current_state=function(e,t){var n=_(e.state_list,t);return null!=n?e.reference_to_current_state=n.data:(0,a.logfile_message)("Object script error: can't find state ".concat(t)),e};var r=function(e,t,n){return{name:t,data:(0,o.objectbasicmachine_new)(n),next:e}},i=function(e){if(null!=e){var t=e.data;i(e.next),t.release(t)}return null},_=function(e,t){return null!=e?e.name==t?_(e.next,t):e:null}},5141:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.player_set_score=t.player_set_lives=t.player_set_rings=t.player_get_sprite_name=t.player_get_score=t.player_get_lives=t.player_get_rings=t.player_attacking=t.player_bounce=t.player_kill=t.player_hit=t.player_platform_movement=t.player_render=t.player_update=t.player_destroy=t.player_create=t.SH_WINDSHIELD=t.SH_ACIDSHIELD=t.SH_WATERSHIELD=t.SH_THUNDERSHIELD=t.SH_FIRESHIELD=t.SH_SHIELD=t.SH_NONE=t.PL_KNUCKLES=t.PL_TAILS=t.PL_SONIC=t.PLAYER_JUMP_SENSITIVITY=t.TAILS_MAX_FLIGHT=t.PLAYER_MAX_SPEEDSHOES=t.PLAYER_MAX_INVINCIBILITY=t.PLAYER_MAX_BLINK=t.PLAYER_WALL_LEFT=t.PLAYER_WALL_BOTTOM=t.PLAYER_WALL_RIGHT=t.PLAYER_WALL_TOP=t.PLAYER_WALL_NONE=t.PLAYER_MAX_INVSTAR=t.PLAYER_INITIAL_LIVES=void 0;var a=n(3031),o=n(8707),r=n(2594),i=n(7598),_=n(9931),c=n(4470),s=n(7774),d=n(9880),l=n(7709),u=n(7898),p=n(4163),f=n(2878),g=n(9386),m=n(2954),v=n(7266);t.PLAYER_INITIAL_LIVES=5,t.PLAYER_MAX_INVSTAR=5,t.PLAYER_WALL_NONE=0,t.PLAYER_WALL_TOP=1,t.PLAYER_WALL_RIGHT=2,t.PLAYER_WALL_BOTTOM=4,t.PLAYER_WALL_LEFT=8,t.PLAYER_MAX_BLINK=4,t.PLAYER_MAX_INVINCIBILITY=23,t.PLAYER_MAX_SPEEDSHOES=23,t.TAILS_MAX_FLIGHT=10,t.PLAYER_JUMP_SENSITIVITY=.88,t.PL_SONIC=0,t.PL_TAILS=1,t.PL_KNUCKLES=2,t.SH_NONE=0,t.SH_SHIELD=1,t.SH_FIRESHIELD=2,t.SH_THUNDERSHIELD=3,t.SH_WATERSHIELD=4,t.SH_ACIDSHIELD=5,t.SH_WINDSHIELD=6;var h,b,E=0,I=0;t.player_create=function(e){(0,u.logfile_message)("player_create(".concat(e,")"));for(var n={name:"Unknown",type:e,actor:(0,a.actor_create)(),disable_movement:!1,in_locked_area:!1,at_some_border:!1,spin:!1,spin_dash:!1,braking:!1,flying:!1,climbing:!1,landing:!1,spring:!1,is_fire_jumping:!1,getting_hit:!1,dying:!1,dead:!1,blinking:!1,on_moveable_platform:!1,lock_accel:0,flight_timer:0,blink_timer:0,death_timer:0,disable_jump_for:0,glasses:(0,a.actor_create)(),got_glasses:!1,shield:(0,a.actor_create)(),shield_type:t.SH_NONE,invincible:!1,invtimer:0,invstar:[],got_speedshoes:!1,speedshoes_timer:0,disable_wall:t.PLAYER_WALL_NONE,entering_loop:!1,at_loopfloortop:!1,bring_to_back:!1},o=0;o<t.PLAYER_MAX_INVSTAR;o++)n.invstar[o]=(0,a.actor_create)(),(0,a.actor_change_animation)(n.invstar[o],(0,d.sprite_get_animation)("SD_INVSTAR",0));switch(n.type){case t.PL_SONIC:n.name="Surge",n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=(0,s.input_create_user)(),(0,a.actor_change_animation)(n.actor,(0,d.sprite_get_animation)(y(t.PL_SONIC),0));break;case t.PL_TAILS:n.name="Neon",n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,s.input_create_user)(),(0,a.actor_change_animation)(n.actor,(0,d.sprite_get_animation)(y(t.PL_TAILS),0));break;case t.PL_KNUCKLES:n.name="Charge",n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=(0,s.input_create_user)(),(0,a.actor_change_animation)(n.actor,(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),0))}return b=1,h=0,(0,u.logfile_message)("player_create() ok"),n},t.player_destroy=function(e){for(var t=0;t<e.invstar.length;t++)(0,a.actor_destroy)(e.invstar[t]);(0,a.actor_destroy)(e.glasses),(0,a.actor_destroy)(e.actor)},t.player_update=function(e,n,o){var r=e.actor;return e.blinking&&(e.blink_timer+=(0,p.timer_get_delta)(),r.visible=(0,p.timer_get_ticks)()%250<125,e.blink_timer>=t.PLAYER_MAX_BLINK&&(e.getting_hit=e.blinking=!1,r.visible=!0)),e.disable_movement?e.spin?(0,a.actor_change_animation)(e.actor,(0,d.sprite_get_animation)(y(e.type),3)):e.spring&&(0,a.actor_change_animation)(e.actor,(0,d.sprite_get_animation)(y(e.type),13)):(0,a.actor_move)(r,(0,t.player_platform_movement)(e,n,o,(0,v.level_gravity)())),e},t.player_render=function(e,n){if(e){var o=e.actor;if(o){var r,i,_=o.hot_spot,c=o.position,s=(0,f.v2d_new)(0,0),l=(0,f.v2d_new)(0,0),u=[],v=o.angle;if(e.invincible){var h=(0,d.sprite_get_animation)("SD_INVSTAR",0).frame_count;for(e.invtimer+=(0,p.timer_get_delta)(),r=0;r<t.PLAYER_MAX_INVSTAR;r++)u[r]=720*(0,p.timer_get_ticks)()*.001+(r+1)*(360/t.PLAYER_MAX_INVSTAR),l.x=30*Math.cos(u[r]*g.PI/180),l.y=((0,p.timer_get_ticks)()+400*r)%2e3/40,l=(0,f.v2d_rotate)(l,v),e.invstar[r].position.x=o.position.x+l.x,e.invstar[r].position.y=o.position.y-l.y+5,(0,a.actor_change_animation_frame)(e.invstar[r],(0,m.random)(h))}switch(e.got_glasses&&x(e),e.shield_type!=t.SH_NONE&&w(e),e.type){case t.PL_SONIC:case t.PL_TAILS:case t.PL_KNUCKLES:}for(r=0;r<t.PLAYER_MAX_INVSTAR&&e.invincible;r++)u[r]%360>=180&&(0,a.actor_render)(e.invstar[r],n);for(i=o.angle,o.angle=o.is_jumping||e.spin?i:(0,m.old_school_angle)(i),(0,a.actor_render)(o,n),o.angle=i,e.got_glasses&&(0,a.actor_render)(e.glasses,n),e.shield_type!=t.SH_NONE&&(0,a.actor_render)(e.shield,n),r=0;r<t.PLAYER_MAX_INVSTAR&&e.invincible;r++)u[r]%360<180&&(0,a.actor_render)(e.invstar[r],n);switch(e.type){case t.PL_SONIC:break;case t.PL_TAILS:o.is_jumping&&o.animation==(0,d.sprite_get_animation)(y(t.PL_TAILS),3)&&(o.position=(0,f.v2d_new)(c.x,c.y),o.angle=v,o.hot_spot=_,e.shield_type!=t.SH_NONE&&(e.shield.angle=0,e.shield.hot_spot=s));case t.PL_KNUCKLES:}}}},t.player_platform_movement=function(e,n,r,i){var u,h,b,E,I,x,S,w,O,R,T,N,k,P,D,j,A,B,M,C,F=e.actor,H=y(e.type),G=(0,p.timer_get_delta)(),U=480,V=0,Y=1,W=F.maxspeed,K=(0,f.v2d_new)(0,0),X=!1,z=e.actor.animation==(0,d.sprite_get_animation)(H,1),q=!1,Q=!1,$=!1,J=null,Z=(0,a.actor_image)(F).width,ee=(0,a.actor_image)(F).height,te=!(Math.abs(F.angle)<g.EPSILON||Math.abs(F.angle-g.PI/2)<g.EPSILON||Math.abs(F.angle-g.PI)<g.EPSILON||Math.abs(F.angle-3*g.PI/2)<g.EPSILON),ne=-2,ae=0,oe=0,re=0,ie=F.position;switch(e.type){case t.PL_SONIC:te?(ae=1,oe=.8,re=.5):(ae=.7,oe=.5,re=.4);break;case t.PL_TAILS:case t.PL_KNUCKLES:te?(ae=1,oe=.7,re=.25):(ae=.7,oe=.5,re=.25)}if(k=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(0,-ee*ae+ne),-F.angle)),A=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(0,2),-F.angle)),M=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(-Z*re+ne,-ee*oe),-F.angle)),D=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(Z*re-ne,-ee*oe),-F.angle)),C=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(-Z*re+ne,-ee*ae+ne),-F.angle)),P=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(Z*re-ne,-ee*ae+ne),-F.angle)),B=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(-Z*re+ne,2),-F.angle)),j=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(Z*re-ne,2),-F.angle)),e.type==t.PL_TAILS&&F.carrying&&Math.abs(F.angle)<g.EPSILON){var _e=(0,a.actor_image)(F.carrying).height,ce=F.speed.y>5?.7*_e:0;B.y+=ce,j.y+=ce,A.y+=ce,M.y+=_e*oe+(0,m.random)(_e)-.5*_e,D.y=M.y}(0,a.actor_corners_disable_detection)(e.disable_wall&t.PLAYER_WALL_LEFT,e.disable_wall&t.PLAYER_WALL_RIGHT,e.disable_wall&t.PLAYER_WALL_BOTTOM,e.disable_wall&t.PLAYER_WALL_TOP),(0,a.actor_corners_set_floor_priority)(!(e.disable_wall&t.PLAYER_WALL_BOTTOM));var se=(0,a.actor_corners_ex)(F,2,k,P,D,j,A,B,M,C,r,E,w,x,O,I,R,S,T);if(E=se.up,I=se.down,S=se.left,x=se.right,T=se.upleft,w=se.upright,R=se.downleft,O=se.downright,(0,a.actor_corners_restore_floor_priority)(),e.dying)return F.speed.x=0,F.speed.y=Math.min(U,F.speed.y+i*G),F.mirror=null,F.angle=0,F.visible=!0,e.blinking=!1,e.death_timer+=G,e.dead=e.death_timer>=2.5,(0,a.actor_change_animation)(F,(0,d.sprite_get_animation)(H,8)),(0,f.v2d_new)(0,F.speed.y*G+.5*i*G*G);if(e.dead)return(0,f.v2d_new)(0,0);var de=(0,a.actor_handle_clouds)(F,ne,E,w,x,O,I,R,S,T);switch(E=de.up,w=de.upright,x=de.right,S=de.left,T=de.upleft,I=de.down,R=de.downleft,O=de.downright,e.type){case t.PL_SONIC:F.carry_offset=(0,f.v2d_new)(F.mirror&g.IF_HFLIP?7:-9,-40);break;case t.PL_TAILS:case t.PL_KNUCKLES:F.carry_offset=(0,f.v2d_new)(F.mirror&g.IF_HFLIP?7:-7,-42)}if(null!=F.carried_by){var le=null,ue=void 0,pe=0,fe=0,ge=F.carried_by;for(ue=0;ue<n.length;ue++)if(n[ue]==e){fe=ue;break}for(ue=0;ue<n.length;ue++)if(n[ue].actor==ge){le=n[ue],pe=ue,e.disable_wall=le.disable_wall,e.entering_loop=le.entering_loop,e.at_loopfloortop=le.at_loopfloortop,e.bring_to_back=le.bring_to_back;break}if(le&&(le.type==t.PL_TAILS&&!le.flying||le.getting_hit||le.dying||le.dead))F.position=(0,f.v2d_new)(F.carried_by.position.x,F.carried_by.position.y),F.carried_by.carrying=null,F.carried_by=null;else{if(!(I&&0==I.brick_ref.angle&&ge.speed.y>=5||e.getting_hit||e.dying||e.dead)){var me=fe<pe?(0,f.v2d_multiply)(ge.speed,G):(0,f.v2d_new)(0,0);return F.speed=(0,f.v2d_new)(0,0),F.mirror=ge.mirror,F.angle=0,(0,a.actor_change_animation)(F,(0,d.sprite_get_animation)(H,25)),F.position=(0,f.v2d_subtract)((0,f.v2d_add)(ge.position,me),F.carry_offset),(0,f.v2d_new)(0,0)}F.position=(0,f.v2d_new)(F.carried_by.position.x,F.carried_by.position.y),F.carried_by.carrying=null,F.carried_by=null}}if(e.entering_loop=!1,e.got_speedshoes&&(e.speedshoes_timer>t.PLAYER_MAX_SPEEDSHOES?e.got_speedshoes=!1:(W*=1.5,e.speedshoes_timer+=G)),L(e)&&F.is_jumping&&(e.disable_wall&=~t.PLAYER_WALL_BOTTOM),e.spring&&(I&&F.speed.y>=0||e.flying||e.climbing)&&(e.spring=!1),u=(x&&(0,s.input_button_down)(F.input,s.IB_RIGHT)||S&&(0,s.input_button_down)(F.input,s.IB_LEFT))&&I,e.on_moveable_platform=(0,f.v2d_magnitude)((0,v.level_brick_move_actor)(I,F))>g.EPSILON,(b=I&&(F.angle>0&&F.angle<g.PI/2&&F.speed.x>0||F.angle>3*g.PI/2&&F.angle<2*g.PI&&F.speed.x<0))&&(T||w)||Math.abs(F.angle)<g.EPSILON||Math.abs(F.angle-g.PI)<g.EPSILON){if(x&&x.brick_ref.angle%90==0&&(F.speed.x>g.EPSILON||D.x>x.x)&&(!b||b&&90!=x.brick_ref.angle)&&(F.speed.x=0,F.position.x=x.x+(ie.x-D.x),!F.is_jumping&&!e.flying&&!e.climbing&&Math.abs(F.speed.y)<g.EPSILON&&(J=(0,d.sprite_get_animation)(H,u?14:0)),b))return(0,f.v2d_new)(-5,0);if(S&&S.brick_ref.angle%90==0&&(F.speed.x<-g.EPSILON||M.x<S.x+S.brick_ref.image.width)&&(!b||b&&270!=S.brick_ref.angle)&&(F.speed.x=0,F.position.x=S.x+S.brick_ref.image.width+(ie.x-M.x),!F.is_jumping&&!e.flying&&!e.climbing&&Math.abs(F.speed.y)<g.EPSILON&&(J=(0,d.sprite_get_animation)(H,u?14:0)),b))return(0,f.v2d_new)(5,0);F.position.x<=F.hot_spot.x&&(e.spin=!1,Q=!0,F.position.x<F.hot_spot.x&&(F.speed.x=0,F.position.x=F.hot_spot.x,I&&(u=!0,J=(0,d.sprite_get_animation)(H,1)))),F.position.x>=(0,v.level_size)().x-((0,a.actor_image)(F).width-F.hot_spot.x)&&(e.spin=!1,q=!0,F.position.x>(0,v.level_size)().x-((0,a.actor_image)(F).width-F.hot_spot.x)&&(F.speed.x=0,F.position.x=(0,v.level_size)().x-((0,a.actor_image)(F).width-F.hot_spot.x),I&&(u=!0,J=(0,d.sprite_get_animation)(H,1))))}if(!e.climbing){if(I){var ve,he=I.brick_ref.angle,be=void 0;if(X=!0,F.ignore_horizontal=!1,e.is_fire_jumping=!1,F.is_jumping=!1,I.brick_ref&&I.brick_ref.behavior==o.BRB_FALL&&I.state==o.BRS_IDLE&&(I.state=o.BRS_ACTIVE),Math.abs(F.speed.x)<g.EPSILON){if(he%180==0&&(e.spin=!1),(0,s.input_button_down)(F.input,s.IB_DOWN))e.spin_dash||(J=(0,d.sprite_get_animation)(H,4)),(0,s.input_button_pressed)(F.input,s.IB_FIRE1)&&(J=(0,d.sprite_get_animation)(H,6),e.spin_dash=!0,(0,_.sound_play)((0,c.soundfactory_get)("charge")));else if(!u)if((0,s.input_button_down)(F.input,s.IB_UP))z&&e.at_some_border||(J=(0,d.sprite_get_animation)(H,5));else if(L(e))J=(0,d.sprite_get_animation)(H,0);else{var Ee=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(-8,0),-F.angle)),Ie=(0,f.v2d_add)(ie,(0,f.v2d_rotate)((0,f.v2d_new)(5,0),-F.angle)),ye=(0,f.v2d_new)(0,0),xe=(0,a.actor_corners_ex)(F,2,ye,ye,ye,Ie,ye,Ee,ye,ye,r,null,null,null,void 0,null,void 0,null,null);xe.downleft&&xe.downright||e.on_moveable_platform?(0,s.input_button_down)(F.input,s.IB_LEFT)&&(Q||e.at_some_border)||(0,s.input_button_down)(F.input,s.IB_RIGHT)&&(q||e.at_some_border)?(F.mirror=Q?g.IF_HFLIP:g.IF_NONE,J=(0,d.sprite_get_animation)(H,1)):J=(0,d.sprite_get_animation)(H,0):J=(0,d.sprite_get_animation)(H,10)}if(e.spin_dash){var Se=void 0,we=F.mirror&g.IF_HFLIP?1:-1,Le=void 0,Oe=void 0,Re=void 0;for(Se=0;Se<3;Se++)(0,m.random)(128),Re=(0,l.image_create)(1,1),(0,l.image_clear)(Re,255,255,255),Le=(0,f.v2d_new)(we*(7+(0,m.random)(7)),2),Oe=(0,f.v2d_new)(we*(50+(0,m.random)(200)),-(0,m.random)(200)),(0,v.level_create_particle)(Re,(0,f.v2d_add)(F.position,Le),Oe,!0);((0,s.input_button_up)(F.input,s.IB_DOWN)||(0,v.level_editmode)())&&(e.spin=!0,e.spin_dash=!1,(!(F.mirror&g.IF_HFLIP)||S||Q)&&(F.mirror&g.IF_HFLIP||x||q)||(F.speed.x=(F.mirror&g.IF_HFLIP?-1:1)*W*1.35),(0,_.sound_play)((0,c.soundfactory_get)("release")),e.disable_jump_for=.05)}}else if((0,s.input_button_down)(F.input,s.IB_DOWN)&&(e.spin||(0,_.sound_play)((0,c.soundfactory_get)("roll")),e.spin=!0),e.spin||e.braking)e.spin?J=(0,d.sprite_get_animation)(H,3):e.braking&&(we=F.mirror&g.IF_HFLIP?1:-1,Le=void 0,Oe=void 0,Re=void 0,(0,m.random)(128),Re=(0,l.image_create)(1,1),Le=(0,f.v2d_new)(we*(10-(0,m.random)(21)),0),Oe=(0,f.v2d_new)(we*(50+(0,m.random)(200)),-(0,m.random)(200)),(0,v.level_create_particle)(Re,(0,f.v2d_add)(F.position,Le),Oe,!0),J=(0,d.sprite_get_animation)(H,7),Math.abs(F.speed.x)<10&&(e.braking=!1));else{var Te=.75*W,Ne=.35*W;Math.abs(F.speed.x)<Te?!u&&F.speed.y>=0&&(J=(0,d.sprite_get_animation)(H,1),F=(0,a.actor_change_animation_speed_factor)(F,.5+Math.abs(F.speed.x)/Te*1.5)):J=(0,d.sprite_get_animation)(H,2),Math.abs(F.speed.x)>=Ne&&((0,s.input_button_down)(F.input,s.IB_RIGHT)&&F.speed.x<0||(0,s.input_button_down)(F.input,s.IB_LEFT)&&F.speed.x>0)&&((0,_.sound_play)((0,c.soundfactory_get)("brake")),e.braking=!0)}if(e.disable_jump_for=Math.max(e.disable_jump_for-G,0),Math.abs(F.speed.x)<g.EPSILON&&(e.disable_jump_for=0),ve=!e.spin_dash,(0,s.input_button_down)(F.input,s.IB_FIRE1)&&e.disable_jump_for<=0&&!(0,s.input_button_down)(F.input,s.IB_DOWN)&&!E&&!e.landing&&ve&&!F.is_jumping&&((0,_.sound_play)((0,c.soundfactory_get)("jump")),F.angle=0,F.is_jumping=!0,e.is_fire_jumping=!0,$=!0,e.spin=!1,J=(0,d.sprite_get_animation)(H,3),0==he?F.speed.y=1*-F.jump_strength:he>0&&he<90?he>45?(F.speed.x=Math.min(F.speed.x,-.7*F.jump_strength*1),F.speed.y=-.7*F.jump_strength*1):(F.speed.x*=F.speed.x>0?.5:1,F.speed.y=1*-F.jump_strength):90==he?((0,a.actor_move)(F,(0,f.v2d_new)(-40,0)),F.speed.x=Math.min(F.speed.x,1*-F.jump_strength),F.speed.y=-F.jump_strength/2*1):he>90&&he<180?((0,a.actor_move)(F,(0,f.v2d_new)(0,40)),F.speed.x=Math.min(F.speed.x,-.7*F.jump_strength*1),F.speed.y=1*F.jump_strength):180==he?((0,a.actor_move)(F,(0,f.v2d_new)(0,40)),F.speed.x*=-1,F.speed.y=1*F.jump_strength):he>180&&he<270?((0,a.actor_move)(F,(0,f.v2d_new)(0,40)),F.speed.x=Math.max(F.speed.x,.7*F.jump_strength*1),F.speed.y=1*F.jump_strength):270==he?((0,a.actor_move)(F,(0,f.v2d_new)(40,0)),F.speed.x=Math.max(F.speed.x,1*F.jump_strength),F.speed.y=-F.jump_strength/2*1):he>270&&he<360&&(he<315?(F.speed.x=Math.max(F.speed.x,.7*F.jump_strength*1),F.speed.y=-.7*F.jump_strength*1):(F.speed.x*=F.speed.x<0?.5:1,F.speed.y=1*-F.jump_strength))),!F.is_jumping){var ke=void 0;he>0&&he<90?(ke=.8*Math.min(1,Math.tan(he*g.PI/180)),Math.abs(F.speed.y)>g.EPSILON?F.speed.x=X&&he<=45?F.speed.x:Math.max(-1.2*W,-1*ke*F.speed.y):(be=(F.mirror&g.IF_HFLIP?2:1)*ke,e.braking&&he<45?be*=8*(F.speed.x<0?-.5:1):Math.abs(F.speed.x)<5&&(be*=25*Math.sin(he*g.PI/180),e.lock_accel=2),F.speed.x=Math.max(F.speed.x-700*be*G,-1.2*W))):he>270&&he<360&&(ke=.8*Math.min(1,-Math.tan(he*g.PI/180)),Math.abs(F.speed.y)>g.EPSILON?F.speed.x=X&&he>=315?F.speed.x:Math.min(1.2*W,1*ke*F.speed.y):(be=(F.mirror&g.IF_HFLIP?1:2)*ke,e.braking&&he>315?be*=8*(F.speed.x>0?-.5:1):Math.abs(F.speed.x)<5&&(be*=25*-Math.sin(he*g.PI/180),e.lock_accel=1),F.speed.x=Math.min(F.speed.x+700*be*G,1.2*W)))}he%90==0&&(e.lock_accel=0),R&&O&&Math.abs(F.speed.x)<40&&R.brick_ref.angle>270&&R.brick_ref.angle<360&&O.brick_ref.angle>0&&O.brick_ref.angle<90&&((0,s.input_button_down)(F.input,s.IB_LEFT)||(0,s.input_button_down)(F.input,s.IB_RIGHT)||(F.speed.x=0))}else e.braking=!1,e.lock_accel=0,e.spin_dash&&(e.spin_dash=!1,J=(0,d.sprite_get_animation)(H,1)),F.animation!=(0,d.sprite_get_animation)(H,0)&&F.animation!=(0,d.sprite_get_animation)(H,10)&&F.animation!=(0,d.sprite_get_animation)(H,5)||(J=(0,d.sprite_get_animation)(H,1)),(e.spring||z||F.speed.y<0)&&(e.spin=!1),L(e)||(F.angle=0);if(I||e.is_fire_jumping&&F.speed.y<-F.jump_strength*t.PLAYER_JUMP_SENSITIVITY&&(0,s.input_button_up)(F.input,s.IB_FIRE1)&&(F.speed.y*=.7),e.type==t.PL_TAILS&&e.flying?(Y=e.flight_timer<t.TAILS_MAX_FLIGHT?.15:.8,U*=.3):Y=1,K.y=Math.abs(F.speed.y)>g.EPSILON?F.speed.y*G+i*Y*.5*(G*G):0,e.type==t.PL_KNUCKLES&&e.flying||(F.speed.y=Math.min(F.speed.y+i*Y*G,U)),h=E&&E.brick_ref.angle%90!=0&&Math.abs(F.angle)<g.EPSILON,E&&(E.brick_ref.angle%90==0||h)&&F.speed.y<-g.EPSILON&&(F.position.y=E.y+E.brick_ref.image.height+(ie.y-k.y),F.speed.y=10,E.brick_ref.behavior==o.BRB_CIRCULAR&&Math.sin(E.brick_ref.behavior_arg[3]*E.value[0])>0))return F.speed.y=100,(0,f.v2d_add)(K,(0,f.v2d_multiply)((0,v.level_brick_move_actor)(E,F),G));if((N=I)&&!F.is_jumping)if(he=N.brick_ref.angle,F.speed.y=K.y=0,F.angle=he*g.PI/180,0==he){var Pe=(0,v.level_brick_move_actor)(I,F);ie.y=N.y,V=0,Pe.y>g.EPSILON?K.y+=Pe.y*G:F.position.y=ie.y+ne+1}else if(he>0&&he<90)ie.y=N.y+N.brick_ref.image.height-(F.position.x-N.x)*Math.tan(F.angle),F.speed.x<0&&(ie.y+=2),F.position.y=ie.y+ne,F.mirror&g.IF_HFLIP||(V=.2);else if(90==he){if(Math.abs(F.speed.x)>5){var De=O?O.brick_ref.angle:-1;O&&De>=he&&De<he+90?e.flying||(F.position.x=N.x+ne):(F.angle=0,F.is_jumping=!0,e.spin||e.flying||(J=(0,d.sprite_get_animation)(H,1)),L(e)||(e.flying||(0,a.actor_move)(F,(0,f.v2d_new)(-13,0)),F.speed=(0,f.v2d_new)(0,-.9*Math.abs(F.speed.x))))}else F.angle=0,e.flying||(0,a.actor_move)(F,(0,f.v2d_new)(-10,0)),F.is_jumping=!0,F.ignore_horizontal=!1;F.mirror&g.IF_HFLIP||(V=1.5)}else he>90&&he<180?(Math.abs(F.speed.x)>5?(ie.y=N.y-(F.position.x-N.x)*Math.tan(F.angle),F.position.y=ie.y-ne):(F.angle=0,(0,a.actor_move)(F,(0,f.v2d_new)(0,30)),F.is_jumping=!0),V=1.5):180==he?(Math.abs(F.speed.x)>5?(ie.y=N.y+N.brick_ref.image.height,F.position.y=ie.y-ne,(F.speed.x>0&&!O||F.speed.x<0&&!R)&&((0,a.actor_move)(F,(0,f.v2d_new)(0,-30)),F.is_jumping=!0,F.speed.x*=-1,F.mirror=F.speed.x<0?g.IF_HFLIP:g.IF_NONE,F.angle=0)):(F.angle=0,(0,a.actor_move)(F,(0,f.v2d_new)(0,40)),F.is_jumping=!0,F.speed.x=0),V=1.2):he>180&&he<270?(Math.abs(F.speed.x)>5?(ie.y=N.y+N.brick_ref.image.height-(F.position.x-N.x)*Math.tan(F.angle),F.position.y=ie.y-ne):(F.angle=0,(0,a.actor_move)(F,(0,f.v2d_new)(0,30)),F.is_jumping=!0),V=1.5):270==he?(Math.abs(F.speed.x)>5?(De=R?R.brick_ref.angle:-1,R&&De>he-90&&De<=he?e.flying||(F.position.x=N.x+N.brick_ref.image.width-ne):(F.angle=0,F.is_jumping=!0,e.spin||e.flying||(J=(0,d.sprite_get_animation)(H,1)),L(e)||(e.flying||(0,a.actor_move)(F,(0,f.v2d_new)(13,0)),F.speed=(0,f.v2d_new)(0,-.9*Math.abs(F.speed.x))))):(F.angle=0,e.flying||(0,a.actor_move)(F,(0,f.v2d_new)(10,0)),F.is_jumping=!0,F.ignore_horizontal=!1),F.mirror&g.IF_HFLIP&&(V=1.5)):he>270&&he<360&&(ie.y=N.y-(F.position.x-N.x)*Math.tan(F.angle),F.speed.x>0&&(ie.y+=2),F.position.y=ie.y+ne,F.mirror&g.IF_HFLIP&&(V=.2));if(K.x=Math.abs(F.speed.x)>g.EPSILON?F.speed.x*G+(1-V)*F.acceleration*.5*(G*G):0,!(0,s.input_button_down)(F.input,s.IB_LEFT)||(0,s.input_button_down)(F.input,s.IB_RIGHT)||e.spin||e.braking||e.landing||e.getting_hit||1==e.lock_accel||Q)if(!(0,s.input_button_down)(F.input,s.IB_RIGHT)||(0,s.input_button_down)(F.input,s.IB_LEFT)||e.spin||e.braking||e.landing||e.getting_hit||2==e.lock_accel||q){if(I){var je=0;he=I.brick_ref.angle,be=0,be=e.spin?.65:e.braking?4.5:e.landing?.6:1,he%90==0?je=90==he?-1:270==he?1:F.speed.x>g.EPSILON?-1:-F.speed.x>g.EPSILON?1:0:(he>90&&he<180||he>180&&he<270)&&(je=F.speed.x>g.EPSILON?-1:-F.speed.x>g.EPSILON?1:0),F.speed.x+=je*be*F.acceleration*G}}else F.ignore_horizontal||!(F.is_jumping||e.spring||z)&&(0,s.input_button_down)(F.input,s.IB_DOWN)||(F.mirror=0,V=F.speed.x<0?-1:V,F.speed.x<=1.1*W&&(F.speed.x=Math.min(F.speed.x+(1-V)*F.acceleration*G,W)));else F.ignore_horizontal||!(F.is_jumping||e.spring||z)&&(0,s.input_button_down)(F.input,s.IB_DOWN)||(F.mirror=g.IF_HFLIP,V=F.speed.x>0?-1:V,F.speed.x>=1.1*-W&&(F.speed.x=Math.max(F.speed.x-(1-V)*F.acceleration*G,-W)))}switch(e.spring&&(J=(0,d.sprite_get_animation)(H,F.speed.y<=0?13:1),F.speed.y>0&&(e.spring=!1,F.is_jumping=!1)),e.getting_hit&&(I?e.getting_hit=!1:J=(0,d.sprite_get_animation)(H,11)),e.type){case t.PL_SONIC:break;case t.PL_TAILS:if(e.flight_timer+=G,I&&90!=I.brick_ref.angle&&270!=I.brick_ref.angle&&(e.flying=!1,e.flight_timer=0),(F.is_jumping&&F.speed.y>-F.jump_strength/3&&!$&&!e.getting_hit||e.flying)&&(0,s.input_button_pressed)(F.input,s.IB_FIRE1)&&!e.getting_hit&&e.flight_timer<t.TAILS_MAX_FLIGHT&&(e.flying||(e.flight_timer=0),F.speed.y=.1*-(0,v.level_gravity)(),e.flying=!0,F.is_jumping=!1,e.is_fire_jumping=!1),e.flying){if(J=(0,d.sprite_get_animation)(H,F.carrying?16:20),F.speed.x=(0,m.clip)(F.speed.x,-F.maxspeed/2,F.maxspeed/2),e.flight_timer>=t.TAILS_MAX_FLIGHT){var Ae=(0,c.soundfactory_get)("tired of flying");(0,_.sound_is_playing)(Ae)||(0,_.sound_play)(Ae),J=(0,d.sprite_get_animation)(H,19)}else for(Ae=void 0,ue=void 0,L(e)&&(F.angle=0),Ae=(0,c.soundfactory_get)("flying"),(0,_.sound_is_playing)(Ae)||(0,_.sound_play)(Ae),ue=0;ue<n.length&&null==F.carrying;ue++)if(n[ue]!=e&&F.speed.y<=0){var Be=[n[ue].actor.position.x+.3*(0,a.actor_image)(n[ue].actor).width,n[ue].actor.position.y,n[ue].actor.position.x+.7*(0,a.actor_image)(n[ue].actor).width,n[ue].actor.position.y+.2*(0,a.actor_image)(n[ue].actor).height],Me=[F.position.x+.3*(0,a.actor_image)(F).width,F.position.y+.7*(0,a.actor_image)(F).height,F.position.x+.7*(0,a.actor_image)(F).width,F.position.y+(0,a.actor_image)(F).height],Ce=(0,m.bounding_box)(Be,Me),Fe=!(null!=n[ue].actor.carried_by||n[ue].dying||n[ue].dead||n[ue].climbing||n[ue].landing||n[ue].getting_hit);Ce&&Fe&&!I&&(F.carrying=n[ue].actor,n[ue].actor.carried_by=F,n[ue].spin=n[ue].spin_dash=n[ue].braking=n[ue].flying=n[ue].spring=n[ue].on_moveable_platform=!1,(0,_.sound_play)((0,c.soundfactory_get)("touch the wall")))}}else F.animation==(0,d.sprite_get_animation)(H,F.carrying?16:20)&&(J=(0,d.sprite_get_animation)(H,1));break;case t.PL_KNUCKLES:if((F.is_jumping&&F.speed.y>-.7*F.jump_strength||e.flying)&&(0,s.input_button_pressed)(F.input,s.IB_FIRE1)&&!I&&!e.getting_hit&&(F.speed.y=50,e.flying=!0,F.is_jumping=!1,e.is_fire_jumping=!1,F.speed.x=F.mirror&g.IF_HFLIP?Math.min(-100,F.speed.x):Math.max(100,F.speed.x)),e.flying){var He=(0,s.input_button_down)(F.input,s.IB_LEFT)&&F.speed.x>0||(0,s.input_button_down)(F.input,s.IB_RIGHT)&&F.speed.x,Ge=I&&Math.abs(I.brick_ref.angle*g.PI/180-0)<g.EPSILON;if(He=F.animation==(0,d.sprite_get_animation)(H,21)&&!(0,a.actor_animation_finished)(F),Ge||F.animation==(0,d.sprite_get_animation)(H,19)||e.landing||(F.mirror&g.IF_HFLIP?(J=(0,d.sprite_get_animation)(H,He?21:20),F.speed.x=Math.max(F.speed.x-.5*F.acceleration*G,-W/2)):(J=(0,d.sprite_get_animation)(H,He?21:20),F.speed.x=Math.min(F.speed.x+.5*F.acceleration*G,W/2))),Ge)e.landing=!0,F.is_jumping=!1,J=(0,d.sprite_get_animation)(H,19),F.speed.y=0,K.y=0,e.climbing=!1;else if((0,s.input_button_up)(F.input,s.IB_FIRE1))e.flying=!1,J=(0,d.sprite_get_animation)(H,18);else{var Ue=void 0,Ve=[S,R,x,O,I];for(Ue=0;Ue<Ve.length;Ue++)(N=Ve[Ue])&&N.brick_ref.angle%90!=0&&(e.flying=!1,e.landing=!1)}Ge||E||(S&&S.brick_ref.angle%90==0||x&&x.brick_ref.angle%90==0)&&(e.climbing=!0,e.flying=!1,(0,_.sound_play)((0,c.soundfactory_get)("touch the ground")))}if(e.landing&&(Math.abs(F.speed.x)<g.EPSILON||!I)&&(e.flying=e.landing=!1),e.climbing){var Ye=(0,f.v2d_new)(0,0);if(F.speed.x=K.x=0,S&&!x&&(F.mirror|=g.IF_HFLIP),x&&!S&&(F.mirror&=~g.IF_HFLIP),Ye=(0,f.v2d_add)(Ye,(0,f.v2d_multiply)((0,v.level_brick_move_actor)(S,F),G)),((Ye=(0,f.v2d_add)(Ye,(0,f.v2d_multiply)((0,v.level_brick_move_actor)(x,F),G))).y<=0&&!E||Ye.y>=0&&!I||!S&&x)&&(K=(0,f.v2d_add)(K,Ye)),S||x)if((0,s.input_button_pressed)(F.input,s.IB_FIRE1)){var We=(0,d.sprite_get_animation)(H,17),Ke=(0,d.sprite_get_animation)(H,22);F.animation!=We&&F.animation!=Ke||(e.climbing=!1,F.is_jumping=!0,e.is_fire_jumping=!0,F.speed.x=.7*(F.mirror&g.IF_HFLIP?1:-1)*F.jump_strength,F.speed.y=-.5*F.jump_strength,S&&!x&&(F.mirror&=~g.IF_HFLIP),!S&&x&&(F.mirror|=g.IF_HFLIP),J=(0,d.sprite_get_animation)(H,3),(0,_.sound_play)((0,c.soundfactory_get)("jump")))}else(0,s.input_button_down)(F.input,s.IB_UP)?E||(K.y=.1*-W*G,J=(0,d.sprite_get_animation)(H,17)):(0,s.input_button_down)(F.input,s.IB_DOWN)?I?e.climbing=!1:(K.y=.1*W*G,J=(0,d.sprite_get_animation)(H,17)):J=(0,d.sprite_get_animation)(H,22);else(N=F.mirror&g.IF_HFLIP?R:O)?(J=(0,d.sprite_get_animation)(H,23),F.ignore_horizontal=!0,K=(0,f.v2d_add)(K,(0,f.v2d_multiply)((0,v.level_brick_move_actor)(N,F),G)),(0,a.actor_animation_finished)(F)&&(e.climbing=!1,F.ignore_horizontal=!1,F.speed=(0,f.v2d_new)((F.mirror&g.IF_HFLIP?-1:1)*W*.15,-(0,v.level_gravity)()/12.5),K.x=5*(F.mirror&g.IF_HFLIP?-1:1))):(e.climbing=!1,F.is_jumping=!0,J=(0,d.sprite_get_animation)(H,3))}}return e.at_some_border=!1,J&&(0,a.actor_change_animation)(F,J),Math.abs(F.speed.x)<4&&(e.braking=!1,(!(0,s.input_button_down)(F.input,s.IB_RIGHT)&&!(0,s.input_button_down)(F.input,s.IB_LEFT)||(0,s.input_button_down)(F.input,s.IB_RIGHT)&&(0,s.input_button_down)(F.input,s.IB_LEFT)||e.spin||e.landing)&&(K.x=0,F.speed.x=0)),K.x+=(0,v.level_brick_move_actor)(I,F).x*G,K.x=F.position.x<=F.hot_spot.x&&F.speed.x<0?0:K.x,K.x=F.position.x>=(0,v.level_size)().x-((0,a.actor_image)(F).width-F.hot_spot.x)&&F.speed.x>0?0:K.x,K},t.player_hit=function(e){var n,o,s=e.actor,d=!1;if(!e.blinking&&!e.dying&&!e.invincible)if(S(e),e.shield_type!=t.SH_NONE)d=!0,e.shield_type=t.SH_NONE,(0,_.sound_play)((0,c.soundfactory_get)("death"));else if(h>0){for(d=!0,o=0;o<Math.min((0,t.player_get_rings)(),15);o++)n=(0,v.level_create_item)(r.IT_RING,s.position),(0,i.ring_start_bouncing)(n);(0,t.player_set_rings)(0),(0,_.sound_play)((0,c.soundfactory_get)("ringless"))}else(0,t.player_kill)(e);d&&(e.getting_hit=!0,e.flying=e.landing=e.climbing=e.spring=!1,e.is_fire_jumping=!1,e.spin_dash=e.spin=!1,e.blinking=!0,e.blink_timer=0,s.speed.x=s.mirror&g.IF_HFLIP?200:-200,s.speed.y=-.75*s.jump_strength,(0,a.actor_move)(s,(0,f.v2d_new)(0,-5)))},t.player_kill=function(e){e.dying||(S(e),e.shield_type=t.SH_NONE,e.invincible=!1,e.got_speedshoes=!1,e.dying=!0,e.death_timer=0,e.spring=!1,e.actor.speed.y=1.2*-e.actor.jump_strength,e.flying=e.climbing=e.landing=!1,e.is_fire_jumping=!1,e.spin=e.spin_dash=!1,e.blinking=!1,(0,_.sound_play)((0,c.soundfactory_get)("death")))},t.player_bounce=function(e){(0,s.input_simulate_button_down)(e.actor.input,s.IB_FIRE1),e.spring=!1,e.actor.speed.y=-e.actor.jump_strength,e.actor.is_jumping=!0,e.is_fire_jumping=!1,e.flying=!1},t.player_attacking=function(e){var n=(0,d.sprite_get_animation)(y(e.type),3);return e.spin||e.spin_dash||e.actor.animation==n||e.type==t.PL_KNUCKLES&&(e.landing||e.flying)},t.player_get_rings=function(){return h},t.player_get_lives=function(){return E},t.player_get_score=function(){return I},t.player_get_sprite_name=function(e){return y(e.type)},t.player_set_rings=function(e){h=(0,m.clip)(e,0,9999),e/100>=b&&(b+=1,(0,t.player_set_lives)((0,t.player_get_lives)()+1),(0,v.level_override_music)((0,c.soundfactory_get)("1up")))},t.player_set_lives=function(e){E=e},t.player_set_score=function(e){I=e};var y=function(e){switch(e){case t.PL_SONIC:return"SD_SONIC";case t.PL_TAILS:return"SD_TAILS";case t.PL_KNUCKLES:return"SD_KNUCKLES";default:return"null"}},x=function(e){if(e&&e.actor){var n=0,o=e.actor.mirror&g.IF_HFLIP,r=!0,i=(0,m.old_school_angle)(e.actor.angle),_=(0,f.v2d_new)(0,0),c=(0,f.v2d_subtract)(e.actor.position,(0,f.v2d_rotate)((0,f.v2d_new)(0,e.actor.hot_spot.y),-i)),s=e.actor.animation;switch(e.type){case t.PL_SONIC:if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),0))_=(0,f.v2d_new)(3,24),n=1;else if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),1))switch(~~e.actor.animation_frame){case 0:n=2,_=(0,f.v2d_new)(5,23);break;case 1:n=2,_=(0,f.v2d_new)(4,25);break;case 2:n=1,_=(0,f.v2d_new)(7,25);break;case 3:case 4:n=1,_=(0,f.v2d_new)(5,23);break;case 5:n=1,_=(0,f.v2d_new)(4,24);break;case 6:n=2,_=(0,f.v2d_new)(6,24);break;case 7:n=2,_=(0,f.v2d_new)(6,23)}else if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),2))n=1,_=(0,f.v2d_new)(8,26);else if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),5))n=3,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(0,19):(0,f.v2d_new)(-1,21);else if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),7))n=1,_=~~e.actor.animation_frame<2?(0,f.v2d_new)(8,26):(0,f.v2d_new)(10,28);else if(s==(0,d.sprite_get_animation)(y(t.PL_SONIC),10))switch(n=1,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(1,22);break;case 1:_=(0,f.v2d_new)(-1,23);break;case 2:_=(0,f.v2d_new)(1,23)}else s==(0,d.sprite_get_animation)(y(t.PL_SONIC),11)?(n=3,_=(0,f.v2d_new)(-4,30)):s==(0,d.sprite_get_animation)(y(t.PL_SONIC),12)?(n=3,_=(0,f.v2d_new)(1,19)):s==(0,d.sprite_get_animation)(y(t.PL_SONIC),13)?(n=3,_=(0,f.v2d_new)(4,13)):s==(0,d.sprite_get_animation)(y(t.PL_SONIC),14)?(n=1,_=(0,f.v2d_new)(12,31)):s==(0,d.sprite_get_animation)(y(t.PL_SONIC),15)?(n=0,_=(0,f.v2d_new)(3,23)):s==(0,d.sprite_get_animation)(y(t.PL_SONIC),25)?(n=0,_=(0,f.v2d_new)(3,22)):r=!1;break;case t.PL_TAILS:if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),0))_=(0,f.v2d_new)(5,34),n=1;else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),1))switch(n=2,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(2,33);break;case 1:case 5:_=(0,f.v2d_new)(3,33);break;case 2:_=(0,f.v2d_new)(8,33);break;case 3:case 7:_=(0,f.v2d_new)(3,32);break;case 4:_=(0,f.v2d_new)(1,33);break;case 6:_=(0,f.v2d_new)(7,33)}else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),2))n=2,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(7,35):(0,f.v2d_new)(6,34);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),4))n=1,_=(0,f.v2d_new)(9,44);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),5))n=1,_=(0,f.v2d_new)(7,32);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),7))n=1,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(2,33):(0,f.v2d_new)(4,33);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),10))switch(n=4,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(5,33);break;case 1:_=(0,f.v2d_new)(6,33)}else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),11))n=1,_=(0,f.v2d_new)(1,33);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),12))n=1,_=(0,f.v2d_new)(6,28);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),13))n=3,_=(0,f.v2d_new)(2,17);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),14))n=1,_=(0,f.v2d_new)(9,35);else if(s==(0,d.sprite_get_animation)(y(t.PL_TAILS),15))switch(n=4,~~e.actor.animation_frame){case 0:case 8:case 9:case 10:_=(0,f.v2d_new)(5,34);break;default:_=(0,f.v2d_new)(5,33)}else s==(0,d.sprite_get_animation)(y(t.PL_TAILS),16)?(n=1,_=(0,f.v2d_new)(8,37)):s==(0,d.sprite_get_animation)(y(t.PL_TAILS),19)?(n=1,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(9,39):(0,f.v2d_new)(9,40)):s==(0,d.sprite_get_animation)(y(t.PL_TAILS),20)?(n=1,_=(0,f.v2d_new)(8,39)):s==(0,d.sprite_get_animation)(y(t.PL_TAILS),25)?(n=1,_=(0,f.v2d_new)(0,23)):r=!1;break;case t.PL_KNUCKLES:if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),0))n=1,_=(0,f.v2d_new)(1,24);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),1))switch(~~e.actor.animation_frame){case 0:n=1,_=(0,f.v2d_new)(5,29);break;case 1:n=2,_=(0,f.v2d_new)(5,29);break;case 2:n=2,_=(0,f.v2d_new)(8,29);break;case 3:n=2,_=(0,f.v2d_new)(9,28);break;case 4:n=1,_=(0,f.v2d_new)(6,28);break;case 5:n=1,_=(0,f.v2d_new)(6,29);break;case 6:n=1,_=(0,f.v2d_new)(5,28);break;case 7:n=1,_=(0,f.v2d_new)(4,27)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),2))n=1,_=(0,f.v2d_new)(7,29);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),4))n=1,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(0,31):(0,f.v2d_new)(0,40);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),5))n=1,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(0,21):(0,f.v2d_new)(-1,21);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),7))n=0,_=(0,f.v2d_new)(-2,27);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),10))switch(n=1,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(9,30);break;case 1:_=(0,f.v2d_new)(8,27)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),11))n=1,_=(0,f.v2d_new)(-3,27);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),12))n=1,_=(0,f.v2d_new)(5,24);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),13))n=3,_=(0,f.v2d_new)(-1,16);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),14))switch(~~e.actor.animation_frame){case 0:n=1,_=(0,f.v2d_new)(5,29);break;case 1:n=2,_=(0,f.v2d_new)(5,29);break;case 2:n=2,_=(0,f.v2d_new)(8,29);break;case 3:n=2,_=(0,f.v2d_new)(9,28);break;case 4:n=1,_=(0,f.v2d_new)(6,28);break;case 5:n=1,_=(0,f.v2d_new)(6,29);break;case 6:n=1,_=(0,f.v2d_new)(5,28);break;case 7:n=1,_=(0,f.v2d_new)(4,27)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),15))n=0,_=(0,f.v2d_new)(1,23);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),16))switch(n=1,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(6,23);break;case 1:_=(0,f.v2d_new)(5,20);break;case 2:_=(0,f.v2d_new)(0,22)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),17))switch(n=3,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(-1,22);break;case 1:_=(0,f.v2d_new)(-2,20);break;case 2:_=(0,f.v2d_new)(0,21);break;case 3:_=(0,f.v2d_new)(-1,24);break;case 4:_=(0,f.v2d_new)(0,23);break;case 5:_=(0,f.v2d_new)(0,22)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),18))n=1,_=0==~~e.actor.animation_frame?(0,f.v2d_new)(6,23):(0,f.v2d_new)(5,20);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),19))n=1,_=(0,f.v2d_new)(8,44);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),20))n=1,_=(0,f.v2d_new)(8,39);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),21))switch(n=4,~~e.actor.animation_frame){case 0:_=(0,f.v2d_new)(-8,41);break;case 1:_=(0,f.v2d_new)(0,43);break;case 2:_=(0,f.v2d_new)(10,41)}else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),22))n=3,_=(0,f.v2d_new)(0,22);else if(s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),23))switch(~~e.actor.animation_frame){case 0:n=3,_=(0,f.v2d_new)(7,17);break;case 1:n=3,_=(0,f.v2d_new)(11,15);break;case 2:n=0,_=(0,f.v2d_new)(12,13)}else s==(0,d.sprite_get_animation)(y(t.PL_KNUCKLES),25)?(n=0,_=(0,f.v2d_new)(0,23)):r=!1}return _.x*=o?-1:1,(0,a.actor_change_animation)(e.glasses,(0,d.sprite_get_animation)("SD_GLASSES",n)),e.glasses.position=(0,f.v2d_add)(c,(0,f.v2d_rotate)(_,-i)),e.glasses.angle=i,e.glasses.mirror=e.actor.mirror,e.glasses.visible=r&&e.actor.visible,e}},S=function(e){},w=function(e){var n=e.shield,o=e.actor,r=(0,f.v2d_new)(0,0);switch(e.shield_type){case t.SH_SHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_SHIELD",0));break;case t.SH_FIRESHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_FIRESHIELD",0));break;case t.SH_THUNDERSHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_THUNDERSHIELD",0));break;case t.SH_WATERSHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_WATERSHIELD",0));break;case t.SH_ACIDSHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_ACIDSHIELD",0));break;case t.SH_WINDSHIELD:r=(0,f.v2d_new)(0,-22),n.position=(0,f.v2d_add)(o.position,(0,f.v2d_rotate)(r,-(0,m.old_school_angle)(o.angle))),(0,a.actor_change_animation)(n,(0,d.sprite_get_animation)("SD_WINDSHIELD",0))}},L=function(e){return e.disable_wall!==t.PLAYER_WALL_NONE}},5858:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.confirmbox_selected_option=t.confirmbox_alert=t.confirmbox_release=t.confirmbox_render=t.confirmbox_update=t.confirmbox_init=void 0;var a=n(2878),o=n(4163),r=n(642),i=n(7709),_=n(9880),c=n(7774),s=n(9931),d=n(2667),l=n(4470),u=n(3031),p=n(2530),f=null,g=null,m=null,v=[],h=null,b=null,E=[],I=0,y=-1,x=!1,S=!1,w=null;t.confirmbox_init=function(){var e;for(f=(0,_.sprite_get_image)((0,_.sprite_get_animation)("SD_CONFIRMBOX",0),0),g=(0,a.v2d_new)((r.VIDEO_SCREEN_W-f.width)/2,r.VIDEO_SCREEN_H),w=(0,c.input_create_user)(),h=(0,u.actor_create)(),h=(0,u.actor_change_animation)(h,(0,_.sprite_get_animation)("SD_TITLEFOOT",0)),m=(0,p.font_create)(8),(0,p.font_set_text)(m,b),(0,p.font_set_width)(m,164),e=0;e<I;e++)v[e]=[],v[e][0]=(0,p.font_create)(8),v[e][1]=(0,p.font_create)(8),(0,p.font_set_text)(v[e][0],E[e]),(0,p.font_set_text)(v[e][1],"<color=ffff00>%s</color>",E[e]);y=0,x=!0,S=!1},t.confirmbox_update=function(){var e,t=(0,o.timer_get_delta)(),n=5*r.VIDEO_SCREEN_H;if(x&&(g.y<=(r.VIDEO_SCREEN_H-f.height)/2?x=!1:g.y-=n*t),S){if(g.y>=r.VIDEO_SCREEN_H)return S=!1,void(0,d.scenestack_pop)();g.y+=n*t}for(h.position=(0,a.v2d_new)(g.x+y*f.width/I+10,g.y+.75*f.height-1),m.position=(0,a.v2d_new)(g.x+10,g.y+10),e=0;e<I;e++)v[e][0].position=(0,a.v2d_new)(g.x+e*f.width/I+25,g.y+.75*f.height),v[e][1].position=v[e][0].position;x||S||((0,c.input_button_pressed)(w,c.IB_LEFT)?((0,s.sound_play)((0,l.soundfactory_get)("choose")),y=((y-1)%I+I)%I):(0,c.input_button_pressed)(w,c.IB_RIGHT)?((0,s.sound_play)((0,l.soundfactory_get)("choose")),y=(y+1)%I):((0,c.input_button_pressed)(w,c.IB_FIRE1)||(0,c.input_button_pressed)(w,c.IB_FIRE3))&&((0,s.sound_play)((0,l.soundfactory_get)("select")),S=!0))},t.confirmbox_render=function(){var e,t,n=(0,a.v2d_new)(r.VIDEO_SCREEN_W/2,r.VIDEO_SCREEN_H/2);for((0,r.video_clearDisplay)(),(0,r.video_get_backbuffer)().drawImage(f.data,f.sx,f.sy,f.swidth,f.sheight,g.x,g.y,f.swidth,f.sheight),(0,p.font_render)(m,n),e=0;e<I;e++)t=e==y?1:0,(0,p.font_render)(v[e][t],n);(0,u.actor_render)(h,n)},t.confirmbox_release=function(){(0,u.actor_destroy)(h),(0,c.input_destroy)(w),(0,p.font_destroy)(m),(0,i.image_destroy)(null)},t.confirmbox_alert=function(e,t,n){y=-1,b=e,E[0]=t,n?(E[1]=n,I=2):I=1},t.confirmbox_selected_option=function(){if(-1!=y){var e=y+1;return y=-1,e}return 0}},2930:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.credits_release=t.credits_render=t.credits_update=t.credits_init=void 0;var a=n(2878),o=n(642),r=n(9931),i=n(6038),_=n(7774),c=n(7709),s=n(4163),d=n(2667),l=n(4470),u=n(2530),p=n(3339),f=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],g=null,m=!1,v=null,h=null,b=null,E=null,I=0,y=null;t.credits_init=function(){m=!1,E=(0,_.input_create_user)(),v=(0,u.font_create)(4),(0,u.font_set_text)(v,(0,i.lang_get)("CREDITS_TITLE")),v.position.x=o.VIDEO_SCREEN_W/2-100,v.position.y=5,b=(0,u.font_create)(8),(0,u.font_set_text)(b,(0,i.lang_get)("CREDITS_KEY")),b.position.x=10,b.position.y=o.VIDEO_SCREEN_H-(0,u.font_get_charsize)(b).y-5,h=(0,u.font_create)(8);for(var e=0;e<f.length;e++){var t=f[e],n=t.match(/\$[A-Z_\d]\w+/m);if(n){for(var a=0;a<n.length;a++){var r=n[a].slice(1),s=(0,i.lang_get)(r);s&&(t=t.replace("$"+r,s))}f[e]=t}}(0,u.font_set_text)(h,f.join(""),"%s"),(0,u.font_set_width)(h,300),h.position.x=10,h.position.y=o.VIDEO_SCREEN_H,I=1;var d=(0,u.font_get_text)(h);for(e=0;e<d.length;e++)"\n"==d[e]&&I++;I+=10,g=(0,c.image_create)(o.VIDEO_SCREEN_W,30),(0,p.background_load)("data/themes/credits.bg.json").then((function(e){y=e,(0,o.video_fadefx_in)((0,c.image_rgb)(0,0,0),1)})),(0,o.video_fadefx_in)((0,c.image_rgb)(0,0,0),1)},t.credits_update=function(){var e=(0,s.timer_get_delta)();if((0,p.background_update)(y),h.position.y-=3*(0,u.font_get_charsize)(h).y*e,h.position.y<-I*((0,u.font_get_charsize)(h).y+(0,u.font_get_charspacing)(h).y)&&(h.position.y=o.VIDEO_SCREEN_H),m||(0,o.video_fadefx_is_fading)()||((0,_.input_button_pressed)(E,_.IB_FIRE3)?((0,r.sound_play)((0,l.soundfactory_get)("select")),m=!0):(0,_.input_button_pressed)(E,_.IB_FIRE4)&&((0,r.sound_play)((0,l.soundfactory_get)("return")),m=!0)),!(0,r.music_is_playing)()){var t=(0,r.music_load)("data/music/options.mp4");(0,r.music_play)(t,!0)}if(m){if((0,o.video_fadefx_over)())return void(0,d.scenestack_pop)();(0,o.video_fadefx_out)((0,c.image_rgb)(0,0,0),1)}},t.credits_render=function(){(0,o.video_clearDisplay)();var e=(0,a.v2d_new)(o.VIDEO_SCREEN_W/2,o.VIDEO_SCREEN_H/2);(0,p.background_render_bg)(y,e),(0,p.background_render_fg)(y,e),(0,u.font_render)(h,e),(0,o.video_get_backbuffer)().fillRect(0,0,g.width,g.height),(0,o.video_get_backbuffer)().fillRect(0,o.VIDEO_SCREEN_H-20,g.width,g.height),(0,u.font_render)(v,e),(0,u.font_render)(b,e)},t.credits_release=function(){y=(0,p.background_unload)(y),(0,c.image_destroy)(g),(0,u.font_destroy)(v),(0,u.font_destroy)(h),(0,u.font_destroy)(b),(0,_.input_destroy)(E)}},2318:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.endofdemo_release=t.endofdemo_render=t.endofdemo_update=t.endofdemo_init=void 0;var a=n(9386),o=n(2878),r=n(642),i=n(7709),_=n(9880),c=n(6038),s=n(4163),d=n(2667),l=n(532),u=n(2530),p=n(3031),f=10,g=0,m=null,v=null,h=[];t.endofdemo_init=function(){var e;for(g=(0,s.timer_get_ticks)(),(m=(0,u.font_create)(8)).position=(0,o.v2d_new)(5,35),v=(0,u.font_create)(4),(0,u.font_set_text)(v,(0,c.lang_get)("ENDOFDEMO_TITLE")),v.position=(0,o.v2d_new)((r.VIDEO_SCREEN_W-(0,u.font_get_charsize)(v).x*(0,u.font_get_text)(v).length)/2,5),e=0;e<f;e++)h[e]=(0,p.actor_create)(),h[e].spawn_point=h[e].position=(0,o.v2d_new)(r.VIDEO_SCREEN_W*e/f+15,215),(0,p.actor_change_animation)(h[e],(0,_.sprite_get_animation)(e%2==1?"SD_BLUERING":"SD_RING",0));(0,r.video_fadefx_in)((0,i.image_rgb)(0,0,0),2)},t.endofdemo_update=function(){var e,t=(0,s.timer_get_ticks)(),n=Math.max(0,(3-(t-g))/1e3);if((0,u.font_set_text)(m,(0,c.lang_get)("ENDOFDEMO_TEXT"),a.GAME_TITLE,a.GAME_WEBSITE,n),t>=g+3){if((0,r.video_fadefx_over)())return(0,d.scenestack_pop)(),void(0,d.scenestack_push)((0,l.storyboard_get_scene)(l.SCENE_QUESTOVER));(0,r.video_fadefx_out)((0,i.image_rgb)(0,0,0),2)}for(e=0;e<f;e++)h[e].position.y=h[e].spawn_point.y+10*Math.sin(a.PI*(.001*t)+2*a.PI/f*e)},t.endofdemo_render=function(){var e,t=(0,o.v2d_new)(r.VIDEO_SCREEN_W/2,r.VIDEO_SCREEN_H/2);for((0,r.video_clearDisplay)(),e=0;e<f;e++)(0,p.actor_render)(h[e],t);(0,u.font_render)(v,t),(0,u.font_render)(m,t)},t.endofdemo_release=function(){var e;for(e=0;e<f;e++)(0,p.actor_destroy)(h[e]);(0,u.font_destroy)(v),(0,u.font_destroy)(m)}},6698:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.gameover_release=t.gameover_render=t.gameover_update=t.gameover_init=void 0;var a=n(2878),o=n(2667),r=n(7709),i=n(642),_=n(4163),c=n(7307),s=n(2530),d=[],l=0;t.gameover_init=function(){l=0,d[0]=(0,s.font_create)(7),d[0].position=(0,a.v2d_new)(-50,112),(0,s.font_set_text)(d[0],"GAME"),d[1]=(0,s.font_create)(7),d[1].position=(0,a.v2d_new)(298,112),(0,s.font_set_text)(d[1],"OVER")},t.gameover_update=function(){var e=(0,_.timer_get_delta)();if((l+=e)>5){if((0,i.video_fadefx_over)())return(0,c.quest_abort)(),void(0,o.scenestack_pop)();(0,i.video_fadefx_out)((0,r.image_rgb)(0,0,0),2)}d[0].position.x+=200*e,d[0].position.x>80&&(d[0].position.x=80),d[1].position.x-=200*e,d[1].position.x<168&&(d[1].position.x=168)},t.gameover_render=function(){(0,i.video_clearDisplay)();var e=(0,a.v2d_new)(i.VIDEO_SCREEN_W/2,i.VIDEO_SCREEN_H/2);(0,s.font_render)(d[0],e),(0,s.font_render)(d[1],e)},t.gameover_release=function(){(0,r.image_destroy)(null),(0,s.font_destroy)(d[1]),(0,s.font_destroy)(d[0]),(0,c.quest_abort)()}},2342:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.intro_release=t.intro_render=t.intro_update=t.intro_init=void 0;var a=n(2878),o=n(4163),r=n(2667),i=n(532),_=n(642),c=n(7709),s=n(3339),d=0,l=null;t.intro_init=function(){d=0,(0,s.background_load)("data/themes/intro.bg.json").then((function(e){l=e,(0,_.video_fadefx_in)((0,c.image_rgb)(0,0,0),1)}))},t.intro_update=function(){if(l&&(d+=(0,o.timer_get_delta)(),(0,s.background_update)(l),d>=3)){if((0,_.video_fadefx_over)())return(0,r.scenestack_pop)(),void(0,r.scenestack_push)((0,i.storyboard_get_scene)(i.SCENE_MENU));(0,_.video_fadefx_out)((0,c.image_rgb)(0,0,0),1)}},t.intro_render=function(){if(l){var e=(0,a.v2d_new)(_.VIDEO_SCREEN_W/2,_.VIDEO_SCREEN_H/2);(0,s.background_render_bg)(l,e),(0,s.background_render_fg)(l,e)}},t.intro_release=function(){l=null}},5316:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.langselect_release=t.langselect_render=t.langselect_update=t.langselect_init=void 0;var a=n(9386),o=n(2878),r=n(2667),i=n(5286),_=n(7898),c=n(642),s=n(7709),d=n(9880),l=n(9931),u=n(6038),p=n(7774),f=n(4163),g=n(3450),m=n(4470),v=n(2530),h=n(3031),b=n(3339),E=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],I=1,y=1,x=!1,S=0,w=[],L=[],O=null,R=null,T=0,N=null,k=null,P=0,D=null;t.langselect_init=function(){T=0,x=!1,P=0,k=(0,p.input_create_user)(),O=(0,v.font_create)(8),w[0]=(0,v.font_create)(4),(0,v.font_set_text)(w[0],"SELECT YOUR"),w[0].position.x=(c.VIDEO_SCREEN_W-(0,v.font_get_text)(w[0]).length*(0,v.font_get_charsize)(w[0]).x)/2-140,w[0].position.y=10,w[1]=(0,v.font_create)(4),(0,v.font_set_text)(w[1],"LANGUAGE"),w[1].position.x=(c.VIDEO_SCREEN_W-(0,v.font_get_text)(w[1]).length*(0,v.font_get_charsize)(w[1]).x)/2-120,w[1].position.y=w[0].position.y+(0,v.font_get_charsize)(w[1]).y+10+10,w[2]=(0,v.font_create)(8),(0,v.font_set_text)(w[2],(0,u.lang_get)("MENU_CQ_BACK")),w[2].position.x=10,w[2].position.y=c.VIDEO_SCREEN_H-1.5*(0,v.font_get_charsize)(w[2]).y,(0,b.background_load)("data/themes/langselect.bg.json").then((function(e){D=e,(0,c.video_fadefx_in)((0,s.image_rgb)(0,0,0),1)})),N=(0,h.actor_create)(),(0,h.actor_change_animation)(N,(0,d.sprite_get_animation)("SD_TITLEFOOT",0)),A(),(0,c.video_fadefx_in)((0,s.image_rgb)(0,0,0),1)},t.langselect_update=function(){var e=(0,f.timer_get_delta)();if(P+=e,(0,b.background_update)(D),N&&L.length&&(N.position=(0,o.v2d_new)(L[0][T].position.x,L[0][T].position.y),N.position.x-=15,N.position.x+=5*Math.cos(2*a.PI*P)),!x&&!(0,c.video_fadefx_is_fading)()){if((0,p.input_button_pressed)(k,p.IB_DOWN)&&(T=(T+1)%S,(0,l.sound_play)((0,m.soundfactory_get)("choose"))),(0,p.input_button_pressed)(k,p.IB_UP)&&(T=((T-1)%S+S)%S,(0,l.sound_play)((0,m.soundfactory_get)("choose"))),(0,p.input_button_pressed)(k,p.IB_FIRE1)||(0,p.input_button_pressed)(k,p.IB_FIRE3)){if(!R)return;var t=R[T].filepath;(0,_.logfile_message)("Loading language ".concat(R[T].title," ").concat(t)),(0,u.lang_loadfile)("data/languages/english.json"),(0,u.lang_loadfile)(t),j(t),(0,l.sound_play)((0,m.soundfactory_get)("select"))}(0,p.input_button_pressed)(k,p.IB_FIRE4)&&((0,l.sound_play)((0,m.soundfactory_get)("return")),x=!0)}if(I=Math.floor(1+T/8),y=Math.floor(1+Math.max(0,S-1)/8),(0,v.font_set_text)(O,"page %d/%d",I,y),O.position.x=c.VIDEO_SCREEN_W-(0,v.font_get_text)(O).length*(0,v.font_get_charsize)(O).x-10,O.position.y=c.VIDEO_SCREEN_H-(0,v.font_get_charsize)(O).y-3,!(0,l.music_is_playing)()){var n=(0,l.music_load)("data/music/options.mp4");(0,l.music_play)(n,!0)}if(x){if((0,c.video_fadefx_over)())return void(0,r.scenestack_pop)();(0,c.video_fadefx_out)((0,s.image_rgb)(0,0,0),1)}},t.langselect_render=function(){var e,t=(0,o.v2d_new)(c.VIDEO_SCREEN_W/2,c.VIDEO_SCREEN_H/2);for((0,c.video_clearDisplay)(),(0,b.background_render_bg)(D,t),(0,b.background_render_fg)(D,t),(0,v.font_render)(w[0],t),(0,v.font_render)(w[1],t),(0,v.font_render)(w[2],t),y>1&&(0,v.font_render)(O,t),e=8*(I-1);e<8*I;e++)E[e]&&L.length>1&&(0,v.font_render)(L[T==e?1:0][e],t);(0,h.actor_render)(N,t)},t.langselect_release=function(){B(),D=(0,b.background_unload)(D),(0,h.actor_destroy)(N),(0,v.font_destroy)(w[0]),(0,v.font_destroy)(w[1]),(0,v.font_destroy)(O),(0,p.input_destroy)(k)};var j=function(e){(0,i.preferences_set_language)(e)},A=function(){(0,_.logfile_message)("load_lang_list()"),(0,g.resourcemanager_getJsonFiles)(E).then((function(e){S=(R=e).length,L[0]=[],L[1]=[];for(var t=0;t<S;t++)R[t].filepath=E[t],L[0][t]=(0,v.font_create)(8),L[1][t]=(0,v.font_create)(8),(0,v.font_set_text)(L[0][t],R[t].LANG_LANGUAGE),(0,v.font_set_text)(L[1][t],R[t].LANG_LANGUAGE),L[0][t].position=(0,o.v2d_new)(25,75+t%8*20),L[1][t].position=(0,o.v2d_new)(25,75+t%8*20)}))},B=function(){var e;for((0,_.logfile_message)("unload_lang_list()"),e=0;e<S;e++)(0,v.font_destroy)(L[0][e]),(0,v.font_destroy)(L[1][e]);L[0]=null,L[1]=null,R=null,S=0}},9185:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.menu_release=t.menu_render=t.menu_update=t.menu_init=void 0;var a,o,r,i,_,c,s,d,l,u,p,f,g,m,v,h,b,E,I,y,x,S,w=n(7307),L=n(6093),O=n(2667),R=n(532),T=n(9386),N=n(2878),k=n(7774),P=n(642),D=n(7709),j=n(9931),A=n(4163),B=n(6038),M=n(4470),C=n(9880),F=n(3031),H=n(2530),G=n(3339),U=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],V=3,Y=[],W=[];t.menu_init=function(){b=!1,a=0,_=.001*(0,A.timer_get_ticks)(),c=!1,r=null,o=(0,k.input_create_user)(),(0,k.input_ignore)(o),X(),S=(0,j.music_load)("data/music/title.mp4"),(0,j.music_play)(S,!0),(0,G.background_load)("data/themes/menu.bg.json").then((function(e){i=e,(0,P.video_fadefx_in)((0,D.image_rgb)(0,0,0),1)})),p=!0,f=(0,F.actor_create)(),(0,F.actor_change_animation)(f,(0,C.sprite_get_animation)("SD_TITLESURGE",0)),f.position.x=(P.VIDEO_SCREEN_W-(0,F.actor_image)(f).width)/2+5,f.position.y=-15,g=(0,F.actor_create)(),(0,F.actor_change_animation)(g,(0,C.sprite_get_animation)("SD_TITLEBG",0)),g.position.x=(P.VIDEO_SCREEN_W-(0,F.actor_image)(g).width)/2,g.position.y=f.position.y+25,m=(0,F.actor_create)(),(0,F.actor_change_animation)(m,(0,C.sprite_get_animation)("SD_TITLEGAMENAME",0)),m.position.x=(P.VIDEO_SCREEN_W-(0,F.actor_image)(m).width)/2,m.position.y=f.position.y+(0,F.actor_image)(f).height-9,(v=(0,H.font_create)(8)).position=(0,N.v2d_new)(3,P.VIDEO_SCREEN_H-12),(0,H.font_set_text)(v,"%s",T.GAME_WEBSITE),(h=(0,H.font_create)(0)).position=(0,N.v2d_new)(P.VIDEO_SCREEN_W-75,3),(0,H.font_set_text)(h,"V%d.%d.%d",T.GAME_VERSION,T.GAME_SUB_VERSION,T.GAME_WIP_VERSION),d=0,u=(0,F.actor_create)(),(0,F.actor_change_animation)(u,(0,C.sprite_get_animation)("SD_TITLEFOOT",0)),(s=[])[0]=(0,B.lang_getstring)("MENU_1PGAME"),s[1]=(0,B.lang_getstring)("MENU_TUTORIAL"),s[2]=(0,B.lang_getstring)("MENU_CUSTOMQUESTS"),s[3]=(0,B.lang_getstring)("MENU_OPTIONS"),V=s.length,l=[];for(var e=0;e<2;e++)for(var t=0;t<V;t++)l[t]||(l[t]=[]),l[t][e]=(0,H.font_create)(e),l[t][e].position=(0,N.v2d_new)(P.VIDEO_SCREEN_W/2-(0,F.actor_image)(g).width/5,m.position.y+65+10*t),(0,H.font_set_text)(l[t][e],s[t]);Y[0]=(0,H.font_create)(8),Y[0].position=(0,N.v2d_new)(5,3),Y[1]=(0,H.font_create)(8),Y[1].position=(0,N.v2d_new)(5,P.VIDEO_SCREEN_H-13),(E=(0,H.font_create)(8)).position=(0,N.v2d_new)(5,170),(0,P.video_fadefx_in)((0,D.image_rgb)(0,0,0),1.5)},t.menu_update=function(){var e,t=.001*(0,A.timer_get_ticks)();if(null!=r&&(0,P.video_fadefx_over)())return(0,O.scenestack_pop)(),void(0,O.scenestack_push)(r);switch(t<=_+2?(0,k.input_ignore)(o):c||((0,k.input_restore)(o),c=!0),(0,G.background_update)(i),a){case 0:p&&(0,F.actor_animation_finished)(f)&&(p=!1,(0,F.actor_change_animation)(f,(0,C.sprite_get_animation)("SD_TITLESURGE",1)),(0,k.input_restore)(o)),m.visible=!p,u.position.x=l[d][0].position.x-20+3*Math.cos(2*T.PI*t),u.position.y=l[d][0].position.y,(0,k.input_button_pressed)(o,k.IB_UP)&&((0,j.sound_play)((0,M.soundfactory_get)("choose")),d--),(0,k.input_button_pressed)(o,k.IB_DOWN)&&((0,j.sound_play)((0,M.soundfactory_get)("choose")),d++),d=(d%V+V)%V,((0,k.input_button_pressed)(o,k.IB_FIRE1)||(0,k.input_button_pressed)(o,k.IB_FIRE3))&&((0,j.sound_play)((0,M.soundfactory_get)("select")),K(d));break;case 1:for((0,k.input_button_pressed)(o,k.IB_FIRE4)&&((0,j.sound_play)((0,M.soundfactory_get)("return")),a=0),e=0;e<y;e++)W[e].position=(0,N.v2d_new)(30,20+e%14*10),W[e].visible=z(e)==z(I);if(u.position.x=10,u.position.y=W[I].position.y,(0,k.input_button_pressed)(o,k.IB_UP)&&((0,j.sound_play)((0,M.soundfactory_get)("choose")),I--),(0,k.input_button_pressed)(o,k.IB_DOWN)&&((0,j.sound_play)((0,M.soundfactory_get)("choose")),I++),I=(I%y+y)%y,(0,H.font_set_text)(Y[0],(0,B.lang_get)("MENU_CQ_SELECT"),z(I),q()),(0,H.font_set_text)(Y[1],(0,B.lang_get)("MENU_CQ_BACK")),(0,H.font_set_text)(E,(0,B.lang_get)("MENU_CQ_INFO"),x[I].version,x[I].name,x[I].author,x[I].description),(0,k.input_button_pressed)(o,k.IB_FIRE1)||(0,k.input_button_pressed)(o,k.IB_FIRE3))return(0,j.sound_play)((0,M.soundfactory_get)("select")),void Q(x[I])}},t.menu_render=function(){var e,t=(0,N.v2d_new)(P.VIDEO_SCREEN_W/2,P.VIDEO_SCREEN_H/2);if((0,P.video_clearDisplay)(),!b||!(0,P.video_fadefx_over)())switch((0,G.background_render_bg)(i,t),(0,G.background_render_fg)(i,t),a){case 0:for(e=0;e<V;e++)(0,H.font_render)(l[e][e==d?1:0],t);(0,F.actor_render)(u,t),(0,H.font_render)(v,t),(0,H.font_render)(h,t),(0,F.actor_render)(g,t),p&&(0,P.video_clearDisplay)(),(0,F.actor_render)(f,t),(0,F.actor_render)(m,t);break;case 1:var n=x[I].image;for((0,H.font_render)(E,t),(0,D.image_blit)(n,(0,P.video_get_backbuffer)(),0,0,P.VIDEO_SCREEN_W-n.width-25,W[0].position.y,n.width,n.height),(0,H.font_render)(Y[0],t),(0,H.font_render)(Y[1],t),e=0;e<y;e++)(0,H.font_render)(W[e],t);(0,F.actor_render)(u,t)}},t.menu_release=function(){var e,t;for(S.pause(),(0,H.font_destroy)(v),(0,H.font_destroy)(h),e=0;e<2;e++)for(t=0;t<V;t++)(0,H.font_destroy)(l[t][e]);(0,F.actor_destroy)(g),(0,F.actor_destroy)(m),(0,F.actor_destroy)(f),(0,F.actor_destroy)(u),(0,k.input_destroy)(o)};var K=function(e){var t=U[0];switch(e){case 0:return void(0,L.quest_load)(t).then((function(e){Q(e)}));case 1:return void(0,L.quest_load)("data/quests/tutorial.json").then((function(e){Q(e)}));case 2:a=1,I=0;break;case 3:return r=(0,R.storyboard_get_scene)(R.SCENE_OPTIONS),void(0,P.video_fadefx_out)((0,D.image_rgb)(0,0,0),.5)}},X=function(){var e;for(y=U.length,x=[],e=0;e<y;e++)!function(t){(0,L.quest_load)(U[e]).then((function(e){W[t]=(0,H.font_create)(8),x[t]=e,(0,H.font_set_text)(W[t],e.name)}))}(e)},z=function(e){return Math.floor(e/14+1)},q=function(){return Math.floor(y/14+(y%14==0?0:1))},Q=function(e){(0,w.quest_run)(e,!1),r=(0,R.storyboard_get_scene)(R.SCENE_QUEST),(0,k.input_ignore)(o),(0,P.video_fadefx_out)((0,D.image_rgb)(0,0,0),.5)}},2833:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.options_release=t.options_render=t.options_update=t.options_init=void 0;var a,o,r,i,_,c,s,d,l,u,p=n(7319),f=n(9386),g=n(2667),m=n(532),v=n(5286),h=n(2878),b=n(642),E=n(7709),I=n(9931),y=n(4470),x=n(6038),S=n(7774),w=n(9880),L=n(4163),O=n(2530),R=n(3031),T=n(3339);t.options_init=function(){l=0,a=!1,s=0,_=(0,S.input_create_user)(),c=null,o=!0,r=(0,O.font_create)(4),(0,O.font_set_text)(r,(0,x.lang_get)("OPTIONS_TITLE")),r.position.x=b.VIDEO_SCREEN_W/2-100,r.position.y=10,(0,T.background_load)("data/themes/options.bg.json").then((function(e){d=e})),i=(0,R.actor_create)(),(0,R.actor_change_animation)(i,(0,w.sprite_get_animation)("SD_TITLEFOOT",0)),i.position=(0,h.v2d_new)(-50,-50),u=he(),(0,p.grouptree_init_all)(u)},t.options_update=function(){var e=(0,L.timer_get_delta)();if(s+=e,(0,O.font_set_text)(r,(0,x.lang_get)("OPTIONS_TITLE")),o&&((0,b.video_fadefx_in)((0,E.image_rgb)(0,0,0),1),o=!1),(0,T.background_update)(d),a||null!=c||(0,b.video_fadefx_is_fading)()||((0,S.input_button_pressed)(_,S.IB_DOWN)&&(l=(l+1)%5,(0,I.sound_play)((0,y.soundfactory_get)("choose"))),(0,S.input_button_pressed)(_,S.IB_UP)&&(l=((l-1)%5+5)%5,(0,I.sound_play)((0,y.soundfactory_get)("choose"))),(0,S.input_button_pressed)(_,S.IB_FIRE4)&&((0,I.sound_play)((0,y.soundfactory_get)("return")),a=!0)),(0,p.grouptree_update_all)(u),a)(0,b.video_fadefx_is_fading)()||(0,I.music_stop)();else if(!(0,I.music_is_playing)()&&s>=.2){var t=(0,I.music_load)("data/music/options.mp4");(0,I.music_play)(t,!0)}if(a){if((0,b.video_fadefx_over)())return N(),(0,g.scenestack_pop)(),void(0,g.scenestack_push)((0,m.storyboard_get_scene)(m.SCENE_MENU));(0,b.video_fadefx_out)((0,E.image_rgb)(0,0,0),1)}if(null!=c){if((0,b.video_fadefx_over)())return N(),(0,g.scenestack_push)(c),c=null,void(o=!0);(0,b.video_fadefx_out)((0,E.image_rgb)(0,0,0),1)}},t.options_render=function(){var e=(0,h.v2d_new)(b.VIDEO_SCREEN_W/2,b.VIDEO_SCREEN_H/2);(0,T.background_render_bg)(d,e),(0,T.background_render_fg)(d,e),(0,O.font_render)(r,e),(0,p.grouptree_render_all)(u,e),(0,R.actor_render)(i,e)},t.options_release=function(){(0,R.actor_destroy)(i),(0,O.font_destroy)(r),(0,S.input_destroy)(_)};var N=function(){(0,v.preferences_set_fullscreen)((0,b.video_is_fullscreen)()),(0,v.preferences_set_smooth_graphics)((0,b.video_is_smooth)()),(0,v.preferences_set_show_fps)((0,b.video_is_fps_visible)())},k=function(e,t){(0,p.grouptree_group_label_init)(e),e.data=t,(0,O.font_set_text)(e.font,(0,x.lang_get)(t))},P=function(e){e.data=null,(0,p.grouptree_group_label_release)(e)},D=function(e){(0,p.grouptree_group_label_update)(e),(0,O.font_set_text)(e.font,(0,x.lang_get)(e.data))},j=function(e,t){(0,p.grouptree_group_label_render)(e,t)},A=function(e,t,n){var a;(0,p.grouptree_group_label_init)(e),(0,O.font_set_text)(e.font,(0,x.lang_get)(t)),e.data={},(a=e.data).option_index=n,a.lang_key=t},B=function(e){e.data=null,(0,p.grouptree_group_label_release)(e)},M=function(e){var t=e.data;return l==t.option_index},C=function(e){var t=e.data;(0,p.grouptree_group_label_update)(e),(0,O.font_set_text)(e.font,(0,x.lang_get)(t.lang_key)),M(e)&&((0,O.font_set_text)(e.font,"<color=ffff00>%s</color>",(0,x.lang_get)(t.lang_key)),i.position=(0,h.v2d_add)(e.font.position,(0,h.v2d_new)(3*Math.cos(2*f.PI*s)-20,0)))},F=function(e,t){(0,p.grouptree_group_label_render)(e,t)},H=function(e){(0,p.grouptree_group_label_init)(e),(0,O.font_set_text)(e.font,""),e.font.position=(0,h.v2d_new)(0,25)},G=function(e){(0,p.grouptree_group_label_release)(e)},U=function(e){(0,p.grouptree_group_label_update)(e)},V=function(e,t){(0,p.grouptree_group_label_render)(e,t)},Y=function(e){k(e,"OPTIONS_GRAPHICS")},W=function(e){P(e)},K=function(e){D(e)},X=function(e,t){j(e,t)},z=function(e){A(e,"OPTIONS_FPS",0)},q=function(e){B(e)},Q=function(e){C(e),function(e){return M(e)}(e)&&((0,b.video_fadefx_is_fading)()||(((0,S.input_button_pressed)(_,S.IB_FIRE1)||(0,S.input_button_pressed)(_,S.IB_FIRE3))&&((0,I.sound_play)((0,y.soundfactory_get)("select")),(0,b.video_show_fps)(!(0,b.video_is_fps_visible)())),(0,S.input_button_pressed)(_,S.IB_RIGHT)&&(0,b.video_is_fps_visible)()&&((0,I.sound_play)((0,y.soundfactory_get)("select")),(0,b.video_show_fps)(!1)),(0,S.input_button_pressed)(_,S.IB_LEFT)&&((0,b.video_is_fps_visible)()||((0,I.sound_play)((0,y.soundfactory_get)("select")),(0,b.video_show_fps)(!0)))))},$=function(e,t){var n,a=[];F(e,t),(n=(0,O.font_create)(8)).position=(0,h.v2d_new)(175,e.font.position.y),a[0]=(0,x.lang_get)("OPTIONS_YES"),a[1]=(0,x.lang_get)("OPTIONS_NO"),(0,b.video_is_fps_visible)()?(0,O.font_set_text)(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):(0,O.font_set_text)(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),(0,O.font_render)(n,t),(0,O.font_destroy)(n)},J=function(e){k(e,"OPTIONS_GAME")},Z=function(e){P(e)},ee=function(e){D(e)},te=function(e,t){j(e,t)},ne=function(e){A(e,"OPTIONS_LANGUAGE",1)},ae=function(e){B(e)},oe=function(e){C(e),function(e){return M(e)}(e)&&((0,b.video_fadefx_is_fading)()||((0,S.input_button_pressed)(_,S.IB_FIRE1)||(0,S.input_button_pressed)(_,S.IB_FIRE3))&&((0,I.sound_play)((0,y.soundfactory_get)("select")),c=(0,m.storyboard_get_scene)(m.SCENE_LANGSELECT)))},re=function(e,t){F(e,t)},ie=function(e){A(e,"OPTIONS_STAGESELECT",2)},_e=function(e){B(e)},ce=function(e){C(e),function(e){return M(e)}(e)&&((0,b.video_fadefx_is_fading)()||((0,S.input_button_pressed)(_,S.IB_FIRE1)||(0,S.input_button_pressed)(_,S.IB_FIRE3))&&((0,I.sound_play)((0,y.soundfactory_get)("select")),c=(0,m.storyboard_get_scene)(m.SCENE_STAGESELECT)))},se=function(e,t){F(e,t)},de=function(e){A(e,"OPTIONS_CREDITS",3)},le=function(e){B(e)},ue=function(e){C(e),function(e){return M(e)}(e)&&((0,b.video_fadefx_is_fading)()||((0,S.input_button_pressed)(_,S.IB_FIRE1)||(0,S.input_button_pressed)(_,S.IB_FIRE3))&&((0,I.sound_play)((0,y.soundfactory_get)("select")),c=(0,m.storyboard_get_scene)(m.SCENE_CREDITS)))},pe=function(e,t){F(e,t)},fe=function(e){A(e,"OPTIONS_BACK",4)},ge=function(e){B(e)},me=function(e){C(e),function(e){return M(e)}(e)&&((0,b.video_fadefx_is_fading)()||((0,S.input_button_pressed)(_,S.IB_FIRE1)||(0,S.input_button_pressed)(_,S.IB_FIRE3))&&((0,I.sound_play)((0,y.soundfactory_get)("select")),a=!0))},ve=function(e,t){F(e,t)},he=function(){var e,t,n,a,o,r,i,_;return n=(0,p.grouptree_group_create)(z,q,Q,$),t=(0,p.grouptree_group_create)(Y,W,K,X),(0,p.grouptree_group_addchild)(t,n),o=(0,p.grouptree_group_create)(ne,ae,oe,re),r=(0,p.grouptree_group_create)(de,le,ue,pe),i=(0,p.grouptree_group_create)(ie,_e,ce,se),a=(0,p.grouptree_group_create)(J,Z,ee,te),(0,p.grouptree_group_addchild)(a,o),(0,p.grouptree_group_addchild)(a,i),(0,p.grouptree_group_addchild)(a,r),_=(0,p.grouptree_group_create)(fe,ge,me,ve),e=(0,p.grouptree_group_create)(H,G,U,V),(0,p.grouptree_group_addchild)(e,t),(0,p.grouptree_group_addchild)(e,a),(0,p.grouptree_group_addchild)(e,_),e}},3985:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.pause_release=t.pause_render=t.pause_update=t.pause_init=void 0;var a=n(5858),o=n(7307),r=n(9386),i=n(2667),_=n(532),c=n(2878),s=n(642),d=n(9931),l=n(7709),u=n(7774),p=n(6038),f=n(9880),g=n(4163),m=null,v=!1,h=!1,b=0;t.pause_init=function(){m=(0,u.input_create_user)(),v=!1,h=!1,b=0},t.pause_update=function(){if((0,u.input_button_pressed)(m,u.IB_FIRE4))return(0,p.lang_getstring)("CBOX_QUIT_QUESTION"),(0,p.lang_getstring)("CBOX_QUIT_OPTION1"),(0,p.lang_getstring)("CBOX_QUIT_OPTION2"),void(0,i.scenestack_push)((0,_.storyboard_get_scene)(_.SCENE_CONFIRMBOX));if(1==(0,a.confirmbox_selected_option)()&&(h=!0),h)return(0,s.video_fadefx_over)()?((0,i.scenestack_pop)(),(0,i.scenestack_pop)(),void(0,o.quest_abort)()):void(0,s.video_fadefx_out)((0,l.image_rgb)(0,0,0),1);if(v){if((0,u.input_button_pressed)(m,u.IB_FIRE3))return(0,d.music_resume)(),void(0,i.scenestack_pop)()}else(0,u.input_button_up)(m,u.IB_FIRE3)&&(v=!0)},t.pause_render=function(){var e=(0,f.sprite_get_image)((0,f.sprite_get_animation)("SD_PAUSE",0),0),t=1+.5*Math.abs(Math.cos(r.PI/2*b));(0,c.v2d_new)((s.VIDEO_SCREEN_W-e.width)/2-(t-1)*e.width/2,(s.VIDEO_SCREEN_H-e.height)/2-(t-1)*e.height/2),h||(b+=(0,g.timer_get_delta)())},t.pause_release=function(){(0,l.image_destroy)(null),(0,u.input_destroy)(m)}},7307:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.quest_getvalue=t.quest_setvalue=t.quest_getname=t.quest_abort=t.quest_setlevel=t.quest_run=t.quest_release=t.quest_render=t.quest_update=t.quest_init=t.QUESTVALUE_GLASSES=t.QUESTVALUE_BIGRINGS=t.QUESTVALUE_TOTALTIME=t.questvalue_t=void 0;var a,o=n(7266),r=n(2667),i=n(6093),_=n(2954),c=n(532),s=n(7898),d=n(5141);!function(e){e[e.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",e[e.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",e[e.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(a||(t.questvalue_t=a={})),t.QUESTVALUE_TOTALTIME=a.QUESTVALUE_TOTALTIME,t.QUESTVALUE_BIGRINGS=a.QUESTVALUE_BIGRINGS,t.QUESTVALUE_GLASSES=a.QUESTVALUE_GLASSES;var l=null,u=0,p=!1,f=[];t.quest_init=function(){var e;for(p=!1,e=0;e<3;e++)f[e]=0},t.quest_update=function(){if(0!=l.level_count)return u<l.level_count&&!p?((0,o.level_setfile)(l.level_path[u]),(0,r.scenestack_push)((0,c.storyboard_get_scene)(c.SCENE_LEVEL)),void u++):((0,r.scenestack_pop)(),void(p?(0,r.scenestack_push)((0,c.storyboard_get_scene)(c.SCENE_MENU)):l.show_ending?(0,r.scenestack_push)((0,c.storyboard_get_scene)(c.SCENE_ENDOFDEMO)):(0,r.scenestack_push)((0,c.storyboard_get_scene)(c.SCENE_QUESTOVER))));(0,s.logfile_message)("Quest '%s' has no levels. ".concat(l.file))},t.quest_render=function(){},t.quest_release=function(){(0,i.quest_unload)(l)},t.quest_run=function(e,n){void 0===n&&(n=!1),l=e,(0,d.player_set_lives)(d.PLAYER_INITIAL_LIVES),(0,d.player_set_score)(0),(0,s.logfile_message)("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),(0,t.quest_setlevel)(0)},t.quest_setlevel=function(e){u=Math.max(0,e)},t.quest_abort=function(){p=!0},t.quest_getname=function(){return"NO_QUEST_NAME"},t.quest_setvalue=function(e,t){var n=(0,_.clip)(e,0,2);f[n]=t},t.quest_getvalue=function(e){var t=(0,_.clip)(e,0,2);return f[t]}},7504:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.questover_release=t.questover_render=t.questover_update=t.questover_init=void 0;var a=n(7307),o=n(2667),r=n(532),i=n(2878),_=n(9386),c=n(642),s=n(7709),d=n(9880),l=n(9931),u=n(7774),p=n(6038),f=n(4163),g=n(3031),m=n(2530),v=n(5141),h=null,b=null,E=null,I=null,y=!1;t.questover_init=function(){(0,f.timer_get_ticks)(),y=!1,(h=(0,m.font_create)(8)).position=(0,i.v2d_new)(5,35),b=(0,m.font_create)(4),(0,m.font_set_text)(b,(0,p.lang_get)("QUESTCLEARED_TITLE")),b.position=(0,i.v2d_new)((c.VIDEO_SCREEN_W-(0,m.font_get_charsize)(b).x*(0,m.font_get_text)(b).length)/2,5),E=(0,g.actor_create)(),(0,g.actor_change_animation)(E,(0,d.sprite_get_animation)("SD_SONIC",24)),E.position=(0,i.v2d_new)(20,150),(0,l.music_play)((0,l.music_load)("data/music/invincible.mp4"),!1),I=(0,u.input_create_user)(),(0,c.video_fadefx_in)((0,s.image_rgb)(0,0,0),2)},t.questover_update=function(){var e=(0,a.quest_getname)(),t=(0,v.player_get_score)(),n=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)/3600,i=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)/60%60,d=(0,a.quest_getvalue)(a.QUESTVALUE_TOTALTIME)%60,l=(0,a.quest_getvalue)(a.QUESTVALUE_GLASSES),g=(0,a.quest_getvalue)(a.QUESTVALUE_BIGRINGS);if((0,f.timer_get_ticks)(),(0,m.font_set_text)(h,(0,p.lang_get)("QUESTCLEARED_TEXT"),e,t,n,i,d,l,g,_.GAME_TITLE,_.GAME_WEBSITE),(0,u.input_button_pressed)(I,u.IB_FIRE1)&&(y=!0),y){if((0,c.video_fadefx_over)())return(0,o.scenestack_pop)(),void(0,o.scenestack_push)((0,r.storyboard_get_scene)(r.SCENE_MENU));(0,c.video_fadefx_out)((0,s.image_rgb)(0,0,0),2)}},t.questover_render=function(){var e=(0,i.v2d_new)(c.VIDEO_SCREEN_W/2,c.VIDEO_SCREEN_H/2);(0,c.video_clearDisplay)(),(0,m.font_render)(b,e),(0,m.font_render)(h,e),(0,g.actor_render)(E,e)},t.questover_release=function(){(0,u.input_destroy)(I),(0,g.actor_destroy)(E),(0,m.font_destroy)(b),(0,m.font_destroy)(h)}},9879:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.stageselect_release=t.stageselect_render=t.stageselect_update=t.stageselect_init=void 0;var a=n(7266),o=n(2667),r=n(532),i=n(2878),_=n(9386),c=n(7898),s=n(642),d=n(7709),l=n(9931),u=n(6038),p=n(7774),f=n(9880),g=n(3450),m=n(4163),v=n(4470),h=n(2530),b=n(3031),E=n(5141),I=n(3339),y=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],x=1,S=1,w=null,L=null,O=null,R=null,T=null,N=0,k=null,P=null,D=[],j=0,A=0,B=[];t.stageselect_init=function(){A=0,N=0,P=0,T=(0,p.input_create_user)(),w=(0,h.font_create)(4),(0,h.font_set_text)(w,(0,u.lang_get)("STAGESELECT_TITLE")),w.position.x=(s.VIDEO_SCREEN_W-(0,h.font_get_text)(w).length*(0,h.font_get_charsize)(w).x)/2-150,w.position.y=10,L=(0,h.font_create)(8),(0,h.font_set_text)(L,(0,u.lang_get)("STAGESELECT_MSG")),L.position.x=10,L.position.y=s.VIDEO_SCREEN_H-1.5*(0,h.font_get_charsize)(L).y,O=(0,h.font_create)(8),(0,h.font_set_text)(O,(0,u.lang_get)("STAGESELECT_PAGE"),0,0),O.position.x=s.VIDEO_SCREEN_W-(0,h.font_get_text)(O).length*(0,h.font_get_charsize)(O).x-10,O.position.y=40,(0,I.background_load)("data/themes/levelselect.bg.json").then((function(e){k=e})),R=(0,b.actor_create)(),(0,b.actor_change_animation)(R,(0,f.sprite_get_animation)("SD_TITLEFOOT",0)),M(),(0,s.video_fadefx_in)((0,d.image_rgb)(0,0,0),1)},t.stageselect_update=function(){var e=(0,m.timer_get_delta)();if(N+=e,(0,I.background_update)(k),B.length){if(R.position=(0,i.v2d_new)(B[A].position.x,B[A].position.y),R.position.x+=3*Math.cos(2*_.PI*N)-20,x=Math.floor(A/8+1),S=Math.floor(j/8+(j%8==0?0:1)),(0,h.font_set_text)(O,(0,u.lang_get)("STAGESELECT_PAGE"),x,S),O.position.x=s.VIDEO_SCREEN_W-(0,h.font_get_text)(O).length*(0,h.font_get_charsize)(O).x-10,2==P)(0,s.video_fadefx_is_fading)()||(0,l.music_stop)();else if(!(0,l.music_is_playing)()){var t=(0,l.music_load)("data/music/options.mp4");(0,l.music_play)(t,!0)}switch(P){case 0:(0,s.video_fadefx_is_fading)()||((0,p.input_button_pressed)(T,p.IB_DOWN)&&(A=(A+1)%j,(0,l.sound_play)((0,v.soundfactory_get)("choose"))),(0,p.input_button_pressed)(T,p.IB_UP)&&(A=((A-1)%j+j)%j,(0,l.sound_play)((0,v.soundfactory_get)("choose"))),((0,p.input_button_pressed)(T,p.IB_FIRE1)||(0,p.input_button_pressed)(T,p.IB_FIRE3))&&((0,c.logfile_message)("Loading level ".concat(D[A].name," ").concat(D[A].filepath)),(0,a.level_setfile)(D[A].filepath),(0,l.sound_play)((0,v.soundfactory_get)("select")),P=2),(0,p.input_button_pressed)(T,p.IB_FIRE4)&&((0,l.sound_play)((0,v.soundfactory_get)("return")),P=1));break;case 1:if((0,s.video_fadefx_over)())return void(0,o.scenestack_pop)();(0,s.video_fadefx_out)((0,d.image_rgb)(0,0,0),1);break;case 2:if((0,s.video_fadefx_over)())return(0,E.player_set_lives)(E.PLAYER_INITIAL_LIVES),(0,E.player_set_score)(0),(0,o.scenestack_push)((0,r.storyboard_get_scene)(r.SCENE_LEVEL)),void(P=3);(0,s.video_fadefx_out)((0,d.image_rgb)(0,0,0),1);break;case 3:(0,s.video_fadefx_in)((0,d.image_rgb)(0,0,0),1),P=0}}},t.stageselect_render=function(){var e,t=(0,i.v2d_new)(s.VIDEO_SCREEN_W/2,s.VIDEO_SCREEN_H/2);for((0,I.background_render_bg)(k,t),(0,I.background_render_fg)(k,t),(0,h.font_render)(w,t),(0,h.font_render)(L,t),S>1&&(0,h.font_render)(O,t),e=8*(x-1);e<8*x;e++)D[e]&&((0,h.font_set_text)(B[e],A==e?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",D[e].name,(0,u.lang_get)("STAGESELECT_ACT"),D[e].act),(0,h.font_render)(B[e],t));(0,b.actor_render)(R,t)},t.stageselect_release=function(){C(),k=(0,I.background_unload)(k),(0,b.actor_destroy)(R),(0,h.font_destroy)(w),(0,h.font_destroy)(L),(0,h.font_destroy)(O),(0,p.input_destroy)(T)};var M=function(){(0,c.logfile_message)("load_stage_list()"),(0,g.resourcemanager_getJsonFiles)(y).then((function(e){j=(D=e).length;for(var t=0;t<j;t++)B[t]=(0,h.font_create)(8),B[t].position=(0,i.v2d_new)(25,60+t%8*20),D[t].filepath=y[t]}))},C=function(){}},4392:(e,t,n)=>{t.ZM=t.p5=t.tk=t.r5=void 0;var a,o=n(2954);n(7898);!function(e){e[e.EDITORGRP_ENTITY_BRICK=0]="EDITORGRP_ENTITY_BRICK",e[e.EDITORGRP_ENTITY_ITEM=1]="EDITORGRP_ENTITY_ITEM",e[e.EDITORGRP_ENTITY_ENEMY=2]="EDITORGRP_ENTITY_ENEMY"}(a||(a={}));var r=[],i=0;t.r5=function(){i=0;for(var e=0;e<501;e++)r[e]=null},t.tk=function(){for(var e=0;e<i;e++)r[e]=_(r[e]);i=0},t.p5=function(){return i},t.ZM=function(e){return i>0?(e=(0,o.clip)(e,0,i-1),r[e]):null};var _=function(e){return null!=e&&(e.next=_(e.next),e=null,e=null),e}},7319:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.grouptree_group_label_render=t.grouptree_group_label_update=t.grouptree_group_label_release=t.grouptree_group_label_init=t.grouptree_group_label_create=t.grouptree_group_addchild=t.grouptree_group_create=t.grouptree_nodecount=t.grouptree_render_all=t.grouptree_update_all=t.grouptree_release_all=t.grouptree_init_all=t.grouptree_destroy_all=t.GROUPTREE_MAXCHILDREN=void 0;var a=n(2878),o=n(2530);t.GROUPTREE_MAXCHILDREN=10,t.grouptree_destroy_all=function(e){if(e){for(var n=0;n<e.child_count;n++)(0,t.grouptree_destroy_all)(e.child[n]);e=null}},t.grouptree_init_all=function(e){if(e){e.init(e);for(var n=0;n<e.child_count;n++)(0,t.grouptree_init_all)(e.child[n])}},t.grouptree_release_all=function(e){if(e){for(var n=0;n<e.child_count;n++)(0,t.grouptree_release_all)(e.child[n]);e.release(e)}},t.grouptree_update_all=function(e){if(e){for(var n=0;n<e.child_count;n++)(0,t.grouptree_update_all)(e.child[n]);e.update(e)}},t.grouptree_render_all=function(e,n){if(e){for(var a=0;a<e.child_count;a++)(0,t.grouptree_render_all)(e.child[a],n);e.render(e,n)}},t.grouptree_nodecount=function(e){var n=0;if(e){for(var a=0;a<e.child_count;a++)n+=(0,t.grouptree_nodecount)(e.child[a]);return 1+n}return 0},t.grouptree_group_create=function(e,t,n,a){return{font:null,init:e,release:t,update:n,render:a,data:null,parent:null,child:[],child_count:0}},t.grouptree_group_addchild=function(e,n){e.child_count<t.GROUPTREE_MAXCHILDREN&&(e.child[e.child_count++]=n,n.parent=e)},t.grouptree_group_label_create=function(){return(0,t.grouptree_group_create)(t.grouptree_group_label_init,t.grouptree_group_label_release,t.grouptree_group_label_update,t.grouptree_group_label_render)},t.grouptree_group_label_init=function(e){if(e.font=(0,o.font_create)(8),(0,o.font_set_text)(e.font,"LABEL"),null!=e.parent){var n=void 0,r=void 0,i=0,_=null!=e.parent.font?(0,o.font_get_charsize)(e.parent.font):(0,a.v2d_new)(12,12);for(n=0;n<e.parent.child_count&&e.parent.child[n]!=e;n++);for(r=0;r<n;r++)i+=(0,t.grouptree_nodecount)(e.parent.child[r])-1;e.font.position={x:e.parent.font.position.x,y:e.parent.font.position.y},e.font.position.x+=3*_.x,e.font.position.y+=(1+i+n)*_.y*2}},t.grouptree_group_label_release=function(e){(0,o.font_destroy)(e.font)},t.grouptree_group_label_update=function(e){},t.grouptree_group_label_render=function(e,t){(0,o.font_render)(e.font,t)}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,n),r.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(0,n(5197).engine_init)({Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null,Xquest:null,Xlanguage:null})})();