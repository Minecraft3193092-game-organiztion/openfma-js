(()=>{"use strict";var e={109:(e,t,n)=>{n.r(t),n.d(t,{engine_init:()=>lh});var a,o,i,r,s,c,l,_,p,d=n(386),u={},f=function(){return u.sprites},h=function(e,t){return u.samples[t]},g={},m={},b={},y=function(e){return Promise.all(e.map(x))},x=function(e){return e=d.DATA_ROOT+e,new Promise((function(t,n){if(b[e])t(b[e]);else{var a=new XMLHttpRequest;a.overrideMimeType("application/json"),a.open("GET",e,!0),a.onreadystatechange=function(){if(4===a.readyState){var n={};try{n=JSON.parse(a.responseText)}catch(t){console.log("error parsing json",e)}b[e]=n,t(n)}},a.send(null)}}))},v=function(e,t){!function(e,t,n){e[t]=n}(g,e,t)},I=n(898),w=null,k=function(e){(0,I.logfile_message)("music_load('%s')",e);var t=new Audio;return t.src=e,function(e,t){!function(e,t,n){e[t]=n}(m,e,t)}(e,t),t},E=function(e,t){if(O()&&S(),null!=e){e.loop=!!t;try{e.play()}catch(e){}}w=e},S=function(){null!=w&&w.pause(),w=null},Y=function(e){null!=w&&(e>1&&(e=1),e<0&&(e=0),w.volume=e)},$=function(){return null!=w?w.volume:0},O=function(){return null!=w&&!w.paused},M=function(e,t){t=d.DATA_ROOT+t;var n=new Audio;n.src=t;var a=new Audio;a.src=t;var o=new Audio;o.src=t;var i=new Audio;return i.src=t,v(e,n),v(e+"2",a),v(e+"3",o),v(e+"4",i),n},j=function(e){N(e,1,0,1,0)},N=function(e,t,n,a,o){e&&e.play&&e.play()},P=function(e){return!!e&&!e.paused},L={video_resolution:null,fullscreen:null,smooth_graphics:null,show_fps:null,language:null},T=function(){if(console.log("SAVE PREFERENCES"),"undefined"!=typeof window)for(var e in L)console.log("SAVE PREVERFENCE",e,L),window.localStorage.setItem(e,L[e])},D=function(e){if("undefined"!=typeof window){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}return null},F=n(823),A=n(163),R=n(878),q=n(517),G=480,C=271,H=!1,U=!1,B=!1,Z=1,X=1,W=function(){return(0,R.Y$)(Z,X)},V=function(e,t){0==s&&(s=1,c=!1,l=e,_=0,p=t)},z=function(e,t){0==s&&(s=2,c=!1,l=e,_=0,p=t)},Q=function(){return c},K=function(){return 0!=s},J=function(e){o.fillStyle=e||"rgb(0, 0, 0)",o.fillRect(0,0,a.width,a.height)},ee=function(e,t){J();var n=ne();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),t=t<1?0:t>202?202:202/t,n.beginPath(),n.rect(134,118.5,t,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(e,130,105.5)},te=function(){return a},ne=function(){return i},ae=function(){return r},oe=function(){return H},ie=function(){return U},re=function(){return B},se=function(e){B=e},ce=function(e,t,n){r=e,U=n,H=t};function le(e){return le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le(e)}function _e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,(o=a.key,i=void 0,i=function(e,t){if("object"!==le(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,"string");if("object"!==le(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),"symbol"===le(i)?i:String(i)),a)}var o,i}var pe,de=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=t.container||document.body,this._strokeStyle=t.strokeStyle||"cyan",this._mouseSupport=void 0!==t.mouseSupport&&t.mouseSupport,this._stationaryBase=t.stationaryBase||!1,this._baseX=this._stickX=t.baseX||0,this._baseY=this._stickY=t.baseY||0,this._limitStickTravel=t.limitStickTravel||!1,this._stickRadius=void 0!==t.stickRadius?t.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var t,n,a;return t=e,a=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(e,t){this._pressed=!0;var n=W();e*=n.x,t*=n.y,this._stationaryBase,this._stickX=e,this._stickY=t}},{key:"_onMove",value:function(e,t){var n=W();e*=n.x,t*=n.y,!0===this._pressed&&(this._stickX=e,this._stickY=t)}},{key:"_onMouseUp",value:function(e){return this._onUp()}},{key:"_onMouseDown",value:function(e){e.preventDefault();var t=e.clientX,n=e.clientY;return this._onDown(t,n)}},{key:"_onMouseMove",value:function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)}},{key:"_onTouchStart",value:function(e){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",e)){this.dispatchEvent("touchStart",e),e.preventDefault();var t=e.changedTouches[0];this._touchIdx=t.identifier;var n=t.pageX,a=t.pageY;return this._onDown(n,a)}}},{key:"_onTouchEnd",value:function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length){var a=t[n];e.preventDefault();var o=a.pageX,i=a.pageY;return this._onMove(o,i)}}}},{key:"render",value:function(e){e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),e.stroke(),e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=1,e.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),e.stroke(),this._pressed&&(e.beginPath(),e.strokeStyle=this._strokeStyle,e.lineWidth=3,e.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),e.stroke())}}])&&_e(t.prototype,n),a&&_e(t,a),Object.defineProperty(t,"prototype",{writable:!1}),e}();(pe=de.prototype).addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},pe.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!=0&&this._events[e].splice(this._events[e].indexOf(t),1)},pe.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;n++){var a=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==a)return a}};var ue,fe,he,ge,me,be,ye,xe,ve,Ie,we,ke,Ee,Se,Ye,$e,Oe,Me,je,Ne,Pe,Le,Te,De,Fe,Ae,Re,qe,Ge,Ce,He,Ue,Be=null,Ze=!1,Xe={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},We={x:0,y:0},Ve={left:!1,middle:!1,right:!1},ze=function(){var e,t={type:2,enabled:!0};for(t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return st(t),t},Qe=function(e){var t,n={type:1,enabled:!0};for(n.dx=n.dy=n.x=n.y=0,n.state=[],n.oldstate=[],n.howlong=[],t=0;t<9;t++)n.state[t]=n.oldstate[t]=!1,n.howlong[t]=0;if(e)for(n.keybmap=[],t=0;t<9;t++)n.keybmap[t]=e[t];else n.keybmap[1]=38,n.keybmap[2]=40,n.keybmap[3]=39,n.keybmap[4]=37,n.keybmap[5]=32,n.keybmap[6]=17,n.keybmap[7]=13,n.keybmap[8]=27,n.keybmap[9]=192;return st(n),n},Ke=function(){var e={type:0,enabled:!0};e.dx=e.dy=e.x=e.y=0,e.state=[],e.oldstate=[],e.howlong=[];for(var t=0;t<9;t++)e.state[t]=e.oldstate[t]=!1,e.howlong[t]=0;return e.keybmap=[],e.keybmap[1]=38,e.keybmap[2]=40,e.keybmap[3]=39,e.keybmap[4]=37,e.keybmap[5]=32,e.keybmap[6]=17,e.keybmap[7]=13,e.keybmap[8]=27,st(e),e},Je=function(e){ct(e),e=null},et=function(e,t){return!!t&&!!e.enabled&&e.state[parseInt(t,10)]},tt=function(e,t){return!!t&&!!e.enabled&&e.state[parseInt(t,10)]&&!e.oldstate[parseInt(t,10)]},nt=function(e,t){return!t||!!e.enabled&&!e.state[parseInt(t,10)]&&e.oldstate[parseInt(t,10)]},at=function(e,t){e.state[parseInt(t,10)]=!0},ot=function(e){e.enabled=!1},it=function(e){e.enabled=!0},rt=function(e){return(0,R.Y$)(e.x,e.y)},st=function(e){var t={};t.data=e,t.next=Be,Be=t},ct=function(e){var t,n;if(Be.data==e)n=Be.next,Be=null,Be=n;else{for(t=Be;t.next&&t.next.data!=e;)t=t.next;t.next&&(n=t.next.next,t.next=null,t.next=n)}},lt="data/languages/english.json",_t={},pt=function(e){return new Promise((function(t,n){(0,I.logfile_message)('lang_loadfile("%s")...',e),x(e).then((function(e){_t=e,t(e)}))}))},dt=function(e,t,n){return _t[e]||e},ut=function(e){return dt(e)},ft=n(667),ht=n(817),gt={},mt=function(e){var t=h(0,e);return P(t)&&(t=h(0,e+"2"),P(t)&&(t=h(0,e+"3"),P(t)&&(t=h(0,e+"4")))),t},bt=function(e){for(var t in e)gt[t]=yt(t,e[t])},yt=function(e,t){var n=xt();return n.data=M(e,t),n.data2=M(e,t),n},xt=function(){return{data:null}},vt={},It=function(e,t){return ne().createImageData(e,t)},wt=function(e){return new Promise((function(t,n){if(vt[e])return t(vt[e]);var a=document.createElement("img");a.src=e,a.addEventListener("load",(function(){return vt[e]=a,t(a)}))}))},kt=function(e,t,n,a,o,i,r,s){if(!e||!t)return!1;t.drawImage(e,n,a,r,s,o,i,r,s)},Et=function(e,t,n,a,o){t.fillStyle=o,t.fillRect(n,a,n+1,a+1)},St=function(e,t,n){return"rgb("+e+","+t+","+n+")"},Yt=function(e,t,n,a){for(var o=0;o<e.data.length;o+=4)e.data[o]=t,e.data[o+1]=n,e.data[o+2]=a},$t=function(e){e&&(e.data,e=null)},Ot={},Mt=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],jt=0,Nt=[],Pt=function(e,t){var n;return null!=(n=Ot[e])?n.animation_data[t]:null},Lt=function(e,t){return e?e.frame_data[e.data[t]]:0},Tt=function(e){return new Promise((function(t,n){Dt(e).then(t)}))},Dt=function(e){return new Promise((function(t,n){var a=Ft(),o=Ct(a,e);o=function(e){var t,n,a;for((e.frame_w>e.rect_w||e.frame_h>e.rect_h)&&(e.frame_w=Math.min(e.frame_w,e.rect_w),e.frame_h=Math.min(e.frame_h,e.rect_h)),(e.rect_w%e.frame_w>0||e.rect_h%e.frame_h>0)&&(e.rect_w=e.rect_w%e.frame_w>0?e.rect_w-e.rect_w%e.frame_w+e.frame_w:e.rect_w,e.rect_h=e.rect_h%e.frame_h>0?e.rect_h-e.rect_h%e.frame_h+e.frame_h:e.rect_h),a=e.rect_w/e.frame_w*(e.rect_h/e.frame_h),t=0;t<e.animation_count;t++)for(n=0;n<e.animation_data[t].frame_count;n++)e.animation_data[t].data[n]>=0&&e.animation_data[t].data[n]<a||(e.animation_data[t].data[n]=Math.min(e.animation_data[t].data[n],0,a-1));return e}(o),At(o).then((function(n){o=qt(n),Ut(e.name,o),jt++,ee("Loading...",jt/Nt.length),t(o)}))}))},Ft=function(){var e={source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0};return e.frame_w=e.frame_h=0,e.hot_spot=(0,R.Y$)(0,0),e.frame_count=0,e.frame_data=[],e.animation_count=0,e.animation_data=[],e},At=function(e){return new Promise((function(t,n){wt(e.source_file).then((function(n){e.frame_count=parseInt(e.rect_w/e.frame_w*(e.rect_h/e.frame_h),10),e.frame_data=[],e=Rt(e,n),t(e)}))}))},Rt=function(e,t){for(var n=0,a=0,o=0;o<parseInt(e.frame_count,10);o++)e.frame_data[o]={data:t,sx:n+e.rect_x,sy:a+e.rect_y,swidth:e.frame_w,sheight:e.frame_h,x:0,y:0,width:e.frame_w,height:e.frame_h},(n+=e.frame_w)>=e.rect_w&&(n=0,a+=e.frame_h);return e},qt=function(e){for(var t=0;t<e.animation_count;t++)e.animation_data[t].frame_data=e.frame_data,e.animation_data[t].hot_spot=e.hot_spot;return e},Gt=function(e){return Promise.all(e.map(Dt))},Ct=function(e,t){if(e.source_file=d.DATA_ROOT+t.source_file,e.rect_x=t.source_rect.xpos,e.rect_y=t.source_rect.ypos,e.rect_w=t.source_rect.width,e.rect_h=t.source_rect.height,e.frame_w=t.frame_size.width,e.frame_h=t.frame_size.height,t.hot_spot&&(e.hot_spot.x=t.hot_spot.xpos,e.hot_spot.y=t.hot_spot.ypos),t.animations){e.animation_count=t.animations.length;for(var n=0;n<e.animation_count;n++)e.animation_data[n]=Ht(Bt(),t.animations[n]),0==e.animation_data[n].frame_count&&(0,I.logfile_message)("Animation error: invalid 'data' field. You must specify the frames of the animations")}return e},Ht=function(e,t){return e.repeat=t.repeat,e.fps=t.fps,e.data=t.data,e.frame_count=t.data.length,e},Ut=function(e,t){!function(e,t,n){u.sprites[t]=n}(f(),e,t)},Bt=function(){var e={repeat:!1,fps:8,frame_count:0,data:null};return e.hot_spot=(0,R.Y$)(0,0),e.frame_data=null,e},Zt=0,Xt=[],Wt=function(e){return Xt[e]},Vt=function(){return Zt},zt=function(e){var t=e.brick_ref.data;if(null!=t&&t.animation_data.length){t.animation_data[0].repeat;var n=t.animation_data[0].frame_count;e.animation_frame+=t.animation_data[0].fps*(0,A.dF)(),e.animation_frame>t.animation_data[0].frame_count-1&&(e.animation_frame=0),n=parseInt(e.animation_frame,10),e.brick_ref.image=t.frame_data[t.animation_data[0].data[n]]}return e},Qt=function(e){return e.brick_ref.image},Kt=function(e){var t=e.bricks;return Promise.all(t.map(Jt))},Jt=function(e){return new Promise((function(t,n){var a=function(){var e,t={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]};for(e=0;e<5;e++)t.behavior_arg[e]=0;return t}(),o=e.type;"OBSTACLE"==o?a.property=1:"PASSABLE"==o?a.property=0:"CLOUD"==o?a.property=2:(0,I.logfile_message)("Can't read brick attributes: unknown brick type '%s'",o),"DEFAULT"==(o=(0,q.isArray)(e.behavior)?e.behavior[0]:e.behavior)?a.behavior=0:"CIRCULAR"==o?a.behavior=1:"BREAKABLE"==o?a.behavior=2:"FALL"==o?a.behavior=3:(0,I.logfile_message)("Can't read brick attributes: unknown brick type '%s'",o);for(var i=0;i<5;i++)a.behavior_arg[i]=e.behavior[1+i];a.behavior_arg[a.behavior_arg.length-1]=0,a.angle=e.angle,e.zindex&&(a.zindex=e.zindex),Tt(e.sprite).then((function(e){a.data=e,a.image=e.frame_data[0],Zt++,t(a)}))}))},en=void 0,tn=!0,nn=!1,an=!1,on=!1,rn=!1,sn=function(){var e={};return e.spawn_point=(0,R.Y$)(0,0),e.position=(0,R.Y$)(e.spawn_point.x,e.spawn_point.y),e.angle=0,e.speed=(0,R.Y$)(0,0),e.maxspeed=0,e.acceleration=0,e.jump_strength=0,e.is_jumping=!1,e.ignore_horizontal=!1,e.input=null,e.animation=null,e.animation_frame=0,e.animation_speed_factor=1,e.mirror=!1,e.visible=!0,e.alpha=1,e.hot_spot=(0,R.Y$)(0,0),e.carried_by=null,e.carry_offset=(0,R.Y$)(0,0),e.carrying=null,e},cn=function(e){e.input&&Je(e.input),e=null},ln=function(e,t){var n;if(t&&e&&(e.visible&&e.animation)){if(e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,A.dF)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),e.position,!(n=dn(e)))return!1;e.mirror&&Sn(ne(),parseInt(e.position.x-(t.x-240),10));var a=parseInt(e.position.x-(t.x-240),10),o=parseInt(e.position.y-(t.y-135.5),10),i=e.mirror?e.angle:-e.angle;e.angle&&(ne().translate(a,o),ne().rotate(i),ne().translate(-a,-o)),ne().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,parseInt(e.position.x-e.hot_spot.x-(t.x-240),10),parseInt(e.position.y-e.hot_spot.y-(t.y-135.5),10),1*n.width,1*n.height),e.angle&&(ne().translate(a,o),ne().rotate(-i),ne().translate(-a,-o)),e.mirror&&Sn(ne(),parseInt(e.position.x-(t.x-240),10))}},_n=function(e,t,n,a){var o,i,r,s,c,l={};if(e.visible&&e.animation){if(isNaN(e.animation_frame)&&(e.animation_frame=0,e.animation.fps=1),e.animation_frame+=e.animation.fps*e.animation_speed_factor*(0,A.dF)(),e.animation_frame>e.animation.frame_count-1&&(e.animation.repeat?e.animation_frame=0:e.animation_frame=e.animation.frame_count-1),!(c=dn(e)))return!1;for(l.x=e.position.x%(n?c.width:d.INT_MAX)-e.hot_spot.x-(t.x-240)-(n?c.width:0),l.y=e.position.y%(a?c.height:d.INT_MAX)-e.hot_spot.y-(t.y-135.5)-(a?c.height:0),r=n?G/c.width+3:1,s=a?C/c.height+3:1,o=0;o<r;o++)for(i=0;i<s;i++)ne().drawImage(c.data,c.sx,c.sy,c.swidth,c.sheight,l.x+o*c.width,l.y+i*c.height,1*c.width,1*c.height)}},pn=function(e,t){t||(t={x:0,y:0}),t.x=t.x||0,t.y=t.y||0,Math.abs(t.x)<d.EPSILON&&(t.x=0),e.position.x+=t.x*Math.cos(e.angle)+t.y*Math.sin(e.angle),e.position.y+=t.y*Math.cos(e.angle)-t.x*Math.sin(e.angle)},dn=function(e){return Lt(e.animation,parseInt(e.animation_frame,10))},un=function(e,t){return e.animation_frame=(0,q.clip)(t,0,e.animation.frame_count),e},fn=function(e,t){return!(!e||!t)&&(e.animation!=t&&(e.animation=t,e.hot_spot=t.hot_spot,e.animation_frame=0,e.animation_speed_factor=1),e)},hn=function(e){var t=e.animation_frame+e.animation.fps*e.animation_speed_factor*(0,A.dF)();return!e.animation.repeat&&t>e.animation.frame_count-1},gn=function(e,t){var n=0,a=0,o=[];if(o[0]=[],o[1]=[],o[0][0]=(0,R.Zu)(e.position,(0,R.EN)(e.hot_spot,-e.angle)),o[0][1]=(0,R.qq)(o[0][0],(0,R.EN)((0,R.Y$)(dn(e).width,0),-e.angle)),o[0][2]=(0,R.qq)(o[0][0],(0,R.EN)((0,R.Y$)(dn(e).width,dn(e).height),-e.angle)),o[0][3]=(0,R.qq)(o[0][0],(0,R.EN)((0,R.Y$)(0,dn(e).height),-e.angle)),o[1][0]=(0,R.Zu)(t.position,(0,R.EN)(t.hot_spot,0)),o[1][1]=(0,R.qq)(o[1][0],(0,R.EN)((0,R.Y$)(dn(t).width,0),0)),o[1][2]=(0,R.qq)(o[1][0],(0,R.EN)((0,R.Y$)(dn(t).width,dn(t).height),0)),o[1][3]=(0,R.qq)(o[1][0],(0,R.EN)((0,R.Y$)(0,dn(t).height),0)),a+=Math.abs(e.angle)<d.EPSILON||Math.abs(e.angle-d.PI/2)<d.EPSILON||Math.abs(e.angle-d.PI)<d.EPSILON||Math.abs(e.angle-3*d.PI/2)<d.EPSILON,a+=Math.abs(0)<d.EPSILON||Math.abs(0-d.PI/2)<d.EPSILON||Math.abs(0-d.PI)<d.EPSILON||Math.abs(0-3*d.PI/2)<d.EPSILON){var i=[],r=[];for(n=0;n<2;n++)i[n]=[],i[n][0]=Math.min(o[n][0].x,o[n][1].x),i[n][1]=Math.min(o[n][0].y,o[n][1].y),i[n][2]=Math.max(o[n][2].x,o[n][3].x),i[n][3]=Math.max(o[n][2].y,o[n][3].y),i[n][0]>i[n][2]&&(r=(0,q.swap)(i[n][0],i[n][2]),i[n][0]=r[0],i[n][2]=r[1]),i[n][1]>i[n][3]&&(r=(0,q.swap)(i[n][1],i[n][3]),i[n][1]=r[0],i[n][3]=r[1]);return(0,q.bounding_box)(i[0],i[1])}var s=[],c=[Math.max(dn(e).width,dn(e).height),Math.max(dn(t).width,dn(t).height)];for(n=0;n<2;n++)s[n]=(0,R.GZ)((0,R.qq)(o[n][0],o[n][2]),.5);return(0,q.circular_collision)(s[0],c[0],s[1],c[1])},mn=function(e,t){return Math.abs(e.angle)<d.EPSILON&&Math.abs(t.angle)<d.EPSILON?!!gn(e,t)&&(parseInt(e.position.x-e.hot_spot.x,10),parseInt(e.position.y-e.hot_spot.y,10),parseInt(t.position.x-t.hot_spot.x,10),parseInt(t.position.y-t.hot_spot.y,10),dn(e),dn(t),!0):!!function(e,t){var n={},a={},o={},i={},r=[],s=[];return r=En(en,e,r),s=En(en,t,s),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),a.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),a.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),o.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,o.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,i.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-a.x,i.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-a.y,n.x+o.x>=a.x&&n.x<=a.x+i.x&&n.y+o.y>=a.y&&n.y<=a.y+i.y}(e,t)},bn=function(e,t,n,a,o,i,r,s,c,l,_,p){var d=dn(e).width,u=dn(e).height,f=e.position,h=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(0,-u+n),-e.angle)),g=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(0,-n),-e.angle)),m=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(-d/2+n,.5*-u),-e.angle)),b=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(d/2-n,.5*-u),-e.angle)),y=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(-d/2+n,-u+n),-e.angle)),x=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(d/2-n,-u+n),-e.angle)),v=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(-d/2+n,-n),-e.angle)),I=(0,R.qq)(f,(0,R.EN)((0,R.Y$)(d/2-n,-n),-e.angle));return yn(e,t,h,x,b,I,g,v,m,y,a,o,i,r,s,c,l,_,p)},yn=function(e,t,n,a,o,i,r,s,c,l,_,p,d,u,f,h,g,m,b){var y=[n.x-t,n.y-t,n.x+t,n.y+t],x=[r.x-t,r.y-t,r.x+t,r.y+t],v=[c.x-t,c.y-t,c.x+t,c.y+t],I=[o.x-t,o.y-t,o.x+t,o.y+t],w=[l.x-t,l.y-t,l.x+t,l.y+t],k=[a.x-t,a.y-t,a.x+t,a.y+t],E=[s.x-t,s.y-t,s.x+t,s.y+t],S=[i.x-t,i.y-t,i.x+t,i.y+t];return _&&(n&&(p=kn(_,y)),r&&(h=kn(_,x)),c&&(m=kn(_,v)),o&&(u=kn(_,I)),l&&(b=kn(_,w)),a&&(d=kn(_,k)),s&&(g=kn(_,E)),i&&(f=kn(_,S))),{up:p,down:h,left:m,right:u,upleft:b,upright:d,downleft:g,downright:f}},xn=function(e){tn=e},vn=function(e,t,n,a,o,i,r,s,c,l){var _,p=[n,a,o,c,l];for(_=0;_<p.length;_++){var d=p[_];d&&d.brick_ref&&2==d.brick_ref.property&&(d=null,p[_]=d)}if(r&&r.brick_ref&&2==r.brick_ref.property){var u=Math.min(15,r.brick_ref.image.height/3);e.speed.y>=0&&e.position.y<r.y+t+1+u||(s&&s==r&&(s=null),i&&i==r&&(i=null),r=null)}return{up:p[0],upright:p[1],right:p[2],left:p[3],upleft:p[4],downright:i,down:r,downleft:s}},In=function(e,t,n){var a,o,i,r,s,c,l,_,p,u,f,h=(0,R.Y$)(0,0),g=(0,A.dF)(),m=e.position,b=function(e,t,n,a,o,i,r,s,c,l){var _,p,u,f=dn(e).width,h=dn(e).height,g=!(Math.abs(e.angle)<d.EPSILON||Math.abs(e.angle-d.PI/2)<d.EPSILON||Math.abs(e.angle-d.PI)<d.EPSILON||Math.abs(e.angle-3*d.PI/2)<d.EPSILON),m=e.position;return g?(_=1,p=.7,u=.25):(_=.7,p=.5,u=.25),{up:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(0,-h*_+t),-e.angle)),down:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(0,2),-e.angle)),left:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(-f*u+t,-h*p),-e.angle)),right:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(f*u-t,-h*p),-e.angle)),upleft:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(-f*u+t,-h*_+t),-e.angle)),upright:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(f*u-t,-h*_+t),-e.angle)),downleft:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(-f*u+t,2),-e.angle)),downright:(0,R.qq)(m,(0,R.EN)((0,R.Y$)(f*u-t,2),-e.angle))}}(e,-2);b=function(e,t,n,a,o,i,r,s,c,l,_,p,d,u,f,h,g,m){return yn(e,2,n,a,o,i,r,s,c,l,t,_,p,d,u,f,h,g,m)}(e,t,a=b.up,b.upright,o=b.right,b.downright,b.down,b.downleft,i=b.left,b.upleft,r,s,c,l,_,p,u,f),r=b.up,s=b.upright,c=b.right,l=b.downright,_=b.down,p=b.downleft,u=b.left,f=b.upleft;var y=vn(e,-2,r,s,c,l,_,p,u,f);return r=y.up,s=y.upright,c=y.right,u=y.left,f=y.upleft,_=y.down,p=y.downleft,l=y.downright,function(e,t){var n=(0,A.dF)();if(null!=e.carried_by){var a=e.carried_by;t&&0==t.brick_ref.angle&&parseInt(a.speed.y,10)>=5?(e.position=(0,R.Y$)(e.carried_by.position.x,e.carried_by.position.y),e.carried_by.carrying=null,e.carried_by=null):(e.speed=(0,R.Y$)(0,0),e.mirror=a.mirror,e.angle=0,e.position=(0,R.Zu)((0,R.qq)(a.position,(0,R.GZ)(a.speed,n)),e.carry_offset))}}(e,_),null!=e.carried_by?(0,R.Y$)(0,0):(function(e,t,n,a,o,i){i&&i.brick_ref.angle%90==0&&(e.speed.x>d.EPSILON||a.x>i.x)&&(e.speed.x=0,e.position.x=i.x+(t.x-a.x)),o&&o.brick_ref.angle%90==0&&(e.speed.x<-d.EPSILON||n.x<o.x+o.brick_ref.image.width)&&(e.speed.x=0,e.position.x=o.x+o.brick_ref.image.width+(t.x-n.x))}(e,m,i,o,u,c),_?(e.is_jumping=!1,e.ignore_horizontal=!1,function(e,t,n,a,o){var i=a.brick_ref.angle;!et(e.input,5)||et(e.input,2)||o||(e.angle=0,e.is_jumping=!0,0==i?e.speed.y=-e.jump_strength:i>0&&i<90?(e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=-.7*e.jump_strength):90==i?(actor.move(e,(0,R.Y$)(-40,0)),e.speed.x=Math.min(e.speed.x,-e.jump_strength),e.speed.y=-e.jump_strength/2):i>90&&i<180?(actor.move(e,(0,R.Y$)(0,40)),e.speed.x=Math.min(e.speed.x,-.7*e.jump_strength),e.speed.y=e.jump_strength):180==i?(actor.move(e,(0,R.Y$)(0,40)),e.speed.x*=-1,e.speed.y=e.jump_strength):i>180&&i<270?(actor.move(e,(0,R.Y$)(0,40)),e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=e.jump_strength):270==i?(actor.move(e,(0,R.Y$)(40,0)),e.speed.x=Math.max(e.speed.x,e.jump_strength),e.speed.y=-e.jump_strength/2):i>270&&i<360&&(e.speed.x=Math.max(e.speed.x,.7*e.jump_strength),e.speed.y=-.7*e.jump_strength))}(e,0,0,_,r)):e.angle=0,h.y=Math.abs(e.speed.y)>d.EPSILON?e.speed.y*g+1*n*.5*(g*g):0,e.speed.y=Math.min(e.speed.y+1*n*g,480),function(e,t,n,a){a&&a.brick_ref.angle%90==0&&e.speed.y<-d.EPSILON&&(e.position.y=a.y+a.brick_ref.image.height+(t.y-n.y),e.speed.y=10)}(e,m,a,r),function(e,t,n,a,o,i,r,s,c){var l;if((0,A.dF)(),s&&!e.is_jumping)if(l=s.brick_ref.angle,e.speed.y=a.y=0,e.angle=l*d.PI/180,0==l)e.position.y=o.y+t;else if(l>0&&l<90)o.y=s.y+s.brick_ref.image.height-(e.position.x-s.x)*Math.tan(e.angle),e.position.y=o.y+t,e.mirror,d.IF_HFLIP;else if(90==l){if(Math.abs(e.speed.x)>5){var _=c?c.brick_ref.angle:-1;c&&_>=l&&_<l+90?(o.y=s.x,e.position.x=o.y+t):(e.angle=0,pn(e,(0,R.Y$)(-13,0)),e.is_jumping=!0,e.speed=(0,R.Y$)(0,-.7*Math.abs(e.speed.x)))}else e.angle=0,pn(e,(0,R.Y$)(-10,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,d.IF_HFLIP}else if(l>90&&l<180)Math.abs(e.speed.x)>5?(o.y=s.y-(e.position.x-s.x)*Math.tan(e.angle),e.position.y=o.y-t):(e.angle=0,pn(e,(0,R.Y$)(0,30)),e.is_jumping=!0);else if(180==l)e.speed.x>5&&!(e.mirror&d.IF_HFLIP)||e.speed.x<-5&&e.mirror&d.IF_HFLIP?(o.y=s.y+s.brick_ref.image.height,e.position.y=o.y-t):(e.angle=0,pn(e,(0,R.Y$)(0,40)),e.is_jumping=!0,e.speed.x=0);else if(l>180&&l<270)Math.abs(e.speed.x)>5?(o.y=s.y+s.brick_ref.image.height-(e.position.x-s.x)*Math.tan(e.angle),e.position.y=o.y-t):(e.angle=0,pn(e,(0,R.Y$)(0,30)),e.is_jumping=!0);else if(270==l){if(Math.abs(e.speed.x)>5){var p=r?r.brick_ref.angle:-1;r&&p>l-90&&p<=l?(o.y=s.x+s.brick_ref.image.width,e.position.x=o.y-t):(e.angle=0,pn(e,(0,R.Y$)(13,0)),e.is_jumping=!0,e.speed=(0,R.Y$)(0,-.7*Math.abs(e.speed.x)))}else e.angle=0,pn(e,(0,R.Y$)(10,0)),e.is_jumping=!0,e.ignore_horizontal=!1;e.mirror,d.IF_HFLIP}else l>270&&l<360&&(o.y=s.y-(e.position.x-s.x)*Math.tan(e.angle),e.position.y=o.y+t,e.mirror,d.IF_HFLIP)}(e,-2,0,h,m,0,p,_,l),h.x=Math.abs(e.speed.x)>d.EPSILON?e.speed.x*g+1*e.acceleration*.5*(g*g):0,function(e,t,n){var a=(0,A.dF)();if(et(e.input,4)&&!et(e.input,3))e.ignore_horizontal||et(e.input,2)||(e.speed.x=Math.max(e.speed.x-1*e.acceleration*a,-e.maxspeed),e.mirror=d.IF_HFLIP);else if(et(e.input,3)&&!et(e.input,4))e.ignore_horizontal||et(e.input,2)||(e.speed.x=Math.min(e.speed.x+1*e.acceleration*a,e.maxspeed),e.mirror=IF_NONE);else if(n){var o=0,i=n.brick_ref.angle;i%90==0?o=90==i&&e.mirror&d.IF_HFLIP&&e.speed.x<0||270==i&&!(e.mirror&d.IF_HFLIP)&&e.speed.x>0?e.speed.x>d.EPSILON?1:-e.speed.x>d.EPSILON?-1:0:e.speed.x>d.EPSILON?-1:-e.speed.x>d.EPSILON?1:0:(i>90&&i<180||i>180&&i<270)&&(o=e.speed.x>d.EPSILON?-1:-e.speed.x>d.EPSILON?1:0),e.speed.x+=1*o*e.acceleration*a}}(e,0,_),Math.abs(e.speed.x)<d.EPSILON&&(e.speed.x=h.x=0),h)},wn=function(e){var t=(0,A.dF)(),n=(0,R.Y$)(0,0);return e.input?(et(e.input,3)&&!et(e.input,4)&&(e.speed.x=Math.min(e.speed.x+e.acceleration*t,e.maxspeed)),et(e.input,4)&&!et(e.input,3)&&(e.speed.x=Math.max(e.speed.x-e.acceleration*t,-e.maxspeed)),!et(e.input,4)&&!et(e.input,3)&&Math.abs(e.speed.x)>d.EPSILON&&(e.speed.x>0?e.speed.x=Math.max(e.speed.x-e.acceleration*t,0):e.speed.x=Math.min(e.speed.x+e.acceleration*t,0)),et(e.input,2)&&!et(e.input,1)&&(e.speed.y=Math.min(e.speed.y+e.acceleration*t,e.maxspeed)),et(e.input,1)&&!et(e.input,2)&&(e.speed.y=Math.max(e.speed.y-e.acceleration*t,-e.maxspeed)),!et(e.input,1)&&!et(e.input,2)&&Math.abs(e.speed.y)>d.EPSILON&&(e.speed.y>0?e.speed.y=Math.max(e.speed.y-e.acceleration*t,0):e.speed.y=Math.min(e.speed.y+e.acceleration*t,0))):e.speed=(0,R.Y$)(0,0),n.x=Math.abs(e.speed.x)>d.EPSILON?e.speed.x*t+.5*e.acceleration*t*t:0,n.y=0,e.speed.x=n.x,e.speed.y=n.y,n},kn=function(e,t){var n,a,o,i,r,s,c,l=null,_=!1;for(n=e;n&&!_;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&l&&1==l.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&l&&1!=l.brick_ref.behavior&&n.data.y>=l.y)continue;if(on&&0==n.data.brick_ref.angle)continue;if(rn&&180==n.data.brick_ref.angle)continue;if(an&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(nn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var p=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if((0,q.bounding_box)(t,p))if(1!=n.data.brick_ref.behavior&&l&&1==l.brick_ref.behavior&&n.data.y<=l.y)l=n.data;else if(1==n.data.brick_ref.property&&l&&2==l.brick_ref.property)l=n.data;else if(2==n.data.brick_ref.property&&l&&2==l.brick_ref.property)n.data.y>l.y&&(l=n.data);else if(n.data.brick_ref.angle%90==0)l?tn?l.brick_ref.angle%180!=0&&(l=n.data):l.brick_ref.angle%180==0&&(l=n.data):l=n.data;else for(a=n.data.brick_ref.angle,s=Math.tan(a*d.PI/180),i=t[0];i<=t[2]&&!_;i++)for(r=t[1];r<=t[3]&&!_;r++){switch(o=!1,parseInt(a/90,10)%4){case 0:c=p[3]+s*(p[0]-i),o=p[0]<=i&&i<=p[2]&&c<=r&&r<=p[3];break;case 1:c=p[3]-s*(p[2]-i),o=p[0]<=i&&i<=p[2]&&p[1]<=r&&r<=c;break;case 2:c=p[3]-s*(p[0]-i),o=p[0]<=i&&i<=p[2]&&p[1]<=r&&r<=c;break;case 3:c=p[3]+s*(p[2]-i),o=p[0]<=i&&i<=p[2]&&c<=r&&r<=p[3]}o&&(l=n.data,_=!0)}}return l},En=function(e,t,n){var a,o,i,r,s,c,l,_,p;return i=-t.angle,a=dn(t).width,o=dn(t).height,_=t.hot_spot,p=t.position,r=(0,R.Zu)((0,R.Y$)(0,0),_),s=(0,R.Zu)((0,R.Y$)(a,0),_),c=(0,R.Zu)((0,R.Y$)(a,o),_),l=(0,R.Zu)((0,R.Y$)(0,o),_),n[0]=(0,R.qq)(p,(0,R.EN)(r,i)),n[1]=(0,R.qq)(p,(0,R.EN)(s,i)),n[2]=(0,R.qq)(p,(0,R.EN)(c,i)),n[3]=(0,R.qq)(p,(0,R.EN)(l,i)),n},Sn=function(e,t){return e.translate(t,0),e.scale(-1,1),e.translate(-t,0),e},Yn=[],$n=function(e){var t,n={};for(n.type=(0,q.clip)(e,0,9),n.text=null,n.width=0,n.visible=!0,n.hspace=n.vspace=1,n.value=[],n.position=(0,R.Y$)(0,0),t=0;t<5;t++)n.value[t]=0;return n},On=function(e,t){if(!e)return!1;for(var n,a=arguments.length,o=new Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];for(n=0;n<o.length;n++)o[n]=""+o[n];var r=(t=""+t).match(/\$[A-Z_\d]\w+/g);if(r)for(n=0;n<r.length;n++){var s=r[n].slice(1),c=ut(s);c&&(t=t.replace("$"+s,c))}if(r=t.match(/\%[s]+/g))for(n=0;n<r.length;n++)if(o[n]){var l=o[n].match(/\$[A-Z_\d]\w+/g);l&&(o[n]=l[0].slice(1)),t=t.replace("%s",ut(o[n]))}if(r=t.match(/\%[d]+/g))for(n=0;n<r.length;n++)o[n]&&(t=t.replace("%d",""+o[n]));return e.text=""+t,e},Mn=function(e){return e.text?e.text:""},jn=function(e){return Ln(e)},Nn=function(e,t){e.width=Math.max(0,t)},Pn=function(e,t){var n,a,o,i,r,s=0,c=0,l=[],_=0,p=0;l[p++]={r:!1,g:0,b:0};var d=Ln(e);if(n=d.x,a=d.y,e&&e.visible&&e.text)for(_=0;_<e.text.length;_++){if(o=e.text[_],r=!1,(0,q.isspace)(e.text[_-1])){var u=void 0,f=!1,h=0,g=e.text.slice(_),m=(g=(g=g.replace("(","")).replace(")","")).split(" ")[0];for(u=0;u<m.length;u++)"<"==m[u]&&(f=!0),f||h++,">"==m[u]&&(f=!1);r=e.width>0&&s+(n+e.hspace)*h-e.hspace>e.width}if("<"==o){var b=e.text.slice(_,_+7);if("<color="==b){var y,x,v;_+=7;var I=e.text.slice(_,_+6);y=Dn(I.slice(0,2)),x=Dn(I.slice(2,4)),v=Dn(I.slice(4,6)),l[p++]={r:y,g:x,b:v},_+=7,o=e.text[_]}"</color"==b&&(_+=8,o=e.text[_],p>=2&&p--)}r&&(s=0,c+=a+e.vspace),"\n"!=o?(i=Yn[e.type].ch[o])?(s+=i.width,(0,q.isspace)(e.text[_-1]),Tn(ne(),i,parseInt(e.position.x+s-(t.x-240),10),parseInt(e.position.y+c-(t.y-135.5),10),l[p-1].r,l[p-1].g,l[p-1].b)):s+=n+e.hspace:(s=0,c+=a+e.vspace)}},Ln=function(e){var t,n;if(e)for(t=0;t<256;t++)if(Yn[e.type]&&null!=(n=Yn[e.type].ch[t]))return(0,R.Y$)(n.width,n.height);return(0,R.Y$)(16,16)},Tn=function(e,t,n,a,o,i,r){var s=t.data;e.drawImage(s,t.sx,t.sy,t.swidth,t.sheight,n,a-2,1*t.width,1*t.height)},Dn=function(e){return(e=e.toLowerCase())>="0"&&e<="9"?e-"0":e>="a"&&e<="f"?e-"a"+10:255},Fn=[],An=[],Rn=-1,qn=function(){var e;for(Ie=Lt(Pt("SD_CONFIRMBOX",0),0),we=(0,R.Y$)((G-Ie.width)/2,C),Me=Ke(),Ee=sn(),Ee=fn(Ee,Pt("SD_TITLEFOOT",0)),ke=$n(8),On(ke,Se),Nn(ke,164),e=0;e<Ye;e++)Fn[e]=[],Fn[e][0]=$n(8),Fn[e][1]=$n(8),On(Fn[e][0],An[e]),On(Fn[e][1],"<color=ffff00>%s</color>",An[e]);Rn=0,$e=!0,Oe=!1},Gn=function(){var e,t=(0,A.dF)();if($e&&(we.y<=(C-Ie.height)/2?$e=!1:we.y-=1355*t),Oe){if(we.y>=C)return Oe=!1,void(0,ft.xp)();we.y+=1355*t}for(Ee.position=(0,R.Y$)(we.x+Rn*Ie.width/Ye+10,we.y+.75*Ie.height-1),ke.position=(0,R.Y$)(we.x+10,we.y+10),e=0;e<Ye;e++)Fn[e][0].position=(0,R.Y$)(we.x+e*Ie.width/Ye+25,we.y+.75*Ie.height),Fn[e][1].position=Fn[e][0].position;$e||Oe||(tt(Me,4)?(j(mt("choose")),Rn=((Rn-1)%Ye+Ye)%Ye):tt(Me,3)?(j(mt("choose")),Rn=(Rn+1)%Ye):(tt(Me,5)||tt(Me,7))&&(j(mt("select")),Oe=!0))},Cn=function(){var e,t,n=(0,R.Y$)(240,135.5);for(J(),ne().drawImage(Ie.data,Ie.sx,Ie.sy,Ie.swidth,Ie.sheight,we.x,we.y,Ie.swidth,Ie.sheight),Pn(ke,n),e=0;e<Ye;e++)t=e==Rn?1:0,Pn(Fn[e][t],n);ln(Ee,n)},Hn=function(){cn(Ee),Je(Me),$t(void 0)},Un=function(e,t,n){Rn=-1,Se=e,An[0]=t,n?(An[1]=n,Ye=2):Ye=1},Bn=function(){if(-1!=Rn){var e=Rn+1;return Rn=-1,e}return 0},Zn=function(e){return new Promise((function(t,n){(0,I.logfile_message)("background_load('%s')",e),x(e).then(ta).then((function(e){t(e)}))}))},Xn=function(e){return(0,I.logfile_message)("background_unload()"),null},Wn=function(e){if(!e)return!1;var t,n;for(t=0;t<e.length;t++)(n=e[t]).strategy&&n.strategy.update&&n.strategy.update(n.strategy)},Vn=function(e,t){Qn(e,t,!1)},zn=function(e,t){Qn(e,t,!0)},Qn=function(e,t,n){if(e){var a,o,i=(0,R.Y$)(240,135.5),r=(0,R.Zu)(t,i);for(a=0;a<e.length;a++)o=e[a],(!n&&o.zindex<=.5||n&&o.zindex>.5)&&(o.actor.position.x+=r.x*o.actor.speed.x,o.actor.position.y+=r.y*o.actor.speed.y,_n(o.actor,i,o.repeat_x,o.repeat_y),o.actor.position.y-=r.y*o.actor.speed.y,o.actor.position.x-=r.x*o.actor.speed.x)}},Kn=function(e){},Jn=function(e){var t=e,n=e.background,a=(0,A.dF)();n.actor.position.x+=t.speed_x*a,n.actor.position.y+=t.speed_y*a},ea=function(e){var t,n,a,o=e,i=e.background,r=(0,A.dF)();t=o.timer+=r,n=Math.sin(o.angularspeed_x*t+o.initialphase_x),a=Math.cos(o.angularspeed_y*t+o.initialphase_y),i.actor.position.x+=-o.angularspeed_x*o.amplitude_x*n*r,i.actor.position.y+=o.angularspeed_y*o.amplitude_y*a*r},ta=function(e){var t=e.bg;return Promise.all(t.map(na))},na=function(e,t){return new Promise((function(t,n){var a,o=function(){var e={};return e.actor=sn(),e.data=null,e.strategy=null,e.repeat_x=!1,e.repeat_y=!1,e.zindex=0,e}();switch(o.actor.spawn_point.x=e.initial_position.xpos,o.actor.spawn_point.y=e.initial_position.ypos,o.actor.position=(0,R.Y$)(o.actor.spawn_point.x,o.actor.spawn_point.y),o.actor.speed.x=e.scroll_speed.xspeed,o.actor.speed.y=e.scroll_speed.yspeed,e.behavior&&(0,q.isArray)(e.behavior)?e.behavior[0]:e.behavior){case"DEFAULT":o.strategy&&(o.strategy=(o.strategy,null)),o.strategy=((a={}).background=o,a.update=Kn,a);break;case"LINEAR":o.strategy&&(o.strategy=(o.strategy,null)),o.strategy=function(e,t,n){var a={},o=a;return o.background=e,o.update=Jn,a.speed_x=t,a.speed_y=n,o}(o,e.behavior[1],e.behavior[2]);break;case"CIRCULAR":o.strategy&&(o.strategy=(o.strategy,null)),o.strategy=function(e,t,n,a,o,i,r){var s={},c=s;return c.background=e,c.update=ea,s.timer=0,s.amplitude_x=t,s.amplitude_y=n,s.angularspeed_x=2*d.PI*a,s.angularspeed_y=2*d.PI*o,s.initialphase_x=i*d.PI/180,s.initialphase_y=r*d.PI/180,c}(o,e.behavior[1],e.behavior[2],e.behavior[3],e.behavior[4],e.behavior[5],e.behavior[6])}o.repeat_x=e.repeat_x,o.repeat_y=e.repeat_y,e.zindex&&(o.zindex=e.zindex),Tt(e.sprite).then((function(e){o.data=e,o.actor.animation=e,o.actor.animation.data=[0],o.actor.image=o.actor.animation.frame_data[0],t(o)}))}))},aa=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],oa=function(){Ne=!1,De=Ke(),Pe=$n(4),console.log(Pe),On(Pe,ut("CREDITS_TITLE")),Pe.position.x=140,Pe.position.y=5,Te=$n(8),On(Te,ut("CREDITS_KEY")),Te.position.x=10,Te.position.y=C-jn(Te).y-5,Le=$n(8);for(var e=0;e<aa.length;e++){var t=aa[e],n=t.match(/\$[A-Z_\d]\w+/m);if(n){for(var a=0;a<n.length;a++){var o=n[a].slice(1),i=ut(o);i&&(t=t.replace("$"+o,i))}aa[e]=t}}aa=aa.join(""),On(Le,aa,"%s"),Nn(Le,300),Le.position.x=10,Le.position.y=C,Fe=1;for(var r=Mn(Le),s=0;s<r.length;s++)"\n"==r[s]&&Fe++;Fe+=10,je=It(G,30),Ae=Zn("data/themes/credits.bg.json").then((function(e){Ae=e,console.log(Ae),V(St(0,0,0),1)})),V(St(0,0,0),1)},ia=function(){var e,t=(0,A.dF)();if(Wn(Ae),Le.position.y-=3*jn(Le).y*t,Le.position.y<-Fe*(jn(Le).y+(e=Le,(0,R.Y$)(e.hspace,e.vspace)).y)&&(Le.position.y=C),Ne||K()||(tt(De,7)?(j(mt("select")),Ne=!0):tt(De,8)&&(j(mt("return")),Ne=!0)),!O()){var n=music_load("data/music/options.mp4");E(n,d.INFINITY)}if(Ne){if(Q())return void(0,ft.xp)();z(St(0,0,0),1)}},ra=function(){J();var e=(0,R.Y$)(240,135.5);Vn(Ae,e),zn(Ae,e),Pn(Le,e),ne().fillRect(0,0,je.width,je.height),ne().fillRect(0,251,je.width,je.height),Pn(Pe,e),Pn(Te,e)},sa=function(){Ae=Xn(),$t(je),Je(De)},ca=10,la=[],_a=function(){var e;for(Re=(0,A.$I)(),(qe=$n(8)).position=(0,R.Y$)(5,35),Ge=$n(4),On(Ge,ut("ENDOFDEMO_TITLE")),Ge.position=(0,R.Y$)((G-parseInt(jn(Ge).x,10)*Mn(Ge)).length/2,5),e=0;e<ca;e++)la[e]=sn(),la[e].spawn_point=la[e].position=(0,R.Y$)(G*e/ca+15,215),fn(la[e],Pt(e%2==1?"SD_BLUERING":"SD_RING",0));V(St(0,0,0),2)},pa=function(){var e,t=(0,A.$I)(),n=Math.max(0,(3-parseInt(t-Re,10))/1e3);if(On(qe,ut("ENDOFDEMO_TEXT"),d.GAME_TITLE,d.GAME_WEBSITE,n),t>=Re+3){if(Q())return(0,ft.xp)(),void(0,ft.ZH)(sh(eh));z(St(0,0,0),2)}for(e=0;e<ca;e++)la[e].position.y=la[e].spawn_point.y+10*Math.sin(d.PI*(.001*t)+2*d.PI/ca*e)},da=function(){var e,t=(0,R.Y$)(240,135.5);for(J(),e=0;e<ca;e++)ln(la[e],t);Pn(Ge,t),Pn(qe,t)},ua=function(){var e;for(e=0;e<ca;e++)cn(la[e])},fa={is_locked:!1,position:{x:0,y:0},dest:{x:0,y:0},speed:0,region_topleft:{x:0,y:0},region_bottomright:{x:0,y:0},dest_region_topleft:{x:0,y:0},dest_region_bottomright:{x:0,y:0},region_topleft_speed:0,region_bottomright_speed:0},ha=function(e,t){e.x<fa.region_topleft.x&&(e.x=fa.region_topleft.x),e.y<fa.region_topleft.y&&(e.y=fa.region_topleft.y),e.x>fa.region_bottomright.x&&(e.x=fa.region_bottomright.x),e.y>fa.region_bottomright.y&&(e.y=fa.region_bottomright.y),fa.dest=e,t>d.EPSILON?fa.speed=(0,R.qU)((0,R.Zu)(fa.position,fa.dest))/t:fa.position=fa.dest,fa.position.x=parseInt(e.x,10),fa.position.y=parseInt(e.y,10)},ga=function(){return(0,R.Y$)(fa.position.x,fa.position.y)},ma=function(e){var t=(0,R.Y$)(e.x,e.y);fa.dest=fa.position=t},ba=function(){var e,t,n,a;fa.is_locked||(e=-d.INFINITY,t=-d.INFINITY,n=d.INFINITY,a=d.INFINITY,fa.dest_region_topleft.x=Math.max(Math.min(e,n),240),fa.dest_region_topleft.y=Math.max(Math.min(t,a),135.5),fa.dest_region_bottomright.x=Math.min(Math.max(e,n),Dp().x-240),fa.dest_region_bottomright.y=Math.min(Math.max(t,a),Dp().y-135.5),fa.region_topleft_speed=(0,R.qU)((0,R.Zu)(fa.region_topleft,fa.dest_region_topleft))/.25,fa.region_bottomright_speed=(0,R.qU)((0,R.Zu)(fa.region_bottomright,fa.dest_region_bottomright))/.25)},ya=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=sn(),e.actor.maxspeed=145+(0,q.random)(21),e.actor.input=ze(),t.is_running=!1,t.animal_id=(0,q.random)(12),fn(e.actor,Pt("SD_ANIMAL",0))},xa=function(e){cn(e.actor)},va=function(e,t,n,a,o,i){var r,s,c,l,_=e,p=e.actor,u=2*_.animal_id+(_.is_running?1:0);at(p.input,5),p.jump_strength=1.3*(200+(0,q.random)(50)),p.speed.x>d.EPSILON?(p.speed.x=p.maxspeed,p.mirror=d.IF_NONE):p.speed.x<-d.EPSILON&&(p.speed.x=-p.maxspeed,p.mirror=d.IF_HFLIP),fn(p,Pt("SD_ANIMAL",u));var f=bn(p,2,-2,a,r,null,l,null,s,null,c,null);r=f.up,f.upright,l=f.right,f.downright,s=f.down,f.downleft,c=f.left,f.upleft;var h=vn(p,-2,r,null,l,null,s,null,c,null);r=h.up,h.upright,l=h.right,h.downright,s=h.down,h.downleft,c=h.left,h.upleft,s&&!_.is_running&&(_.is_running=!0,p.speed.x=((0,q.random)(2)?-1:1)*p.maxspeed),c&&!r&&(p.speed.x=p.maxspeed),l&&!r&&(p.speed.x=-p.maxspeed),!_.is_running&&(s&&r||c&&l)&&(e.state=Dr),pn(p,In(p,a,Bp()))},Ia=function(e,t){ln(e.actor,t)},wa=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),Ya(e,$a()),fn(e.actor,Pt("SD_ENDLEVEL",0))},ka=function(e){cn(e.actor),Ya(e,null)},Ea=function(e,t,n,a,o,i){var r=e;r.state.handle(r.state,e,t,n)},Sa=function(e,t){ln(e.actor,t)},Ya=function(e,t){e.state=t},$a=function(){var e={},t=e;return e.handle=Oa,t.being_hit=!1,t.hit_count=0,e},Oa=function(e,t,n,a){var o,i,r,s=e,c=t.actor;for(o=0;o<a;o++){var l=n[o];Pa(t,l)&&!s.being_hit&&(s.being_hit=!0,fn(c,Pt("SD_ENDLEVEL",1)),j(mt("boss hit")),l.bounce(l),l.actor.speed.x*=-.5,++s.hit_count>=3&&Ya(t,(i=void 0,r=void 0,r=i={},i.handle=Ma,r.explode_timer=0,r.break_timer=0,i)))}hn(c)&&s.being_hit&&(fn(c,Pt("SD_ENDLEVEL",0)),s.being_hit=!1)},Ma=function(e,t,n,a){var o,i=e,r=t.actor,s=(0,A.dF)();if(i.explode_timer+=s,i.break_timer+=s,i.explode_timer>=.1){var c=(0,R.Y$)(r.position.x-r.hot_spot.x+(0,q.random)(dn(r).width),r.position.y-r.hot_spot.y+(0,q.random)(dn(r).height/2));Xp(qr,c),j(mt("explode")),i.explode_timer=0}i.break_timer>=2&&Ya(t,((o={}).handle=ja,o))},ja=function(e,t,n,a){for(var o,i=t.actor,r=0;r<20;r++){var s=(0,R.Y$)(i.position.x-i.hot_spot.x+(0,q.random)(dn(i).width),i.position.y-i.hot_spot.y+(0,q.random)(dn(i).height/2));Qp(s)}Rp(i),fn(i,Pt("SD_ENDLEVEL",2)),Ya(t,((o={}).handle=Na,o))},Na=function(e,t,n,a){},Pa=function(e,t){if(e&&t){var n=[],a=[],o=e.actor,i=t.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+dn(i).width,n[3]=n[1]+dn(i).height,a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y,a[2]=a[0]+dn(o).width-10,a[3]=a[1]+dn(o).height/2,t.attacking(t)&&(0,q.bounding_box)(n,a)&&mn(o,i)}},La=0,Ta=0,Da=function(e){var t,n={};switch((0,I.logfile_message)("player_create(%d)",e),e){case 0:n.name="Surge";break;case 1:n.name="Neon";break;case 2:n.name="Charge";break;default:n.name="Unknown"}for(n.type=e,n.actor=sn(),n.disable_movement=!1,n.in_locked_area=!1,n.at_some_border=!1,n.attacking=Ha,n.bounce=Ca,n.spin=n.spin_dash=n.braking=n.flying=n.climbing=n.landing=n.spring=!1,n.is_fire_jumping=!1,n.getting_hit=n.dying=n.dead=n.blinking=!1,n.on_moveable_platform=!1,n.lock_accel=0,n.flight_timer=n.blink_timer=n.death_timer=0,n.disable_jump_for=0,n.glasses=sn(),n.got_glasses=!0,n.shield=sn(),n.shield_type=0,n.invincible=!1,n.invtimer=0,n.invstar=[],t=0;t<5;t++)n.invstar[t]=sn(),n.invstar[t]=fn(n.invstar[t],Pt("SD_INVSTAR",0));switch(n.got_speedshoes=!1,n.speedshoes_timer=0,n.disable_wall=0,n.entering_loop=!1,n.at_loopfloortop=!1,n.bring_to_back=!1,n.type){case 0:n.actor.acceleration=250,n.actor.maxspeed=700,n.actor.jump_strength=450,n.actor.input=Ke(),n.actor=fn(n.actor,Pt(za(0),0));break;case 1:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=Ke(),n.actor=fn(n.actor,Pt(za(1),0));break;case 2:n.actor.acceleration=200,n.actor.maxspeed=600,n.actor.jump_strength=360,n.actor.input=Ke(),n.actor=fn(n.actor,Pt(za(2),0))}return He=1,Ce=0,(0,I.logfile_message)("player_create() ok"),n},Fa=function(e,t,n){var a=e.actor;return e.blinking&&(e.blink_timer+=(0,A.dF)(),a.visible=(0,A.$I)()%250<125,e.blink_timer>=4&&(e.getting_hit=e.blinking=!1,a.visible=!0)),e.disable_movement?e.spin?e.actor=fn(e.actor,Pt(za(e.type),3)):e.spring&&(e.actor=fn(e.actor,Pt(za(e.type),13))):pn(a,Ra(e,t,n,Bp())),e},Aa=function(e,t){if(e){var n=e.actor;if(n){var a,o,i=n.hot_spot,r=n.position,s=(0,R.Y$)(0,0),c=(0,R.Y$)(0,0),l=[],_=n.angle;if(e.invincible){var p=Pt("SD_INVSTAR",0).frame_count;for(e.invtimer+=(0,A.dF)(),a=0;a<5;a++)l[a]=720*(0,A.$I)()*.001+72*(a+1),c.x=30*Math.cos(l[a]*d.PI/180),c.y=((0,A.$I)()+400*a)%2e3/40,c=(0,R.EN)(c,_),e.invstar[a].position.x=n.position.x+c.x,e.invstar[a].position.y=n.position.y-c.y+5,un(e.invstar[a],(0,q.random)(p))}for(e.got_glasses&&Qa(e),0!=e.shield_type&&Ja(e),e.type,a=0;a<5&&e.invincible;a++)l[a]%360>=180&&ln(e.invstar[a],t);for(o=n.angle,n.angle=n.is_jumping||e.spin?o:(0,q.old_school_angle)(o),ln(n,t),n.angle=o,e.got_glasses&&ln(e.glasses,t),0!=e.shield_type&&ln(e.shield,t),a=0;a<5&&e.invincible;a++)l[a]%360<180&&ln(e.invstar[a],t);switch(e.type){case 0:case 2:default:break;case 1:n.is_jumping&&n.animation==Pt(za(1),3)&&(n.position=(0,R.Y$)(r.x,r.y),n.angle=_,n.hot_spot=i,0!=e.shield_type&&(e.shield.angle=0,e.shield.hot_spot=s))}}}},Ra=function(e,t,n,a){var o,i,r,s,c,l,_,p,u,f,h,g,m,b,y,x,v,I,w,k,E,S,Y,$,O=e.actor,M=za(e.type),N=(0,A.dF)(),L=480,T=0,D=1,F=O.maxspeed,G=(0,R.Y$)(0,0),C=!1,H=e.actor.animation==Pt(M,1),U=!1,B=!1,Z=!1,X=null,W=dn(O).width,V=dn(O).height,z=!(Math.abs(O.angle)<d.EPSILON||Math.abs(O.angle-d.PI/2)<d.EPSILON||Math.abs(O.angle-d.PI)<d.EPSILON||Math.abs(O.angle-3*d.PI/2)<d.EPSILON),Q=-2,K=0,J=0,ee=0,te=O.position;switch(e.type){case 0:z?(K=1,J=.8,ee=.5):(K=.7,J=.5,ee=.4);break;case 1:case 2:z?(K=1,J=.7,ee=.25):(K=.7,J=.5,ee=.25)}if(m=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(0,-V*K+Q),-O.angle)),v=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(0,2),-O.angle)),w=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(-W*ee+Q,-V*J),-O.angle)),y=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(W*ee-Q,-V*J),-O.angle)),k=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(-W*ee+Q,-V*K+Q),-O.angle)),b=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(W*ee-Q,-V*K+Q),-O.angle)),I=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(-W*ee+Q,2),-O.angle)),x=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(W*ee-Q,2),-O.angle)),1==e.type&&O.carrying&&Math.abs(O.angle)<d.EPSILON){var ne=dn(O.carrying).height,ae=O.speed.y>5?.7*ne:0;I.y+=ae,x.y+=ae,v.y+=ae,w.y+=ne*J+(0,q.random)(ne)-.5*ne,y.y=w.y}E=8&e.disable_wall,S=2&e.disable_wall,Y=4&e.disable_wall,$=1&e.disable_wall,nn=E,an=S,on=Y,rn=$,xn(!(4&e.disable_wall));var oe=yn(O,2,m,b,y,x,v,I,w,k,n,s,p,l,u,c,f,_,h);if(s=oe.up,c=oe.down,_=oe.left,l=oe.right,h=oe.upleft,p=oe.upright,f=oe.downleft,u=oe.downright,xn(!0),e.dying)return O.speed.x=0,O.speed.y=Math.min(L,O.speed.y+a*N),O.mirror=null,O.angle=0,O.visible=!0,e.blinking=!1,e.death_timer+=N,e.dead=e.death_timer>=2.5,O=fn(O,Pt(M,8)),(0,R.Y$)(0,O.speed.y*N+.5*a*N*N);if(e.dead)return(0,R.Y$)(0,0);var ie=vn(O,Q,s,p,l,u,c,f,_,h);switch(s=ie.up,p=ie.upright,l=ie.right,_=ie.left,h=ie.upleft,c=ie.down,f=ie.downleft,u=ie.downright,e.type){case 0:O.carry_offset=(0,R.Y$)(O.mirror&d.IF_HFLIP?7:-9,-40);break;case 1:case 2:O.carry_offset=(0,R.Y$)(O.mirror&d.IF_HFLIP?7:-7,-42)}if(null!=O.carried_by){var re,se=null,ce=0,le=0,_e=O.carried_by;for(re=0;re<t.length;re++)if(t[re]==e){le=re;break}for(re=0;re<t.length;re++)if(t[re].actor==_e){se=t[re],ce=re,e.disable_wall=se.disable_wall,e.entering_loop=se.entering_loop,e.at_loopfloortop=se.at_loopfloortop,e.bring_to_back=se.bring_to_back;break}if(se&&(1==se.type&&!se.flying||se.getting_hit||se.dying||se.dead))O.position=(0,R.Y$)(O.carried_by.position.x,O.carried_by.position.y),O.carried_by.carrying=null,O.carried_by=null;else{if(!(c&&0==c.brick_ref.angle&&parseInt(_e.speed.y,10)>=5||e.getting_hit||e.dying||e.dead)){var pe=le<ce?(0,R.GZ)(_e.speed,N):(0,R.Y$)(0,0);return O.speed=(0,R.Y$)(0,0),O.mirror=_e.mirror,O.angle=0,(O=fn(O,Pt(M,25))).position=(0,R.Zu)((0,R.qq)(_e.position,pe),O.carry_offset),(0,R.Y$)(0,0)}O.position=(0,R.Y$)(O.carried_by.position.x,O.carried_by.position.y),O.carried_by.carrying=null,O.carried_by=null}}if(e.entering_loop=!1,e.got_speedshoes&&(e.speedshoes_timer>23?e.got_speedshoes=!1:(F*=1.5,e.speedshoes_timer+=N)),eo(e)&&O.is_jumping&&(e.disable_wall&=-5),e.spring&&(c&&parseInt(O.speed.y,10)>=0||e.flying||e.climbing)&&(e.spring=!1),o=(l&&et(O.input,3)||_&&et(O.input,4))&&c,e.on_moveable_platform=(0,R.qU)(zp(c,O))>d.EPSILON,(r=c&&(O.angle>0&&O.angle<d.PI/2&&O.speed.x>0||O.angle>3*d.PI/2&&O.angle<2*d.PI&&O.speed.x<0))&&(h||p)||Math.abs(O.angle)<d.EPSILON||Math.abs(O.angle-d.PI)<d.EPSILON){if(l&&l.brick_ref.angle%90==0&&(O.speed.x>d.EPSILON||y.x>l.x)&&(!r||r&&90!=l.brick_ref.angle)&&(O.speed.x=0,O.position.x=l.x+(te.x-y.x),!O.is_jumping&&!e.flying&&!e.climbing&&Math.abs(O.speed.y)<d.EPSILON&&(X=Pt(M,o?14:0)),r))return(0,R.Y$)(-5,0);if(_&&_.brick_ref.angle%90==0&&(O.speed.x<-d.EPSILON||w.x<_.x+_.brick_ref.image.width)&&(!r||r&&270!=_.brick_ref.angle)&&(O.speed.x=0,O.position.x=_.x+_.brick_ref.image.width+(te.x-w.x),!O.is_jumping&&!e.flying&&!e.climbing&&Math.abs(O.speed.y)<d.EPSILON&&(X=Pt(M,o?14:0)),r))return(0,R.Y$)(5,0);O.position.x<=O.hot_spot.x&&(e.spin=!1,B=!0,O.position.x<O.hot_spot.x&&(O.speed.x=0,O.position.x=O.hot_spot.x,c&&(o=!0,X=Pt(M,1)))),O.position.x>=Dp().x-(dn(O).width-O.hot_spot.x)&&(e.spin=!1,U=!0,O.position.x>Dp().x-(dn(O).width-O.hot_spot.x)&&(O.speed.x=0,O.position.x=Dp().x-(dn(O).width-O.hot_spot.x),c&&(o=!0,X=Pt(M,1))))}if(!e.climbing){if(c){var de,ue,fe=c.brick_ref.angle;if(C=!0,O.ignore_horizontal=!1,e.is_fire_jumping=!1,O.is_jumping=!1,c.brick_ref&&3==c.brick_ref.behavior&&0==c.state&&(c.state=2),Math.abs(O.speed.x)<d.EPSILON){if(fe%180==0&&(e.spin=!1),et(O.input,2))e.spin_dash||(X=Pt(M,4)),tt(O.input,5)&&(X=Pt(M,6),e.spin_dash=!0,j(mt("charge")));else if(!o)if(et(O.input,1))H&&e.at_some_border||(X=Pt(M,5));else if(eo(e))X=Pt(M,0);else{var he=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(-8,0),-O.angle)),ge=(0,R.qq)(te,(0,R.EN)((0,R.Y$)(5,0),-O.angle)),me=(0,R.Y$)(0,0),be=yn(O,2,me,me,me,ge,me,he,me,me,n,null,null,null,void 0,null,void 0,null,null);be.downleft&&be.downright||e.on_moveable_platform?et(O.input,4)&&(B||e.at_some_border)||et(O.input,3)&&(U||e.at_some_border)?(O.mirror=B?d.IF_HFLIP:d.IF_NONE,X=Pt(M,1)):X=Pt(M,0):X=Pt(M,10)}if(e.spin_dash){var ye,xe,ve,Ie,we=O.mirror&d.IF_HFLIP?1:-1;for(ye=0;ye<3;ye++)(0,q.random)(128),Ie=It(1,1),Yt(Ie,255,255,255),xe=(0,R.Y$)(we*(7+(0,q.random)(7)),2),ve=(0,R.Y$)(we*(50+(0,q.random)(200)),-(0,q.random)(200)),Vp(Ie,(0,R.qq)(O.position,xe),ve,!0);(nt(O.input,2)||Np())&&(e.spin=!0,e.spin_dash=!1,(!(O.mirror&d.IF_HFLIP)||_||B)&&(O.mirror&d.IF_HFLIP||l||U)||(O.speed.x=(O.mirror&d.IF_HFLIP?-1:1)*F*1.35),j(mt("release")),e.disable_jump_for=.05)}}else if(et(O.input,2)&&(e.spin||j(mt("roll")),e.spin=!0),e.spin||e.braking){if(e.spin)X=Pt(M,3);else if(e.braking){var ke,Ee,Se,Ye=O.mirror&d.IF_HFLIP?1:-1;(0,q.random)(128),Se=It(1,1),ke=(0,R.Y$)(Ye*(10-(0,q.random)(21)),0),Ee=(0,R.Y$)(Ye*(50+(0,q.random)(200)),-(0,q.random)(200)),Vp(Se,(0,R.qq)(O.position,ke),Ee,!0),X=Pt(M,7),Math.abs(O.speed.x)<10&&(e.braking=!1)}}else{var $e=.75*F,Oe=.35*F;Math.abs(O.speed.x)<$e?!o&&O.speed.y>=0&&(X=Pt(M,1),O=function(e,t){return e.animation_speed_factor=Math.max(0,t),e}(O,.5+Math.abs(O.speed.x)/$e*1.5)):X=Pt(M,2),Math.abs(O.speed.x)>=Oe&&(et(O.input,3)&&O.speed.x<0||et(O.input,4)&&O.speed.x>0)&&(j(mt("brake")),e.braking=!0)}if(e.disable_jump_for=Math.max(e.disable_jump_for-N,0),Math.abs(O.speed.x)<d.EPSILON&&(e.disable_jump_for=0),de=!e.spin_dash,et(O.input,5)&&e.disable_jump_for<=0&&!et(O.input,2)&&!s&&!e.landing&&de&&!O.is_jumping&&(j(mt("jump")),O.angle=0,O.is_jumping=!0,e.is_fire_jumping=!0,Z=!0,e.spin=!1,X=Pt(M,3),0==fe?O.speed.y=1*-O.jump_strength:fe>0&&fe<90?fe>45?(O.speed.x=Math.min(O.speed.x,-.7*O.jump_strength*1),O.speed.y=-.7*O.jump_strength*1):(O.speed.x*=O.speed.x>0?.5:1,O.speed.y=1*-O.jump_strength):90==fe?(pn(O,(0,R.Y$)(-40,0)),O.speed.x=Math.min(O.speed.x,1*-O.jump_strength),O.speed.y=-O.jump_strength/2*1):fe>90&&fe<180?(pn(O,(0,R.Y$)(0,40)),O.speed.x=Math.min(O.speed.x,-.7*O.jump_strength*1),O.speed.y=1*O.jump_strength):180==fe?(pn(O,(0,R.Y$)(0,40)),O.speed.x*=-1,O.speed.y=1*O.jump_strength):fe>180&&fe<270?(pn(O,(0,R.Y$)(0,40)),O.speed.x=Math.max(O.speed.x,.7*O.jump_strength*1),O.speed.y=1*O.jump_strength):270==fe?(pn(O,(0,R.Y$)(40,0)),O.speed.x=Math.max(O.speed.x,1*O.jump_strength),O.speed.y=-O.jump_strength/2*1):fe>270&&fe<360&&(fe<315?(O.speed.x=Math.max(O.speed.x,.7*O.jump_strength*1),O.speed.y=-.7*O.jump_strength*1):(O.speed.x*=O.speed.x<0?.5:1,O.speed.y=1*-O.jump_strength))),!O.is_jumping){var Me;fe>0&&fe<90?(Me=.8*Math.min(1,Math.tan(fe*d.PI/180)),Math.abs(O.speed.y)>d.EPSILON?O.speed.x=C&&fe<=45?O.speed.x:Math.max(-1.2*F,-1*Me*O.speed.y):(ue=(O.mirror&d.IF_HFLIP?2:1)*Me,e.braking&&fe<45?ue*=8*(O.speed.x<0?-.5:1):Math.abs(O.speed.x)<5&&(ue*=25*Math.sin(fe*d.PI/180),e.lock_accel=2),O.speed.x=Math.max(O.speed.x-700*ue*N,-1.2*F))):fe>270&&fe<360&&(Me=.8*Math.min(1,-Math.tan(fe*d.PI/180)),Math.abs(O.speed.y)>d.EPSILON?O.speed.x=C&&fe>=315?O.speed.x:Math.min(1.2*F,1*Me*O.speed.y):(ue=(O.mirror&d.IF_HFLIP?1:2)*Me,e.braking&&fe>315?ue*=8*(O.speed.x>0?-.5:1):Math.abs(O.speed.x)<5&&(ue*=25*-Math.sin(fe*d.PI/180),e.lock_accel=1),O.speed.x=Math.min(O.speed.x+700*ue*N,1.2*F)))}fe%90==0&&(e.lock_accel=0),f&&u&&Math.abs(O.speed.x)<40&&f.brick_ref.angle>270&&f.brick_ref.angle<360&&u.brick_ref.angle>0&&u.brick_ref.angle<90&&(et(O.input,4)||et(O.input,3)||(O.speed.x=0))}else e.braking=!1,e.lock_accel=0,e.spin_dash&&(e.spin_dash=!1,X=Pt(M,1)),O.animation!=Pt(M,0)&&O.animation!=Pt(M,10)&&O.animation!=Pt(M,5)||(X=Pt(M,1)),(e.spring||H||O.speed.y<0)&&(e.spin=!1),eo(e)||(O.angle=0);if(c||e.is_fire_jumping&&O.speed.y<.88*-O.jump_strength&&nt(O.input,5)&&(O.speed.y*=.7),1==e.type&&e.flying?(D=e.flight_timer<10?.15:.8,L*=.3):D=1,G.y=Math.abs(O.speed.y)>d.EPSILON?O.speed.y*N+a*D*.5*(N*N):0,2==e.type&&e.flying||(O.speed.y=Math.min(O.speed.y+a*D*N,L)),i=s&&s.brick_ref.angle%90!=0&&Math.abs(O.angle)<d.EPSILON,s&&(s.brick_ref.angle%90==0||i)&&O.speed.y<-d.EPSILON&&(O.position.y=s.y+s.brick_ref.image.height+(te.y-m.y),O.speed.y=10,1==s.brick_ref.behavior&&Math.sin(s.brick_ref.behavior_arg[3]*s.value[0])>0))return O.speed.y=100,(0,R.qq)(G,(0,R.GZ)(zp(s,O),N));if((g=c)&&!O.is_jumping){var je=g.brick_ref.angle;if(O.speed.y=G.y=0,O.angle=je*d.PI/180,0==je){var Ne=zp(c,O);te.y=g.y,T=0,Ne.y>d.EPSILON?G.y+=Ne.y*N:O.position.y=te.y+Q+1}else if(je>0&&je<90)te.y=parseInt(g.y+g.brick_ref.image.height-(O.position.x-g.x)*Math.tan(O.angle),10),O.speed.x<0&&(te.y+=2),O.position.y=te.y+Q,O.mirror&d.IF_HFLIP||(T=.2);else if(90==je){if(Math.abs(O.speed.x)>5){var Pe=u?u.brick_ref.angle:-1;u&&Pe>=je&&Pe<je+90?e.flying||(O.position.x=g.x+Q):(O.angle=0,O.is_jumping=!0,e.spin||e.flying||(X=Pt(M,1)),eo(e)||(e.flying||pn(O,(0,R.Y$)(-13,0)),O.speed=(0,R.Y$)(0,-.9*Math.abs(O.speed.x))))}else O.angle=0,e.flying||pn(O,(0,R.Y$)(-10,0)),O.is_jumping=!0,O.ignore_horizontal=!1;O.mirror&d.IF_HFLIP||(T=1.5)}else je>90&&je<180?(Math.abs(O.speed.x)>5?(te.y=g.y-(O.position.x-g.x)*Math.tan(O.angle),O.position.y=te.y-Q):(O.angle=0,pn(O,(0,R.Y$)(0,30)),O.is_jumping=!0),T=1.5):180==je?(Math.abs(O.speed.x)>5?(te.y=g.y+g.brick_ref.image.height,O.position.y=te.y-Q,(O.speed.x>0&&!u||O.speed.x<0&&!f)&&(pn(O,(0,R.Y$)(0,-30)),O.is_jumping=!0,O.speed.x*=-1,O.mirror=O.speed.x<0?d.IF_HFLIP:d.IF_NONE,O.angle=0)):(O.angle=0,pn(O,(0,R.Y$)(0,40)),O.is_jumping=!0,O.speed.x=0),T=1.2):je>180&&je<270?(Math.abs(O.speed.x)>5?(te.y=g.y+g.brick_ref.image.height-(O.position.x-g.x)*Math.tan(O.angle),O.position.y=te.y-Q):(O.angle=0,pn(O,(0,R.Y$)(0,30)),O.is_jumping=!0),T=1.5):270==je?(Math.abs(O.speed.x)>5?(Pe=f?f.brick_ref.angle:-1,f&&Pe>je-90&&Pe<=je?e.flying||(O.position.x=g.x+g.brick_ref.image.width-Q):(O.angle=0,O.is_jumping=!0,e.spin||e.flying||(X=Pt(M,1)),eo(e)||(e.flying||pn(O,(0,R.Y$)(13,0)),O.speed=(0,R.Y$)(0,-.9*Math.abs(O.speed.x))))):(O.angle=0,e.flying||pn(O,(0,R.Y$)(10,0)),O.is_jumping=!0,O.ignore_horizontal=!1),O.mirror&d.IF_HFLIP&&(T=1.5)):je>270&&je<360&&(te.y=g.y-(O.position.x-g.x)*Math.tan(O.angle),O.speed.x>0&&(te.y+=2),O.position.y=te.y+Q,O.mirror&d.IF_HFLIP&&(T=.2))}if(G.x=Math.abs(O.speed.x)>d.EPSILON?O.speed.x*N+(1-T)*O.acceleration*.5*(N*N):0,!et(O.input,4)||et(O.input,3)||e.spin||e.braking||e.landing||e.getting_hit||1==e.lock_accel||B)if(!et(O.input,3)||et(O.input,4)||e.spin||e.braking||e.landing||e.getting_hit||2==e.lock_accel||U){if(c){var Le,Te=0,De=c.brick_ref.angle;Le=e.spin?.65:e.braking?4.5:e.landing?.6:1,De%90==0?Te=90==De?-1:270==De?1:O.speed.x>d.EPSILON?-1:-O.speed.x>d.EPSILON?1:0:(De>90&&De<180||De>180&&De<270)&&(Te=O.speed.x>d.EPSILON?-1:-O.speed.x>d.EPSILON?1:0),O.speed.x+=Te*Le*O.acceleration*N}}else O.ignore_horizontal||!(O.is_jumping||e.spring||H)&&et(O.input,2)||(O.mirror=!1,T=O.speed.x<0?-1:T,O.speed.x<=1.1*F&&(O.speed.x=Math.min(O.speed.x+(1-T)*O.acceleration*N,F)));else O.ignore_horizontal||!(O.is_jumping||e.spring||H)&&et(O.input,2)||(O.mirror=d.IF_HFLIP,T=O.speed.x>0?-1:T,O.speed.x>=1.1*-F&&(O.speed.x=Math.max(O.speed.x-(1-T)*O.acceleration*N,-F)))}switch(e.spring&&(X=Pt(M,O.speed.y<=0?13:1),O.speed.y>0&&(e.spring=!1,O.is_jumping=!1)),e.getting_hit&&(c?e.getting_hit=!1:X=Pt(M,11)),e.type){case 0:break;case 1:if(e.flight_timer+=N,c&&90!=c.brick_ref.angle&&270!=c.brick_ref.angle&&(e.flying=!1,e.flight_timer=0),(O.is_jumping&&O.speed.y>-O.jump_strength/3&&!Z&&!e.getting_hit||e.flying)&&tt(O.input,5)&&!e.getting_hit&&e.flight_timer<10&&(e.flying||(e.flight_timer=0),O.speed.y=.1*-Bp(),e.flying=!0,O.is_jumping=!1,e.is_fire_jumping=!1),e.flying)if(X=Pt(M,O.carrying?16:20),O.speed.x=(0,q.clip)(O.speed.x,-O.maxspeed/2,O.maxspeed/2),e.flight_timer>=10){var Fe=mt("tired of flying");P(Fe)||j(Fe),X=Pt(M,19)}else{var Ae,Re;for(eo(e)&&(O.angle=0),Ae=mt("flying"),P(Ae)||j(Ae),Re=0;Re<t.length&&null==O.carrying;Re++)if(t[Re]!=e&&parseInt(O.speed.y,10)<=0){var qe=[t[Re].actor.position.x+.3*dn(t[Re].actor).width,t[Re].actor.position.y,t[Re].actor.position.x+.7*dn(t[Re].actor).width,t[Re].actor.position.y+.2*dn(t[Re].actor).height],Ge=[O.position.x+.3*dn(O).width,O.position.y+.7*dn(O).height,O.position.x+.7*dn(O).width,O.position.y+dn(O).height],Ce=(0,q.bounding_box)(qe,Ge),He=!(null!=t[Re].actor.carried_by||t[Re].dying||t[Re].dead||t[Re].climbing||t[Re].landing||t[Re].getting_hit);Ce&&He&&!c&&(O.carrying=t[Re].actor,t[Re].actor.carried_by=O,t[Re].spin=t[Re].spin_dash=t[Re].braking=t[Re].flying=t[Re].spring=t[Re].on_moveable_platform=!1,j(mt("touch the wall")))}}else O.animation==Pt(M,O.carrying?16:20)&&(X=Pt(M,1));break;case 2:if((O.is_jumping&&O.speed.y>-.7*O.jump_strength||e.flying)&&tt(O.input,5)&&!c&&!e.getting_hit&&(O.speed.y=50,e.flying=!0,O.is_jumping=!1,e.is_fire_jumping=!1,O.speed.x=O.mirror&d.IF_HFLIP?Math.min(-100,O.speed.x):Math.max(100,O.speed.x)),e.flying){var Ue=et(O.input,4)&&O.speed.x>0||et(O.input,3)&&O.speed.x<0,Be=c&&Math.abs(c.brick_ref.angle*d.PI/180-0)<d.EPSILON;if(Ue+=O.animation==Pt(M,21)&&!hn(O),Be||O.animation==Pt(M,19)||e.landing||(O.mirror&d.IF_HFLIP?(X=Pt(M,Ue?21:20),O.speed.x=Math.max(O.speed.x-.5*O.acceleration*N,-F/2)):(X=Pt(M,Ue?21:20),O.speed.x=Math.min(O.speed.x+.5*O.acceleration*N,F/2))),Be)e.landing=!0,O.is_jumping=!1,X=Pt(M,19),O.speed.y=0,G.y=0,e.climbing=!1;else if(nt(O.input,5))e.flying=!1,X=Pt(M,18);else{var Ze,Xe=[_,f,l,u,c];for(Ze=0;Ze<Xe.length;Ze++)(g=Xe[Ze])&&g.brick_ref.angle%90!=0&&(e.flying=!1,e.landing=!1)}Be||s||(_&&_.brick_ref.angle%90==0||l&&l.brick_ref.angle%90==0)&&(e.climbing=!0,e.flying=!1,j(mt("touch the ground")))}if(e.landing&&(Math.abs(O.speed.x)<d.EPSILON||!c)&&(e.flying=e.landing=!1),e.climbing){var We=(0,R.Y$)(0,0);if(O.speed.x=G.x=0,_&&!l&&(O.mirror|=d.IF_HFLIP),l&&!_&&(O.mirror&=~d.IF_HFLIP),We=(0,R.qq)(We,(0,R.GZ)(zp(_,O),N)),((We=(0,R.qq)(We,(0,R.GZ)(zp(l,O),N))).y<=0&&!s||We.y>=0&&!c||!_&&l)&&(G=(0,R.qq)(G,We)),_||l)if(tt(O.input,5)){var Ve=Pt(M,17),ze=Pt(M,22);O.animation!=Ve&&O.animation!=ze||(e.climbing=!1,O.is_jumping=!0,e.is_fire_jumping=!0,O.speed.x=.7*(O.mirror&d.IF_HFLIP?1:-1)*O.jump_strength,O.speed.y=-.5*O.jump_strength,_&&!l&&(O.mirror&=~d.IF_HFLIP),!_&&l&&(O.mirror|=d.IF_HFLIP),X=Pt(M,3),j(mt("jump")))}else et(O.input,1)?s||(G.y=.1*-F*N,X=Pt(M,17)):et(O.input,2)?c?e.climbing=!1:(G.y=.1*F*N,X=Pt(M,17)):X=Pt(M,22);else(g=O.mirror&d.IF_HFLIP?f:u)?(X=Pt(M,23),O.ignore_horizontal=!0,G=(0,R.qq)(G,(0,R.GZ)(zp(g,O),N)),hn(O)&&(e.climbing=!1,O.ignore_horizontal=!1,O.speed=(0,R.Y$)((O.mirror&d.IF_HFLIP?-1:1)*F*.15,-Bp()/12.5),G.x=5*(O.mirror&d.IF_HFLIP?-1:1))):(e.climbing=!1,O.is_jumping=!0,X=Pt(M,3))}}return e.at_some_border=!1,X&&(O=fn(O,X)),Math.abs(O.speed.x)<4&&(e.braking=!1,(!et(O.input,3)&&!et(O.input,4)||et(O.input,3)&&et(O.input,4)||e.spin||e.landing)&&(G.x=0,O.speed.x=0)),G.x+=zp(c,O).x*N,G.x=O.position.x<=O.hot_spot.x&&O.speed.x<0?0:G.x,G.x=O.position.x>=Dp().x-(dn(O).width-O.hot_spot.x)&&O.speed.x>0?0:G.x,G},qa=function(e){var t,n,a=e.actor,o=!1;if(!e.blinking&&!e.dying&&!e.invincible)if(Ka(e),0!=e.shield_type)o=!0,e.shield_type=0,j(mt("death"));else if(Ce>0){for(o=!0,n=0;n<Math.min(Ua(),15);n++)(t=Xp(Fr,a.position)).is_moving=!0,t.actor.speed.x=t.actor.maxspeed*((0,q.random)(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+(0,q.random)(t.actor.jump_strength);Xa(0),j(mt("ringless"))}else Ga(e);o&&(e.getting_hit=!0,e.flying=e.landing=e.climbing=e.spring=!1,e.is_fire_jumping=!1,e.spin_dash=e.spin=!1,e.blinking=!0,e.blink_timer=0,a.speed.x=a.mirror&d.IF_HFLIP?200:-200,a.speed.y=-.75*a.jump_strength,pn(a,(0,R.Y$)(0,-5)))},Ga=function(e){e.dying||(Ka(e),e.shield_type=0,e.invincible=!1,e.got_speedshoes=!1,e.dying=!0,e.death_timer=0,e.spring=!1,e.actor.speed.y=1.2*-e.actor.jump_strength,e.flying=e.climbing=e.landing=!1,e.is_fire_jumping=!1,e.spin=e.spin_dash=!1,e.blinking=!1,j(mt("death")))},Ca=function(e){at(e.actor.input,5),e.spring=!1,e.actor.speed.y=-e.actor.jump_strength,e.actor.is_jumping=!0,e.is_fire_jumping=!1,e.flying=!1},Ha=function(e){var t=Pt(za(e.type),3);return e.spin||e.spin_dash||e.actor.animation==t||2==e.type&&(e.landing||e.flying)},Ua=function(){return Ce},Ba=function(){return La},Za=function(){return Ta},Xa=function(e){Ce=(0,q.clip)(e,0,9999),e/100>=He&&(He+=1,Wa(Ba()+1),Fp(mt("1up")))},Wa=function(e){La=e},Va=function(e){Ta=e},za=function(e){switch(e){case 0:return"SD_SONIC";case 1:return"SD_TAILS";case 2:return"SD_KNUCKLES";default:return"null"}},Qa=function(e){if(e&&e.actor){var t=0,n=e.actor.mirror&d.IF_HFLIP,a=!0,o=(0,q.old_school_angle)(e.actor.angle),i=(0,R.Y$)(0,0),r=(0,R.Zu)(e.actor.position,(0,R.EN)((0,R.Y$)(0,e.actor.hot_spot.y),-o)),s=e.actor.animation;switch(e.type){case 0:if(s==Pt(za(0),0))i=(0,R.Y$)(3,24),t=1;else if(s==Pt(za(0),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=2,i=(0,R.Y$)(5,23);break;case 1:t=2,i=(0,R.Y$)(4,25);break;case 2:t=1,i=(0,R.Y$)(7,25);break;case 3:case 4:t=1,i=(0,R.Y$)(5,23);break;case 5:t=1,i=(0,R.Y$)(4,24);break;case 6:t=2,i=(0,R.Y$)(6,24);break;case 7:t=2,i=(0,R.Y$)(6,23)}else if(s==Pt(za(0),2))t=1,i=(0,R.Y$)(8,26);else if(s==Pt(za(0),5))t=3,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(0,19):(0,R.Y$)(-1,21);else if(s==Pt(za(0),7))t=1,i=parseInt(e.actor.animation_frame,10)<2?(0,R.Y$)(8,26):(0,R.Y$)(10,28);else if(s==Pt(za(0),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(1,22);break;case 1:i=(0,R.Y$)(-1,23);break;case 2:i=(0,R.Y$)(1,23)}else s==Pt(za(0),11)?(t=3,i=(0,R.Y$)(-4,30)):s==Pt(za(0),12)?(t=3,i=(0,R.Y$)(1,19)):s==Pt(za(0),13)?(t=3,i=(0,R.Y$)(4,13)):s==Pt(za(0),14)?(t=1,i=(0,R.Y$)(12,31)):s==Pt(za(0),15)?(t=0,i=(0,R.Y$)(3,23)):s==Pt(za(0),25)?(t=0,i=(0,R.Y$)(3,22)):a=!1;break;case 1:if(s==Pt(za(1),0))i=(0,R.Y$)(5,34),t=1;else if(s==Pt(za(1),1))switch(t=2,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(2,33);break;case 1:case 5:i=(0,R.Y$)(3,33);break;case 2:i=(0,R.Y$)(8,33);break;case 3:case 7:i=(0,R.Y$)(3,32);break;case 4:i=(0,R.Y$)(1,33);break;case 6:i=(0,R.Y$)(7,33)}else if(s==Pt(za(1),2))t=2,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(7,35):(0,R.Y$)(6,34);else if(s==Pt(za(1),4))t=1,i=(0,R.Y$)(9,44);else if(s==Pt(za(1),5))t=1,i=(0,R.Y$)(7,32);else if(s==Pt(za(1),7))t=1,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(2,33):(0,R.Y$)(4,33);else if(s==Pt(za(1),10))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(5,33);break;case 1:i=(0,R.Y$)(6,33)}else if(s==Pt(za(1),11))t=1,i=(0,R.Y$)(1,33);else if(s==Pt(za(1),12))t=1,i=(0,R.Y$)(6,28);else if(s==Pt(za(1),13))t=3,i=(0,R.Y$)(2,17);else if(s==Pt(za(1),14))t=1,i=(0,R.Y$)(9,35);else if(s==Pt(za(1),15))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:case 8:case 9:case 10:i=(0,R.Y$)(5,34);break;default:i=(0,R.Y$)(5,33)}else s==Pt(za(1),16)?(t=1,i=(0,R.Y$)(8,37)):s==Pt(za(1),19)?(t=1,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(9,39):(0,R.Y$)(9,40)):s==Pt(za(1),20)?(t=1,i=(0,R.Y$)(8,39)):s==Pt(za(1),25)?(t=1,i=(0,R.Y$)(0,23)):a=!1;break;case 2:if(s==Pt(za(2),0))t=1,i=(0,R.Y$)(1,24);else if(s==Pt(za(2),1))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,i=(0,R.Y$)(5,29);break;case 1:t=2,i=(0,R.Y$)(5,29);break;case 2:t=2,i=(0,R.Y$)(8,29);break;case 3:t=2,i=(0,R.Y$)(9,28);break;case 4:t=1,i=(0,R.Y$)(6,28);break;case 5:t=1,i=(0,R.Y$)(6,29);break;case 6:t=1,i=(0,R.Y$)(5,28);break;case 7:t=1,i=(0,R.Y$)(4,27)}else if(s==Pt(za(2),2))t=1,i=(0,R.Y$)(7,29);else if(s==Pt(za(2),4))t=1,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(0,31):(0,R.Y$)(0,40);else if(s==Pt(za(2),5))t=1,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(0,21):(0,R.Y$)(-1,21);else if(s==Pt(za(2),7))t=0,i=(0,R.Y$)(-2,27);else if(s==Pt(za(2),10))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(9,30);break;case 1:i=(0,R.Y$)(8,27)}else if(s==Pt(za(2),11))t=1,i=(0,R.Y$)(-3,27);else if(s==Pt(za(2),12))t=1,i=(0,R.Y$)(5,24);else if(s==Pt(za(2),13))t=3,i=(0,R.Y$)(-1,16);else if(s==Pt(za(2),14))switch(parseInt(e.actor.animation_frame,10)){case 0:t=1,i=(0,R.Y$)(5,29);break;case 1:t=2,i=(0,R.Y$)(5,29);break;case 2:t=2,i=(0,R.Y$)(8,29);break;case 3:t=2,i=(0,R.Y$)(9,28);break;case 4:t=1,i=(0,R.Y$)(6,28);break;case 5:t=1,i=(0,R.Y$)(6,29);break;case 6:t=1,i=(0,R.Y$)(5,28);break;case 7:t=1,i=(0,R.Y$)(4,27)}else if(s==Pt(za(2),15))t=0,i=(0,R.Y$)(1,23);else if(s==Pt(za(2),16))switch(t=1,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(6,23);break;case 1:i=(0,R.Y$)(5,20);break;case 2:i=(0,R.Y$)(0,22)}else if(s==Pt(za(2),17))switch(t=3,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(-1,22);break;case 1:i=(0,R.Y$)(-2,20);break;case 2:i=(0,R.Y$)(0,21);break;case 3:i=(0,R.Y$)(-1,24);break;case 4:i=(0,R.Y$)(0,23);break;case 5:i=(0,R.Y$)(0,22)}else if(s==Pt(za(2),18))t=1,i=0==parseInt(e.actor.animation_frame,10)?(0,R.Y$)(6,23):(0,R.Y$)(5,20);else if(s==Pt(za(2),19))t=1,i=(0,R.Y$)(8,44);else if(s==Pt(za(2),20))t=1,i=(0,R.Y$)(8,39);else if(s==Pt(za(2),21))switch(t=4,parseInt(e.actor.animation_frame,10)){case 0:i=(0,R.Y$)(-8,41);break;case 1:i=(0,R.Y$)(0,43);break;case 2:i=(0,R.Y$)(10,41)}else if(s==Pt(za(2),22))t=3,i=(0,R.Y$)(0,22);else if(s==Pt(za(2),23))switch(parseInt(e.actor.animation_frame,10)){case 0:t=3,i=(0,R.Y$)(7,17);break;case 1:t=3,i=(0,R.Y$)(11,15);break;case 2:t=0,i=(0,R.Y$)(12,13)}else s==Pt(za(2),25)?(t=0,i=(0,R.Y$)(0,23)):a=!1}return i.x*=n?-1:1,e.glasses=fn(e.glasses,Pt("SD_GLASSES",t)),e.glasses.position=(0,R.qq)(r,(0,R.EN)(i,-o)),e.glasses.angle=o,e.glasses.mirror=e.actor.mirror,e.glasses.visible=a&&e.actor.visible,e}},Ka=function(e){},Ja=function(e){var t=e.shield,n=e.actor,a=(0,R.Y$)(0,0);switch(e.shield_type){case 1:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_SHIELD",0));break;case 2:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_FIRESHIELD",0));break;case 3:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_THUNDERSHIELD",0));break;case 4:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_WATERSHIELD",0));break;case 5:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_ACIDSHIELD",0));break;case 6:a=(0,R.Y$)(0,-22),t.position=(0,R.qq)(n.position,(0,R.EN)(a,-(0,q.old_school_angle)(n.angle))),t=fn(t,Pt("SD_WINDSHIELD",0))}},eo=function(e){return 0!==e.disable_wall},to=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_disappearing=!1,fn(e.actor,Pt("SD_BLUERING",0))},no=function(e){cn(e.actor)},ao=function(e,t,n,a,o,i){var r;for(r=0;r<n;r++){var s=t[r];s&&!s.dying&&gn(s.actor,e.actor)&&(e.state=Dr,Xa(Ua()+50),qp(5e3),j(mt("big ring")),Gp("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),Ud(Hd,Bd(Hd)+1))}},oo=function(e,t){ln(e.actor,t)},io=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_disappearing=!1,fn(e.actor,Pt("SD_BLUERING",0))},ro=function(e,t,n,a,o,i){var r=Pp(),s=e,c=e.actor;c.visible=r.got_glasses||Np(),s.is_disappearing?hn(c)&&(e.state=Dr):!r.dying&&r.got_glasses&&gn(c,r.actor)&&(fn(c,Pt("SD_BLUERING",1)),Xa(Ua()+5),j(mt("blue ring")),s.is_disappearing=!0)},so=function(e,t){ln(e.actor,t)},co=function(e){cn(e.actor)},lo=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.getting_hit=!1,fn(e.actor,Pt("SD_BUMPER",0))},_o=function(e,t,n,a,o,i){var r,s=e,c=e.actor;for(r=0;r<n;r++){var l=t[r];l&&!l.dying&&mn(l.actor,c)&&(s.getting_hit||(s.getting_hit=!0,fn(c,Pt("SD_BUMPER",1)),j(mt("bumper")),fo(e,l)))}s.getting_hit&&actor_animation_finished(c)&&(s.getting_hit=!1,fn(c,Pt("SD_BUMPER",0)))},po=function(e,t){ln(e.actor,t)},uo=function(e){cn(e.actor)},fo=function(e,t){var n,a,o,i=e.actor;(n=t.actor_speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),a=(0,R.GZ)((0,R.my)((0,R.Zu)(i.position,t.actor_position)),v2d_magnitude(n)),o=(0,R.GZ)(a,1),t.actor_speed=(0,R.GZ)((0,R.qq)(n,(0,R.GZ)(o,-1e4)),1/10001),i.speed=(0,R.GZ)((0,R.qq)(n,o),1/10001),t.flying=!1,t.landing=!1,t.climbing=!1,t.spring=!1},ho=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_active=!1,fn(e.actor,Pt("SD_CHECKPOINT",0))},go=function(e,t,n,a,o,i){var r,s=e,c=e.actor;if(s.is_active)hn(c)&&fn(c,Pt("SD_CHECKPOINT",2));else for(r=0;r<n;r++){var l=t[r];if(l&&!l.dying&&mn(l.actor,c)){s.is_active=!0,j(mt("checkpoint")),Ap(c.position),fn(c,Pt("SD_CHECKPOINT",1));break}}},mo=function(e,t){ln(e.actor,t)},bo=function(e){cn(e.actor)},yo=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),fn(e.actor,Pt("SD_ITEMBOX",10))},xo=function(e,t,n,a,o,i){},vo=function(e,t){ln(e.actor,t)},Io=function(e){cn(e.actor)},wo=function(e,t){var n={},a=n;return n.init=ko,n.release=Yo,n.update=Eo,n.render=So,a.sprite_name=e,a.player_is_vulnerable=t,n},ko=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),fn(e.actor,Pt(t.sprite_name,0))},Eo=function(e,t,n,a,o,i){var r,s=e,c=e.actor;for(r=0;r<n;r++){var l=t[r];l&&(l.dying||l.blinking||l.invincible||!gn(c,l.actor)||s.player_is_vulnerable(l)&&l.hit(l))}c.visible=Np()},So=function(e,t){ln(e.actor,t)},Yo=function(e){cn(e.actor)},$o=function(e){return!0},Oo=function(e){return 2!=e.shield_type},Mo=function(e,t){e.actor_speed=t},jo=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=sn(),fn(e.actor,Pt("SD_DANGPOWER",0))},No=function(e,t,n,a,o,i){var r,s=(0,A.dF)(),c=e.actor,l=(0,R.GZ)(c.speed,s);for(r=0;r<n;r++){var _=t[r];_&&!_.dying&&gn(c,_.actor)&&(_.hit(_),e.state=Dr)}c.position=(0,R.qq)(c.position,l)},Po=function(e,t){ln(e.actor,t)},Lo=function(e){cn(e.actor)},To=function(e,t){var n={},a=n;return n.init=Do,n.release=Ro,n.update=Fo,n.render=Ao,a.authorized_player_type=e,a.is_vertical_door=t,n},Do=function(e){var t,n,a=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=sn(),n=parseInt(a.authorized_player_type,10),t=a.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",fn(e.actor,Pt(t,n))},Fo=function(e,t,n,a,o,i){var r,s,c={},l=e.actor,_=!1,p=!1,d=(0,A.dF)(),u=[],f=[];for(e.obstacle=!0,s=0;s<n;s++){var h=t[s];h&&(h.dying||h.actor_carrying||h.actor_carried_by||!qo(h,e)||(h.type==c.authorized_player_type?(e.obstacle=!1,p=mn(l,h.actor)):_=!0))}if(_&&(e.obstacle=!0),e.obstacle?l.alpha=Math.min(1,l.alpha+2*d):p&&(l.alpha=Math.max(.4,l.alpha-2*d)),p)for(u[0]=l.position.x-l.hot_spot.x-5,u[1]=l.position.y-l.hot_spot.y-5,u[2]=u[0]+dn(l).width+10,u[3]=u[1]+dn(l).height+10,r=o;null!=r;r=r.next)r.data.type==e.type&&(f[0]=r.data.actor_position.x-r.data.actor_hot_spot.x-5,f[1]=r.data.actor_position.y-r.data.actor_hot_spot.y-5,f[2]=f[0]+dn(r.data.actor).width+10,f[3]=f[1]+dn(r.data.actor).height+10,(0,q.bounding_box)(u,f)&&(r.data.actor_alpha<l.alpha?l.alpha=r.data.actor_alpha:r.data.actor_alpha=l.alpha))},Ao=function(e,t){ln(e.actor,t)},Ro=function(e){cn(e.actor)},qo=function(e,t){var n=[],a=[],o=e.actor,i=t.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+dn(o).width,n[3]=n[1]+dn(o).height,a[0]=i.position.x-i.hot_spot.x,a[1]=i.position.y-i.hot_spot.y-3,a[2]=a[0]+dn(i).width,a[3]=a[1]+dn(i).height+3,(0,q.bounding_box)(n,a)},Go=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_closed=!0,fn(e.actor,Pt("SD_DOOR",0))},Co=function(e,t,n,a,o,i){var r=e,s=e.actor,c=(0,A.dF)();r.is_closed?s.position.y=parseInt(Math.min(s.position.y+2e3*c,s.spawn_point.y),10):s.position.y=parseInt(Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*dn(s).height),10)},Ho=function(e,t){ln(e.actor,t)},Uo=function(e){cn(e.actor)},Bo=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=sn(),t.who=null,fn(e.actor,Pt("SD_ENDSIGN",0))},Zo=function(e,t,n,a,o,i){var r,s=e,c=e.actor;if(null==s.who)for(r=0;r<n;r++){var l=t[r];l&&!l.dying&&mn(l.actor,c)&&(s.who=l,j(mt("end sign")),fn(c,Pt("SD_ENDSIGN",1)),Rp(e.actor))}else if(hn(c)){var _=2+s.who.type;fn(c,Pt("SD_ENDSIGN",_))}},Xo=function(e,t){ln(e.actor,t)},Wo=function(e){cn(e.actor)},Vo=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=sn(),fn(e.actor,Pt("SD_EXPLOSION",(0,q.random)(2)))},zo=function(e,t,n,a,o,i){hn(e.actor)&&(e.state=Dr)},Qo=function(e,t){ln(e.actor,t)},Ko=function(e){cn(e.actor)},Jo=function(e){e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=actor.create(),fn(e.actor,Pt("SD_GLASSES",4)),e.actor.hot_spot.y*=.5},ei=function(e,t,n,a,o,i){var r=e.actor,s=(0,A.dF)();r.angle+=Math.sign(r.speed.x)*(6*d.PI*s),r.position=(0,R.qq)(r.position,function(e,t){var n=(0,A.dF)(),a=(0,R.Y$)(0,0);return a.x=e.speed.x*n,a.y=e.speed.y*n+.5*t*n*n,e.speed.y+=t*n,a}(r,Bp()))},ti=function(e,t){ln(e.actor,t)},ni=function(e){cn(e.actor)},ai=function(e,t){On(e.font,t)},oi=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=sn(),t.elapsed_time=0,t.font=$n(0),On(t.font,"0"),fn(e.actor,Pt("SD_RING",0)),e.actor.visible=!1},ii=function(e,t,n,a,o,i){var r=e,s=(0,A.dF)();r.elapsed_time+=s,r.elapsed_time<.5?e.actor.position.y-=100*s:r.elapsed_time>2&&(e.state=Dr),r.font.position=e.actor.position},ri=function(e,t){Pn(e.font,t)},si=function(e){var t=e;cn(e.actor),t.font},ci=function(e,t,n,a){var o,i,r=d.INFINITY_FLT,s=null;for(o=t;o;o=o.next)o.data&&o.data.type==n&&(i=(0,R.Zu)(o.data.actor.position,e.actor.position),(0,R.qU)(i)<r&&(s=o.data,r=(0,R.qU)(i)));return a&&(a.dist=r),s},li=function(e){e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),fn(e.actor,Pt("SD_GOAL",0))},_i=function(e,t,n,a,o,i){var r,s=ci(e,o,Hr,null);r=null!=s?s.actor.position.x>e.actor.position.x?0:1:0,fn(e.actor,Pt("SD_GOAL",r))},pi=function(e,t){ln(e.actor,t)},di=function(e){cn(e.actor)},ui=function(e,t){fn(e.actor,Pt("SD_ICON",t))},fi=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!1,e.actor=sn(),t.elapsed_time=0,ui(e,0)},hi=function(e,t,n,a,o,i){var r=e,s=e.actor,c=(0,A.dF)();if(r.elapsed_time+=c,r.elapsed_time<1)s.position.y-=40*c;else if(r.elapsed_time>=2.5){var l,_,p,d=parseInt(s.position.x-s.hot_spot.x,10),u=parseInt(s.position.y-s.hot_spot.y,10),f=dn(s);for(l=0;l<f.h;l++)for(_=0;_<f.w;_++)p=It(1,1),Yt(p,255,255,255),Vp(p,(0,R.Y$)(d+_,u+l),(0,R.Y$)(_-f.width/2+((0,q.random)(f.width)-f.width/2),l-(0,q.random)(f.height/2)),!1);e.state=Dr}},gi=function(e,t){ln(e.actor,t)},mi=function(e){cn(e.actor)},bi=function(e,t){Tp(100),Wa(Ba()+1),Fp(mt("1up"))},yi=function(e,t){Tp(100),Xa(Ua()+10),j(mt("ring"))},xi=function(e,t){Tp(100),t.invincible=!0,t.invtimer=0,E(k("data/music/invincible.mp4"),0)},vi=function(e,t){Tp(100),t.got_speedshoes=!0,t.speedshoes_timer=0,E(k("data/music/speed.mp4"),0)},Ii=function(e,t){Tp(100),t.got_glasses=!0},wi=function(e,t){Tp(100),t.shield_type=1,j(mt("shield"))},ki=function(e,t){Tp(100),t.shield_type=2,j(mt("fire shield"))},Ei=function(e,t){Tp(100),t.shield_type=3,j(mt("thunder shield"))},Si=function(e,t){Tp(100),t.shield_type=4,j(mt("water shield"))},Yi=function(e,t){Tp(100),t.shield_type=5,j(mt("acid shield"))},$i=function(e,t){Tp(100),t.shield_type=6,audio.sound_play(mt("wind shield"))},Oi=function(e,t){player_hit(t)},Mi=function(e,t){Tp(100)},ji=function(e,t){var n={},a=n;return n.init=Ni,n.release=Ti,n.update=Pi,n.render=Li,a.on_destroy=e,a.anim_id=t,n},Ni=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!1,e.preserve=!0,e.actor=sn(),fn(e.actor,Pt("SD_ITEMBOX",t.anim_id))},Pi=function(e,t,n,a,o,i){var r,s=e.actor,c=e;for(r=0;r<n;r++){var l=t[r];if(l&&!(l.actor.is_jumping&&l.actor.speed.y<-10)&&e.state===Tr&&Di(e,l)&&Ha(l)){console.log("ITEM BOX HIT");var _=Xp(Rr,(0,R.qq)(s.position,(0,R.Y$)(0,-5)));_.change_animation(_,c.anim_id),Xp(qr,(0,R.qq)(s.position,(0,R.Y$)(0,-20))),Xp(Ar,s.position),j(mt("destroy")),l.actor.is_jumping&&l.bounce(l),c.on_destroy(e,l),e.state=Dr}}c.anim_id=c.anim_id<t.length?Lp():c.anim_id,fn(e.actor,Pt("SD_ITEMBOX",c.anim_id))},Li=function(e,t){ln(e.actor,t)},Ti=function(e){cn(e.actor)},Di=function(e,t){var n,a=e.actor.position;return n=gn(e.actor,t.actor),e.actor.position=a,n},Fi=function(e,t){var n={},a=n;return n.init=Ai,n.release=Ri,n.update=qi,n.render=Gi,a.on_collision=e,a.sprite_name=t,n},Ai=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=sn(),e.actor=fn(e.actor,Pt(t.sprite_name,0))},Ri=function(e){},qi=function(e,t,n,a,o,i){var r,s=e,c=e.actor;for(c.visible=!1,r=0;r<n;r++){var l=t[r];l&&gn(c,l.actor)&&(l.at_loopfloortop=Ci(e,o,l),s.on_collision(l))}},Gi=function(e,t){ln(e.actor,t)},Ci=function(e,t,n){var a=ci(e,t,Ur,null);return null!=a&&gn(n.actor,a.actor)},Hi=function(e){e.disable_wall|=8,e.entering_loop=!0,e.bring_to_back=!1},Ui=function(e){if(!e.flying){var t=e.actor.speed.x>0;e.disable_wall&=-11,e.disable_wall|=t?2:8,e.bring_to_back=t}},Bi=function(e){e.disable_wall|=2,e.entering_loop=!0,e.bring_to_back=!0},Zi=function(e){e.entering_loop||(e.disable_wall=0,e.bring_to_back=!1)},Xi=function(e){e.at_loopfloortop||e.flying||(e.disable_wall|=4,e.entering_loop=!0,e.bring_to_back=!0)},Wi=function(e){e.at_loopfloortop||e.entering_loop||e.flying||(e.disable_wall&=-5,e.bring_to_back=!1)},Vi=function(e){if(!e.flying)if(4&e.disable_wall){var t=e.actor.speed.x>0;e.disable_wall&=-11,e.disable_wall|=t?2:8,e.bring_to_back=!0}else e.disable_wall&=-11,e.bring_to_back=!0},zi=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!1,e.preserve=!0,e.actor=sn(),e.actor.maxspeed=220+(0,q.random)(140),e.actor.jump_strength=1.2*(350+(0,q.random)(50)),e.actor.input=ze(),t.is_disappearing=!1,t.is_moving=!1,t.life_time=0,fn(e.actor,Pt("SD_RING",0))},Qi=function(e){},Ki=function(e,t,n,a,o,i){var r,s=(0,A.dF)(),c=e,l=e.actor;for(r=0;r<n;r++){var _=t[r];if(_&&(!c.is_moving||c.is_moving&&!_.getting_hit&&c.life_time>=.5)&&!c.is_disappearing&&!_.dying&&gn(l,_.actor)){Xa(Ua()+1),c.is_disappearing=!0,j(mt("ring"));break}}if(c.is_disappearing)fn(l,Pt("SD_RING",1)),hn(l)&&(e.state=Dr);else if(c.is_moving){if(at(l.input,5),e.preserve=!1,c.life_time+=s,c.life_time>5){var p=240+(0,q.random)(20);l.visible=parseInt(((0,A.$I)(),10))<p/2,c.life_time>8&&(e.state=Dr)}pn(l,In(l,a,Bp()))}},Ji=function(e,t){ln(e.actor,t)},er=function(e,t,n){var a={},o=a;return a.init=tr,a.release=nr,a.update=ar,a.render=or,o.collision=e,o.anim_id=t,o.cycle_length=n,a},tr=function(e){var t=e;e.obstacle=!0,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.timer=0,t.hidden=!1,fn(e.actor,Pt("SD_SPIKES",t.anim_id))},nr=function(e){cn(e.actor)},ar=function(e,t,n,a,o,i){var r,s=e,c=(0,A.dF)();if(s.timer+=c,s.timer>=.5*s.cycle_length&&(s.timer=0,s.hidden=!s.hidden,j(mt(s.hidden?"spikes disappearing":"spikes appearing"))),e.obstacle=!s.hidden,e.actor.visible=!s.hidden,!s.hidden)for(r=0;r<n;r++){var l=t[r];if(l&&!l.dying&&!l.blinking&&!l.invincible&&s.collision(e,l)){var _=mt("spikes hit");P(_)||j(_),qa(l)}}},or=function(e,t){ln(e.actor,t)},ir=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+dn(a).width,n[3]=n[1]+dn(a).height,(0,q.bounding_box)(n,t)},rr=function(e,t){var n,a=[],o=e.actor;return a[0]=o.position.x-o.hot_spot.x+5,a[1]=o.position.y-o.hot_spot.y-5,a[2]=a[0]+dn(o).width-10,a[3]=a[1]+10,n=t.actor.position.y-t.actor.hot_spot.y+dn(t.actor).height,ir(t,a)&&n<o.position.y-o.hot_spot.y+dn(o).height/2},sr=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+5,n[1]=a.position.y-a.hot_spot.y+dn(a).height-5,n[2]=n[0]+dn(a).width-10,n[3]=n[1]+10,ir(t,n)},cr=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x+dn(a).width-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+dn(a).height-10,ir(t,n)},lr=function(e,t){var n=[],a=e.actor;return n[0]=a.position.x-a.hot_spot.x-5,n[1]=a.position.y-a.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+dn(a).height-10,ir(t,n)},_r=function(e,t,n){var a={};return a.init=pr,a.release=dr,a.update=ur,a.render=fr,a.on_bump=e,a.sprite_name=t,a.strength=n,a},pr=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_bumping=!1,t.bang_timer=0,fn(e.actor,Pt(t.sprite_name,0))},dr=function(e){},ur=function(e,t,n,a,o,i){var r,s=e,c=(0,A.dF)();for(s.bang_timer+=c,r=0;r<n;r++){var l=t[r];l&&!l.dying&&mn(l.actor,e.actor)&&s.on_bump(e,l)}s.is_bumping&&hn(e.actor)&&(fn(e.actor,Pt(s.sprite_name,0)),s.is_bumping=!1)},fr=function(e,t){ln(e.actor,t)},hr=function(e,t){t.actor.speed.y>=1&&!t.actor.carrying&&!t.actor.carried_by&&mr(e,t)},gr=function(e,t){mr(e,t)},mr=function(e,t){var n=e;e.is_bumping=!0,function(e,t){var n=(0,A.dF)(),a=[],o=[];a[0]=t.x*e.actor.speed.x>=0,a[1]=t.y*e.actor.speed.y>=0,o[0]=t.x*e.actor.speed.x<=0&&Math.abs(t.x)>d.EPSILON,o[1]=t.y*e.actor.speed.y<=0&&Math.abs(t.y)>d.EPSILON,Math.abs(t.y)>d.EPSILON&&(e.spring=!0),e.flying=!1,e.climbing=!1,e.landing=!1,e.getting_hit=!1,e.is_fire_jumping=!1,(Math.abs(t.x)>Math.abs(e.actor.speed.x)&&a[0]||o[0])&&(e.actor.speed.x=t.x),(Math.abs(t.y)>Math.abs(e.actor.speed.y)&&a[1]||o[1])&&(e.actor.speed.y=t.y,e.actor.position.y+=e.actor.speed.y*n)}(t,e.strength),fn(n.actor,Pt(e.sprite_name,1)),e.strength.x>d.EPSILON?t.actor.mirror&=~d.IF_HFLIP:e.strength.x<-d.EPSILON&&(t.actor.mirror|=d.IF_HFLIP),e.bang_timer>.2&&(j(mt("spring")),e.bang_timer=0)},br=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_disabled=!1,t.is_active=!1,t.timer=0,fn(e.actor,Pt("SD_TELEPORTER",0))},yr=function(e,t,n,a,o,i){var r,s=e,c=e.actor,l=(0,A.dF)(),_=0;if(s.is_active){if(s.timer+=l,s.timer>=3){var p=s.who;for(it(p.actor.input),Md(p.actor),r=0;r<n;r++){var d=t[r];if(d!=p){var u=(0,R.qq)(c.position,(0,R.Y$)(40*_++-20,-30));Ir(d,u)}}s.is_active=!1,s.is_disabled=!0}fn(c,Pt("SD_TELEPORTER",1))}else fn(c,Pt("SD_TELEPORTER",0))},xr=function(e,t){ln(e.actor,t)},vr=function(e){cn(e.actor)},Ir=function(e,t){e&&(e.actor.position=t,e.actor.speed=(0,R.Y$)(0,0),e.actor.is_jumping=!1,e.flying=!1,e.climbing=!1,e.getting_hit=!1,e.spring=!1,e.actor.angle=0,e.disable_wall=0,e.entering_loop=!1,e.at_loopfloortop=!1,e.bring_to_back=!1)},wr=function(e){var t=e;e.obstacle=!1,e.bring_to_back=!0,e.preserve=!0,e.actor=sn(),t.is_pressed=!1,t.partner=null,fn(e.actor,Pt("SD_SWITCH",0))},kr=function(e){cn(e.actor)},Er=function(e,t,n,a,o,i){var r,s,c=e,l={},_={};c.partner=null,r=ci(e,o,Gr,l),s=ci(e,o,Cr,_),null!=r&&l.dist<_.dist&&(c.partner=r),null!=s&&_.dist<l.dist&&(c.partner=s),null==c.partner?Yr(e,r,t,n,$r,Or):c.partner==r?Yr(e,r,t,n,Mr,jr):c.partner==s&&Yr(e,s,t,n,Nr,Pr)},Sr=function(e,t){ln(e.actor,t)},Yr=function(e,t,n,a,o,i){var r,s=!0,c=e,l=e.actor;for(r=0;r<a;r++){var _=n[r];Lr(e,_)&&(s=!1,c.is_pressed||(o(t,_),j(mt("switch")),fn(l,Pt("SD_SWITCH",1)),c.is_pressed=!0))}s&&c.is_pressed&&(i(t),fn(l,Pt("SD_SWITCH",0)),c.is_pressed=!1)},$r=function(e,t){},Or=function(e){},Mr=function(e,t){!function(e){e.is_closed=!1,j(mt("open door"))}(e)},jr=function(e){!function(e){e.is_closed=!0,j(mt("close door"))}(e)},Nr=function(e,t){!function(e,t){var n=e,a=e.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=t,ot(t.actor.input),Md(a),j(mt("teleporter")))}(e,t)},Pr=function(e){},Lr=function(e,t){if(!e)return!1;if(!t)return!1;var n=[],a=[];return n[0]=e.actor.position.x-e.actor.hot_spot.x,n[1]=e.actor.position.y-e.actor.hot_spot.y,n[2]=n[0]+dn(e.actor).width,n[3]=n[1]+dn(e.actor).height,a[0]=t.actor.position.x-t.actor.hot_spot.x+.3*dn(t.actor).width,a[1]=t.actor.position.y-t.actor.hot_spot.y+.5*dn(t.actor).height,a[2]=a[0]+.4*dn(t.actor).width,a[3]=a[1]+.5*dn(t.actor).height,!t.dying&&!t.climbing&&!t.flying&&(0,q.bounding_box)(n,a)},Tr=0,Dr=1,Fr=0,Ar=9,Rr=10,qr=12,Gr=26,Cr=27,Hr=31,Ur=35,Br=function(e){var t=null;switch(e){case Fr:t=function(){var e={};return e.init=zi,e.release=Qi,e.update=Ki,e.render=Ji,e}();break;case 1:t=ji(bi,0);break;case 2:t=ji(yi,3);break;case 3:t=ji(xi,4);break;case 4:t=ji(vi,5);break;case 5:t=ji(Ii,6);break;case 6:t=ji(wi,7);break;case 42:t=ji(ki,11);break;case 78:t=ji(Ei,12);break;case 79:t=ji(Si,13);break;case 80:t=ji(Yi,14);break;case 81:t=ji($i,15);break;case 7:t=ji(Oi,8);break;case 8:t=ji(Mi,9);break;case Ar:t=function(){var e={};return e.init=yo,e.release=Io,e.update=xo,e.render=vo,e}();break;case Rr:t=function(){var e={};return e.init=fi,e.release=mi,e.update=hi,e.render=gi,e.change_animation=ui,e}();break;case 11:t=function(){var e={};return e.init=Jo,e.release=ni,e.update=ei,e.render=ti,e}();break;case qr:t=function(){var e={};return e.init=Vo,e.release=Ko,e.update=zo,e.render=Qo,e}();break;case 13:t=function(){var e={};return e.init=oi,e.release=si,e.update=ii,e.render=ri,e.set_text=ai,e}();break;case 15:t=function(){var e={};return e.init=ya,e.release=xa,e.update=va,e.render=Ia,e}();break;case 16:t=Fi(Hi,"SD_LOOPRIGHT");break;case 17:t=Fi(Ui,"SD_LOOPMIDDLE");break;case 18:t=Fi(Bi,"SD_LOOPLEFT");break;case 19:t=Fi(Zi,"SD_LOOPNONE");break;case 33:t=Fi(Xi,"SD_LOOPFLOOR");break;case 34:t=Fi(Wi,"SD_LOOPFLOORNONE");break;case Ur:t=Fi(Vi,"SD_LOOPFLOORTOP");break;case 20:t=_r(hr,"SD_YELLOWSPRING",(0,R.Y$)(0,-500));break;case 54:t=_r(gr,"SD_BYELLOWSPRING",(0,R.Y$)(0,500));break;case 50:t=_r(gr,"SD_TRYELLOWSPRING",(0,R.Y$)(400,-600));break;case 48:t=_r(gr,"SD_RYELLOWSPRING",(0,R.Y$)(600,0));break;case 52:t=_r(gr,"SD_BRYELLOWSPRING",(0,R.Y$)(400,600));break;case 53:t=_r(gr,"SD_BLYELLOWSPRING",(0,R.Y$)(-400,600));break;case 49:t=_r(gr,"SD_LYELLOWSPRING",(0,R.Y$)(-600,0));break;case 51:t=_r(gr,"SD_TLYELLOWSPRING",(0,R.Y$)(-400,-600));break;case 21:t=_r(hr,"SD_REDSPRING",(0,R.Y$)(0,-750));break;case 47:t=_r(gr,"SD_BREDSPRING",(0,R.Y$)(0,750));break;case 43:t=_r(gr,"SD_TRREDSPRING",(0,R.Y$)(800,-1e3));break;case 22:t=_r(gr,"SD_RREDSPRING",(0,R.Y$)(1200,0));break;case 45:t=_r(gr,"SD_BRREDSPRING",(0,R.Y$)(800,1e3));break;case 46:t=_r(gr,"SD_BLREDSPRING",(0,R.Y$)(-800,1e3));break;case 23:t=_r(gr,"SD_LREDSPRING",(0,R.Y$)(-1200,0));break;case 44:t=_r(gr,"SD_TLREDSPRING",(0,R.Y$)(-800,-1e3));break;case 55:t=_r(hr,"SD_BLUESPRING",(0,R.Y$)(0,-1500));break;case 62:t=_r(gr,"SD_BBLUESPRING",(0,R.Y$)(0,1500));break;case 58:t=_r(gr,"SD_TRBLUESPRING",(0,R.Y$)(1800,-1500));break;case 56:t=_r(gr,"SD_RBLUESPRING",(0,R.Y$)(2e3,0));break;case 60:t=_r(gr,"SD_BRBLUESPRING",(0,R.Y$)(1800,1500));break;case 61:t=_r(gr,"SD_BLBLUESPRING",(0,R.Y$)(-1800,1500));break;case 57:t=_r(gr,"SD_LBLUESPRING",(0,R.Y$)(-2e3,0));break;case 59:t=_r(gr,"SD_TLBLUESPRING",(0,R.Y$)(-1800,-1500));break;case 24:t=function(){var e={};return e.init=io,e.release=co,e.update=ro,e.render=so,e}();break;case 25:t=function(){var e={};return e.init=wr,e.release=kr,e.update=Er,e.render=Sr,e}();break;case Gr:pp.length>1&&(t=function(){var e={};return e.init=Go,e.release=Uo,e.update=Co,e.render=Ho,e}());break;case Cr:t=function(){var e={};return e.init=br,e.release=vr,e.update=yr,e.render=xr,e}();break;case 28:t=function(){var e={};return e.init=to,e.release=no,e.update=ao,e.render=oo,e}();break;case 29:t=function(){var e={};return e.init=ho,e.release=bo,e.update=go,e.render=mo,e}();break;case 30:t=function(){var e={};return e.init=li,e.release=di,e.update=_i,e.render=pi,e}();break;case Hr:t=function(){var e={};return e.init=Bo,e.release=Wo,e.update=Zo,e.render=Xo,e}();break;case 32:t=function(){var e={},t=e;return e.init=wa,e.release=ka,e.update=Ea,e.render=Sa,t.state=null,e}();break;case 36:t=function(){var e={};return e.init=lo,e.release=uo,e.update=_o,e.render=po,e}();break;case 37:t=wo("SD_DANGER",$o);break;case 75:t=wo("SD_VERTICALDANGER",$o);break;case 76:t=wo("SD_FIREDANGER",Oo);break;case 77:t=wo("SD_VERTICALFIREDANGER",Oo);break;case 38:t=er(rr,0,d.INFINITY_FLT);break;case 63:t=er(sr,2,d.INFINITY_FLT);break;case 64:t=er(cr,1,d.INFINITY_FLT);break;case 65:t=er(lr,3,d.INFINITY_FLT);break;case 66:t=er(rr,0,5);break;case 67:t=er(sr,2,5);break;case 68:t=er(cr,1,5);break;case 69:t=er(lr,3,5);break;case 39:t=To(0,!0);break;case 70:t=To(1,!0);break;case 71:t=To(2,!0);break;case 72:t=To(0,!1);break;case 73:t=To(1,!1);break;case 74:t=To(2,!1);break;case 40:case 41:t=function(){var e={};return e.init=jo,e.release=Lo,e.update=No,e.render=Po,e.dangerouspower_set_speed=Mo,e}()}return null!=t&&(t.type=e,t.state=Tr,t.init(t)),t},Zr=function(e,t,n,a,o,i){e.update(e,t,n,a,o,i)},Xr=function(e,t){e.render(e,t)},Wr=function(e){},Vr=function(e){},zr=function(e,t,n,a,o,i){},Qr=function(e,t){var n=e.get_object_instance(e).actor,a=n.position;n.position=(0,R.Y$)(parseInt(n.position.x,10),parseInt(n.position.y,10)),ln(n,t),n.position=a},Kr=function(e){return e.object},Jr=function(e){return e.reference_to_current_state},es=function e(t,n){return null!=t?t.name?t:e(t.next,n):null},ts=function(e){var t=e.decorated_machine;return t.get_object_instance(t)},ns=function(e){var t=e.decorated_machine;t.init(t)},as=function(e){},os=function(e,t,n,a,o,i){var r,s=e.decorated_machine,c=e,l=e.get_object_instance(e),_=(0,A.dF)();r=(0,R.GZ)(c.speed,_),l.actor.position=(0,R.qq)(l.actor.position,r),s.update(s,t,n,a,o,i)},is=function(e,t){var n=e.decorated_machine;n.render(n,t)},rs=function(e){var t=e.decorated_machine;t&&t.init(t)},ss=function(e){},cs=function(e,t,n,a,o,i){var r,s=e.decorated_machine,c=e,l=e.get_object_instance(e);for(r=0;r<n;r++){var _=t[r];_&&mn(l.actor,_.actor)&&(Ha(_)||_.invincible?(_.actor.is_jumping&&Ca(_),Tp(c.score),Xp(qr,(0,R.qq)(l.actor.position,(0,R.Y$)(0,-15))),Qp(l.actor.position),j(mt("destroy")),l.state=y_):_.hit(_))}s&&s.update(s,t,n,a,o,i)},ls=function(e,t){var n=e.decorated_machine;n.render(n,t)},_s=function(e){var t=e.decorated_machine;t.init(t)},ps=function(e){},ds=function(e,t,n,a,o,i){var r=e.decorated_machine,s=e,c=e.get_object_instance(e).actor,l=(0,A.dF)(),_=null,p=null,d=null,u=null,f=null,h=null,g=null,m=null,b=.001*(0,A.$I)(),y=c.position;c.position.x+=-s.amplitude_x*s.angularspeed_x*Math.sin(s.initialphase_x+s.angularspeed_x*b)*l,c.position.y+=s.amplitude_y*s.angularspeed_y*Math.cos(s.initialphase_y+s.angularspeed_y*b)*l;var x=bn(c,0,0,a,_,p,d,u,f,h,g,m);_=x.up,p=x.upright,d=x.right,u=x.downright,f=x.down,h=x.downleft,g=x.left,m=x.upleft;var v=vn(c,0,_,p,d,u,f,h,g,m);_=v.up,p=v.upright,d=v.right,u=v.downright,f=v.down,h=v.downleft,g=v.left,m=v.upleft,null!=d&&c.position.x>y.x&&(c.position.x=c.hot_spot.x-dn(c).width+d.x),null!=g&&c.position.x<y.x&&(c.position.x=c.hot_spot.x+g.x+Qt(g).width),null!=f&&c.position.y>y.y&&(c.position.y=c.hot_spot.y-dn(c).height+f.y),null!=_&&c.position.y<y.y&&(c.position.y=c.hot_spot.y+_.y+Qt(_).height),r.update(r,t,n,a,o,i)},us=function(e,t){var n=e.decorated_machine;n.render(n,t)},fs=function(e){var t=e.decorated_machine;t.init(t)},hs=function(e){},gs=function(e,t,n,a,o,i){var r=e.decorated_machine,s=e.get_object_instance(e).actor;pn(s,In(s,a,Bp())),r.update(r,t,n,a,o,i)},ms=function(e,t){var n=e.decorated_machine;n.render(n,t)},bs=function(e,t){var n={};return n.init=ys,n.release=xs,n.update=vs,n.render=Is,n.get_object_instance=ts,n.decorated_machine=e,n.look_strategy=t,n},ys=function(e){var t=e.decorated_machine;t.init(t)},xs=function(e){},vs=function(e,t,n,a,o,i){var r=e.decorated_machine,s=e;t[0]&&s.look_strategy(s,t[0]),r.update(r,t,n,a,o,i)},Is=function(e,t){var n=e.decorated_machine;n.render(n,t)},ws=function(e){var t=e;t.get_object_instance(t).actor.mirror&=~d.IF_HFLIP},ks=function(e){var t=e;t.get_object_instance(t).actor.mirror|=d.IF_HFLIP},Es=function(e){var t=e,n=t.get_object_instance(t),a=b_(n);a&&(n.actor.position.x<a.actor.position.x?n.actor.mirror&=~d.IF_HFLIP:n.actor.mirror|=d.IF_HFLIP)},Ss=function(e){var t=e,n=t.get_object_instance(t);n.actor.position.x>e.old_x?n.actor.mirror&=~d.IF_HFLIP:n.actor.mirror|=d.IF_HFLIP,e.old_x=n.actor.position.x},Ys=function(e){var t=e.decorated_machine;t.init(t)},$s=function(e){},Os=function(e,t,n,a,o,i){var r=e.decorated_machine,s=e,c=e.get_object_instance(e),l=b_(c);if(l){var _=(0,R.Zu)(l.actor.position,c.actor.position);if((0,R.qU)(_)>=5){var p=(0,A.dF)(),d=(0,R.my)(_),u=(0,R.GZ)(d,s.speed*p);c.actor.position=(0,R.qq)(c.actor.position,u)}}r.update(r,t,n,a,o,i)},Ms=function(e,t){var n=e.decorated_machine;n.render(n,t)},js=function(e){var t=e.decorated_machine;Ts(e),t.init(t)},Ns=function(e){},Ps=function(e,t,n,a,o,i){Ts(e)},Ls=function(e,t){var n=e.decorated_machine;n.render(n,t)},Ts=function(e){var t=e,n=e.get_object_instance(e);fn(n.actor,t.anim)},Ds=function(e){var t=e.decorated_machine;t.init(t)},Fs=function(e){},As=function(e,t,n,a,o,i){var r=e.decorated_machine,s=e,c=e.get_object_instance(e).actor,l=(0,A.dF)(),_=null,p=null,d=null,u=null,f=null,h=null,g=null,m=null;c.position.x+=s.direction*s.speed*l;var b=bn(c,2,-2,a,_,p,d,u,f,h,g,m);_=b.up,p=b.upright,d=b.right,u=b.downright,f=b.down,h=b.downleft,g=b.left,m=b.upleft;var y=vn(c,-2,_,p,d,u,f,h,g,m);_=y.up,p=y.upright,d=y.right,u=y.downright,f=y.down,h=y.downleft,g=y.left,m=y.upleft,null!=d&&s.direction>0&&(c.position.x=c.hot_spot.x-dn(c).width+d.x,s.direction=-1),null!=g&&s.direction<0&&(c.position.x=c.hot_spot.x+g.x+Qt(g).width,s.direction=1),null!=f&&(null==u&&null!=h?s.direction=-1:null==h&&null!=u&&(s.direction=1)),r.update(r,t,n,a,o,i)},Rs=function(e,t){var n=e.decorated_machine;n.render(n,t)},qs={},Gs=[{command:"set_animation",action:function(e,t,n){var a,o,i,r;return 2==t?(a=e,o=n[0],i=n[1],(r={}).init=js,r.release=Ns,r.update=Ps,r.render=Ls,r.get_object_instance=ts,r.decorated_machine=a,r.anim=Pt(o,i),e=r):(0,I.logfile_fatal_error)("Object script error - set_animation expects two parameters: sprite_name, animation_id"),e}},{command:"set_obstacle",action:function(e,t,n){1==t?e=objectdecorator_setobstacle_new(e,n[0],0):2==t?e=objectdecorator_setobstacle_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]")}},{command:"set_alpha",action:function(e,t,n){1==t?e=objectdecorator_setalpha_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))")}},{command:"hide",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,0):(0,I.logfile_fatal_error)("Object script error - hide expects no parameters")}},{command:"show",action:function(e,t,n){0==t?e=objectdecorator_setalpha_new(e,1):(0,I.logfile_fatal_error)("Object script error - show expects no parameters")}},{command:"enemy",action:function(e,t,n){return 1==t?e=function(e,t){var n={};return n.init=rs,n.release=ss,n.update=cs,n.render=ls,n.get_object_instance=ts,n.decorated_machine=e,n.score=t,n}(e,n):(0,I.logfile_fatal_error)("Object script error - enemy expects one parameter: score"),e}},{command:"lock_camera",action:function(e,t,n){4==t?e=objectdecorator_lockcamera_new(e,n[0],n[1],n[2],n[3]):(0,I.logfile_fatal_error)("Object script error - lock_camera expects four parameters: x1, y1, x2, y2")}},{command:"move_player",action:function(e,t,n){2==t?e=objectdecorator_moveplayer_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - move_player expects two parameters: speed_x, speed_y")}},{command:"hit_player",action:function(e,t,n){0==t?e=objectdecorator_hitplayer_new(e):(0,I.logfile_fatal_error)("Object script error - hit_player expects no parameters")}},{command:"burn_player",action:function(e,t,n){0==t?e=objectdecorator_burnplayer_new(e):(0,I.logfile_fatal_error)("Object script error - burn_player expects no parameters")}},{command:"shock_player",action:function(e,t,n){0==t?e=objectdecorator_shockplayer_new(e):(0,I.logfile_fatal_error)("Object script error - shock_player expects no parameters")}},{command:"acid_player",action:function(e,t,n){0==t?e=objectdecorator_acidplayer_new(e):(0,I.logfile_fatal_error)("Object script error - acid_player expects no parameters")}},{command:"add_rings",action:function(e,t,n){1==t?e=objectdecorator_addrings_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - add_rings expects one parameter: number_of_rings")}},{command:"add_to_score",action:function(e,t,n){1==t?e=objectdecorator_addtoscore_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - add_to_score expects one parameter: score")}},{command:"set_player_animation",action:function(e,t,n){2==t?e=objectdecorator_setplayeranimation_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - set_player_animation expects two parameters: sprite_name, animation_id")}},{command:"enable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_enableplayermovement_new(e):(0,I.logfile_fatal_error)("Object script error - enable_player_movement expects no parameters")}},{command:"disable_player_movement",action:function(e,t,n){0==t?e=objectdecorator_disableplayermovement_new(e):(0,I.logfile_fatal_error)("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayerxspeed_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - set_player_xspeed expects one parameter: speed")}},{command:"set_player_yspeed",action:function(e,t,n){1==t?e=objectdecorator_setplayeryspeed_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - set_player_yspeed expects one parameter: speed")}},{command:"set_player_position",action:function(e,t,n){2==t?e=objectdecorator_setplayerposition_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - set_player_position expects two parameters: xpos, ypos")}},{command:"bounce_player",action:function(e,t,n){0==t?e=objectdecorator_bounceplayer_new(e):(0,I.logfile_fatal_error)("Object script error - bounce_player expects no parameters")}},{command:"observe_player",action:function(e,t,n){1==t?e=objectdecorator_observeplayer_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - observe_player expects one parameter: player_name")}},{command:"observe_current_player",action:function(e,t,n){0==t?e=objectdecorator_observecurrentplayer_new(e):(0,I.logfile_fatal_error)("Object script error - observe_current_player expects no parameters")}},{command:"observe_active_player",action:function(e,t,n){0==t?e=objectdecorator_observeactiveplayer_new(e):(0,I.logfile_fatal_error)("Object script error - observe_active_player expects no parameters")}},{command:"observe_all_players",action:Bs},{command:"observe_next_player",action:Bs},{command:"attach_to_player",action:function(e,t,n){0==t?e=objectdecorator_attachtoplayer_new(e,0,0):1==t?e=objectdecorator_attachtoplayer_new(e,n[0],0):2==t?e=objectdecorator_attachtoplayer_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]")}},{command:"springfy_player",action:function(e,t,n){0==t?e=objectdecorator_springfyplayer_new(e):(0,I.logfile_fatal_error)("Object script error - springfy_player expects no parameters")}},{command:"roll_player",action:function(e,t,n){0==t?e=objectdecorator_rollplayer_new(e):(0,I.logfile_fatal_error)("Object script error - roll_player expects no parameters")}},{command:"walk",action:function(e,t,n){var a,o,i;return 1==t?(a=e,o=n,(i={}).init=Ds,i.release=Fs,i.update=As,i.render=Rs,i.get_object_instance=ts,i.decorated_machine=a,i.speed=o,i.direction=-1,e=i):(0,I.logfile_fatal_error)("Object script error - walk expects one parameter: speed"),e}},{command:"gravity",action:function(e,t,n){var a,o,i;return 0==t?(a=e,i=o={},o.init=fs,o.release=hs,o.update=gs,o.render=ms,o.get_object_instance=ts,i.decorated_machine=a,e=o):(0,I.logfile_fatal_error)("Object script error - gravity expects no parameters"),e}},{command:"jump",action:function(e,t,n){1==t?e=objectdecorator_jump_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - jump expects one parameter: jump_strength")}},{command:"move",action:Zs},{command:"bullet_trajectory",action:Zs},{command:"elliptical_trajectory",action:function(e,t,n){var a,o,i,r,s,c,l,_;return t>=4&&t<=6?(a=e,o=n[0],i=n[1],r=n[2],s=n[3],c=n[4],l=n[5],(_={}).init=_s,_.release=ps,_.update=ds,_.render=us,_.get_object_instance=ts,_.decorated_machine=a,_.amplitude_x=o,_.amplitude_y=i,_.angularspeed_x=r*(2*d.PI),_.angularspeed_y=s*(2*d.PI),_.initialphase_x=c*d.PI/180,_.initialphase_y=l*d.PI/180,e=_):(0,I.logfile_fatal_error)("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),e}},{command:"mosquito_movement",action:function(e,t,n){var a,o,i;return 1==t?(a=e,o=n,(i={}).init=Ys,i.release=$s,i.update=Os,i.render=Ms,i.get_object_instance=ts,i.decorated_machine=a,i.speed=o,e=i):(0,I.logfile_fatal_error)("Object script error - mosquito_movement expects one parameter: speed"),e}},{command:"look_left",action:function(e,t,n){0==t?e=bs(e,ws):(0,I.logfile_fatal_error)("Object script error - look_left expects no parameters")}},{command:"look_right",action:function(e,t,n){0==t?e=bs(e,ks):(0,I.logfile_fatal_error)("Object script error - look_right expects no parameters")}},{command:"look_at_player",action:function(e,t,n){return 0==t?e=bs(e,Es):(0,I.logfile_fatal_error)("Object script error - look_at_player expects no parameters"),e}},{command:"look_at_walking_direction",action:function(e,t,n){return 0==t?e=bs(e,Ss):(0,I.logfile_fatal_error)("Object script error - look_at_walking_direction expects no parameters"),e}},{command:"create_item",action:function(e,t,n){3==t?e=objectdecorator_createitem_new(e,n[0],n[1],n[2]):(0,I.logfile_fatal_error)("Object script error - create_item expects three parameters: item_id, offset_x, offset_y")}},{command:"change_closest_object_state",action:function(e,t,n){2==t?e=objectdecorator_changeclosestobjectstate_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name")}},{command:"create_child",action:function(e,t,n){3==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],""):4==t?e=objectdecorator_createchild_new(e,n[0],n[1],n[2],n[3]):(0,I.logfile_fatal_error)("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]")}},{command:"change_child_state",action:function(e,t,n){2==t?e=objectdecorator_changechildstate_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - change_child_state expects two parameters: child_name, new_state_name")}},{command:"change_parent_state",action:function(e,t,n){1==t?e=objectdecorator_changeparentstate_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - change_parent_state expects one parameter: new_state_name")}},{command:"destroy",action:function(e,t,n){0==t?e=objectdecorator_destroy_new(e):(0,I.logfile_fatal_error)("Object script error - destroy expects no parameters")}},{command:"change_state",action:function(e,t,n){1==t?e=objectdecorator_ontimeout_new(e,0,n[0]):(0,I.logfile_fatal_error)("Object script error - change_state expects one parameter: new_state_name")}},{command:"on_timeout",action:function(e,t,n){2==t?e=objectdecorator_ontimeout_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name")}},{command:"on_collision",action:function(e,t,n){2==t?e=objectdecorator_oncollision_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - on_collision expects two parameters: object_name, new_state_name")}},{command:"on_animation_finished",action:function(e,t,n){1==t?e=objectdecorator_onanimationfinished_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_animation_finished expects one parameter: new_state_name")}},{command:"on_random_event",action:function(e,t,n){2==t?e=objectdecorator_onrandomevent_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name")}},{command:"on_player_collision",action:function(e,t,n){1==t?e=objectdecorator_onplayercollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_player_collision expects one parameter: new_state_name")}},{command:"on_player_attack",action:function(e,t,n){1==t?e=objectdecorator_onplayerattack_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_player_attack expects one parameter: new_state_name")}},{command:"on_player_rect_collision",action:function(e,t,n){5==t?e=objectdecorator_onplayerrectcollision_new(e,n[0],n[1],n[2],n[3],n[4]):(0,I.logfile_fatal_error)("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name")}},{command:"on_no_shield",action:function(e,t,n){1==t?e=objectdecorator_onnoshield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_no_shield expects one parameter: new_state_name")}},{command:"on_shield",action:function(e,t,n){1==t?e=objectdecorator_onshield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_shield expects one parameter: new_state_name")}},{command:"on_fire_shield",action:function(e,t,n){1==t?e=objectdecorator_onfireshield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_fire_shield expects one parameter: new_state_name")}},{command:"on_thunder_shield",action:function(e,t,n){1==t?e=objectdecorator_onthundershield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_thunder_shield expects one parameter: new_state_name")}},{command:"on_water_shield",action:function(e,t,n){1==t?e=objectdecorator_onwatershield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_water_shield expects one parameter: new_state_name")}},{command:"on_acid_shield",action:function(e,t,n){1==t?e=objectdecorator_onacidshield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_acid_shield expects one parameter: new_state_name")}},{command:"on_wind_shield",action:function(e,t,n){1==t?e=objectdecorator_onwindshield_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_wind_shield expects one parameter: new_state_name")}},{command:"on_brick_collision",action:function(e,t,n){1==t?e=objectdecorator_onbrickcollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_brick_collision expects one parameter: new_state_name")}},{command:"on_floor_collision",action:function(e,t,n){1==t?e=objectdecorator_onfloorcollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_floor_collision expects one parameter: new_state_name")}},{command:"on_ceiling_collision",action:function(e,t,n){1==t?e=objectdecorator_onceilingcollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_ceiling_collision expects one parameter: new_state_name")}},{command:"on_left_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onleftwallcollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_left_wall_collision expects one parameter: new_state_name")}},{command:"on_right_wall_collision",action:function(e,t,n){1==t?e=objectdecorator_onrightwallcollision_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - on_right_wall_collision expects one parameter: new_state_name")}},{command:"show_dialog_box",action:function(e,t,n){2==t?e=objectdecorator_showdialogbox_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - show_dialog_box expects two parameters: title, message")}},{command:"hide_dialog_box",action:function(e,t,n){0==t?e=objectdecorator_hidedialogbox_new(e):(0,I.logfile_fatal_error)("Object script error - hide_dialog_box expects no parameters")}},{command:"clear_level",action:function(e,t,n){0==t?e=objectdecorator_clearlevel_new(e):(0,I.logfile_fatal_error)("Object script error - clear_level expects no parameters")}},{command:"play_sample",action:function(e,t,n){1==t?e=objectdecorator_playsample_new(e,n[0],1,0,1,0):2==t?e=objectdecorator_playsample_new(e,n[0],n[1],0,1,0):3==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],1,0):4==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],0):5==t?e=objectdecorator_playsample_new(e,n[0],n[1],n[2],n[3],n[4]):(0,I.logfile_fatal_error)("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]")}},{command:"play_music",action:function(e,t,n){1==t?e=objectdecorator_playmusic_new(e,n[0],0):2==t?e=objectdecorator_playmusic_new(e,n[0],n[1]):(0,I.logfile_fatal_error)("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]")}},{command:"play_level_music",action:function(e,t,n){0==t?e=objectdecorator_playlevelmusic_new(e):(0,I.logfile_fatal_error)("Object script error - play_level_music expects no parameters")}},{command:"set_music_volume",action:function(e,t,n){1==t?e=objectdecorator_setmusicvolume_new(e,n[0]):(0,I.logfile_fatal_error)("Object script error - set_music_volume expects one parameter: volume")}},{command:null,action:null}],Cs=function(e,t){return function(e,t){var n,a,o,i=t;if(0===i.state){var r=e.state.name;for(i.state,i.vm.state_list=(a=i.vm,o=e.state.list,null==es(a.state_list,o)&&(a.state_list=function(e,t,n){var a,o,i,r={};return r.name=t,r.data=(a=n,(i=o={}).init=Wr,i.release=Vr,i.update=zr,i.render=Qr,i.get_object_instance=Kr,i.basic=!0,o.object=a,i),r.next=e,r}(a.state_list,o,a.owner)),a.state_list),i.vm=function(e,t){var n=es(e.state_list,t);return null!=n?e.reference_to_current_state=n.data:(0,I.logfile_message)('Object script error: can\'t find state "%s".',t),e}(i.vm,r),n=Jr(i.vm),Ue=0,function(e,t){Ue<1024?(qs[Ue]={},qs[Ue].stmt=e,qs[Ue].machine=t,Ue++):(0,I.logfile_message)("Object script error: you may write %d commands or less per state",1024)}(e.state.list,n);Ue-- >0;)n=Hs(qs[Ue].stmt,qs[Ue].machine);n&&n.init(n)}return i.vm.reference_to_current_state=n,e.destroy_if_far_from_play_area&&(i.preserve=!1),e.always_active&&(i.always_active=!0),e.hide_unless_in_editor_mode&&(i.hide_unless_in_editor_mode=!0),i}(t,e)};function Hs(e,t){var n,a,o,i,r=e;for(a=r.length,n=0;n<a;n++)i=(o=r[n])[1]&&void 0!==o[1]?o[1].length?o[1].length:1:0,t=Us(t,o[0],i,o[1]);return t}function Us(e,t,n,a){for(var o=0,i=Gs[o++];null!=i.command&&null!=i.action;)i.command==t&&(e=i.action(e,n,a)),i=Gs[o++];return e}function Bs(e,t,n){0==t?e=objectdecorator_observeallplayers_new(e):(0,I.logfile_fatal_error)("Object script error - observe_all_players expects no parameters")}function Zs(e,t,n){var a,o,i,r;return 2==t?(a=e,o=n[0],i=n[1],(r={}).init=ns,r.release=as,r.update=os,r.render=is,r.get_object_instance=ts,r.decorated_machine=a,r.speed=(0,R.Y$)(o,i),e=r):(0,I.logfile_fatal_error)("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),e}var Xs,Ws,Vs,zs,Qs,Ks,Js,ec,tc,nc,ac,oc,ic,rc,sc,cc,lc,_c,pc,dc,uc,fc,hc,gc,mc,bc,yc,xc,vc,Ic,wc,kc,Ec,Sc,Yc,$c,Oc,Mc,jc,Nc,Pc,Lc,Tc,Dc,Fc,Ac,Rc,qc,Gc,Cc,Hc,Uc,Bc,Zc,Xc,Wc,Vc,zc,Qc,Kc,Jc,el,tl,nl,al,ol,il,rl,sl,cl,ll,_l,pl,dl,ul,fl,hl,gl,ml,bl,yl,xl,vl,Il,wl,kl,El,Sl,Yl,$l,Ol,Ml,jl,Nl,Pl,Ll,Tl,Dl,Fl,Al,Rl,ql,Gl,Cl,Hl,Ul,Bl,Zl,Xl,Wl,Vl,zl,Ql,Kl,Jl,e_,t_,n_,a_,o_,i_,r_,s_,c_,l_,__,p_,d_,u_,f_=[],h_=function(e){return x_(e)},g_=function(e,t,n,a,o,i){if(e){var r=Jr(e.vm);r.update(r,t,n,a,o,i)}},m_=function(e,t){if(e){var n=Jr(e.vm);(!e.hide_unless_in_editor_mode||e.hide_unless_in_editor_mode&&Np())&&n.render(n,t)}},b_=function(e){return null!=e.observed_player?e.observed_player:Pp()},y_=1,x_=function(e){var t,n={},a={};return n.name=e,n.state=0,n.actor=sn(),n.actor.input=ze(),n.actor=fn(n.actor,Pt("SD_QUESTIONMARK",0)),n.preserve=!0,n.obstacle=!1,n.obstacle_angle=0,n.always_active=!1,n.hide_unless_in_editor_mode=!1,n.vm=((t={}).owner=n,t.state_list=null,t.reference_to_current_state=null,t),n.created_from_editor=!0,n.parent=null,n.children=I_(),n.observed_player=null,a.in_object_name=e,a.out_object_block=null,a.out_object_block=v_(Xs,a),null!=a.out_object_block?n=Cs(n,a.out_object_block):(0,I.logfile_message)("Object '%s' does not exist",e),n},v_=function(e,t){var n=e[t.in_object_name];return n?(t.in_object_name,n):((0,I.logfile_message)("Object script error: unknown keyword '%s'",n),0)},I_=function(){return null},w_=[],k_=function(){return Ws},E_=function(e){return Ws>0?(e=(0,q.clip)(e,0,Ws-1),w_[e]):null},S_=function e(t){return null!=t&&(t.next=e(t.next),t=null,t=null),t},Y_=!1,$_=[38,40,39,37,78,66,17,123],O_=[87,83,68,65,90,89,71,80],M_={},j_={},N_=0,P_=0,L_=[Fr,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,Gr,Cr,28,29,30,Hr,32,33,34,Ur,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],T_=0,D_=function(){return Y_},F_=function(){console.log("SAVE");var e=Sp();Yp(e),j(mt("level saved"))},A_=function(){var e,t=(0,A.dF)();e=et(Js,7)?3750:750,(et(Js,1)||et(ec,1))&&(M_.y-=e*t),(et(Js,2)||et(ec,2))&&(M_.y+=e*t),(et(Js,4)||et(ec,4))&&(M_.x-=e*t),(et(Js,3)||et(ec,3))&&(M_.x+=e*t),M_.x=parseInt(Math.max(M_.x,240),10),M_.y=parseInt(Math.max(M_.y,135.5),10),ma(M_)},R_=function(e){switch(e){case 1:return"brick";case 2:return"built-in item";case 3:return"object";case 4:return"group"}return"unknown"},q_=function(e,t){switch(e){case 1:Wt(t);break;case 2:Br(t)}return""},G_=function e(){N_=0,P_=0,4==(tc=1==tc?2:2==tc?3:3==tc?4:4==tc?1:tc)&&0==k_()&&e()},C_=function e(){N_=0,P_=0,4==(tc=2==tc?1:3==tc?2:4==tc?3:1==tc?4:tc)&&0==k_()&&e()},H_=function e(){var t;switch(tc){case 1:t=Vt(),null==Wt(N_=(N_+1)%t)&&e();break;case 2:N_=L_[P_=(P_+1)%(t=oc)];break;case 3:N_=(N_+1)%(t=rc);break;case 4:t=k_(),N_=(N_+1)%t}},U_=function e(){var t;switch(tc){case 1:t=Vt(),null==Wt(N_=(N_-1+t)%t)&&e();break;case 2:N_=L_[P_=(P_-1+(t=oc))%t];break;case 3:N_=(N_-1+(t=rc))%t;break;case 4:t=k_(),N_=(N_-1+t)%t}},B_=function(e){var t;for(t=0;t<oc;t++)if(e==L_[t])return t;return-1},Z_=function e(t,n,a){var o=null,i=(0,R.Y$)(0,0);switch(t){case 1:null!=Wt(n)&&(o=Wt(n).image);break;case 2:var r=Br(n);null!=r&&(o=dn(r.actor),(i=r.actor.hot_spot).y-=2);break;case 3:var s=h_(W_(n));null!=s&&(o=dn(s.actor),(i=s.actor.hot_spot).y-=2);break;case 4:var c;for(c=E_(n);c;c=c.next)e(EDITORGRP_ENTITY_TO_EDT(c.entity.type),c.entity.id,(0,R.qq)(a,c.entity.position))}null!=o&&kt(o.data,ne(),o.sx,o.sy,parseInt(a.x-i.x,10),parseInt(a.y-i.y,10),o.swidth,o.sheight)},X_=function(e){var t;for(t=0;t<rc;t++)if(e==ic[t])return t;return-1},W_=function(e){return null},V_=function(){T_=!1},z_=function(){},Q_=function(){tt(ec,7)&&(T_=!T_)},K_=function(e){var t=(0,R.Zu)(M_,(0,R.Y$)(240,135.5)),n=parseInt(t.x%1,10),a=parseInt(t.y%1,10),o=-n+1*parseInt(e.x/1,10),i=-a+1*parseInt(e.y/1,10);return(0,R.qq)(t,(0,R.Y$)(o,i))},J_=function(e,t,n,a){var o={};return o.type=e?1:2,o.obj_type=t,o.obj_id=n,o.obj_position=a,o},ep=function(e,t,n){var a={};return a.type=e?3:4,a.obj_position=t,a.obj_old_position=n,a},tp=function(){cc=ap(cc),sc=null,lc=null},np=function e(t){console.log("REGISTER",t);var n,a=!1;if(4!=t.obj_type){var o,i,r;for((r={}).action=t,r.in_group=a,r.in_group&&(r.group_key=n),null!=(o=lc)&&(o.next=ap(o.next)),i=sc;null!=i.next;)i=i.next;i.next=r,r.prev=i,r.next=null,lc=r}else{var s,c=48879;for(a=!0,n=c++,s=E_(t.obj_id);s;s=s.next){var l=s.entity,_=EDITORGRP_ENTITY_TO_EDT(l.type);e(J_(!0,_,l.id,(0,R.qq)(l.position,t.obj_position)))}a=!1}},ap=function(e){var t,n;for(t=e;null!=t;)n=t.next,t=null,t=n;return null},op=function e(){var t,n;lc!=cc&&(t=lc,lc=lc.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&e(),(n=t.action).type=1==n.type?2:2==n.type?1:3==n.type?4:4==n.type?3:n.type,rp(n))},ip=function e(){var t,n;null!=lc.next&&((t=lc=lc.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&e(),n=t.action,rp(n))},rp=function e(t){if(console.log("COMMIT",t),1==t.type)switch(t.obj_type){case 1:Zp(t.obj_id,t.obj_position);break;case 2:Xp(t.obj_id,t.obj_position);break;case 3:Wp(W_(t.obj_id),t.obj_position);break;case 4:var n;for(n=E_(t.obj_id);n;n=n.next){var a=n.entity,o=EDITORGRP_ENTITY_TO_EDT(a.type);e(J_(!0,o,a.id,(0,R.qq)(a.position,t.obj_position)))}}else if(2==t.type)switch(t.obj_type){case 1:var i,r=Wt(t.obj_id);for(i=_c;i;i=i.next)i.data.brick_ref==r&&(0,R.qU)((0,R.Zu)((0,R.Y$)(i.data.x,i.data.y),t.obj_position))<d.EPSILON&&(i.data.state=1);break;case 2:var s,c=t.obj_id;for(s=item_list;s;s=s.next)s.data.type==c&&(0,R.qU)((0,R.Zu)(s.data.actor.position,t.obj_position))<d.EPSILON&&(s.data.state=IS_DEAD);break;case 3:var l,_=t.obj_id;for(l=enemy_list;l;l=l.next)X_(l.data.name)==_&&(0,R.qU)((0,R.Zu)(l.data.actor.position,t.obj_position))<d.EPSILON&&(l.data.state=ES_DEAD)}else 3==t.type?(Ap(t.obj_position),td()):4==t.type&&(Ap(t.obj_old_position),td())},sp=function(e,t){_p(e,t,!0),ln(e.actor,t),_p(e,t,!1)},cp=function(e){return 1==e.state},lp=function(e,t){var n;for(n=0;n<t.length&&1!=e.state;n++)if(t[n]&&mn(e.actor,t[n].actor))return!(!t[n].attacking(t[n])&&!t[n].invincible&&(t[n].hit(t[n]),1));return!1},_p=function(e,t,n){var a=e.actor,o=.001*(0,A.$I)();if(3===e.type){var i,r=(0,R.Y$)(0,0);if(Lt(Pt("SD_INVSTAR",0),1),1!=e.state)for(i=0;i<5;i++)r.x=a.position.x+20*Math.cos(2*d.PI*o+2*i*d.PI/5),r.y=a.position.y+20*Math.sin(d.PI*o+2*i*d.PI/5)}},pp=[0,1,2],dp=G,up="data/levels/blue_ocean_1.json",fp=null,hp=[],gp=[],mp=[],bp=[],yp={position:{x:0,y:0}},xp=[],vp=[],Ip=[],wp=[],kp=[],Ep=function(e){up=e,(0,I.logfile_message)("level_setfile('%s')",e)},Sp=function(){return up},Yp=function(e){var t,n,a,o,i,r={name:pc,act:gc,theme:uc,bgtheme:fc,grouptheme:hc,spawn_point:vc,music:dc,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};Nd()&&(r.boss={id:Oc.type,x:Oc.actor.spawn_point.x,y:Oc.actor.spawn_point.y,rx:Oc.rect_x,ry:Oc.rect_y,rw:Oc.rect_w,rh:Oc.rect_h});var s=[];for(a=fp;a;a=a.next)s.push({id:ad(a.data),xpos:a.data.sx,ypos:a.data.sy});r.bricklist=s;var c=[];for(o=hp;o;o=o.next)o.data&&c.push({id:o.data.type,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.itemlist=c;var l=[];for(i=gp;i;i=i.next)i.data&&i.data.created_from_editor&&l.push({id:i.data.name,xpos:i.data.actor.spawn_point.x,ypos:i.data.actor.spawn_point.y});r.enemylist=l;var _=[];for(t=0,n=kp.length;t<n;t++)_.push({xpos:kp[t].rect_x,ypos:kp[t].rect_y,width:kp[t].rect_w,height:kp[t].rect_h,title:kp[t].title,message:kp[t].message});r.dialogbox=_;var p=e.split("/");p=p[p.length-1],console.log("saveFile",e,r),(0,I.logfile_message)("level_save() ok")},$p=function(){var e;dp=G,(0,I.logfile_message)("level_init()"),fp=null,hp=[],bp=[],mc=800,bc=yc=0,xc=0,tl=0,Tc=!1,kc=!1,Ec="",Dc=Fc=Ac=0,vp=Cc=Hc=0,Rc=qc=!1,Gc=!1,Sc=null,_d(),(0,I.logfile_message)("editor_init()"),_c=Jp(),Y_=!1,oc=L_.length,tc=1,N_=0,Vs=ae(),zs=oe(),ic=f_.name,Qs=wt("data/images/editorbg.png"),Js=Qe($_),ec=Qe(O_),Ks=function(){var e,t={type:4,enabled:!0};for(t.dx=t.dy=t.x=t.y=0,t.state=[],t.oldstate=[],t.howlong=[],e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return st(t),t}(),nc=$n(8),ac=$n(8),function(){var e;for(Ws=0,e=0;e<501;e++)w_[e]=null}(),V_(),(0,I.logfile_message)("editor_init() ok"),Pd(up).then((function(){for((0,I.logfile_message)("Creating players..."),e=0;e<pp.length;e++){var t=Da(pp[e]);t.hit=qa,t.kill=Ga,t.set_rings=Xa,t.get_rings=Ua,t.got_glasses=!1,bp.push(t)}for(md(),Yc=bp[$c=0],fa.is_locked=!1,fa.speed=0,fa.region_topleft_speed=0,fa.region_bottomright_speed=0,fa.position=fa.dest=(0,R.Y$)(0,0),fa.region_topleft.x=fa.dest_region_topleft.x=240,fa.region_topleft.y=fa.dest_region_topleft.y=135.5,fa.region_bottomright.x=fa.dest_region_bottomright.x=Dp().x-240,fa.region_bottomright.y=fa.dest_region_bottomright.y=Dp().y-135.5,ma(Yc.actor.position),Md(Yc.actor),Xa(0),Mc=!1,jc=!1,(0,I.logfile_message)("Loading hud..."),(Nc=sn()).position=(0,R.Y$)(16,7),Nc=fn(Nc,Pt("SD_MAINGUI",0)),(Pc=sn()).position=(0,R.Y$)(16,248),Pc=fn(Pc,Pt("SD_LIFEGUI",0)),(Lc=$n(0)).position=(0,R.qq)(Pc.position,(0,R.Y$)(32,11)),e=0;e<3;e++)xp[e]=$n(2),xp[e].position=(0,R.qq)(Nc.position,(0,R.Y$)(42,16*e+2));for((Xc=sn()).position=(0,R.Y$)(0,-240),Xc=fn(Xc,Pt("SD_LEVELOP",0)),(Wc=sn()).position=(0,R.Y$)(260,250),Wc=fn(Wc,Pt("SD_LEVELACT",gc-1)),(Vc=$n(3)).position=(0,R.Y$)(330,50),On(Vc,"%s",pc.toUpperCase()),Nn(Vc,180),Uc=$n(4),Bc=$n(7),Zc=sn(),e=0;e<3;e++)Ip[e]=$n(2),wp[e]=sn();zc=!1,Qc=0,(Kc=sn()).position.y=C,Kc=fn(Kc,Pt("SD_DIALOGBOX",0)),Jc=$n(8),el=$n(8)}))},Op=function(){var e,t;xc+=(0,A.dF)();var n,a,o,i,r,s,c,l=!1,_=!1,p=!1,u=(0,A.dF)();if(Yd(),Ed(),Sd(),D_())!function(){_c||(_c=Jp());var e,t,n,a,o,i=Lt(Pt("SD_ARROW",0),0),r=jn(nc).x,s=jn(nc).y,c=(0,R.Zu)(M_,(0,R.Y$)(240,135.5));if(et(Js,7)&&tt(Js,8)&&F_(),et(Js,8))return(0,I.logfile_message)("editor_disable()"),tp(),Y_=!1,ce(Vs,zs,ie()),void(0,I.logfile_message)("editor_disable() ok");if(et(Js,7)?((tt(Js,5)||tt(Ks,2))&&G_(),(tt(Js,6)||tt(Ks,1))&&C_()):((tt(Js,5)||tt(Ks,2))&&H_(),(tt(Js,6)||tt(Ks,1))&&U_()),j_.x=(0,q.clip)(rt(Ks).x,0,G-i.width),j_.y=(0,q.clip)(rt(Ks).y,0,C-i.height),tt(Ks,5)&&et(Js,7)){var l=K_(j_),_=ep(!0,l,spawn_point);rp(_),np(_)}if(tt(Ks,5)&&!et(Js,7)){var p=J_(!0,tc,N_,K_(j_));rp(p),np(p)}if(e=tt(Ks,7),t=tt(Ks,6),e||t)switch(console.log(e,t,tc,1),tc){case 1:for(n=_c;n;n=n.next){var d=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height],u=[j_.x+c.x,j_.y+c.y,j_.x+c.x+1,j_.y+c.y+1];if((0,q.bounding_box)(d,u)){if(!e){var f=J_(!1,1,ed(n.data),(0,R.Y$)(n.data.x,n.data.y));rp(f),np(f);break}N_=ed(n.data)}}break;case 2:for(a=item_list;a;a=a.next){var h=[a.data.actor.position.x-a.data.actor.hot_spot.x,a.data.actor.position.y-a.data.actor.hot_spot.y,a.data.actor.position.x-a.data.actor.hot_spot.x+dn(a.data.actor).width,a.data.actor.position.y-a.data.actor.hot_spot.y+dn(a.data.actor).height],g=[j_.x+c.x,j_.y+c.y,j_.x+c.x+1,j_.y+c.y+1];if((0,q.bounding_box)(h,g)){if(!e){var m=J_(!1,2,a.data.type,a.data.actor.position);rp(m),np(m);break}var b=B_(a.data.type);b>=0&&(P_=b,N_=L_[b])}}break;case 3:for(o=enemy_list;o;o=o.next){var y=[o.data.actor.position.x-o.data.actor.hot_spot.x,o.data.actor.position.y-o.data.actor.hot_spot.y,o.data.actor.position.x-o.data.actor.hot_spot.x+dn(o.data.actor).width,o.data.actor.position.y-o.data.actor.hot_spot.y+dn(o.data.actor).height],x=[j_.x+c.x,j_.y+c.y,j_.x+c.x+1,j_.y+c.y+1],v=X_(o.data.name);if(v>=0&&(0,q.bounding_box)(y,x)){if(!e){var w=J_(!1,3,v,o.data.actor.position);rp(w),np(w);break}N_=v}}}et(Js,7)&&(tt(ec,5)?op():tt(ec,6)&&ip()),Q_(),A_(),On(nc,"%d,%d",parseInt(K_(j_).x,10),parseInt(K_(j_).y,10)),nc.position.x=(0,q.clip)(parseInt(j_.x,10),10,G-r*Mn(nc).length-10),nc.position.y=(0,q.clip)(parseInt(j_.y-3*s,10),10,261),ac.position=(0,R.Y$)(10,10),3!=tc?On(ac,"<color=ffff00>%s %d</color>\n%s",R_(tc),N_,q_(tc,N_)):On(ac,'<color=ffff00>%s "%s"</color>\n%s',R_(tc),W_(N_),q_(tc,N_))}();else{for(p=xc<5,e=0;e<bp.length&&!p;e++)bp[e]&&(p=bp[e].dead);if(Yc&&Yc.actor&&tt(Yc.actor.input,8)&&!p){console.log("QUIT");var f=[];return Ic.pause(),f[0]=dt("CBOX_QUIT_QUESTION"),f[1]=dt("CBOX_QUIT_OPTION1"),f[2]=dt("CBOX_QUIT_OPTION2"),Un(f[0],f[1],f[2]),void(0,ft.ZH)(sh(th))}if(1==(t=Bn())?kc=!0:2==t&&E(Ic,!0),kc)return Q()?((0,ft.xp)(),void Cd()):void z(St(0,0,0),1);if(tt(Js,9))return(0,I.logfile_message)("editor_enable()"),(cc={}).in_group=!1,cc.prev=null,cc.next=null,sc=cc,lc=cc,Y_=!0,M_.x=parseInt(ga().x,10),M_.y=parseInt(ga().y,10),j_=(0,R.Y$)(240,135.5),Vs=ae(),zs=oe(),ce(3,!1,ie()),void(0,I.logfile_message)("editor_enable() ok");for(_=xc<5,e=0;e<bp.length&&!_;e++)_=bp[e].dying||bp[e].dead;if(Yc&&tt(Yc.actor.input,7)&&!_)return Yc.spin_dash=Yc.braking=!1,null==w||w.is_paused||(w.is_paused=!0,w.pause()),void(0,ft.ZH)(sh(Vf));Nc=fn(Nc,Pt("SD_MAINGUI",Ua()>0?0:1)),Pc=fn(Pc,Pt("SD_LIFEGUI",$c)),Lc=On(Lc,"%d",Ba()),On(xp[0],"%d",Za());var h=parseInt(xc%60,10);if(h<10&&(h="0"+h),On(xp[1],"%s",parseInt(xc/60,10)+":"+h),On(xp[2],"%d",Ua()),Xc&&(xc<5?xc<1.5?(Xc.position.y+=360*u,Xc.position.y>-2&&(Xc.position.y=-2),Vc.position.x-=320*u,Vc.position.x<140&&(Vc.position.x=140),Wc.position.y-=200*u,Wc.position.y<200&&(Wc.position.y=200)):xc>3.5&&(Xc.position.x-=320*u):(Xc.visible=!1,Vc.visible=!1,Wc.visible=!1)),Tc){var g=0,m=(0,A.$I)(),b=mt("ring count"),y=mt("cash"),x=mt("glasses");if(m>=Dc+2e3){for(e=0;e<bp.length;e++)bp[e]&&(bp[e].actor.speed.x=0);for(Uc.position.x=Math.min(Uc.position.x+800*u,30),Bc.position.x=Math.min(Bc.position.x+700*u,12),Zc.position.x=Math.max(Zc.position.x-700*u,250),e=0;e<3;e++)wp[e].position.x=Math.min(wp[e].position.x+(400-50*e)*u,50),Ip[e].position.x=Math.max(Ip[e].position.x-(400-50*e)*u,230);g=Hc-(vp+Cc),On(Ip[0],"%d",parseInt(vp,10)),On(Ip[1],"%d",parseInt(Cc,10)),On(Ip[2],"%d",parseInt(g,10)),Gc||(S(),j(mt("goal")),Gc=!0)}if(m>=Dc+6e3&&!Rc)if(vp=Math.max(0,vp-400*u),Cc=Math.max(0,Cc-2e3*u),vp>0||Cc>0)b&&m>=Ac&&(Ac=m+100,j(b));else for(Rc=!0,Fc=m+4e3,j(y),e=0;e<bp.length;e++)if(bp[e].got_glasses){j(x);break}Rc&&m>=Fc&&(qc=!0)}for(hd(),fd(),l=!1,e=0;e<bp.length;e++)bp[e].dying&&(l=!0);for(r=wd(),n=vd(),a=null,Wn(Sc),s=hp;s;s=s.next)if(s.data&&s.data.actor){var v=s.data.actor.position.x,k=s.data.actor.position.y,O=dn(s.data.actor).width,M=dn(s.data.actor).height;if(jd(v,k,O,M,dp)){if(Zr(s.data,bp,3,n,hp,gp),s.data.obstacle){var N=void 0,P=void 0,L=(0,R.qq)(s.data.actor.hot_spot,(0,R.Y$)(0,-1)),T=dn(s.data.actor),D=bd(T.width,T.height-1,(0,R.Zu)(s.data.actor.position,L),0);D.brick_ref.zindex=s.data.bring_to_back?.4:.5,(N={}).next=a,N.data=D,a=N,(P={}).next=n,P.data=D,n=P}}else s.data.preserve||(s.data.state=Dr)}for(c=gp;c;c=c.next)if(c.data){var F=c.data.actor.position.x,H=c.data.actor.position.y,U=dn(c.data.actor).width,B=dn(c.data.actor).height;if(jd(F,H,U,B,dp)||c.data.always_active){if(Yc&&Yc.actor&&Yc.actor.input.enabled&&(l||Tc||g_(c.data,bp,bp.length,n,r,gp)),c.data.obstacle){var Z=void 0,X=void 0,W=(0,R.qq)(c.data.actor.hot_spot,(0,R.Y$)(0,-1)),V=dn(c.data.actor),K=bd(V.width,V.height-1,(0,R.Zu)(c.data.actor.position,W),c.data.obstacle_angle);(Z={}).next=a,Z.data=K,a=Z,(X={}).next=n,X.data=K,n=X}}else c.data.preserve?jd(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y,U,B,dp)||(c.data.actor.position=(0,R.Y$)(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y)):c.data.state=Dr}if(Nd()&&Yc&&Yc.actor){var J,ee=Yc.actor,te=[ee.position.x,ee.position.y,ee.position.x+1,ee.position.y+1],ne=[Oc.rect_x,Oc.rect_y,Oc.rect_x+Oc.rect_w,Oc.rect_y+Oc.rect_h];if(l||function(e,t,n){var a=e.actor,o=null,i=null,r=null,s=null,c=null,l=null,_=null,p=null,u=[],f=bn(a,2,-2,n,o,i,r,s,c,l,_,p);o=f.up,i=f.upright,r=f.right,s=f.downright,c=f.down,l=f.downleft,_=f.left,p=f.upleft;var h=vn(a,-2,o,i,r,s,c,l,_,p);if(o=h.up,i=h.upright,r=h.right,s=h.downright,c=h.down,l=h.downleft,_=h.left,p=h.upleft,u[0]=o,u[1]=i,u[2]=r,u[3]=s,u[4]=c,u[5]=l,u[6]=_,u[7]=p,Hp())switch(e.hp<=0&&1!=e.state&&(Up(),e.state=1),e.type){case 0:!function(e,t,n,a){var o=Pp(),i=.001*(0,A.$I)(),r=e.actor,s=e.value[0],c=e.value[1];if(1==e.state){if(e.bring_to_front=!0,fn(r,Pt("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,A.dF)(),i>=c+.15){var l=(0,R.Y$)(r.position.x-r.hot_spot.x+(0,q.random)(dn(r).width),r.position.y-r.hot_spot.y+(0,q.random)(dn(r).height));Xp(qr,l),r.position.y<=r.spawn_point.y+406.5&&j(mt("boss hit")),c=i}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?at(r.input,3):3==e.direction&&at(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(d.PI*i),r.mirror=1==e.direction?d.IF_NONE:d.IF_HFLIP,pn(r,wn(r)),i>=s+2/e.initial_hp*e.hp&&(Wp([0,3][parseInt((0,q.random)(2),10)],r.position).actor.speed.y=-150-(0,q.random)(50),s=i),lp(e,t)&&r.animation==Pt("SD_SIMPLEBOSS",0)&&(fn(r,Pt("SD_SIMPLEBOSS",1)),j(mt("boss hit")),o.actor.speed.x*=-1,o.actor.speed.y=100,e.hp--),hn(r)&&fn(r,Pt("SD_SIMPLEBOSS",0)),e.value[0]=s,e.value[1]=c}(e,t);break;case 1:!function(e,t,n,a){var o,i=Pp(),r=e.actor,s=.001*(0,A.$I)(),c=(0,A.dF)(),l=e.value[0],_=e.value[1],p=e.value[2];switch(e.state){case 0:if(e.direction=i.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(d.PI*s),hn(r)&&actor.change_animation(r,Pt("SD_MECHASHADOW",0)),s>=l+5){var u,f=(0,R.Y$)(i.actor.position.x-r.position.x,i.actor.position.y-r.position.y);f=(0,R.GZ)((0,R.my)(f),200),(u=Xp(40,r.position)).dangerouspower_set_speed(u,f),j(mt("big shot")),l=s}if(s>=_+15){var h=e.rect_x+e.rect_w/2;e.direction=r.position.x>h?3:1,fn(r,Pt("SD_MECHASHADOW",2)),e.state=2,_=s}break;case 2:var g=e.rect_x+100,m=e.rect_x+e.rect_w-100,b=m-g+(r.position.x-g),y=3==e.direction?-1:1;r.position.x+=200*y*c,r.position.y=r.spawn_point.y-100*Math.sin(d.PI/(m-g)*b),hn(r)&&fn(r,Pt("SD_MECHASHADOW",2)),(-1==y&&r.position.x<=g||1==y&&r.position.x>=m)&&(fn(r,Pt("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,fn(r,Pt("SD_MECHASHADOW",4)),r.position.y+=100*(0,A.dF)(),s>=p+.15){var x=(0,R.Y$)(r.position.x-r.hot_spot.x+(0,q.random)(dn(r).width),r.position.y-r.hot_spot.y+(0,q.random)(dn(r).height));Xp(qr,x),r.position.y<=r.spawn_point.y+406.5&&j(mt("boss hit")),p=s}}o=r.animation==Pt("SD_MECHASHADOW",1)||r.animation==Pt("SD_MECHASHADOW",3),lp(e,t)&&!o&&1!=e.state&&(r.animation=Pt("SD_MECHASHADOW",2==e.state?3:1),j(mt("boss hit")),e.hp--,i.actor.speed.x*=-.5,i.actor.speed.y=i.actor.jump_strength),r.mirror=1==e.direction?d.IF_NONE:d.IF_HFLIP}(e,t);break;case 2:!function(e,t,n,a){var o=Pp(),i=.001*(0,A.$I)(),r=e.actor,s=e.value[0],c=e.value[1],l=e.value[2];if(1==e.state){if(e.bring_to_front=!0,fn(r,Pt("SD_SIMPLEBOSS",2)),r.position.y+=100*(0,A.dF)(),i>=c+.15){var _=(0,R.Y$)(r.position.x-r.hot_spot.x+(0,q.random)(dn(r).width),r.position.y-r.hot_spot.y+(0,q.random)(dn(r).height));Xp(qr,_),r.position.y<=r.spawn_point.y+406.5&&j(mt("boss hit")),c=i}}else r.maxspeed=200-100/e.initial_hp*e.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(e.direction=1),r.position.x>r.spawn_point.x&&(e.direction=3),1==e.direction?at(r.input,3):3==e.direction&&at(r.input,4),r.position.y=r.spawn_point.y+20*Math.cos(d.PI*i),r.mirror=1==e.direction?d.IF_NONE:d.IF_HFLIP,pn(r,wn(r)),i>=s+2/e.initial_hp*e.hp&&(Wp(["9","6"][parseInt((0,q.random)(2),10)],r.position).actor.speed.y=-150-(0,q.random)(50),s=i),i>=l+3/e.initial_hp*e.hp&&(Xp(41,r.position).actor.speed.y=100,j(mt("fire")),l=i),lp(e,t)&&r.animation==Pt("SD_SIMPLEBOSS",0)&&(fn(r,Pt("SD_SIMPLEBOSS",1)),j(mt("boss hit")),o.actor.speed.x*=-1,o.actor.speed.y=100,e.hp--),hn(r)&&fn(r,Pt("SD_SIMPLEBOSS",0)),e.value[0]=s,e.value[1]=c,e.value[2]=l}(e,t);break;case 3:!function(e,t,n,a){var o,i=Pp(),r=e.actor,s=.001*(0,A.$I)(),c=(0,A.dF)(),l=e.value[0],_=e.value[1],p=e.value[2],u=e.value[3];switch(e.state){case 0:if(e.direction=i.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(d.PI*s),hn(r)&&fn(r,Pt("SD_MECHASHADOW",0)),s>=l+4){var f,h=(0,R.Y$)(i.actor.position.x-r.position.x,i.actor.position.y-r.position.y);h=(0,R.GZ)((0,R.my)(h),200),(f=Xp(40,r.position)).dangerouspower_set_speed(f,h),j(mt("big shot")),l=s}if(s>=_+8){var g=e.rect_x+e.rect_w/2;e.direction=r.position.x>g?3:1,fn(r,Pt("SD_MECHASHADOW",2)),e.state=2,_=s}break;case 2:var m=e.rect_x+100,b=e.rect_x+e.rect_w-100,y=b-m+(r.position.x-m),x=3==e.direction?-1:1;r.position.x+=200*x*c,r.position.y=r.spawn_point.y-100*Math.sin(d.PI/(b-m)*y),s>=u+.2&&(Xp(41,r.position).actor.speed.y=-200,j(mt("fire")),u=s),hn(r)&&fn(r,Pt("SD_MECHASHADOW",2)),(-1==x&&r.position.x<=m||1==x&&r.position.x>=b)&&(fn(r,Pt("SD_MECHASHADOW",0)),e.state=0);break;case 1:if(e.bring_to_front=!0,fn(r,Pt("SD_MECHASHADOW",4)),r.position.y+=100*(0,A.dF)(),s>=p+.15){var v=(0,R.Y$)(r.position.x-r.hot_spot.x+(0,q.random)(dn(r).width),r.position.y-r.hot_spot.y+(0,q.random)(dn(r).height));Xp(qr,v),r.position.y<=r.spawn_point.y+406.5&&j(mt("boss hit")),p=s}}o=r.animation==Pt("SD_MECHASHADOW",1)||r.animation==Pt("SD_MECHASHADOW",3),lp(e,t)&&!o&&1!=e.state&&(r.animation=Pt("SD_MECHASHADOW",2==e.state?3:1),j(mt("boss hit")),e.hp--,i.actor.speed.x*=-.5,i.actor.speed.y=i.actor.jump_strength),r.mirror=1==e.direction?d.IF_NONE:d.IF_HFLIP,e.value[0]=l,e.value[1]=_,e.value[2]=p,e.value[3]=u}(e,t)}}(Oc,bp,fp),!cp(Oc)&&(0,q.bounding_box)(te,ne)&&(Mc=!0,jc=!0),!cp(Oc))for(e=0;e<bp.length;e++)(bp[e]!=Yc||Yc.actor.carrying)&&((J=bp[e].actor).position.x>Oc.rect_x-30&&J.position.x<Oc.rect_x&&(J.position.x=Oc.rect_x-30,J.speed.x=0),J.position.x>Oc.rect_x+Oc.rect_w&&J.position.x<Oc.rect_x+Oc.rect_w+30&&(J.position.x=Oc.rect_x+Oc.rect_w+30,J.speed.x=0));(cp(Oc)||Yc.dying)&&(Mc=!1,Ic&&(Y($()-.5*u),$()<d.EPSILON&&(S(),Y(1),wc=!0)))}for(e=0;e<bp.length;e++)ot(bp[e].actor.input);for(Yc&&Yc.actor&&xc>=3.5&&it(Yc.actor.input),e=0;e<bp.length;e++){var re=bp[e].actor.position.x,se=bp[e].actor.position.y,le=dn(bp[e].actor).width,_e=dn(bp[e].actor).height,pe=bp[e].actor.hot_spot.y;if(e!=$c&&(bp[e].getting_hit&&gd(e),bp[e].dying&&(gd(e),yp!=bp[e].actor&&ha(bp[e].actor.position,0))),bp[e].dead){if(!(Ba()>1))return(0,ft.xp)(),void(0,ft.ZH)(sh(zf));if(Q())return Wa(Ba()-1),void od();z(St(0,0,0),1)}if(qc){if(Q())return void(0,ft.xp)();z(St(0,0,0),1)}(jd(re,se,le,_e,dp/4)||bp[e].dying)&&(!l||bp[e].dying||bp[e].getting_hit)&&Fa(bp[e],bp,n),bp[e].actor.position.y<pe&&!bp[e].dying?(bp[e].actor.position.y=pe,bp[e].actor.speed.y=0):bp[e].actor.position.y>yc-(_e-pe)&&jd(re,se,le,_e,dp/4)&&Ga(bp[e])}if(l||Tc||(xc+=(0,A.dF)()/1e3,Yc&&tt(Yc.actor.input,6)&&(!(Math.abs(Yc.actor.speed.y)<d.EPSILON)||Yc.on_moveable_platform||Mc||Yc.disable_movement||Yc.in_locked_area?j(mt("deny")):gd(($c+1)%3))),Nd()&&Mc){var de=Yc.actor;de&&(de.position.x<Oc.rect_x?(de.position.x=Oc.rect_x,de.speed.x=Math.max(0,de.speed.x)):de.position.x>Oc.rect_x+Oc.rect_w&&(de.position.x=Oc.rect_x+Oc.rect_w,de.speed.x=Math.min(de.speed.x,0)),de.position.y=(0,q.clip)(de.position.y,Oc.rect_y,Oc.rect_y+Oc.rect_h))}for(pd(n),o=n;o;o=o.next){if(o.data&&2==o.data.brick_ref.behavior){var ue=o.data.brick_ref.image.width,fe=o.data.brick_ref.image.height,he=[o.data.x,o.data.y,o.data.x+ue,o.data.y+fe],ge=[o.data.x,o.data.y,o.data.x+ue,o.data.y+fe];for(e=0;e<bp.length;e++)if(bp[e]&&(he[0]=bp[e].actor.position.x-bp[e].actor.hot_spot.x-3,he[1]=bp[e].actor.position.y-bp[e].actor.hot_spot.y-3,he[2]=he[0]+dn(bp[e].actor).width+6,he[3]=he[1]+dn(bp[e].actor).height+6,(bp[e].spin_dash||bp[e].spin||2==bp[e].type)&&(0,q.bounding_box)(he,ge))){var me,be,ye=void 0,xe=void 0;for(be=Math.max(o.data.brick_ref.behavior_arg[0],1),me=Math.max(o.data.brick_ref.behavior_arg[1],1),ye=0;ye<be;ye++)for(xe=0;xe<me;xe++){var ve=(0,R.Y$)(o.data.x+ye*ue/be,o.data.y+xe*fe/me),Ie=(0,R.Y$)(.3*-bp[e].actor.speed.x,-100-(0,q.random)(50)),we=It(ue/be,fe/me);Math.abs(Ie.x)>d.EPSILON&&(Ie.x+=(Ie.x>0?1:-1)*(0,q.random)(50)),Vp(we,ve,Ie,!1)}j(mt("break")),o.data.state=1}}if(o.data&&3==o.data.brick_ref.behavior&&2==o.data.state){var ke=o.data;if(ke.value[1]+=(0,A.dF)(),ke.value[1]>=1){var Ee,Se,Ye=void 0,$e=void 0,Oe=0!=parseInt(ke.brick_ref.behavior_arg[2],10),Me=ke.brick_ref.image;for(Ee=Math.max(ke.brick_ref.behavior_arg[0],1),Se=Math.max(ke.brick_ref.behavior_arg[1],1),Ye=0;Ye<Ee;Ye++)for($e=0;$e<Se;$e++){var je=(0,R.Y$)(ke.x+Ye*Me.width/Ee,ke.y+$e*Me.height/Se),Ne=(0,R.Y$)(0,20+20*$e+20*(Oe?Ye:Ee-Ye)),Pe=It(Me.width/Ee,Me.height/Se);Vp(Pe,je,Ne,!1)}j(mt("break")),ke.state=1}}Od(o.data)}for(o=a;o;o=i)i=o.next,$d(o.data),o=null;if(a=null,Id(n),kd(r),Yc&&Yc.actor&&Md(Yc.actor),Tc)ha((0,R.qq)(yp.position,(0,R.Y$)(0,-90)),.17);else if(Mc){var Le=[Oc.rect_x+240,Oc.rect_x+Oc.rect_w-240],Te=(0,R.Y$)((0,q.clip)(yp.position.x,Le[0],Le[1]),yp.position.y);ha((0,R.qq)(Te,(0,R.Y$)(0,-90)),.17)}else l||ha(yp.position,.1);!function(){var e,t=(0,A.dF)();ba(),e=(0,R.Zu)(fa.dest,fa.position),(0,R.qU)(e)>10&&(e=(0,R.my)(e),fa.position.x+=e.x*fa.speed*t,fa.position.y+=e.y*fa.speed*t),e=(0,R.Zu)(fa.dest_region_topleft,fa.region_topleft),(0,R.qU)(e)>10&&(e=(0,R.my)(e),fa.region_topleft.x+=e.x*fa.region_topleft_speed*t,fa.region_topleft.y+=e.y*fa.region_topleft_speed*t),e=(0,R.Zu)(fa.dest_region_bottomright,fa.region_bottomright),(0,R.qU)(e)>10&&(e=(0,R.my)(e),fa.region_bottomright.x+=e.x*fa.region_bottomright_speed*t,fa.region_bottomright.y+=e.y*fa.region_bottomright_speed*t)}()}ud()},Mp=function(){if(J(),D_())return t=(0,R.Zu)(M_,(0,R.Y$)(240,135.5)),Qs.width,Qs.height,function(){if(T_){var e,t,n,a,o=(0,R.Zu)(M_,(0,R.Y$)(240,135.5));for(n=It(1,1),a=St(0,128,160),Yt(n,0,0,0),e=0;e<n.height;e++)Et(0,ne(),n.width-1,e,a);for(e=0;e<n.width;e++)Et(0,ne(),e,n.height-1,a);for(e=0;e<=480;e++)for(t=0;t<=271;t++)(0,R.Zu)(K_((0,R.Y$)(e*n.width,t*n.height)),o);$t(n)}}(),Kp(),Z_(tc,N_,(0,R.Zu)(K_(j_),t)),e=Lt(Pt("SD_ARROW",0),0),kt(e.data,ne(),e.sx,e.sy,parseInt(j_.x,10),parseInt(j_.y,10),e.width,e.height),Pn(nc,(0,R.Y$)(240,135.5)),void Pn(ac,(0,R.Y$)(240,135.5));var e,t;Vn(Sc,ga()),id(),zn(Sc,ga()),sd()},jp=function(){var e;for((0,I.logfile_message)("level_release()"),$t(Ec),nd(),e=0;e<bp.length;e++)bp[e];for((0,I.logfile_message)("editor_release()"),z_(),function(){var e;for(e=0;e<Ws;e++)w_[e]=S_(w_[e]);Ws=0}(),Je(ec),Je(Js),Je(Ks),Y_=!1,tc=2,N_=0,(0,I.logfile_message)("editor_release() ok"),cn(Pc),cn(Nc),e=0;e<bp.length;e++)xp[e];for(cn(Xc),cn(Wc),cn(Zc),e=0;e<3;e++)Ip[e],cn(wp[e]);cn(Kc),(0,I.logfile_message)("level_release() ok")},Np=function(){return D_()},Pp=function(){return Yc},Lp=function(){return $c},Tp=function(e){var t;e=Math.max(0,e),Va(Za()+e),(t=Xp(13,(0,R.qq)(Yc.actor.position,(0,R.Y$)(-9,0)))).set_text(t,e)},Dp=function(){return(0,R.Y$)(bc,yc)},Fp=function(e){Ic&&S(),j(e)},Ap=function(e){vc=(0,R.Y$)(e.x,e.y)},Rp=function(e){var t;if(!Tc){for(Tc=!0,Dc=(0,A.$I)(),vp=10*Ua(),Hc+=vp,t=0;t<bp.length;t++)bp[t]&&bp[t].got_glasses&&qp(5e3);for(Va(Za()+Hc),t=0;t<bp.length;t++)bp[t]&&(ot(bp[t].actor.input),bp[t].spin_dash=!1);for(Md(e),Cp(),(Uc=On(Uc,"TEAM SONIC")).position=(0,R.Y$)(-500,20),(Bc=On(Bc,"GOT THROUGH")).position=(0,R.Y$)(-500,46),(Zc=fn(Zc,Pt("SD_LEVELACT",gc-1))).position=(0,R.Y$)(820,25),t=0;t<3;t++)wp[t].position=(0,R.Y$)(-500,120+20*t),Ip[t].position=(0,R.Y$)(820,120+20*t);wp[0]=fn(wp[0],Pt("SD_RINGBONUS",0)),wp[1]=fn(wp[1],Pt("SD_SECRETBONUS",0)),wp[2]=fn(wp[2],Pt("SD_TOTAL",0))}},qp=function(e){Cc+=e,Hc+=e},Gp=function(e,t){(!zc||Mn(Jc)||Mn(el))&&(zc=!0,Qc=(0,A.$I)(),On(Jc,e),On(el,t),Nn(el,260))},Cp=function(){zc=!1},Hp=function(){return jc},Up=function(){var e,t;for(e=gp;e;e=e.next)(t=e.data)&&(t.state=1)},Bp=function(){return mc},Zp=function(e,t){var n,a;for((a={}).data={},a.data.brick_ref=Wt(e),a.data.animation_frame=0,a.data.x=a.data.sx=parseInt(t.x,10),a.data.y=a.data.sy=parseInt(t.y,10),a.data.enabled=!0,a.data.state=0,a.data.value=[],n=0;n<3;n++)a.data.value[n]=0;return xd(a),a.data},Xp=function(e,t){var n={};return n.data=Br(e),n.data&&(n.data.actor.spawn_point=(0,R.Y$)(t.x,t.y),n.data.actor.position=(0,R.Y$)(t.x,t.y)),n.next=hp,hp=n,n.data},Wp=function(e,t){var n,a=(0,R.Y$)(t.x,t.y);return(n={}).data=h_(e),n.data.actor.spawn_point=(0,R.Y$)(a.x,a.y),n.data.actor.position=(0,R.Y$)(a.x,a.y),n.next=gp,gp=n,n.data},Vp=function(e,t,n,a){var o,i;D_()?$t(e):((o={}).image=e,o.position=t,o.speed=n,o.destroy_on_brick=a,(i={}).data=o,i.next=mp,mp=i)},zp=function(e,t){var n,a,o,i,r,s;return e?(n=e.value[0],1===e.brick_ref.behavior?(a=e.brick_ref.behavior_arg[0],o=e.brick_ref.behavior_arg[1],i=e.brick_ref.behavior_arg[2]*(2*d.PI),r=e.brick_ref.behavior_arg[3]*(2*d.PI),s=e.brick_ref.behavior_arg[4]*d.PI/180,(0,R.Y$)(-a*i*Math.sin(i*n+s),o*r*Math.cos(r*n+s))):(0,R.Y$)(0,0)):(0,R.Y$)(0,0)},Qp=function(e){return Xp(15,e)},Kp=function(){id()},Jp=function(){return fp},ed=function(e){return ad(e)},td=function(){md()},nd=function(){var e,t,n,a,o,i;for((0,I.logfile_message)("level_unload()"),Ic.pause(),(0,I.logfile_message)("releasing brick list..."),e=fp;e;e=t)t=e.next,e.data=null,e=null;for(fp=null,(0,I.logfile_message)("releasing item list..."),n=hp;n;n=a)a=n.next,n.data,n=null;for(hp=null,(0,I.logfile_message)("releasing enemy list..."),o=gp;o;o=i)i=o.next,o.data,o=null;gp=null,Nd()&&((0,I.logfile_message)("releasing the boss..."),function(e){cn(e.actor)}(Oc),Oc=null),(0,I.logfile_message)("unloading the brickset..."),(0,I.logfile_message)("unloading the background..."),(0,I.logfile_message)("level_unload() ok")},ad=function(e){var t;for(t=0;t<Vt();t++)if(e.brick_ref==Wt(t))return t;return-1},od=function(){var e=vc;jp(),$p(),vc=e},id=function(){var e,t,n,a,o={};for(t=e=vd();t;t=t.next)t.data&&t.data.brick_ref.zindex<.5&&(t.data=zt(t.data),o=Qt(t.data),ne().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt(ga().x,10)-240),t.data.y-(parseInt(ga().y,10)-135.5),1*o.width,1*o.height));for(rd(!0),t=e;t;t=t.next)if(t.data){var i=t.data.brick_ref;Math.abs(i.zindex-.5)<d.EPSILON&&1!=i.property&&(t.data=zt(t.data),o=Qt(t.data),ne().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt(ga().x,10)-240),t.data.y-(parseInt(ga().y,10)-135.5),1*o.width,1*o.height))}for(n=hp;n;n=n.next)n.data&&n.data.bring_to_back&&Xr(n.data,ga());for(t=e;t;t=t.next)if(t.data){var r=t.data.brick_ref;Math.abs(r.zindex-.5)<d.EPSILON&&1==r.property&&(t.data=zt(t.data),o=Qt(t.data),ne().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt(ga().x,10)-240),t.data.y-(parseInt(ga().y,10)-135.5),1*o.width,1*o.height))}for(Nd()&&!Oc.bring_to_front&&sp(Oc,ga()),a=gp;a;a=a.next)m_(a.data,ga());for(rd(!1),Nd()&&Oc.bring_to_front&&sp(Oc,ga()),n=hp;n;n=n.next)n.data&&Xr(n.data,ga());for(dd(),t=e;t;t=t.next)t.data&&t.data.brick_ref.zindex>.5&&(t.data=zt(t.data),o=Qt(t.data),ne().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,t.data.x-(parseInt(ga().x,10)-240),t.data.y-(parseInt(ga().y,10)-135.5),1*o.width,1*o.height));Id(e)},rd=function(e){if(Yc){var t;for(t=bp.length-1;t>=0;t--)bp[t]!=Yc&&!!bp[t].bring_to_back==e&&Aa(bp[t],ga());!!Yc.bring_to_back==e&&Aa(Yc,ga())}},sd=function(){var e,t=(0,R.Y$)(240,135.5);if(Tc)for(ln(Zc,t),Pn(Uc,t),Pn(Bc,t),e=0;e<3;e++)ln(wp[e],t),Pn(Ip[e],t);else{for(ln(Nc,t),ln(Pc,t),Pn(Lc,t),e=0;e<3;e++)Pn(xp[e],t);cd()}xc<2.5&&J("rgb(0,0,0)"),ln(Xc,t),ln(Wc,t),Pn(Vc,t),ld(t)},cd=function(){var e,t=[],n=[],a=0,o=.001*(0,A.$I)();for(e=0;e<10;e++)n[e]=!0;if(Yc){switch(Yc.got_glasses&&(t[a++]=Lt(Pt("SD_ICON",6),0)),Yc.shield_type){case 1:t[a++]=Lt(Pt("SD_ICON",7),0);break;case 2:t[a++]=Lt(Pt("SD_ICON",11),0);break;case 3:t[a++]=Lt(Pt("SD_ICON",12),0);break;case 4:t[a++]=Lt(Pt("SD_ICON",13),0);break;case 5:t[a++]=Lt(Pt("SD_ICON",14),0);break;case 6:t[a++]=Lt(Pt("SD_ICON",15),0)}if(Yc.invincible&&(t[a++]=Lt(Pt("SD_ICON",4),0),Yc.invtimer>=17.25)){var i=(23-Yc.invtimer)/5.75;n[a-1]=Math.sin(.5*d.PI*o/(i+.1))>=0}if(Yc.got_speedshoes&&(t[a++]=Lt(Pt("SD_ICON",5),0),Yc.speedshoes_timer>=17.25)){var r=(23-Yc.speedshoes_timer)/5.75;n[a-1]=Math.sin(.5*d.PI*o/(r+.1))>=0}}for(e=0;e<a;e++)n[e]&&kt(t[e].data,ne(),t[e].sx,t[e].sy,G-(t[e].width+5)*(e+1),5,t[e].swidth,t[e].sheight)},ld=function(e){ln(Kc,e),Pn(Jc,e),Pn(el,e)},_d=function(){mp=null},pd=function(e){var t,n,a,o,i,r=(0,A.dF)(),s=mc,c=null;for(a=mp;a;a=o)if(i=a.data){if(n=jd(i.position.x,i.position.y,i.position.x+i.image.width,i.position.y+i.image.height,dp),t=!1,i.destroy_on_brick&&n&&i.speed.y>0){var l=[i.position.x,i.position.y,i.position.x+i.image.width,i.position.y+i.image.height],_=void 0;for(_=e;_&&!t;_=_.next){var p=_.data;if(p&&1==p.brick_ref.property&&0==p.brick_ref.angle){var d=[p.x,p.y,p.x+p.brick_ref.image.width,p.y+p.brick_ref.image.height];(0,q.bounding_box)(l,d)&&(t=!0)}}}!n||t?c?c.next=o:mp=o:(i.position.x+=i.speed.x*r,i.position.y+=i.speed.y*r+.5*s*(r*r),i.speed.y+=s*r,c=a)}},dd=function(){var e,t,n,a,o,i,r=(0,R.Y$)(ga().x-240,ga().y-135.5);for(e=mp;e;e=e.next)(t=e.data)&&(n=t.image,a=ne(),o=parseInt(t.position.x-r.x,10),i=parseInt(t.position.y-r.y,10),d.IF_NONE,a.putImageData(n,o,i))},ud=function(){null==Ic||Tc||wc||O()||E(Ic,!0)},fd=function(){if(Kc){var e=(0,A.dF)(),t=(0,A.$I)();if(zc){if(t>=Qc+7e3)return void(zc=!1);Kc.position.x=(G-dn(Kc).width)/2,Kc.position.y=Math.max(Kc.position.y-100*e,C-1.3*dn(Kc).height)}else Kc.position.y=Math.min(Kc.position.y+100*e,C);Jc.position=(0,R.qq)(Kc.position,(0,R.Y$)(2,10)),el.position=(0,R.qq)(Kc.position,(0,R.Y$)(2,23))}},hd=function(){if(Yc&&Yc.actor){var e,t=[],n=[];if(!(xc<2))for(t[0]=Yc.actor.position.x,t[1]=Yc.actor.position.y,t[2]=t[0]+dn(Yc.actor).width,t[3]=t[1]+dn(Yc.actor).height,e=0;e<tl;e++)if(!kp[e].disabled&&(n[0]=kp[e].rect_x,n[1]=kp[e].rect_y,n[2]=n[0]+kp[e].rect_w,n[3]=n[1]+kp[e].rect_h,(0,q.bounding_box)(t,n))){kp[e].disabled=!0,Gp(kp[e].title,kp[e].message);break}}},gd=function(e){Yc.spin_dash=Yc.braking=!1,bp[$c=e]&&(Yc=bp[$c],Md(Yc.actor),it(Yc.actor.input))},md=function(){var e,t;for(e=0;e<bp.length;e++)t=parseInt(vc.x,10)<=bc/2?2-e:e,bp[e].actor.mirror=parseInt(vc.x,10)<=bc/2?d.IF_NONE:d.IF_HFLIP,bp[e].actor.spawn_point.x=bp[e].actor.position.x=vc.x+15*t,bp[e].actor.spawn_point.y=bp[e].actor.position.y=vc.y},bd=function(e,t,n,a){var o,i={},r={data:null};for(r.image=It(e,t),r.angle=a,r.property=1,r.behavior=0,r.zindex=.5,r.behavior_arg=[],o=0;o<5;o++)r.behavior_arg[o]=0;for(i.brick_ref=r,i.animation_frame=0,i.enabled=!0,i.x=i.sx=parseInt(n.x,10),i.y=i.sy=parseInt(n.y,10),i.value=[],o=0;o<3;o++)i.value[o]=0;return i},yd=function(e,t){var n=e.brick_ref,a=t.brick_ref;if(!n||!a)return!1;if(n.zindex<a.zindex)return-1;if(n.zindex>a.zindex)return 1;if(n.property!=a.property){var o=[0,100,50];return o[n.property]-o[a.property]}return n.angle%180!=0&&a.angle%180==0?-1:n.angle%180==0&&a.angle%180!=0?1:e.sy-t.sy},xd=function(e){var t;if(fp)if(yd(e.data,fp.data)>=0)e.next=fp,fp=e;else{for(t=fp;t.next&&yd(t.next.data,e.data)>0;)t=t.next;e.next=t.next,t.next=e}else e.next=null,fp=e},vd=function(){var e,t,n,a,o,i,r=[];for(e=fp;e;e=e.next)e.data&&e.data.brick_ref&&e.data.brick_ref.image&&(n=Math.min(e.data.x,e.data.sx),a=Math.min(e.data.y,e.data.sy),o=e.data.brick_ref.image.width,i=e.data.brick_ref.image.height,(jd(n,a,o,i,2*dp)||1==e.data.brick_ref.behavior)&&((t={}).data=e.data,t.next=r,r=t));return r},Id=function(e){for(var t;e;)t=e.next,e=null,e=t},wd=function(){var e,t,n,a,o,i,r,s=null;for(e=hp;e;e=e.next)e.data&&(r=dn(e.data.actor))&&(n=parseInt(e.data.actor.position.x,10),a=parseInt(e.data.actor.position.y,10),o=r.width,i=r.height,jd(n,a,o,i,dp)&&((t={}).data=e.data,t.next=s,s=t));return s},kd=function(e){for(var t;e;)t=e.next,e=null,e=t},Ed=function(){var e,t;if(hp)for(hp.data&&hp.data.state==Dr&&(t=hp.next,hp.data,hp=t),e=hp;e&&e.next;e=e.next)e.next&&e.next.data&&e.next.data.state==Dr&&(t=e.next,e.next=t.next,t.data,t=null)},Sd=function(){var e,t;if(gp)for(gp&&gp.data&&gp.data.state==y_&&(t=gp.next,gp.data,gp=null,gp=t),e=gp;e&&e.next;e=e.next)e&&e.next&&e.next.data&&e.next.data.state==y_&&(t=e.next,e.next=t.next,t.data,t=null)},Yd=function(){var e,t;if(fp)for(fp.data&&1==fp.data.state&&(t=fp.next,fp.data=null,fp=null,fp=t),e=fp;e&&e.next;e=e.next)1==e.next.data.state&&(t=e.next,e.next=t.next,t.data=null,t=null)},$d=function(e){$t(e.brick_ref.image),e.brick_ref=null,e=null},Od=function(e){var t,n,a,o,i,r;e&&(e.value[0]+=(0,A.dF)(),t=e.value[0],1===e.brick_ref.behavior)&&(n=e.brick_ref.behavior_arg[0],a=e.brick_ref.behavior_arg[1],o=e.brick_ref.behavior_arg[2]*(2*d.PI),i=e.brick_ref.behavior_arg[3]*(2*d.PI),r=e.brick_ref.behavior_arg[4]*d.PI/180,e.x=e.sx+Math.round(n*Math.cos(o*t+r)),e.y=e.sy+Math.round(a*Math.sin(i*t+r)))},Md=function(e){yp={position:{x:e.position.x,y:e.position.y}}},jd=function(e,t,n,a,o){var i=ga(),r=[e,t,e+n,t+a],s=[i.x-240-o,i.y-135.5-o,i.x+240+o,i.y+135.5+o];return(0,q.bounding_box)(r,s)},Nd=function(){return null!=Oc},Pd=function(e){return pc="Untitled",dc="",uc="",fc="",hc="",vc=(0,R.Y$)(0,0),tl=0,Oc=null,gc=1,new Promise((function(t,n){(0,I.logfile_message)('level_load("%s")',e),x(e).then(Ld).then((function(){Ic=k(dc),function(){var e,t,n;for(e=t=-d.INFINITY,n=fp;n;n=n.next)n.data&&n.data.brick_ref&&"BRK_NONE"!=n.data.brick_ref.property&&(e=Math.max(e,n.data.sx+Qt(n.data).width),t=Math.max(t,n.data.sy+Qt(n.data).height));bc=Math.max(e,G),yc=Math.max(t,C)}(),(0,I.logfile_message)("level_load() ok"),t()}))}))},Ld=function(e){var t;for(uc=e.theme,fc=e.bgtheme,hc=e.grouptheme,dc=e.music,pc=e.name,e.author,e.version,e.requires,gc=e.act,vc=e.spawn_point,e.readonly,e.boss&&(Oc=function(e,t,n,a,o,i){var r,s,c={};for(c.type=e,c.state=0,c.rect_x=n,c.rect_y=a,c.rect_w=o,c.rect_h=i,c.value=[],r=0;r<10;r++)c.value[r]=0;switch(c.bring_to_front=!1,c.actor=s=sn(),s.spawn_point=(0,R.Y$)(t.x,t.y),s.position=(0,R.Y$)(t.x,t.y),s.input=ze(),e){case 0:case 2:fn(s,Pt("SD_SIMPLEBOSS",0)),c.initial_hp=c.hp=3,c.direction=3,s.maxspeed=100,s.acceleration=100;break;case 1:case 3:fn(s,Pt("SD_MECHASHADOW",0)),c.initial_hp=c.hp=10,c.direction=3,s.maxspeed=100,s.acceleration=100}return c}(e.boss.id,(0,R.Y$)(e.boss.x,e.boss.y),e.boss.rx,e.boss.ry,e.boss.rw,e.boss.rh),console.log("BOSS",Oc)),t=0;t<e.dialogbox.length;t++){var n={disabled:!1};n.rect_x=e.dialogbox[t].xpos,n.rect_y=e.dialogbox[t].ypos,n.rect_w=e.dialogbox[t].width,n.rect_h=e.dialogbox[t].height,n.title=ut(e.dialogbox[t].title),n.message=ut(e.dialogbox[t].message),kp.push(n),tl=kp.length}for(t=0;t<e.enemylist.length;t++)Wp(e.enemylist[t].id,(0,R.Y$)(e.enemylist[t].xpos,e.enemylist[t].ypos));return new Promise((function(n,a){var o;(o=e.theme,new Promise((function(e,t){(0,I.logfile_message)("brickdata_load('%s')",o),x(o).then(Kt).then((function(e){Xt=e})).then(e)}))).then((function(a){for(var o=0;o<e.bricklist.length;o++)Zp(e.bricklist[o].id,(0,R.Y$)(e.bricklist[o].xpos,e.bricklist[o].ypos));Zn(e.bgtheme).then((function(a){for(Sc=a,t=0;t<e.itemlist.length;t++)hp[t]=Xp(e.itemlist[t].id,(0,R.Y$)(e.itemlist[t].xpos,e.itemlist[t].ypos));n()}))}))}))},Td=function(e){return new Promise((function(t,n){var a={};(0,I.logfile_message)("load_quest('%s')",e),a.file=e,a.name="",a.author="",a.version="",a.description="",a.image=null,a.level_count=0,a.show_ending=!1,x(e).then(Dd).then((function(e){e&&(a=e),(0,I.logfile_message)("load_quest() ok!"),t(a)}))}))},Dd=function(e){return new Promise((function(t,n){var a={};a.name=e.name||"",a.author=e.author||"Open Sonic",a.version=e.version||"0",a.description=e.description||"",a.show_ending=e.show_ending||!1,a.level_count=e.levels?e.levels.length:0,a.level_path=e.levels||[],function(e){return new Promise((function(t,n){var a=e||"data/images/null.png";a=d.DATA_ROOT+a,wt(a).then((function(e){t(e)}))}))}(e.image).then((function(e){a.image=e,t(a)}))}))},Fd={TOTALTIME:0,BIGRINGS:0,GLASSES:0},Ad=function(){var e;for(ol=!1,e=0;e<3;e++)Fd[e]=0},Rd=function(){return 0==nl.level_count?((0,I.logfile_message)("Quest '%s' has no levels.",nl.file),void game_quit()):al<nl.level_count&&!ol?(Ep(nl.level_path[al]),(0,ft.ZH)(sh(Wf)),void al++):((0,ft.xp)(),void(ol?(0,ft.ZH)(sh(Jf)):nl.show_ending?(0,ft.ZH)(sh(Kf)):(0,ft.ZH)(sh(eh))))},qd=function(){},Gd=function(){},Cd=function(){ol=!0},Hd=0,Ud=function(e,t){var n=(0,q.clip)(parseInt(e,10),0,2);Fd[n]=t},Bd=function(e){var t=(0,q.clip)(parseInt(e,10),0,2);return Fd[t]},Zd=[],Xd=function(){il=0,Zd[0]=$n(7),Zd[0].position=(0,R.Y$)(-50,112),On(Zd[0],"GAME"),Zd[1]=$n(7),Zd[1].position=(0,R.Y$)(298,112),On(Zd[1],"OVER")},Wd=function(){var e=(0,A.dF)();if((il+=e)>5){if(Q())return Cd(),void(0,ft.xp)();z(St(0,0,0),2)}Zd[0].position.x+=200*e,Zd[0].position.x>80&&(Zd[0].position.x=80),Zd[1].position.x-=200*e,Zd[1].position.x<168&&(Zd[1].position.x=168)},Vd=function(){J();var e=(0,R.Y$)(240,135.5);Pn(Zd[0],e),Pn(Zd[1],e)},zd=function(){$t(void 0),Zd[1],Zd[0],Cd()},Qd=function(){rl=0,Zn("data/themes/intro.bg.json").then((function(e){sl=e,V(St(0,0,0),1)}))},Kd=function(){if(sl&&(rl+=(0,A.dF)(),Wn(sl),rl>=3)){if(Q())return(0,ft.xp)(),void(0,ft.ZH)(sh(Jf));z(St(0,0,0),1)}},Jd=function(){if(sl){var e=(0,R.Y$)(240,135.5);Vn(sl,e),zn(sl,e)}},eu=function(){sl=null},tu=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],nu=1,au=[],ou=[],iu=function(){ul=0,ll=!1,gl=0,hl=Ke(),pl=$n(8),au[0]=$n(4),On(au[0],"SELECT YOUR"),au[0].position.x=(G-Mn(au[0]).length*jn(au[0]).x)/2-140,au[0].position.y=10,au[1]=$n(4),On(au[1],"LANGUAGE"),au[1].position.x=(G-Mn(au[1]).length*jn(au[1]).x)/2-120,au[1].position.y=au[0].position.y+jn(au[1]).y+10+10,au[2]=$n(8),On(au[2],ut("MENU_CQ_BACK")),au[2].position.x=10,au[2].position.y=C-1.5*jn(au[2]).y,ml=Zn("data/themes/langselect.bg.json").then((function(e){ml=e,V(St(0,0,0),1)})),fl=sn(),fn(fl,Pt("SD_TITLEFOOT",0)),_u(),V(St(0,0,0),1)},ru=function(){var e=(0,A.dF)();if(gl+=e,Wn(ml),fl&&ou.length&&(fl.position=(0,R.Y$)(ou[0][ul].position.x,ou[0][ul].position.y),fl.position.x-=15,fl.position.x+=5*Math.cos(2*d.PI*gl)),!ll&&!K()){if(tt(hl,2)&&(ul=(ul+1)%_l,j(mt("choose"))),tt(hl,1)&&(ul=((ul-1)%_l+_l)%_l,j(mt("choose"))),tt(hl,5)||tt(hl,7)){if(!dl)return;var t=dl[ul].filepath;(0,I.logfile_message)('Loading language "%s", "%s"',dl[ul].title,t),pt("data/languages/english.json"),pt(t),lu(t),j(mt("select"))}tt(hl,8)&&(j(mt("return")),ll=!0)}if(cl=Math.floor(1+ul/8),nu=Math.floor(1+Math.max(0,_l-1)/8),On(pl,"page %d/%d",cl,nu),pl.position.x=G-Mn(pl).length*jn(pl).x-10,pl.position.y=C-jn(pl).y-3,!O()){var n=k("data/music/options.mp4");E(n,d.INFINITY)}if(ll){if(Q())return void(0,ft.xp)();z(St(0,0,0),1)}},su=function(){var e,t=(0,R.Y$)(240,135.5);for(J(),Vn(ml,t),zn(ml,t),Pn(au[0],t),Pn(au[1],t),Pn(au[2],t),nu>1&&Pn(pl,t),e=8*(cl-1);e<8*cl;e++)tu[e]&&ou.length>1&&Pn(ou[ul==e?1:0][e],t);ln(fl,t)},cu=function(){pu(),ml=Xn(),cn(fl),au[0],au[1],Je(hl)},lu=function(e){var t;t=e,L.language=t,T()},_u=function(){(0,I.logfile_message)("load_lang_list()"),y(tu).then((function(e){_l=(dl=e).length,ou[0]=[],ou[1]=[];for(var t=0;t<_l;t++)dl[t].filepath=tu[t],ou[0][t]=$n(8),ou[1][t]=$n(8),On(ou[0][t],dl[t].LANG_LANGUAGE),On(ou[1][t],dl[t].LANG_LANGUAGE),ou[0][t].position=(0,R.Y$)(25,75+t%8*20),ou[1][t].position=(0,R.Y$)(25,75+t%8*20)}))},pu=function(){var e;for((0,I.logfile_message)("unload_lang_list()"),e=0;e<_l;e++)ou[0][e],ou[1][e];ou[0]=null,ou[1]=null,dl=null,_l=0},du=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],uu=3,fu=[],hu=[],gu=function(){var e,t;for(Ll=!1,bl=0,Il=.001*(0,A.$I)(),wl=!1,xl=null,yl=Ke(),ot(yl),vu(),Rl=k("data/music/title.mp4"),E(Rl,!0),vl=Zn("data/themes/menu.bg.json").then((function(e){vl=e,V(St(0,0,0),1)})),$l=!0,Ol=sn(),(Ol=fn(Ol,Pt("SD_TITLESURGE",0))).position.x=(G-dn(Ol).width)/2+5,Ol.position.y=-15,Ml=sn(),(Ml=fn(Ml,Pt("SD_TITLEBG",0))).position.x=(G-dn(Ml).width)/2,Ml.position.y=Ol.position.y+25,jl=sn(),(jl=fn(jl,Pt("SD_TITLEGAMENAME",0))).position.x=(G-dn(jl).width)/2,jl.position.y=Ol.position.y+dn(Ol).height-9,(Nl=$n(8)).position=(0,R.Y$)(3,259),On(Nl,"%s",d.GAME_WEBSITE),(Pl=$n(0)).position=(0,R.Y$)(405,3),On(Pl,"V%d.%d.%d",d.GAME_VERSION,d.GAME_SUB_VERSION,d.GAME_WIP_VERSION),El=0,Yl=sn(),Yl=fn(Yl,Pt("SD_TITLEFOOT",0)),(kl=[])[0]=dt("MENU_1PGAME"),kl[1]=dt("MENU_TUTORIAL"),kl[2]=dt("MENU_CUSTOMQUESTS"),kl[3]=dt("MENU_OPTIONS"),uu=kl.length,Sl=[],e=0;e<2;e++)for(t=0;t<uu;t++)Sl[t]||(Sl[t]=[]),Sl[t][e]=$n(e),Sl[t][e].position=(0,R.Y$)(240-dn(Ml).width/5,jl.position.y+65+10*t),On(Sl[t][e],kl[t]);fu[0]=$n(8),fu[0].position=(0,R.Y$)(5,3),fu[1]=$n(8),fu[1].position=(0,R.Y$)(5,258),(Tl=$n(8)).position=(0,R.Y$)(5,170),V(St(0,0,0),1.5)},mu=function(){var e,t=.001*(0,A.$I)();if(null!=xl&&Q())return(0,ft.xp)(),void(0,ft.ZH)(xl);switch(t<=Il+2?ot(yl):wl||(it(yl),wl=!0),Wn(vl),bl){case 0:$l&&hn(Ol)&&($l=!1,Ol=fn(Ol,Pt("SD_TITLESURGE",1)),it(yl)),jl.visible=!$l,Yl.position.x=Sl[El][0].position.x-20+3*Math.cos(2*d.PI*t),Yl.position.y=Sl[El][0].position.y,tt(yl,1)&&(j(mt("choose")),El--),tt(yl,2)&&(j(mt("choose")),El++),El=(El%uu+uu)%uu,(tt(yl,5)||tt(yl,7))&&(j(mt("select")),xu(El));break;case 1:for(tt(yl,8)&&(j(mt("return")),bl=0),e=0;e<Fl;e++)hu[e].position=(0,R.Y$)(30,20+e%14*10),hu[e].visible=Iu(e)==Iu(Dl);if(Yl.position.x=10,Yl.position.y=hu[Dl].position.y,tt(yl,1)&&(j(mt("choose")),Dl--),tt(yl,2)&&(j(mt("choose")),Dl++),Dl=(Dl%Fl+Fl)%Fl,On(fu[0],ut("MENU_CQ_SELECT"),Iu(Dl),wu()),On(fu[1],ut("MENU_CQ_BACK")),On(Tl,ut("MENU_CQ_INFO"),Al[Dl].version,Al[Dl].name,Al[Dl].author,Al[Dl].description),tt(yl,5)||tt(yl,7))return j(mt("select")),void ku(Al[Dl])}},bu=function(){var e,t=(0,R.Y$)(240,135.5);if(J(),!Ll||!Q())switch(Vn(vl,t),zn(vl,t),bl){case 0:for(e=0;e<uu;e++)Pn(Sl[e][e==El?1:0],t);ln(Yl,t),Pn(Nl,t),Pn(Pl,t),ln(Ml,t),$l&&J(),ln(Ol,t),ln(jl,t);break;case 1:var n=Al[Dl].image;for(Pn(Tl,t),kt(n,ne(),0,0,G-n.width-25,parseInt(hu[0].position.y,10),n.width,n.height),Pn(fu[0],t),Pn(fu[1],t),e=0;e<Fl;e++)Pn(hu[e],t);ln(Yl,t)}},yu=function(){var e,t;for(Rl.pause(),e=0;e<2;e++)for(t=0;t<uu;t++)Sl[t][e];cn(Ml),cn(jl),cn(Ol),cn(Yl),Je(yl)},xu=function(e){var t=du[0];switch(e){case 0:return void Td(t).then((function(e){ku(e)}));case 1:return void Td("data/quests/tutorial.json").then((function(e){ku(e)}));case 2:bl=1,Dl=0;break;case 3:return xl=sh(oh),void z(St(0,0,0),.5)}},vu=function(){var e;for(Fl=du.length,Al=[],e=0;e<Fl;e++)!function(t){Td(du[e]).then((function(e){hu[t]=$n(8),Al[t]=e,On(hu[t],e.name)}))}(e)},Iu=function(e){return Math.floor(e/14+1)},wu=function(){return Math.floor(Fl/14+(Fl%14==0?0:1))},ku=function(e){var t,n;nl=t=e,Wa(5),Va(0),(0,I.logfile_message)("Running quest %s, '%s'...",t.file,t.name),n=0,al=Math.max(0,n),xl=sh(Qf),ot(yl),z(St(0,0,0),.5)},Eu=function e(t){var n;if(t)for(t.init(t),n=0;n<t.child_count;n++)e(t.child[n])},Su=function e(t){var n;if(t){for(n=0;n<t.child_count;n++)e(t.child[n]);t.update(t)}},Yu=function e(t,n){var a;if(t){for(a=0;a<t.child_count;a++)e(t.child[a],n);t.render(t,n)}},$u=function e(t){var n,a=0;if(t){for(n=0;n<t.child_count;n++)a+=e(t.child[n]);return 1+a}return 0},Ou=function(e,t,n,a){var o={};return o.init=e,o.release=t,o.update=n,o.render=a,o.font=null,o.data=null,o.parent=null,o.child_count=0,o.child=[],o},Mu=function(e,t){e.child_count<10&&(e.child[e.child_count++]=t,t.parent=e)},ju=function(e){if(e.font=$n(8),On(e.font,"LABEL"),null!=e.parent){var t,n,a=0,o=null!=e.parent.font?jn(e.parent.font):(0,R.Y$)(12,12);for(t=0;t<e.parent.child_count&&e.parent.child[t]!=e;t++);for(n=0;n<t;n++)a+=$u(e.parent.child[n])-1;e.font.position={x:e.parent.font.position.x,y:e.parent.font.position.y},e.font.position.x+=3*o.x,e.font.position.y+=(1+a+t)*o.y*2}},Nu=function(e){e.font},Pu=function(e,t){Pn(e.font,t)},Lu=function(){Wl=0,ql=!1,Zl=0,Ul=Ke(),Bl=null,Gl=!0,Cl=$n(4),On(Cl,ut("OPTIONS_TITLE")),Cl.position.x=140,Cl.position.y=10,Xl=Zn("data/themes/options.bg.json").then((function(e){Xl=e})),Hl=sn(),fn(Hl,Pt("SD_TITLEFOOT",0)),Hl.position=(0,R.Y$)(-50,-50),Vl=Yf(),Eu(Vl)},Tu=function(){var e=(0,A.dF)();if(Zl+=e,On(Cl,ut("OPTIONS_TITLE")),Gl&&(V(St(0,0,0),1),Gl=!1),Wn(Xl),ql||null!=Bl||K()||(tt(Ul,2)&&(Wl=(Wl+1)%5,j(mt("choose"))),tt(Ul,1)&&(Wl=((Wl-1)%5+5)%5,j(mt("choose"))),tt(Ul,8)&&(j(mt("return")),ql=!0)),Su(Vl),ql)K()||S();else if(!O()&&Zl>=.2){var t=k("data/music/options.mp4");E(t,d.INFINITY)}if(ql){if(Q())return Au(),(0,ft.xp)(),void(0,ft.ZH)(sh(Jf));z(St(0,0,0),1)}if(null!=Bl){if(Q())return Au(),(0,ft.ZH)(Bl),Bl=null,void(Gl=!0);z(St(0,0,0),1)}},Du=function(){var e=(0,R.Y$)(240,135.5);Vn(Xl,e),zn(Xl,e),Pn(Cl,e),Yu(Vl,e),ln(Hl,e)},Fu=function(){cn(Hl),Je(Ul)},Au=function(){var e,t,n;!function(e){L.video_resolution=e,T()}(ae()),e=ie(),L.fullscreen=e,T(),t=oe(),L.smooth_graphics=t,T(),n=re(),L.show_fps=n,T()},Ru=function(e,t){ju(e),e.data=t,On(e.font,ut(t))},qu=function(e){e.data=null,Nu(e)},Gu=function(e){On(e.font,ut(e.data))},Cu=function(e,t){Pu(e,t)},Hu=function(e,t,n){var a;ju(e),On(e.font,ut(t)),e.data={},(a=e.data).option_index=n,a.lang_key=t},Uu=function(e){e.data=null,Nu(e)},Bu=function(e){var t=e.data;return Wl==t.option_index},Zu=function(e){var t=e.data;On(e.font,ut(t.lang_key)),Bu(e)&&(On(e.font,"<color=ffff00>%s</color>",ut(t.lang_key)),Hl.position=(0,R.qq)(e.font.position,(0,R.Y$)(3*Math.cos(2*d.PI*Zl)-20,0)))},Xu=function(e,t){Pu(e,t)},Wu=function(e){ju(e),On(e.font,""),e.font.position=(0,R.Y$)(0,25)},Vu=function(e){Nu(e)},zu=function(e){},Qu=function(e,t){Pu(e,t)},Ku=function(e){Ru(e,"OPTIONS_GRAPHICS")},Ju=function(e){qu(e)},ef=function(e){Gu(e)},tf=function(e,t){Cu(e,t)},nf=function(e){Hu(e,"OPTIONS_FPS",0)},af=function(e){Uu(e)},of=function(e){Zu(e),function(e){return Bu(e)}(e)&&(K()||((tt(Ul,5)||tt(Ul,7))&&(j(mt("select")),se(!re())),tt(Ul,3)&&re()&&(j(mt("select")),se(!1)),tt(Ul,4)&&(re()||(j(mt("select")),se(!0)))))},rf=function(e,t){var n,a=[];Xu(e,t),(n=$n(8)).position=(0,R.Y$)(175,e.font.position.y),a[0]=ut("OPTIONS_YES"),a[1]=ut("OPTIONS_NO"),re()?On(n,"<color=ffff00>%s</color>  %s",a[0],a[1]):On(n,"%s  <color=ffff00>%s</color>",a[0],a[1]),Pn(n,t)},sf=function(e){Ru(e,"OPTIONS_GAME")},cf=function(e){qu(e)},lf=function(e){Gu(e)},_f=function(e,t){Cu(e,t)},pf=function(e){Hu(e,"OPTIONS_LANGUAGE",1)},df=function(e){Uu(e)},uf=function(e){Zu(e),function(e){return Bu(e)}(e)&&(K()||(tt(Ul,5)||tt(Ul,7))&&(j(mt("select")),Bl=sh(nh)))},ff=function(e,t){Xu(e,t)},hf=function(e){Hu(e,"OPTIONS_STAGESELECT",2)},gf=function(e){Uu(e)},mf=function(e){Zu(e),function(e){return Bu(e)}(e)&&(K()||(tt(Ul,5)||tt(Ul,7))&&(j(mt("select")),Bl=sh(ih)))},bf=function(e,t){Xu(e,t)},yf=function(e){Hu(e,"OPTIONS_CREDITS",3)},xf=function(e){Uu(e)},vf=function(e){Zu(e),function(e){return Bu(e)}(e)&&(K()||(tt(Ul,5)||tt(Ul,7))&&(j(mt("select")),Bl=sh(ah)))},If=function(e,t){Xu(e,t)},wf=function(e){Hu(e,"OPTIONS_BACK",4)},kf=function(e){Uu(e)},Ef=function(e){Zu(e),function(e){return Bu(e)}(e)&&(K()||(tt(Ul,5)||tt(Ul,7))&&(j(mt("select")),ql=!0))},Sf=function(e,t){Xu(e,t)},Yf=function(){var e,t,n,a,o,i,r,s;return n=Ou(nf,af,of,rf),t=Ou(Ku,Ju,ef,tf),Mu(t,n),o=Ou(pf,df,uf,ff),i=Ou(yf,xf,vf,If),r=Ou(hf,gf,mf,bf),a=Ou(sf,cf,lf,_f),Mu(a,o),Mu(a,r),Mu(a,i),s=Ou(wf,kf,Ef,Sf),e=Ou(Wu,Vu,zu,Qu),Mu(e,t),Mu(e,a),Mu(e,s),e},$f=function(){zl=Ke(),Ql=!1,Kl=!1,Jl=0},Of=function(){var e;if(tt(zl,8))return dt("CBOX_QUIT_QUESTION",e[0],sizeof(e[0])),dt("CBOX_QUIT_OPTION1",e[1],sizeof(e[1])),dt("CBOX_QUIT_OPTION2",e[2],sizeof(e[2])),Un(e[0],e[1],e[2]),void(0,ft.ZH)(sh(th));if(1==Bn()&&(Kl=!0),Kl)return Q()?((0,ft.xp)(),(0,ft.xp)(),void Cd()):void z(image.rgb(0,0,0),1);if(Ql){if(tt(zl,7))return audio.music_resume(),void(0,ft.xp)()}else nt(zl,7)&&(Ql=!0)},Mf=function(){var e=Lt(Pt("SD_PAUSE",0),0),t=1+.5*Math.abs(Math.cos(d.PI/2*Jl));(0,R.Y$)((G-e.width)/2-(t-1)*e.width/2,(C-e.height)/2-(t-1)*e.height/2),Kl||(Jl+=(0,A.dF)())},jf=function(){$t(void 0),Je(zl)},Nf=function(){(0,A.$I)(),o_=!1,(e_=$n(8)).position=(0,R.Y$)(5,35),t_=$n(4),On(t_,ut("QUESTCLEARED_TITLE")),t_.position=(0,R.Y$)((parseInt(jn(t_).x*Mn(t_)).length,10),5),n_=sn(),fn(n_,Pt("SD_SONIC",24)),n_.position=(0,R.Y$)(20,150),E(k("data/music/invincible.mp4"),0),a_=Ke(),V(St(0,0,0),2)},Pf=function(){var e=Za(),t=Bd("QUESTVALUE_TOTALTIME")/3600,n=parseInt(Bd("QUESTVALUE_TOTALTIME")/60%60,10),a=parseInt(Bd("QUESTVALUE_TOTALTIME")%60,10),o=Bd("QUESTVALUE_GLASSES"),i=Bd("QUESTVALUE_BIGRINGS");if((0,A.$I)(),On(e_,ut("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",e,t,n,a,o,i,d.GAME_TITLE,d.GAME_WEBSITE),tt(a_,5)&&(o_=!0),o_){if(Q())return(0,ft.xp)(),void(0,ft.ZH)(sh(Jf));z(St(0,0,0),2)}},Lf=function(){var e=(0,R.Y$)(240,135.5);J(),Pn(t_,e),Pn(e_,e),ln(n_,e)},Tf=function(){Je(a_),cn(n_)},Df=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],Ff=1,Af=[],Rf=0,qf=0,Gf=[],Cf=function(){qf=0,p_=0,u_=0,__=Ke(),r_=$n(4),On(r_,ut("STAGESELECT_TITLE")),r_.position.x=(G-Mn(r_).length*jn(r_).x)/2-150,r_.position.y=10,s_=$n(8),On(s_,ut("STAGESELECT_MSG")),s_.position.x=10,s_.position.y=C-1.5*jn(s_).y,c_=$n(8),On(c_,ut("STAGESELECT_PAGE"),0,0),c_.position.x=G-Mn(c_).length*jn(c_).x-10,c_.position.y=40,Zn("data/themes/levelselect.bg.json").then((function(e){d_=e})),l_=sn(),fn(l_,Pt("SD_TITLEFOOT",0)),Zf(),V(St(0,0,0),1)},Hf=function(){var e=(0,A.dF)();if(p_+=e,Wn(d_),Gf.length){if(l_.position=(0,R.Y$)(Gf[qf].position.x,Gf[qf].position.y),l_.position.x+=3*Math.cos(2*d.PI*p_)-20,i_=Math.floor(qf/8+1),Ff=Math.floor(Rf/8+(Rf%8==0?0:1)),On(c_,ut("STAGESELECT_PAGE"),i_,Ff),c_.position.x=G-Mn(c_).length*jn(c_).x-10,2==u_)K()||S();else if(!O()){var t=k("data/music/options.mp4");E(t,d.INFINITY)}switch(u_){case 0:K()||(tt(__,2)&&(qf=(qf+1)%Rf,j(mt("choose"))),tt(__,1)&&(qf=((qf-1)%Rf+Rf)%Rf,j(mt("choose"))),(tt(__,5)||tt(__,7))&&((0,I.logfile_message)('Loading level "%s", "%s"',Af[qf].name,Af[qf].filepath),Ep(Af[qf].filepath),j(mt("select")),u_=2),tt(__,8)&&(j(mt("return")),u_=1));break;case 1:if(Q())return void(0,ft.xp)();z(St(0,0,0),1);break;case 2:if(Q())return Wa(5),Va(0),(0,ft.ZH)(sh(Wf)),void(u_=3);z(St(0,0,0),1);break;case 3:V(St(0,0,0),1),u_=0}}},Uf=function(){var e,t=(0,R.Y$)(240,135.5);for(Vn(d_,t),zn(d_,t),Pn(r_,t),Pn(s_,t),Ff>1&&Pn(c_,t),e=8*(i_-1);e<8*i_;e++)Af[e]&&(On(Gf[e],qf==e?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",Af[e].name,ut("STAGESELECT_ACT"),Af[e].act),Pn(Gf[e],t));ln(l_,t)},Bf=function(){Xf(),d_=Xn(),cn(l_),Je(__)},Zf=function(){(0,I.logfile_message)("load_stage_list()"),y(Df).then((function(e){Rf=(Af=e).length;for(var t=0;t<Rf;t++)Gf[t]=$n(8),Gf[t].position=(0,R.Y$)(25,60+t%8*20),Af[t].filepath=Df[t]}))},Xf=function(){},Wf=1,Vf=2,zf=3,Qf=4,Kf=5,Jf=6,eh=7,th=8,nh=9,ah=10,oh=11,ih=12,rh=[],sh=function(e){return console.log("GET SCENE",e),rh[e]},ch=function(e,t,n,a){return{init:e,update:t,render:n,release:a}},lh=function(e){ph();var t=function(e){var t={};return t.video_resolution=L.video_resolution,t.smooth_graphics=L.smooth_graphics,t.fullscreen=L.fullscreen,t.show_fps=L.show_fps,t.language=L.language,t.video_resolution=e.video_resolution?e.video_resolution:t.video_resolution,t.smooth_graphics=e.smooth_graphics?e.smooth_graphics:t.smooth_graphics,t.fullscreen=e.fullscreen?e.fullscreen:t.fullscreen,t.show_fps=e.show_fps?e.show_fps:t.show_fps,t.color_depth=e.color_depth?e.color_depth:32,t.level=e.level?e.level:null,t.quest=e.quest?e.quest:null,t.language=e.language?e.language:t.language,t.video_resolution=D("video_resolution")?D("video_resolution"):t.video_resolution,t.smooth_graphics=D("smooth_graphics")?D("smooth_graphics"):t.smooth_graphics,t.fullscreen=D("fullscreen")?D("fullscreen"):t.fullscreen,t.show_fps=D("show_fps")?D("show_fps"):t.show_fps,t.color_depth=D("color_depth")?D("color_depth"):t.color_depth,t.level=D("level")?D("level"):t.level,t.quest=D("quest")?D("quest"):t.quest,t.language=D("language")?D("language"):t.language,t.level?(t.custom_level=!0,t.custom_level_path=t.level):t.custom_level=!1,t.quest?(t.custom_quest=!0,t.custom_quest_path=t.quest):t.custom_quest=!1,t}(e);console.log("COMMAND LINE",t),dh(t),new Promise((function(e,t){var n;for((0,I.logfile_message)("Loading sprites..."),u.sprites={},Ot=u.sprites,n=0;n<Mt.length;n++)Mt[n]="data/sprites/"+Mt[n]+".json";ee("Loading...",0),y(Mt).then((function(t){for(console.log("GOT ALL SPRITE JSON FILES"),n=0;n<t.length;n++)for(var a in t[n])t[n][a].name=a,Nt.push(t[n][a]);Gt(Nt).then((function(){(0,I.logfile_message)("All sprites have been loaded!"),Ot=f(),e()}))}))})).then((function(){!function(){var e,t,n,a=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for((0,I.logfile_message)("font_init()"),e=0;e<a.length;e++)for(Yn[e]={ch:[]},n="FT_FONT"+e,t=0;t<a[e].length;t++)Yn[e].ch[a[e][t]]=Lt(Pt(n,0),t);(0,I.logfile_message)("font_init() ok")}(),uh(t,(function(){fh(),hh(t),_h()}))}))},_h=function(){var e;(0,q.runAnimation)((function(t){var n;(0,A.yc)(t),function(){var e,t,n=(0,A.dF)();for(t=Be;t;t=t.next){for(e=0;e<9;e++)t.data.oldstate[e]=t.data.state[e];for(e=0;e<9;e++)et(t.data,e)?t.data.howlong[e]+=n:t.data.howlong[e]=0;switch(t.data.type){case 1:t.data.state[1]=he.up,t.data.state[2]=he.down,t.data.state[4]=he.left,t.data.state[3]=he.right,t.data.state[5]=he.space,t.data.state[6]=he.lcontrol,t.data.state[7]=he.enter,t.data.state[8]=he.esc,t.data.state[9]=he.tilda;break;case 4:t.data.x=We.x,t.data.y=We.y,t.data.state[5]=Ve.left,t.data.state[7]=Ve.middle,t.data.state[6]=Ve.right;break;case 2:for(e=0;e<9;e++)t.data.state[e]=!1;break;case 3:ue&&!fe&&(t.data.state[1]=joy[0].stick[0].axis[1].d1,t.data.state[2]=joy[0].stick[0].axis[1].d2,t.data.state[4]=joy[0].stick[0].axis[0].d1,t.data.state[3]=joy[0].stick[0].axis[0].d2,t.data.state[5]=joy[0].button[0].b,t.data.state[6]=joy[0].button[1].b,t.data.state[7]=joy[0].button[2].b,t.data.state[8]=joy[0].button[3].b);break;case 0:t.data.state[1]=he.up,t.data.state[2]=he.down,t.data.state[4]=he.left,t.data.state[3]=he.right,t.data.state[5]=he.space,t.data.state[6]=he.lcontrol,t.data.state[7]=he.enter,t.data.state[8]=he.esc,Ze&&(t.data.state[1]=ge.up(),t.data.state[2]=ge.down(),t.data.state[4]=ge.left(),t.data.state[3]=ge.right(),t.data.state[5]=me._pressed,t.data.state[8]=be._pressed,t.data.state[6]=ye._pressed),xe&&(ve="undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)),ve&&(t.data.state[1]=ve.buttons[12].pressed,t.data.state[2]=ve.buttons[13].pressed,t.data.state[4]=ve.buttons[14].pressed,t.data.state[3]=ve.buttons[15].pressed,t.data.state[5]=ve.buttons[0].pressed,t.data.state[6]=ve.buttons[1].pressed,t.data.state[7]=ve.buttons[2].pressed,t.data.state[8]=ve.buttons[3].pressed)}}}(),(e=(0,ft.hX)())&&(e.update(),e==(0,ft.hX)()&&e.render()),(0,ht.IW)(),c=!1,0!=s&&((_+=(0,A.dF)())<p?(n=parseInt(1.25*_/p*100,10),n=(0,q.clip)(n,0,100),n=1==s?100-n:n,n/=100,ne().fillStyle=l,ne().globalAlpha=n,ne().fillRect(0,0,a.width,a.height)):(2==s&&(ne().fillStyle=l,ne().fillRect(0,0,a.width,a.height)),s=0,p=_=0,l=0,c=!0)),ne().globalAlpha=1,re()&&(ne().font="14px Arial",ne().fillStyle="white",ne().fillText((0,A.eh)(),450,20)),ge&&ge.render(ne()),me&&me.render(ne()),be&&be.render(ne()),ye&&ye.render(ne())}))},ph=function(){(0,I.logfile_message)("preferences_init()"),function(){if(L.video_resolution="TINY",L.fullscreen=!1,L.smooth_graphics=!1,L.show_fps=!1,L.language="data/languages/english.json","undefined"!=typeof window)for(var e in L)L[e]=window.localStorage.getItem(e)?localStorage.getItem(e):L[e],"false"==L[e]&&(L[e]=!1);console.log("PREFERENCES",L)}()},dh=function(e){var t,n,r,s;(0,A.ss)(),gh(),t=e.video_resolution,n=e.smooth_graphics,r=e.fullscreen,e.color_depth,s=e.show_fps,ce(t,n,r),se(s),(a=document.getElementById("canvas"))?(console.log("111111111"),o=a.getContext("2d"),Z=a.width/G,X=a.height/C,o.scale(a.width/G,a.height/C)):(console.log("222222222"),a=document.createElement("canvas"),o=a.getContext("2d"),a.width=G,a.height=C,document.body.appendChild(a)),Z=G/window.innerWidth,X=Z,o.imageSmoothingEnabled=!1,o.mozImageSmoothingEnabled=!1,console.log("PIXEL RATIO",window.devicePixelRatio),console.log("VIDEO_SCREEN_W",G),console.log("VIDEO_SCREEN_H",C),console.log("CANVAS",a.width,a.height),console.log("WINDOW",window.innerWidth),console.log("SCALE",Z),i=o,J(),(0,I.logfile_message)("input_init()"),Be=null,te().addEventListener("contextmenu",(function(e){if(2===e.button)return e.preventDefault(),!1}),!1),te().addEventListener("mousemove",(function(e){We=function(e,t){var n=e.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}(te(),e)}),!1),te().addEventListener("mousedown",(function(e){switch(e.which){case 1:Ve.left=!0;break;case 2:Ve.middle=!0;break;case 3:Ve.right=!0}}),!1),te().addEventListener("mouseup",(function(e){switch(e.which){case 1:Ve.left=!1;break;case 2:Ve.middle=!1;break;case 3:Ve.right=!1}}),!1),ue=!1,fe=!1,xe=(0,F.KP)(),console.log("canGamepad",xe),(Ze=(0,F.nw)())&&(console.log("21111",te()),(ge=new de({container:te(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>=window.innerWidth/2||t.pageY<window.innerHeight/2)})),(me=new de({container:te(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY<window.innerHeight/2)})),(be=new de({container:te(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX>window.innerWidth/2||t.pageY>window.innerHeight/2)})),(ye=new de({container:te(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(e){var t=e.changedTouches[0];return!(t.pageX<window.innerWidth/2||t.pageY>window.innerHeight/2)}))),he=function(e){var t=Object.create(null);function n(n){if(e.hasOwnProperty(n.keyCode)){var a="keydown"==n.type;t[e[n.keyCode]]=a,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),t}(Xe),u.images={},u.images,u.samples={},g=u.samples,u.musics={},m=u.musics},uh=function(e,t){(0,I.logfile_message)("soundfactory: loading the samples table..."),x("data/config/samples.json").then((function(e){bt(e)})),(0,I.logfile_message)("Loading objects scripts..."),Xs=null,x("data/objects/enemies.json").then((function(e){Xs=e})),function(){for(var e=0;e<256;e++)rh[e]=null;rh[Wf]=ch($p,Op,Mp,jp),rh[Vf]=ch($f,Of,Mf,jf),rh[zf]=ch(Xd,Wd,Vd,zd),rh[Qf]=ch(Ad,Rd,qd,Gd),rh[Jf]=ch(gu,mu,bu,yu),rh[0]=ch(Qd,Kd,Jd,eu),rh[Kf]=ch(_a,pa,da,ua),rh[eh]=ch(Nf,Pf,Lf,Tf),rh[th]=ch(qn,Gn,Cn,Hn),rh[nh]=ch(iu,ru,su,cu),rh[ah]=ch(oa,ia,ra,sa),rh[oh]=ch(Lu,Tu,Du,Fu),rh[ih]=ch(Cf,Hf,Uf,Bf)}(),(0,ht.pH)(),function(e,t){(0,I.logfile_message)("Initializing the language module"),pt(lt=e||lt).then((function(e){console.log(e),(0,I.logfile_message)("lang_init() ok!"),t()}))}(e.language,(function(){(0,ft.eD)(),t()}))},fh=function(){Wa(5),Va(0)},hh=function(e){e.custom_level?(Ep(e.custom_level_path),(0,ft.ZH)(sh(Wf))):(0,ft.ZH)(sh(0))},gh=function(){return""}},517:(e,t,n)=>{n.r(t),n.d(t,{bounding_box:()=>p,circular_collision:()=>d,clip:()=>_,isArray:()=>s,isInArray:()=>c,isspace:()=>r,old_school_angle:()=>f,random:()=>l,runAnimation:()=>i,swap:()=>u});var a=n(386),o=n(878),i=function(e){var t=null;requestAnimationFrame((function n(a){var o=!1;if(null!=t){var i=Math.min(a-t,100)/1e3;o=!1===e(i)}t=a,o||requestAnimationFrame(n)}))},r=function(e){return" "==e},s=function(e){return void 0!==e&&e&&e.constructor===Array},c=function(e,t){return t.indexOf(e)>-1},l=function(e){return _(parseInt(Math.random(e)*e,10),1,e)},_=function(e,t,n){return Math.min(Math.max(e,t),n)},p=function(e,t){return e[0]<t[2]&&e[2]>t[0]&&e[1]<t[3]&&e[3]>t[1]},d=function(e,t,n,a){return(0,o.qU)((0,o.Zu)(e,n))<=t+a},u=function(e,t){return h(e,t,e.length)},f=function(e){return e>=0&&e<a.PI/4-a.EPSILON?0:e>=a.PI/4-a.EPSILON&&e<a.PI/2-a.EPSILON?a.PI/4:e>=a.PI/2-a.EPSILON&&e<a.PI/2+a.EPSILON?a.PI/2:e>=a.PI/2+a.EPSILON&&e<a.PI-a.EPSILON?3*a.PI/4:e>=a.PI-a.EPSILON&&e<a.PI+a.EPSILON?a.PI:e>=a.PI+a.EPSILON&&e<3*a.PI/2-a.EPSILON?5*a.PI/4:e>=3*a.PI/2-a.EPSILON&&e<3*a.PI/2+a.EPSILON?3*a.PI/2:e>3*a.PI/2+a.EPSILON&&e<=7*a.PI/4+a.EPSILON?7*a.PI/4:0},h=function(e,t,n){var a,o,i=e,r=t;for(a=0;a<n;a++)o=i[a],i[a]=r[a],r[a]=o;return[i[a],r[a]]}},386:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IF_VFLIP=t.IF_HFLIP=t.IF_NONE=t.PI=t.INT_MAX=t.INFINITY_FLT=t.INFINITY=t.EPSILON=t.GAME_WEBSITE=t.GAME_WIP_VERSION=t.GAME_SUB_VERSION=t.GAME_VERSION=t.GAME_TITLE=t.DATA_ROOT=void 0,t.DATA_ROOT="",t.GAME_TITLE="Open Sonic",t.GAME_VERSION=1,t.GAME_SUB_VERSION=1,t.GAME_WIP_VERSION=1,t.GAME_WEBSITE="http://opensnc.sourceforge.net",t.EPSILON=1e-4,t.INFINITY=99999999,t.INFINITY_FLT=1/0,t.INT_MAX=999999999,t.PI=Math.PI,t.IF_NONE=0,t.IF_HFLIP=!0,t.IF_VFLIP=!0},898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.logfile_fatal_error=t.logfile_message=void 0,t.logfile_message=function(e){console.log(e)},t.logfile_fatal_error=function(e){console.log("FATAL ERROR",e)}},823:(e,t)=>{t.KP=t.nw=void 0,t.nw=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},t.KP=function(){return"undefined"!=typeof navigator&&"getGamepads"in navigator}},667:(e,t)=>{t.Y8=t.hX=t.xp=t.ZH=t.eD=void 0;var n=[],a=0;t.eD=function(){a=0;for(var e=0;e<16;e++)n[e]=null},t.ZH=function(e){n[a++]=e,e&&e.init()},t.xp=function(){n[a-1].release(),n[a-1]=null,a--},t.hX=function(){return n[a-1]},t.Y8=function(){return 0===a}},817:(e,t)=>{t.IW=t.pH=void 0,t.pH=function(){},t.IW=function(){}},163:(e,t,n)=>{t.eh=t.$I=t.dF=t.yc=t.ss=void 0;var a=n(898),o=0,i=0,r=0,s=0,c=0,l=0;t.ss=function(){(0,a.logfile_message)("timer_init()"),o=0,i=0,r=0,c=0,s=(0,t.$I)()},t.yc=function(){var e=0,n=0;for(n=0;n<10;)n=(e=(0,t.$I)())>s?e-s:0,s=e>=s?s:e;n=Math.min(n,16),c=.001*n,o++,(i+=n)>=1e3&&(r=o,o=0,i=0),s=(0,t.$I)()},t.dF=function(){return c},t.$I=function(){var e=_();return e<l&&(l=e),e-l},t.eh=function(){return r};var _=function(){return Math.floor(Date.now())}},878:(e,t,n)=>{t.my=t.EN=t.qU=t.GZ=t.Zu=t.qq=t.Y$=void 0;var a=n(386);n(517);t.Y$=function(e,t){return{x:e,y:t}},t.qq=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},t.Zu=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},t.GZ=function(e,t){return{x:t*e.x,y:t*e.y}},t.qU=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},t.EN=function(e,t){var n=e.x,a=e.y;return{x:n*Math.cos(t)-a*Math.sin(t),y:a*Math.cos(t)+n*Math.sin(t)}},t.my=function(e){var n=(0,t.qU)(e);return n>a.EPSILON?(0,t.Y$)(e.x/n,e.y/n):(0,t.Y$)(0,0)}},696:(e,t,n)=>{t.D=void 0;var a=n(109);t.D=function(){(0,a.engine_init)({Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null,Xquest:null,Xlanguage:null})},(0,t.D)()}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(696)})();