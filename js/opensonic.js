(()=>{"use strict";var t,e,n,i,a,o,r,s,c,l="Open Sonic",u="http://opensnc.sourceforge.net",d=1e-5,p=1<<30,_=1/0,f=999999999,h=Math.PI,m={},g=function(){return m.sprites},v=function(t,e){return m.samples[e]},b={},y={},x={},k=function(t){return Promise.all(t.map(w))},w=function(t){return t=""+t,new Promise((function(e,n){if(x[t])e(x[t]);else{var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState){var n={};try{n=JSON.parse(i.responseText)}catch(t){}x[t]=n,e(n)}},i.send(null)}}))},E=function(t,e){!function(t,e,n){t[e]=n}(b,t,e)},S=function(t){console.log(t)},M=function(t){console.log("FATAL ERROR",t)},j=null,I=function(t){S('music_load("'.concat(t,'")'));var e=new Audio;return e.src=t,function(t,e){!function(t,e,n){t[e]=n}(y,t,e)}(t,e),e},D=function(t,e){if(L()&&T(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}j=t},T=function(){null!=j&&j.pause(),j=null},O=function(t){null!=j&&(t>1&&(t=1),t<0&&(t=0),j.volume=t)},R=function(){return null!=j?j.volume:0},L=function(){return null!=j&&!j.paused},A=function(t,e){e=""+e;var n=new Audio;n.src=e;var i=new Audio;i.src=e;var a=new Audio;a.src=e;var o=new Audio;return o.src=e,E(t,n),E(t+"2",i),E(t+"3",a),E(t+"4",o),n},N=function(t){C(t)},C=function(t){t&&t.play&&t.play()},P=function(t){return!!t&&!t.paused},B={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""},G=function(){if("undefined"!=typeof window)for(var t in B)B[t],window.localStorage.setItem(t,B[t])},U=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},H=0,Y=0,W=0,X=0,F=0,z=0,$=function(){return F},V=function(){var t=Q();return t<z&&(z=t),t-z},Q=function(){return Math.floor(Date.now())},K=function(t){return" "==t},q=function(t){return void 0!==t&&t&&t.constructor===Array},J=function(t){return~~Z(Math.random()*t,0,t)},Z=function(t,e,n){return Math.min(Math.max(t,e),n)},tt=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},et=function(t,e){return it(t,e,t.length)},nt=function(t){return t>=0&&t<h/4-d?0:t>=h/4-d&&t<h/2-d?h/4:t>=h/2-d&&t<h/2+d?h/2:t>=h/2+d&&t<h-d?3*h/4:t>=h-d&&t<h+d?h:t>=h+d&&t<3*h/2-d?5*h/4:t>=3*h/2-d&&t<3*h/2+d?3*h/2:t>3*h/2+d&&t<=7*h/4+d?7*h/4:0},it=function(t,e,n){var i,a,o=t,r=e;for(i=0;i<n;i++)a=o[i],o[i]=r[i],r[i]=a;return[o[i],r[i]]},at=function(t,e){return{x:t,y:e}},ot=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},rt=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},st=function(t,e){return{x:e*t.x,y:e*t.y}},ct=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},lt=function(t,e){var n=t.x,i=t.y;return{x:n*Math.cos(e)-i*Math.sin(e),y:i*Math.cos(e)+n*Math.sin(e)}},ut=function(t){var e=ct(t);return e>d?at(t.x/e,t.y/e):at(0,0)},dt=480,pt=271,_t=!1,ft=!1,ht=!1,mt=1,gt=1,vt=function(){return at(mt,gt)},bt=function(t,e){0==a&&(a=1,o=!1,r=t,s=0,c=e)},yt=function(t,e){0==a&&(a=2,o=!1,r=t,s=0,c=e)},xt=function(){return o},kt=function(){return 0!=a},wt=function(n){e.fillStyle=n||"rgb(0, 0, 0)",e.fillRect(0,0,t.width,t.height)},Et=function(t,e){wt();var n=Mt();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},St=function(){return t},Mt=function(){return n},jt=function(){return i},It=function(){return _t},Dt=function(){return ft},Tt=function(){return ht},Ot=function(t){ht=t},Rt=function(t,e,n){i=t,ft=n,_t=e};function Lt(t){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lt(t)}function At(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=i.key,o=void 0,o=function(t,e){if("object"!==Lt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!==Lt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(a),"symbol"===Lt(o)?o:String(o)),i)}var a,o}var Nt,Ct,Pt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,i;return e=t,i=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=vt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=vt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,i=e.pageY;return this._onDown(n,i)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var i=e[n];t.preventDefault();var a=i.pageX,o=i.pageY;return this._onMove(a,o)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&At(e.prototype,n),i&&At(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();(Nt=Pt.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},Nt.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},Nt.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var i=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}},function(t){t[t.IB_UP=1]="IB_UP",t[t.IB_DOWN=2]="IB_DOWN",t[t.IB_RIGHT=3]="IB_RIGHT",t[t.IB_LEFT=4]="IB_LEFT",t[t.IB_FIRE1=5]="IB_FIRE1",t[t.IB_FIRE2=6]="IB_FIRE2",t[t.IB_FIRE3=7]="IB_FIRE3",t[t.IB_FIRE4=8]="IB_FIRE4",t[t.IB_FIRE5=9]="IB_FIRE5"}(Ct||(Ct={}));var Bt,Gt=Ct.IB_UP,Ut=Ct.IB_DOWN,Ht=Ct.IB_LEFT,Yt=Ct.IB_RIGHT,Wt=Ct.IB_FIRE1,Xt=Ct.IB_FIRE2,Ft=Ct.IB_FIRE3,zt=Ct.IB_FIRE4,$t=Ct.IB_FIRE5;!function(t){t[t.IT_KEYBOARD=1]="IT_KEYBOARD",t[t.IT_MOUSE=2]="IT_MOUSE",t[t.IT_COMPUTER=3]="IT_COMPUTER",t[t.IT_JOYSTICK=4]="IT_JOYSTICK",t[t.IT_USER=5]="IT_USER"}(Bt||(Bt={}));var Vt,Qt=null,Kt=!1,qt=!1,Jt=!1,Zt={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},te=null,ee=null,ne=null,ie=null,ae=null,oe=null,re=null,se=null,ce={x:0,y:0},le={left:!1,middle:!1,right:!1},ue=function(){for(var t={type:Bt.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return xe(t),t},de=function(t){for(var e={type:Bt.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;if(t)for(e.keybmap=[],n=0;n<9;n++)e.keybmap[n]=t[n];else e.keybmap[Gt]=38,e.keybmap[Ut]=40,e.keybmap[Yt]=39,e.keybmap[Ht]=37,e.keybmap[Wt]=32,e.keybmap[Xt]=17,e.keybmap[Ft]=13,e.keybmap[zt]=27,e.keybmap[$t]=192;return xe(e),e},pe=function(){for(var t={type:Bt.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[Gt]=38,t.keybmap[Ut]=40,t.keybmap[Yt]=39,t.keybmap[Ht]=37,t.keybmap[Wt]=32,t.keybmap[Xt]=17,t.keybmap[Ft]=13,t.keybmap[zt]=27,xe(t),t},_e=function(t){ke(t),t=null},fe=function(t,e){return!!e&&!!t.enabled&&t.state[e]},he=function(t,e){return!!e&&!!t.enabled&&t.state[e]&&!t.oldstate[e]},me=function(t,e){return!e||!!t.enabled&&!t.state[e]&&t.oldstate[e]},ge=function(t,e){t.state[e]=!0},ve=function(t){t.enabled=!1},be=function(t){t.enabled=!0},ye=function(t){return at(t.x,t.y)},xe=function(t){Qt={data:t,next:Qt}},ke=function(t){var e,n;if(Qt.data==t)n=Qt.next,Qt=null,Qt=n;else{for(e=Qt;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},we=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var i="keydown"==n.type;e[t[n.keyCode]]=i,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Ee="data/languages/english.json",Se={},Me=function(t){return new Promise((function(e,n){S('lang_loadfile("'.concat(t,'")...')),w(t).then((function(t){Se=t,e(t)}))}))},je=function(t){return Se[t]||t},Ie=function(t){return je(t)},De=[],Te=0,Oe=function(t){De[Te++]=t,t&&t.init()},Re=function(){De[Te-1].release(),De[Te-1]=null,Te--},Le=function(){return De[Te-1]},Ae={},Ne=function(t){var e=v(0,t);return P(e)&&(e=v(0,t+"2"),P(e)&&(e=v(0,t+"3"),P(e)&&(e=v(0,t+"4")))),e},Ce=function(t){for(var e in t)Ae[e]=Pe(e,t[e])},Pe=function(t,e){var n=Be();return n.data=A(t,e),n.data2=A(t,e),n},Be=function(){return{data:null,data2:null}},Ge={},Ue=function(t,e){return Mt().createImageData(t,e)},He=function(t){return new Promise((function(e,n){if(Ge[t])return e(Ge[t]);var i=document.createElement("img");i.src=t,i.addEventListener("load",(function(){return Ge[t]=i,e(i)}))}))},Ye=function(t,e,n,i,a,o,r,s){if(!t||!e)return!1;e.drawImage(t,n,i,r,s,a,o,r,s)},We=function(t,e,n,i,a){e.fillStyle=a,e.fillRect(n,i,n+1,i+1)},Xe=function(t,e,n){return"rgb(".concat(t,", ").concat(e,", ").concat(n,")")},Fe=function(t,e,n,i){for(var a=0;a<t.data.length;a+=4)t.data[a]=e,t.data[a+1]=n,t.data[a+2]=i},ze=function(t){t&&(t.data,t=null)},$e={},Ve=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],Qe=0,Ke=[],qe=function(t,e){var n;return null!=(n=$e[t])?n.animation_data[e]:null},Je=function(t,e){return t?t.frame_data[t.data[e]]:0},Ze=function(t){return new Promise((function(e,n){tn(t).then(e)}))},tn=function(t){return new Promise((function(e,n){var i=en(),a=sn(i,t);a=function(t){var e,n,i;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),i=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<i||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,i-1));return t}(a),nn(a).then((function(n){a=on(n),ln(t.name,a),Qe++,Et("Loading...",Qe/Ke.length),e(a)}))}))},en=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:at(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},nn=function(t){return new Promise((function(e,n){He(t.source_file).then((function(n){t.frame_count=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),t.frame_data=[],t=an(t,n),e(t)}))}))},an=function(t,e){for(var n=0,i=0,a=0;a<t.frame_count;a++)t.frame_data[a]={data:e,sx:n+t.rect_x,sy:i+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h},(n+=t.frame_w)>=t.rect_w&&(n=0,i+=t.frame_h);return t},on=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},rn=function(t){return Promise.all(t.map(tn))},sn=function(t,e){if(t.source_file=""+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=cn(un(),e.animations[n]),0==t.animation_data[n].frame_count&&S("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},cn=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},ln=function(t,e){!function(t,e,n){m.sprites[e]=n}(g(),t,e)},un=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:at(0,0),frame_data:null}},dn=0,pn=[],_n=function(t){return pn[t]},fn=function(){return dn},hn=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*$(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=~~t.animation_frame,t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}return t},mn=function(t){return t.brick_ref.image},gn=function(t){var e=t.bricks;return Promise.all(e.map(vn))},vn=function(t){return new Promise((function(e,n){var i=function(){for(var t={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]},e=0;e<5;e++)t.behavior_arg[e]=0;return t}(),a=t.type;"OBSTACLE"==a?i.property=1:"PASSABLE"==a?i.property=0:"CLOUD"==a?i.property=2:S("Can't read brick attributes: unknown brick type ".concat(a)),"DEFAULT"==(a=q(t.behavior)?t.behavior[0]:t.behavior)?i.behavior=0:"CIRCULAR"==a?i.behavior=1:"BREAKABLE"==a?i.behavior=2:"FALL"==a?i.behavior=3:S("Can't read brick attributes: unknown brick type ".concat(a));for(var o=0;o<5;o++)i.behavior_arg[o]=t.behavior[1+o];i.behavior_arg[i.behavior_arg.length-1]=0,i.angle=t.angle,t.zindex&&(i.zindex=t.zindex),Ze(t.sprite).then((function(t){i.data=t,i.image=t.frame_data[0],dn++,e(i)}))}))},bn=void 0,yn=!0,xn=0,kn=0,wn=0,En=0,Sn=function(){return{spawn_point:at(0,0),position:at(0,0),angle:0,speed:at(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:at(0,0),carried_by:null,carry_offset:at(0,0),carrying:null}},Mn=function(t){t.input&&_e(t.input),t=null},jn=function(t,e){var n;if(e&&t&&(t.visible&&t.animation)){if(t.animation_frame+=t.animation.fps*t.animation_speed_factor*$(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1),t.position,!(n=Tn(t)))return!1;t.mirror&&Xn(Mt(),t.position.x-(e.x-240));var i=t.position.x-(e.x-240),a=t.position.y-(e.y-135.5),o=t.mirror?t.angle:-t.angle;t.angle&&(Mt().translate(i,a),Mt().rotate(o),Mt().translate(-i,-a)),Mt().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,~~(t.position.x-t.hot_spot.x-(e.x-240)),~~(t.position.y-t.hot_spot.y-(e.y-135.5)),1*n.width,1*n.height),t.angle&&(Mt().translate(i,a),Mt().rotate(-o),Mt().translate(-i,-a)),t.mirror&&Xn(Mt(),t.position.x-(e.x-240))}},In=function(t,e,n,i){var a=at(0,0);if(t.visible&&t.animation){isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*$(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var o=Tn(t);if(!o)return!1;a.x=t.position.x%(n?o.width:f)-t.hot_spot.x-(e.x-240)-(n?o.width:0),a.y=t.position.y%(i?o.height:f)-t.hot_spot.y-(e.y-135.5)-(i?o.height:0);for(var r=n?dt/o.width+3:1,s=i?pt/o.height+3:1,c=0;c<r;c++)for(var l=0;l<s;l++)Mt().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,~~(a.x+c*o.width),~~(a.y+l*o.height),1*o.width,1*o.height)}},Dn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<d&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},Tn=function(t){return Je(t.animation,~~t.animation_frame)},On=function(t,e){return t.animation_frame=Z(e,0,t.animation.frame_count),t},Rn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Ln=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*$();return!t.animation.repeat&&e>t.animation.frame_count-1},An=function(t,e){var n=0,i=[];if(i[0]=[at(0,0),at(0,0),at(0,0),at(0,0)],i[1]=[at(0,0),at(0,0),at(0,0),at(0,0)],i[0][0]=rt(t.position,lt(t.hot_spot,-t.angle)),i[0][1]=ot(i[0][0],lt(at(Tn(t).width,0),-t.angle)),i[0][2]=ot(i[0][0],lt(at(Tn(t).width,Tn(t).height),-t.angle)),i[0][3]=ot(i[0][0],lt(at(0,Tn(t).height),-t.angle)),i[1][0]=rt(e.position,lt(e.hot_spot,0)),i[1][1]=ot(i[1][0],lt(at(Tn(e).width,0),0)),i[1][2]=ot(i[1][0],lt(at(Tn(e).width,Tn(e).height),0)),i[1][3]=ot(i[1][0],lt(at(0,Tn(e).height),0)),(Math.abs(t.angle)<d||Math.abs(t.angle-h/2)<d||Math.abs(t.angle-h)<d||Math.abs(t.angle-3*h/2)<d)&&n++,(Math.abs(e.angle)<d||Math.abs(e.angle-h/2)<d||Math.abs(e.angle-h)<d||Math.abs(e.angle-3*h/2)<d)&&n++,n){for(var a=[],o=[],r=0;r<2;r++){a[r]=[];var s=Math.min(i[r][0].x,i[r][1].x),c=Math.min(i[r][0].y,i[r][1].y),l=Math.max(i[r][2].x,i[r][3].x),u=Math.max(i[r][2].y,i[r][3].y);a[r][0]=s,a[r][1]=c,a[r][2]=l,a[r][3]=u,s>l&&(o=et(a[r][0],a[r][2]),a[r][0]=o[0],a[r][2]=o[1]),c>u&&(o=et(a[r][1],a[r][3]),a[r][1]=o[0],a[r][3]=o[1])}return tt(a[0],a[1])}var p=[],_=[Math.max(Tn(t).width,Tn(t).height),Math.max(Tn(e).width,Tn(e).height)];for(r=0;r<2;r++)p[r]=st(ot(i[r][0],i[r][2]),.5);return function(t,e,n,i){return ct(rt(t,n))<=e+i}(p[0],_[0],p[1],_[1])},Nn=function(t,e){return Math.abs(t.angle)<d&&Math.abs(e.angle)<d?!!An(t,e)&&(t.position.x-t.hot_spot.x,t.position.y-t.hot_spot.y,e.position.x-e.hot_spot.x,e.position.y-e.hot_spot.y,Tn(t),Tn(e),!0):!!function(t,e){var n=at(0,0),i=at(0,0),a=at(0,0),o=at(0,0),r=[],s=[];return r=Wn(bn,t,r),s=Wn(bn,e,s),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),i.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),i.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),a.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,a.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,o.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-i.x,o.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-i.y,n.x+a.x>=i.x&&n.x<=i.x+o.x&&n.y+a.y>=i.y&&n.y<=i.y+o.y}(t,e)},Cn=function(t,e,n,i,a,o,r,s,c,l,u,d){var p=Tn(t).width,_=Tn(t).height,f=t.position,h=ot(f,lt(at(0,-_+n),-t.angle)),m=ot(f,lt(at(0,-n),-t.angle)),g=ot(f,lt(at(-p/2+n,.5*-_),-t.angle)),v=ot(f,lt(at(p/2-n,.5*-_),-t.angle)),b=ot(f,lt(at(-p/2+n,-_+n),-t.angle)),y=ot(f,lt(at(p/2-n,-_+n),-t.angle)),x=ot(f,lt(at(-p/2+n,-n),-t.angle)),k=ot(f,lt(at(p/2-n,-n),-t.angle));return Pn(t,e,h,y,v,k,m,x,g,b,i,a,o,r,s,c,l,u,d)},Pn=function(t,e,n,i,a,o,r,s,c,l,u,d,p,_,f,h,m,g,v){var b=[n.x-e,n.y-e,n.x+e,n.y+e],y=[r.x-e,r.y-e,r.x+e,r.y+e],x=[c.x-e,c.y-e,c.x+e,c.y+e],k=[a.x-e,a.y-e,a.x+e,a.y+e],w=[l.x-e,l.y-e,l.x+e,l.y+e],E=[i.x-e,i.y-e,i.x+e,i.y+e],S=[s.x-e,s.y-e,s.x+e,s.y+e],M=[o.x-e,o.y-e,o.x+e,o.y+e];return u&&(n&&(d=Yn(u,b)),r&&(h=Yn(u,y)),c&&(g=Yn(u,x)),a&&(_=Yn(u,k)),l&&(v=Yn(u,w)),i&&(p=Yn(u,E)),s&&(m=Yn(u,S)),o&&(f=Yn(u,M))),{up:d,down:h,left:g,right:_,upleft:v,upright:p,downleft:m,downright:f}},Bn=function(t){yn=t},Gn=function(t,e,n,i,a,o,r,s,c,l){var u,d=[n,i,a,c,l];for(u=0;u<d.length;u++){var p=d[u];p&&p.brick_ref&&2==p.brick_ref.property&&(p=null,d[u]=p)}if(r&&r.brick_ref&&2==r.brick_ref.property){var _=Math.min(15,r.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<r.y+e+1+_||(s&&s==r&&(s=null),o&&o==r&&(o=null),r=null)}return{up:d[0],upright:d[1],right:d[2],left:d[3],upleft:d[4],downright:o,down:r,downleft:s}},Un=function(t,e,n){var i,a,o,r,s,c,l,u,p,_,f,m=at(0,0),g=$(),v=t.position,b=function(t,e,n,i,a,o,r,s,c,l){var u,p,_,f=Tn(t).width,m=Tn(t).height,g=!(Math.abs(t.angle)<d||Math.abs(t.angle-h/2)<d||Math.abs(t.angle-h)<d||Math.abs(t.angle-3*h/2)<d),v=t.position;return g?(u=1,p=.7,_=.25):(u=.7,p=.5,_=.25),{up:ot(v,lt(at(0,-m*u+e),-t.angle)),down:ot(v,lt(at(0,2),-t.angle)),left:ot(v,lt(at(-f*_+e,-m*p),-t.angle)),right:ot(v,lt(at(f*_-e,-m*p),-t.angle)),upleft:ot(v,lt(at(-f*_+e,-m*u+e),-t.angle)),upright:ot(v,lt(at(f*_-e,-m*u+e),-t.angle)),downleft:ot(v,lt(at(-f*_+e,2),-t.angle)),downright:ot(v,lt(at(f*_-e,2),-t.angle))}}(t,-2);b=function(t,e,n,i,a,o,r,s,c,l,u,d,p,_,f,h,m,g){return Pn(t,2,n,i,a,o,r,s,c,l,e,u,d,p,_,f,h,m,g)}(t,e,i=b.up,b.upright,a=b.right,b.downright,b.down,b.downleft,o=b.left,b.upleft,r,s,c,l,u,p,_,f),r=b.up,s=b.upright,c=b.right,l=b.downright,u=b.down,p=b.downleft,_=b.left,f=b.upleft;var y=Gn(t,-2,r,s,c,l,u,p,_,f);return r=y.up,s=y.upright,c=y.right,_=y.left,f=y.upleft,u=y.down,p=y.downleft,l=y.downright,function(t,e){var n=$();if(null!=t.carried_by){var i=t.carried_by;e&&0==e.brick_ref.angle&&i.speed.y>=5?(t.position=at(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=at(0,0),t.mirror=i.mirror,t.angle=0,t.position=rt(ot(i.position,st(i.speed,n)),t.carry_offset))}}(t,u),null!=t.carried_by?at(0,0):(function(t,e,n,i,a,o){o&&o.brick_ref.angle%90==0&&(t.speed.x>d||i.x>o.x)&&(t.speed.x=0,t.position.x=o.x+(e.x-i.x)),a&&a.brick_ref.angle%90==0&&(t.speed.x<-1e-5||n.x<a.x+a.brick_ref.image.width)&&(t.speed.x=0,t.position.x=a.x+a.brick_ref.image.width+(e.x-n.x))}(t,v,o,a,_,c),u?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,i,a){var o=i.brick_ref.angle;!fe(t.input,Wt)||fe(t.input,Ut)||a||(t.angle=0,t.is_jumping=!0,0==o?t.speed.y=-t.jump_strength:o>0&&o<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==o?(Dn(t,at(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):o>90&&o<180?(Dn(t,at(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==o?(Dn(t,at(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):o>180&&o<270?(Dn(t,at(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==o?(Dn(t,at(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):o>270&&o<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,u,r)):t.angle=0,m.y=Math.abs(t.speed.y)>d?t.speed.y*g+1*n*.5*(g*g):0,t.speed.y=Math.min(t.speed.y+1*n*g,480),function(t,e,n,i){i&&i.brick_ref.angle%90==0&&t.speed.y<-1e-5&&(t.position.y=i.y+i.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,v,i,r),function(t,e,n,i,a,o,r,s,c){var l;if($(),s&&!t.is_jumping)if(l=s.brick_ref.angle,t.speed.y=i.y=0,t.angle=l*h/180,0==l)t.position.y=a.y+e;else if(l>0&&l<90)a.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y+e,t.mirror;else if(90==l){if(Math.abs(t.speed.x)>5){var u=c?c.brick_ref.angle:-1;c&&u>=l&&u<l+90?(a.y=s.x,t.position.x=a.y+e):(t.angle=0,Dn(t,at(-13,0)),t.is_jumping=!0,t.speed=at(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Dn(t,at(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else l>90&&l<180?Math.abs(t.speed.x)>5?(a.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y-e):(t.angle=0,Dn(t,at(0,30)),t.is_jumping=!0):180==l?t.speed.x>5&&!(1&t.mirror)||t.speed.x<-5&&1&t.mirror?(a.y=s.y+s.brick_ref.image.height,t.position.y=a.y-e):(t.angle=0,Dn(t,at(0,40)),t.is_jumping=!0,t.speed.x=0):l>180&&l<270?Math.abs(t.speed.x)>5?(a.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y-e):(t.angle=0,Dn(t,at(0,30)),t.is_jumping=!0):270==l?(Math.abs(t.speed.x)>5?(u=r?r.brick_ref.angle:-1,r&&u>l-90&&u<=l?(a.y=s.x+s.brick_ref.image.width,t.position.x=a.y-e):(t.angle=0,Dn(t,at(13,0)),t.is_jumping=!0,t.speed=at(0,-.7*Math.abs(t.speed.x)))):(t.angle=0,Dn(t,at(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1),t.mirror):l>270&&l<360&&(a.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y+e,t.mirror)}(t,-2,0,m,v,0,p,u,l),m.x=Math.abs(t.speed.x)>d?t.speed.x*g+1*t.acceleration*.5*(g*g):0,function(t,e,n){var i=$();if(fe(t.input,Ht)&&!fe(t.input,Yt))t.ignore_horizontal||fe(t.input,Ut)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*i,-t.maxspeed),t.mirror=1);else if(fe(t.input,Yt)&&!fe(t.input,Ht))t.ignore_horizontal||fe(t.input,Ut)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*i,t.maxspeed),t.mirror=0);else if(n){var a=0,o=n.brick_ref.angle;o%90==0?a=90==o&&1&t.mirror&&t.speed.x<0||270==o&&!(1&t.mirror)&&t.speed.x>0?t.speed.x>d?1:-t.speed.x>d?-1:0:t.speed.x>d?-1:-t.speed.x>d?1:0:(o>90&&o<180||o>180&&o<270)&&(a=t.speed.x>d?-1:-t.speed.x>d?1:0),t.speed.x+=1*a*t.acceleration*i}}(t,0,u),Math.abs(t.speed.x)<d&&(t.speed.x=m.x=0),m)},Hn=function(t){var e=$(),n=at(0,0);return t.input?(fe(t.input,Yt)&&!fe(t.input,Ht)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),fe(t.input,Ht)&&!fe(t.input,Yt)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!fe(t.input,Ht)&&!fe(t.input,Yt)&&Math.abs(t.speed.x)>d&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),fe(t.input,Ut)&&!fe(t.input,Gt)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),fe(t.input,Gt)&&!fe(t.input,Ut)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!fe(t.input,Gt)&&!fe(t.input,Ut)&&Math.abs(t.speed.y)>d&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=at(0,0),n.x=Math.abs(t.speed.x)>d?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},Yn=function(t,e){var n,i,a,o,r,s,c,l=null,u=!1;for(n=t;n&&!u;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&l&&1==l.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&l&&1!=l.brick_ref.behavior&&n.data.y>=l.y)continue;if(wn&&0==n.data.brick_ref.angle)continue;if(En&&180==n.data.brick_ref.angle)continue;if(kn&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(xn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var d=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(tt(e,d))if(1!=n.data.brick_ref.behavior&&l&&1==l.brick_ref.behavior&&n.data.y<=l.y)l=n.data;else if(1==n.data.brick_ref.property&&l&&2==l.brick_ref.property)l=n.data;else if(2==n.data.brick_ref.property&&l&&2==l.brick_ref.property)n.data.y>l.y&&(l=n.data);else if(n.data.brick_ref.angle%90==0)l?yn?l.brick_ref.angle%180!=0&&(l=n.data):l.brick_ref.angle%180==0&&(l=n.data):l=n.data;else for(i=n.data.brick_ref.angle,s=Math.tan(i*h/180),o=e[0];o<=e[2]&&!u;o++)for(r=e[1];r<=e[3]&&!u;r++){switch(a=!1,~~(i/90)%4){case 0:c=d[3]+s*(d[0]-o),a=d[0]<=o&&o<=d[2]&&c<=r&&r<=d[3];break;case 1:c=d[3]-s*(d[2]-o),a=d[0]<=o&&o<=d[2]&&d[1]<=r&&r<=c;break;case 2:c=d[3]-s*(d[0]-o),a=d[0]<=o&&o<=d[2]&&d[1]<=r&&r<=c;break;case 3:c=d[3]+s*(d[2]-o),a=d[0]<=o&&o<=d[2]&&c<=r&&r<=d[3]}a&&(l=n.data,u=!0)}}return l},Wn=function(t,e,n){var i,a,o,r,s,c,l,u,d;return o=-e.angle,i=Tn(e).width,a=Tn(e).height,u=e.hot_spot,d=e.position,r=rt(at(0,0),u),s=rt(at(i,0),u),c=rt(at(i,a),u),l=rt(at(0,a),u),n[0]=ot(d,lt(r,o)),n[1]=ot(d,lt(s,o)),n[2]=ot(d,lt(c,o)),n[3]=ot(d,lt(l,o)),n},Xn=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},Fn=[],zn={},$n=function(t){for(var e={type:Z(t,0,9),text:null,width:0,visible:!0,hspace:1,vspace:1,value:[],position:at(0,0)},n=0;n<5;n++)e.value[n]=0;return e},Vn=function(t){t.text&&(t.text=null)},Qn=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!t)return!1;for(var a=0;a<n.length;a++)n[a]=""+n[a];var o=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(o)for(a=0;a<o.length;a++){var r=o[a].slice(1),s=Ie(r);s&&(e=e.replace("$"+r,s))}if(o=e.match(/\%[s]+/g))for(a=0;a<o.length;a++)n[a]&&((r=n[a].match(/\$[A-Z_\d]\w+/g))&&(n[a]=r[0].slice(1)),e=e.replace("%s",Ie(n[a])));if(o=e.match(/\%[d]+/g))for(a=0;a<o.length;a++)n[a]&&(e=e.replace("%d",""+n[a]));return t.text=""+e,t},Kn=function(t){return t.text?t.text:""},qn=function(t){return ti(t)},Jn=function(t,e){t.width=Math.max(0,e)},Zn=function(t,e){var n,i,a,o,r,s=0,c=0,l=[],u=0,d=0;l[d++]={r:!1,g:0,b:0};var p=ti(t);if(n=p.x,i=p.y,t&&t.visible&&t.text)for(u=0;u<t.text.length;u++){if(a=t.text[u],r=!1,K(t.text[u-1])){var _=void 0,f=!1,h=0,m=t.text.slice(u),g=(m=(m=m.replace("(","")).replace(")","")).split(" ")[0];for(_=0;_<g.length;_++)"<"==g[_]&&(f=!0),f||h++,">"==g[_]&&(f=!1);r=t.width>0&&s+(n+t.hspace)*h-t.hspace>t.width}if("<"==a){if("<color="==(f=t.text.slice(u,u+7))){var v,b,y;u+=7;var x=t.text.slice(u,u+6);v=ni(x.slice(0,2)),b=ni(x.slice(2,4)),y=ni(x.slice(4,6)),l[d++]={r:v,g:b,b:y},u+=7,a=t.text[u]}"</color"==f&&(u+=8,a=t.text[u],d>=2&&d--)}r&&(s=0,c+=i+t.vspace),"\n"!=a?(o=Fn[t.type].ch[a])?(s+=o.width,K(t.text[u-1]),ei(Mt(),o,~~t.position.x+s-(e.x-240),~~t.position.y+c-(e.y-135.5),l[d-1])):s+=n+t.hspace:(s=0,c+=i+t.vspace)}},ti=function(t){var e,n;if(t)for(e=0;e<256;e++)if(Fn[t.type]&&null!=(n=Fn[t.type].ch[e]))return at(n.width,n.height);return at(16,16)},ei=function(t,e,n,i,a){var o,r=e.data;a&&a.r&&(o=ii(e.data),r=ai(e.data,o,a.r,a.g,a.b)),t.drawImage(r,e.sx,e.sy,e.swidth,e.sheight,n,i-2,1*e.width,1*e.height)},ni=function(t){var e=/^#?([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16):null},ii=function(t){if(zn[t.src])return zn[t.src];var e=t.width,n=t.height,i=[],a=document.createElement("canvas");a.width=e,a.height=n;var o=a.getContext("2d");o.drawImage(t,0,0);for(var r=o.getImageData(0,0,e,n).data,s=0;s<4;s++){var c=document.createElement("canvas");c.width=e,c.height=n;var l=c.getContext("2d");l.drawImage(t,0,0);for(var u=l.getImageData(0,0,e,n),d=u.data,p=0,_=r.length;p<_;p+=4)d[p]=0===s?r[p]:0,d[p+1]=1===s?r[p+1]:0,d[p+2]=2===s?r[p+2]:0,d[p+3]=r[p+3];l.putImageData(u,0,0);var f=new Image;f.src=c.toDataURL(),i.push(f)}return zn[t.src]=i,i},ai=function(t,e,n,i,a){var o=document.createElement("canvas");o.width=t.width,o.height=t.height;var r=o.getContext("2d");return r.globalAlpha=1,r.globalCompositeOperation="copy",r.drawImage(e[3],0,0),r.globalCompositeOperation="lighter",n>0&&(r.globalAlpha=n/255,r.drawImage(e[0],0,0)),i>0&&(r.globalAlpha=i/255,r.drawImage(e[1],0,0)),a>0&&(r.globalAlpha=a/255,r.drawImage(e[2],0,0)),o},oi=null,ri=null,si=null,ci=[],li=null,ui=null,di=[],pi=0,_i=-1,fi=!1,hi=!1,mi=null,gi=function(){var t;for(oi=Je(qe("SD_CONFIRMBOX",0),0),ri=at((dt-oi.width)/2,pt),mi=pe(),li=Sn(),li=Rn(li,qe("SD_TITLEFOOT",0)),si=$n(8),Qn(si,ui),Jn(si,164),t=0;t<pi;t++)ci[t]=[],ci[t][0]=$n(8),ci[t][1]=$n(8),Qn(ci[t][0],di[t]),Qn(ci[t][1],"<color=ffff00>%s</color>",di[t]);_i=0,fi=!0,hi=!1},vi=function(){var t,e=$();if(fi&&(ri.y<=(pt-oi.height)/2?fi=!1:ri.y-=1355*e),hi){if(ri.y>=pt)return hi=!1,void Re();ri.y+=1355*e}for(li.position=at(ri.x+_i*oi.width/pi+10,ri.y+.75*oi.height-1),si.position=at(ri.x+10,ri.y+10),t=0;t<pi;t++)ci[t][0].position=at(ri.x+t*oi.width/pi+25,ri.y+.75*oi.height),ci[t][1].position=ci[t][0].position;fi||hi||(he(mi,Ht)?(N(Ne("choose")),_i=((_i-1)%pi+pi)%pi):he(mi,Yt)?(N(Ne("choose")),_i=(_i+1)%pi):(he(mi,Wt)||he(mi,Ft))&&(N(Ne("select")),hi=!0))},bi=function(){var t,e,n=at(240,135.5);for(wt(),Mt().drawImage(oi.data,oi.sx,oi.sy,oi.swidth,oi.sheight,ri.x,ri.y,oi.swidth,oi.sheight),Zn(si,n),t=0;t<pi;t++)e=t==_i?1:0,Zn(ci[t][e],n);jn(li,n)},yi=function(){Mn(li),_e(mi),Vn(si),ze(null)},xi=function(){if(-1!=_i){var t=_i+1;return _i=-1,t}return 0},ki=function(t){return new Promise((function(e,n){S('background_load("'.concat(t,'")')),w(t).then(Ri).then((function(t){e({data:t,length:t.length})}))}))},wi=function(t){S("background_unload()");for(var e=0;e<t.length;e++)t.data[e]=Ii(t.data[e]);return null},Ei=function(t){if(!t)return!1;for(var e=0;e<t.length;e++){var n=t.data[e];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},Si=function(t,e){ji(t,e,!1)},Mi=function(t,e){ji(t,e,!0)},ji=function(t,e,n){if(t){var i,a,o=at(240,135.5),r=rt(e,o);for(i=0;i<t.length;i++)a=t.data[i],(!n&&a.zindex<=.5||n&&a.zindex>.5)&&(a.actor.position.x+=r.x*a.actor.speed.x,a.actor.position.y+=r.y*a.actor.speed.y,In(a.actor,o,a.repeat_x,a.repeat_y),a.actor.position.y-=r.y*a.actor.speed.y,a.actor.position.x-=r.x*a.actor.speed.x)}},Ii=function(t){return t.strategy=Di(t.strategy),function(t){var e,n;if(null!=t.source_file&&(t.source_file=null),null!=t.frame_data){for(e=0;e<t.frame_count;e++)ze(t.frame_data[e]);t.frame_data=null}if(null!=t.animation_data){for(e=0;e<t.animation_count;e++)t.animation_data[e]=(null!=(n=t.animation_data[e])&&(null!=n.data&&(n.data=null),n=null),null);t.animation_data=null}t=null}(t.data),Mn(t.actor),t=null,null},Di=function(t){return null},Ti=function(t){},Oi=function(t){var e=t,n=t.background,i=$();n.actor.position.x+=e.speed_x*i,n.actor.position.y+=e.speed_y*i},Ri=function(t){var e=t.bg;return Promise.all(e.map(Li))},Li=function(t,e){return new Promise((function(e,n){var i={actor:Sn(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0};switch(i.actor.spawn_point.x=t.initial_position.xpos,i.actor.spawn_point.y=t.initial_position.ypos,i.actor.position=at(i.actor.spawn_point.x,i.actor.spawn_point.y),i.actor.speed.x=t.scroll_speed.xspeed,i.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&q(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":i.strategy&&(i.strategy=Di(i.strategy)),i.strategy={background:i,update:Ti};break;case"LINEAR":i.strategy&&(i.strategy=Di(i.strategy)),i.strategy=function(t,e,n){var i={background:t,update:Oi},a=i;return a.speed_x=e,a.speed_y=n,i}(i,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":i.strategy&&(i.strategy=Di(i.strategy)),i.strategy=function(t,e,n,i,a,o,r){var s={background:t,update:Oi},c=s;return c.timer=0,c.amplitude_x=e,c.amplitude_y=n,c.angularspeed_x=2*h*i,c.angularspeed_y=2*h*a,c.initialphase_x=o*h/180,c.initialphase_y=r*h/180,s}(i,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}i.repeat_x=t.repeat_x,i.repeat_y=t.repeat_y,t.zindex&&(i.zindex=t.zindex),Ze(t.sprite).then((function(t){i.data=t,i.actor.animation=t,i.actor.animation.data=[0],e(i)}))}))},Ai=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],Ni=null,Ci=!1,Pi=null,Bi=null,Gi=null,Ui=null,Hi=0,Yi=null,Wi=function(){Ci=!1,Ui=pe(),Pi=$n(4),Qn(Pi,Ie("CREDITS_TITLE")),Pi.position.x=140,Pi.position.y=5,Gi=$n(8),Qn(Gi,Ie("CREDITS_KEY")),Gi.position.x=10,Gi.position.y=pt-qn(Gi).y-5,Bi=$n(8);for(var t=0;t<Ai.length;t++){var e=Ai[t],n=e.match(/\$[A-Z_\d]\w+/m);if(n){for(var i=0;i<n.length;i++){var a=n[i].slice(1),o=Ie(a);o&&(e=e.replace("$"+a,o))}Ai[t]=e}}Qn(Bi,Ai.join(""),"%s"),Jn(Bi,300),Bi.position.x=10,Bi.position.y=pt,Hi=1;var r=Kn(Bi);for(t=0;t<r.length;t++)"\n"==r[t]&&Hi++;Hi+=10,Ni=Ue(dt,30),ki("data/themes/credits.bg.json").then((function(t){Yi=t,bt(Xe(0,0,0),1)})),bt(Xe(0,0,0),1)},Xi=function(){var t,e=$();if(Ei(Yi),Bi.position.y-=3*qn(Bi).y*e,Bi.position.y<-Hi*(qn(Bi).y+(t=Bi,at(t.hspace,t.vspace)).y)&&(Bi.position.y=pt),Ci||kt()||(he(Ui,Ft)?(N(Ne("select")),Ci=!0):he(Ui,zt)&&(N(Ne("return")),Ci=!0)),!L()){var n=I("data/music/options.mp4");D(n,!0)}if(Ci){if(xt())return void Re();yt(Xe(0,0,0),1)}},Fi=function(){wt();var t=at(240,135.5);Si(Yi,t),Mi(Yi,t),Zn(Bi,t),Mt().fillRect(0,0,Ni.width,Ni.height),Mt().fillRect(0,251,Ni.width,Ni.height),Zn(Pi,t),Zn(Gi,t)},zi=function(){Yi=wi(Yi),ze(Ni),Vn(Pi),Vn(Bi),Vn(Gi),_e(Ui)},$i=10,Vi=0,Qi=null,Ki=null,qi=[],Ji=function(){var t;for(Vi=V(),(Qi=$n(8)).position=at(5,35),Ki=$n(4),Qn(Ki,Ie("ENDOFDEMO_TITLE")),Ki.position=at((dt-qn(Ki).x*Kn(Ki).length)/2,5),t=0;t<$i;t++)qi[t]=Sn(),qi[t].spawn_point=qi[t].position=at(dt*t/$i+15,215),Rn(qi[t],qe(t%2==1?"SD_BLUERING":"SD_RING",0));bt(Xe(0,0,0),2)},Zi=function(){var t,e=V(),n=Math.max(0,(3-(e-Vi))/1e3);if(Qn(Qi,Ie("ENDOFDEMO_TEXT"),l,u,n),e>=Vi+3){if(xt())return Re(),void Oe(dy(ay));yt(Xe(0,0,0),2)}for(t=0;t<$i;t++)qi[t].position.y=qi[t].spawn_point.y+10*Math.sin(h*(.001*e)+2*h/$i*t)},ta=function(){var t,e=at(240,135.5);for(wt(),t=0;t<$i;t++)jn(qi[t],e);Zn(Ki,e),Zn(Qi,e)},ea=function(){var t;for(t=0;t<$i;t++)Mn(qi[t]);Vn(Ki),Vn(Qi)},na={is_locked:!1,position:at(0,0),dest:at(0,0),speed:0,region_topleft:at(0,0),region_bottomright:at(0,0),dest_region_topleft:at(0,0),dest_region_bottomright:at(0,0),region_topleft_speed:0,region_bottomright_speed:0},ia=function(t,e){t.x<na.region_topleft.x&&(t.x=na.region_topleft.x),t.y<na.region_topleft.y&&(t.y=na.region_topleft.y),t.x>na.region_bottomright.x&&(t.x=na.region_bottomright.x),t.y>na.region_bottomright.y&&(t.y=na.region_bottomright.y),na.dest=t,e>d?na.speed=ct(rt(na.position,na.dest))/e:na.position=na.dest,na.position.x=t.x,na.position.y=t.y},aa=function(){return at(na.position.x,na.position.y)},oa=function(t){na.dest=na.position=t},ra=function(t,e,n,i){na.dest_region_topleft.x=Math.max(Math.min(t,n),240),na.dest_region_topleft.y=Math.max(Math.min(e,i),135.5),na.dest_region_bottomright.x=Math.min(Math.max(t,n),Sh().x-240),na.dest_region_bottomright.y=Math.min(Math.max(e,i),Sh().y-135.5),na.region_topleft_speed=ct(rt(na.region_topleft,na.dest_region_topleft))/.25,na.region_bottomright_speed=ct(rt(na.region_bottomright,na.dest_region_bottomright))/.25},sa=function(t){},ca=function(t){},la=function(t,e,n,i,a,o){},ua=function(t,e){var n=t.get_object_instance(t).actor,i=n.position;n.position=at(n.position.x,n.position.y),jn(n,e),n.position=i},da=function(t){return t.object},pa=function(t){return t.reference_to_current_state},_a=function(t,e){var n=ha(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:S("Object script error: can't find state ".concat(e)),t},fa=function(t){if(null!=t){var e=t.data;fa(t.next),e.release(e)}return null},ha=function(t,e){return null!=t?t.name==e?ha(t.next,e):t:null},ma=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},ga=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),t.actor.maxspeed=145+J(21),t.actor.input=ue(),e.is_running=!1,e.animal_id=J(12),Rn(t.actor,qe("SD_ANIMAL",0))},va=function(t){Mn(t.actor)},ba=function(t,e,n,i,a,o){var r,s,c,l,u=t,p=t.actor,_=2*u.animal_id+(u.is_running?1:0);ge(p.input,Wt),p.jump_strength=1.3*(200+J(50)),p.speed.x>d?(p.speed.x=p.maxspeed,p.mirror=0):p.speed.x<-1e-5&&(p.speed.x=-p.maxspeed,p.mirror=1),Rn(p,qe("SD_ANIMAL",_));var f=Cn(p,2,-2,i,r,null,l,null,s,null,c,null);r=f.up,f.upright,l=f.right,f.downright,s=f.down,f.downleft,c=f.left,f.upleft;var h=Gn(p,-2,r,null,l,null,s,null,c,null);r=h.up,h.upright,l=h.right,h.downright,s=h.down,h.downleft,c=h.left,h.upleft,s&&!u.is_running&&(u.is_running=!0,p.speed.x=(J(2)?-1:1)*p.maxspeed),c&&!r&&(p.speed.x=p.maxspeed),l&&!r&&(p.speed.x=-p.maxspeed),!u.is_running&&(s&&r||c&&l)&&(t.state=ws),Dn(p,Un(p,i,Ch()))},ya=function(t,e){jn(t.actor,e)},xa=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),Sa(t,Ma()),Rn(t.actor,qe("SD_ENDLEVEL",0))},ka=function(t){Mn(t.actor),Sa(t,null)},wa=function(t,e,n,i,a,o){var r=t;r.state.handle(r.state,t,e,n)},Ea=function(t,e){jn(t.actor,e)},Sa=function(t,e){t.state=e},Ma=function(){var t={handle:ja},e=t;return e.being_hit=!1,e.hit_count=0,t},ja=function(t,e,n,i){for(var a,o,r=t,s=e.actor,c=0;c<i;c++){var l=n[c];Oa(e,l)&&!r.being_hit&&(r.being_hit=!0,Rn(s,qe("SD_ENDLEVEL",1)),N(Ne("boss hit")),Qs(l),l.actor.speed.x*=-.5,++r.hit_count>=3&&Sa(e,(a=void 0,o=void 0,o=a={handle:Ia},a.handle=Ia,o.explode_timer=0,o.break_timer=0,a)))}Ln(s)&&r.being_hit&&(Rn(s,qe("SD_ENDLEVEL",0)),r.being_hit=!1)},Ia=function(t,e,n,i){var a=t,o=e.actor,r=$();if(a.explode_timer+=r,a.break_timer+=r,a.explode_timer>=.1){var s=at(o.position.x-o.hot_spot.x+J(Tn(o).width),o.position.y-o.hot_spot.y+J(Tn(o).height/2));Bh(fs,s),N(Ne("explode")),a.explode_timer=0}a.break_timer>=2&&Sa(e,{handle:Da})},Da=function(t,e,n,i){for(var a=e.actor,o=0;o<20;o++){var r=at(a.position.x-a.hot_spot.x+J(Tn(a).width),a.position.y-a.hot_spot.y+J(Tn(a).height/2));Yh(r)}Ih(a),Rn(a,qe("SD_ENDLEVEL",2)),Sa(e,{handle:Ta})},Ta=function(t,e,n,i){},Oa=function(t,e){if(t&&e){var n=[],i=[],a=t.actor,o=e.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+Tn(o).width,n[3]=n[1]+Tn(o).height,i[0]=a.position.x-a.hot_spot.x+5,i[1]=a.position.y-a.hot_spot.y,i[2]=i[0]+Tn(a).width-10,i[3]=i[1]+Tn(a).height/2,Ks(e)&&tt(n,i)&&Nn(a,o)}},Ra=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe("SD_BLUERING",0))},La=function(t){Mn(t.actor)},Aa=function(t,e,n,i,a,o){for(var r=0;r<n;r++){var s=e[r];s&&!s.dying&&An(s.actor,t.actor)&&(t.state=ws,tc(qs()+50),Dh(5e3),N(Ne("big ring")),Th("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),vg(sg,bg(sg)+1))}},Na=function(t,e){jn(t.actor,e)},Ca=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_disappearing=!1,Rn(t.actor,qe("SD_BLUERING",0))},Pa=function(t,e,n,i,a,o){var r=kh(),s=t,c=t.actor;c.visible=r.got_glasses||xh(),s.is_disappearing?Ln(c)&&(t.state=ws):!r.dying&&r.got_glasses&&An(c,r.actor)&&(Rn(c,qe("SD_BLUERING",1)),tc(qs()+5),N(Ne("blue ring")),s.is_disappearing=!0)},Ba=function(t,e){jn(t.actor,e)},Ga=function(t){Mn(t.actor)},Ua=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.getting_hit=!1,Rn(t.actor,qe("SD_BUMPER",0))},Ha=function(t,e,n,i,a,o){for(var r=t,s=t.actor,c=0;c<n;c++){var l=e[c];l&&!l.dying&&Nn(l.actor,s)&&(r.getting_hit||(r.getting_hit=!0,Rn(s,qe("SD_BUMPER",1)),N(Ne("bumper")),Xa(t,l)))}r.getting_hit&&Ln(s)&&(r.getting_hit=!1,Rn(s,qe("SD_BUMPER",0)))},Ya=function(t,e){jn(t.actor,e)},Wa=function(t){Mn(t.actor)},Xa=function(t,e){var n,i,a,o=t.actor;(n=e.actor.speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),i=st(ut(rt(o.position,e.actor.position)),ct(n)),a=st(i,1),e.actor.speed=st(ot(n,st(a,-1e4)),1/10001),o.speed=st(ot(n,a),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},Fa=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_active=!1,Rn(t.actor,qe("SD_CHECKPOINT",0))},za=function(t,e,n,i,a,o){var r=t,s=t.actor;if(r.is_active)Ln(s)&&Rn(s,qe("SD_CHECKPOINT",2));else for(var c=0;c<n;c++){var l=e[c];if(l&&!l.dying&&Nn(l.actor,s)){r.is_active=!0,N(Ne("checkpoint")),jh(s.position),Rn(s,qe("SD_CHECKPOINT",1));break}}},$a=function(t,e){jn(t.actor,e)},Va=function(t){Mn(t.actor)},Qa=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe("SD_ITEMBOX",10))},Ka=function(t,e,n,i,a,o){},qa=function(t,e){jn(t.actor,e)},Ja=function(t){Mn(t.actor)},Za=function(t,e){var n={init:to,release:io,update:eo,render:no},i=n;return n.init=to,n.release=io,n.update=eo,n.render=no,i.sprite_name=t,i.player_is_vulnerable=e,n},to=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe(e.sprite_name,0))},eo=function(t,e,n,i,a,o){for(var r=t,s=t.actor,c=0;c<n;c++){var l=e[c];l&&(l.dying||l.blinking||l.invincible||!An(s,l.actor)||r.player_is_vulnerable(l)&&$s(l))}s.visible=xh()},no=function(t,e){jn(t.actor,e)},io=function(t){Mn(t.actor)},ao=function(t){return!0},oo=function(t){return t.shield_type!=Ns},ro=function(t,e){t.actor.speed=e},so=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),Rn(t.actor,qe("SD_DANGPOWER",0))},co=function(t,e,n,i,a,o){for(var r=$(),s=t.actor,c=st(s.speed,r),l=0;l<n;l++){var u=e[l];u&&!u.dying&&An(s,u.actor)&&($s(u),t.state=ws)}s.position=ot(s.position,c)},lo=function(t,e){jn(t.actor,e)},uo=function(t){Mn(t.actor)},po=function(t,e){var n={init:_o,release:mo,update:fo,render:ho},i=n;return i.authorized_player_type=t,i.is_vertical_door=e,n},_o=function(t){var e,n,i=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Sn(),n=i.authorized_player_type,e=i.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",Rn(t.actor,qe(e,n))},fo=function(t,e,n,i,a,o){var r,s=t,c=t.actor,l=!1,u=!1,d=$(),p=[],_=[];t.obstacle=!0;for(var f=0;f<n;f++){var h=e[f];h&&(h.dying||h.actor.carrying||h.actor.carried_by||!go(h,t)||(h.type==s.authorized_player_type?(t.obstacle=!1,u=Nn(c,h.actor)):l=!0))}if(l&&(t.obstacle=!0),t.obstacle?c.alpha=Math.min(1,c.alpha+2*d):u&&(c.alpha=Math.max(.4,c.alpha-2*d)),u)for(p[0]=c.position.x-c.hot_spot.x-5,p[1]=c.position.y-c.hot_spot.y-5,p[2]=p[0]+Tn(c).width+10,p[3]=p[1]+Tn(c).height+10,r=a;null!=r;r=r.next)r.data.type==t.type&&(_[0]=r.data.actor.position.x-r.data.actor.hot_spot.x-5,_[1]=r.data.actor.position.y-r.data.actor.hot_spot.y-5,_[2]=_[0]+Tn(r.data.actor).width+10,_[3]=_[1]+Tn(r.data.actor).height+10,tt(p,_)&&(r.data.actor.alpha<c.alpha?c.alpha=r.data.actor.alpha:r.data.actor.alpha=c.alpha))},ho=function(t,e){jn(t.actor,e)},mo=function(t){Mn(t.actor)},go=function(t,e){var n=[],i=[],a=t.actor,o=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+Tn(a).width,n[3]=n[1]+Tn(a).height,i[0]=o.position.x-o.hot_spot.x,i[1]=o.position.y-o.hot_spot.y-3,i[2]=i[0]+Tn(o).width,i[3]=i[1]+Tn(o).height+3,tt(n,i)},vo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_closed=!0,Rn(t.actor,qe("SD_DOOR",0))},bo=function(t,e,n,i,a,o){var r=t,s=t.actor,c=$();r.is_closed?s.position.y=Math.min(s.position.y+2e3*c,s.spawn_point.y):s.position.y=Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*Tn(s).height)},yo=function(t,e){jn(t.actor,e)},xo=function(t){Mn(t.actor)},ko=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Sn(),e.who=null,Rn(t.actor,qe("SD_ENDSIGN",0))},wo=function(t,e,n,i,a,o){var r=t,s=t.actor;if(null==r.who){var c=void 0;for(c=0;c<n;c++){var l=e[c];l&&!l.dying&&Nn(l.actor,s)&&(r.who=l,N(Ne("end sign")),Rn(s,qe("SD_ENDSIGN",1)),Ih(t.actor))}}else if(Ln(s)){var u=2+r.who.type;Rn(s,qe("SD_ENDSIGN",u))}},Eo=function(t,e){jn(t.actor,e)},So=function(t){Mn(t.actor)},Mo=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),Rn(t.actor,qe("SD_EXPLOSION",J(2)))},jo=function(t,e,n,i,a,o){Ln(t.actor)&&(t.state=ws)},Io=function(t,e){jn(t.actor,e)},Do=function(t){Mn(t.actor)},To=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),Rn(t.actor,qe("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},Oo=function(t,e,n,i,a,o){var r=t.actor,s=$();r.angle+=Math.sign(r.speed.x)*(6*h*s),r.position=ot(r.position,function(t,e){var n=$(),i=at(0,0);return i.x=t.speed.x*n,i.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,i}(r,Ch()))},Ro=function(t,e){jn(t.actor,e)},Lo=function(t){Mn(t.actor)},Ao=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),e.elapsed_time=0,e.font=$n(0),Qn(e.font,"0"),Rn(t.actor,qe("SD_RING",0)),t.actor.visible=!1},No=function(t,e,n,i,a,o){var r=t,s=$();r.elapsed_time+=s,r.elapsed_time<.5?t.actor.position.y-=100*s:r.elapsed_time>2&&(t.state=ws),r.font.position=t.actor.position},Co=function(t,e){Zn(t.font,e)},Po=function(t){var e=t;Mn(t.actor),Vn(e.font)},Bo=function(t,e,n,i){for(var a=_,o=null,r=null,s=e;s;s=s.next)s.data&&s.data.type==n&&(r=rt(s.data.actor.position,t.actor.position),ct(r)<a&&(o=s.data,a=ct(r)));return i&&(i.dist=a),o},Go=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe("SD_GOAL",0))},Uo=function(t,e,n,i,a,o){var r,s=Bo(t,a,gs,null);r=null!=s?s.actor.position.x>t.actor.position.x?0:1:0,Rn(t.actor,qe("SD_GOAL",r))},Ho=function(t,e){jn(t.actor,e)},Yo=function(t){Mn(t.actor)},Wo=function(t,e){Rn(t.actor,qe("SD_ICON",e))},Xo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Sn(),e.elapsed_time=0,Wo(t,0)},Fo=function(t,e,n,i,a,o){var r=t,s=t.actor,c=$();if(r.elapsed_time+=c,r.elapsed_time<1)s.position.y-=40*c;else if(r.elapsed_time>=2.5){var l=void 0,u=void 0,d=s.position.x-s.hot_spot.x,p=s.position.y-s.hot_spot.y,_=Tn(s),f=void 0;for(l=0;l<_.h;l++)for(u=0;u<_.w;u++)f=Ue(1,1),Fe(f,255,255,255),Uh(f,at(d+u,p+l),at(u-_.width/2+(J(_.width)-_.width/2),l-J(_.height/2)),!1);t.state=ws}},zo=function(t,e){jn(t.actor,e)},$o=function(t){Mn(t.actor)},Vo=function(t,e){Eh(100),ec(Js()+1),Mh(Ne("1up"))},Qo=function(t,e){Eh(100),tc(qs()+10),N(Ne("ring"))},Ko=function(t,e){Eh(100),e.invincible=!0,e.invtimer=0,D(I("data/music/invincible.mp4"),!1)},qo=function(t,e){Eh(100),e.got_speedshoes=!0,e.speedshoes_timer=0,D(I("data/music/speed.mp4"),!1)},Jo=function(t,e){Eh(100),e.got_glasses=!0},Zo=function(t,e){Eh(100),e.shield_type=As,N(Ne("shield"))},tr=function(t,e){Eh(100),e.shield_type=Ns,N(Ne("fire shield"))},er=function(t,e){Eh(100),e.shield_type=Cs,N(Ne("thunder shield"))},nr=function(t,e){Eh(100),e.shield_type=Ps,N(Ne("water shield"))},ir=function(t,e){Eh(100),e.shield_type=Bs,N(Ne("acid shield"))},ar=function(t,e){Eh(100),e.shield_type=Gs,N(Ne("wind shield"))},or=function(t,e){$s(e)},rr=function(t,e){Eh(100)},sr=function(t,e){var n={init:cr,release:dr,update:lr,render:ur},i=n;return i.on_destroy=t,i.anim_id=e,n},cr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe("SD_ITEMBOX",e.anim_id))},lr=function(t,e,n,i,a,o){for(var r=t.actor,s=t,c=0;c<n;c++){var l=e[c];if(l&&!(l.actor.is_jumping&&l.actor.speed.y<-10)&&t.state===ks&&pr(t,l)&&Ks(l)){var u=Bh(_s,ot(r.position,at(0,-5)));Wo(u,s.anim_id),Bh(fs,ot(r.position,at(0,-20))),Bh(ps,r.position),N(Ne("destroy")),l.actor.is_jumping&&Qs(l),s.on_destroy(t,l),t.state=ws}}s.anim_id=s.anim_id<e.length?wh():s.anim_id,Rn(t.actor,qe("SD_ITEMBOX",s.anim_id))},ur=function(t,e){jn(t.actor,e)},dr=function(t){Mn(t.actor)},pr=function(t,e){var n,i=t.actor.position;return n=An(t.actor,e.actor),t.actor.position=i,n},_r=function(t,e){var n={init:fr,release:hr,update:mr,render:gr},i=n;return i.on_collision=t,i.sprite_name=e,n},fr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Sn(),Rn(t.actor,qe(e.sprite_name,0))},hr=function(t){Mn(t.actor)},mr=function(t,e,n,i,a,o){var r=t,s=t.actor;s.visible=!1;for(var c=0;c<n;c++){var l=e[c];l&&An(s,l.actor)&&(l.at_loopfloortop=vr(t,a,l),r.on_collision(l))}},gr=function(t,e){jn(t.actor,e)},vr=function(t,e,n){var i=Bo(t,e,vs,null);return null!=i&&An(n.actor,i.actor)},br=function(t){t.disable_wall|=Ts,t.entering_loop=!0,t.bring_to_back=!1},yr=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=~(Ts|Is),t.disable_wall|=e?Is:Ts,t.bring_to_back=e}},xr=function(t){t.disable_wall|=Is,t.entering_loop=!0,t.bring_to_back=!0},kr=function(t){t.entering_loop||(t.disable_wall=js,t.bring_to_back=!1)},wr=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=Ds,t.entering_loop=!0,t.bring_to_back=!0)},Er=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=~Ds,t.bring_to_back=!1)},Sr=function(t){if(!t.flying)if(t.disable_wall&Ds){var e=t.actor.speed.x>0;t.disable_wall&=~(Ts|Is),t.disable_wall|=e?Is:Ts,t.bring_to_back=!0}else t.disable_wall&=~(Ts|Is),t.bring_to_back=!0},Mr=function(t){t.is_moving=!0,t.actor.speed.x=t.actor.maxspeed*(J(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+J(t.actor.jump_strength)},jr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Sn(),t.actor.maxspeed=220+J(140),t.actor.jump_strength=1.2*(350+J(50)),t.actor.input=ue(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,Rn(t.actor,qe("SD_RING",0))},Ir=function(t){Mn(t.actor)},Dr=function(t,e,n,i,a,o){for(var r=$(),s=t,c=t.actor,l=0;l<n;l++){var u=e[l];if(u&&(!s.is_moving||s.is_moving&&!u.getting_hit&&s.life_time>=.5)&&!s.is_disappearing&&!u.dying&&An(c,u.actor)){tc(qs()+1),s.is_disappearing=!0,N(Ne("ring"));break}}if(s.is_disappearing)Rn(c,qe("SD_RING",1)),Ln(c)&&(t.state=ws);else if(s.is_moving){if(ge(c.input,Wt),t.preserve=!1,s.life_time+=r,s.life_time>5){var d=240+J(20);c.visible=V()%d<d/2,s.life_time>8&&(t.state=ws)}Dn(c,Un(c,i,Ch()))}},Tr=function(t,e){jn(t.actor,e)},Or=function(t,e,n){var i={init:Rr,release:Lr,update:Ar,render:Nr},a=i;return a.collision=t,a.anim_id=e,a.cycle_length=n,i},Rr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.timer=0,e.hidden=!1,Rn(t.actor,qe("SD_SPIKES",e.anim_id))},Lr=function(t){Mn(t.actor)},Ar=function(t,e,n,i,a,o){var r=t,s=$();if(r.timer+=s,r.timer>=.5*r.cycle_length&&(r.timer=0,r.hidden=!r.hidden,N(Ne(r.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!r.hidden,t.actor.visible=!r.hidden,!r.hidden)for(var c=0;c<n;c++){var l=e[c];if(l&&!l.dying&&!l.blinking&&!l.invincible&&r.collision(t,l)){var u=Ne("spikes hit");P(u)||N(u),$s(l)}}},Nr=function(t,e){jn(t.actor,e)},Cr=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+Tn(i).width,n[3]=n[1]+Tn(i).height,tt(n,e)},Pr=function(t,e){var n,i=[],a=t.actor;return i[0]=a.position.x-a.hot_spot.x+5,i[1]=a.position.y-a.hot_spot.y-5,i[2]=i[0]+Tn(a).width-10,i[3]=i[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+Tn(e.actor).height,Cr(e,i)&&n<a.position.y-a.hot_spot.y+Tn(a).height/2},Br=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x+5,n[1]=i.position.y-i.hot_spot.y+Tn(i).height-5,n[2]=n[0]+Tn(i).width-10,n[3]=n[1]+10,Cr(e,n)},Gr=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x+Tn(i).width-5,n[1]=i.position.y-i.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Tn(i).height-10,Cr(e,n)},Ur=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x-5,n[1]=i.position.y-i.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Tn(i).height-10,Cr(e,n)},Hr=function(t,e,n){var i={init:Yr,release:Wr,update:Xr,render:Fr},a=i;return a.on_bump=t,a.sprite_name=e,a.strength=n,i},Yr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_bumping=!1,e.bang_timer=0,Rn(t.actor,qe(e.sprite_name,0))},Wr=function(t){Mn(t.actor)},Xr=function(t,e,n,i,a,o){var r=t,s=$();r.bang_timer+=s;for(var c=0;c<n;c++){var l=e[c];l&&!l.dying&&Nn(l.actor,t.actor)&&r.on_bump(t,l)}r.is_bumping&&Ln(t.actor)&&(Rn(t.actor,qe(r.sprite_name,0)),r.is_bumping=!1)},Fr=function(t,e){jn(t.actor,e)},zr=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&Vr(t,e)},$r=function(t,e){Vr(t,e)},Vr=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=$(),i=[],a=[];i[0]=e.x*t.actor.speed.x>=0,i[1]=e.y*t.actor.speed.y>=0,a[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>d,a[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>d,Math.abs(e.y)>d&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&i[0]||a[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&i[1]||a[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),Rn(n.actor,qe(t.sprite_name,1)),t.strength.x>d?e.actor.mirror&=-2:t.strength.x<-1e-5&&(e.actor.mirror|=1),t.bang_timer>.2&&(N(Ne("spring")),t.bang_timer=0)},Qr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_disabled=!1,e.is_active=!1,e.timer=0,Rn(t.actor,qe("SD_TELEPORTER",0))},Kr=function(t,e,n,i,a,o){var r=t,s=t.actor,c=$(),l=0;if(r.is_active){if(r.timer+=c,r.timer>=3){var u=r.who;be(u.actor.input),xm(u.actor);for(var d=0;d<n;d++){var p=e[d];if(p!=u){var _=ot(s.position,at(40*l++-20,-30));Zr(p,_)}}r.is_active=!1,r.is_disabled=!0}Rn(s,qe("SD_TELEPORTER",1))}else Rn(s,qe("SD_TELEPORTER",0))},qr=function(t,e){jn(t.actor,e)},Jr=function(t){Mn(t.actor)},Zr=function(t,e){t&&(t.actor.position=e,t.actor.speed=at(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=js,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},ts=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Sn(),e.is_pressed=!1,e.partner=null,Rn(t.actor,qe("SD_SWITCH",0))},es=function(t){Mn(t.actor)},ns=function(t,e,n,i,a,o){var r,s,c=t,l={},u={};c.partner=null,r=Bo(t,a,hs,l),s=Bo(t,a,ms,u),null!=r&&l.dist<u.dist&&(c.partner=r),null!=s&&u.dist<l.dist&&(c.partner=s),null==c.partner?as(t,r,e,n,os,rs):c.partner==r?as(t,r,e,n,ss,cs):c.partner==s&&as(t,s,e,n,ls,us)},is=function(t,e){jn(t.actor,e)},as=function(t,e,n,i,a,o){for(var r=!0,s=t,c=t.actor,l=0;l<i;l++){var u=n[l];ds(t,u)&&(r=!1,s.is_pressed||(a(e,u),N(Ne("switch")),Rn(c,qe("SD_SWITCH",1)),s.is_pressed=!0))}r&&s.is_pressed&&(o(e),Rn(c,qe("SD_SWITCH",0)),s.is_pressed=!1)},os=function(t,e){},rs=function(t){},ss=function(t,e){!function(t){t.is_closed=!1,N(Ne("open door"))}(t)},cs=function(t){!function(t){t.is_closed=!0,N(Ne("close door"))}(t)},ls=function(t,e){!function(t,e){var n=t,i=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,ve(e.actor.input),xm(i),N(Ne("teleporter")))}(t,e)},us=function(t){},ds=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],i=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+Tn(t.actor).width,n[3]=n[1]+Tn(t.actor).height,i[0]=e.actor.position.x-e.actor.hot_spot.x+.3*Tn(e.actor).width,i[1]=e.actor.position.y-e.actor.hot_spot.y+.5*Tn(e.actor).height,i[2]=i[0]+.4*Tn(e.actor).width,i[3]=i[1]+.5*Tn(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&tt(n,i)},ps=9,_s=10,fs=12,hs=26,ms=27,gs=31,vs=35;!function(t){t[t.IS_IDLE=0]="IS_IDLE",t[t.IS_DEAD=1]="IS_DEAD"}(Vt||(Vt={}));var bs,ys,xs,ks=Vt.IS_IDLE,ws=Vt.IS_DEAD,Es=function(t){var e=null;switch(t){case 0:e={init:jr,release:Ir,update:Dr,render:Tr};break;case 1:e=sr(Vo,0);break;case 2:e=sr(Qo,3);break;case 3:e=sr(Ko,4);break;case 4:e=sr(qo,5);break;case 5:e=sr(Jo,6);break;case 6:e=sr(Zo,7);break;case 42:e=sr(tr,11);break;case 78:e=sr(er,12);break;case 79:e=sr(nr,13);break;case 80:e=sr(ir,14);break;case 81:e=sr(ar,15);break;case 7:e=sr(or,8);break;case 8:e=sr(rr,9);break;case ps:e={init:Qa,release:Ja,update:Ka,render:qa};break;case _s:e={init:Xo,release:$o,update:Fo,render:zo};break;case 11:e={init:To,release:Lo,update:Oo,render:Ro};break;case fs:e={init:Mo,release:Do,update:jo,render:Io};break;case 13:e={init:Ao,release:Po,update:No,render:Co};break;case 15:e={init:ga,release:va,update:ba,render:ya};break;case 16:e=_r(br,"SD_LOOPRIGHT");break;case 17:e=_r(yr,"SD_LOOPMIDDLE");break;case 18:e=_r(xr,"SD_LOOPLEFT");break;case 19:e=_r(kr,"SD_LOOPNONE");break;case 33:e=_r(wr,"SD_LOOPFLOOR");break;case 34:e=_r(Er,"SD_LOOPFLOORNONE");break;case vs:e=_r(Sr,"SD_LOOPFLOORTOP");break;case 20:e=Hr(zr,"SD_YELLOWSPRING",at(0,-500));break;case 54:e=Hr($r,"SD_BYELLOWSPRING",at(0,500));break;case 50:e=Hr($r,"SD_TRYELLOWSPRING",at(400,-600));break;case 48:e=Hr($r,"SD_RYELLOWSPRING",at(600,0));break;case 52:e=Hr($r,"SD_BRYELLOWSPRING",at(400,600));break;case 53:e=Hr($r,"SD_BLYELLOWSPRING",at(-400,600));break;case 49:e=Hr($r,"SD_LYELLOWSPRING",at(-600,0));break;case 51:e=Hr($r,"SD_TLYELLOWSPRING",at(-400,-600));break;case 21:e=Hr(zr,"SD_REDSPRING",at(0,-750));break;case 47:e=Hr($r,"SD_BREDSPRING",at(0,750));break;case 43:e=Hr($r,"SD_TRREDSPRING",at(800,-1e3));break;case 22:e=Hr($r,"SD_RREDSPRING",at(1200,0));break;case 45:e=Hr($r,"SD_BRREDSPRING",at(800,1e3));break;case 46:e=Hr($r,"SD_BLREDSPRING",at(-800,1e3));break;case 23:e=Hr($r,"SD_LREDSPRING",at(-1200,0));break;case 44:e=Hr($r,"SD_TLREDSPRING",at(-800,-1e3));break;case 55:e=Hr(zr,"SD_BLUESPRING",at(0,-1500));break;case 62:e=Hr($r,"SD_BBLUESPRING",at(0,1500));break;case 58:e=Hr($r,"SD_TRBLUESPRING",at(1800,-1500));break;case 56:e=Hr($r,"SD_RBLUESPRING",at(2e3,0));break;case 60:e=Hr($r,"SD_BRBLUESPRING",at(1800,1500));break;case 61:e=Hr($r,"SD_BLBLUESPRING",at(-1800,1500));break;case 57:e=Hr($r,"SD_LBLUESPRING",at(-2e3,0));break;case 59:e=Hr($r,"SD_TLBLUESPRING",at(-1800,-1500));break;case 24:e={init:Ca,release:Ga,update:Pa,render:Ba};break;case 25:e={init:ts,release:es,update:ns,render:is};break;case hs:rh.length>1&&(e={init:vo,release:xo,update:bo,render:yo});break;case ms:e={init:Qr,release:Jr,update:Kr,render:qr};break;case 28:e={init:Ra,release:La,update:Aa,render:Na};break;case 29:e={init:Fa,release:Va,update:za,render:$a};break;case 30:e={init:Go,release:Yo,update:Uo,render:Ho};break;case gs:e={init:ko,release:So,update:wo,render:Eo};break;case 32:e={init:xa,release:ka,update:wa,render:Ea,state:null};break;case 36:e={init:Ua,release:Wa,update:Ha,render:Ya};break;case 37:e=Za("SD_DANGER",ao);break;case 75:e=Za("SD_VERTICALDANGER",ao);break;case 76:e=Za("SD_FIREDANGER",oo);break;case 77:e=Za("SD_VERTICALFIREDANGER",oo);break;case 38:e=Or(Pr,0,_);break;case 63:e=Or(Br,2,_);break;case 64:e=Or(Gr,1,_);break;case 65:e=Or(Ur,3,_);break;case 66:e=Or(Pr,0,5);break;case 67:e=Or(Br,2,5);break;case 68:e=Or(Gr,1,5);break;case 69:e=Or(Ur,3,5);break;case 39:e=po(Os,!0);break;case 70:e=po(Rs,!0);break;case 71:e=po(Ls,!0);break;case 72:e=po(Os,!1);break;case 73:e=po(Rs,!1);break;case 74:e=po(Ls,!1);break;case 40:case 41:e={init:so,release:uo,update:co,render:lo}}return null!=e&&(e.type=t,e.state=ks,e.init(e)),e},Ss=function(t,e,n,i,a,o){t.update(t,e,n,i,a,o)},Ms=function(t,e){t.render(t,e)},js=0,Is=2,Ds=4,Ts=8,Os=0,Rs=1,Ls=2,As=1,Ns=2,Cs=3,Ps=4,Bs=5,Gs=6,Us=0,Hs=0,Ys=function(t){S("player_create(".concat(t,")"));for(var e={name:"Unknown",type:t,actor:Sn(),disable_movement:!1,in_locked_area:!1,at_some_border:!1,spin:!1,spin_dash:!1,braking:!1,flying:!1,climbing:!1,landing:!1,spring:!1,is_fire_jumping:!1,getting_hit:!1,dying:!1,dead:!1,blinking:!1,on_moveable_platform:!1,lock_accel:0,flight_timer:0,blink_timer:0,death_timer:0,disable_jump_for:0,glasses:Sn(),got_glasses:!1,shield:Sn(),shield_type:0,invincible:!1,invtimer:0,invstar:[],got_speedshoes:!1,speedshoes_timer:0,disable_wall:js,entering_loop:!1,at_loopfloortop:!1,bring_to_back:!1},n=0;n<5;n++)e.invstar[n]=Sn(),Rn(e.invstar[n],qe("SD_INVSTAR",0));switch(e.type){case Os:e.name="Surge",e.actor.acceleration=250,e.actor.maxspeed=700,e.actor.jump_strength=450,e.actor.input=pe(),Rn(e.actor,qe(ic(Os),0));break;case Rs:e.name="Neon",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=pe(),Rn(e.actor,qe(ic(Rs),0));break;case Ls:e.name="Charge",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=pe(),Rn(e.actor,qe(ic(Ls),0))}return ys=1,bs=0,S("player_create() ok"),e},Ws=function(t){for(var e=0;e<t.invstar.length;e++)Mn(t.invstar[e]);Mn(t.glasses),Mn(t.actor)},Xs=function(t,e,n){var i=t.actor;return t.blinking&&(t.blink_timer+=$(),i.visible=V()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,i.visible=!0)),t.disable_movement?t.spin?Rn(t.actor,qe(ic(t.type),3)):t.spring&&Rn(t.actor,qe(ic(t.type),13)):Dn(i,zs(t,e,n,Ch())),t},Fs=function(t,e){if(t){var n=t.actor;if(n){var i,a,o=n.hot_spot,r=n.position,s=at(0,0),c=at(0,0),l=[],u=n.angle;if(t.invincible){var d=qe("SD_INVSTAR",0).frame_count;for(t.invtimer+=$(),i=0;i<5;i++)l[i]=720*V()*.001+72*(i+1),c.x=30*Math.cos(l[i]*h/180),c.y=(V()+400*i)%2e3/40,c=lt(c,u),t.invstar[i].position.x=n.position.x+c.x,t.invstar[i].position.y=n.position.y-c.y+5,On(t.invstar[i],J(d))}for(t.got_glasses&&ac(t),0!=t.shield_type&&rc(t),t.type,i=0;i<5&&t.invincible;i++)l[i]%360>=180&&jn(t.invstar[i],e);for(a=n.angle,n.angle=n.is_jumping||t.spin?a:nt(a),jn(n,e),n.angle=a,t.got_glasses&&jn(t.glasses,e),0!=t.shield_type&&jn(t.shield,e),i=0;i<5&&t.invincible;i++)l[i]%360<180&&jn(t.invstar[i],e);switch(t.type){case Os:break;case Rs:n.is_jumping&&n.animation==qe(ic(Rs),3)&&(n.position=at(r.x,r.y),n.angle=u,n.hot_spot=o,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=s))}}}},zs=function(t,e,n,i){var a,o,r,s,c,l,u,p,_,f,m,g,v,b,y,x,k,w,E,S,M,j,I,D,T=t.actor,O=ic(t.type),R=$(),L=480,A=0,C=1,B=T.maxspeed,G=at(0,0),U=!1,H=t.actor.animation==qe(O,1),Y=!1,W=!1,X=!1,F=null,z=Tn(T).width,V=Tn(T).height,Q=!(Math.abs(T.angle)<d||Math.abs(T.angle-h/2)<d||Math.abs(T.angle-h)<d||Math.abs(T.angle-3*h/2)<d),K=-2,q=0,et=0,nt=0,it=T.position;switch(t.type){case Os:Q?(q=1,et=.8,nt=.5):(q=.7,et=.5,nt=.4);break;case Rs:case Ls:Q?(q=1,et=.7,nt=.25):(q=.7,et=.5,nt=.25)}if(v=ot(it,lt(at(0,-V*q+K),-T.angle)),k=ot(it,lt(at(0,2),-T.angle)),E=ot(it,lt(at(-z*nt+K,-V*et),-T.angle)),y=ot(it,lt(at(z*nt-K,-V*et),-T.angle)),S=ot(it,lt(at(-z*nt+K,-V*q+K),-T.angle)),b=ot(it,lt(at(z*nt-K,-V*q+K),-T.angle)),w=ot(it,lt(at(-z*nt+K,2),-T.angle)),x=ot(it,lt(at(z*nt-K,2),-T.angle)),t.type==Rs&&T.carrying&&Math.abs(T.angle)<d){var ut=Tn(T.carrying).height,dt=T.speed.y>5?.7*ut:0;w.y+=dt,x.y+=dt,k.y+=dt,E.y+=ut*et+J(ut)-.5*ut,y.y=E.y}M=t.disable_wall&Ts,j=t.disable_wall&Is,I=t.disable_wall&Ds,D=1&t.disable_wall,xn=M,kn=j,wn=I,En=D,Bn(!(t.disable_wall&Ds));var pt=Pn(T,2,v,b,y,x,k,w,E,S,n,s,p,l,_,c,f,u,m);if(s=pt.up,c=pt.down,u=pt.left,l=pt.right,m=pt.upleft,p=pt.upright,f=pt.downleft,_=pt.downright,Bn(!0),t.dying)return T.speed.x=0,T.speed.y=Math.min(L,T.speed.y+i*R),T.mirror=null,T.angle=0,T.visible=!0,t.blinking=!1,t.death_timer+=R,t.dead=t.death_timer>=2.5,Rn(T,qe(O,8)),at(0,T.speed.y*R+.5*i*R*R);if(t.dead)return at(0,0);var _t=Gn(T,K,s,p,l,_,c,f,u,m);switch(s=_t.up,p=_t.upright,l=_t.right,u=_t.left,m=_t.upleft,c=_t.down,f=_t.downleft,_=_t.downright,t.type){case Os:T.carry_offset=at(1&T.mirror?7:-9,-40);break;case Rs:case Ls:T.carry_offset=at(1&T.mirror?7:-7,-42)}if(null!=T.carried_by){var ft=null,ht=void 0,mt=0,gt=0,vt=T.carried_by;for(ht=0;ht<e.length;ht++)if(e[ht]==t){gt=ht;break}for(ht=0;ht<e.length;ht++)if(e[ht].actor==vt){ft=e[ht],mt=ht,t.disable_wall=ft.disable_wall,t.entering_loop=ft.entering_loop,t.at_loopfloortop=ft.at_loopfloortop,t.bring_to_back=ft.bring_to_back;break}if(ft&&(ft.type==Rs&&!ft.flying||ft.getting_hit||ft.dying||ft.dead))T.position=at(T.carried_by.position.x,T.carried_by.position.y),T.carried_by.carrying=null,T.carried_by=null;else{if(!(c&&0==c.brick_ref.angle&&vt.speed.y>=5||t.getting_hit||t.dying||t.dead)){var bt=gt<mt?st(vt.speed,R):at(0,0);return T.speed=at(0,0),T.mirror=vt.mirror,T.angle=0,Rn(T,qe(O,25)),T.position=rt(ot(vt.position,bt),T.carry_offset),at(0,0)}T.position=at(T.carried_by.position.x,T.carried_by.position.y),T.carried_by.carrying=null,T.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(B*=1.5,t.speedshoes_timer+=R)),sc(t)&&T.is_jumping&&(t.disable_wall&=~Ds),t.spring&&(c&&T.speed.y>=0||t.flying||t.climbing)&&(t.spring=!1),a=(l&&fe(T.input,Yt)||u&&fe(T.input,Ht))&&c,t.on_moveable_platform=ct(Hh(c,T))>d,(r=c&&(T.angle>0&&T.angle<h/2&&T.speed.x>0||T.angle>3*h/2&&T.angle<2*h&&T.speed.x<0))&&(m||p)||Math.abs(T.angle)<d||Math.abs(T.angle-h)<d){if(l&&l.brick_ref.angle%90==0&&(T.speed.x>d||y.x>l.x)&&(!r||r&&90!=l.brick_ref.angle)&&(T.speed.x=0,T.position.x=l.x+(it.x-y.x),!T.is_jumping&&!t.flying&&!t.climbing&&Math.abs(T.speed.y)<d&&(F=qe(O,a?14:0)),r))return at(-5,0);if(u&&u.brick_ref.angle%90==0&&(T.speed.x<-1e-5||E.x<u.x+u.brick_ref.image.width)&&(!r||r&&270!=u.brick_ref.angle)&&(T.speed.x=0,T.position.x=u.x+u.brick_ref.image.width+(it.x-E.x),!T.is_jumping&&!t.flying&&!t.climbing&&Math.abs(T.speed.y)<d&&(F=qe(O,a?14:0)),r))return at(5,0);T.position.x<=T.hot_spot.x&&(t.spin=!1,W=!0,T.position.x<T.hot_spot.x&&(T.speed.x=0,T.position.x=T.hot_spot.x,c&&(a=!0,F=qe(O,1)))),T.position.x>=Sh().x-(Tn(T).width-T.hot_spot.x)&&(t.spin=!1,Y=!0,T.position.x>Sh().x-(Tn(T).width-T.hot_spot.x)&&(T.speed.x=0,T.position.x=Sh().x-(Tn(T).width-T.hot_spot.x),c&&(a=!0,F=qe(O,1))))}if(!t.climbing){if(c){var yt,xt=c.brick_ref.angle,kt=void 0;if(U=!0,T.ignore_horizontal=!1,t.is_fire_jumping=!1,T.is_jumping=!1,c.brick_ref&&3==c.brick_ref.behavior&&0==c.state&&(c.state=2),Math.abs(T.speed.x)<d){if(xt%180==0&&(t.spin=!1),fe(T.input,Ut))t.spin_dash||(F=qe(O,4)),he(T.input,Wt)&&(F=qe(O,6),t.spin_dash=!0,N(Ne("charge")));else if(!a)if(fe(T.input,Gt))H&&t.at_some_border||(F=qe(O,5));else if(sc(t))F=qe(O,0);else{var wt=ot(it,lt(at(-8,0),-T.angle)),Et=ot(it,lt(at(5,0),-T.angle)),St=at(0,0),Mt=Pn(T,2,St,St,St,Et,St,wt,St,St,n,null,null,null,void 0,null,void 0,null,null);Mt.downleft&&Mt.downright||t.on_moveable_platform?fe(T.input,Ht)&&(W||t.at_some_border)||fe(T.input,Yt)&&(Y||t.at_some_border)?(T.mirror=W?1:0,F=qe(O,1)):F=qe(O,0):F=qe(O,10)}if(t.spin_dash){var jt=void 0,It=1&T.mirror?1:-1,Dt=void 0,Tt=void 0,Ot=void 0;for(jt=0;jt<3;jt++)J(128),Ot=Ue(1,1),Fe(Ot,255,255,255),Dt=at(It*(7+J(7)),2),Tt=at(It*(50+J(200)),-J(200)),Uh(Ot,ot(T.position,Dt),Tt,!0);(me(T.input,Ut)||xh())&&(t.spin=!0,t.spin_dash=!1,(!(1&T.mirror)||u||W)&&(1&T.mirror||l||Y)||(T.speed.x=(1&T.mirror?-1:1)*B*1.35),N(Ne("release")),t.disable_jump_for=.05)}}else if(fe(T.input,Ut)&&(t.spin||N(Ne("roll")),t.spin=!0),t.spin||t.braking)t.spin?F=qe(O,3):t.braking&&(It=1&T.mirror?1:-1,Dt=void 0,Tt=void 0,Ot=void 0,J(128),Ot=Ue(1,1),Dt=at(It*(10-J(21)),0),Tt=at(It*(50+J(200)),-J(200)),Uh(Ot,ot(T.position,Dt),Tt,!0),F=qe(O,7),Math.abs(T.speed.x)<10&&(t.braking=!1));else{var Rt=.75*B,Lt=.35*B;Math.abs(T.speed.x)<Rt?!a&&T.speed.y>=0&&(F=qe(O,1),T=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(T,.5+Math.abs(T.speed.x)/Rt*1.5)):F=qe(O,2),Math.abs(T.speed.x)>=Lt&&(fe(T.input,Yt)&&T.speed.x<0||fe(T.input,Ht)&&T.speed.x>0)&&(N(Ne("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-R,0),Math.abs(T.speed.x)<d&&(t.disable_jump_for=0),yt=!t.spin_dash,fe(T.input,Wt)&&t.disable_jump_for<=0&&!fe(T.input,Ut)&&!s&&!t.landing&&yt&&!T.is_jumping&&(N(Ne("jump")),T.angle=0,T.is_jumping=!0,t.is_fire_jumping=!0,X=!0,t.spin=!1,F=qe(O,3),0==xt?T.speed.y=1*-T.jump_strength:xt>0&&xt<90?xt>45?(T.speed.x=Math.min(T.speed.x,-.7*T.jump_strength*1),T.speed.y=-.7*T.jump_strength*1):(T.speed.x*=T.speed.x>0?.5:1,T.speed.y=1*-T.jump_strength):90==xt?(Dn(T,at(-40,0)),T.speed.x=Math.min(T.speed.x,1*-T.jump_strength),T.speed.y=-T.jump_strength/2*1):xt>90&&xt<180?(Dn(T,at(0,40)),T.speed.x=Math.min(T.speed.x,-.7*T.jump_strength*1),T.speed.y=1*T.jump_strength):180==xt?(Dn(T,at(0,40)),T.speed.x*=-1,T.speed.y=1*T.jump_strength):xt>180&&xt<270?(Dn(T,at(0,40)),T.speed.x=Math.max(T.speed.x,.7*T.jump_strength*1),T.speed.y=1*T.jump_strength):270==xt?(Dn(T,at(40,0)),T.speed.x=Math.max(T.speed.x,1*T.jump_strength),T.speed.y=-T.jump_strength/2*1):xt>270&&xt<360&&(xt<315?(T.speed.x=Math.max(T.speed.x,.7*T.jump_strength*1),T.speed.y=-.7*T.jump_strength*1):(T.speed.x*=T.speed.x<0?.5:1,T.speed.y=1*-T.jump_strength))),!T.is_jumping){var At=void 0;xt>0&&xt<90?(At=.8*Math.min(1,Math.tan(xt*h/180)),Math.abs(T.speed.y)>d?T.speed.x=U&&xt<=45?T.speed.x:Math.max(-1.2*B,-1*At*T.speed.y):(kt=(1&T.mirror?2:1)*At,t.braking&&xt<45?kt*=8*(T.speed.x<0?-.5:1):Math.abs(T.speed.x)<5&&(kt*=25*Math.sin(xt*h/180),t.lock_accel=2),T.speed.x=Math.max(T.speed.x-700*kt*R,-1.2*B))):xt>270&&xt<360&&(At=.8*Math.min(1,-Math.tan(xt*h/180)),Math.abs(T.speed.y)>d?T.speed.x=U&&xt>=315?T.speed.x:Math.min(1.2*B,1*At*T.speed.y):(kt=(1&T.mirror?1:2)*At,t.braking&&xt>315?kt*=8*(T.speed.x>0?-.5:1):Math.abs(T.speed.x)<5&&(kt*=25*-Math.sin(xt*h/180),t.lock_accel=1),T.speed.x=Math.min(T.speed.x+700*kt*R,1.2*B)))}xt%90==0&&(t.lock_accel=0),f&&_&&Math.abs(T.speed.x)<40&&f.brick_ref.angle>270&&f.brick_ref.angle<360&&_.brick_ref.angle>0&&_.brick_ref.angle<90&&(fe(T.input,Ht)||fe(T.input,Yt)||(T.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,F=qe(O,1)),T.animation!=qe(O,0)&&T.animation!=qe(O,10)&&T.animation!=qe(O,5)||(F=qe(O,1)),(t.spring||H||T.speed.y<0)&&(t.spin=!1),sc(t)||(T.angle=0);if(c||t.is_fire_jumping&&T.speed.y<.88*-T.jump_strength&&me(T.input,Wt)&&(T.speed.y*=.7),t.type==Rs&&t.flying?(C=t.flight_timer<10?.15:.8,L*=.3):C=1,G.y=Math.abs(T.speed.y)>d?T.speed.y*R+i*C*.5*(R*R):0,t.type==Ls&&t.flying||(T.speed.y=Math.min(T.speed.y+i*C*R,L)),o=s&&s.brick_ref.angle%90!=0&&Math.abs(T.angle)<d,s&&(s.brick_ref.angle%90==0||o)&&T.speed.y<-1e-5&&(T.position.y=s.y+s.brick_ref.image.height+(it.y-v.y),T.speed.y=10,1==s.brick_ref.behavior&&Math.sin(s.brick_ref.behavior_arg[3]*s.value[0])>0))return T.speed.y=100,ot(G,st(Hh(s,T),R));if((g=c)&&!T.is_jumping)if(xt=g.brick_ref.angle,T.speed.y=G.y=0,T.angle=xt*h/180,0==xt){var Nt=Hh(c,T);it.y=g.y,A=0,Nt.y>d?G.y+=Nt.y*R:T.position.y=it.y+K+1}else if(xt>0&&xt<90)it.y=g.y+g.brick_ref.image.height-(T.position.x-g.x)*Math.tan(T.angle),T.speed.x<0&&(it.y+=2),T.position.y=it.y+K,1&T.mirror||(A=.2);else if(90==xt){if(Math.abs(T.speed.x)>5){var Ct=_?_.brick_ref.angle:-1;_&&Ct>=xt&&Ct<xt+90?t.flying||(T.position.x=g.x+K):(T.angle=0,T.is_jumping=!0,t.spin||t.flying||(F=qe(O,1)),sc(t)||(t.flying||Dn(T,at(-13,0)),T.speed=at(0,-.9*Math.abs(T.speed.x))))}else T.angle=0,t.flying||Dn(T,at(-10,0)),T.is_jumping=!0,T.ignore_horizontal=!1;1&T.mirror||(A=1.5)}else xt>90&&xt<180?(Math.abs(T.speed.x)>5?(it.y=g.y-(T.position.x-g.x)*Math.tan(T.angle),T.position.y=it.y-K):(T.angle=0,Dn(T,at(0,30)),T.is_jumping=!0),A=1.5):180==xt?(Math.abs(T.speed.x)>5?(it.y=g.y+g.brick_ref.image.height,T.position.y=it.y-K,(T.speed.x>0&&!_||T.speed.x<0&&!f)&&(Dn(T,at(0,-30)),T.is_jumping=!0,T.speed.x*=-1,T.mirror=T.speed.x<0?1:0,T.angle=0)):(T.angle=0,Dn(T,at(0,40)),T.is_jumping=!0,T.speed.x=0),A=1.2):xt>180&&xt<270?(Math.abs(T.speed.x)>5?(it.y=g.y+g.brick_ref.image.height-(T.position.x-g.x)*Math.tan(T.angle),T.position.y=it.y-K):(T.angle=0,Dn(T,at(0,30)),T.is_jumping=!0),A=1.5):270==xt?(Math.abs(T.speed.x)>5?(Ct=f?f.brick_ref.angle:-1,f&&Ct>xt-90&&Ct<=xt?t.flying||(T.position.x=g.x+g.brick_ref.image.width-K):(T.angle=0,T.is_jumping=!0,t.spin||t.flying||(F=qe(O,1)),sc(t)||(t.flying||Dn(T,at(13,0)),T.speed=at(0,-.9*Math.abs(T.speed.x))))):(T.angle=0,t.flying||Dn(T,at(10,0)),T.is_jumping=!0,T.ignore_horizontal=!1),1&T.mirror&&(A=1.5)):xt>270&&xt<360&&(it.y=g.y-(T.position.x-g.x)*Math.tan(T.angle),T.speed.x>0&&(it.y+=2),T.position.y=it.y+K,1&T.mirror&&(A=.2));if(G.x=Math.abs(T.speed.x)>d?T.speed.x*R+(1-A)*T.acceleration*.5*(R*R):0,!fe(T.input,Ht)||fe(T.input,Yt)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||W)if(!fe(T.input,Yt)||fe(T.input,Ht)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||Y){if(c){var Pt=0;xt=c.brick_ref.angle,kt=0,kt=t.spin?.65:t.braking?4.5:t.landing?.6:1,xt%90==0?Pt=90==xt?-1:270==xt?1:T.speed.x>d?-1:-T.speed.x>d?1:0:(xt>90&&xt<180||xt>180&&xt<270)&&(Pt=T.speed.x>d?-1:-T.speed.x>d?1:0),T.speed.x+=Pt*kt*T.acceleration*R}}else T.ignore_horizontal||!(T.is_jumping||t.spring||H)&&fe(T.input,Ut)||(T.mirror=0,A=T.speed.x<0?-1:A,T.speed.x<=1.1*B&&(T.speed.x=Math.min(T.speed.x+(1-A)*T.acceleration*R,B)));else T.ignore_horizontal||!(T.is_jumping||t.spring||H)&&fe(T.input,Ut)||(T.mirror=1,A=T.speed.x>0?-1:A,T.speed.x>=1.1*-B&&(T.speed.x=Math.max(T.speed.x-(1-A)*T.acceleration*R,-B)))}switch(t.spring&&(F=qe(O,T.speed.y<=0?13:1),T.speed.y>0&&(t.spring=!1,T.is_jumping=!1)),t.getting_hit&&(c?t.getting_hit=!1:F=qe(O,11)),t.type){case Os:break;case Rs:if(t.flight_timer+=R,c&&90!=c.brick_ref.angle&&270!=c.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(T.is_jumping&&T.speed.y>-T.jump_strength/3&&!X&&!t.getting_hit||t.flying)&&he(T.input,Wt)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),T.speed.y=.1*-Ch(),t.flying=!0,T.is_jumping=!1,t.is_fire_jumping=!1),t.flying){if(F=qe(O,T.carrying?16:20),T.speed.x=Z(T.speed.x,-T.maxspeed/2,T.maxspeed/2),t.flight_timer>=10){var Bt=Ne("tired of flying");P(Bt)||N(Bt),F=qe(O,19)}else for(Bt=void 0,ht=void 0,sc(t)&&(T.angle=0),Bt=Ne("flying"),P(Bt)||N(Bt),ht=0;ht<e.length&&null==T.carrying;ht++)if(e[ht]!=t&&T.speed.y<=0){var Xt=[e[ht].actor.position.x+.3*Tn(e[ht].actor).width,e[ht].actor.position.y,e[ht].actor.position.x+.7*Tn(e[ht].actor).width,e[ht].actor.position.y+.2*Tn(e[ht].actor).height],Ft=[T.position.x+.3*Tn(T).width,T.position.y+.7*Tn(T).height,T.position.x+.7*Tn(T).width,T.position.y+Tn(T).height],zt=tt(Xt,Ft),$t=!(null!=e[ht].actor.carried_by||e[ht].dying||e[ht].dead||e[ht].climbing||e[ht].landing||e[ht].getting_hit);zt&&$t&&!c&&(T.carrying=e[ht].actor,e[ht].actor.carried_by=T,e[ht].spin=e[ht].spin_dash=e[ht].braking=e[ht].flying=e[ht].spring=e[ht].on_moveable_platform=!1,N(Ne("touch the wall")))}}else T.animation==qe(O,T.carrying?16:20)&&(F=qe(O,1));break;case Ls:if((T.is_jumping&&T.speed.y>-.7*T.jump_strength||t.flying)&&he(T.input,Wt)&&!c&&!t.getting_hit&&(T.speed.y=50,t.flying=!0,T.is_jumping=!1,t.is_fire_jumping=!1,T.speed.x=1&T.mirror?Math.min(-100,T.speed.x):Math.max(100,T.speed.x)),t.flying){var Vt=fe(T.input,Ht)&&T.speed.x>0||fe(T.input,Yt)&&T.speed.x,Qt=c&&Math.abs(c.brick_ref.angle*h/180-0)<d;if(Vt=T.animation==qe(O,21)&&!Ln(T),Qt||T.animation==qe(O,19)||t.landing||(1&T.mirror?(F=qe(O,Vt?21:20),T.speed.x=Math.max(T.speed.x-.5*T.acceleration*R,-B/2)):(F=qe(O,Vt?21:20),T.speed.x=Math.min(T.speed.x+.5*T.acceleration*R,B/2))),Qt)t.landing=!0,T.is_jumping=!1,F=qe(O,19),T.speed.y=0,G.y=0,t.climbing=!1;else if(me(T.input,Wt))t.flying=!1,F=qe(O,18);else{var Kt=void 0,qt=[u,f,l,_,c];for(Kt=0;Kt<qt.length;Kt++)(g=qt[Kt])&&g.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}Qt||s||(u&&u.brick_ref.angle%90==0||l&&l.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,N(Ne("touch the ground")))}if(t.landing&&(Math.abs(T.speed.x)<d||!c)&&(t.flying=t.landing=!1),t.climbing){var Jt=at(0,0);if(T.speed.x=G.x=0,u&&!l&&(T.mirror|=1),l&&!u&&(T.mirror&=-2),Jt=ot(Jt,st(Hh(u,T),R)),((Jt=ot(Jt,st(Hh(l,T),R))).y<=0&&!s||Jt.y>=0&&!c||!u&&l)&&(G=ot(G,Jt)),u||l)if(he(T.input,Wt)){var Zt=qe(O,17),te=qe(O,22);T.animation!=Zt&&T.animation!=te||(t.climbing=!1,T.is_jumping=!0,t.is_fire_jumping=!0,T.speed.x=.7*(1&T.mirror?1:-1)*T.jump_strength,T.speed.y=-.5*T.jump_strength,u&&!l&&(T.mirror&=-2),!u&&l&&(T.mirror|=1),F=qe(O,3),N(Ne("jump")))}else fe(T.input,Gt)?s||(G.y=.1*-B*R,F=qe(O,17)):fe(T.input,Ut)?c?t.climbing=!1:(G.y=.1*B*R,F=qe(O,17)):F=qe(O,22);else(g=1&T.mirror?f:_)?(F=qe(O,23),T.ignore_horizontal=!0,G=ot(G,st(Hh(g,T),R)),Ln(T)&&(t.climbing=!1,T.ignore_horizontal=!1,T.speed=at((1&T.mirror?-1:1)*B*.15,-Ch()/12.5),G.x=5*(1&T.mirror?-1:1))):(t.climbing=!1,T.is_jumping=!0,F=qe(O,3))}}return t.at_some_border=!1,F&&Rn(T,F),Math.abs(T.speed.x)<4&&(t.braking=!1,(!fe(T.input,Yt)&&!fe(T.input,Ht)||fe(T.input,Yt)&&fe(T.input,Ht)||t.spin||t.landing)&&(G.x=0,T.speed.x=0)),G.x+=Hh(c,T).x*R,G.x=T.position.x<=T.hot_spot.x&&T.speed.x<0?0:G.x,G.x=T.position.x>=Sh().x-(Tn(T).width-T.hot_spot.x)&&T.speed.x>0?0:G.x,G},$s=function(t){var e,n,i=t.actor,a=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(oc(t),0!=t.shield_type)a=!0,t.shield_type=0,N(Ne("death"));else if(bs>0){for(a=!0,n=0;n<Math.min(qs(),15);n++)e=Bh(0,i.position),Mr(e);tc(0),N(Ne("ringless"))}else Vs(t);a&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,i.speed.x=1&i.mirror?200:-200,i.speed.y=-.75*i.jump_strength,Dn(i,at(0,-5)))},Vs=function(t){t.dying||(oc(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,N(Ne("death")))},Qs=function(t){ge(t.actor.input,Wt),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},Ks=function(t){var e=qe(ic(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||t.type==Ls&&(t.landing||t.flying)},qs=function(){return bs},Js=function(){return Us},Zs=function(){return Hs},tc=function(t){bs=Z(t,0,9999),t/100>=ys&&(ys+=1,ec(Js()+1),Mh(Ne("1up")))},ec=function(t){Us=t},nc=function(t){Hs=t},ic=function(t){switch(t){case Os:return"SD_SONIC";case Rs:return"SD_TAILS";case Ls:return"SD_KNUCKLES";default:return"null"}},ac=function(t){if(t&&t.actor){var e=0,n=1&t.actor.mirror,i=!0,a=nt(t.actor.angle),o=at(0,0),r=rt(t.actor.position,lt(at(0,t.actor.hot_spot.y),-a)),s=t.actor.animation;switch(t.type){case Os:if(s==qe(ic(Os),0))o=at(3,24),e=1;else if(s==qe(ic(Os),1))switch(~~t.actor.animation_frame){case 0:e=2,o=at(5,23);break;case 1:e=2,o=at(4,25);break;case 2:e=1,o=at(7,25);break;case 3:case 4:e=1,o=at(5,23);break;case 5:e=1,o=at(4,24);break;case 6:e=2,o=at(6,24);break;case 7:e=2,o=at(6,23)}else if(s==qe(ic(Os),2))e=1,o=at(8,26);else if(s==qe(ic(Os),5))e=3,o=0==~~t.actor.animation_frame?at(0,19):at(-1,21);else if(s==qe(ic(Os),7))e=1,o=~~t.actor.animation_frame<2?at(8,26):at(10,28);else if(s==qe(ic(Os),10))switch(e=1,~~t.actor.animation_frame){case 0:o=at(1,22);break;case 1:o=at(-1,23);break;case 2:o=at(1,23)}else s==qe(ic(Os),11)?(e=3,o=at(-4,30)):s==qe(ic(Os),12)?(e=3,o=at(1,19)):s==qe(ic(Os),13)?(e=3,o=at(4,13)):s==qe(ic(Os),14)?(e=1,o=at(12,31)):s==qe(ic(Os),15)?(e=0,o=at(3,23)):s==qe(ic(Os),25)?(e=0,o=at(3,22)):i=!1;break;case Rs:if(s==qe(ic(Rs),0))o=at(5,34),e=1;else if(s==qe(ic(Rs),1))switch(e=2,~~t.actor.animation_frame){case 0:o=at(2,33);break;case 1:case 5:o=at(3,33);break;case 2:o=at(8,33);break;case 3:case 7:o=at(3,32);break;case 4:o=at(1,33);break;case 6:o=at(7,33)}else if(s==qe(ic(Rs),2))e=2,o=0==~~t.actor.animation_frame?at(7,35):at(6,34);else if(s==qe(ic(Rs),4))e=1,o=at(9,44);else if(s==qe(ic(Rs),5))e=1,o=at(7,32);else if(s==qe(ic(Rs),7))e=1,o=0==~~t.actor.animation_frame?at(2,33):at(4,33);else if(s==qe(ic(Rs),10))switch(e=4,~~t.actor.animation_frame){case 0:o=at(5,33);break;case 1:o=at(6,33)}else if(s==qe(ic(Rs),11))e=1,o=at(1,33);else if(s==qe(ic(Rs),12))e=1,o=at(6,28);else if(s==qe(ic(Rs),13))e=3,o=at(2,17);else if(s==qe(ic(Rs),14))e=1,o=at(9,35);else if(s==qe(ic(Rs),15))switch(e=4,~~t.actor.animation_frame){case 0:case 8:case 9:case 10:o=at(5,34);break;default:o=at(5,33)}else s==qe(ic(Rs),16)?(e=1,o=at(8,37)):s==qe(ic(Rs),19)?(e=1,o=0==~~t.actor.animation_frame?at(9,39):at(9,40)):s==qe(ic(Rs),20)?(e=1,o=at(8,39)):s==qe(ic(Rs),25)?(e=1,o=at(0,23)):i=!1;break;case Ls:if(s==qe(ic(Ls),0))e=1,o=at(1,24);else if(s==qe(ic(Ls),1))switch(~~t.actor.animation_frame){case 0:e=1,o=at(5,29);break;case 1:e=2,o=at(5,29);break;case 2:e=2,o=at(8,29);break;case 3:e=2,o=at(9,28);break;case 4:e=1,o=at(6,28);break;case 5:e=1,o=at(6,29);break;case 6:e=1,o=at(5,28);break;case 7:e=1,o=at(4,27)}else if(s==qe(ic(Ls),2))e=1,o=at(7,29);else if(s==qe(ic(Ls),4))e=1,o=0==~~t.actor.animation_frame?at(0,31):at(0,40);else if(s==qe(ic(Ls),5))e=1,o=0==~~t.actor.animation_frame?at(0,21):at(-1,21);else if(s==qe(ic(Ls),7))e=0,o=at(-2,27);else if(s==qe(ic(Ls),10))switch(e=1,~~t.actor.animation_frame){case 0:o=at(9,30);break;case 1:o=at(8,27)}else if(s==qe(ic(Ls),11))e=1,o=at(-3,27);else if(s==qe(ic(Ls),12))e=1,o=at(5,24);else if(s==qe(ic(Ls),13))e=3,o=at(-1,16);else if(s==qe(ic(Ls),14))switch(~~t.actor.animation_frame){case 0:e=1,o=at(5,29);break;case 1:e=2,o=at(5,29);break;case 2:e=2,o=at(8,29);break;case 3:e=2,o=at(9,28);break;case 4:e=1,o=at(6,28);break;case 5:e=1,o=at(6,29);break;case 6:e=1,o=at(5,28);break;case 7:e=1,o=at(4,27)}else if(s==qe(ic(Ls),15))e=0,o=at(1,23);else if(s==qe(ic(Ls),16))switch(e=1,~~t.actor.animation_frame){case 0:o=at(6,23);break;case 1:o=at(5,20);break;case 2:o=at(0,22)}else if(s==qe(ic(Ls),17))switch(e=3,~~t.actor.animation_frame){case 0:o=at(-1,22);break;case 1:o=at(-2,20);break;case 2:o=at(0,21);break;case 3:o=at(-1,24);break;case 4:o=at(0,23);break;case 5:o=at(0,22)}else if(s==qe(ic(Ls),18))e=1,o=0==~~t.actor.animation_frame?at(6,23):at(5,20);else if(s==qe(ic(Ls),19))e=1,o=at(8,44);else if(s==qe(ic(Ls),20))e=1,o=at(8,39);else if(s==qe(ic(Ls),21))switch(e=4,~~t.actor.animation_frame){case 0:o=at(-8,41);break;case 1:o=at(0,43);break;case 2:o=at(10,41)}else if(s==qe(ic(Ls),22))e=3,o=at(0,22);else if(s==qe(ic(Ls),23))switch(~~t.actor.animation_frame){case 0:e=3,o=at(7,17);break;case 1:e=3,o=at(11,15);break;case 2:e=0,o=at(12,13)}else s==qe(ic(Ls),25)?(e=0,o=at(0,23)):i=!1}return o.x*=n?-1:1,Rn(t.glasses,qe("SD_GLASSES",e)),t.glasses.position=ot(r,lt(o,-a)),t.glasses.angle=a,t.glasses.mirror=t.actor.mirror,t.glasses.visible=i&&t.actor.visible,t}},oc=function(t){},rc=function(t){var e=t.shield,n=t.actor,i=at(0,0);switch(t.shield_type){case As:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_SHIELD",0));break;case Ns:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_FIRESHIELD",0));break;case Cs:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_THUNDERSHIELD",0));break;case Ps:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_WATERSHIELD",0));break;case Bs:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_ACIDSHIELD",0));break;case Gs:i=at(0,-22),e.position=ot(n.position,lt(i,-nt(n.angle))),Rn(e,qe("SD_WINDSHIELD",0))}},sc=function(t){return t.disable_wall!==js},cc=function(t){var e=t.decorated_machine;e.init(e)},lc=function(t){var e=t.decorated_machine;e.release(e)},uc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;tc(qs()+s.rings),r.update(r,e,n,i,a,o)},dc=function(t,e){var n=t.decorated_machine;n.render(n,e)},pc=function(t){var e=t.decorated_machine;e.init(e)},_c=function(t){var e=t.decorated_machine;e.release(e)},fc=function(t,e,n,i,a,o){var r=t.decorated_machine;Eh(t.score),r.update(r,e,n,i,a,o)},hc=function(t,e){var n=t.decorated_machine;n.render(n,e)},mc=function(t,e,n){var i={init:gc,release:vc,update:bc,render:yc,get_object_instance:ma},a=i;return a.decorated_machine=t,a.offset=at(e,n),i},gc=function(t){var e=t.decorated_machine;e.init(e)},vc=function(t){var e=t.decorated_machine;e.release(e)},bc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),l=Dp(c);c.actor.position=ot(l.actor.position,s.offset),r.update(r,e,n,i,a,o)},yc=function(t,e){var n=t.decorated_machine;n.render(n,e)},xc=function(t,e,n,i,a,o){return Mc(t,jc(e,n,i,a,o))},kc=function(t){var e=t.decorated_machine;e.init(e)},wc=function(t){var e=t.decorated_machine;e.release(e)},Ec=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy.update(s.strategy),r.update(r,e,n,i,a,o)},Sc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Mc=function(t,e){var n={init:kc,release:wc,update:Ec,render:Sc,get_object_instance:ma},i=n;return i.decorated_machine=t,i.strategy=e,n},jc=function(t,e,n,i,a){return{update:Ic,sfx:Ne(t),vol:Math.min(e,0,1),pan:Math.min(n,-1,1),freq:i,loop:a}},Ic=function(t){C(t.sfx)},Dc=function(t,e){return{update:Tc,mus:I(t),loop:e}},Tc=function(t){var e=t;D(e.mus,e.loop)},Oc=function(t){Nh()},Rc=function(t){O(t.vol)},Lc=function(t){var e=t.decorated_machine;e.init(e)},Ac=function(t){var e=t.decorated_machine;e.release(e)},Nc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=Dp(t.get_object_instance(t));Qs(s),r.update(r,e,n,i,a,o)},Cc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Pc=function(t){var e=t.decorated_machine;e.init(e)},Bc=function(t){var e=t.decorated_machine;e.release(e)},Gc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),l=$(),u=st(s.speed,l);c.actor.position=ot(c.actor.position,u),r.update(r,e,n,i,a,o)},Uc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Hc=function(t){var e=t.decorated_machine;e.init(e)},Yc=function(t){var e=t.decorated_machine;e.release(e)},Wc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),l=Fc(c,o,s.object_name,null);null!=l&&_a(l.vm,s.new_state_name),r.update(r,e,n,i,a,o)},Xc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Fc=function(t,e,n,i){var a,o,r=_,s=null;for(a=e;a;a=a.next)a.data.name==n&&(o=rt(a.data.actor.position,t.actor.position),ct(o)<r&&(s=a.data,r=ct(o)));return i&&(i=r),s},zc=function(t,e,n,i,a){var o={init:$c,release:Vc,update:Qc,render:Kc,get_object_instance:ma},r=o;return r.decorated_machine=t,r.strategy=qc,r.offset=at(n,i),r.object_name=e,r.child_name=a,r.new_state_name=null,o},$c=function(t){var e=t.decorated_machine;e.init(e)},Vc=function(t){var e=t.decorated_machine;e.release(e)},Qc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy(s),r.update(r,e,n,i,a,o)},Kc=function(t,e){var n=t.decorated_machine;n.render(n,e)},qc=function(t){var e=t,n=e.get_object_instance(e),i=Gh(t.object_name,ot(n.actor.position,t.offset));null!=i&&jp(n,t.child_name,i)},Jc=function(t){var e=t,n=e.get_object_instance(e),i=Mp(n,t.child_name);null!=i&&_a(i.vm,t.new_state_name)},Zc=function(t){var e=t,n=e.get_object_instance(e),i=Sp(n);null!=i&&_a(i.vm,t.new_state_name)},tl=function(t){var e=t.decorated_machine;e.init(e)},el=function(t){var e=t.decorated_machine;e.release(e)},nl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t);Ih(s.actor),r.update(r,e,n,i,a,o)},il=function(t,e){var n=t.decorated_machine;n.render(n,e)},al=function(t){var e=t.decorated_machine;e.init(e)},ol=function(t){var e=t.decorated_machine;e.release(e)},rl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);Bh(s.item_id,ot(c.actor.position,s.offset)),r.update(r,e,n,i,a,o)},sl=function(t,e){var n=t.decorated_machine;n.render(n,e)},cl=function(t){var e=t.decorated_machine;e.init(e)},ll=function(t){var e=t.decorated_machine;e.release(e)},ul=function(t,e,n,i,a,o){var r=t.decorated_machine;t.get_object_instance(t).state=vp,r.update(r,e,n,i,a,o)},dl=function(t,e){var n=t.decorated_machine;n.render(n,e)},pl=function(t,e,n,i){var a={init:_l,release:fl,update:hl,render:ml,get_object_instance:ma},o=a;return o.decorated_machine=t,o.title=e,o.message=n,o.strategy=i,a},_l=function(t){var e=t.decorated_machine;e.init(e)},fl=function(t){var e=t.decorated_machine;e.release(e)},hl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy(s),r.update(r,e,n,i,a,o)},ml=function(t,e){var n=t.decorated_machine;n.render(n,e)},gl=function(t){Th(t.title,t.message)},vl=function(t){Oh()},bl=function(t){var e=t.decorated_machine;e.init(e)},yl=function(t){var e=t.decorated_machine;e.release(e)},xl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,l=$(),u=null,d=null,p=null,_=null,f=null,h=null,m=null,g=null,v=.001*V(),b=c.position;c.position.x+=-s.amplitude_x*s.angularspeed_x*Math.sin(s.initialphase_x+s.angularspeed_x*v)*l,c.position.y+=s.amplitude_y*s.angularspeed_y*Math.cos(s.initialphase_y+s.angularspeed_y*v)*l;var y=Cn(c,0,0,i,u,d,p,_,f,h,m,g);u=y.up,d=y.upright,p=y.right,_=y.downright,f=y.down,h=y.downleft,m=y.left,g=y.upleft;var x=Gn(c,0,u,d,p,_,f,h,m,g);u=x.up,d=x.upright,p=x.right,_=x.downright,f=x.down,h=x.downleft,m=x.left,g=x.upleft,null!=p&&c.position.x>b.x&&(c.position.x=c.hot_spot.x-Tn(c).width+p.x),null!=m&&c.position.x<b.x&&(c.position.x=c.hot_spot.x+m.x+mn(m).width),null!=f&&c.position.y>b.y&&(c.position.y=c.hot_spot.y-Tn(c).height+f.y),null!=u&&c.position.y<b.y&&(c.position.y=c.hot_spot.y+u.y+mn(u).height),r.update(r,e,n,i,a,o)},kl=function(t,e){var n=t.decorated_machine;n.render(n,e)},wl=function(t){var e=t.decorated_machine;e.init(e)},El=function(t){var e=t.decorated_machine;e.release(e)},Sl=function(t,e,n,i,a,o){for(var r=t.decorated_machine,s=t,c=t.get_object_instance(t),l=0;l<n;l++){var u=e[l];u&&Nn(c.actor,u.actor)&&(Ks(u)||u.invincible?(u.actor.is_jumping&&Qs(u),Eh(s.score),Bh(fs,ot(c.actor.position,at(0,-15))),Yh(c.actor.position),N(Ne("destroy")),c.state=vp):$s(u))}r&&r.update(r,e,n,i,a,o)},Ml=function(t,e){var n=t.decorated_machine;n.render(n,e)},jl=function(t){var e=t.decorated_machine;e.init(e)},Il=function(t){var e=t.decorated_machine;e.release(e)},Dl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;Dn(s,Un(s,i,Ch())),r.update(r,e,n,i,a,o)},Tl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ol=function(t,e){var n={init:Rl,release:Ll,update:Al,render:Nl,get_object_instance:ma},i=n;return i.decorated_machine=t,i.should_hit_the_player=e,n},Rl=function(t){var e=t.decorated_machine;e.init(e)},Ll=function(t){var e=t.decorated_machine;e.release(e)},Al=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));!c.invincible&&s.should_hit_the_player(c)&&$s(c),r.update(r,e,n,i,a,o)},Nl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Cl=function(t){return!0},Pl=function(t){return t.shield_type!=Ns&&t.shield_type!=Ps},Bl=function(t){return t.shield_type!=Cs},Gl=function(t){return t.shield_type!=Bs},Ul=function(t){var e=t.decorated_machine;e.init(e)},Hl=function(t){var e=t.decorated_machine;e.release(e)},Yl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;Cn(s,2,-4,i,null,null,null,null,null,null,null,null),Gn(s,-4,null,null,null,null,null,null,null,null),r.update(r,e,n,i,a,o)},Wl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xl=function(t){var e=t.decorated_machine,n=t,i=Math.abs(n.x2-n.x1),a=Math.abs(n.y2-n.y1);n.cute_image=Vl(i,a),n.has_locked_somebody=!1,e.init(e)},Fl=function(t){var e=t.decorated_machine;e.release(e)},zl=function(t,e,n,i,a,o){var r,s,c,l,u,d=t.decorated_machine,p=t,_=t.get_object_instance(t),f=Dp(_),h=_.actor;r=h.position.x+p.x1,s=h.position.y+p.y1,c=p.x2-p.x1,l=p.y2-p.y1;for(var m=0;m<n;m++)if(u=e[m].actor,e[m]!=f||null!=u.carrying)u.position.x>r-30&&u.position.x<r&&(u.position.x=r-30,u.speed.x=0),u.position.x>r+c&&u.position.x<r+c+30&&(u.position.x=r+c+30,u.speed.x=0);else{var g=[],v=[];g[0]=u.position.x,g[1]=u.position.y,g[2]=u.position.x+1,g[3]=u.position.y+1,v[0]=r,v[1]=s,v[2]=r+c,v[3]=s+l,tt(g,v)&&(p.has_locked_somebody=!0,e[m].in_locked_area=!0,Ah(r,s,r+c,s+l))}p.has_locked_somebody&&((u=f.actor).position.x<r&&(u.position.x=r,u.speed.x=Math.max(0,u.speed.x),f.at_some_border=!0),u.position.x>r+c&&(u.position.x=r+c,u.speed.x=Math.min(0,u.speed.x),f.at_some_border=!0),u.position.y=Math.min(u.position.y,s,s+l)),d.update(d,e,n,i,a,o)},$l=function(t,e){var n=t.decorated_machine;n.render(n,e)},Vl=function(t,e){var n=Ue(t,e);return Xe(255,0,0),n},Ql=function(t,e){var n={init:Kl,release:ql,update:Jl,render:Zl,get_object_instance:ma},i=n;return i.decorated_machine=t,i.look_strategy=e,n},Kl=function(t){var e=t.decorated_machine;e.init(e)},ql=function(t){var e=t.decorated_machine;e.release(e)},Jl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.look_strategy(s),r.update(r,e,n,i,a,o)},Zl=function(t,e){var n=t.decorated_machine;n.render(n,e)},tu=function(t){var e=t;e.get_object_instance(e).actor.mirror&=-2},eu=function(t){var e=t;e.get_object_instance(e).actor.mirror|=1},nu=function(t){var e=t,n=e.get_object_instance(e),i=Dp(n);i&&(n.actor.position.x<i.actor.position.x?n.actor.mirror&=-2:n.actor.mirror|=1)},iu=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=-2:n.actor.mirror|=1,t.old_x=n.actor.position.x},au=function(t){var e=t.decorated_machine;e.init(e)},ou=function(t){var e=t.decorated_machine;e.release(e)},ru=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),l=Dp(c);if(l){var u=rt(l.actor.position,c.actor.position);if(ct(u)>=5){var d=$(),p=ut(u),_=st(p,s.speed*d);c.actor.position=ot(c.actor.position,_)}}r.update(r,e,n,i,a,o)},su=function(t,e){var n=t.decorated_machine;n.render(n,e)},cu=function(t){var e=t.decorated_machine;e.init(e)},lu=function(t){var e=t.decorated_machine;e.release(e)},uu=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=$(),l=st(s.speed,c),u=Dp(t.get_object_instance(t));u.actor.position=ot(u.actor.position,l),r.update(r,e,n,i,a,o)},du=function(t,e){var n=t.decorated_machine;n.render(n,e)},pu=function(t,e){var n={init:fu,release:hu,update:mu,render:gu,get_object_instance:ma},i=n;return i.decorated_machine=t,i.strategy=e,n},_u=function(t,e,n){return{player_name:t,object:e,run:n}},fu=function(t){var e=t.decorated_machine;e.init(e)},hu=function(t){var e=t.decorated_machine;e.release(e)},mu=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy.run(s.strategy,e,n),r.update(r,e,n,i,a,o)},gu=function(t,e){var n=t.decorated_machine;n.render(n,e)},vu=function(t,e,n){Tp(t.object,null)},bu=function(t,e,n){Op(t.object)},yu=function(t,e,n){Rp(t.object)},xu=function(t,e,n){for(var i=Dp(t.object),a=0;a<n;a++)if(e[a]==i){Tp(t.object,e[(a+1)%n]);break}},ku=function(t,e,n){return wu(t,n,Iu(e))},wu=function(t,e,n){var i={init:Eu,release:Su,update:Mu,render:ju,get_object_instance:ma},a=i;return a.new_state_name=e,a.strategy=n,i},Eu=function(t){var e=t.decorated_machine;e.init(e)},Su=function(t){var e=t.decorated_machine;e.release(e)},Mu=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);s.strategy.should_trigger_event(s.strategy,c,e,n,i,a,o)?_a(c.vm,s.new_state_name):r.update(r,e,n,i,a,o)},ju=function(t,e){var n=t.decorated_machine;n.render(n,e)},Iu=function(t){var e={init:Du,release:Tu,should_trigger_event:Ou},n=e;return n.timeout=t,n.timer=0,e},Du=function(t){},Tu=function(t){},Ou=function(t,e,n,i,a,o,r){var s=t;return s.timer+=$(),s.timer>=s.timeout&&(s.timer=0,!0)},Ru=function(t){},Lu=function(t){},Au=function(t,e,n,i,a,o,r){for(var s=t,c=r;null!=c;c=c.next)if(c.data.name==s.target_name&&Nn(c.data.actor,e.actor))return!0;return!1},Nu=function(t){},Cu=function(t){},Pu=function(t,e,n,i,a,o,r){return Ln(e.actor)},Bu=function(t){},Gu=function(t){},Uu=function(t,e,n,i,a,o,r){return 1e5*t.probability>J(1e5)},Hu=function(t){},Yu=function(t){},Wu=function(t,e,n,i,a,o,r){var s=Dp(e);return Nn(e.actor,s.actor)},Xu=function(t){},Fu=function(t){},zu=function(t,e,n,i,a,o,r){var s=Dp(e);return Ks(s)&&Nn(e.actor,s.actor)},$u=function(t){},Vu=function(t){},Qu=function(t,e,n,i,a,o,r){var s=t,c=e.actor,l=Dp(e),u=l.actor,d=Tn(u),p=[],_=[];return p[0]=c.position.x+s.x1,p[1]=c.position.y+s.y1,p[2]=c.position.x+s.x2,p[3]=c.position.y+s.y2,_[0]=u.position.x-u.hot_spot.x,_[1]=u.position.y-u.hot_spot.y,_[2]=u.position.x-u.hot_spot.x+d.w,_[3]=u.position.y-u.hot_spot.y+d.h,!l.dying&&tt(p,_)},Ku=function(t){var e={init:qu,release:Ju,should_trigger_event:Zu};return e.shield_type=t,e},qu=function(t){},Ju=function(t){},Zu=function(t,e,n,i,a,o,r){var s=t;return Dp(e).shield_type==s.shield_type},td=function(t){},ed=function(t){},nd=function(t,e,n,i,a,o,r){var s=e.actor;Cn(s,1,0,a,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined)},id=function(t){},ad=function(t){},od=function(t,e,n,i,a,o,r){var s=e.actor;Cn(s,1,0,a,void 0,void 0,void 0,undefined,undefined,undefined,void 0,void 0)},rd=function(t){},sd=function(t){},cd=function(t,e,n,i,a,o,r){var s=e.actor;Cn(s,1,0,a,undefined,undefined,void 0,void 0,void 0,void 0,void 0,undefined)},ld=function(t){},ud=function(t){},dd=function(t,e,n,i,a,o,r){var s=e.actor;Cn(s,1,0,a,void 0,void 0,void 0,void 0,void 0,void 0,undefined,undefined)},pd=function(t){},_d=function(t){},fd=function(t,e,n,i,a,o,r){var s=e.actor;Cn(s,1,0,a,void 0,undefined,undefined,void 0,void 0,void 0,void 0,void 0)},hd=function(t,e){var n={init:md,release:gd,update:vd,render:bd,get_object_instance:ma},i=n;return i.decorated_machine=t,i.update=e,n},md=function(t){var e=t.decorated_machine;e.init(e)},gd=function(t){var e=t.decorated_machine;e.release(e)},vd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));s.update(c),r.update(r,e,n,i,a,o)},bd=function(t,e){var n=t.decorated_machine;n.render(n,e)},yd=function(t){t.spring=!0,t.spin=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},xd=function(t){t.spin=!0,t.spring=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},kd=function(t,e){var n={init:wd,release:Ed,update:Sd,render:Md,get_object_instance:ma},i=n;return i.decorated_machine=t,i.enable=e,n},wd=function(t){var e=t.decorated_machine;e.init(e)},Ed=function(t){var e=t.decorated_machine;e.release(e)},Sd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;Dp(t.get_object_instance(t)).disable_movement=!s.enable,r.update(r,e,n,i,a,o)},Md=function(t,e){var n=t.decorated_machine;n.render(n,e)},jd=function(t,e){var n={init:Id,release:Dd,update:Td,render:Od,get_object_instance:ma},i=n;return i.decorated_machine=t,i.alpha=Math.min(e,0,1),n},Id=function(t){var e=t.decorated_machine;e.init(e)},Dd=function(t){var e=t.decorated_machine;e.release(e)},Td=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;t.get_object_instance(t).actor.alpha=s.alpha,r.update(r,e,n,i,a,o)},Od=function(t,e){var n=t.decorated_machine;n.render(n,e)},Rd=function(t){var e=t.decorated_machine;e.init(e)},Ld=function(t){var e=t.decorated_machine;e.release(e)},Ad=function(t,e,n,i,a,o){var r=t.decorated_machine;Cd(t),r.update(r,e,n,i,a,o)},Nd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Cd=function(t){var e=t,n=t.get_object_instance(t);Rn(n.actor,e.anim)},Pd=function(t,e,n){var i={init:Bd,release:Gd,update:Ud,render:Hd,get_object_instance:ma},a=i;return a.decorated_machine=t,a.is_obstacle=e,a.angle=n,i},Bd=function(t){var e=t.decorated_machine;e.init(e)},Gd=function(t){var e=t.decorated_machine;e.release(e)},Ud=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);c.obstacle=s.is_obstacle,c.obstacle_angle=s.angle,r.update(r,e,n,i,a,o)},Hd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Yd=function(t){var e=t.decorated_machine;e.init(e)},Wd=function(t){var e=t.decorated_machine;e.release(e)},Xd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));Rn(c.actor,s.anim),r.update(r,e,n,i,a,o)},Fd=function(t,e){var n=t.decorated_machine;n.render(n,e)},zd=function(t){var e=t.decorated_machine;e.init(e)},$d=function(t){var e=t.decorated_machine;e.release(e)},Vd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);Dp(c).actor.position=ot(c.actor.position,s.offset),r.update(r,e,n,i,a,o)},Qd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Kd=function(t){var e=t.decorated_machine;e.init(e)},qd=function(t){var e=t.decorated_machine;e.release(e)},Jd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));s.strategy(c,s.speed),r.update(r,e,n,i,a,o)},Zd=function(t,e){var n=t.decorated_machine;n.render(n,e)},tp=function(t,e,n){var i={init:Kd,release:qd,update:Jd,render:Zd,get_object_instance:ma},a=i;return a.decorated_machine=t,a.speed=e,a.strategy=n,i},ep=function(t,e){t.actor.speed.x=e},np=function(t,e){t.actor.speed.y=e},ip=function(t){var e=t.decorated_machine;t.direction=0==J(2)?-1:1,e.init(e)},ap=function(t){var e=t.decorated_machine;e.release(e)},op=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,l=$(),u=null,d=null,p=null,_=null,f=null,h=null,m=null,g=null;c.position.x+=s.direction*s.speed*l;var v=Cn(c,2,-2,i,u,d,p,_,f,h,m,g);u=v.up,d=v.upright,p=v.right,_=v.downright,f=v.down,h=v.downleft,m=v.left,g=v.upleft;var b=Gn(c,-2,u,d,p,_,f,h,m,g);u=b.up,d=b.upright,p=b.right,_=b.downright,f=b.down,h=b.downleft,m=b.left,g=b.upleft,null!=p&&s.direction>0&&(c.position.x=c.hot_spot.x-Tn(c).width+p.x,s.direction=-1),null!=m&&s.direction<0&&(c.position.x=c.hot_spot.x+m.x+mn(m).width,s.direction=1),null!=f&&(null==_&&null!=h?s.direction=-1:null==h&&null!=_&&(s.direction=1)),r.update(r,e,n,i,a,o)},rp=function(t,e){var n=t.decorated_machine;n.render(n,e)},sp=0,cp={},lp=[{command:"set_animation",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=+n[1],(s=r={init:Rd,release:Ld,update:Ad,render:Nd,get_object_instance:ma}).decorated_machine=i,s.anim=qe(a,o),t=r):M("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){return 1==e?t=Pd(t,+n[0],0):2==e?t=Pd(t,+n[0],+n[1]):M("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]"),t}},{command:"set_alpha",action:function(t,e,n){return 1==e?t=jd(t,+n[0]):M("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))"),t}},{command:"hide",action:function(t,e,n){return 0==e?t=jd(t,0):M("Object script error - hide expects no parameters"),t}},{command:"show",action:function(t,e,n){return 0==e?t=jd(t,1):M("Object script error - show expects no parameters"),t}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:wl,release:El,update:Sl,render:Ml,get_object_instance:ma},i=n;return i.decorated_machine=t,i.score=e,n}(t,+n):M("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){var i,a,o,r,s,c,l;return 4==e?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],(l=c={init:Xl,release:Fl,update:zl,render:$l,get_object_instance:ma}).decorated_machine=i,l.x1=Math.min(a,r),l.y1=Math.min(o,s),l.x2=Math.max(a,r),l.y2=Math.max(o,s),t=c):M("Object script error - lock_camera expects four parameters: x1, y1, x2, y2"),t}},{command:"move_player",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:cu,release:lu,update:uu,render:du,get_object_instance:ma}).decorated_machine=i,s.speed=at(a,o),t=r):M("Object script error - move_player expects two parameters: speed_x, speed_y"),t}},{command:"hit_player",action:function(t,e,n){return 0==e?t=Ol(t,Cl):M("Object script error - hit_player expects no parameters"),t}},{command:"burn_player",action:function(t,e,n){return 0==e?t=Ol(t,Pl):M("Object script error - burn_player expects no parameters"),t}},{command:"shock_player",action:function(t,e,n){return 0==e?t=Ol(t,Bl):M("Object script error - shock_player expects no parameters"),t}},{command:"acid_player",action:function(t,e,n){return 0==e?t=Ol(t,Gl):M("Object script error - acid_player expects no parameters"),t}},{command:"add_rings",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:cc,release:lc,update:uc,render:dc,get_object_instance:ma},i=n;return i.decorated_machine=t,i.rings=e,n}(t,+n[0]):M("Object script error - add_rings expects one parameter: number_of_rings"),t}},{command:"add_to_score",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:pc,release:_c,update:fc,render:hc,get_object_instance:ma},i=n;return i.decorated_machine=t,i.score=e,n}(t,+n[0]):M("Object script error - add_to_score expects one parameter: score"),t}},{command:"set_player_animation",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=+n[1],(s=r={init:Yd,release:Wd,update:Xd,render:Fd,get_object_instance:ma}).decorated_machine=i,s.anim=qe(a,o),t=r):M("Object script error - set_player_animation expects two parameters: sprite_name, animation_id"),t}},{command:"enable_player_movement",action:function(t,e,n){return 0==e?t=kd(t,!0):M("Object script error - enable_player_movement expects no parameters"),t}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=kd(t,!1):M("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=tp(i,a,ep)):M("Object script error - set_player_xspeed expects one parameter: speed"),t}},{command:"set_player_yspeed",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=tp(i,a,np)):M("Object script error - set_player_yspeed expects one parameter: speed"),t}},{command:"set_player_position",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:zd,release:$d,update:Vd,render:Qd,get_object_instance:ma}).decorated_machine=i,s.offset=at(a,o),t=r):M("Object script error - set_player_position expects two parameters: xpos, ypos"),t}},{command:"bounce_player",action:function(t,e,n){var i;return 0==e?((i={init:Lc,release:Ac,update:Nc,render:Cc,get_object_instance:ma}).decorated_machine=t,t=i):M("Object script error - bounce_player expects no parameters"),t}},{command:"observe_player",action:function(t,e,n){var i,a,o;return 1==e?(i=t,a=n[0],o=i.get_object_instance(i),t=pu(i,_u(a,o,vu))):M("Object script error - observe_player expects one parameter: player_name"),t}},{command:"observe_current_player",action:function(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=pu(i,_u("foo",a,bu))):M("Object script error - observe_current_player expects no parameters"),t}},{command:"observe_active_player",action:function(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=pu(i,_u("bar",a,yu))):M("Object script error - observe_active_player expects no parameters"),t}},{command:"observe_all_players",action:fp},{command:"observe_next_player",action:fp},{command:"attach_to_player",action:function(t,e,n){return 0==e?t=mc(t,0,0):1==e?t=mc(t,+n[0],0):2==e?t=mc(t,+n[0],+n[1]):M("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]"),t}},{command:"springfy_player",action:function(t,e,n){return 0==e?t=hd(t,yd):M("Object script error - springfy_player expects no parameters"),t}},{command:"roll_player",action:function(t,e,n){return 0==e?t=hd(t,xd):M("Object script error - roll_player expects no parameters"),t}},{command:"walk",action:function(t,e,n){var i,a,o;return 1==e?(i=+n,(o=a={init:ip,release:ap,update:op,render:rp,get_object_instance:ma}).decorated_machine=t,o.speed=i,t=a):M("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var i;return 0==e?((i={init:jl,release:Il,update:Dl,render:Tl,get_object_instance:ma}).decorated_machine=t,t=i):M("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){var i,a,o,r;return 1==e?(i=t,a=+n[0],(r=o={init:Ul,release:Hl,update:Yl,render:Wl,get_object_instance:ma}).decorated_machine=i,r.jump_strength=a,t=o):M("Object script error - jump expects one parameter: jump_strength"),t}},{command:"move",action:hp},{command:"bullet_trajectory",action:hp},{command:"elliptical_trajectory",action:function(t,e,n){var i,a,o,r,s,c,l,u,d;return e>=4&&e<=6?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],c=+n[4],l=+n[5],(d=u={init:bl,release:yl,update:xl,render:kl,get_object_instance:ma}).decorated_machine=i,d.amplitude_x=a,d.amplitude_y=o,d.angularspeed_x=r*(2*h),d.angularspeed_y=s*(2*h),d.initialphase_x=c*h/180,d.initialphase_y=l*h/180,t=u):M("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var i,a,o;return 1==e?(i=+n,(o=a={init:au,release:ou,update:ru,render:su,get_object_instance:ma}).decorated_machine=t,o.speed=i,t=a):M("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){return 0==e?t=Ql(t,tu):M("Object script error - look_left expects no parameters"),t}},{command:"look_right",action:function(t,e,n){return 0==e?t=Ql(t,eu):M("Object script error - look_right expects no parameters"),t}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=Ql(t,nu):M("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=Ql(t,iu):M("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){var i,a,o,r,s,c;return 3==e?(i=t,a=+n[0],o=+n[1],r=+n[2],(c=s={init:al,release:ol,update:rl,render:sl,get_object_instance:ma}).decorated_machine=i,c.item_id=a,c.offset=at(o,r),t=s):M("Object script error - create_item expects three parameters: item_id, offset_x, offset_y"),t}},{command:"change_closest_object_state",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=n[1],(s=r={init:Hc,release:Yc,update:Wc,render:Xc,get_object_instance:ma}).decorated_machine=i,s.object_name=a,s.new_state_name=o,t=r):M("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name"),t}},{command:"create_child",action:function(t,e,n){return 3==e?t=zc(t,n[0],+n[1],+n[2],""):4==e?t=zc(t,n[0],+n[1],+n[2],n[3]):M("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]"),t}},{command:"change_child_state",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=n[1],(s=r={init:$c,release:Vc,update:Qc,render:Kc,get_object_instance:ma}).decorated_machine=i,s.strategy=Jc,s.offset=at(0,0),s.object_name=null,s.child_name=a,s.new_state_name=o,t=r):M("Object script error - change_child_state expects two parameters: child_name, new_state_name"),t}},{command:"change_parent_state",action:function(t,e,n){var i,a,o,r;return 1==e?(i=t,a=n[0],(r=o={init:$c,release:Vc,update:Qc,render:Kc,get_object_instance:ma}).decorated_machine=i,r.strategy=Zc,r.offset=at(0,0),r.object_name=null,r.child_name=null,r.new_state_name=a,t=o):M("Object script error - change_parent_state expects one parameter: new_state_name"),t}},{command:"destroy",action:function(t,e,n){var i;return 0==e?((i={init:cl,release:ll,update:ul,render:dl,get_object_instance:ma}).decorated_machine=t,t=i):M("Object script error - destroy expects no parameters"),t}},{command:"change_state",action:function(t,e,n){return 1==e?t=ku(t,0,n[0]):M("Object script error - change_state expects one parameter: new_state_name"),t}},{command:"on_timeout",action:function(t,e,n){return 2==e?t=ku(t,+n[0],n[1]):M("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name"),t}},{command:"on_collision",action:function(t,e,n){var i,a,o;return 2==e?(i=t,a=n[0],o=n[1],t=wu(i,o,function(t){var e={init:Ru,release:Lu,should_trigger_event:Au};return e.target_name=t,e}(a))):M("Object script error - on_collision expects two parameters: object_name, new_state_name"),t}},{command:"on_animation_finished",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:Nu,release:Cu,should_trigger_event:Pu})):M("Object script error - on_animation_finished expects one parameter: new_state_name"),t}},{command:"on_random_event",action:function(t,e,n){var i,a,o;return 2==e?(i=t,a=+n[0],o=n[1],t=wu(i,o,function(t){var e={init:Bu,release:Gu,should_trigger_event:Uu};return e.probability=Math.min(t,0,1),e}(a))):M("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name"),t}},{command:"on_player_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:Hu,release:Yu,should_trigger_event:Wu})):M("Object script error - on_player_collision expects one parameter: new_state_name"),t}},{command:"on_player_attack",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:Xu,release:Fu,should_trigger_event:zu})):M("Object script error - on_player_attack expects one parameter: new_state_name"),t}},{command:"on_player_rect_collision",action:function(t,e,n){var i,a,o,r,s,c;return 5==e?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],c=n[4],t=wu(i,c,function(t,e,n,i){var a={init:$u,release:Vu,should_trigger_event:Qu},o=a;return o.x1=Math.min(t,n),o.y1=Math.min(e,i),o.x2=Math.max(t,n),o.y2=Math.max(e,i),a}(a,o,r,s))):M("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name"),t}},{command:"on_no_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(0))):M("Object script error - on_no_shield expects one parameter: new_state_name"),t}},{command:"on_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(As))):M("Object script error - on_shield expects one parameter: new_state_name"),t}},{command:"on_fire_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(Ns))):M("Object script error - on_fire_shield expects one parameter: new_state_name"),t}},{command:"on_thunder_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(Cs))):M("Object script error - on_thunder_shield expects one parameter: new_state_name"),t}},{command:"on_water_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(Ps))):M("Object script error - on_water_shield expects one parameter: new_state_name"),t}},{command:"on_acid_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(Bs))):M("Object script error - on_acid_shield expects one parameter: new_state_name"),t}},{command:"on_wind_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,Ku(Gs))):M("Object script error - on_wind_shield expects one parameter: new_state_name"),t}},{command:"on_brick_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:td,release:ed,should_trigger_event:nd})):M("Object script error - on_brick_collision expects one parameter: new_state_name"),t}},{command:"on_floor_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:id,release:ad,should_trigger_event:od})):M("Object script error - on_floor_collision expects one parameter: new_state_name"),t}},{command:"on_ceiling_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:rd,release:sd,should_trigger_event:cd})):M("Object script error - on_ceiling_collision expects one parameter: new_state_name"),t}},{command:"on_left_wall_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:ld,release:ud,should_trigger_event:dd})):M("Object script error - on_left_wall_collision expects one parameter: new_state_name"),t}},{command:"on_right_wall_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=wu(i,a,{init:pd,release:_d,should_trigger_event:fd})):M("Object script error - on_right_wall_collision expects one parameter: new_state_name"),t}},{command:"show_dialog_box",action:function(t,e,n){return 2==e?t=function(t,e,n){return pl(t,e,n,gl)}(t,n[0],n[1]):M("Object script error - show_dialog_box expects two parameters: title, message"),t}},{command:"hide_dialog_box",action:function(t,e,n){return 0==e?t=pl(t,"dead","beef",vl):M("Object script error - hide_dialog_box expects no parameters"),t}},{command:"clear_level",action:function(t,e,n){var i;return 0==e?((i={init:tl,release:el,update:nl,render:il,get_object_instance:ma}).decorated_machine=t,t=i):M("Object script error - clear_level expects no parameters"),t}},{command:"play_sample",action:function(t,e,n){return 1==e?t=xc(t,n[0],1,0,1,!1):2==e?t=xc(t,n[0],+n[1],0,1,!1):3==e?t=xc(t,n[0],+n[1],+n[2],1,!1):4==e||5==e?t=xc(t,n[0],+n[1],+n[2],+n[3],!1):M("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]"),t}},{command:"play_music",action:function(t,e,n){var i,a;return 1==e||2==e?(i=t,a=n[0],t=Mc(i,Dc(a,!1))):M("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]"),t}},{command:"play_level_music",action:function(t,e,n){return 0==e?t=Mc(t,{update:Oc,mus:null,loop:!0}):M("Object script error - play_level_music expects no parameters"),t}},{command:"set_music_volume",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=Mc(i,function(t){return{update:Rc,vol:Z(t,0,1)}}(a))):M("Object script error - set_music_volume expects one parameter: volume"),t}},{command:null,action:null}],up=function(t,e){return function(t,e){var n,i,a,o=e;if(0===o.state){var r=t.state.name;for(o.state,o.vm.state_list=(i=o.vm,a=t.state.list,null==ha(i.state_list,a)&&(i.state_list=function(t,e,n){var i,a;return{name:e,data:(i=n,a={init:sa,release:ca,update:la,render:ua,get_object_instance:da},a.object=i,a),next:t}}(i.state_list,a,i.owner)),i.state_list),o.vm=_a(o.vm,r),n=pa(o.vm),sp=0,function(t,e){sp<1024?(cp[sp]={},cp[sp].stmt=t,cp[sp].machine=e,sp++):S("Object script error: you may write ".concat(1024," commands or less per state"))}(t.state.list,n);sp-- >0;)n=dp(cp[sp].stmt,cp[sp].machine);n&&n.init(n)}return o.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(o.preserve=!1),t.always_active&&(o.always_active=!0),t.hide_unless_in_editor_mode&&(o.hide_unless_in_editor_mode=!0),o}(e,t)};function dp(t,e){var n,i,a,o,r=t;for(i=r.length,n=0;n<i;n++)o=(a=r[n])[1]&&void 0!==a[1]?a[1].length?a[1].length:1:0,e=_p(e,a[0],o,a[1]);return e}function pp(t,e,n,i){return t(e,n,i)}function _p(t,e,n,i){for(var a=0,o=lp[a++];null!=o.command&&null!=o.action;)o.command==e&&(t=pp(o.action,t,n,i)),o=lp[a++];return t}function fp(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=pu(i,_u("boo",a,xu))):M("Object script error - observe_all_players expects no parameters"),t}function hp(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:Pc,release:Bc,update:Gc,render:Uc,get_object_instance:ma}).decorated_machine=i,s.speed=at(a,o),t=r):M("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}!function(t){t[t.ES_IDLE=0]="ES_IDLE",t[t.ES_DEAD=1]="ES_DEAD"}(xs||(xs={}));var mp,gp=xs.ES_IDLE,vp=xs.ES_DEAD,bp=null,yp=[],xp=function(t){return Lp(t)},kp=function(t){if(!t)return null;for(var e=t.children;e;e=e.next)e.data.parent=null;var n;return Cp(t.children),null!=t.parent&&Ip(t.parent,t),(n=t.vm).state_list=fa(n.state_list),n.reference_to_current_state=null,n.owner=null,Mn(t.actor),null},wp=function(t,e,n,i,a,o){if(t){var r=pa(t.vm);r.update(r,e,n,i,a,o)}},Ep=function(t,e){if(t){var n=pa(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&xh())&&n.render(n,e)}},Sp=function(t){return t.parent},Mp=function(t,e){return Gp(t.children,e)},jp=function(t,e,n){t.children=Pp(t.children,e,n),n.parent=t,n.created_from_editor=!1},Ip=function(t,e){t.children=Bp(t.children,e)},Dp=function(t){return null!=t.observed_player?t.observed_player:kh()},Tp=function(t,e){t.observed_player=e},Op=function(t){t.observed_player=kh()},Rp=function(t){t.observed_player=null},Lp=function(t){var e={in_object_name:null,out_object_block:null},n={name:t,state:gp,actor:Sn(),preserve:!0,obstacle:!1,obstacle_angle:0,always_active:!1,hide_unless_in_editor_mode:!1,vm:null,created_from_editor:!0,parent:null,children:Np(),observed_player:null};return n.actor.input=ue(),Rn(n.actor,qe("SD_QUESTIONMARK",0)),n.vm={owner:n,state_list:null,reference_to_current_state:null},e.in_object_name=t,e.out_object_block=null,e.out_object_block=Ap(bp,e),null!=e.out_object_block?n=up(n,e.out_object_block):S("Object ".concat(t," does not exist")),n},Ap=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(S("Object script error: unknown keyword ".concat(n)),0)},Np=function(){return null},Cp=function(t){return null!=t&&(Cp(t.next),t.name=null,t=null),null},Pp=function(t,e,n){return{name:e,data:n,next:t}},Bp=function(t,e){var n,i;if(null!=t){if(t.data==e)return i=t.next,t.name=null,t=null,i;for(n=t;null!=n.next&&n.next.data!=e;)n=n.next;return null!=n.next&&(i=n.next.next,n.next.name=null,n.next=null,n.next=i),t}return null},Gp=function(t,e){for(var n=t;null!=n;){if(n.name==e)return n.data;n=n.next}return null};!function(t){t[t.EDITORGRP_ENTITY_BRICK=0]="EDITORGRP_ENTITY_BRICK",t[t.EDITORGRP_ENTITY_ITEM=1]="EDITORGRP_ENTITY_ITEM",t[t.EDITORGRP_ENTITY_ENEMY=2]="EDITORGRP_ENTITY_ENEMY"}(mp||(mp={}));var Up,Hp,Yp=mp.EDITORGRP_ENTITY_BRICK,Wp=mp.EDITORGRP_ENTITY_ITEM,Xp=(mp.EDITORGRP_ENTITY_ENEMY,[]),Fp=0,zp=function(){return Fp},$p=function(t){return Fp>0?(t=Z(t,0,Fp-1),Xp[t]):null},Vp=function(t){return null!=t&&(t.next=Vp(t.next),t=null,t=null),t};!function(t){t[t.EDT_BRICK=1]="EDT_BRICK",t[t.EDT_ITEM=2]="EDT_ITEM",t[t.EDT_ENEMY=3]="EDT_ENEMY",t[t.EDT_GROUP=4]="EDT_GROUP"}(Up||(Up={})),function(t){t[t.EDA_NEWOBJECT=1]="EDA_NEWOBJECT",t[t.EDA_DELETEOBJECT=2]="EDA_DELETEOBJECT",t[t.EDA_CHANGESPAWN=3]="EDA_CHANGESPAWN",t[t.EDA_RESTORESPAWN=4]="EDA_RESTORESPAWN"}(Hp||(Hp={}));var Qp,Kp,qp,Jp,Zp,t_,e_,n_,i_,a_,o_,r_,s_,c_,l_,u_,d_,p_,__,f_,h_,m_,g_,v_,b_,y_,x_,k_,w_,E_,S_,M_,j_,I_,D_,T_,O_,R_,L_,A_,N_,C_,P_,B_,G_,U_,H_,Y_,W_,X_,F_,z_,$_,V_,Q_,K_,q_,J_,Z_,tf,ef,nf,af,of,rf,sf,cf,lf,uf,df,pf,_f,ff=Up.EDT_BRICK,hf=Up.EDT_ITEM,mf=Up.EDT_ENEMY,gf=Up.EDT_GROUP,vf=Hp.EDA_NEWOBJECT,bf=Hp.EDA_DELETEOBJECT,yf=Hp.EDA_CHANGESPAWN,xf=Hp.EDA_RESTORESPAWN,kf=function(t){return t==Yp?ff:t==Wp?hf:mf},wf=!1,Ef=[38,40,39,37,78,66,17,123],Sf=[87,83,68,65,90,89,71,80],Mf=0,jf=0,If=[0,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,hs,ms,28,29,30,gs,32,33,34,vs,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],Df=!1,Tf=at(0,0),Of=function(){return wf},Rf=function(){var t=hh();mh(t),N(Ne("level saved"))},Lf=function(){var t,e=$();t=fe(Zp,Ft)?3750:750,(fe(Zp,Gt)||fe(t_,Gt))&&(e_.y-=t*e),(fe(Zp,Ut)||fe(t_,Ut))&&(e_.y+=t*e),(fe(Zp,Ht)||fe(t_,Ht))&&(e_.x-=t*e),(fe(Zp,Yt)||fe(t_,Yt))&&(e_.x+=t*e),e_.x=~~Math.max(e_.x,240),e_.y=~~Math.max(e_.y,135.5),oa(e_)},Af=function(t){switch(t){case ff:return"brick";case hf:return"built-in item";case mf:return"object";case gf:return"group"}return"unknown"},Nf=function(t,e){switch(t){case ff:_n(e);break;case hf:Es(e)}return""},Cf=function(){Mf=0,jf=0,(i_=i_==ff?hf:i_==hf?mf:i_==mf?gf:i_==gf?ff:i_)==gf&&0==zp()&&Cf()},Pf=function(){Mf=0,jf=0,(i_=i_==hf?ff:i_==mf?hf:i_==gf?mf:i_==ff?gf:i_)==gf&&0==zp()&&Pf()},Bf=function(){var t;switch(i_){case ff:t=fn(),null==_n(Mf=(Mf+1)%t)&&Bf();break;case hf:Mf=If[jf=(jf+1)%(t=r_)];break;case mf:Mf=(Mf+1)%(t=c_);break;case gf:t=zp(),Mf=(Mf+1)%t}},Gf=function(){var t;switch(i_){case ff:t=fn(),null==_n(Mf=(Mf-1+t)%t)&&Gf();break;case hf:Mf=If[jf=(jf-1+(t=r_))%t];break;case mf:Mf=(Mf-1+(t=c_))%t;break;case gf:t=zp(),Mf=(Mf-1+t)%t}},Uf=function(t){var e;for(e=0;e<r_;e++)if(t==If[e])return e;return-1},Hf=function(t,e,n){var i=null,a=at(0,0);switch(t){case ff:null!=_n(e)&&(i=_n(e).image);break;case hf:null!=(r=Es(e))&&(i=Tn(r.actor),(a=r.actor.hot_spot).y-=2);break;case mf:var o=xp(Wf(e));null!=o&&(i=Tn(o.actor),(a=o.actor.hot_spot).y-=2,kp(o));break;case gf:var r=void 0;for(r=$p(e);r;r=r.next){var s=kf(r.entity.type);Hf(s,r.entity.id,ot(n,r.entity.position))}}null!=i&&Ye(i.data,Mt(),i.sx,i.sy,~~n.x-a.x,~~n.y-a.y,i.swidth,i.sheight)},Yf=function(t){var e;for(e=0;e<c_;e++)if(t==s_[e])return e;return-1},Wf=function(t){return t=Z(t,0,NaN),s_[t]},Xf=function(){Df=!1},Ff=function(){},zf=function(){he(t_,Ft)&&(Df=!Df)},$f=function(t){var e=rt(e_,at(240,135.5)),n=~~(e.x%1),i=~~(e.y%1),a=-n+t.x/1*1,o=-i+t.y/1*1;return ot(e,at(a,o))},Vf=function(t,e,n,i){return{type:t?vf:bf,obj_type:e,obj_id:n,obj_position:i,obj_old_position:i}},Qf=function(t,e,n){return{type:t?yf:xf,obj_type:null,obj_id:null,obj_position:e,obj_old_position:n}},Kf=function(){u_=Jf(u_),l_=null,d_=null},qf=function(t){var e,n=!1;if(t.obj_type!=gf){var i=void 0,a=void 0,o={action:t,in_group:n,group_key:null,prev:null,next:null};for(o.in_group&&(o.group_key=e),null!=(i=d_)&&(i.next=Jf(i.next)),a=l_;null!=a.next;)a=a.next;a.next=o,o.prev=a,o.next=null,d_=o}else{var r=48879;for(a=void 0,n=!0,e=r++,a=$p(t.obj_id);a;a=a.next){var s,c=a.entity,l=kf(c.type);s=Vf(!0,l,c.id,ot(c.position,t.obj_position)),qf(s)}n=!1}},Jf=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},Zf=function(){var t,e;d_!=u_&&(t=d_,d_=d_.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&Zf(),(e=t.action).type=e.type==vf?bf:e.type==bf?vf:e.type==yf?xf:e.type==xf?yf:e.type,eh(e))},th=function(){var t,e;null!=d_.next&&((t=d_=d_.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&th(),e=t.action,eh(e))},eh=function(t){if(t.type==vf)switch(t.obj_type){case ff:Ph(t.obj_id,t.obj_position);break;case hf:Bh(t.obj_id,t.obj_position);break;case mf:Gh(Wf(t.obj_id),t.obj_position);break;case gf:var e=void 0;for(e=$p(t.obj_id);e;e=e.next){var n,i=e.entity,a=kf(i.type);n=Vf(!0,a,i.id,ot(i.position,t.obj_position)),eh(n)}}else if(t.type==bf)switch(t.obj_type){case ff:e=void 0;var o=_n(t.obj_id);for(e=p_;e;e=e.next)e.data.brick_ref==o&&ct(rt(at(e.data.x,e.data.y),t.obj_position))<d&&(e.data.state=1);break;case hf:e=void 0;var r=t.obj_id;for(e=__;e;e=e.next)e.data.type==r&&ct(rt(e.data.actor.position,t.obj_position))<d&&(e.data.state=ws);break;case mf:for(e=void 0,r=t.obj_id,e=f_;e;e=e.next)Yf(e.data.name)==r&&ct(rt(e.data.actor.position,t.obj_position))<d&&(e.data.state=vp)}else t.type==yf?(jh(t.obj_position),zh()):t.type==xf&&(jh(t.obj_old_position),zh())},nh=function(t,e){oh(t,e,!0),jn(t.actor,e),oh(t,e,!1)},ih=function(t){return 1==t.state},ah=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&Nn(t.actor,e[n].actor))return!(!Ks(e[n])&&!e[n].invincible&&($s(e[n]),1));return!1},oh=function(t,e,n){var i=t.actor,a=.001*V();if(3===t.type){var o=void 0,r=at(0,0);if(Je(qe("SD_INVSTAR",0),1),1!=t.state)for(o=0;o<5;o++)r.x=i.position.x+20*Math.cos(2*h*a+2*o*h/5),r.y=i.position.y+20*Math.sin(h*a+2*o*h/5)}},rh=[0,1,2],sh=dt,ch="data/levels/blue_ocean_1.json",lh={position:at(0,0)},uh=[],dh=[],ph=[],_h=[],fh=function(t){ch=t,S("level_setfile('#{level}')")},hh=function(){return ch},mh=function(t){var e,n,i,a,o,r={name:h_,act:y_,theme:g_,bgtheme:v_,grouptheme:b_,spawn_point:D_,music:m_,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};wm()&&(r.boss={id:B_.type,x:B_.actor.spawn_point.x,y:B_.actor.spawn_point.y,rx:B_.rect_x,ry:B_.rect_y,rw:B_.rect_w,rh:B_.rect_h});var s=[];for(i=S_;i;i=i.next)s.push({id:Vh(i.data),xpos:i.data.x,ypos:i.data.y});r.bricklist=s;var c=[];for(a=M_;a;a=a.next)a.data&&c.push({id:a.data.type,xpos:a.data.actor.spawn_point.x,ypos:a.data.actor.spawn_point.y});r.itemlist=c;var l=[];for(o=j_;o;o=o.next)o.data&&o.data.created_from_editor&&l.push({id:o.data.name,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y});r.enemylist=l;var u=[];for(e=0,n=_h.length;e<n;e++)u.push({xpos:_h[e].rect_x,ypos:_h[e].rect_y,width:_h[e].rect_w,height:_h[e].rect_h,title:_h[e].title,message:_h[e].message});r.dialogbox=u;var d=t.split("/");d=d[d.length-1],S("level_save() ok")},gh=function(){var t;sh=dt,S("level_init()"),S_=null,M_=null,N_=[],x_=800,k_=w_=0,E_=0,pf=0,X_=!1,R_=!1,L_="",F_=z_=$_=0,q_=J_=Z_=0,V_=Q_=!1,K_=!1,A_=null,em(),S("editor_init()"),p_=Xh(),wf=!1,r_=If.length,i_=ff,Mf=0,Qp=jt(),Kp=It(),s_=yp,qp=He("data/images/editorbg.png"),Zp=de(Ef),t_=de(Sf),Jp=function(){for(var t={type:Bt.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return xe(t),t}(),a_=$n(8),o_=$n(8),e_=aa(),function(){Fp=0;for(var t=0;t<501;t++)Xp[t]=null}(),Xf(),S("editor_init() ok"),Em(ch).then((function(){S("Creating players...");for(var e=0;e<rh.length;e++)N_[e]=Ys(rh[e]);for(cm(),C_=N_[P_=0],na.is_locked=!1,na.speed=0,na.region_topleft_speed=0,na.region_bottomright_speed=0,na.position=na.dest=at(0,0),na.region_topleft.x=na.dest_region_topleft.x=240,na.region_topleft.y=na.dest_region_topleft.y=135.5,na.region_bottomright.x=na.dest_region_bottomright.x=Sh().x-240,na.region_bottomright.y=na.dest_region_bottomright.y=Sh().y-135.5,oa(at(C_.actor.position.x,C_.actor.position.y)),xm(C_.actor),tc(0),G_=!1,U_=!1,S("Loading hud..."),(H_=Sn()).position=at(16,7),Rn(H_,qe("SD_MAINGUI",0)),(Y_=Sn()).position=at(16,248),Rn(Y_,qe("SD_LIFEGUI",0)),(W_=$n(0)).position=ot(Y_.position,at(32,11)),t=0;t<3;t++)uh[t]=$n(2),uh[t].position=ot(H_.position,at(42,16*t+2));for((af=Sn()).position=at(0,-240),Rn(af,qe("SD_LEVELOP",0)),(of=Sn()).position=at(260,250),Rn(of,qe("SD_LEVELACT",y_-1)),(rf=$n(3)).position=at(330,50),Qn(rf,"%s",h_.toUpperCase()),Jn(rf,180),tf=$n(4),ef=$n(7),nf=Sn(),t=0;t<3;t++)dh[t]=$n(2),ph[t]=Sn();sf=!1,cf=0,(lf=Sn()).position.y=pt,Rn(lf,qe("SD_DIALOGBOX",0)),uf=$n(8),df=$n(8)}))},vh=function(){var t,e;E_+=$();var n,i,a,o,r,s,c,l,u,_,f=!1,m=!1,g=!1,v=$();if(vm(),mm(),gm(),Of())!function(){p_||(p_=Xh());var t,e,n=Je(qe("SD_ARROW",0),0),i=qn(a_).x,a=qn(a_).y,o=rt(e_,at(240,135.5));if(fe(Zp,Ft)&&he(Zp,zt)&&Rf(),fe(Zp,zt))return S("editor_disable()"),Kf(),wf=!1,Rt(Qp,Kp,Dt()),void S("editor_disable() ok");if(fe(Zp,Ft)?((he(Zp,Wt)||he(Jp,Ut))&&Cf(),(he(Zp,Xt)||he(Jp,Gt))&&Pf()):((he(Zp,Wt)||he(Jp,Ut))&&Bf(),(he(Zp,Xt)||he(Jp,Gt))&&Gf()),n_.x=Z(ye(Jp).x,0,dt-n.width),n_.y=Z(ye(Jp).y,0,pt-n.height),he(Jp,Wt)&&fe(Zp,Ft)){var r=$f(n_),s=Qf(!0,r,Tf);eh(s),qf(s)}if(he(Jp,Wt)&&!fe(Zp,Ft)&&(s=Vf(!0,i_,Mf,$f(n_)),eh(s),qf(s)),t=he(Jp,Ft),e=he(Jp,Xt),t||e){var c=void 0,l=void 0,u=void 0;switch(i_){case ff:for(c=p_;c;c=c.next){var d=[c.data.x,c.data.y,c.data.x+c.data.brick_ref.image.width,c.data.y+c.data.brick_ref.image.height],p=[n_.x+o.x,n_.y+o.y,n_.x+o.x+1,n_.y+o.y+1];if(tt(d,p)){if(!t){s=Vf(!1,ff,Fh(c.data),at(c.data.x,c.data.y)),eh(s),qf(s);break}Mf=Fh(c.data)}}break;case hf:for(l=__;l;l=l.next)if(d=[l.data.actor.position.x-l.data.actor.hot_spot.x,l.data.actor.position.y-l.data.actor.hot_spot.y,l.data.actor.position.x-l.data.actor.hot_spot.x+Tn(l.data.actor).width,l.data.actor.position.y-l.data.actor.hot_spot.y+Tn(l.data.actor).height],p=[n_.x+o.x,n_.y+o.y,n_.x+o.x+1,n_.y+o.y+1],tt(d,p)){if(!t){s=Vf(!1,hf,l.data.type,l.data.actor.position),eh(s),qf(s);break}var _=Uf(l.data.type);_>=0&&(jf=_,Mf=If[_])}break;case mf:for(u=f_;u;u=u.next){d=[u.data.actor.position.x-u.data.actor.hot_spot.x,u.data.actor.position.y-u.data.actor.hot_spot.y,u.data.actor.position.x-u.data.actor.hot_spot.x+Tn(u.data.actor).width,u.data.actor.position.y-u.data.actor.hot_spot.y+Tn(u.data.actor).height],p=[n_.x+o.x,n_.y+o.y,n_.x+o.x+1,n_.y+o.y+1];var f=Yf(u.data.name);if(f>=0&&tt(d,p)){if(!t){s=Vf(!1,mf,f,u.data.actor.position),eh(s),qf(s);break}Mf=f}}}}fe(Zp,Ft)&&(he(t_,Wt)?Zf():he(t_,Xt)&&th()),zf(),Lf(),Qn(a_,"%d,%d",$f(n_).x,$f(n_).y),a_.position.x=Z(~~n_.x,10,dt-i*Kn(a_).length-10),a_.position.y=Z(~~n_.y-3*a,10,261),o_.position=at(10,10),i_!=mf?Qn(o_,"<color=ffff00>%s %d</color>\n%s",Af(i_),Mf,Nf(i_,Mf)):Qn(o_,'<color=ffff00>%s "%s"</color>\n%s',Af(i_),Wf(Mf),Nf(i_,Mf))}();else{for(g=E_<5,t=0;t<N_.length&&!g;t++)N_[t]&&(g=N_[t].dead);if(C_&&C_.actor&&he(C_.actor.input,zt)&&!g){var b=[];return T_.pause(),b[0]=je("CBOX_QUIT_QUESTION"),b[1]=je("CBOX_QUIT_OPTION1"),b[2]=je("CBOX_QUIT_OPTION2"),l=b[0],u=b[1],_=b[2],_i=-1,ui=l,di[0]=u,_?(di[1]=_,pi=2):pi=1,void Oe(dy(oy))}if(1==(e=xi())?R_=!0:2==e&&D(T_,!0),R_)return xt()?(Re(),void gg()):void yt(Xe(0,0,0),1);if(he(Zp,$t))return S("editor_enable()"),l_=u_={action:null,in_group:!1,group_key:null,prev:null,next:null},d_=u_,wf=!0,e_.x=~~aa().x,e_.y=~~aa().y,n_=at(240,135.5),Qp=jt(),Kp=It(),Rt(3,!1,Dt()),void S("editor_enable() ok");for(m=E_<5,t=0;t<N_.length&&!m;t++)m=N_[t].dying||N_[t].dead;if(C_&&he(C_.actor.input,Ft)&&!m)return C_.spin_dash=C_.braking=!1,null==j||j.paused||j.pause(),void Oe(dy(Zb));Rn(H_,qe("SD_MAINGUI",qs()>0?0:1)),Rn(Y_,qe("SD_LIFEGUI",P_)),Qn(W_,"%d",Js()),Qn(uh[0],"%d",Zs());var y=~~(E_/60),x=~~(E_%60),k=x<10?"0"+x:x;if(Qn(uh[1],"%s",y+":"+k),Qn(uh[2],"%d",qs()),af&&(E_<5?E_<1.5?(af.position.y+=360*v,af.position.y>-2&&(af.position.y=-2),rf.position.x-=320*v,rf.position.x<140&&(rf.position.x=140),of.position.y-=200*v,of.position.y<200&&(of.position.y=200)):E_>3.5&&(af.position.x-=320*v):(af.visible=!1,rf.visible=!1,of.visible=!1)),X_){var w=0,E=V(),M=Ne("ring count"),I=Ne("cash"),L=Ne("glasses");if(E>=F_+2e3){for(t=0;t<N_.length;t++)N_[t]&&(N_[t].actor.speed.x=0);for(tf.position.x=Math.min(tf.position.x+800*v,30),ef.position.x=Math.min(ef.position.x+700*v,12),nf.position.x=Math.max(nf.position.x-700*v,250),t=0;t<3;t++)ph[t].position.x=Math.min(ph[t].position.x+(400-50*t)*v,50),dh[t].position.x=Math.max(dh[t].position.x-(400-50*t)*v,230);w=Z_-(q_+J_),Qn(dh[0],"%d",~~q_),Qn(dh[1],"%d",~~J_),Qn(dh[2],"%d",~~w),K_||(T(),N(Ne("goal")),K_=!0)}if(E>=F_+6e3&&!V_)if(q_=Math.max(0,q_-400*v),J_=Math.max(0,J_-2e3*v),q_>0||J_>0)M&&E>=$_&&($_=E+100,N(M));else for(V_=!0,z_=E+4e3,N(I),t=0;t<N_.length;t++)if(N_[t].got_glasses){N(L);break}V_&&E>=z_&&(Q_=!0)}for(rm(),om(),f=!1,t=0;t<N_.length;t++)N_[t].dying&&(f=!0);for(r=fm(),n=pm(),i=null,Ei(A_),s=M_;s;s=s.next)if(s.data&&s.data.actor){var A=s.data.actor.position.x,C=s.data.actor.position.y,P=Tn(s.data.actor).width,B=Tn(s.data.actor).height;if(km(A,C,P,B,sh)){if(Ss(s.data,N_,3,n,M_,j_),s.data.obstacle){var G=1,U=ot(s.data.actor.hot_spot,at(0,-G)),H=Tn(s.data.actor);(Y=lm(H.width,H.height-G,rt(s.data.actor.position,U),0)).brick_ref.zindex=s.data.bring_to_back?.4:.5,i={next:i,data:Y},n={next:n,data:Y}}}else s.data.preserve||(s.data.state=ws)}for(c=j_;c;c=c.next)if(c.data)if(A=c.data.actor.position.x,C=c.data.actor.position.y,P=Tn(c.data.actor).width,B=Tn(c.data.actor).height,km(A,C,P,B,sh)||c.data.always_active){if(C_&&C_.actor&&C_.actor.input.enabled&&(f||X_||wp(c.data,N_,N_.length,n,r,j_)),c.data.obstacle){var Y;G=1,U=ot(c.data.actor.hot_spot,at(0,-G)),H=Tn(c.data.actor),i={next:i,data:Y=lm(H.width,H.height-G,rt(c.data.actor.position,U),c.data.obstacle_angle)},n={next:n,data:Y}}}else c.data.preserve?km(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y,P,B,sh)||(c.data.actor.position=at(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y)):c.data.state=vp;if(wm()&&C_&&C_.actor){var W,X=[(W=C_.actor).position.x,W.position.y,W.position.x+1,W.position.y+1],F=[B_.rect_x,B_.rect_y,B_.rect_x+B_.rect_w,B_.rect_y+B_.rect_h];if(f||function(t,e,n){var i=t.actor,a=null,o=null,r=null,s=null,c=null,l=null,u=null,d=null,p=[],_=Cn(i,2,-2,n,a,o,r,s,c,l,u,d);a=_.up,o=_.upright,r=_.right,s=_.downright,c=_.down,l=_.downleft,u=_.left,d=_.upleft;var f=Gn(i,-2,a,o,r,s,c,l,u,d);if(a=f.up,o=f.upright,r=f.right,s=f.downright,c=f.down,l=f.downleft,u=f.left,d=f.upleft,p[0]=a,p[1]=o,p[2]=r,p[3]=s,p[4]=c,p[5]=l,p[6]=u,p[7]=d,Rh())switch(t.hp<=0&&1!=t.state&&(Lh(),t.state=1),t.type){case 0:!function(t,e,n,i){var a=kh(),o=.001*V(),r=t.actor,s=t.value[0],c=t.value[1];if(1==t.state){if(t.bring_to_front=!0,Rn(r,qe("SD_SIMPLEBOSS",2)),r.position.y+=100*$(),o>=c+.15){var l=at(r.position.x-r.hot_spot.x+J(Tn(r).width),r.position.y-r.hot_spot.y+J(Tn(r).height));Bh(fs,l),r.position.y<=r.spawn_point.y+406.5&&N(Ne("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?ge(r.input,Yt):3==t.direction&&ge(r.input,Ht),r.position.y=r.spawn_point.y+20*Math.cos(h*o),r.mirror=1==t.direction?0:1,Dn(r,Hn(r)),o>=s+2/t.initial_hp*t.hp&&(Gh(["0","3"][J(2)],r.position).actor.speed.y=-150-J(50),s=o),ah(t,e)&&r.animation==qe("SD_SIMPLEBOSS",0)&&(Rn(r,qe("SD_SIMPLEBOSS",1)),N(Ne("boss hit")),a.actor.speed.x*=-1,a.actor.speed.y=100,t.hp--),Ln(r)&&Rn(r,qe("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c}(t,e);break;case 1:!function(t,e,n,i){var a,o=kh(),r=t.actor,s=.001*V(),c=$(),l=t.value[0],u=t.value[1],d=t.value[2];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(h*s),Ln(r)&&Rn(r,qe("SD_MECHASHADOW",0)),s>=l+5){var p,_=at(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);_=st(ut(_),200),p=Bh(40,r.position),ro(p,_),N(Ne("big shot")),l=s}if(s>=u+15){var f=t.rect_x+t.rect_w/2;t.direction=r.position.x>f?3:1,Rn(r,qe("SD_MECHASHADOW",2)),t.state=2,u=s}break;case 2:var m=t.rect_x+100,g=t.rect_x+t.rect_w-100,v=g-m+(r.position.x-m),b=3==t.direction?-1:1;r.position.x+=200*b*c,r.position.y=r.spawn_point.y-100*Math.sin(h/(g-m)*v),Ln(r)&&Rn(r,qe("SD_MECHASHADOW",2)),(-1==b&&r.position.x<=m||1==b&&r.position.x>=g)&&(Rn(r,qe("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Rn(r,qe("SD_MECHASHADOW",4)),r.position.y+=100*$(),s>=d+.15){var y=at(r.position.x-r.hot_spot.x+J(Tn(r).width),r.position.y-r.hot_spot.y+J(Tn(r).height));Bh(fs,y),r.position.y<=r.spawn_point.y+406.5&&N(Ne("boss hit")),d=s}}a=r.animation==qe("SD_MECHASHADOW",1)||r.animation==qe("SD_MECHASHADOW",3),ah(t,e)&&!a&&1!=t.state&&(r.animation=qe("SD_MECHASHADOW",2==t.state?3:1),N(Ne("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:1}(t,e);break;case 2:!function(t,e,n,i){var a=kh(),o=.001*V(),r=t.actor,s=t.value[0],c=t.value[1],l=t.value[2];if(1==t.state){if(t.bring_to_front=!0,Rn(r,qe("SD_SIMPLEBOSS",2)),r.position.y+=100*$(),o>=c+.15){var u=at(r.position.x-r.hot_spot.x+J(Tn(r).width),r.position.y-r.hot_spot.y+J(Tn(r).height));Bh(fs,u),r.position.y<=r.spawn_point.y+406.5&&N(Ne("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?ge(r.input,Yt):3==t.direction&&ge(r.input,Ht),r.position.y=r.spawn_point.y+20*Math.cos(h*o),r.mirror=1==t.direction?0:1,Dn(r,Hn(r)),o>=s+2/t.initial_hp*t.hp&&(Gh(["9","6"][J(2)],r.position).actor.speed.y=-150-J(50),s=o),o>=l+3/t.initial_hp*t.hp&&(Bh(41,r.position).actor.speed.y=100,N(Ne("fire")),l=o),ah(t,e)&&r.animation==qe("SD_SIMPLEBOSS",0)&&(Rn(r,qe("SD_SIMPLEBOSS",1)),N(Ne("boss hit")),a.actor.speed.x*=-1,a.actor.speed.y=100,t.hp--),Ln(r)&&Rn(r,qe("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c,t.value[2]=l}(t,e);break;case 3:!function(t,e,n,i){var a,o=kh(),r=t.actor,s=.001*V(),c=$(),l=t.value[0],u=t.value[1],d=t.value[2],p=t.value[3];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(h*s),Ln(r)&&Rn(r,qe("SD_MECHASHADOW",0)),s>=l+4){var _,f=at(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);f=st(ut(f),200),_=Bh(40,r.position),ro(_,f),N(Ne("big shot")),l=s}if(s>=u+8){var m=t.rect_x+t.rect_w/2;t.direction=r.position.x>m?3:1,Rn(r,qe("SD_MECHASHADOW",2)),t.state=2,u=s}break;case 2:var g=t.rect_x+100,v=t.rect_x+t.rect_w-100,b=v-g+(r.position.x-g),y=3==t.direction?-1:1;r.position.x+=200*y*c,r.position.y=r.spawn_point.y-100*Math.sin(h/(v-g)*b),s>=p+.2&&(Bh(41,r.position).actor.speed.y=-200,N(Ne("fire")),p=s),Ln(r)&&Rn(r,qe("SD_MECHASHADOW",2)),(-1==y&&r.position.x<=g||1==y&&r.position.x>=v)&&(Rn(r,qe("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Rn(r,qe("SD_MECHASHADOW",4)),r.position.y+=100*$(),s>=d+.15){var x=at(r.position.x-r.hot_spot.x+J(Tn(r).width),r.position.y-r.hot_spot.y+J(Tn(r).height));Bh(fs,x),r.position.y<=r.spawn_point.y+406.5&&N(Ne("boss hit")),d=s}}a=r.animation==qe("SD_MECHASHADOW",1)||r.animation==qe("SD_MECHASHADOW",3),ah(t,e)&&!a&&1!=t.state&&(r.animation=qe("SD_MECHASHADOW",2==t.state?3:1),N(Ne("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:1,t.value[0]=l,t.value[1]=u,t.value[2]=d,t.value[3]=p}(t,e)}}(B_,N_,S_),!ih(B_)&&tt(X,F)&&(G_=!0,U_=!0),!ih(B_)){var z=void 0;for(t=0;t<N_.length;t++)(N_[t]!=C_||C_.actor.carrying)&&((z=N_[t].actor).position.x>B_.rect_x-30&&z.position.x<B_.rect_x&&(z.position.x=B_.rect_x-30,z.speed.x=0),z.position.x>B_.rect_x+B_.rect_w&&z.position.x<B_.rect_x+B_.rect_w+30&&(z.position.x=B_.rect_x+B_.rect_w+30,z.speed.x=0))}(ih(B_)||C_.dying)&&(G_=!1,T_&&(O(R()-.5*v),R()<d&&(T(),O(1),O_=!0)))}for(t=0;t<N_.length;t++)ve(N_[t].actor.input);for(C_&&C_.actor&&E_>=3.5&&be(C_.actor.input),t=0;t<N_.length;t++){A=N_[t].actor.position.x,C=N_[t].actor.position.y,P=Tn(N_[t].actor).width,B=Tn(N_[t].actor).height;var Q=N_[t].actor.hot_spot.y;if(t!=P_&&(N_[t].getting_hit&&sm(t),N_[t].dying&&(sm(t),lh!=N_[t].actor&&ia(N_[t].actor.position,0))),N_[t].dead){if(!(Js()>1))return Re(),void Oe(dy(ty));if(xt())return ec(Js()-1),void Qh();yt(Xe(0,0,0),1)}if(Q_){if(xt())return void Re();yt(Xe(0,0,0),1)}(km(A,C,P,B,sh/4)||N_[t].dying)&&(!f||N_[t].dying||N_[t].getting_hit)&&Xs(N_[t],N_,n),N_[t].actor.position.y<Q&&!N_[t].dying?(N_[t].actor.position.y=Q,N_[t].actor.speed.y=0):N_[t].actor.position.y>w_-(B-Q)&&km(A,C,P,B,sh/4)&&Vs(N_[t])}for(f||X_||(E_+=$()/1e3,C_&&he(C_.actor.input,Xt)&&(!(Math.abs(C_.actor.speed.y)<d)||C_.on_moveable_platform||G_||C_.disable_movement||C_.in_locked_area?N(Ne("deny")):sm((P_+1)%3))),wm()&&G_&&(W=C_.actor)&&(W.position.x<B_.rect_x?(W.position.x=B_.rect_x,W.speed.x=Math.max(0,W.speed.x)):W.position.x>B_.rect_x+B_.rect_w&&(W.position.x=B_.rect_x+B_.rect_w,W.speed.x=Math.min(W.speed.x,0)),W.position.y=Z(W.position.y,B_.rect_y,B_.rect_y+B_.rect_h)),nm(n),a=n;a;a=a.next){if(a.data&&2==a.data.brick_ref.behavior){var K=a.data.brick_ref.image.width,q=a.data.brick_ref.image.height,et=[a.data.x,a.data.y,a.data.x+K,a.data.y+q],nt=[a.data.x,a.data.y,a.data.x+K,a.data.y+q];for(t=0;t<N_.length;t++)if(N_[t]&&(et[0]=N_[t].actor.position.x-N_[t].actor.hot_spot.x-3,et[1]=N_[t].actor.position.y-N_[t].actor.hot_spot.y-3,et[2]=et[0]+Tn(N_[t].actor).width+6,et[3]=et[1]+Tn(N_[t].actor).height+6,(N_[t].spin_dash||N_[t].spin||N_[t].type==Ls)&&tt(et,nt))){var it=void 0,lt=void 0,_t=void 0,ft=void 0;for(ft=Math.max(a.data.brick_ref.behavior_arg[0],1),_t=Math.max(a.data.brick_ref.behavior_arg[1],1),it=0;it<ft;it++)for(lt=0;lt<_t;lt++){var ht=at(a.data.x+it*K/ft,a.data.y+lt*q/_t),mt=at(.3*-N_[t].actor.speed.x,-100-J(50)),gt=Ue(K/ft,q/_t);Math.abs(mt.x)>d&&(mt.x+=(mt.x>0?1:-1)*J(50)),Uh(gt,ht,mt,!1)}N(Ne("break")),a.data.state=1}}if(a.data&&3==a.data.brick_ref.behavior&&2==a.data.state){var vt=a.data;if(vt.value[1]+=$(),vt.value[1]>=1){it=void 0,lt=void 0,ft=void 0,_t=void 0;var bt=0!=vt.brick_ref.behavior_arg[2];for(gt=vt.brick_ref.image,ft=Math.max(vt.brick_ref.behavior_arg[0],1),_t=Math.max(vt.brick_ref.behavior_arg[1],1),it=0;it<ft;it++)for(lt=0;lt<_t;lt++){var kt=at(vt.x+it*gt.width/ft,vt.y+lt*gt.height/_t),wt=at(0,20+20*lt+20*(bt?it:ft-it)),Et=Ue(gt.width/ft,gt.height/_t);Uh(Et,kt,wt,!1)}N(Ne("break")),vt.state=1}}ym(a.data)}for(a=i;a;a=o)o=a.next,bm(a.data),a=null;if(i=null,_m(n),hm(r),C_&&C_.actor&&xm(C_.actor),X_)ia(ot(lh.position,at(0,-90)),.17);else if(G_){var St=[B_.rect_x+240,B_.rect_x+B_.rect_w-240],Mt=at(Z(lh.position.x,St[0],St[1]),lh.position.y);ia(ot(Mt,at(0,-90)),.17)}else f||lh&&ia(lh.position,.1);!function(){var t,e=$();na.is_locked||ra(-p,-p,p,p),t=rt(na.dest,na.position),ct(t)>10&&(t=ut(t),na.position.x+=t.x*na.speed*e,na.position.y+=t.y*na.speed*e),t=rt(na.dest_region_topleft,na.region_topleft),ct(t)>10&&(t=ut(t),na.region_topleft.x+=t.x*na.region_topleft_speed*e,na.region_topleft.y+=t.y*na.region_topleft_speed*e),t=rt(na.dest_region_bottomright,na.region_bottomright),ct(t)>10&&(t=ut(t),na.region_bottomright.x+=t.x*na.region_bottomright_speed*e,na.region_bottomright.y+=t.y*na.region_bottomright_speed*e),na.position.x=Z(na.position.x,na.region_topleft.x,na.region_bottomright.x),na.position.y=Z(na.position.y,na.region_topleft.y,na.region_bottomright.y)}()}am()},bh=function(){if(wt(),Of())return e=rt(e_,at(240,135.5)),qp.width,qp.height,function(){if(Df){var t,e,n=void 0,i=void 0,a=rt(e_,at(240,135.5));for(t=Ue(1,1),e=Xe(0,128,160),Fe(t,0,0,0),n=0;n<t.height;n++)We(0,Mt(),t.width-1,n,e);for(n=0;n<t.width;n++)We(0,Mt(),n,t.height-1,e);for(n=0;n<=480;n++)for(i=0;i<=271;i++)rt($f(at(n*t.width,i*t.height)),a);ze(t)}}(),Wh(),Hf(i_,Mf,rt($f(n_),e)),t=Je(qe("SD_ARROW",0),0),Ye(t.data,Mt(),t.sx,t.sy,~~n_.x,~~n_.y,t.width,t.height),Zn(a_,at(240,135.5)),void Zn(o_,at(240,135.5));var t,e;Si(A_,aa()),Kh(),Mi(A_,aa()),Jh()},yh=function(){var t;for(S("level_release()"),ze(L_),$h(),t=0;t<N_.length;t++)Ws(N_[t]);for(S("editor_release()"),Ff(),function(){for(var t=0;t<Fp;t++)Xp[t]=Vp(Xp[t]);Fp=0}(),_e(t_),_e(Zp),_e(Jp),Vn(o_),Vn(a_),wf=!1,i_=hf,Mf=0,S("editor_release() ok"),Mn(Y_),Mn(H_),Vn(W_),t=0;t<N_.length;t++)Vn(uh[t]);for(Mn(af),Mn(of),Vn(rf),Vn(tf),Vn(ef),Mn(nf),t=0;t<3;t++)Vn(dh[t]),Mn(ph[t]);Vn(uf),Vn(df),Mn(lf),S("level_release() ok")},xh=function(){return Of()},kh=function(){return C_},wh=function(){return P_},Eh=function(t){var e,n;t=Math.max(0,t),nc(Zs()+t),e=Bh(13,ot(C_.actor.position,at(-9,0))),n=""+t,Qn(e.font,n)},Sh=function(){return at(k_,w_)},Mh=function(t){T_&&T(),N(t)},jh=function(t){D_=at(t.x,t.y)},Ih=function(t){var e;if(!X_){for(X_=!0,F_=V(),q_=10*qs(),Z_+=q_,e=0;e<N_.length;e++)N_[e]&&N_[e].got_glasses&&Dh(5e3);for(nc(Zs()+Z_),e=0;e<N_.length;e++)N_[e]&&(ve(N_[e].actor.input),N_[e].spin_dash=!1);for(xm(t),Oh(),Qn(tf,"TEAM SONIC"),tf.position=at(-500,20),Qn(ef,"GOT THROUGH"),ef.position=at(-500,46),Rn(nf,qe("SD_LEVELACT",y_-1)),nf.position=at(820,25),e=0;e<3;e++)ph[e].position=at(-500,120+20*e),dh[e].position=at(820,120+20*e);Rn(ph[0],qe("SD_RINGBONUS",0)),Rn(ph[1],qe("SD_SECRETBONUS",0)),Rn(ph[2],qe("SD_TOTAL",0))}},Dh=function(t){J_+=t,Z_+=t},Th=function(t,e){(!sf||Kn(uf)||Kn(df))&&(sf=!0,cf=V(),Qn(uf,t),Qn(df,e),Jn(df,260))},Oh=function(){sf=!1},Rh=function(){return U_},Lh=function(){var t,e;for(t=j_;t;t=t.next)(e=t.data)&&(e.state=1)},Ah=function(t,e,n,i){!function(t,e,n,i){na.is_locked=!0,ra(t,e,n,i)}(t+240,e+135.5,n-240,i-135.5)},Nh=function(){null!=T_&&T()},Ch=function(){return x_},Ph=function(t,e){for(var n={brick_ref:_n(t),x:e.x,y:e.y,sx:e.x,sy:e.y,enabled:!0,state:0,value:[],animation_frame:0},i=0;i<3;i++)n.value[i]=0;var a={data:n,next:null};return dm(a),a.data},Bh=function(t,e){var n={data:Es(t),next:null};return n.data.actor.spawn_point=at(e.x,e.y),n.data.actor.position=at(e.x,e.y),n.next=M_,M_=n,n.data},Gh=function(t,e){var n={data:xp(t),next:null};return n.data.actor.spawn_point=e,n.data.actor.position=e,n.next=j_,j_=n,n.data},Uh=function(t,e,n,i){var a={data:{image:t,position:e,speed:n,destroy_on_brick:i},next:I_};Of()?ze(t):I_=a},Hh=function(t,e){var n,i,a,o,r,s;return t?(n=t.value[0],1===t.brick_ref.behavior?(i=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],o=t.brick_ref.behavior_arg[2]*(2*h),r=t.brick_ref.behavior_arg[3]*(2*h),s=t.brick_ref.behavior_arg[4]*h/180,at(-i*o*Math.sin(o*n+s),a*r*Math.cos(r*n+s))):at(0,0)):at(0,0)},Yh=function(t){return Bh(15,t)},Wh=function(){Kh()},Xh=function(){return S_},Fh=function(t){return Vh(t)},zh=function(){cm()},$h=function(){var t,e,n,i,a,o;for(S("level_unload()"),T_.pause(),S("releasing brick list..."),t=S_;t;t=e)e=t.next,t.data=null,t=null;for(S_=null,S("releasing item list..."),n=M_;n;n=i)i=n.next,n.data,n=null;for(M_=null,S("releasing enemy list..."),a=j_;a;a=o)o=a.next,kp(a.data),a=null;j_=null,wm()&&(S("releasing the boss..."),function(t){Mn(t.actor)}(B_),B_=null),S("unloading the brickset..."),S("unloading the background..."),S("level_unload() ok")},Vh=function(t){var e;for(e=0;e<fn();e++)if(t.brick_ref==_n(e))return e;return-1},Qh=function(){var t=D_;yh(),gh(),D_=t},Kh=function(){for(var t,e,n,i={},a=t=pm();a;a=a.next)a.data&&(o=a.data.brick_ref).zindex<.5&&(a.data=hn(a.data),i=mn(a.data),Mt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(aa().x-240),a.data.y-(aa().y-135.5),1*i.width,1*i.height));for(qh(!0),a=t;a;a=a.next)if(a.data){var o=a.data.brick_ref;Math.abs(o.zindex-.5)<d&&1!=o.property&&(a.data=hn(a.data),i=mn(a.data),Mt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(aa().x-240),a.data.y-(aa().y-135.5),1*i.width,1*i.height))}for(e=M_;e;e=e.next)e.data&&e.data.bring_to_back&&Ms(e.data,aa());for(a=t;a;a=a.next)a.data&&(o=a.data.brick_ref,Math.abs(o.zindex-.5)<d&&1==o.property&&(a.data=hn(a.data),i=mn(a.data),Mt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(aa().x-240),a.data.y-(aa().y-135.5),1*i.width,1*i.height)));for(wm()&&!B_.bring_to_front&&nh(B_,aa()),n=j_;n;n=n.next)Ep(n.data,aa());for(qh(!1),wm()&&B_.bring_to_front&&nh(B_,aa()),e=M_;e;e=e.next)e.data&&Ms(e.data,aa());for(im(),a=t;a;a=a.next)a.data&&(o=a.data.brick_ref).zindex>.5&&(a.data=hn(a.data),i=mn(a.data),Mt().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(aa().x-240),a.data.y-(aa().y-135.5),1*i.width,1*i.height));_m(t)},qh=function(t){if(C_){var e;for(e=N_.length-1;e>=0;e--)N_[e]!=C_&&!!N_[e].bring_to_back==t&&Fs(N_[e],aa());!!C_.bring_to_back==t&&Fs(C_,aa())}},Jh=function(){var t,e=at(240,135.5);if(X_)for(jn(nf,e),Zn(tf,e),Zn(ef,e),t=0;t<3;t++)jn(ph[t],e),Zn(dh[t],e);else{for(jn(H_,e),jn(Y_,e),Zn(W_,e),t=0;t<3;t++)Zn(uh[t],e);Zh()}E_<2.5&&wt("rgb(0,0,0)"),jn(af,e),jn(of,e),Zn(rf,e),tm(e)},Zh=function(){var t,e=[],n=[],i=0,a=.001*V();for(t=0;t<10;t++)n[t]=!0;if(C_){switch(C_.got_glasses&&(e[i++]=Je(qe("SD_ICON",6),0)),C_.shield_type){case As:e[i++]=Je(qe("SD_ICON",7),0);break;case Ns:e[i++]=Je(qe("SD_ICON",11),0);break;case Cs:e[i++]=Je(qe("SD_ICON",12),0);break;case Ps:e[i++]=Je(qe("SD_ICON",13),0);break;case Bs:e[i++]=Je(qe("SD_ICON",14),0);break;case Gs:e[i++]=Je(qe("SD_ICON",15),0)}if(C_.invincible&&(e[i++]=Je(qe("SD_ICON",4),0),C_.invtimer>=17.25)){var o=(23-C_.invtimer)/5.75;n[i-1]=Math.sin(.5*h*a/(o+.1))>=0}C_.got_speedshoes&&(e[i++]=Je(qe("SD_ICON",5),0),C_.speedshoes_timer>=17.25)&&(o=(23-C_.speedshoes_timer)/5.75,n[i-1]=Math.sin(.5*h*a/(o+.1))>=0)}for(t=0;t<i;t++)n[t]&&Ye(e[t].data,Mt(),e[t].sx,e[t].sy,dt-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},tm=function(t){jn(lf,t),Zn(uf,t),Zn(df,t)},em=function(){I_=null},nm=function(t){var e,n,i,a,o=$(),r=x_,s=null;for(i=I_;i;i=a){var c=i.data;if(c){if(n=km(c.position.x,c.position.y,c.position.x+c.image.width,c.position.y+c.image.height,sh),e=!1,c.destroy_on_brick&&n&&c.speed.y>0){var l=[c.position.x,c.position.y,c.position.x+c.image.width,c.position.y+c.image.height],u=void 0;for(u=t;u&&!e;u=u.next){var d=u.data;if(d&&1==d.brick_ref.property&&0==d.brick_ref.angle){var p=[d.x,d.y,d.x+d.brick_ref.image.width,d.y+d.brick_ref.image.height];tt(l,p)&&(e=!0)}}}!n||e?s?s.next=a:I_=a:(c.position.x+=c.speed.x*o,c.position.y+=c.speed.y*o+.5*r*(o*o),c.speed.y+=r*o,s=i)}}},im=function(){for(var t,e,n,i,a=at(aa().x-240,aa().y-135.5),o=I_;o;o=o.next){var r=o.data;r&&(t=r.image,e=Mt(),n=r.position.x-a.x,i=r.position.y-a.y,e.putImageData(t,n,i))}},am=function(){null==T_||X_||O_||L()||D(T_,!0)},om=function(){if(lf){var t=$(),e=V();if(sf){if(e>=cf+7e3)return void(sf=!1);lf.position.x=(dt-Tn(lf).width)/2,lf.position.y=Math.max(lf.position.y-100*t,pt-1.3*Tn(lf).height)}else lf.position.y=Math.min(lf.position.y+100*t,pt);uf.position=ot(lf.position,at(2,10)),df.position=ot(lf.position,at(2,23))}},rm=function(){if(C_&&C_.actor){var t,e=[],n=[];if(!(E_<2))for(e[0]=C_.actor.position.x,e[1]=C_.actor.position.y,e[2]=e[0]+Tn(C_.actor).width,e[3]=e[1]+Tn(C_.actor).height,t=0;t<pf;t++)if(!_h[t].disabled&&(n[0]=_h[t].rect_x,n[1]=_h[t].rect_y,n[2]=n[0]+_h[t].rect_w,n[3]=n[1]+_h[t].rect_h,tt(e,n))){_h[t].disabled=!0,Th(_h[t].title,_h[t].message);break}}},sm=function(t){C_.spin_dash=C_.braking=!1,N_[P_=t]&&(C_=N_[P_],xm(C_.actor),be(C_.actor.input))},cm=function(){var t,e;for(t=0;t<N_.length;t++)e=D_.x<=k_/2?2-t:t,N_[t].actor.mirror=D_.x<=k_/2?0:1,N_[t].actor.spawn_point.x=N_[t].actor.position.x=D_.x+15*e,N_[t].actor.spawn_point.y=N_[t].actor.position.y=D_.y},lm=function(t,e,n,i){for(var a={data:null,image:Ue(t,e),angle:i,property:1,behavior:0,zindex:.5,behavior_arg:[]},o=0;o<5;o++)a.behavior_arg[o]=0;return{brick_ref:a,x:n.x,y:n.y,sx:n.x,sy:n.y,enabled:!0,state:0,value:[],animation_frame:0}},um=function(t,e){var n=t.brick_ref,i=e.brick_ref;if(!n||!i)return!1;if(n.zindex<i.zindex)return-1;if(n.zindex>i.zindex)return 1;if(n.property!=i.property){var a=[0,100,50];return a[n.property]-a[i.property]}return n.angle%180!=0&&i.angle%180==0?-1:n.angle%180==0&&i.angle%180!=0?1:t.sy-e.sy},dm=function(t){var e;if(S_)if(um(t.data,S_.data))t.next=S_,S_=t;else{for(e=S_;e.next&&um(e.next.data,t.data);)e=e.next;t.next=e.next,e.next=t}else t.next=null,S_=t},pm=function(){for(var t,e,n,i,a=null,o=S_;o;o=o.next)t=Math.min(o.data.x,o.data.sx),e=Math.min(o.data.y,o.data.sy),n=o.data.brick_ref.image.width,i=o.data.brick_ref.image.height,(km(t,e,n,i,2*sh)||1==o.data.brick_ref.behavior)&&(a={data:o.data,next:a});return a},_m=function(t){for(var e;t;)e=t.next,t=null,t=e},fm=function(){for(var t,e,n,i,a=null,o=M_;o;o=o.next)if(o.data){var r=Tn(o.data.actor);r&&(t=~~o.data.actor.position.x,e=~~o.data.actor.position.y,n=r.width,i=r.height,km(t,e,n,i,sh)&&(a={data:o.data,next:a}))}return a},hm=function(t){for(var e;t;)e=t.next,t=null,t=e},mm=function(){var t,e;if(M_)for(M_.data&&M_.data.state==ws&&(e=M_.next,M_.data,M_=e),t=M_;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==ws&&(e=t.next,t.next=e.next,e.data,e=null)},gm=function(){var t,e;if(j_)for(j_&&j_.data&&j_.data.state==vp&&(e=j_.next,kp(j_.data),j_=null,j_=e),t=j_;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==vp&&(e=t.next,t.next=e.next,kp(e.data),e=null)},vm=function(){var t,e;if(S_)for(S_.data&&1==S_.data.state&&(e=S_.next,S_.data=null,S_=null,S_=e),t=S_;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},bm=function(t){ze(t.brick_ref.image),t.brick_ref=null,t=null},ym=function(t){var e,n,i,a,o,r;t&&(t.value[0]+=$(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],a=t.brick_ref.behavior_arg[2]*(2*h),o=t.brick_ref.behavior_arg[3]*(2*h),r=t.brick_ref.behavior_arg[4]*h/180,t.x=t.sx+Math.round(n*Math.cos(a*e+r)),t.y=t.sy+Math.round(i*Math.sin(o*e+r)))},xm=function(t){lh.position.x=t.position.x,lh.position.y=t.position.y},km=function(t,e,n,i,a){var o=aa(),r=[t,e,t+n,e+i],s=[o.x-240-a,o.y-135.5-a,o.x+240+a,o.y+135.5+a];return tt(r,s)},wm=function(){return null!=B_},Em=function(t){return h_="Untitled",m_="",g_="",v_="",b_="",D_=at(0,0),pf=0,B_=null,y_=1,new Promise((function(e,n){S('level_load("'.concat(t,'")')),w(t).then(Sm).then((function(){T_=I(m_),function(){for(var t=0,e=0,n=S_;n;n=n.next)n.data&&n.data.brick_ref&&0!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+mn(n.data).width),e=Math.max(e,n.data.sy+mn(n.data).height));k_=Math.max(t,dt),w_=Math.max(e,pt)}(),S("level_load() ok"),e(null)}))}))},Sm=function(t){var e;for(g_=t.theme,v_=t.bgtheme,b_=t.grouptheme,m_=t.music,h_=t.name,t.author,t.version,t.requires,y_=t.act,D_=t.spawn_point,t.readonly,t.boss&&(B_=function(t,e,n,i,a,o){for(var r={type:t,state:0,direction:0,actor:Sn(),bring_to_front:!1,initial_hp:0,hp:0,value:[],rect_x:n,rect_y:i,rect_w:a,rect_h:o},s=0;s<10;s++)r.value[s]=0;var c=r.actor;switch(c.spawn_point=at(e.x,e.y),c.position=at(e.x,e.y),c.input=ue(),t){case 0:case 2:Rn(c,qe("SD_SIMPLEBOSS",0)),r.initial_hp=r.hp=3,r.direction=3,c.maxspeed=100,c.acceleration=100;break;case 1:case 3:Rn(c,qe("SD_MECHASHADOW",0)),r.initial_hp=r.hp=10,r.direction=3,c.maxspeed=100,c.acceleration=100}return r}(t.boss.id,at(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh)),e=0;e<t.dialogbox.length;e++){var n={disabled:!1,rect_x:t.dialogbox[e].xpos,rect_y:t.dialogbox[e].ypos,rect_w:t.dialogbox[e].width,rect_h:t.dialogbox[e].height,title:Ie(t.dialogbox[e].title),message:Ie(t.dialogbox[e].message)};_h.push(n),pf=_h.length}for(e=0;e<t.enemylist.length;e++)Gh(t.enemylist[e].id,at(t.enemylist[e].xpos,t.enemylist[e].ypos));return new Promise((function(n,i){var a;(a=t.theme,new Promise((function(t,e){S('brickdata_load("'.concat(a,'")')),w(a).then(gn).then((function(t){pn=t})).then(t)}))).then((function(i){for(var a=0;a<t.bricklist.length;a++)Ph(t.bricklist[a].id,at(t.bricklist[a].xpos,t.bricklist[a].ypos));ki(t.bgtheme).then((function(i){for(A_=i,e=0;e<t.itemlist.length;e++)Bh(t.itemlist[e].id,at(t.itemlist[e].xpos,t.itemlist[e].ypos));n(A_)}))}))}))},Mm=function(t){return new Promise((function(e,n){var i={file:t,name:"",author:"",version:"",description:"",image:null,level_count:0,levels:[],level_path:[],show_ending:!1};S('quest_load("'.concat(t,'")')),w(t).then(jm).then((function(t){t&&(i=t),S("load_quest() ok!"),e(i)}))}))},jm=function(t){return new Promise((function(e,n){var i={file:"",name:t.name||"",author:t.author||"Open Sonic",version:t.version||"0",description:t.description||"",show_ending:t.show_ending||!1,image:"",levels:t.levels||[],level_count:t.levels?t.levels.length:0,level_path:t.levels||[]};(function(t){return new Promise((function(e,n){var i=t||"data/images/null.png";He(i=""+i).then((function(t){e(t)}))}))})(t.image).then((function(t){i.image=t,e(i)}))}))};!function(t){t[t.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",t[t.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",t[t.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(_f||(_f={}));var Im,Dm,Tm,Om,Rm,Lm,Am,Nm,Cm,Pm,Bm,Gm,Um,Hm,Ym,Wm,Xm,Fm,zm,$m,Vm,Qm,Km,qm,Jm,Zm,tg,eg,ng,ig,ag,og,rg=_f.QUESTVALUE_TOTALTIME,sg=_f.QUESTVALUE_BIGRINGS,cg=_f.QUESTVALUE_GLASSES,lg=null,ug=0,dg=!1,pg=[],_g=function(){var t;for(dg=!1,t=0;t<3;t++)pg[t]=0},fg=function(){if(0!=lg.level_count)return ug<lg.level_count&&!dg?(fh(lg.level_path[ug]),Oe(dy(Jb)),void ug++):(Re(),void(dg?Oe(dy(iy)):lg.show_ending?Oe(dy(ny)):Oe(dy(ay))));S("Quest '%s' has no levels. ".concat(lg.file))},hg=function(){},mg=function(){},gg=function(){dg=!0},vg=function(t,e){var n=Z(t,0,2);pg[n]=e},bg=function(t){var e=Z(t,0,2);return pg[e]},yg=[],xg=0,kg=function(){xg=0,yg[0]=$n(7),yg[0].position=at(-50,112),Qn(yg[0],"GAME"),yg[1]=$n(7),yg[1].position=at(298,112),Qn(yg[1],"OVER")},wg=function(){var t=$();if((xg+=t)>5){if(xt())return gg(),void Re();yt(Xe(0,0,0),2)}yg[0].position.x+=200*t,yg[0].position.x>80&&(yg[0].position.x=80),yg[1].position.x-=200*t,yg[1].position.x<168&&(yg[1].position.x=168)},Eg=function(){wt();var t=at(240,135.5);Zn(yg[0],t),Zn(yg[1],t)},Sg=function(){ze(null),Vn(yg[1]),Vn(yg[0]),gg()},Mg=0,jg=null,Ig=function(){Mg=0,ki("data/themes/intro.bg.json").then((function(t){jg=t,bt(Xe(0,0,0),1)}))},Dg=function(){if(jg&&(Mg+=$(),Ei(jg),Mg>=3)){if(xt())return Re(),void Oe(dy(iy));yt(Xe(0,0,0),1)}},Tg=function(){if(jg){var t=at(240,135.5);Si(jg,t),Mi(jg,t)}},Og=function(){jg=null},Rg=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],Lg=1,Ag=1,Ng=!1,Cg=0,Pg=[],Bg=[],Gg=null,Ug=null,Hg=0,Yg=null,Wg=null,Xg=0,Fg=null,zg=function(){Hg=0,Ng=!1,Xg=0,Wg=pe(),Gg=$n(8),Pg[0]=$n(4),Qn(Pg[0],"SELECT YOUR"),Pg[0].position.x=(dt-Kn(Pg[0]).length*qn(Pg[0]).x)/2-140,Pg[0].position.y=10,Pg[1]=$n(4),Qn(Pg[1],"LANGUAGE"),Pg[1].position.x=(dt-Kn(Pg[1]).length*qn(Pg[1]).x)/2-120,Pg[1].position.y=Pg[0].position.y+qn(Pg[1]).y+10+10,Pg[2]=$n(8),Qn(Pg[2],Ie("MENU_CQ_BACK")),Pg[2].position.x=10,Pg[2].position.y=pt-1.5*qn(Pg[2]).y,ki("data/themes/langselect.bg.json").then((function(t){Fg=t,bt(Xe(0,0,0),1)})),Yg=Sn(),Rn(Yg,qe("SD_TITLEFOOT",0)),qg(),bt(Xe(0,0,0),1)},$g=function(){var t=$();if(Xg+=t,Ei(Fg),Yg&&Bg.length&&(Yg.position=at(Bg[0][Hg].position.x,Bg[0][Hg].position.y),Yg.position.x-=15,Yg.position.x+=5*Math.cos(2*h*Xg)),!Ng&&!kt()){if(he(Wg,Ut)&&(Hg=(Hg+1)%Cg,N(Ne("choose"))),he(Wg,Gt)&&(Hg=((Hg-1)%Cg+Cg)%Cg,N(Ne("choose"))),he(Wg,Wt)||he(Wg,Ft)){if(!Ug)return;var e=Ug[Hg].filepath;S("Loading language ".concat(Ug[Hg].title," ").concat(e)),Me("data/languages/english.json"),Me(e),Kg(e),N(Ne("select"))}he(Wg,zt)&&(N(Ne("return")),Ng=!0)}if(Lg=Math.floor(1+Hg/8),Ag=Math.floor(1+Math.max(0,Cg-1)/8),Qn(Gg,"page %d/%d",Lg,Ag),Gg.position.x=dt-Kn(Gg).length*qn(Gg).x-10,Gg.position.y=pt-qn(Gg).y-3,!L()){var n=I("data/music/options.mp4");D(n,!0)}if(Ng){if(xt())return void Re();yt(Xe(0,0,0),1)}},Vg=function(){var t,e=at(240,135.5);for(wt(),Si(Fg,e),Mi(Fg,e),Zn(Pg[0],e),Zn(Pg[1],e),Zn(Pg[2],e),Ag>1&&Zn(Gg,e),t=8*(Lg-1);t<8*Lg;t++)Rg[t]&&Bg.length>1&&Zn(Bg[Hg==t?1:0][t],e);jn(Yg,e)},Qg=function(){Jg(),Fg=wi(Fg),Mn(Yg),Vn(Pg[0]),Vn(Pg[1]),Vn(Gg),_e(Wg)},Kg=function(t){var e;e=t,B.language=e,G()},qg=function(){S("load_lang_list()"),k(Rg).then((function(t){Cg=(Ug=t).length,Bg[0]=[],Bg[1]=[];for(var e=0;e<Cg;e++)Ug[e].filepath=Rg[e],Bg[0][e]=$n(8),Bg[1][e]=$n(8),Qn(Bg[0][e],Ug[e].LANG_LANGUAGE),Qn(Bg[1][e],Ug[e].LANG_LANGUAGE),Bg[0][e].position=at(25,75+e%8*20),Bg[1][e].position=at(25,75+e%8*20)}))},Jg=function(){var t;for(S("unload_lang_list()"),t=0;t<Cg;t++)Vn(Bg[0][t]),Vn(Bg[1][t]);Bg[0]=null,Bg[1]=null,Ug=null,Cg=0},Zg=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],tv=3,ev=[],nv=[],iv=function(){Xm=!1,Im=0,Rm=.001*V(),Lm=!1,Tm=null,Dm=pe(),ve(Dm),cv(),Qm=I("data/music/title.mp4"),D(Qm,!0),ki("data/themes/menu.bg.json").then((function(t){Om=t,bt(Xe(0,0,0),1)})),Bm=!0,Gm=Sn(),Rn(Gm,qe("SD_TITLESURGE",0)),Gm.position.x=(dt-Tn(Gm).width)/2+5,Gm.position.y=-15,Um=Sn(),Rn(Um,qe("SD_TITLEBG",0)),Um.position.x=(dt-Tn(Um).width)/2,Um.position.y=Gm.position.y+25,Hm=Sn(),Rn(Hm,qe("SD_TITLEGAMENAME",0)),Hm.position.x=(dt-Tn(Hm).width)/2,Hm.position.y=Gm.position.y+Tn(Gm).height-9,(Ym=$n(8)).position=at(3,259),Qn(Ym,"%s",u),(Wm=$n(0)).position=at(405,3),Qn(Wm,"V%d.%d.%d",1,1,1),Nm=0,Pm=Sn(),Rn(Pm,qe("SD_TITLEFOOT",0)),(Am=[])[0]=je("MENU_1PGAME"),Am[1]=je("MENU_TUTORIAL"),Am[2]=je("MENU_CUSTOMQUESTS"),Am[3]=je("MENU_OPTIONS"),tv=Am.length,Cm=[];for(var t=0;t<2;t++)for(var e=0;e<tv;e++)Cm[e]||(Cm[e]=[]),Cm[e][t]=$n(t),Cm[e][t].position=at(240-Tn(Um).width/5,Hm.position.y+65+10*e),Qn(Cm[e][t],Am[e]);ev[0]=$n(8),ev[0].position=at(5,3),ev[1]=$n(8),ev[1].position=at(5,258),(Fm=$n(8)).position=at(5,170),bt(Xe(0,0,0),1.5)},av=function(){var t,e=.001*V();if(null!=Tm&&xt())return Re(),void Oe(Tm);switch(e<=Rm+2?ve(Dm):Lm||(be(Dm),Lm=!0),Ei(Om),Im){case 0:Bm&&Ln(Gm)&&(Bm=!1,Rn(Gm,qe("SD_TITLESURGE",1)),be(Dm)),Hm.visible=!Bm,Pm.position.x=Cm[Nm][0].position.x-20+3*Math.cos(2*h*e),Pm.position.y=Cm[Nm][0].position.y,he(Dm,Gt)&&(N(Ne("choose")),Nm--),he(Dm,Ut)&&(N(Ne("choose")),Nm++),Nm=(Nm%tv+tv)%tv,(he(Dm,Wt)||he(Dm,Ft))&&(N(Ne("select")),sv(Nm));break;case 1:for(he(Dm,zt)&&(N(Ne("return")),Im=0),t=0;t<$m;t++)nv[t].position=at(30,20+t%14*10),nv[t].visible=lv(t)==lv(zm);if(Pm.position.x=10,Pm.position.y=nv[zm].position.y,he(Dm,Gt)&&(N(Ne("choose")),zm--),he(Dm,Ut)&&(N(Ne("choose")),zm++),zm=(zm%$m+$m)%$m,Qn(ev[0],Ie("MENU_CQ_SELECT"),lv(zm),uv()),Qn(ev[1],Ie("MENU_CQ_BACK")),Qn(Fm,Ie("MENU_CQ_INFO"),Vm[zm].version,Vm[zm].name,Vm[zm].author,Vm[zm].description),he(Dm,Wt)||he(Dm,Ft))return N(Ne("select")),void dv(Vm[zm])}},ov=function(){var t,e=at(240,135.5);if(wt(),!Xm||!xt())switch(Si(Om,e),Mi(Om,e),Im){case 0:for(t=0;t<tv;t++)Zn(Cm[t][t==Nm?1:0],e);jn(Pm,e),Zn(Ym,e),Zn(Wm,e),jn(Um,e),Bm&&wt(),jn(Gm,e),jn(Hm,e);break;case 1:var n=Vm[zm].image;for(Zn(Fm,e),Ye(n,Mt(),0,0,dt-n.width-25,nv[0].position.y,n.width,n.height),Zn(ev[0],e),Zn(ev[1],e),t=0;t<$m;t++)Zn(nv[t],e);jn(Pm,e)}},rv=function(){var t,e;for(Qm.pause(),Vn(Ym),Vn(Wm),t=0;t<2;t++)for(e=0;e<tv;e++)Vn(Cm[e][t]);Mn(Um),Mn(Hm),Mn(Gm),Mn(Pm),_e(Dm)},sv=function(t){var e=Zg[0];switch(t){case 0:return void Mm(e).then((function(t){dv(t)}));case 1:return void Mm("data/quests/tutorial.json").then((function(t){dv(t)}));case 2:Im=1,zm=0;break;case 3:return Tm=dy(cy),void yt(Xe(0,0,0),.5)}},cv=function(){var t;for($m=Zg.length,Vm=[],t=0;t<$m;t++)!function(e){Mm(Zg[t]).then((function(t){nv[e]=$n(8),Vm[e]=t,Qn(nv[e],t.name)}))}(t)},lv=function(t){return Math.floor(t/14+1)},uv=function(){return Math.floor($m/14+($m%14==0?0:1))},dv=function(t){var e,n;lg=e=t,ec(5),nc(0),S("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),n=0,ug=Math.max(0,n),Tm=dy(ey),ve(Dm),yt(Xe(0,0,0),.5)},pv=function(t){if(t){t.init(t);for(var e=0;e<t.child_count;e++)pv(t.child[e])}},_v=function(t){if(t){for(var e=0;e<t.child_count;e++)_v(t.child[e]);t.update(t)}},fv=function(t,e){if(t){for(var n=0;n<t.child_count;n++)fv(t.child[n],e);t.render(t,e)}},hv=function(t){var e=0;if(t){for(var n=0;n<t.child_count;n++)e+=hv(t.child[n]);return 1+e}return 0},mv=function(t,e,n,i){return{font:null,init:t,release:e,update:n,render:i,data:null,parent:null,child:[],child_count:0}},gv=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},vv=function(t){if(t.font=$n(8),Qn(t.font,"LABEL"),null!=t.parent){var e=void 0,n=void 0,i=0,a=null!=t.parent.font?qn(t.parent.font):at(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)i+=hv(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*a.x,t.font.position.y+=(1+i+e)*a.y*2}},bv=function(t){Vn(t.font)},yv=function(t,e){Zn(t.font,e)},xv=function(){ag=0,Km=!1,ng=0,tg=pe(),eg=null,qm=!0,Jm=$n(4),Qn(Jm,Ie("OPTIONS_TITLE")),Jm.position.x=140,Jm.position.y=10,ki("data/themes/options.bg.json").then((function(t){ig=t})),Zm=Sn(),Rn(Zm,qe("SD_TITLEFOOT",0)),Zm.position=at(-50,-50),og=_b(),pv(og)},kv=function(){var t=$();if(ng+=t,Qn(Jm,Ie("OPTIONS_TITLE")),qm&&(bt(Xe(0,0,0),1),qm=!1),Ei(ig),Km||null!=eg||kt()||(he(tg,Ut)&&(ag=(ag+1)%5,N(Ne("choose"))),he(tg,Gt)&&(ag=((ag-1)%5+5)%5,N(Ne("choose"))),he(tg,zt)&&(N(Ne("return")),Km=!0)),_v(og),Km)kt()||T();else if(!L()&&ng>=.2){var e=I("data/music/options.mp4");D(e,!0)}if(Km){if(xt())return Sv(),Re(),void Oe(dy(iy));yt(Xe(0,0,0),1)}if(null!=eg){if(xt())return Sv(),Oe(eg),eg=null,void(qm=!0);yt(Xe(0,0,0),1)}},wv=function(){var t=at(240,135.5);Si(ig,t),Mi(ig,t),Zn(Jm,t),fv(og,t),jn(Zm,t)},Ev=function(){Mn(Zm),Vn(Jm),_e(tg)},Sv=function(){var t,e,n;t=Dt(),B.fullscreen=t,G(),e=It(),B.smooth_graphics=e,G(),n=Tt(),B.show_fps=n,G()},Mv=function(t,e){vv(t),t.data=e,Qn(t.font,Ie(e))},jv=function(t){t.data=null,bv(t)},Iv=function(t){Qn(t.font,Ie(t.data))},Dv=function(t,e){yv(t,e)},Tv=function(t,e,n){var i;vv(t),Qn(t.font,Ie(e)),t.data={},(i=t.data).option_index=n,i.lang_key=e},Ov=function(t){t.data=null,bv(t)},Rv=function(t){var e=t.data;return ag==e.option_index},Lv=function(t){var e=t.data;Qn(t.font,Ie(e.lang_key)),Rv(t)&&(Qn(t.font,"<color=ffff00>%s</color>",Ie(e.lang_key)),Zm.position=ot(t.font.position,at(3*Math.cos(2*h*ng)-20,0)))},Av=function(t,e){yv(t,e)},Nv=function(t){vv(t),Qn(t.font,""),t.font.position=at(0,25)},Cv=function(t){bv(t)},Pv=function(t){},Bv=function(t,e){yv(t,e)},Gv=function(t){Mv(t,"OPTIONS_GRAPHICS")},Uv=function(t){jv(t)},Hv=function(t){Iv(t)},Yv=function(t,e){Dv(t,e)},Wv=function(t){Tv(t,"OPTIONS_FPS",0)},Xv=function(t){Ov(t)},Fv=function(t){Lv(t),function(t){return Rv(t)}(t)&&(kt()||((he(tg,Wt)||he(tg,Ft))&&(N(Ne("select")),Ot(!Tt())),he(tg,Yt)&&Tt()&&(N(Ne("select")),Ot(!1)),he(tg,Ht)&&(Tt()||(N(Ne("select")),Ot(!0)))))},zv=function(t,e){var n,i=[];Av(t,e),(n=$n(8)).position=at(175,t.font.position.y),i[0]=Ie("OPTIONS_YES"),i[1]=Ie("OPTIONS_NO"),Tt()?Qn(n,"<color=ffff00>%s</color>  %s",i[0],i[1]):Qn(n,"%s  <color=ffff00>%s</color>",i[0],i[1]),Zn(n,e),Vn(n)},$v=function(t){Mv(t,"OPTIONS_GAME")},Vv=function(t){jv(t)},Qv=function(t){Iv(t)},Kv=function(t,e){Dv(t,e)},qv=function(t){Tv(t,"OPTIONS_LANGUAGE",1)},Jv=function(t){Ov(t)},Zv=function(t){Lv(t),function(t){return Rv(t)}(t)&&(kt()||(he(tg,Wt)||he(tg,Ft))&&(N(Ne("select")),eg=dy(ry)))},tb=function(t,e){Av(t,e)},eb=function(t){Tv(t,"OPTIONS_STAGESELECT",2)},nb=function(t){Ov(t)},ib=function(t){Lv(t),function(t){return Rv(t)}(t)&&(kt()||(he(tg,Wt)||he(tg,Ft))&&(N(Ne("select")),eg=dy(ly)))},ab=function(t,e){Av(t,e)},ob=function(t){Tv(t,"OPTIONS_CREDITS",3)},rb=function(t){Ov(t)},sb=function(t){Lv(t),function(t){return Rv(t)}(t)&&(kt()||(he(tg,Wt)||he(tg,Ft))&&(N(Ne("select")),eg=dy(sy)))},cb=function(t,e){Av(t,e)},lb=function(t){Tv(t,"OPTIONS_BACK",4)},ub=function(t){Ov(t)},db=function(t){Lv(t),function(t){return Rv(t)}(t)&&(kt()||(he(tg,Wt)||he(tg,Ft))&&(N(Ne("select")),Km=!0))},pb=function(t,e){Av(t,e)},_b=function(){var t,e,n,i,a,o,r,s;return n=mv(Wv,Xv,Fv,zv),e=mv(Gv,Uv,Hv,Yv),gv(e,n),a=mv(qv,Jv,Zv,tb),o=mv(ob,rb,sb,cb),r=mv(eb,nb,ib,ab),i=mv($v,Vv,Qv,Kv),gv(i,a),gv(i,r),gv(i,o),s=mv(lb,ub,db,pb),t=mv(Nv,Cv,Pv,Bv),gv(t,e),gv(t,i),gv(t,s),t},fb=null,hb=!1,mb=!1,gb=0,vb=function(){fb=pe(),hb=!1,mb=!1,gb=0},bb=function(){if(he(fb,zt))return je("CBOX_QUIT_QUESTION"),je("CBOX_QUIT_OPTION1"),je("CBOX_QUIT_OPTION2"),void Oe(dy(oy));if(1==xi()&&(mb=!0),mb)return xt()?(Re(),Re(),void gg()):void yt(Xe(0,0,0),1);if(hb){if(he(fb,Ft))return null!=j&&j.paused&&j.play(),void Re()}else me(fb,Ft)&&(hb=!0)},yb=function(){var t=Je(qe("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(h/2*gb));at((dt-t.width)/2-(e-1)*t.width/2,(pt-t.height)/2-(e-1)*t.height/2),mb||(gb+=$())},xb=function(){ze(null),_e(fb)},kb=null,wb=null,Eb=null,Sb=null,Mb=!1,jb=function(){V(),Mb=!1,(kb=$n(8)).position=at(5,35),wb=$n(4),Qn(wb,Ie("QUESTCLEARED_TITLE")),wb.position=at((dt-qn(wb).x*Kn(wb).length)/2,5),Eb=Sn(),Rn(Eb,qe("SD_SONIC",24)),Eb.position=at(20,150),D(I("data/music/invincible.mp4"),!1),Sb=pe(),bt(Xe(0,0,0),2)},Ib=function(){var t=Zs(),e=bg(rg)/3600,n=bg(rg)/60%60,i=bg(rg)%60,a=bg(cg),o=bg(sg);if(V(),Qn(kb,Ie("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,i,a,o,l,u),he(Sb,Wt)&&(Mb=!0),Mb){if(xt())return Re(),void Oe(dy(iy));yt(Xe(0,0,0),2)}},Db=function(){var t=at(240,135.5);wt(),Zn(wb,t),Zn(kb,t),jn(Eb,t)},Tb=function(){_e(Sb),Mn(Eb),Vn(wb),Vn(kb)},Ob=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"],Rb=1,Lb=1,Ab=null,Nb=null,Cb=null,Pb=null,Bb=null,Gb=0,Ub=null,Hb=null,Yb=[],Wb=0,Xb=0,Fb=[],zb=function(){Xb=0,Gb=0,Hb=0,Bb=pe(),Ab=$n(4),Qn(Ab,Ie("STAGESELECT_TITLE")),Ab.position.x=(dt-Kn(Ab).length*qn(Ab).x)/2-150,Ab.position.y=10,Nb=$n(8),Qn(Nb,Ie("STAGESELECT_MSG")),Nb.position.x=10,Nb.position.y=pt-1.5*qn(Nb).y,Cb=$n(8),Qn(Cb,Ie("STAGESELECT_PAGE"),0,0),Cb.position.x=dt-Kn(Cb).length*qn(Cb).x-10,Cb.position.y=40,ki("data/themes/levelselect.bg.json").then((function(t){Ub=t})),Pb=Sn(),Rn(Pb,qe("SD_TITLEFOOT",0)),Kb(),bt(Xe(0,0,0),1)},$b=function(){var t=$();if(Gb+=t,Ei(Ub),Fb.length){if(Pb.position=at(Fb[Xb].position.x,Fb[Xb].position.y),Pb.position.x+=3*Math.cos(2*h*Gb)-20,Rb=Math.floor(Xb/8+1),Lb=Math.floor(Wb/8+(Wb%8==0?0:1)),Qn(Cb,Ie("STAGESELECT_PAGE"),Rb,Lb),Cb.position.x=dt-Kn(Cb).length*qn(Cb).x-10,2==Hb)kt()||T();else if(!L()){var e=I("data/music/options.mp4");D(e,!0)}switch(Hb){case 0:kt()||(he(Bb,Ut)&&(Xb=(Xb+1)%Wb,N(Ne("choose"))),he(Bb,Gt)&&(Xb=((Xb-1)%Wb+Wb)%Wb,N(Ne("choose"))),(he(Bb,Wt)||he(Bb,Ft))&&(S("Loading level ".concat(Yb[Xb].name," ").concat(Yb[Xb].filepath)),fh(Yb[Xb].filepath),N(Ne("select")),Hb=2),he(Bb,zt)&&(N(Ne("return")),Hb=1));break;case 1:if(xt())return void Re();yt(Xe(0,0,0),1);break;case 2:if(xt())return ec(5),nc(0),Oe(dy(Jb)),void(Hb=3);yt(Xe(0,0,0),1);break;case 3:bt(Xe(0,0,0),1),Hb=0}}},Vb=function(){var t,e=at(240,135.5);for(Si(Ub,e),Mi(Ub,e),Zn(Ab,e),Zn(Nb,e),Lb>1&&Zn(Cb,e),t=8*(Rb-1);t<8*Rb;t++)Yb[t]&&(Qn(Fb[t],Xb==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",Yb[t].name,Ie("STAGESELECT_ACT"),Yb[t].act),Zn(Fb[t],e));jn(Pb,e)},Qb=function(){qb(),Ub=wi(Ub),Mn(Pb),Vn(Ab),Vn(Nb),Vn(Cb),_e(Bb)},Kb=function(){S("load_stage_list()"),k(Ob).then((function(t){Wb=(Yb=t).length;for(var e=0;e<Wb;e++)Fb[e]=$n(8),Fb[e].position=at(25,60+e%8*20),Yb[e].filepath=Ob[e]}))},qb=function(){},Jb=1,Zb=2,ty=3,ey=4,ny=5,iy=6,ay=7,oy=8,ry=9,sy=10,cy=11,ly=12,uy=[],dy=function(t){return uy[t]},py=function(t,e,n,i){return{init:t,update:e,render:n,release:i}},_y=function(){var e,n,i;n=function(){!function(){var t=0,e=0;for(e=0;e<10;)e=(t=V())>X?t-X:0,X=t>=X?X:t;e=Math.min(e,16),F=.001*e,H++,(Y+=e)>=1e3&&(W=H,H=0,Y=0),X=V()}(),function(){var t,e,n=$();for(e=Qt;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)fe(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case Bt.IT_KEYBOARD:e.data.state[Gt]=te.up,e.data.state[Ut]=te.down,e.data.state[Ht]=te.left,e.data.state[Yt]=te.right,e.data.state[Wt]=te.space,e.data.state[Xt]=te.lcontrol,e.data.state[Ft]=te.enter,e.data.state[zt]=te.esc,e.data.state[$t]=te.tilda;break;case Bt.IT_MOUSE:e.data.x=ce.x,e.data.y=ce.y,e.data.state[Wt]=le.left,e.data.state[Ft]=le.middle,e.data.state[Xt]=le.right;break;case Bt.IT_COMPUTER:for(t=0;t<9;t++)e.data.state[t]=!1;break;case Bt.IT_JOYSTICK:Kt&&!qt&&(e.data.state[Gt]=ee[0].stick[0].axis[1].d1,e.data.state[Ut]=ee[0].stick[0].axis[1].d2,e.data.state[Ht]=ee[0].stick[0].axis[0].d1,e.data.state[Yt]=ee[0].stick[0].axis[0].d2,e.data.state[Wt]=ee[0].button[0].b,e.data.state[Xt]=ee[0].button[1].b,e.data.state[Ft]=ee[0].button[2].b,e.data.state[zt]=ee[0].button[3].b);break;case Bt.IT_USER:e.data.state[Gt]=te.up,e.data.state[Ut]=te.down,e.data.state[Ht]=te.left,e.data.state[Yt]=te.right,e.data.state[Wt]=te.space,e.data.state[Xt]=te.lcontrol,e.data.state[Ft]=te.enter,e.data.state[zt]=te.esc,Jt&&(e.data.state[Gt]=ne.up(),e.data.state[Ut]=ne.down(),e.data.state[Ht]=ne.left(),e.data.state[Yt]=ne.right(),e.data.state[Wt]=ie._pressed,e.data.state[zt]=ae._pressed,e.data.state[Xt]=oe._pressed),re&&(se="undefined"!=typeof navigator&&(navigator.getGamepads()[0]||null)),se&&(e.data.state[Gt]=se.buttons[12].pressed,e.data.state[Ut]=se.buttons[13].pressed,e.data.state[Ht]=se.buttons[14].pressed,e.data.state[Yt]=se.buttons[15].pressed,e.data.state[Wt]=se.buttons[0].pressed,e.data.state[Xt]=se.buttons[1].pressed,e.data.state[Ft]=se.buttons[2].pressed,e.data.state[zt]=se.buttons[3].pressed)}}}(),(e=Le())&&(e.update(),e==Le()&&e.render()),function(){if(o=!1,0!=a)if((s+=$())<c){var e=void 0;e=Z(e=1.25*s/c*100,0,100),e=1==a?100-e:e,e/=100,Mt().fillStyle=r,Mt().globalAlpha=e,Mt().fillRect(0,0,t.width,t.height)}else 2==a&&(Mt().fillStyle=r,Mt().fillRect(0,0,t.width,t.height)),a=0,c=s=0,r=null,o=!0;Mt().globalAlpha=1,Tt()&&(Mt().font="14px Arial",Mt().fillStyle="white",Mt().fillText(W,450,20))}(),ne&&ne.render(Mt()),ie&&ie.render(Mt()),ae&&ae.render(Mt()),oe&&oe.render(Mt())},i=null,requestAnimationFrame((function t(e){var a=!1;if(null!=i){Math.min(e-i,100);a=!1===n()}i=e,a||requestAnimationFrame(t)}))},fy=function(){S("preferences_init()"),function(){if(B.video_resolution="TINY",B.fullscreen=!1,B.smooth_graphics=!1,B.show_fps=!1,B.language="data/languages/english.json","undefined"!=typeof window)for(var t in B){var e=window.localStorage.getItem(t)?localStorage.getItem(t):B[t];"false"==e&&(e=!1),"true"==e&&(e=!0),B[t]=e}}()},hy=function(i){var a,o,r,s;S("timer_init()"),H=0,Y=0,W=0,F=0,X=V(),gy(),a=i.video_resolution,o=i.smooth_graphics,r=i.fullscreen,i.color_depth,s=i.show_fps,Rt(a,o,r),Ot(s),(t=document.getElementById("canvas"))?(e=t.getContext("2d"),mt=t.width/dt,gt=t.height/pt,e.scale(t.width/dt,t.height/pt)):(t=document.createElement("canvas"),e=t.getContext("2d"),t.width=dt,t.height=pt,document.body.appendChild(t)),mt=dt/window.innerWidth,gt=mt,e.imageSmoothingEnabled=!1,e.mozImageSmoothingEnabled=!1,n=e,wt(),S("input_init()"),Qt=null,St().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),St().addEventListener("mousemove",(function(t){ce=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(St(),t)}),!1),St().addEventListener("mousedown",(function(t){switch(t.which){case 1:le.left=!0;break;case 2:le.middle=!0;break;case 3:le.right=!0}}),!1),St().addEventListener("mouseup",(function(t){switch(t.which){case 1:le.left=!1;break;case 2:le.middle=!1;break;case 3:le.right=!1}}),!1),Kt=!1,qt=!1,re="undefined"!=typeof navigator&&"getGamepads"in navigator,(Jt=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&((ne=new Pt({container:St(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),(ie=new Pt({container:St(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(ae=new Pt({container:St(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(oe=new Pt({container:St(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),te=we(Zt),m.images={},m.images,m.samples={},b=m.samples,m.musics={},y=m.musics},my=function(t,e){S("soundfactory: loading the samples table..."),w("data/config/samples.json").then((function(t){Ce(t)})),S("Loading objects scripts..."),bp=null,w("data/objects/enemies.json").then((function(t){bp=t})),function(){for(var t=0;t<256;t++)uy[t]=null;uy[Jb]=py(gh,vh,bh,yh),uy[Zb]=py(vb,bb,yb,xb),uy[ty]=py(kg,wg,Eg,Sg),uy[ey]=py(_g,fg,hg,mg),uy[iy]=py(iv,av,ov,rv),uy[0]=py(Ig,Dg,Tg,Og),uy[ny]=py(Ji,Zi,ta,ea),uy[ay]=py(jb,Ib,Db,Tb),uy[oy]=py(gi,vi,bi,yi),uy[ry]=py(zg,$g,Vg,Qg),uy[sy]=py(Wi,Xi,Fi,zi),uy[cy]=py(xv,kv,wv,Ev),uy[ly]=py(zb,$b,Vb,Qb)}(),function(t,e){S("Initializing the language module"),Me(Ee=t||Ee).then((function(){S("lang_init() ok!"),e()}))}(t.language,(function(){!function(){Te=0;for(var t=0;t<16;t++)De[t]=null}(),e()}))},gy=function(){return""};!function(t){fy();var e=function(t){var e={};return e.video_resolution=B.video_resolution,e.smooth_graphics=B.smooth_graphics,e.fullscreen=B.fullscreen,e.show_fps=B.show_fps,e.language=B.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=U("video_resolution")?U("video_resolution"):e.video_resolution,e.smooth_graphics=U("smooth_graphics")?U("smooth_graphics"):e.smooth_graphics,e.fullscreen=U("fullscreen")?U("fullscreen"):e.fullscreen,e.show_fps=U("show_fps")?U("show_fps"):e.show_fps,e.color_depth=U("color_depth")?U("color_depth"):e.color_depth,e.level=U("level")?U("level"):e.level,e.quest=U("quest")?U("quest"):e.quest,e.language=U("language")?U("language"):e.language,e.level?(e.custom_level=!0,e.custom_level_path=e.level):e.custom_level=!1,e.quest?(e.custom_quest=!0,e.custom_quest_path=e.quest):e.custom_quest=!1,e}({Xvideo_resolution:"TINY",Xsmooth_graphics:!1,Xfullscreen:!1,Xshow_fps:!0,Xcolor_depth:32,Xlevel:null,Xquest:null,Xlanguage:null});hy(e),new Promise((function(t,e){var n;for(S("Loading sprites..."),m.sprites={},$e=m.sprites,n=0;n<Ve.length;n++)Ve[n]="data/sprites/"+Ve[n]+".json";Et("Loading...",0),k(Ve).then((function(e){for(n=0;n<e.length;n++)for(var i in e[n])e[n][i].name=i,Ke.push(e[n][i]);rn(Ke).then((function(){S("All sprites have been loaded!"),$e=g(),t($e)}))}))})).then((function(){!function(){var t,e,n,i=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for(S("font_init()"),t=0;t<i.length;t++)for(Fn[t]={ch:[]},n="FT_FONT"+t,e=0;e<i[t].length;e++)Fn[t].ch[i[t][e]]=Je(qe(n,0),e);S("font_init() ok")}(),my(e,(function(){ec(5),nc(0),function(t){t.custom_level?(fh(t.custom_level_path),Oe(dy(Jb))):Oe(dy(0))}(e),_y()}))}))}()})();