(()=>{"use strict";var t,e,n,i,a,o,r,s,c,d,u="Open Sonic",l="http://opensnc.sourceforge.net",p=1e-5,_=1<<30,f=1/0,h=999999999,m=Math.PI,g={sprites:{},images:{},samples:{},musics:{}},v=function(){return g.sprites},b=function(t,e){return g.samples[e]},y={},x=function(t){return Promise.all(t.map(k))},k=function(t){return t=""+t,new Promise((function(e,n){if(y[t])e(y[t]);else{var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.onreadystatechange=function(){if(4===i.readyState){var n={};try{n=JSON.parse(i.responseText)}catch(t){}y[t]=n,e(n)}},i.send(null)}}))},w=function(e,n){!function(t,e,n){t[e]=n}(t,e,n)},E=function(t){console.log(t)},S=function(t){console.log("FATAL ERROR",t)},M=null,j=function(t){E('music_load("'.concat(t,'")'));var n=new Audio;return n.src=t,function(t,n){!function(t,e,n){t[e]=n}(e,t,n)}(t,n),n},T=function(t,e){if(R()&&I(),null!=t){t.loop=!!e;try{t.play()}catch(t){}}M=t},I=function(){null!=M&&M.pause(),M=null},D=function(t){null!=M&&(t>1&&(t=1),t<0&&(t=0),M.volume=t)},O=function(){return null!=M?M.volume:0},R=function(){return null!=M&&!M.paused},A=function(t,e){e=""+e;var n=new Audio;n.src=e;var i=new Audio;i.src=e;var a=new Audio;a.src=e;var o=new Audio;return o.src=e,w(t,n),w(t+"2",i),w(t+"3",a),w(t+"4",o),n},L=function(t){N(t)},N=function(t){t&&t.play&&t.play()},C=function(t){return!!t&&!t.paused},P={video_resolution:"",fullscreen:!1,smooth_graphics:!1,show_fps:!1,language:""},G=function(){if("undefined"!=typeof window)for(var t in P)P[t],window.localStorage.setItem(t,P[t])},U=function(t){if("undefined"!=typeof window){var e=RegExp("[?&]"+t+"=([^&]*)").exec(window.location.search);return e&&decodeURIComponent(e[1].replace(/\+/g," "))}return null},B=0,Y=0,H=0,W=0,F=0,X=0,z=function(){return F},$=function(){var t=Q();return t<X&&(X=t),t-X},Q=function(){return Math.floor(Date.now())},V=function(t){return" "==t},K=function(t){return void 0!==t&&t&&t.constructor===Array},q=function(t){return~~J(Math.random()*t,0,t)},J=function(t,e,n){return Math.min(Math.max(t,e),n)},Z=function(t,e){return t[0]<e[2]&&t[2]>e[0]&&t[1]<e[3]&&t[3]>e[1]},tt=function(t,e){return nt(t,e,t.length)},et=function(t){return t>=0&&t<m/4-p?0:t>=m/4-p&&t<m/2-p?m/4:t>=m/2-p&&t<m/2+p?m/2:t>=m/2+p&&t<m-p?3*m/4:t>=m-p&&t<m+p?m:t>=m+p&&t<3*m/2-p?5*m/4:t>=3*m/2-p&&t<3*m/2+p?3*m/2:t>3*m/2+p&&t<=7*m/4+p?7*m/4:0},nt=function(t,e,n){var i,a,o=t,r=e;for(i=0;i<n;i++)a=o[i],o[i]=r[i],r[i]=a;return[o[i],r[i]]},it=function(t,e){return{x:t,y:e}},at=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},ot=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},rt=function(t,e){return{x:e*t.x,y:e*t.y}},st=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},ct=function(t,e){var n=t.x,i=t.y;return{x:n*Math.cos(e)-i*Math.sin(e),y:i*Math.cos(e)+n*Math.sin(e)}},dt=function(t){var e=st(t);return e>p?it(t.x/e,t.y/e):it(0,0)},ut=480,lt=271,pt=!1,_t=!1,ft=!1,ht=1,mt=1,gt=function(){return it(ht,mt)},vt=function(t,e){0==o&&(o=1,r=!1,s=t,c=0,d=e)},bt=function(t,e){0==o&&(o=2,r=!1,s=t,c=0,d=e)},yt=function(){return r},xt=function(){return 0!=o},kt=function(t){i.fillStyle=t||"rgb(0, 0, 0)",i.fillRect(0,0,n.width,n.height)},wt=function(t,e){kt();var n=St();n.beginPath(),n.rect(130,115.5,210,20),n.fillStyle="black",n.fill(),n.lineWidth=1,n.strokeStyle="white",n.stroke(),e=e<1?0:e>202?202:202/e,n.beginPath(),n.rect(134,118.5,e,14),n.fillStyle="white",n.fill(),n.lineWidth=1,n.strokeStyle="black",n.stroke(),n.font="14px Arial",n.fillStyle="white",n.fillText(t,130,105.5)},Et=function(){return n},St=function(){return i},Mt=function(){return a},jt=function(){return pt},Tt=function(){return _t},It=function(){return ft},Dt=function(t){ft=t},Ot=function(t,e,n){a=t,_t=n,pt=e};function Rt(t){return Rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rt(t)}function At(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(a=i.key,o=void 0,o=function(t,e){if("object"!==Rt(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!==Rt(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(a),"symbol"===Rt(o)?o:String(o)),i)}var a,o}var Lt,Nt,Ct=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._pressed=!1,this._touchIdx=null;var n=function(t,e){return function(){return t.apply(e,arguments)}};this._$onTouchStart=n(this._onTouchStart,this),this._$onTouchEnd=n(this._onTouchEnd,this),this._$onTouchMove=n(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=n(this._onMouseDown,this),this._$onMouseUp=n(this._onMouseUp,this),this._$onMouseMove=n(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))}var e,n,i;return e=t,i=[{key:"touchScreenAvailable",value:function(){return"createTouch"in document}}],(n=[{key:"destroy",value:function(){this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))}},{key:"deltaX",value:function(){return this._stickX-this._baseX}},{key:"deltaY",value:function(){return this._stickY-this._baseY}},{key:"up",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e>=0||Math.abs(t)>2*Math.abs(e))}},{key:"down",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(e<=0||Math.abs(t)>2*Math.abs(e))}},{key:"right",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t<=0||Math.abs(e)>2*Math.abs(t))}},{key:"left",value:function(){if(!1===this._pressed)return!1;var t=this.deltaX(),e=this.deltaY();return!(t>=0||Math.abs(e)>2*Math.abs(t))}},{key:"_onUp",value:function(){this._pressed=!1,0==this._stationaryBase&&(this._baseX=this._baseY=0,this._stickX=this._stickY=0)}},{key:"_onDown",value:function(t,e){this._pressed=!0;var n=gt();t*=n.x,e*=n.y,this._stationaryBase,this._stickX=t,this._stickY=e}},{key:"_onMove",value:function(t,e){var n=gt();t*=n.x,e*=n.y,!0===this._pressed&&(this._stickX=t,this._stickY=e)}},{key:"_onMouseUp",value:function(t){return this._onUp()}},{key:"_onMouseDown",value:function(t){t.preventDefault();var e=t.clientX,n=t.clientY;return this._onDown(e,n)}},{key:"_onMouseMove",value:function(t){var e=t.clientX,n=t.clientY;return this._onMove(e,n)}},{key:"_onTouchStart",value:function(t){if(null===this._touchIdx&&!1!==this.dispatchEvent("touchStartValidation",t)){this.dispatchEvent("touchStart",t),t.preventDefault();var e=t.changedTouches[0];this._touchIdx=e.identifier;var n=e.pageX,i=e.pageY;return this._onDown(n,i)}}},{key:"_onTouchEnd",value:function(t){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",t);for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length)return this._touchIdx=null,t.preventDefault(),this._onUp()}}},{key:"_onTouchMove",value:function(t){if(null!==this._touchIdx){for(var e=t.changedTouches,n=0;n<e.length&&e[n].identifier!==this._touchIdx;n++);if(n!==e.length){var i=e[n];t.preventDefault();var a=i.pageX,o=i.pageY;return this._onMove(a,o)}}}},{key:"render",value:function(t){t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._baseX,this._baseY,20,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=1,t.arc(this._baseX,this._baseY,30,0,2*Math.PI,!0),t.stroke(),this._pressed&&(t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=3,t.arc(this._stickX,this._stickY,20,0,2*Math.PI,!0),t.stroke())}}])&&At(e.prototype,n),i&&At(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();(Lt=Ct.prototype).addEventListener=function(t,e){return void 0===this._events&&(this._events={}),this._events[t]=this._events[t]||[],this._events[t].push(e),e},Lt.removeEventListener=function(t,e){void 0===this._events&&(this._events={}),t in this._events!=0&&this._events[t].splice(this._events[t].indexOf(e),1)},Lt.dispatchEvent=function(t){if(void 0===this._events&&(this._events={}),void 0!==this._events[t])for(var e=this._events[t].slice(),n=0;n<e.length;n++){var i=e[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==i)return i}},function(t){t[t.IB_UP=1]="IB_UP",t[t.IB_DOWN=2]="IB_DOWN",t[t.IB_RIGHT=3]="IB_RIGHT",t[t.IB_LEFT=4]="IB_LEFT",t[t.IB_FIRE1=5]="IB_FIRE1",t[t.IB_FIRE2=6]="IB_FIRE2",t[t.IB_FIRE3=7]="IB_FIRE3",t[t.IB_FIRE4=8]="IB_FIRE4",t[t.IB_FIRE5=9]="IB_FIRE5"}(Nt||(Nt={}));var Pt,Gt=Nt.IB_UP,Ut=Nt.IB_DOWN,Bt=Nt.IB_LEFT,Yt=Nt.IB_RIGHT,Ht=Nt.IB_FIRE1,Wt=Nt.IB_FIRE2,Ft=Nt.IB_FIRE3,Xt=Nt.IB_FIRE4,zt=Nt.IB_FIRE5;!function(t){t[t.IT_KEYBOARD=1]="IT_KEYBOARD",t[t.IT_MOUSE=2]="IT_MOUSE",t[t.IT_COMPUTER=3]="IT_COMPUTER",t[t.IT_JOYSTICK=4]="IT_JOYSTICK",t[t.IT_USER=5]="IT_USER"}(Pt||(Pt={}));var $t,Qt,Vt,Kt,qt,Jt,Zt,te,ee,ne,ie,ae,oe,re,se=null,ce=!1,de=!1,ue=!1,le={37:"left",38:"up",39:"right",40:"down",17:"lcontrol",32:"space",13:"enter",27:"esc",192:"tilda"},pe=null,_e=null,fe=null,he=null,me=null,ge=null,ve=null,be=it(0,0),ye={left:!1,middle:!1,right:!1},xe=function(){for(var t={type:Pt.IT_COMPUTER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Re(t),t},ke=function(t){for(var e={type:Pt.IT_KEYBOARD,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},n=0;n<9;n++)e.state[n]=e.oldstate[n]=!1,e.howlong[n]=0;if(t)for(e.keybmap=[],n=0;n<9;n++)e.keybmap[n]=t[n];else e.keybmap[Gt]=38,e.keybmap[Ut]=40,e.keybmap[Yt]=39,e.keybmap[Bt]=37,e.keybmap[Ht]=32,e.keybmap[Wt]=17,e.keybmap[Ft]=13,e.keybmap[Xt]=27,e.keybmap[zt]=192;return Re(e),e},we=function(){for(var t={type:Pt.IT_USER,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return t.keybmap=[],t.keybmap[Gt]=38,t.keybmap[Ut]=40,t.keybmap[Yt]=39,t.keybmap[Bt]=37,t.keybmap[Ht]=32,t.keybmap[Wt]=17,t.keybmap[Ft]=13,t.keybmap[Xt]=27,Re(t),t},Ee=function(t){Ae(t),t=null},Se=function(t,e){return!!e&&!!t.enabled&&t.state[e]},Me=function(t,e){return!!e&&!!t.enabled&&t.state[e]&&!t.oldstate[e]},je=function(t,e){return!e||!!t.enabled&&!t.state[e]&&t.oldstate[e]},Te=function(t,e){t.state[e]=!0},Ie=function(t){t.enabled=!1},De=function(t){t.enabled=!0},Oe=function(t){return it(t.x,t.y)},Re=function(t){se={data:t,next:se}},Ae=function(t){var e,n;if(se.data==t)n=se.next,se=null,se=n;else{for(e=se;e.next&&e.next.data!=t;)e=e.next;e.next&&(n=e.next.next,e.next=null,e.next=n)}},Le=function(t){var e=Object.create(null);function n(n){if(t.hasOwnProperty(n.keyCode)){var i="keydown"==n.type;e[t[n.keyCode]]=i,n.preventDefault()}}return addEventListener("keydown",n),addEventListener("keyup",n),e},Ne="data/languages/english.json",Ce={},Pe=function(t){return new Promise((function(e,n){E('lang_loadfile("'.concat(t,'")...')),k(t).then((function(t){Ce=t,e(t)}))}))},Ge=function(t){return Ce[t]||t},Ue=function(t){return Ge(t)},Be=[],Ye=0,He=function(t){Be[Ye++]=t,t&&t.init()},We=function(){Be[Ye-1].release(),Be[Ye-1]=null,Ye--},Fe=function(){return Be[Ye-1]},Xe={},ze=function(t){var e=b(0,t);return C(e)&&(e=b(0,t+"2"),C(e)&&(e=b(0,t+"3"),C(e)&&(e=b(0,t+"4")))),e},$e=function(t){for(var e in t)Xe[e]=Qe(e,t[e])},Qe=function(t,e){var n=Ve();return n.data=A(t,e),n.data2=A(t,e),n},Ve=function(){return{data:null,data2:null}},Ke={},qe=function(t,e){return St().createImageData(t,e)},Je=function(t){return new Promise((function(e,n){if(Ke[t])return e(Ke[t]);var i=document.createElement("img");i.src=t,i.addEventListener("load",(function(){return Ke[t]=i,e(i)}))}))},Ze=function(t,e,n,i,a,o,r,s){if(!t||!e)return!1;e.drawImage(t,n,i,r,s,a,o,r,s)},tn=function(t,e,n,i,a){e.fillStyle=a,e.fillRect(n,i,n+1,i+1)},en=function(t,e,n){return"rgb(".concat(t,", ").concat(e,", ").concat(n,")")},nn=function(t,e,n,i){for(var a=0;a<t.data.length;a+=4)t.data[a]=e,t.data[a+1]=n,t.data[a+2]=i},an=function(t){t&&(t=null)},on={},rn=["animal","bigring","bluering","bosses","bumber","charge","checkpointorb","chef","danger","dangpower","dnadoor","door","explosion","fireball","flyingboy","flyingeyes","font","glasses","goal","goldfish","hud","icon","itembox","joan","kleps","lady_bugsy","levelact","loop","menu","misc","nafder","neon","oranjection","ring","roboxer","shield","spikes","spring","surge","surpreyes","switch","teleporter"],sn=0,cn=[],dn=function(t,e){var n;return null!=(n=on[t])?n.animation_data[e]:null},un=function(t,e){return t?t.frame_data[t.data[e]]:null},ln=function(t){return new Promise((function(e,n){pn(t).then(e)}))},pn=function(t){return new Promise((function(e,n){var i=_n(),a=vn(i,t);a=function(t){var e,n,i;for((t.frame_w>t.rect_w||t.frame_h>t.rect_h)&&(t.frame_w=Math.min(t.frame_w,t.rect_w),t.frame_h=Math.min(t.frame_h,t.rect_h)),(t.rect_w%t.frame_w>0||t.rect_h%t.frame_h>0)&&(t.rect_w=t.rect_w%t.frame_w>0?t.rect_w-t.rect_w%t.frame_w+t.frame_w:t.rect_w,t.rect_h=t.rect_h%t.frame_h>0?t.rect_h-t.rect_h%t.frame_h+t.frame_h:t.rect_h),i=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),e=0;e<t.animation_count;e++)for(n=0;n<t.animation_data[e].frame_count;n++)t.animation_data[e].data[n]>=0&&t.animation_data[e].data[n]<i||(t.animation_data[e].data[n]=Math.min(t.animation_data[e].data[n],0,i-1));return t}(a),fn(a).then((function(n){a=mn(n),yn(t.name,a),sn++,wt("Loading...",sn/cn.length),e(a)}))}))},_n=function(){return{source_file:null,rect_x:0,rect_y:0,rect_w:0,rect_h:0,frame_w:0,frame_h:0,hot_spot:it(0,0),frame_count:0,frame_data:[],animation_count:0,animation_data:[]}},fn=function(t){return new Promise((function(e,n){Je(t.source_file).then((function(n){t.frame_count=t.rect_w/t.frame_w*(t.rect_h/t.frame_h),t.frame_data=[],t=hn(t,n),e(t)}))}))},hn=function(t,e){for(var n=0,i=0,a=0;a<t.frame_count;a++){var o={data:e,sx:n+t.rect_x,sy:i+t.rect_y,swidth:t.frame_w,sheight:t.frame_h,x:0,y:0,width:t.frame_w,height:t.frame_h};t.frame_data[a]=o,(n+=t.frame_w)>=t.rect_w&&(n=0,i+=t.frame_h)}return t},mn=function(t){for(var e=0;e<t.animation_count;e++)t.animation_data[e].frame_data=t.frame_data,t.animation_data[e].hot_spot=t.hot_spot;return t},gn=function(t){return Promise.all(t.map(pn))},vn=function(t,e){if(t.source_file=""+e.source_file,t.rect_x=e.source_rect.xpos,t.rect_y=e.source_rect.ypos,t.rect_w=e.source_rect.width,t.rect_h=e.source_rect.height,t.frame_w=e.frame_size.width,t.frame_h=e.frame_size.height,e.hot_spot&&(t.hot_spot.x=e.hot_spot.xpos,t.hot_spot.y=e.hot_spot.ypos),e.animations){t.animation_count=e.animations.length;for(var n=0;n<t.animation_count;n++)t.animation_data[n]=bn(xn(),e.animations[n]),0==t.animation_data[n].frame_count&&E("Animation error: invalid 'data' field. You must specify the frames of the animations")}return t},bn=function(t,e){return t.repeat=e.repeat,t.fps=e.fps,t.data=e.data,t.frame_count=e.data.length,t},yn=function(t,e){!function(t,e,n){g.sprites[e]=n}(v(),t,e)},xn=function(){return{repeat:!1,fps:8,frame_count:0,data:null,hot_spot:it(0,0),frame_data:null}},kn=0,wn=[],En=function(t){return wn[t]},Sn=function(){return kn},Mn=function(t){var e=t.brick_ref.data;if(null!=e&&e.animation_data.length){e.animation_data[0].repeat;var n=e.animation_data[0].frame_count;t.animation_frame+=e.animation_data[0].fps*z(),t.animation_frame>e.animation_data[0].frame_count-1&&(t.animation_frame=0),n=~~t.animation_frame,t.brick_ref.image=e.frame_data[e.animation_data[0].data[n]]}},jn=function(t){return t.brick_ref.image},Tn=function(t){return Promise.all(t.bricks.map(In))},In=function(t){return new Promise((function(e,n){var i=function(){for(var t={data:null,image:null,property:0,angle:0,behavior:0,zindex:.5,behavior_arg:[]},e=0;e<5;e++)t.behavior_arg[e]=0;return t}(),a=t.type;"OBSTACLE"==a?i.property=1:"PASSABLE"==a?i.property=0:"CLOUD"==a?i.property=2:E("Can't read brick attributes: unknown brick type ".concat(a)),"DEFAULT"==(a=K(t.behavior)?t.behavior[0]:t.behavior)?i.behavior=0:"CIRCULAR"==a?i.behavior=1:"BREAKABLE"==a?i.behavior=2:"FALL"==a?i.behavior=3:E("Can't read brick attributes: unknown brick type ".concat(a));for(var o=0;o<5;o++)i.behavior_arg[o]=t.behavior[1+o];i.behavior_arg[i.behavior_arg.length-1]=0,i.angle=t.angle,t.zindex&&(i.zindex=t.zindex),ln(t.sprite).then((function(t){i.data=t,i.image=t.frame_data[0],kn++,e(i)}))}))},Dn=void 0,On=!0,Rn=0,An=0,Ln=0,Nn=0,Cn=function(){return{spawn_point:it(0,0),position:it(0,0),angle:0,speed:it(0,0),maxspeed:0,acceleration:0,jump_strength:0,is_jumping:!1,ignore_horizontal:!1,input:null,animation:null,animation_frame:0,animation_speed_factor:1,mirror:0,visible:!0,alpha:1,hot_spot:it(0,0),carried_by:null,carry_offset:it(0,0),carrying:null}},Pn=function(t){t.input&&Ee(t.input),t=null},Gn=function(t,e){if(e&&t&&t.visible&&t.animation){t.animation_frame+=t.animation.fps*t.animation_speed_factor*z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var n=Yn(t);if(!n)return!1;t.mirror&&ei(St(),t.position.x-(e.x-240));var i=t.position.x-(e.x-240),a=t.position.y-(e.y-135.5),o=t.mirror?t.angle:-t.angle;t.angle&&(St().translate(i,a),St().rotate(o),St().translate(-i,-a)),St().drawImage(n.data,n.sx,n.sy,n.swidth,n.sheight,~~(t.position.x-t.hot_spot.x-(e.x-240)),~~(t.position.y-t.hot_spot.y-(e.y-135.5)),1*n.width,1*n.height),t.angle&&(St().translate(i,a),St().rotate(-o),St().translate(-i,-a)),t.mirror&&ei(St(),t.position.x-(e.x-240))}},Un=function(t,e,n,i){var a=it(0,0);if(t.visible&&t.animation){isNaN(t.animation_frame)&&(t.animation_frame=0,t.animation.fps=1),t.animation_frame+=t.animation.fps*t.animation_speed_factor*z(),t.animation_frame>t.animation.frame_count-1&&(t.animation.repeat?t.animation_frame=0:t.animation_frame=t.animation.frame_count-1);var o=Yn(t);if(!o)return!1;a.x=t.position.x%(n?o.width:h)-t.hot_spot.x-(e.x-240)-(n?o.width:0),a.y=t.position.y%(i?o.height:h)-t.hot_spot.y-(e.y-135.5)-(i?o.height:0);for(var r=n?ut/o.width+3:1,s=i?lt/o.height+3:1,c=0;c<r;c++)for(var d=0;d<s;d++)St().drawImage(o.data,o.sx,o.sy,o.swidth,o.sheight,~~(a.x+c*o.width),~~(a.y+d*o.height),1*o.width,1*o.height)}},Bn=function(t,e){e||(e={x:0,y:0}),e.x=e.x||0,e.y=e.y||0,Math.abs(e.x)<p&&(e.x=0),t.position.x+=e.x*Math.cos(t.angle)+e.y*Math.sin(t.angle),t.position.y+=e.y*Math.cos(t.angle)-e.x*Math.sin(t.angle)},Yn=function(t){return un(t.animation,~~t.animation_frame)},Hn=function(t,e){return t.animation_frame=J(e,0,t.animation.frame_count),t},Wn=function(t,e){return!(!t||!e)&&(t.animation!=e&&(t.animation=e,t.hot_spot=e.hot_spot,t.animation_frame=0,t.animation_speed_factor=1),t)},Fn=function(t){var e=t.animation_frame+t.animation.fps*t.animation_speed_factor*z();return!t.animation.repeat&&e>t.animation.frame_count-1},Xn=function(t,e){var n=0,i=[];if(i[0]=[it(0,0),it(0,0),it(0,0),it(0,0)],i[1]=[it(0,0),it(0,0),it(0,0),it(0,0)],i[0][0]=ot(t.position,ct(t.hot_spot,-t.angle)),i[0][1]=at(i[0][0],ct(it(Yn(t).width,0),-t.angle)),i[0][2]=at(i[0][0],ct(it(Yn(t).width,Yn(t).height),-t.angle)),i[0][3]=at(i[0][0],ct(it(0,Yn(t).height),-t.angle)),i[1][0]=ot(e.position,ct(e.hot_spot,0)),i[1][1]=at(i[1][0],ct(it(Yn(e).width,0),0)),i[1][2]=at(i[1][0],ct(it(Yn(e).width,Yn(e).height),0)),i[1][3]=at(i[1][0],ct(it(0,Yn(e).height),0)),(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p)&&n++,(Math.abs(e.angle)<p||Math.abs(e.angle-m/2)<p||Math.abs(e.angle-m)<p||Math.abs(e.angle-3*m/2)<p)&&n++,n){for(var a=[],o=[],r=0;r<2;r++){a[r]=[];var s=Math.min(i[r][0].x,i[r][1].x),c=Math.min(i[r][0].y,i[r][1].y),d=Math.max(i[r][2].x,i[r][3].x),u=Math.max(i[r][2].y,i[r][3].y);a[r][0]=s,a[r][1]=c,a[r][2]=d,a[r][3]=u,s>d&&(o=tt(a[r][0],a[r][2]),a[r][0]=o[0],a[r][2]=o[1]),c>u&&(o=tt(a[r][1],a[r][3]),a[r][1]=o[0],a[r][3]=o[1])}return Z(a[0],a[1])}var l=[],_=[Math.max(Yn(t).width,Yn(t).height),Math.max(Yn(e).width,Yn(e).height)];for(r=0;r<2;r++)l[r]=rt(at(i[r][0],i[r][2]),.5);return function(t,e,n,i){return st(ot(t,n))<=e+i}(l[0],_[0],l[1],_[1])},zn=function(t,e){return Math.abs(t.angle)<p&&Math.abs(e.angle)<p?!!Xn(t,e)&&(t.position.x-t.hot_spot.x,t.position.y-t.hot_spot.y,e.position.x-e.hot_spot.x,e.position.y-e.hot_spot.y,Yn(t).data,Yn(e).data,!0):!!function(t,e){var n=it(0,0),i=it(0,0),a=it(0,0),o=it(0,0),r=[],s=[];return r=ti(Dn,t,r),s=ti(Dn,e,s),n.x=Math.min(r[0].x,Math.min(r[1].x,Math.min(r[2].x,r[3].x))),n.y=Math.min(r[0].y,Math.min(r[1].y,Math.min(r[2].y,r[3].y))),i.x=Math.min(s[0].x,Math.min(s[1].x,Math.min(s[2].x,s[3].x))),i.y=Math.min(s[0].y,Math.min(s[1].y,Math.min(s[2].y,s[3].y))),a.x=Math.max(r[0].x,Math.max(r[1].x,Math.max(r[2].x,r[3].x)))-n.x,a.y=Math.max(r[0].y,Math.max(r[1].y,Math.max(r[2].y,r[3].y)))-n.y,o.x=Math.max(s[0].x,Math.max(s[1].x,Math.max(s[2].x,s[3].x)))-i.x,o.y=Math.max(s[0].y,Math.max(s[1].y,Math.max(s[2].y,s[3].y)))-i.y,n.x+a.x>=i.x&&n.x<=i.x+o.x&&n.y+a.y>=i.y&&n.y<=i.y+o.y}(t,e)},$n=function(t,e,n,i,a,o,r,s,c,d,u,l){var p=Yn(t).width,_=Yn(t).height,f=t.position,h=at(f,ct(it(0,-_+n),-t.angle)),m=at(f,ct(it(0,-n),-t.angle)),g=at(f,ct(it(-p/2+n,.5*-_),-t.angle)),v=at(f,ct(it(p/2-n,.5*-_),-t.angle)),b=at(f,ct(it(-p/2+n,-_+n),-t.angle)),y=at(f,ct(it(p/2-n,-_+n),-t.angle)),x=at(f,ct(it(-p/2+n,-n),-t.angle)),k=at(f,ct(it(p/2-n,-n),-t.angle));return Qn(t,e,h,y,v,k,m,x,g,b,i,a,o,r,s,c,d,u,l)},Qn=function(t,e,n,i,a,o,r,s,c,d,u,l,p,_,f,h,m,g,v){var b=[n.x-e,n.y-e,n.x+e,n.y+e],y=[r.x-e,r.y-e,r.x+e,r.y+e],x=[c.x-e,c.y-e,c.x+e,c.y+e],k=[a.x-e,a.y-e,a.x+e,a.y+e],w=[d.x-e,d.y-e,d.x+e,d.y+e],E=[i.x-e,i.y-e,i.x+e,i.y+e],S=[s.x-e,s.y-e,s.x+e,s.y+e],M=[o.x-e,o.y-e,o.x+e,o.y+e];return u&&(n&&(l=Zn(u,b)),r&&(h=Zn(u,y)),c&&(g=Zn(u,x)),a&&(_=Zn(u,k)),d&&(v=Zn(u,w)),i&&(p=Zn(u,E)),s&&(m=Zn(u,S)),o&&(f=Zn(u,M))),{up:l,down:h,left:g,right:_,upleft:v,upright:p,downleft:m,downright:f}},Vn=function(t){On=t},Kn=function(t,e,n,i,a,o,r,s,c,d){var u,l=[n,i,a,c,d];for(u=0;u<l.length;u++){var p=l[u];p&&p.brick_ref&&2==p.brick_ref.property&&(p=null,l[u]=p)}if(r&&r.brick_ref&&2==r.brick_ref.property){var _=Math.min(15,r.brick_ref.image.height/3);t.speed.y>=0&&t.position.y<r.y+e+1+_||(s&&s==r&&(s=null),o&&o==r&&(o=null),r=null)}return{up:l[0],upright:l[1],right:l[2],left:l[3],upleft:l[4],downright:o,down:r,downleft:s}},qn=function(t,e,n){var i,a,o,r,s,c,d,u,l,_,f,h=it(0,0),g=z(),v=t.position,b=function(t,e,n,i,a,o,r,s,c,d){var u,l,_,f=Yn(t).width,h=Yn(t).height,g=!(Math.abs(t.angle)<p||Math.abs(t.angle-m/2)<p||Math.abs(t.angle-m)<p||Math.abs(t.angle-3*m/2)<p),v=t.position;return g?(u=1,l=.7,_=.25):(u=.7,l=.5,_=.25),{up:at(v,ct(it(0,-h*u+e),-t.angle)),down:at(v,ct(it(0,2),-t.angle)),left:at(v,ct(it(-f*_+e,-h*l),-t.angle)),right:at(v,ct(it(f*_-e,-h*l),-t.angle)),upleft:at(v,ct(it(-f*_+e,-h*u+e),-t.angle)),upright:at(v,ct(it(f*_-e,-h*u+e),-t.angle)),downleft:at(v,ct(it(-f*_+e,2),-t.angle)),downright:at(v,ct(it(f*_-e,2),-t.angle))}}(t,-2);b=function(t,e,n,i,a,o,r,s,c,d,u,l,p,_,f,h,m,g){return Qn(t,2,n,i,a,o,r,s,c,d,e,u,l,p,_,f,h,m,g)}(t,e,i=b.up,b.upright,a=b.right,b.downright,b.down,b.downleft,o=b.left,b.upleft,r,s,c,d,u,l,_,f),r=b.up,s=b.upright,c=b.right,d=b.downright,u=b.down,l=b.downleft,_=b.left,f=b.upleft;var y=Kn(t,-2,r,s,c,d,u,l,_,f);return r=y.up,s=y.upright,c=y.right,_=y.left,f=y.upleft,u=y.down,l=y.downleft,d=y.downright,function(t,e){var n=z();if(null!=t.carried_by){var i=t.carried_by;e&&0==e.brick_ref.angle&&i.speed.y>=5?(t.position=it(t.carried_by.position.x,t.carried_by.position.y),t.carried_by.carrying=null,t.carried_by=null):(t.speed=it(0,0),t.mirror=i.mirror,t.angle=0,t.position=ot(at(i.position,rt(i.speed,n)),t.carry_offset))}}(t,u),null!=t.carried_by?it(0,0):(function(t,e,n,i,a,o){o&&o.brick_ref.angle%90==0&&(t.speed.x>p||i.x>o.x)&&(t.speed.x=0,t.position.x=o.x+(e.x-i.x)),a&&a.brick_ref.angle%90==0&&(t.speed.x<-1e-5||n.x<a.x+a.brick_ref.image.width)&&(t.speed.x=0,t.position.x=a.x+a.brick_ref.image.width+(e.x-n.x))}(t,v,o,a,_,c),u?(t.is_jumping=!1,t.ignore_horizontal=!1,function(t,e,n,i,a){var o=i.brick_ref.angle;!Se(t.input,Ht)||Se(t.input,Ut)||a||(t.angle=0,t.is_jumping=!0,0==o?t.speed.y=-t.jump_strength:o>0&&o<90?(t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=-.7*t.jump_strength):90==o?(Bn(t,it(-40,0)),t.speed.x=Math.min(t.speed.x,-t.jump_strength),t.speed.y=-t.jump_strength/2):o>90&&o<180?(Bn(t,it(0,40)),t.speed.x=Math.min(t.speed.x,-.7*t.jump_strength),t.speed.y=t.jump_strength):180==o?(Bn(t,it(0,40)),t.speed.x*=-1,t.speed.y=t.jump_strength):o>180&&o<270?(Bn(t,it(0,40)),t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=t.jump_strength):270==o?(Bn(t,it(40,0)),t.speed.x=Math.max(t.speed.x,t.jump_strength),t.speed.y=-t.jump_strength/2):o>270&&o<360&&(t.speed.x=Math.max(t.speed.x,.7*t.jump_strength),t.speed.y=-.7*t.jump_strength))}(t,0,0,u,r)):t.angle=0,h.y=Math.abs(t.speed.y)>p?t.speed.y*g+1*n*.5*(g*g):0,t.speed.y=Math.min(t.speed.y+1*n*g,480),function(t,e,n,i){i&&i.brick_ref.angle%90==0&&t.speed.y<-1e-5&&(t.position.y=i.y+i.brick_ref.image.height+(e.y-n.y),t.speed.y=10)}(t,v,i,r),function(t,e,n,i,a,o,r,s,c){var d;if(z(),s&&!t.is_jumping)if(d=s.brick_ref.angle,t.speed.y=i.y=0,t.angle=d*m/180,0==d)t.position.y=a.y+e;else if(d>0&&d<90)a.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y+e,t.mirror;else if(90==d){if(Math.abs(t.speed.x)>5){var u=c?c.brick_ref.angle:-1;c&&u>=d&&u<d+90?(a.y=s.x,t.position.x=a.y+e):(t.angle=0,Bn(t,it(-13,0)),t.is_jumping=!0,t.speed=it(0,-.7*Math.abs(t.speed.x)))}else t.angle=0,Bn(t,it(-10,0)),t.is_jumping=!0,t.ignore_horizontal=!1;t.mirror}else d>90&&d<180?Math.abs(t.speed.x)>5?(a.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y-e):(t.angle=0,Bn(t,it(0,30)),t.is_jumping=!0):180==d?t.speed.x>5&&!(1&t.mirror)||t.speed.x<-5&&1&t.mirror?(a.y=s.y+s.brick_ref.image.height,t.position.y=a.y-e):(t.angle=0,Bn(t,it(0,40)),t.is_jumping=!0,t.speed.x=0):d>180&&d<270?Math.abs(t.speed.x)>5?(a.y=s.y+s.brick_ref.image.height-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y-e):(t.angle=0,Bn(t,it(0,30)),t.is_jumping=!0):270==d?(Math.abs(t.speed.x)>5?(u=r?r.brick_ref.angle:-1,r&&u>d-90&&u<=d?(a.y=s.x+s.brick_ref.image.width,t.position.x=a.y-e):(t.angle=0,Bn(t,it(13,0)),t.is_jumping=!0,t.speed=it(0,-.7*Math.abs(t.speed.x)))):(t.angle=0,Bn(t,it(10,0)),t.is_jumping=!0,t.ignore_horizontal=!1),t.mirror):d>270&&d<360&&(a.y=s.y-(t.position.x-s.x)*Math.tan(t.angle),t.position.y=a.y+e,t.mirror)}(t,-2,0,h,v,0,l,u,d),h.x=Math.abs(t.speed.x)>p?t.speed.x*g+1*t.acceleration*.5*(g*g):0,function(t,e,n){var i=z();if(Se(t.input,Bt)&&!Se(t.input,Yt))t.ignore_horizontal||Se(t.input,Ut)||(t.speed.x=Math.max(t.speed.x-1*t.acceleration*i,-t.maxspeed),t.mirror=1);else if(Se(t.input,Yt)&&!Se(t.input,Bt))t.ignore_horizontal||Se(t.input,Ut)||(t.speed.x=Math.min(t.speed.x+1*t.acceleration*i,t.maxspeed),t.mirror=0);else if(n){var a=0,o=n.brick_ref.angle;o%90==0?a=90==o&&1&t.mirror&&t.speed.x<0||270==o&&!(1&t.mirror)&&t.speed.x>0?t.speed.x>p?1:-t.speed.x>p?-1:0:t.speed.x>p?-1:-t.speed.x>p?1:0:(o>90&&o<180||o>180&&o<270)&&(a=t.speed.x>p?-1:-t.speed.x>p?1:0),t.speed.x+=1*a*t.acceleration*i}}(t,0,u),Math.abs(t.speed.x)<p&&(t.speed.x=h.x=0),h)},Jn=function(t){var e=z(),n=it(0,0);return t.input?(Se(t.input,Yt)&&!Se(t.input,Bt)&&(t.speed.x=Math.min(t.speed.x+t.acceleration*e,t.maxspeed)),Se(t.input,Bt)&&!Se(t.input,Yt)&&(t.speed.x=Math.max(t.speed.x-t.acceleration*e,-t.maxspeed)),!Se(t.input,Bt)&&!Se(t.input,Yt)&&Math.abs(t.speed.x)>p&&(t.speed.x>0?t.speed.x=Math.max(t.speed.x-t.acceleration*e,0):t.speed.x=Math.min(t.speed.x+t.acceleration*e,0)),Se(t.input,Ut)&&!Se(t.input,Gt)&&(t.speed.y=Math.min(t.speed.y+t.acceleration*e,t.maxspeed)),Se(t.input,Gt)&&!Se(t.input,Ut)&&(t.speed.y=Math.max(t.speed.y-t.acceleration*e,-t.maxspeed)),!Se(t.input,Gt)&&!Se(t.input,Ut)&&Math.abs(t.speed.y)>p&&(t.speed.y>0?t.speed.y=Math.max(t.speed.y-t.acceleration*e,0):t.speed.y=Math.min(t.speed.y+t.acceleration*e,0))):t.speed=it(0,0),n.x=Math.abs(t.speed.x)>p?t.speed.x*e+.5*t.acceleration*e*e:0,n.y=0,t.speed.x=n.x,t.speed.y=n.y,n},Zn=function(t,e){var n,i,a,o,r,s,c,d=null,u=!1;for(n=t;n&&!u;n=n.next)if(n.data){if(0==n.data.brick_ref.property||!n.data.enabled)continue;if(2==n.data.brick_ref.property&&d&&1==d.brick_ref.property)continue;if(1==n.data.brick_ref.behavior&&d&&1!=d.brick_ref.behavior&&n.data.y>=d.y)continue;if(Ln&&0==n.data.brick_ref.angle)continue;if(Nn&&180==n.data.brick_ref.angle)continue;if(An&&n.data.brick_ref.angle>0&&n.data.brick_ref.angle<180)continue;if(Rn&&n.data.brick_ref.angle>180&&n.data.brick_ref.angle<360)continue;var l=[n.data.x,n.data.y,n.data.x+n.data.brick_ref.image.width,n.data.y+n.data.brick_ref.image.height];if(Z(e,l))if(1!=n.data.brick_ref.behavior&&d&&1==d.brick_ref.behavior&&n.data.y<=d.y)d=n.data;else if(1==n.data.brick_ref.property&&d&&2==d.brick_ref.property)d=n.data;else if(2==n.data.brick_ref.property&&d&&2==d.brick_ref.property)n.data.y>d.y&&(d=n.data);else if(n.data.brick_ref.angle%90==0)d?On?d.brick_ref.angle%180!=0&&(d=n.data):d.brick_ref.angle%180==0&&(d=n.data):d=n.data;else for(i=n.data.brick_ref.angle,s=Math.tan(i*m/180),o=e[0];o<=e[2]&&!u;o++)for(r=e[1];r<=e[3]&&!u;r++){switch(a=!1,~~(i/90)%4){case 0:c=l[3]+s*(l[0]-o),a=l[0]<=o&&o<=l[2]&&c<=r&&r<=l[3];break;case 1:c=l[3]-s*(l[2]-o),a=l[0]<=o&&o<=l[2]&&l[1]<=r&&r<=c;break;case 2:c=l[3]-s*(l[0]-o),a=l[0]<=o&&o<=l[2]&&l[1]<=r&&r<=c;break;case 3:c=l[3]+s*(l[2]-o),a=l[0]<=o&&o<=l[2]&&c<=r&&r<=l[3]}a&&(d=n.data,u=!0)}}return d},ti=function(t,e,n){var i,a,o,r,s,c,d,u,l;return o=-e.angle,i=Yn(e).width,a=Yn(e).height,u=e.hot_spot,l=e.position,r=ot(it(0,0),u),s=ot(it(i,0),u),c=ot(it(i,a),u),d=ot(it(0,a),u),n[0]=at(l,ct(r,o)),n[1]=at(l,ct(s,o)),n[2]=at(l,ct(c,o)),n[3]=at(l,ct(d,o)),n},ei=function(t,e){return t.translate(e,0),t.scale(-1,1),t.translate(-e,0),t},ni=[],ii={},ai={},oi=function(t){for(var e={type:J(t,0,9),text:null,width:0,visible:!0,hspace:1,vspace:1,value:[],position:it(0,0)},n=0;n<5;n++)e.value[n]=0;return e},ri=function(t){t.text&&(t.text=null)},si=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!t)return!1;for(var a=0;a<n.length;a++)n[a]=""+n[a];var o=(e=""+e).match(/\$[A-Z_\d]\w+/g);if(o)for(a=0;a<o.length;a++){var r=o[a].slice(1),s=Ue(r);s&&(e=e.replace("$"+r,s))}if(o=e.match(/\%[s]+/g))for(a=0;a<o.length;a++)n[a]&&((r=n[a].match(/\$[A-Z_\d]\w+/g))&&(n[a]=r[0].slice(1)),e=e.replace("%s",Ue(n[a])));if(o=e.match(/\%[d]+/g))for(a=0;a<o.length;a++)n[a]&&(e=e.replace("%d",""+n[a]));return t.text=""+e,t},ci=function(t){return t.text?t.text:""},di=function(t){return pi(t)},ui=function(t,e){t.width=Math.max(0,e)},li=function(t,e){var n,i,a,o,r,s=0,c=0,d=[],u=0,l=0;d[l++]={disabled:!0,r:0,g:0,b:0};var p=pi(t);if(n=p.x,i=p.y,t&&t.visible&&t.text)for(u=0;u<t.text.length;u++){if(a=t.text[u],r=!1,V(t.text[u-1])){var _=void 0,f=!1,h=0,m=t.text.slice(u),g=(m=(m=m.replace("(","")).replace(")","")).split(" ")[0];for(_=0;_<g.length;_++)"<"==g[_]&&(f=!0),f||h++,">"==g[_]&&(f=!1);r=t.width>0&&s+(n+t.hspace)*h-t.hspace>t.width}if("<"==a){if("<color="==(f=t.text.slice(u,u+7))){u+=7;var v=t.text.slice(u,u+6),b={disabled:!1,r:fi(v.slice(0,2)),g:fi(v.slice(2,4)),b:fi(v.slice(4,6))};d[l++]=b,u+=7,a=t.text[u]}"</color"==f&&(u+=8,a=t.text[u],l>=2&&l--)}r&&(s=0,c+=i+t.vspace),"\n"!=a?(o=ni[t.type].ch[a])?(s+=o.width,V(t.text[u-1]),_i(a,St(),o,~~t.position.x+s-(e.x-240),~~t.position.y+c-(e.y-135.5),d[l-1])):s+=n+t.hspace:(s=0,c+=i+t.vspace)}},pi=function(t){var e,n;if(t)for(e=0;e<256;e++)if(ni[t.type]&&null!=(n=ni[t.type].ch[e]))return it(n.width,n.height);return it(16,16)},_i=function(t,e,n,i,a,o){var r,s;o&&!o.disabled?(r=hi(n.data),s=mi(t,n.data,r,o.r,o.g,o.b)):s=n.data,e.drawImage(s,n.sx,n.sy,n.swidth,n.sheight,i,a-2,1*n.width,1*n.height)},fi=function(t){var e=/^#?([a-f\d]{2})$/i.exec(t);return e?parseInt(e[1],16):null},hi=function(t){if(ii[t.src])return ii[t.src];var e=t.width,n=t.height,i=[],a=document.createElement("canvas");a.width=e,a.height=n;var o=a.getContext("2d");o.drawImage(t,0,0);for(var r=o.getImageData(0,0,e,n).data,s=0;s<4;s++){var c=document.createElement("canvas");c.width=e,c.height=n;var d=c.getContext("2d");d.drawImage(t,0,0);for(var u=d.getImageData(0,0,e,n),l=u.data,p=0,_=r.length;p<_;p+=4)l[p]=0===s?r[p]:0,l[p+1]=1===s?r[p+1]:0,l[p+2]=2===s?r[p+2]:0,l[p+3]=r[p+3];d.putImageData(u,0,0);var f=new Image;f.src=c.toDataURL(),i.push(f)}return ii[t.src]=i,i},mi=function(t,e,n,i,a,o){var r=t+"_"+i+"_"+a+"_"+o+"_"+e.src,s=ai[r];if(s)return s;var c=document.createElement("canvas");c.width=e.width,c.height=e.height;var d=c.getContext("2d");d.globalAlpha=1,d.globalCompositeOperation="copy",d.drawImage(n[3],0,0),d.globalCompositeOperation="lighter",i>0&&(d.globalAlpha=i/255,d.drawImage(n[0],0,0)),a>0&&(d.globalAlpha=a/255,d.drawImage(n[1],0,0)),o>0&&(d.globalAlpha=o/255,d.drawImage(n[2],0,0));var u=d.getImageData(0,0,c.width,c.height);d.putImageData(u,0,0);var l=new Image;return l.src=c.toDataURL(),gi(c)||(ai[r]=l),l},gi=function(t){for(var e=t.getContext("2d").getImageData(0,0,t.width,t.height),n=0;n<e.data.length;n+=4)if(0!==e.data[n+3])return!1;return!0},vi=[],bi=[],yi=0,xi=-1,ki=!1,wi=!1,Ei=function(){Qt=un(dn("SD_CONFIRMBOX",0),0),Vt=it((ut-Qt.width)/2,lt),Zt=we(),qt=Cn(),Wn(qt,dn("SD_TITLEFOOT",0)),Kt=oi(8),si(Kt,Jt),ui(Kt,164);for(var t=0;t<yi;t++)vi[t]=[],vi[t][0]=oi(8),vi[t][1]=oi(8),si(vi[t][0],bi[t]),si(vi[t][1],"<color=ffff00>%s</color>",bi[t]);xi=0,ki=!0,wi=!1},Si=function(){var t,e=z();if(ki&&(Vt.y<=(lt-Qt.height)/2?ki=!1:Vt.y-=1355*e),wi){if(Vt.y>=lt)return wi=!1,void We();Vt.y+=1355*e}for(qt.position=it(Vt.x+xi*Qt.width/yi+10,Vt.y+.75*Qt.height-1),Kt.position=it(Vt.x+10,Vt.y+10),t=0;t<yi;t++)vi[t][0].position=it(Vt.x+t*Qt.width/yi+25,Vt.y+.75*Qt.height),vi[t][1].position=vi[t][0].position;ki||wi||(Me(Zt,Bt)?(L(ze("choose")),xi=((xi-1)%yi+yi)%yi):Me(Zt,Yt)?(L(ze("choose")),xi=(xi+1)%yi):(Me(Zt,Ht)||Me(Zt,Ft))&&(L(ze("select")),wi=!0))},Mi=function(){var t,e,n=it(240,135.5);for(kt(),St().drawImage(Qt.data,Qt.sx,Qt.sy,Qt.swidth,Qt.sheight,Vt.x,Vt.y,Qt.swidth,Qt.sheight),li(Kt,n),t=0;t<yi;t++)e=t==xi?1:0,li(vi[t][e],n);Gn(qt,n)},ji=function(){Pn(qt),Ee(Zt),ri(Kt),an(void 0)},Ti=function(){if(-1!=xi){var t=xi+1;return xi=-1,t}return 0},Ii=function(t){return new Promise((function(e,n){E('background_load("'.concat(t,'")')),k(t).then(Ui).then((function(t){e({data:t,length:t.length})}))}))},Di=function(t){E("background_unload()");for(var e=0;e<t.length;e++)t.data[e]=Ni(t.data[e]);return null},Oi=function(t){if(!t)return!1;for(var e=0;e<t.length;e++){var n=t.data[e];n.strategy&&n.strategy.update&&n.strategy.update(n.strategy)}},Ri=function(t,e){Li(t,e,!1)},Ai=function(t,e){Li(t,e,!0)},Li=function(t,e,n){if(t){var i,a,o=it(240,135.5),r=ot(e,o);for(i=0;i<t.length;i++)a=t.data[i],(!n&&a.zindex<=.5||n&&a.zindex>.5)&&(a.actor.position.x+=r.x*a.actor.speed.x,a.actor.position.y+=r.y*a.actor.speed.y,Un(a.actor,o,a.repeat_x,a.repeat_y),a.actor.position.y-=r.y*a.actor.speed.y,a.actor.position.x-=r.x*a.actor.speed.x)}},Ni=function(t){return t.strategy=Ci(t.strategy),function(t){var e,n;if(null!=t.source_file&&(t.source_file=null),null!=t.frame_data&&(t.frame_data=null),null!=t.animation_data){for(e=0;e<t.animation_count;e++)t.animation_data[e]=(null!=(n=t.animation_data[e])&&(null!=n.data&&(n.data=null),n=null),null);t.animation_data=null}t=null}(t.data),Pn(t.actor),t=null,null},Ci=function(t){return null},Pi=function(t){},Gi=function(t){var e=t,n=t.background,i=z();n.actor.position.x+=e.speed_x*i,n.actor.position.y+=e.speed_y*i},Ui=function(t){return Promise.all(t.bg.map(Bi))},Bi=function(t){return new Promise((function(e,n){var i={actor:Cn(),data:null,strategy:null,repeat_x:!1,repeat_y:!1,zindex:0};switch(i.actor.spawn_point.x=t.initial_position.xpos,i.actor.spawn_point.y=t.initial_position.ypos,i.actor.position=it(i.actor.spawn_point.x,i.actor.spawn_point.y),i.actor.speed.x=t.scroll_speed.xspeed,i.actor.speed.y=t.scroll_speed.yspeed,t.behavior&&K(t.behavior)?t.behavior[0]:t.behavior){case"DEFAULT":i.strategy&&(i.strategy=Ci(i.strategy)),i.strategy={background:i,update:Pi};break;case"LINEAR":i.strategy&&(i.strategy=Ci(i.strategy)),i.strategy=function(t,e,n){var i={background:t,update:Gi},a=i;return a.speed_x=e,a.speed_y=n,i}(i,t.behavior[1],t.behavior[2]);break;case"CIRCULAR":i.strategy&&(i.strategy=Ci(i.strategy)),i.strategy=function(t,e,n,i,a,o,r){var s={background:t,update:Gi},c=s;return c.timer=0,c.amplitude_x=e,c.amplitude_y=n,c.angularspeed_x=2*m*i,c.angularspeed_y=2*m*a,c.initialphase_x=o*m/180,c.initialphase_y=r*m/180,s}(i,t.behavior[1],t.behavior[2],t.behavior[3],t.behavior[4],t.behavior[5],t.behavior[6])}i.repeat_x=t.repeat_x,i.repeat_y=t.repeat_y,t.zindex&&(i.zindex=t.zindex),ln(t.sprite).then((function(t){i.data=t,i.actor.animation=t,i.actor.animation.data=[0],e(i)}))}))},Yi=["<color=ffff00>$CREDITS_ENGINE</color>\n\n","<color=ffff00>$CREDITS_ACTIVE</color>\n\n","Alexandre Martins:\n$CREDITS_ALEXANDRE\n\n","Di Rodrigues:\n$CREDITS_DI\n\n","Colin:\n$CREDITS_COLIN\n\n","Mateus Reis:\n$CREDITS_MATEUSREIS\n\n","Christopher Martinus:\n$CREDITS_CHRISTOPHER\n\n","Celdecea:\n$CREDITS_CELDECEA\n\n","Christian Zigotzky:\n$CREDITS_XENO\n\n","Joepotato28:\n$CREDITS_JOE\n\n","Arthur Blot:\n$CREDITS_ARTHURBLOT\n\n","Reimund Renner:\n$CREDITS_REIMUND\n\n","Szymon Weihs:\n$CREDITS_SZYMON\n\n","Tomires:\n$CREDITS_TOMIRES\n\n","Sascha de waal:\n$CREDITS_SSDW\n\n","Francesco Sciusco:\n$CREDITS_FRANCESCO\n\n","<color=ffff00>$CREDITS_THANKS</color>\n\n","SourceForge.net\n","allegro.cc\n","OpenGameArt.org\n","GagaGames.com.br\n","Rsonist88\n","PlayDeb.net\n\n","<color=ffff00>$CREDITS_RETIRED</color>\n\n","Neoblast:\n$CREDITS_NEOBLAST\n\n","Bastian von Halem:\n$CREDITS_BASTIAN\n\n","Lainz:\n$CREDITS_LAINZ\n\n","Jogait:\n$CREDITS_JOGAIT\n\n"],Hi=!1,Wi=0,Fi=function(){Hi=!1,ae=we(),ee=oi(4),si(ee,Ue("CREDITS_TITLE")),ee.position.x=140,ee.position.y=5,ie=oi(8),si(ie,Ue("CREDITS_KEY")),ie.position.x=10,ie.position.y=lt-di(ie).y-5,ne=oi(8);for(var t=0;t<Yi.length;t++){var e=Yi[t],n=e.match(/\$[A-Z_\d]\w+/m);if(n){for(var i=0;i<n.length;i++){var a=n[i].slice(1),o=Ue(a);o&&(e=e.replace("$"+a,o))}Yi[t]=e}}si(ne,Yi.join(""),"%s"),ui(ne,300),ne.position.x=10,ne.position.y=lt,Wi=1;var r=ci(ne);for(t=0;t<r.length;t++)"\n"==r[t]&&Wi++;Wi+=10,te=qe(ut,30),Ii("data/themes/credits.bg.json").then((function(t){oe=t,vt(en(0,0,0),1)})),vt(en(0,0,0),1)},Xi=function(){var t,e=z();if(Oi(oe),ne.position.y-=3*di(ne).y*e,ne.position.y<-Wi*(di(ne).y+(t=ne,it(t.hspace,t.vspace)).y)&&(ne.position.y=lt),Hi||xt()||(Me(ae,Ft)?(L(ze("select")),Hi=!0):Me(ae,Xt)&&(L(ze("return")),Hi=!0)),!R()){var n=j("data/music/options.mp4");T(n,!0)}if(Hi){if(yt())return void We();bt(en(0,0,0),1)}},zi=function(){kt();var t=it(240,135.5);Ri(oe,t),Ai(oe,t),li(ne,t),St().fillRect(0,0,te.width,te.height),St().fillRect(0,251,te.width,te.height),li(ee,t),li(ie,t)},$i=function(){oe=Di(oe),an(te),ri(ee),ri(ne),ri(ie),Ee(ae)},Qi=10,Vi=0,Ki=null,qi=null,Ji=[],Zi=function(){var t;for(Vi=$(),(Ki=oi(8)).position=it(5,35),qi=oi(4),si(qi,Ue("ENDOFDEMO_TITLE")),qi.position=it((ut-di(qi).x*ci(qi).length)/2,5),t=0;t<Qi;t++)Ji[t]=Cn(),Ji[t].spawn_point=Ji[t].position=it(ut*t/Qi+15,215),Wn(Ji[t],dn(t%2==1?"SD_BLUERING":"SD_RING",0));vt(en(0,0,0),2)},ta=function(){var t,e=$(),n=Math.max(0,(3-(e-Vi))/1e3);if(si(Ki,Ue("ENDOFDEMO_TEXT"),u,l,n),e>=Vi+3){if(yt())return We(),void He(gy(uy));bt(en(0,0,0),2)}for(t=0;t<Qi;t++)Ji[t].position.y=Ji[t].spawn_point.y+10*Math.sin(m*(.001*e)+2*m/Qi*t)},ea=function(){var t,e=it(240,135.5);for(kt(),t=0;t<Qi;t++)Gn(Ji[t],e);li(qi,e),li(Ki,e)},na=function(){var t;for(t=0;t<Qi;t++)Pn(Ji[t]);ri(qi),ri(Ki)},ia={is_locked:!1,position:it(0,0),dest:it(0,0),speed:0,region_topleft:it(0,0),region_bottomright:it(0,0),dest_region_topleft:it(0,0),dest_region_bottomright:it(0,0),region_topleft_speed:0,region_bottomright_speed:0},aa=function(t,e){t.x<ia.region_topleft.x&&(t.x=ia.region_topleft.x),t.y<ia.region_topleft.y&&(t.y=ia.region_topleft.y),t.x>ia.region_bottomright.x&&(t.x=ia.region_bottomright.x),t.y>ia.region_bottomright.y&&(t.y=ia.region_bottomright.y),ia.dest=t,e>p?ia.speed=st(ot(ia.position,ia.dest))/e:ia.position=ia.dest,ia.position.x=t.x,ia.position.y=t.y},oa=function(){return it(ia.position.x,ia.position.y)},ra=function(t){ia.dest=ia.position=t},sa=function(t,e,n,i){ia.dest_region_topleft.x=Math.max(Math.min(t,n),240),ia.dest_region_topleft.y=Math.max(Math.min(e,i),135.5),ia.dest_region_bottomright.x=Math.min(Math.max(t,n),Mh().x-240),ia.dest_region_bottomright.y=Math.min(Math.max(e,i),Mh().y-135.5),ia.region_topleft_speed=st(ot(ia.region_topleft,ia.dest_region_topleft))/.25,ia.region_bottomright_speed=st(ot(ia.region_bottomright,ia.dest_region_bottomright))/.25},ca=function(t){},da=function(t){},ua=function(t,e,n,i,a,o){},la=function(t,e){var n=t.get_object_instance(t).actor,i=n.position;n.position=it(n.position.x,n.position.y),Gn(n,e),n.position=i},pa=function(t){return t.object},_a=function(t){return t.reference_to_current_state},fa=function(t,e){var n=ma(t.state_list,e);return null!=n?t.reference_to_current_state=n.data:E("Object script error: can't find state ".concat(e)),t},ha=function(t){if(null!=t){var e=t.data;ha(t.next),e.release(e)}return null},ma=function(t,e){return null!=t?t.name==e?ma(t.next,e):t:null},ga=function(t){var e=t.decorated_machine;return e.get_object_instance(e)},va=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),t.actor.maxspeed=145+q(21),t.actor.input=xe(),e.is_running=!1,e.animal_id=q(12),Wn(t.actor,dn("SD_ANIMAL",0))},ba=function(t){Pn(t.actor)},ya=function(t,e,n,i,a,o){var r,s,c,d,u=t,l=t.actor,_=2*u.animal_id+(u.is_running?1:0);Te(l.input,Ht),l.jump_strength=1.3*(200+q(50)),l.speed.x>p?(l.speed.x=l.maxspeed,l.mirror=0):l.speed.x<-1e-5&&(l.speed.x=-l.maxspeed,l.mirror=1),Wn(l,dn("SD_ANIMAL",_));var f=$n(l,2,-2,i,r,null,d,null,s,null,c,null);r=f.up,f.upright,d=f.right,f.downright,s=f.down,f.downleft,c=f.left,f.upleft;var h=Kn(l,-2,r,null,d,null,s,null,c,null);r=h.up,h.upright,d=h.right,h.downright,s=h.down,h.downleft,c=h.left,h.upleft,s&&!u.is_running&&(u.is_running=!0,l.speed.x=(q(2)?-1:1)*l.maxspeed),c&&!r&&(l.speed.x=l.maxspeed),d&&!r&&(l.speed.x=-l.maxspeed),!u.is_running&&(s&&r||c&&d)&&(t.state=Es),Bn(l,qn(l,i,Ph()))},xa=function(t,e){Gn(t.actor,e)},ka=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),Ma(t,ja()),Wn(t.actor,dn("SD_ENDLEVEL",0))},wa=function(t){Pn(t.actor),Ma(t,null)},Ea=function(t,e,n,i,a,o){var r=t;r.state.handle(r.state,t,e,n)},Sa=function(t,e){Gn(t.actor,e)},Ma=function(t,e){t.state=e},ja=function(){var t={handle:Ta},e=t;return e.being_hit=!1,e.hit_count=0,t},Ta=function(t,e,n,i){for(var a,o,r=t,s=e.actor,c=0;c<i;c++){var d=n[c];Ra(e,d)&&!r.being_hit&&(r.being_hit=!0,Wn(s,dn("SD_ENDLEVEL",1)),L(ze("boss hit")),Ks(d),d.actor.speed.x*=-.5,++r.hit_count>=3&&Ma(e,(a=void 0,o=void 0,o=a={handle:Ia},a.handle=Ia,o.explode_timer=0,o.break_timer=0,a)))}Fn(s)&&r.being_hit&&(Wn(s,dn("SD_ENDLEVEL",0)),r.being_hit=!1)},Ia=function(t,e,n,i){var a=t,o=e.actor,r=z();if(a.explode_timer+=r,a.break_timer+=r,a.explode_timer>=.1){var s=it(o.position.x-o.hot_spot.x+q(Yn(o).width),o.position.y-o.hot_spot.y+q(Yn(o).height/2));Uh(hs,s),L(ze("explode")),a.explode_timer=0}a.break_timer>=2&&Ma(e,{handle:Da})},Da=function(t,e,n,i){for(var a=e.actor,o=0;o<20;o++){var r=it(a.position.x-a.hot_spot.x+q(Yn(a).width),a.position.y-a.hot_spot.y+q(Yn(a).height/2));Wh(r)}Ih(a),Wn(a,dn("SD_ENDLEVEL",2)),Ma(e,{handle:Oa})},Oa=function(t,e,n,i){},Ra=function(t,e){if(t&&e){var n=[],i=[],a=t.actor,o=e.actor;return n[0]=o.position.x-o.hot_spot.x,n[1]=o.position.y-o.hot_spot.y,n[2]=n[0]+Yn(o).width,n[3]=n[1]+Yn(o).height,i[0]=a.position.x-a.hot_spot.x+5,i[1]=a.position.y-a.hot_spot.y,i[2]=i[0]+Yn(a).width-10,i[3]=i[1]+Yn(a).height/2,qs(e)&&Z(n,i)&&zn(a,o)}},Aa=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn("SD_BLUERING",0))},La=function(t){Pn(t.actor)},Na=function(t,e,n,i,a,o){for(var r=0;r<n;r++){var s=e[r];s&&!s.dying&&Xn(s.actor,t.actor)&&(t.state=Es,ec(Js()+50),Dh(5e3),L(ze("big ring")),Oh("$BONUSMSG_TITLE","$BONUSMSG_TEXT"),Mg(hg,jg(hg)+1))}},Ca=function(t,e){Gn(t.actor,e)},Pa=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_disappearing=!1,Wn(t.actor,dn("SD_BLUERING",0))},Ga=function(t,e,n,i,a,o){var r=wh(),s=t,c=t.actor;c.visible=r.got_glasses||kh(),s.is_disappearing?Fn(c)&&(t.state=Es):!r.dying&&r.got_glasses&&Xn(c,r.actor)&&(Wn(c,dn("SD_BLUERING",1)),ec(Js()+5),L(ze("blue ring")),s.is_disappearing=!0)},Ua=function(t,e){Gn(t.actor,e)},Ba=function(t){Pn(t.actor)},Ya=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.getting_hit=!1,Wn(t.actor,dn("SD_BUMPER",0))},Ha=function(t,e,n,i,a,o){for(var r=t,s=t.actor,c=0;c<n;c++){var d=e[c];d&&!d.dying&&zn(d.actor,s)&&(r.getting_hit||(r.getting_hit=!0,Wn(s,dn("SD_BUMPER",1)),L(ze("bumper")),Xa(t,d)))}r.getting_hit&&Fn(s)&&(r.getting_hit=!1,Wn(s,dn("SD_BUMPER",0)))},Wa=function(t,e){Gn(t.actor,e)},Fa=function(t){Pn(t.actor)},Xa=function(t,e){var n,i,a,o=t.actor;(n=e.actor.speed).x=n.x<0?Math.min(-300,n.x):Math.max(300,n.x),i=rt(dt(ot(o.position,e.actor.position)),st(n)),a=rt(i,1),e.actor.speed=rt(at(n,rt(a,-1e4)),1/10001),o.speed=rt(at(n,a),1/10001),e.flying=!1,e.landing=!1,e.climbing=!1,e.spring=!1},za=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_active=!1,Wn(t.actor,dn("SD_CHECKPOINT",0))},$a=function(t,e,n,i,a,o){var r=t,s=t.actor;if(r.is_active)Fn(s)&&Wn(s,dn("SD_CHECKPOINT",2));else for(var c=0;c<n;c++){var d=e[c];if(d&&!d.dying&&zn(d.actor,s)){r.is_active=!0,L(ze("checkpoint")),Th(s.position),Wn(s,dn("SD_CHECKPOINT",1));break}}},Qa=function(t,e){Gn(t.actor,e)},Va=function(t){Pn(t.actor)},Ka=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn("SD_ITEMBOX",10))},qa=function(t,e,n,i,a,o){},Ja=function(t,e){Gn(t.actor,e)},Za=function(t){Pn(t.actor)},to=function(t,e){var n={init:eo,release:ao,update:no,render:io},i=n;return n.init=eo,n.release=ao,n.update=no,n.render=io,i.sprite_name=t,i.player_is_vulnerable=e,n},eo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn(e.sprite_name,0))},no=function(t,e,n,i,a,o){for(var r=t,s=t.actor,c=0;c<n;c++){var d=e[c];d&&(d.dying||d.blinking||d.invincible||!Xn(s,d.actor)||r.player_is_vulnerable(d)&&Qs(d))}s.visible=kh()},io=function(t,e){Gn(t.actor,e)},ao=function(t){Pn(t.actor)},oo=function(t){return!0},ro=function(t){return t.shield_type!=Cs},so=function(t,e){t.actor.speed=e},co=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),Wn(t.actor,dn("SD_DANGPOWER",0))},uo=function(t,e,n,i,a,o){for(var r=z(),s=t.actor,c=rt(s.speed,r),d=0;d<n;d++){var u=e[d];u&&!u.dying&&Xn(s,u.actor)&&(Qs(u),t.state=Es)}s.position=at(s.position,c)},lo=function(t,e){Gn(t.actor,e)},po=function(t){Pn(t.actor)},_o=function(t,e){var n={init:fo,release:go,update:ho,render:mo},i=n;return i.authorized_player_type=t,i.is_vertical_door=e,n},fo=function(t){var e,n,i=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Cn(),n=i.authorized_player_type,e=i.is_vertical_door?"SD_DNADOOR":"SD_HORIZONTALDNADOOR",Wn(t.actor,dn(e,n))},ho=function(t,e,n,i,a,o){var r,s=t,c=t.actor,d=!1,u=!1,l=z(),p=[],_=[];t.obstacle=!0;for(var f=0;f<n;f++){var h=e[f];h&&(h.dying||h.actor.carrying||h.actor.carried_by||!vo(h,t)||(h.type==s.authorized_player_type?(t.obstacle=!1,u=zn(c,h.actor)):d=!0))}if(d&&(t.obstacle=!0),t.obstacle?c.alpha=Math.min(1,c.alpha+2*l):u&&(c.alpha=Math.max(.4,c.alpha-2*l)),u)for(p[0]=c.position.x-c.hot_spot.x-5,p[1]=c.position.y-c.hot_spot.y-5,p[2]=p[0]+Yn(c).width+10,p[3]=p[1]+Yn(c).height+10,r=a;null!=r;r=r.next)r.data.type==t.type&&(_[0]=r.data.actor.position.x-r.data.actor.hot_spot.x-5,_[1]=r.data.actor.position.y-r.data.actor.hot_spot.y-5,_[2]=_[0]+Yn(r.data.actor).width+10,_[3]=_[1]+Yn(r.data.actor).height+10,Z(p,_)&&(r.data.actor.alpha<c.alpha?c.alpha=r.data.actor.alpha:r.data.actor.alpha=c.alpha))},mo=function(t,e){Gn(t.actor,e)},go=function(t){Pn(t.actor)},vo=function(t,e){var n=[],i=[],a=t.actor,o=e.actor;return n[0]=a.position.x-a.hot_spot.x,n[1]=a.position.y-a.hot_spot.y,n[2]=n[0]+Yn(a).width,n[3]=n[1]+Yn(a).height,i[0]=o.position.x-o.hot_spot.x,i[1]=o.position.y-o.hot_spot.y-3,i[2]=i[0]+Yn(o).width,i[3]=i[1]+Yn(o).height+3,Z(n,i)},bo=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_closed=!0,Wn(t.actor,dn("SD_DOOR",0))},yo=function(t,e,n,i,a,o){var r=t,s=t.actor,c=z();r.is_closed?s.position.y=Math.min(s.position.y+2e3*c,s.spawn_point.y):s.position.y=Math.max(s.position.y-2e3*c,s.spawn_point.y-.8*Yn(s).height)},xo=function(t,e){Gn(t.actor,e)},ko=function(t){Pn(t.actor)},wo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Cn(),e.who=null,Wn(t.actor,dn("SD_ENDSIGN",0))},Eo=function(t,e,n,i,a,o){var r=t,s=t.actor;if(null==r.who){var c=void 0;for(c=0;c<n;c++){var d=e[c];d&&!d.dying&&zn(d.actor,s)&&(r.who=d,L(ze("end sign")),Wn(s,dn("SD_ENDSIGN",1)),Ih(t.actor))}}else if(Fn(s)){var u=2+r.who.type;Wn(s,dn("SD_ENDSIGN",u))}},So=function(t,e){Gn(t.actor,e)},Mo=function(t){Pn(t.actor)},jo=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),Wn(t.actor,dn("SD_EXPLOSION",q(2)))},To=function(t,e,n,i,a,o){Fn(t.actor)&&(t.state=Es)},Io=function(t,e){Gn(t.actor,e)},Do=function(t){Pn(t.actor)},Oo=function(t){t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),Wn(t.actor,dn("SD_GLASSES",4)),t.actor.hot_spot.y*=.5},Ro=function(t,e,n,i,a,o){var r=t.actor,s=z();r.angle+=Math.sign(r.speed.x)*(6*m*s),r.position=at(r.position,function(t,e){var n=z(),i=it(0,0);return i.x=t.speed.x*n,i.y=t.speed.y*n+.5*e*n*n,t.speed.y+=e*n,i}(r,Ph()))},Ao=function(t,e){Gn(t.actor,e)},Lo=function(t){Pn(t.actor)},No=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),e.elapsed_time=0,e.font=oi(0),si(e.font,"0"),Wn(t.actor,dn("SD_RING",0)),t.actor.visible=!1},Co=function(t,e,n,i,a,o){var r=t,s=z();r.elapsed_time+=s,r.elapsed_time<.5?t.actor.position.y-=100*s:r.elapsed_time>2&&(t.state=Es),r.font.position=t.actor.position},Po=function(t,e){li(t.font,e)},Go=function(t){var e=t;Pn(t.actor),ri(e.font)},Uo=function(t,e,n,i){for(var a=f,o=null,r=null,s=e;s;s=s.next)s.data&&s.data.type==n&&(r=ot(s.data.actor.position,t.actor.position),st(r)<a&&(o=s.data,a=st(r)));return i&&(i.dist=a),o},Bo=function(t){t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn("SD_GOAL",0))},Yo=function(t,e,n,i,a,o){var r,s=Uo(t,a,vs,null);r=null!=s?s.actor.position.x>t.actor.position.x?0:1:0,Wn(t.actor,dn("SD_GOAL",r))},Ho=function(t,e){Gn(t.actor,e)},Wo=function(t){Pn(t.actor)},Fo=function(t,e){Wn(t.actor,dn("SD_ICON",e))},Xo=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!1,t.actor=Cn(),e.elapsed_time=0,Fo(t,0)},zo=function(t,e,n,i,a,o){var r=t,s=t.actor,c=z();if(r.elapsed_time+=c,r.elapsed_time<1)s.position.y-=40*c;else if(r.elapsed_time>=2.5){var d=void 0,u=void 0,l=s.position.x-s.hot_spot.x,p=s.position.y-s.hot_spot.y,_=Yn(s),f=void 0;for(d=0;d<_.height;d++)for(u=0;u<_.width;u++)f=qe(1,1),nn(f,255,255,255),Yh(f,it(l+u,p+d),it(u-_.width/2+(q(_.width)-_.width/2),d-q(_.height/2)),!1);t.state=Es}},$o=function(t,e){Gn(t.actor,e)},Qo=function(t){Pn(t.actor)},Vo=function(t,e){Sh(100),nc(Zs()+1),jh(ze("1up"))},Ko=function(t,e){Sh(100),ec(Js()+10),L(ze("ring"))},qo=function(t,e){Sh(100),e.invincible=!0,e.invtimer=0,T(j("data/music/invincible.mp4"),!1)},Jo=function(t,e){Sh(100),e.got_speedshoes=!0,e.speedshoes_timer=0,T(j("data/music/speed.mp4"),!1)},Zo=function(t,e){Sh(100),e.got_glasses=!0},tr=function(t,e){Sh(100),e.shield_type=Ns,L(ze("shield"))},er=function(t,e){Sh(100),e.shield_type=Cs,L(ze("fire shield"))},nr=function(t,e){Sh(100),e.shield_type=Ps,L(ze("thunder shield"))},ir=function(t,e){Sh(100),e.shield_type=Gs,L(ze("water shield"))},ar=function(t,e){Sh(100),e.shield_type=Us,L(ze("acid shield"))},or=function(t,e){Sh(100),e.shield_type=Bs,L(ze("wind shield"))},rr=function(t,e){Qs(e)},sr=function(t,e){Sh(100)},cr=function(t,e){var n={init:dr,release:pr,update:ur,render:lr},i=n;return i.on_destroy=t,i.anim_id=e,n},dr=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!1,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn("SD_ITEMBOX",e.anim_id))},ur=function(t,e,n,i,a,o){for(var r=t.actor,s=t,c=0;c<n;c++){var d=e[c];if(d&&!(d.actor.is_jumping&&d.actor.speed.y<-10)&&t.state===ws&&_r(t,d)&&qs(d)){var u=Uh(fs,at(r.position,it(0,-5)));Fo(u,s.anim_id),Uh(hs,at(r.position,it(0,-20))),Uh(_s,r.position),L(ze("destroy")),d.actor.is_jumping&&Ks(d),s.on_destroy(t,d),t.state=Es}}s.anim_id=s.anim_id<e.length?Eh():s.anim_id,Wn(t.actor,dn("SD_ITEMBOX",s.anim_id))},lr=function(t,e){Gn(t.actor,e)},pr=function(t){Pn(t.actor)},_r=function(t,e){var n,i=t.actor.position;return n=Xn(t.actor,e.actor),t.actor.position=i,n},fr=function(t,e){var n={init:hr,release:mr,update:gr,render:vr},i=n;return i.on_collision=t,i.sprite_name=e,n},hr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Cn(),Wn(t.actor,dn(e.sprite_name,0))},mr=function(t){Pn(t.actor)},gr=function(t,e,n,i,a,o){var r=t,s=t.actor;s.visible=!1;for(var c=0;c<n;c++){var d=e[c];d&&Xn(s,d.actor)&&(d.at_loopfloortop=br(t,a,d),r.on_collision(d))}},vr=function(t,e){Gn(t.actor,e)},br=function(t,e,n){var i=Uo(t,e,bs,null);return null!=i&&Xn(n.actor,i.actor)},yr=function(t){t.disable_wall|=Os,t.entering_loop=!0,t.bring_to_back=!1},xr=function(t){if(!t.flying){var e=t.actor.speed.x>0;t.disable_wall&=~(Os|Is),t.disable_wall|=e?Is:Os,t.bring_to_back=e}},kr=function(t){t.disable_wall|=Is,t.entering_loop=!0,t.bring_to_back=!0},wr=function(t){t.entering_loop||(t.disable_wall=Ts,t.bring_to_back=!1)},Er=function(t){t.at_loopfloortop||t.flying||(t.disable_wall|=Ds,t.entering_loop=!0,t.bring_to_back=!0)},Sr=function(t){t.at_loopfloortop||t.entering_loop||t.flying||(t.disable_wall&=~Ds,t.bring_to_back=!1)},Mr=function(t){if(!t.flying)if(t.disable_wall&Ds){var e=t.actor.speed.x>0;t.disable_wall&=~(Os|Is),t.disable_wall|=e?Is:Os,t.bring_to_back=!0}else t.disable_wall&=~(Os|Is),t.bring_to_back=!0},jr=function(t){t.is_moving=!0,t.actor.speed.x=t.actor.maxspeed*(q(100)-50)/100,t.actor.speed.y=-t.actor.jump_strength+q(t.actor.jump_strength)},Tr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!1,t.preserve=!0,t.actor=Cn(),t.actor.maxspeed=220+q(140),t.actor.jump_strength=1.2*(350+q(50)),t.actor.input=xe(),e.is_disappearing=!1,e.is_moving=!1,e.life_time=0,Wn(t.actor,dn("SD_RING",0))},Ir=function(t){Pn(t.actor)},Dr=function(t,e,n,i,a,o){for(var r=z(),s=t,c=t.actor,d=0;d<n;d++){var u=e[d];if(u&&(!s.is_moving||s.is_moving&&!u.getting_hit&&s.life_time>=.5)&&!s.is_disappearing&&!u.dying&&Xn(c,u.actor)){ec(Js()+1),s.is_disappearing=!0,L(ze("ring"));break}}if(s.is_disappearing)Wn(c,dn("SD_RING",1)),Fn(c)&&(t.state=Es);else if(s.is_moving){if(Te(c.input,Ht),t.preserve=!1,s.life_time+=r,s.life_time>5){var l=240+q(20);c.visible=$()%l<l/2,s.life_time>8&&(t.state=Es)}Bn(c,qn(c,i,Ph()))}},Or=function(t,e){Gn(t.actor,e)},Rr=function(t,e,n){var i={init:Ar,release:Lr,update:Nr,render:Cr},a=i;return a.collision=t,a.anim_id=e,a.cycle_length=n,i},Ar=function(t){var e=t;t.obstacle=!0,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.timer=0,e.hidden=!1,Wn(t.actor,dn("SD_SPIKES",e.anim_id))},Lr=function(t){Pn(t.actor)},Nr=function(t,e,n,i,a,o){var r=t,s=z();if(r.timer+=s,r.timer>=.5*r.cycle_length&&(r.timer=0,r.hidden=!r.hidden,L(ze(r.hidden?"spikes disappearing":"spikes appearing"))),t.obstacle=!r.hidden,t.actor.visible=!r.hidden,!r.hidden)for(var c=0;c<n;c++){var d=e[c];if(d&&!d.dying&&!d.blinking&&!d.invincible&&r.collision(t,d)){var u=ze("spikes hit");C(u)||L(u),Qs(d)}}},Cr=function(t,e){Gn(t.actor,e)},Pr=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x,n[1]=i.position.y-i.hot_spot.y,n[2]=n[0]+Yn(i).width,n[3]=n[1]+Yn(i).height,Z(n,e)},Gr=function(t,e){var n,i=[],a=t.actor;return i[0]=a.position.x-a.hot_spot.x+5,i[1]=a.position.y-a.hot_spot.y-5,i[2]=i[0]+Yn(a).width-10,i[3]=i[1]+10,n=e.actor.position.y-e.actor.hot_spot.y+Yn(e.actor).height,Pr(e,i)&&n<a.position.y-a.hot_spot.y+Yn(a).height/2},Ur=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x+5,n[1]=i.position.y-i.hot_spot.y+Yn(i).height-5,n[2]=n[0]+Yn(i).width-10,n[3]=n[1]+10,Pr(e,n)},Br=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x+Yn(i).width-5,n[1]=i.position.y-i.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Yn(i).height-10,Pr(e,n)},Yr=function(t,e){var n=[],i=t.actor;return n[0]=i.position.x-i.hot_spot.x-5,n[1]=i.position.y-i.hot_spot.y+5,n[2]=n[0]+10,n[3]=n[1]+Yn(i).height-10,Pr(e,n)},Hr=function(t,e,n){var i={init:Wr,release:Fr,update:Xr,render:zr},a=i;return a.on_bump=t,a.sprite_name=e,a.strength=n,i},Wr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_bumping=!1,e.bang_timer=0,Wn(t.actor,dn(e.sprite_name,0))},Fr=function(t){Pn(t.actor)},Xr=function(t,e,n,i,a,o){var r=t,s=z();r.bang_timer+=s;for(var c=0;c<n;c++){var d=e[c];d&&!d.dying&&zn(d.actor,t.actor)&&r.on_bump(t,d)}r.is_bumping&&Fn(t.actor)&&(Wn(t.actor,dn(r.sprite_name,0)),r.is_bumping=!1)},zr=function(t,e){Gn(t.actor,e)},$r=function(t,e){e.actor.speed.y>=1&&!e.actor.carrying&&!e.actor.carried_by&&Vr(t,e)},Qr=function(t,e){Vr(t,e)},Vr=function(t,e){var n=t;t.is_bumping=!0,function(t,e){var n=z(),i=[],a=[];i[0]=e.x*t.actor.speed.x>=0,i[1]=e.y*t.actor.speed.y>=0,a[0]=e.x*t.actor.speed.x<=0&&Math.abs(e.x)>p,a[1]=e.y*t.actor.speed.y<=0&&Math.abs(e.y)>p,Math.abs(e.y)>p&&(t.spring=!0),t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1,(Math.abs(e.x)>Math.abs(t.actor.speed.x)&&i[0]||a[0])&&(t.actor.speed.x=e.x),(Math.abs(e.y)>Math.abs(t.actor.speed.y)&&i[1]||a[1])&&(t.actor.speed.y=e.y,t.actor.position.y+=t.actor.speed.y*n)}(e,t.strength),Wn(n.actor,dn(t.sprite_name,1)),t.strength.x>p?e.actor.mirror&=-2:t.strength.x<-1e-5&&(e.actor.mirror|=1),t.bang_timer>.2&&(L(ze("spring")),t.bang_timer=0)},Kr=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_disabled=!1,e.is_active=!1,e.timer=0,Wn(t.actor,dn("SD_TELEPORTER",0))},qr=function(t,e,n,i,a,o){var r=t,s=t.actor,c=z(),d=0;if(r.is_active){if(r.timer+=c,r.timer>=3){var u=r.who;De(u.actor.input),km(u.actor);for(var l=0;l<n;l++){var p=e[l];if(p!=u){var _=at(s.position,it(40*d++-20,-30));ts(p,_)}}r.is_active=!1,r.is_disabled=!0}Wn(s,dn("SD_TELEPORTER",1))}else Wn(s,dn("SD_TELEPORTER",0))},Jr=function(t,e){Gn(t.actor,e)},Zr=function(t){Pn(t.actor)},ts=function(t,e){t&&(t.actor.position=e,t.actor.speed=it(0,0),t.actor.is_jumping=!1,t.flying=!1,t.climbing=!1,t.getting_hit=!1,t.spring=!1,t.actor.angle=0,t.disable_wall=Ts,t.entering_loop=!1,t.at_loopfloortop=!1,t.bring_to_back=!1)},es=function(t){var e=t;t.obstacle=!1,t.bring_to_back=!0,t.preserve=!0,t.actor=Cn(),e.is_pressed=!1,e.partner=null,Wn(t.actor,dn("SD_SWITCH",0))},ns=function(t){Pn(t.actor)},is=function(t,e,n,i,a,o){var r,s,c=t,d={dist:0},u={dist:0};c.partner=null,r=Uo(t,a,ms,d),s=Uo(t,a,gs,u),null!=r&&d.dist<u.dist&&(c.partner=r),null!=s&&u.dist<d.dist&&(c.partner=s),null==c.partner?os(t,r,e,n,rs,ss):c.partner==r?os(t,r,e,n,cs,ds):c.partner==s&&os(t,s,e,n,us,ls)},as=function(t,e){Gn(t.actor,e)},os=function(t,e,n,i,a,o){for(var r=!0,s=t,c=t.actor,d=0;d<i;d++){var u=n[d];ps(t,u)&&(r=!1,s.is_pressed||(a(e,u),L(ze("switch")),Wn(c,dn("SD_SWITCH",1)),s.is_pressed=!0))}r&&s.is_pressed&&(o(e),Wn(c,dn("SD_SWITCH",0)),s.is_pressed=!1)},rs=function(t,e){},ss=function(t){},cs=function(t,e){!function(t){t.is_closed=!1,L(ze("open door"))}(t)},ds=function(t){!function(t){t.is_closed=!0,L(ze("close door"))}(t)},us=function(t,e){!function(t,e){var n=t,i=t.actor;n.is_active||n.is_disabled||(n.is_active=!0,n.who=e,Ie(e.actor.input),km(i),L(ze("teleporter")))}(t,e)},ls=function(t){},ps=function(t,e){if(!t)return!1;if(!e)return!1;var n=[],i=[];return n[0]=t.actor.position.x-t.actor.hot_spot.x,n[1]=t.actor.position.y-t.actor.hot_spot.y,n[2]=n[0]+Yn(t.actor).width,n[3]=n[1]+Yn(t.actor).height,i[0]=e.actor.position.x-e.actor.hot_spot.x+.3*Yn(e.actor).width,i[1]=e.actor.position.y-e.actor.hot_spot.y+.5*Yn(e.actor).height,i[2]=i[0]+.4*Yn(e.actor).width,i[3]=i[1]+.5*Yn(e.actor).height,!e.dying&&!e.climbing&&!e.flying&&Z(n,i)},_s=9,fs=10,hs=12,ms=26,gs=27,vs=31,bs=35;!function(t){t[t.IS_IDLE=0]="IS_IDLE",t[t.IS_DEAD=1]="IS_DEAD"}(re||(re={}));var ys,xs,ks,ws=re.IS_IDLE,Es=re.IS_DEAD,Ss=function(t){var e=null;switch(t){case 0:e={init:Tr,release:Ir,update:Dr,render:Or};break;case 1:e=cr(Vo,0);break;case 2:e=cr(Ko,3);break;case 3:e=cr(qo,4);break;case 4:e=cr(Jo,5);break;case 5:e=cr(Zo,6);break;case 6:e=cr(tr,7);break;case 42:e=cr(er,11);break;case 78:e=cr(nr,12);break;case 79:e=cr(ir,13);break;case 80:e=cr(ar,14);break;case 81:e=cr(or,15);break;case 7:e=cr(rr,8);break;case 8:e=cr(sr,9);break;case _s:e={init:Ka,release:Za,update:qa,render:Ja};break;case fs:e={init:Xo,release:Qo,update:zo,render:$o};break;case 11:e={init:Oo,release:Lo,update:Ro,render:Ao};break;case hs:e={init:jo,release:Do,update:To,render:Io};break;case 13:e={init:No,release:Go,update:Co,render:Po};break;case 15:e={init:va,release:ba,update:ya,render:xa};break;case 16:e=fr(yr,"SD_LOOPRIGHT");break;case 17:e=fr(xr,"SD_LOOPMIDDLE");break;case 18:e=fr(kr,"SD_LOOPLEFT");break;case 19:e=fr(wr,"SD_LOOPNONE");break;case 33:e=fr(Er,"SD_LOOPFLOOR");break;case 34:e=fr(Sr,"SD_LOOPFLOORNONE");break;case bs:e=fr(Mr,"SD_LOOPFLOORTOP");break;case 20:e=Hr($r,"SD_YELLOWSPRING",it(0,-500));break;case 54:e=Hr(Qr,"SD_BYELLOWSPRING",it(0,500));break;case 50:e=Hr(Qr,"SD_TRYELLOWSPRING",it(400,-600));break;case 48:e=Hr(Qr,"SD_RYELLOWSPRING",it(600,0));break;case 52:e=Hr(Qr,"SD_BRYELLOWSPRING",it(400,600));break;case 53:e=Hr(Qr,"SD_BLYELLOWSPRING",it(-400,600));break;case 49:e=Hr(Qr,"SD_LYELLOWSPRING",it(-600,0));break;case 51:e=Hr(Qr,"SD_TLYELLOWSPRING",it(-400,-600));break;case 21:e=Hr($r,"SD_REDSPRING",it(0,-750));break;case 47:e=Hr(Qr,"SD_BREDSPRING",it(0,750));break;case 43:e=Hr(Qr,"SD_TRREDSPRING",it(800,-1e3));break;case 22:e=Hr(Qr,"SD_RREDSPRING",it(1200,0));break;case 45:e=Hr(Qr,"SD_BRREDSPRING",it(800,1e3));break;case 46:e=Hr(Qr,"SD_BLREDSPRING",it(-800,1e3));break;case 23:e=Hr(Qr,"SD_LREDSPRING",it(-1200,0));break;case 44:e=Hr(Qr,"SD_TLREDSPRING",it(-800,-1e3));break;case 55:e=Hr($r,"SD_BLUESPRING",it(0,-1500));break;case 62:e=Hr(Qr,"SD_BBLUESPRING",it(0,1500));break;case 58:e=Hr(Qr,"SD_TRBLUESPRING",it(1800,-1500));break;case 56:e=Hr(Qr,"SD_RBLUESPRING",it(2e3,0));break;case 60:e=Hr(Qr,"SD_BRBLUESPRING",it(1800,1500));break;case 61:e=Hr(Qr,"SD_BLBLUESPRING",it(-1800,1500));break;case 57:e=Hr(Qr,"SD_LBLUESPRING",it(-2e3,0));break;case 59:e=Hr(Qr,"SD_TLBLUESPRING",it(-1800,-1500));break;case 24:e={init:Pa,release:Ba,update:Ga,render:Ua};break;case 25:e={init:es,release:ns,update:is,render:as};break;case ms:sh.length>1&&(e={init:bo,release:ko,update:yo,render:xo});break;case gs:e={init:Kr,release:Zr,update:qr,render:Jr};break;case 28:e={init:Aa,release:La,update:Na,render:Ca};break;case 29:e={init:za,release:Va,update:$a,render:Qa};break;case 30:e={init:Bo,release:Wo,update:Yo,render:Ho};break;case vs:e={init:wo,release:Mo,update:Eo,render:So};break;case 32:e={init:ka,release:wa,update:Ea,render:Sa,state:null};break;case 36:e={init:Ya,release:Fa,update:Ha,render:Wa};break;case 37:e=to("SD_DANGER",oo);break;case 75:e=to("SD_VERTICALDANGER",oo);break;case 76:e=to("SD_FIREDANGER",ro);break;case 77:e=to("SD_VERTICALFIREDANGER",ro);break;case 38:e=Rr(Gr,0,f);break;case 63:e=Rr(Ur,2,f);break;case 64:e=Rr(Br,1,f);break;case 65:e=Rr(Yr,3,f);break;case 66:e=Rr(Gr,0,5);break;case 67:e=Rr(Ur,2,5);break;case 68:e=Rr(Br,1,5);break;case 69:e=Rr(Yr,3,5);break;case 39:e=_o(Rs,!0);break;case 70:e=_o(As,!0);break;case 71:e=_o(Ls,!0);break;case 72:e=_o(Rs,!1);break;case 73:e=_o(As,!1);break;case 74:e=_o(Ls,!1);break;case 40:case 41:e={init:co,release:po,update:uo,render:lo}}return null!=e&&(e.type=t,e.state=ws,e.init(e)),e},Ms=function(t,e,n,i,a,o){t.update(t,e,n,i,a,o)},js=function(t,e){t.render(t,e)},Ts=0,Is=2,Ds=4,Os=8,Rs=0,As=1,Ls=2,Ns=1,Cs=2,Ps=3,Gs=4,Us=5,Bs=6,Ys=0,Hs=0,Ws=function(t){E("player_create(".concat(t,")"));for(var e={name:"Unknown",type:t,actor:Cn(),disable_movement:!1,in_locked_area:!1,at_some_border:!1,spin:!1,spin_dash:!1,braking:!1,flying:!1,climbing:!1,landing:!1,spring:!1,is_fire_jumping:!1,getting_hit:!1,dying:!1,dead:!1,blinking:!1,on_moveable_platform:!1,lock_accel:0,flight_timer:0,blink_timer:0,death_timer:0,disable_jump_for:0,glasses:Cn(),got_glasses:!1,shield:Cn(),shield_type:0,invincible:!1,invtimer:0,invstar:[],got_speedshoes:!1,speedshoes_timer:0,disable_wall:Ts,entering_loop:!1,at_loopfloortop:!1,bring_to_back:!1},n=0;n<5;n++)e.invstar[n]=Cn(),Wn(e.invstar[n],dn("SD_INVSTAR",0));switch(e.type){case Rs:e.name="Surge",e.actor.acceleration=250,e.actor.maxspeed=700,e.actor.jump_strength=450,e.actor.input=we(),Wn(e.actor,dn(ac(Rs),0));break;case As:e.name="Neon",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=we(),Wn(e.actor,dn(ac(As),0));break;case Ls:e.name="Charge",e.actor.acceleration=200,e.actor.maxspeed=600,e.actor.jump_strength=360,e.actor.input=we(),Wn(e.actor,dn(ac(Ls),0))}return xs=1,ys=0,E("player_create() ok"),e},Fs=function(t){for(var e=0;e<t.invstar.length;e++)Pn(t.invstar[e]);Pn(t.glasses),Pn(t.actor)},Xs=function(t,e,n){var i=t.actor;return t.blinking&&(t.blink_timer+=z(),i.visible=$()%250<125,t.blink_timer>=4&&(t.getting_hit=t.blinking=!1,i.visible=!0)),t.disable_movement?t.spin?Wn(t.actor,dn(ac(t.type),3)):t.spring&&Wn(t.actor,dn(ac(t.type),13)):Bn(i,$s(t,e,n,Ph())),t},zs=function(t,e){if(t){var n=t.actor;if(n){var i,a,o=n.hot_spot,r=n.position,s=it(0,0),c=it(0,0),d=[],u=n.angle;if(t.invincible){var l=dn("SD_INVSTAR",0).frame_count;for(t.invtimer+=z(),i=0;i<5;i++)d[i]=720*$()*.001+72*(i+1),c.x=30*Math.cos(d[i]*m/180),c.y=($()+400*i)%2e3/40,c=ct(c,u),t.invstar[i].position.x=n.position.x+c.x,t.invstar[i].position.y=n.position.y-c.y+5,Hn(t.invstar[i],q(l))}for(t.got_glasses&&oc(t),0!=t.shield_type&&sc(t),t.type,i=0;i<5&&t.invincible;i++)d[i]%360>=180&&Gn(t.invstar[i],e);for(a=n.angle,n.angle=n.is_jumping||t.spin?a:et(a),Gn(n,e),n.angle=a,t.got_glasses&&Gn(t.glasses,e),0!=t.shield_type&&Gn(t.shield,e),i=0;i<5&&t.invincible;i++)d[i]%360<180&&Gn(t.invstar[i],e);switch(t.type){case Rs:break;case As:n.is_jumping&&n.animation==dn(ac(As),3)&&(n.position=it(r.x,r.y),n.angle=u,n.hot_spot=o,0!=t.shield_type&&(t.shield.angle=0,t.shield.hot_spot=s))}}}},$s=function(t,e,n,i){var a,o,r,s,c,d,u,l,_,f,h,g,v,b,y,x,k,w,E,S,M,j,T,I,D=t.actor,O=ac(t.type),R=z(),A=480,N=0,P=1,G=D.maxspeed,U=it(0,0),B=!1,Y=t.actor.animation==dn(O,1),H=!1,W=!1,F=!1,X=null,$=Yn(D).width,Q=Yn(D).height,V=!(Math.abs(D.angle)<p||Math.abs(D.angle-m/2)<p||Math.abs(D.angle-m)<p||Math.abs(D.angle-3*m/2)<p),K=-2,tt=0,et=0,nt=0,dt=D.position;switch(t.type){case Rs:V?(tt=1,et=.8,nt=.5):(tt=.7,et=.5,nt=.4);break;case As:case Ls:V?(tt=1,et=.7,nt=.25):(tt=.7,et=.5,nt=.25)}if(v=at(dt,ct(it(0,-Q*tt+K),-D.angle)),k=at(dt,ct(it(0,2),-D.angle)),E=at(dt,ct(it(-$*nt+K,-Q*et),-D.angle)),y=at(dt,ct(it($*nt-K,-Q*et),-D.angle)),S=at(dt,ct(it(-$*nt+K,-Q*tt+K),-D.angle)),b=at(dt,ct(it($*nt-K,-Q*tt+K),-D.angle)),w=at(dt,ct(it(-$*nt+K,2),-D.angle)),x=at(dt,ct(it($*nt-K,2),-D.angle)),t.type==As&&D.carrying&&Math.abs(D.angle)<p){var ut=Yn(D.carrying).height,lt=D.speed.y>5?.7*ut:0;w.y+=lt,x.y+=lt,k.y+=lt,E.y+=ut*et+q(ut)-.5*ut,y.y=E.y}M=t.disable_wall&Os,j=t.disable_wall&Is,T=t.disable_wall&Ds,I=1&t.disable_wall,Rn=M,An=j,Ln=T,Nn=I,Vn(!(t.disable_wall&Ds));var pt=Qn(D,2,v,b,y,x,k,w,E,S,n,s,l,d,_,c,f,u,h);if(s=pt.up,c=pt.down,u=pt.left,d=pt.right,h=pt.upleft,l=pt.upright,f=pt.downleft,_=pt.downright,Vn(!0),t.dying)return D.speed.x=0,D.speed.y=Math.min(A,D.speed.y+i*R),D.mirror=null,D.angle=0,D.visible=!0,t.blinking=!1,t.death_timer+=R,t.dead=t.death_timer>=2.5,Wn(D,dn(O,8)),it(0,D.speed.y*R+.5*i*R*R);if(t.dead)return it(0,0);var _t=Kn(D,K,s,l,d,_,c,f,u,h);switch(s=_t.up,l=_t.upright,d=_t.right,u=_t.left,h=_t.upleft,c=_t.down,f=_t.downleft,_=_t.downright,t.type){case Rs:D.carry_offset=it(1&D.mirror?7:-9,-40);break;case As:case Ls:D.carry_offset=it(1&D.mirror?7:-7,-42)}if(null!=D.carried_by){var ft=null,ht=void 0,mt=0,gt=0,vt=D.carried_by;for(ht=0;ht<e.length;ht++)if(e[ht]==t){gt=ht;break}for(ht=0;ht<e.length;ht++)if(e[ht].actor==vt){ft=e[ht],mt=ht,t.disable_wall=ft.disable_wall,t.entering_loop=ft.entering_loop,t.at_loopfloortop=ft.at_loopfloortop,t.bring_to_back=ft.bring_to_back;break}if(ft&&(ft.type==As&&!ft.flying||ft.getting_hit||ft.dying||ft.dead))D.position=it(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null;else{if(!(c&&0==c.brick_ref.angle&&vt.speed.y>=5||t.getting_hit||t.dying||t.dead)){var bt=gt<mt?rt(vt.speed,R):it(0,0);return D.speed=it(0,0),D.mirror=vt.mirror,D.angle=0,Wn(D,dn(O,25)),D.position=ot(at(vt.position,bt),D.carry_offset),it(0,0)}D.position=it(D.carried_by.position.x,D.carried_by.position.y),D.carried_by.carrying=null,D.carried_by=null}}if(t.entering_loop=!1,t.got_speedshoes&&(t.speedshoes_timer>23?t.got_speedshoes=!1:(G*=1.5,t.speedshoes_timer+=R)),cc(t)&&D.is_jumping&&(t.disable_wall&=~Ds),t.spring&&(c&&D.speed.y>=0||t.flying||t.climbing)&&(t.spring=!1),a=(d&&Se(D.input,Yt)||u&&Se(D.input,Bt))&&c,t.on_moveable_platform=st(Hh(c,D))>p,(r=c&&(D.angle>0&&D.angle<m/2&&D.speed.x>0||D.angle>3*m/2&&D.angle<2*m&&D.speed.x<0))&&(h||l)||Math.abs(D.angle)<p||Math.abs(D.angle-m)<p){if(d&&d.brick_ref.angle%90==0&&(D.speed.x>p||y.x>d.x)&&(!r||r&&90!=d.brick_ref.angle)&&(D.speed.x=0,D.position.x=d.x+(dt.x-y.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(X=dn(O,a?14:0)),r))return it(-5,0);if(u&&u.brick_ref.angle%90==0&&(D.speed.x<-1e-5||E.x<u.x+u.brick_ref.image.width)&&(!r||r&&270!=u.brick_ref.angle)&&(D.speed.x=0,D.position.x=u.x+u.brick_ref.image.width+(dt.x-E.x),!D.is_jumping&&!t.flying&&!t.climbing&&Math.abs(D.speed.y)<p&&(X=dn(O,a?14:0)),r))return it(5,0);D.position.x<=D.hot_spot.x&&(t.spin=!1,W=!0,D.position.x<D.hot_spot.x&&(D.speed.x=0,D.position.x=D.hot_spot.x,c&&(a=!0,X=dn(O,1)))),D.position.x>=Mh().x-(Yn(D).width-D.hot_spot.x)&&(t.spin=!1,H=!0,D.position.x>Mh().x-(Yn(D).width-D.hot_spot.x)&&(D.speed.x=0,D.position.x=Mh().x-(Yn(D).width-D.hot_spot.x),c&&(a=!0,X=dn(O,1))))}if(!t.climbing){if(c){var yt,xt=c.brick_ref.angle,kt=void 0;if(B=!0,D.ignore_horizontal=!1,t.is_fire_jumping=!1,D.is_jumping=!1,c.brick_ref&&3==c.brick_ref.behavior&&0==c.state&&(c.state=2),Math.abs(D.speed.x)<p){if(xt%180==0&&(t.spin=!1),Se(D.input,Ut))t.spin_dash||(X=dn(O,4)),Me(D.input,Ht)&&(X=dn(O,6),t.spin_dash=!0,L(ze("charge")));else if(!a)if(Se(D.input,Gt))Y&&t.at_some_border||(X=dn(O,5));else if(cc(t))X=dn(O,0);else{var wt=at(dt,ct(it(-8,0),-D.angle)),Et=at(dt,ct(it(5,0),-D.angle)),St=it(0,0),Mt=Qn(D,2,St,St,St,Et,St,wt,St,St,n,null,null,null,void 0,null,void 0,null,null);Mt.downleft&&Mt.downright||t.on_moveable_platform?Se(D.input,Bt)&&(W||t.at_some_border)||Se(D.input,Yt)&&(H||t.at_some_border)?(D.mirror=W?1:0,X=dn(O,1)):X=dn(O,0):X=dn(O,10)}if(t.spin_dash){var jt=void 0,Tt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0;for(jt=0;jt<3;jt++)q(128),Ot=qe(1,1),nn(Ot,255,255,255),It=it(Tt*(7+q(7)),2),Dt=it(Tt*(50+q(200)),-q(200)),Yh(Ot,at(D.position,It),Dt,!0);(je(D.input,Ut)||kh())&&(t.spin=!0,t.spin_dash=!1,(!(1&D.mirror)||u||W)&&(1&D.mirror||d||H)||(D.speed.x=(1&D.mirror?-1:1)*G*1.35),L(ze("release")),t.disable_jump_for=.05)}}else if(Se(D.input,Ut)&&(t.spin||L(ze("roll")),t.spin=!0),t.spin||t.braking)t.spin?X=dn(O,3):t.braking&&(Tt=1&D.mirror?1:-1,It=void 0,Dt=void 0,Ot=void 0,q(128),Ot=qe(1,1),It=it(Tt*(10-q(21)),0),Dt=it(Tt*(50+q(200)),-q(200)),Yh(Ot,at(D.position,It),Dt,!0),X=dn(O,7),Math.abs(D.speed.x)<10&&(t.braking=!1));else{var Rt=.75*G,At=.35*G;Math.abs(D.speed.x)<Rt?!a&&D.speed.y>=0&&(X=dn(O,1),D=function(t,e){return t.animation_speed_factor=Math.max(0,e),t}(D,.5+Math.abs(D.speed.x)/Rt*1.5)):X=dn(O,2),Math.abs(D.speed.x)>=At&&(Se(D.input,Yt)&&D.speed.x<0||Se(D.input,Bt)&&D.speed.x>0)&&(L(ze("brake")),t.braking=!0)}if(t.disable_jump_for=Math.max(t.disable_jump_for-R,0),Math.abs(D.speed.x)<p&&(t.disable_jump_for=0),yt=!t.spin_dash,Se(D.input,Ht)&&t.disable_jump_for<=0&&!Se(D.input,Ut)&&!s&&!t.landing&&yt&&!D.is_jumping&&(L(ze("jump")),D.angle=0,D.is_jumping=!0,t.is_fire_jumping=!0,F=!0,t.spin=!1,X=dn(O,3),0==xt?D.speed.y=1*-D.jump_strength:xt>0&&xt<90?xt>45?(D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x>0?.5:1,D.speed.y=1*-D.jump_strength):90==xt?(Bn(D,it(-40,0)),D.speed.x=Math.min(D.speed.x,1*-D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>90&&xt<180?(Bn(D,it(0,40)),D.speed.x=Math.min(D.speed.x,-.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):180==xt?(Bn(D,it(0,40)),D.speed.x*=-1,D.speed.y=1*D.jump_strength):xt>180&&xt<270?(Bn(D,it(0,40)),D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=1*D.jump_strength):270==xt?(Bn(D,it(40,0)),D.speed.x=Math.max(D.speed.x,1*D.jump_strength),D.speed.y=-D.jump_strength/2*1):xt>270&&xt<360&&(xt<315?(D.speed.x=Math.max(D.speed.x,.7*D.jump_strength*1),D.speed.y=-.7*D.jump_strength*1):(D.speed.x*=D.speed.x<0?.5:1,D.speed.y=1*-D.jump_strength))),!D.is_jumping){var Lt=void 0;xt>0&&xt<90?(Lt=.8*Math.min(1,Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt<=45?D.speed.x:Math.max(-1.2*G,-1*Lt*D.speed.y):(kt=(1&D.mirror?2:1)*Lt,t.braking&&xt<45?kt*=8*(D.speed.x<0?-.5:1):Math.abs(D.speed.x)<5&&(kt*=25*Math.sin(xt*m/180),t.lock_accel=2),D.speed.x=Math.max(D.speed.x-700*kt*R,-1.2*G))):xt>270&&xt<360&&(Lt=.8*Math.min(1,-Math.tan(xt*m/180)),Math.abs(D.speed.y)>p?D.speed.x=B&&xt>=315?D.speed.x:Math.min(1.2*G,1*Lt*D.speed.y):(kt=(1&D.mirror?1:2)*Lt,t.braking&&xt>315?kt*=8*(D.speed.x>0?-.5:1):Math.abs(D.speed.x)<5&&(kt*=25*-Math.sin(xt*m/180),t.lock_accel=1),D.speed.x=Math.min(D.speed.x+700*kt*R,1.2*G)))}xt%90==0&&(t.lock_accel=0),f&&_&&Math.abs(D.speed.x)<40&&f.brick_ref.angle>270&&f.brick_ref.angle<360&&_.brick_ref.angle>0&&_.brick_ref.angle<90&&(Se(D.input,Bt)||Se(D.input,Yt)||(D.speed.x=0))}else t.braking=!1,t.lock_accel=0,t.spin_dash&&(t.spin_dash=!1,X=dn(O,1)),D.animation!=dn(O,0)&&D.animation!=dn(O,10)&&D.animation!=dn(O,5)||(X=dn(O,1)),(t.spring||Y||D.speed.y<0)&&(t.spin=!1),cc(t)||(D.angle=0);if(c||t.is_fire_jumping&&D.speed.y<.88*-D.jump_strength&&je(D.input,Ht)&&(D.speed.y*=.7),t.type==As&&t.flying?(P=t.flight_timer<10?.15:.8,A*=.3):P=1,U.y=Math.abs(D.speed.y)>p?D.speed.y*R+i*P*.5*(R*R):0,t.type==Ls&&t.flying||(D.speed.y=Math.min(D.speed.y+i*P*R,A)),o=s&&s.brick_ref.angle%90!=0&&Math.abs(D.angle)<p,s&&(s.brick_ref.angle%90==0||o)&&D.speed.y<-1e-5&&(D.position.y=s.y+s.brick_ref.image.height+(dt.y-v.y),D.speed.y=10,1==s.brick_ref.behavior&&Math.sin(s.brick_ref.behavior_arg[3]*s.value[0])>0))return D.speed.y=100,at(U,rt(Hh(s,D),R));if((g=c)&&!D.is_jumping)if(xt=g.brick_ref.angle,D.speed.y=U.y=0,D.angle=xt*m/180,0==xt){var Nt=Hh(c,D);dt.y=g.y,N=0,Nt.y>p?U.y+=Nt.y*R:D.position.y=dt.y+K+1}else if(xt>0&&xt<90)dt.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x<0&&(dt.y+=2),D.position.y=dt.y+K,1&D.mirror||(N=.2);else if(90==xt){if(Math.abs(D.speed.x)>5){var Ct=_?_.brick_ref.angle:-1;_&&Ct>=xt&&Ct<xt+90?t.flying||(D.position.x=g.x+K):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(X=dn(O,1)),cc(t)||(t.flying||Bn(D,it(-13,0)),D.speed=it(0,-.9*Math.abs(D.speed.x))))}else D.angle=0,t.flying||Bn(D,it(-10,0)),D.is_jumping=!0,D.ignore_horizontal=!1;1&D.mirror||(N=1.5)}else xt>90&&xt<180?(Math.abs(D.speed.x)>5?(dt.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=dt.y-K):(D.angle=0,Bn(D,it(0,30)),D.is_jumping=!0),N=1.5):180==xt?(Math.abs(D.speed.x)>5?(dt.y=g.y+g.brick_ref.image.height,D.position.y=dt.y-K,(D.speed.x>0&&!_||D.speed.x<0&&!f)&&(Bn(D,it(0,-30)),D.is_jumping=!0,D.speed.x*=-1,D.mirror=D.speed.x<0?1:0,D.angle=0)):(D.angle=0,Bn(D,it(0,40)),D.is_jumping=!0,D.speed.x=0),N=1.2):xt>180&&xt<270?(Math.abs(D.speed.x)>5?(dt.y=g.y+g.brick_ref.image.height-(D.position.x-g.x)*Math.tan(D.angle),D.position.y=dt.y-K):(D.angle=0,Bn(D,it(0,30)),D.is_jumping=!0),N=1.5):270==xt?(Math.abs(D.speed.x)>5?(Ct=f?f.brick_ref.angle:-1,f&&Ct>xt-90&&Ct<=xt?t.flying||(D.position.x=g.x+g.brick_ref.image.width-K):(D.angle=0,D.is_jumping=!0,t.spin||t.flying||(X=dn(O,1)),cc(t)||(t.flying||Bn(D,it(13,0)),D.speed=it(0,-.9*Math.abs(D.speed.x))))):(D.angle=0,t.flying||Bn(D,it(10,0)),D.is_jumping=!0,D.ignore_horizontal=!1),1&D.mirror&&(N=1.5)):xt>270&&xt<360&&(dt.y=g.y-(D.position.x-g.x)*Math.tan(D.angle),D.speed.x>0&&(dt.y+=2),D.position.y=dt.y+K,1&D.mirror&&(N=.2));if(U.x=Math.abs(D.speed.x)>p?D.speed.x*R+(1-N)*D.acceleration*.5*(R*R):0,!Se(D.input,Bt)||Se(D.input,Yt)||t.spin||t.braking||t.landing||t.getting_hit||1==t.lock_accel||W)if(!Se(D.input,Yt)||Se(D.input,Bt)||t.spin||t.braking||t.landing||t.getting_hit||2==t.lock_accel||H){if(c){var Pt=0;xt=c.brick_ref.angle,kt=0,kt=t.spin?.65:t.braking?4.5:t.landing?.6:1,xt%90==0?Pt=90==xt?-1:270==xt?1:D.speed.x>p?-1:-D.speed.x>p?1:0:(xt>90&&xt<180||xt>180&&xt<270)&&(Pt=D.speed.x>p?-1:-D.speed.x>p?1:0),D.speed.x+=Pt*kt*D.acceleration*R}}else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Se(D.input,Ut)||(D.mirror=0,N=D.speed.x<0?-1:N,D.speed.x<=1.1*G&&(D.speed.x=Math.min(D.speed.x+(1-N)*D.acceleration*R,G)));else D.ignore_horizontal||!(D.is_jumping||t.spring||Y)&&Se(D.input,Ut)||(D.mirror=1,N=D.speed.x>0?-1:N,D.speed.x>=1.1*-G&&(D.speed.x=Math.max(D.speed.x-(1-N)*D.acceleration*R,-G)))}switch(t.spring&&(X=dn(O,D.speed.y<=0?13:1),D.speed.y>0&&(t.spring=!1,D.is_jumping=!1)),t.getting_hit&&(c?t.getting_hit=!1:X=dn(O,11)),t.type){case Rs:break;case As:if(t.flight_timer+=R,c&&90!=c.brick_ref.angle&&270!=c.brick_ref.angle&&(t.flying=!1,t.flight_timer=0),(D.is_jumping&&D.speed.y>-D.jump_strength/3&&!F&&!t.getting_hit||t.flying)&&Me(D.input,Ht)&&!t.getting_hit&&t.flight_timer<10&&(t.flying||(t.flight_timer=0),D.speed.y=.1*-Ph(),t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1),t.flying){if(X=dn(O,D.carrying?16:20),D.speed.x=J(D.speed.x,-D.maxspeed/2,D.maxspeed/2),t.flight_timer>=10){var Wt=ze("tired of flying");C(Wt)||L(Wt),X=dn(O,19)}else for(Wt=void 0,ht=void 0,cc(t)&&(D.angle=0),Wt=ze("flying"),C(Wt)||L(Wt),ht=0;ht<e.length&&null==D.carrying;ht++)if(e[ht]!=t&&D.speed.y<=0){var Ft=[e[ht].actor.position.x+.3*Yn(e[ht].actor).width,e[ht].actor.position.y,e[ht].actor.position.x+.7*Yn(e[ht].actor).width,e[ht].actor.position.y+.2*Yn(e[ht].actor).height],Xt=[D.position.x+.3*Yn(D).width,D.position.y+.7*Yn(D).height,D.position.x+.7*Yn(D).width,D.position.y+Yn(D).height],zt=Z(Ft,Xt),$t=!(null!=e[ht].actor.carried_by||e[ht].dying||e[ht].dead||e[ht].climbing||e[ht].landing||e[ht].getting_hit);zt&&$t&&!c&&(D.carrying=e[ht].actor,e[ht].actor.carried_by=D,e[ht].spin=e[ht].spin_dash=e[ht].braking=e[ht].flying=e[ht].spring=e[ht].on_moveable_platform=!1,L(ze("touch the wall")))}}else D.animation==dn(O,D.carrying?16:20)&&(X=dn(O,1));break;case Ls:if((D.is_jumping&&D.speed.y>-.7*D.jump_strength||t.flying)&&Me(D.input,Ht)&&!c&&!t.getting_hit&&(D.speed.y=50,t.flying=!0,D.is_jumping=!1,t.is_fire_jumping=!1,D.speed.x=1&D.mirror?Math.min(-100,D.speed.x):Math.max(100,D.speed.x)),t.flying){var Qt=Se(D.input,Bt)&&D.speed.x>0||Se(D.input,Yt)&&D.speed.x,Vt=c&&Math.abs(c.brick_ref.angle*m/180-0)<p;if(Qt=D.animation==dn(O,21)&&!Fn(D),Vt||D.animation==dn(O,19)||t.landing||(1&D.mirror?(X=dn(O,Qt?21:20),D.speed.x=Math.max(D.speed.x-.5*D.acceleration*R,-G/2)):(X=dn(O,Qt?21:20),D.speed.x=Math.min(D.speed.x+.5*D.acceleration*R,G/2))),Vt)t.landing=!0,D.is_jumping=!1,X=dn(O,19),D.speed.y=0,U.y=0,t.climbing=!1;else if(je(D.input,Ht))t.flying=!1,X=dn(O,18);else{var Kt=void 0,qt=[u,f,d,_,c];for(Kt=0;Kt<qt.length;Kt++)(g=qt[Kt])&&g.brick_ref.angle%90!=0&&(t.flying=!1,t.landing=!1)}Vt||s||(u&&u.brick_ref.angle%90==0||d&&d.brick_ref.angle%90==0)&&(t.climbing=!0,t.flying=!1,L(ze("touch the ground")))}if(t.landing&&(Math.abs(D.speed.x)<p||!c)&&(t.flying=t.landing=!1),t.climbing){var Jt=it(0,0);if(D.speed.x=U.x=0,u&&!d&&(D.mirror|=1),d&&!u&&(D.mirror&=-2),Jt=at(Jt,rt(Hh(u,D),R)),((Jt=at(Jt,rt(Hh(d,D),R))).y<=0&&!s||Jt.y>=0&&!c||!u&&d)&&(U=at(U,Jt)),u||d)if(Me(D.input,Ht)){var Zt=dn(O,17),te=dn(O,22);D.animation!=Zt&&D.animation!=te||(t.climbing=!1,D.is_jumping=!0,t.is_fire_jumping=!0,D.speed.x=.7*(1&D.mirror?1:-1)*D.jump_strength,D.speed.y=-.5*D.jump_strength,u&&!d&&(D.mirror&=-2),!u&&d&&(D.mirror|=1),X=dn(O,3),L(ze("jump")))}else Se(D.input,Gt)?s||(U.y=.1*-G*R,X=dn(O,17)):Se(D.input,Ut)?c?t.climbing=!1:(U.y=.1*G*R,X=dn(O,17)):X=dn(O,22);else(g=1&D.mirror?f:_)?(X=dn(O,23),D.ignore_horizontal=!0,U=at(U,rt(Hh(g,D),R)),Fn(D)&&(t.climbing=!1,D.ignore_horizontal=!1,D.speed=it((1&D.mirror?-1:1)*G*.15,-Ph()/12.5),U.x=5*(1&D.mirror?-1:1))):(t.climbing=!1,D.is_jumping=!0,X=dn(O,3))}}return t.at_some_border=!1,X&&Wn(D,X),Math.abs(D.speed.x)<4&&(t.braking=!1,(!Se(D.input,Yt)&&!Se(D.input,Bt)||Se(D.input,Yt)&&Se(D.input,Bt)||t.spin||t.landing)&&(U.x=0,D.speed.x=0)),U.x+=Hh(c,D).x*R,U.x=D.position.x<=D.hot_spot.x&&D.speed.x<0?0:U.x,U.x=D.position.x>=Mh().x-(Yn(D).width-D.hot_spot.x)&&D.speed.x>0?0:U.x,U},Qs=function(t){var e,n,i=t.actor,a=!1;if(!t.blinking&&!t.dying&&!t.invincible)if(rc(t),0!=t.shield_type)a=!0,t.shield_type=0,L(ze("death"));else if(ys>0){for(a=!0,n=0;n<Math.min(Js(),15);n++)e=Uh(0,i.position),jr(e);ec(0),L(ze("ringless"))}else Vs(t);a&&(t.getting_hit=!0,t.flying=t.landing=t.climbing=t.spring=!1,t.is_fire_jumping=!1,t.spin_dash=t.spin=!1,t.blinking=!0,t.blink_timer=0,i.speed.x=1&i.mirror?200:-200,i.speed.y=-.75*i.jump_strength,Bn(i,it(0,-5)))},Vs=function(t){t.dying||(rc(t),t.shield_type=0,t.invincible=!1,t.got_speedshoes=!1,t.dying=!0,t.death_timer=0,t.spring=!1,t.actor.speed.y=1.2*-t.actor.jump_strength,t.flying=t.climbing=t.landing=!1,t.is_fire_jumping=!1,t.spin=t.spin_dash=!1,t.blinking=!1,L(ze("death")))},Ks=function(t){Te(t.actor.input,Ht),t.spring=!1,t.actor.speed.y=-t.actor.jump_strength,t.actor.is_jumping=!0,t.is_fire_jumping=!1,t.flying=!1},qs=function(t){var e=dn(ac(t.type),3);return t.spin||t.spin_dash||t.actor.animation==e||t.type==Ls&&(t.landing||t.flying)},Js=function(){return ys},Zs=function(){return Ys},tc=function(){return Hs},ec=function(t){ys=J(t,0,9999),t/100>=xs&&(xs+=1,nc(Zs()+1),jh(ze("1up")))},nc=function(t){Ys=t},ic=function(t){Hs=t},ac=function(t){switch(t){case Rs:return"SD_SONIC";case As:return"SD_TAILS";case Ls:return"SD_KNUCKLES";default:return"null"}},oc=function(t){if(t&&t.actor){var e=0,n=1&t.actor.mirror,i=!0,a=et(t.actor.angle),o=it(0,0),r=ot(t.actor.position,ct(it(0,t.actor.hot_spot.y),-a)),s=t.actor.animation;switch(t.type){case Rs:if(s==dn(ac(Rs),0))o=it(3,24),e=1;else if(s==dn(ac(Rs),1))switch(~~t.actor.animation_frame){case 0:e=2,o=it(5,23);break;case 1:e=2,o=it(4,25);break;case 2:e=1,o=it(7,25);break;case 3:case 4:e=1,o=it(5,23);break;case 5:e=1,o=it(4,24);break;case 6:e=2,o=it(6,24);break;case 7:e=2,o=it(6,23)}else if(s==dn(ac(Rs),2))e=1,o=it(8,26);else if(s==dn(ac(Rs),5))e=3,o=0==~~t.actor.animation_frame?it(0,19):it(-1,21);else if(s==dn(ac(Rs),7))e=1,o=~~t.actor.animation_frame<2?it(8,26):it(10,28);else if(s==dn(ac(Rs),10))switch(e=1,~~t.actor.animation_frame){case 0:o=it(1,22);break;case 1:o=it(-1,23);break;case 2:o=it(1,23)}else s==dn(ac(Rs),11)?(e=3,o=it(-4,30)):s==dn(ac(Rs),12)?(e=3,o=it(1,19)):s==dn(ac(Rs),13)?(e=3,o=it(4,13)):s==dn(ac(Rs),14)?(e=1,o=it(12,31)):s==dn(ac(Rs),15)?(e=0,o=it(3,23)):s==dn(ac(Rs),25)?(e=0,o=it(3,22)):i=!1;break;case As:if(s==dn(ac(As),0))o=it(5,34),e=1;else if(s==dn(ac(As),1))switch(e=2,~~t.actor.animation_frame){case 0:o=it(2,33);break;case 1:case 5:o=it(3,33);break;case 2:o=it(8,33);break;case 3:case 7:o=it(3,32);break;case 4:o=it(1,33);break;case 6:o=it(7,33)}else if(s==dn(ac(As),2))e=2,o=0==~~t.actor.animation_frame?it(7,35):it(6,34);else if(s==dn(ac(As),4))e=1,o=it(9,44);else if(s==dn(ac(As),5))e=1,o=it(7,32);else if(s==dn(ac(As),7))e=1,o=0==~~t.actor.animation_frame?it(2,33):it(4,33);else if(s==dn(ac(As),10))switch(e=4,~~t.actor.animation_frame){case 0:o=it(5,33);break;case 1:o=it(6,33)}else if(s==dn(ac(As),11))e=1,o=it(1,33);else if(s==dn(ac(As),12))e=1,o=it(6,28);else if(s==dn(ac(As),13))e=3,o=it(2,17);else if(s==dn(ac(As),14))e=1,o=it(9,35);else if(s==dn(ac(As),15))switch(e=4,~~t.actor.animation_frame){case 0:case 8:case 9:case 10:o=it(5,34);break;default:o=it(5,33)}else s==dn(ac(As),16)?(e=1,o=it(8,37)):s==dn(ac(As),19)?(e=1,o=0==~~t.actor.animation_frame?it(9,39):it(9,40)):s==dn(ac(As),20)?(e=1,o=it(8,39)):s==dn(ac(As),25)?(e=1,o=it(0,23)):i=!1;break;case Ls:if(s==dn(ac(Ls),0))e=1,o=it(1,24);else if(s==dn(ac(Ls),1))switch(~~t.actor.animation_frame){case 0:e=1,o=it(5,29);break;case 1:e=2,o=it(5,29);break;case 2:e=2,o=it(8,29);break;case 3:e=2,o=it(9,28);break;case 4:e=1,o=it(6,28);break;case 5:e=1,o=it(6,29);break;case 6:e=1,o=it(5,28);break;case 7:e=1,o=it(4,27)}else if(s==dn(ac(Ls),2))e=1,o=it(7,29);else if(s==dn(ac(Ls),4))e=1,o=0==~~t.actor.animation_frame?it(0,31):it(0,40);else if(s==dn(ac(Ls),5))e=1,o=0==~~t.actor.animation_frame?it(0,21):it(-1,21);else if(s==dn(ac(Ls),7))e=0,o=it(-2,27);else if(s==dn(ac(Ls),10))switch(e=1,~~t.actor.animation_frame){case 0:o=it(9,30);break;case 1:o=it(8,27)}else if(s==dn(ac(Ls),11))e=1,o=it(-3,27);else if(s==dn(ac(Ls),12))e=1,o=it(5,24);else if(s==dn(ac(Ls),13))e=3,o=it(-1,16);else if(s==dn(ac(Ls),14))switch(~~t.actor.animation_frame){case 0:e=1,o=it(5,29);break;case 1:e=2,o=it(5,29);break;case 2:e=2,o=it(8,29);break;case 3:e=2,o=it(9,28);break;case 4:e=1,o=it(6,28);break;case 5:e=1,o=it(6,29);break;case 6:e=1,o=it(5,28);break;case 7:e=1,o=it(4,27)}else if(s==dn(ac(Ls),15))e=0,o=it(1,23);else if(s==dn(ac(Ls),16))switch(e=1,~~t.actor.animation_frame){case 0:o=it(6,23);break;case 1:o=it(5,20);break;case 2:o=it(0,22)}else if(s==dn(ac(Ls),17))switch(e=3,~~t.actor.animation_frame){case 0:o=it(-1,22);break;case 1:o=it(-2,20);break;case 2:o=it(0,21);break;case 3:o=it(-1,24);break;case 4:o=it(0,23);break;case 5:o=it(0,22)}else if(s==dn(ac(Ls),18))e=1,o=0==~~t.actor.animation_frame?it(6,23):it(5,20);else if(s==dn(ac(Ls),19))e=1,o=it(8,44);else if(s==dn(ac(Ls),20))e=1,o=it(8,39);else if(s==dn(ac(Ls),21))switch(e=4,~~t.actor.animation_frame){case 0:o=it(-8,41);break;case 1:o=it(0,43);break;case 2:o=it(10,41)}else if(s==dn(ac(Ls),22))e=3,o=it(0,22);else if(s==dn(ac(Ls),23))switch(~~t.actor.animation_frame){case 0:e=3,o=it(7,17);break;case 1:e=3,o=it(11,15);break;case 2:e=0,o=it(12,13)}else s==dn(ac(Ls),25)?(e=0,o=it(0,23)):i=!1}return o.x*=n?-1:1,Wn(t.glasses,dn("SD_GLASSES",e)),t.glasses.position=at(r,ct(o,-a)),t.glasses.angle=a,t.glasses.mirror=t.actor.mirror,t.glasses.visible=i&&t.actor.visible,t}},rc=function(t){},sc=function(t){var e=t.shield,n=t.actor,i=it(0,0);switch(t.shield_type){case Ns:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_SHIELD",0));break;case Cs:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_FIRESHIELD",0));break;case Ps:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_THUNDERSHIELD",0));break;case Gs:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_WATERSHIELD",0));break;case Us:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_ACIDSHIELD",0));break;case Bs:i=it(0,-22),e.position=at(n.position,ct(i,-et(n.angle))),Wn(e,dn("SD_WINDSHIELD",0))}},cc=function(t){return t.disable_wall!==Ts},dc=function(t){var e=t.decorated_machine;e.init(e)},uc=function(t){var e=t.decorated_machine;e.release(e)},lc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;ec(Js()+s.rings),r.update(r,e,n,i,a,o)},pc=function(t,e){var n=t.decorated_machine;n.render(n,e)},_c=function(t){var e=t.decorated_machine;e.init(e)},fc=function(t){var e=t.decorated_machine;e.release(e)},hc=function(t,e,n,i,a,o){var r=t.decorated_machine;Sh(t.score),r.update(r,e,n,i,a,o)},mc=function(t,e){var n=t.decorated_machine;n.render(n,e)},gc=function(t,e,n){var i={init:vc,release:bc,update:yc,render:xc,get_object_instance:ga},a=i;return a.decorated_machine=t,a.offset=it(e,n),i},vc=function(t){var e=t.decorated_machine;e.init(e)},bc=function(t){var e=t.decorated_machine;e.release(e)},yc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),d=Dp(c);c.actor.position=at(d.actor.position,s.offset),r.update(r,e,n,i,a,o)},xc=function(t,e){var n=t.decorated_machine;n.render(n,e)},kc=function(t,e,n,i,a,o){return jc(t,Tc(e,n,i,a,o))},wc=function(t){var e=t.decorated_machine;e.init(e)},Ec=function(t){var e=t.decorated_machine;e.release(e)},Sc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy.update(s.strategy),r.update(r,e,n,i,a,o)},Mc=function(t,e){var n=t.decorated_machine;n.render(n,e)},jc=function(t,e){var n={init:wc,release:Ec,update:Sc,render:Mc,get_object_instance:ga},i=n;return i.decorated_machine=t,i.strategy=e,n},Tc=function(t,e,n,i,a){return{update:Ic,sfx:ze(t),vol:Math.min(e,0,1),pan:Math.min(n,-1,1),freq:i,loop:a}},Ic=function(t){N(t.sfx)},Dc=function(t,e){return{update:Oc,mus:j(t),loop:e}},Oc=function(t){var e=t;T(e.mus,e.loop)},Rc=function(t){Ch()},Ac=function(t){D(t.vol)},Lc=function(t){var e=t.decorated_machine;e.init(e)},Nc=function(t){var e=t.decorated_machine;e.release(e)},Cc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=Dp(t.get_object_instance(t));Ks(s),r.update(r,e,n,i,a,o)},Pc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Gc=function(t){var e=t.decorated_machine;e.init(e)},Uc=function(t){var e=t.decorated_machine;e.release(e)},Bc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),d=z(),u=rt(s.speed,d);c.actor.position=at(c.actor.position,u),r.update(r,e,n,i,a,o)},Yc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Hc=function(t){var e=t.decorated_machine;e.init(e)},Wc=function(t){var e=t.decorated_machine;e.release(e)},Fc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),d=zc(c,o,s.object_name,null);null!=d&&fa(d.vm,s.new_state_name),r.update(r,e,n,i,a,o)},Xc=function(t,e){var n=t.decorated_machine;n.render(n,e)},zc=function(t,e,n,i){var a,o,r=f,s=null;for(a=e;a;a=a.next)a.data.name==n&&(o=ot(a.data.actor.position,t.actor.position),st(o)<r&&(s=a.data,r=st(o)));return i&&(i=r),s},$c=function(t,e,n,i,a){var o={init:Qc,release:Vc,update:Kc,render:qc,get_object_instance:ga},r=o;return r.decorated_machine=t,r.strategy=Jc,r.offset=it(n,i),r.object_name=e,r.child_name=a,r.new_state_name=null,o},Qc=function(t){var e=t.decorated_machine;e.init(e)},Vc=function(t){var e=t.decorated_machine;e.release(e)},Kc=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy(s),r.update(r,e,n,i,a,o)},qc=function(t,e){var n=t.decorated_machine;n.render(n,e)},Jc=function(t){var e=t,n=e.get_object_instance(e),i=Bh(t.object_name,at(n.actor.position,t.offset));null!=i&&Tp(n,t.child_name,i)},Zc=function(t){var e=t,n=e.get_object_instance(e),i=jp(n,t.child_name);null!=i&&fa(i.vm,t.new_state_name)},td=function(t){var e=t,n=e.get_object_instance(e),i=Mp(n);null!=i&&fa(i.vm,t.new_state_name)},ed=function(t){var e=t.decorated_machine;e.init(e)},nd=function(t){var e=t.decorated_machine;e.release(e)},id=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t);Ih(s.actor),r.update(r,e,n,i,a,o)},ad=function(t,e){var n=t.decorated_machine;n.render(n,e)},od=function(t){var e=t.decorated_machine;e.init(e)},rd=function(t){var e=t.decorated_machine;e.release(e)},sd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);Uh(s.item_id,at(c.actor.position,s.offset)),r.update(r,e,n,i,a,o)},cd=function(t,e){var n=t.decorated_machine;n.render(n,e)},dd=function(t){var e=t.decorated_machine;e.init(e)},ud=function(t){var e=t.decorated_machine;e.release(e)},ld=function(t,e,n,i,a,o){var r=t.decorated_machine;t.get_object_instance(t).state=bp,r.update(r,e,n,i,a,o)},pd=function(t,e){var n=t.decorated_machine;n.render(n,e)},_d=function(t,e,n,i){var a={init:fd,release:hd,update:md,render:gd,get_object_instance:ga},o=a;return o.decorated_machine=t,o.title=e,o.message=n,o.strategy=i,a},fd=function(t){var e=t.decorated_machine;e.init(e)},hd=function(t){var e=t.decorated_machine;e.release(e)},md=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy(s),r.update(r,e,n,i,a,o)},gd=function(t,e){var n=t.decorated_machine;n.render(n,e)},vd=function(t){Oh(t.title,t.message)},bd=function(t){Rh()},yd=function(t){var e=t.decorated_machine;e.init(e)},xd=function(t){var e=t.decorated_machine;e.release(e)},kd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,d=z(),u=null,l=null,p=null,_=null,f=null,h=null,m=null,g=null,v=.001*$(),b=c.position;c.position.x+=-s.amplitude_x*s.angularspeed_x*Math.sin(s.initialphase_x+s.angularspeed_x*v)*d,c.position.y+=s.amplitude_y*s.angularspeed_y*Math.cos(s.initialphase_y+s.angularspeed_y*v)*d;var y=$n(c,0,0,i,u,l,p,_,f,h,m,g);u=y.up,l=y.upright,p=y.right,_=y.downright,f=y.down,h=y.downleft,m=y.left,g=y.upleft;var x=Kn(c,0,u,l,p,_,f,h,m,g);u=x.up,l=x.upright,p=x.right,_=x.downright,f=x.down,h=x.downleft,m=x.left,g=x.upleft,null!=p&&c.position.x>b.x&&(c.position.x=c.hot_spot.x-Yn(c).width+p.x),null!=m&&c.position.x<b.x&&(c.position.x=c.hot_spot.x+m.x+jn(m).width),null!=f&&c.position.y>b.y&&(c.position.y=c.hot_spot.y-Yn(c).height+f.y),null!=u&&c.position.y<b.y&&(c.position.y=c.hot_spot.y+u.y+jn(u).height),r.update(r,e,n,i,a,o)},wd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Ed=function(t){var e=t.decorated_machine;e.init(e)},Sd=function(t){var e=t.decorated_machine;e.release(e)},Md=function(t,e,n,i,a,o){for(var r=t.decorated_machine,s=t,c=t.get_object_instance(t),d=0;d<n;d++){var u=e[d];u&&zn(c.actor,u.actor)&&(qs(u)||u.invincible?(u.actor.is_jumping&&Ks(u),Sh(s.score),Uh(hs,at(c.actor.position,it(0,-15))),Wh(c.actor.position),L(ze("destroy")),c.state=bp):Qs(u))}r&&r.update(r,e,n,i,a,o)},jd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Td=function(t){var e=t.decorated_machine;e.init(e)},Id=function(t){var e=t.decorated_machine;e.release(e)},Dd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;Bn(s,qn(s,i,Ph())),r.update(r,e,n,i,a,o)},Od=function(t,e){var n=t.decorated_machine;n.render(n,e)},Rd=function(t,e){var n={init:Ad,release:Ld,update:Nd,render:Cd,get_object_instance:ga},i=n;return i.decorated_machine=t,i.should_hit_the_player=e,n},Ad=function(t){var e=t.decorated_machine;e.init(e)},Ld=function(t){var e=t.decorated_machine;e.release(e)},Nd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));!c.invincible&&s.should_hit_the_player(c)&&Qs(c),r.update(r,e,n,i,a,o)},Cd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Pd=function(t){return!0},Gd=function(t){return t.shield_type!=Cs&&t.shield_type!=Gs},Ud=function(t){return t.shield_type!=Ps},Bd=function(t){return t.shield_type!=Us},Yd=function(t){var e=t.decorated_machine;e.init(e)},Hd=function(t){var e=t.decorated_machine;e.release(e)},Wd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t.get_object_instance(t).actor;$n(s,2,-4,i,null,null,null,null,null,null,null,null),Kn(s,-4,null,null,null,null,null,null,null,null),r.update(r,e,n,i,a,o)},Fd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Xd=function(t){var e=t.decorated_machine,n=t,i=Math.abs(n.x2-n.x1),a=Math.abs(n.y2-n.y1);n.cute_image=Vd(i,a),n.has_locked_somebody=!1,e.init(e)},zd=function(t){var e=t.decorated_machine;e.release(e)},$d=function(t,e,n,i,a,o){var r,s,c,d,u,l=t.decorated_machine,p=t,_=t.get_object_instance(t),f=Dp(_),h=_.actor;r=h.position.x+p.x1,s=h.position.y+p.y1,c=p.x2-p.x1,d=p.y2-p.y1;for(var m=0;m<n;m++)if(u=e[m].actor,e[m]!=f||null!=u.carrying)u.position.x>r-30&&u.position.x<r&&(u.position.x=r-30,u.speed.x=0),u.position.x>r+c&&u.position.x<r+c+30&&(u.position.x=r+c+30,u.speed.x=0);else{var g=[],v=[];g[0]=u.position.x,g[1]=u.position.y,g[2]=u.position.x+1,g[3]=u.position.y+1,v[0]=r,v[1]=s,v[2]=r+c,v[3]=s+d,Z(g,v)&&(p.has_locked_somebody=!0,e[m].in_locked_area=!0,Nh(r,s,r+c,s+d))}p.has_locked_somebody&&((u=f.actor).position.x<r&&(u.position.x=r,u.speed.x=Math.max(0,u.speed.x),f.at_some_border=!0),u.position.x>r+c&&(u.position.x=r+c,u.speed.x=Math.min(0,u.speed.x),f.at_some_border=!0),u.position.y=Math.min(u.position.y,s,s+d)),l.update(l,e,n,i,a,o)},Qd=function(t,e){var n=t.decorated_machine;n.render(n,e)},Vd=function(t,e){var n=qe(t,e);return en(255,0,0),n},Kd=function(t,e){var n={init:qd,release:Jd,update:Zd,render:tu,get_object_instance:ga},i=n;return i.decorated_machine=t,i.look_strategy=e,n},qd=function(t){var e=t.decorated_machine;e.init(e)},Jd=function(t){var e=t.decorated_machine;e.release(e)},Zd=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.look_strategy(s),r.update(r,e,n,i,a,o)},tu=function(t,e){var n=t.decorated_machine;n.render(n,e)},eu=function(t){var e=t;e.get_object_instance(e).actor.mirror&=-2},nu=function(t){var e=t;e.get_object_instance(e).actor.mirror|=1},iu=function(t){var e=t,n=e.get_object_instance(e),i=Dp(n);i&&(n.actor.position.x<i.actor.position.x?n.actor.mirror&=-2:n.actor.mirror|=1)},au=function(t){var e=t,n=e.get_object_instance(e);n.actor.position.x>t.old_x?n.actor.mirror&=-2:n.actor.mirror|=1,t.old_x=n.actor.position.x},ou=function(t){var e=t.decorated_machine;e.init(e)},ru=function(t){var e=t.decorated_machine;e.release(e)},su=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t),d=Dp(c);if(d){var u=ot(d.actor.position,c.actor.position);if(st(u)>=5){var l=z(),p=dt(u),_=rt(p,s.speed*l);c.actor.position=at(c.actor.position,_)}}r.update(r,e,n,i,a,o)},cu=function(t,e){var n=t.decorated_machine;n.render(n,e)},du=function(t){var e=t.decorated_machine;e.init(e)},uu=function(t){var e=t.decorated_machine;e.release(e)},lu=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=z(),d=rt(s.speed,c),u=Dp(t.get_object_instance(t));u.actor.position=at(u.actor.position,d),r.update(r,e,n,i,a,o)},pu=function(t,e){var n=t.decorated_machine;n.render(n,e)},_u=function(t,e){var n={init:hu,release:mu,update:gu,render:vu,get_object_instance:ga},i=n;return i.decorated_machine=t,i.strategy=e,n},fu=function(t,e,n){return{player_name:t,object:e,run:n}},hu=function(t){var e=t.decorated_machine;e.init(e)},mu=function(t){var e=t.decorated_machine;e.release(e)},gu=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;s.strategy.run(s.strategy,e,n),r.update(r,e,n,i,a,o)},vu=function(t,e){var n=t.decorated_machine;n.render(n,e)},bu=function(t,e,n){Op(t.object,null)},yu=function(t,e,n){Rp(t.object)},xu=function(t,e,n){Ap(t.object)},ku=function(t,e,n){for(var i=Dp(t.object),a=0;a<n;a++)if(e[a]==i){Op(t.object,e[(a+1)%n]);break}},wu=function(t,e,n){return Eu(t,n,Iu(e))},Eu=function(t,e,n){var i={init:Su,release:Mu,update:ju,render:Tu,get_object_instance:ga},a=i;return a.new_state_name=e,a.strategy=n,i},Su=function(t){var e=t.decorated_machine;e.init(e)},Mu=function(t){var e=t.decorated_machine;e.release(e)},ju=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);s.strategy.should_trigger_event(s.strategy,c,e,n,i,a,o)?fa(c.vm,s.new_state_name):r.update(r,e,n,i,a,o)},Tu=function(t,e){var n=t.decorated_machine;n.render(n,e)},Iu=function(t){var e={init:Du,release:Ou,should_trigger_event:Ru},n=e;return n.timeout=t,n.timer=0,e},Du=function(t){},Ou=function(t){},Ru=function(t,e,n,i,a,o,r){var s=t;return s.timer+=z(),s.timer>=s.timeout&&(s.timer=0,!0)},Au=function(t){},Lu=function(t){},Nu=function(t,e,n,i,a,o,r){for(var s=t,c=r;null!=c;c=c.next)if(c.data.name==s.target_name&&zn(c.data.actor,e.actor))return!0;return!1},Cu=function(t){},Pu=function(t){},Gu=function(t,e,n,i,a,o,r){return Fn(e.actor)},Uu=function(t){},Bu=function(t){},Yu=function(t,e,n,i,a,o,r){return 1e5*t.probability>q(1e5)},Hu=function(t){},Wu=function(t){},Fu=function(t,e,n,i,a,o,r){var s=Dp(e);return zn(e.actor,s.actor)},Xu=function(t){},zu=function(t){},$u=function(t,e,n,i,a,o,r){var s=Dp(e);return qs(s)&&zn(e.actor,s.actor)},Qu=function(t){},Vu=function(t){},Ku=function(t,e,n,i,a,o,r){var s=t,c=e.actor,d=Dp(e),u=d.actor,l=Yn(u),p=[],_=[];return p[0]=c.position.x+s.x1,p[1]=c.position.y+s.y1,p[2]=c.position.x+s.x2,p[3]=c.position.y+s.y2,_[0]=u.position.x-u.hot_spot.x,_[1]=u.position.y-u.hot_spot.y,_[2]=u.position.x-u.hot_spot.x+l.width,_[3]=u.position.y-u.hot_spot.y+l.height,!d.dying&&Z(p,_)},qu=function(t){var e={init:Ju,release:Zu,should_trigger_event:tl};return e.shield_type=t,e},Ju=function(t){},Zu=function(t){},tl=function(t,e,n,i,a,o,r){var s=t;return Dp(e).shield_type==s.shield_type},el=function(t){},nl=function(t){},il=function(t,e,n,i,a,o,r){var s=e.actor;$n(s,1,0,a,undefined,undefined,undefined,undefined,undefined,undefined,undefined,undefined)},al=function(t){},ol=function(t){},rl=function(t,e,n,i,a,o,r){var s=e.actor;$n(s,1,0,a,void 0,void 0,void 0,undefined,undefined,undefined,void 0,void 0)},sl=function(t){},cl=function(t){},dl=function(t,e,n,i,a,o,r){var s=e.actor;$n(s,1,0,a,undefined,undefined,void 0,void 0,void 0,void 0,void 0,undefined)},ul=function(t){},ll=function(t){},pl=function(t,e,n,i,a,o,r){var s=e.actor;$n(s,1,0,a,void 0,void 0,void 0,void 0,void 0,void 0,undefined,undefined)},_l=function(t){},fl=function(t){},hl=function(t,e,n,i,a,o,r){var s=e.actor;$n(s,1,0,a,void 0,undefined,undefined,void 0,void 0,void 0,void 0,void 0)},ml=function(t,e){var n={init:gl,release:vl,update:bl,render:yl,get_object_instance:ga},i=n;return i.decorated_machine=t,i.update=e,n},gl=function(t){var e=t.decorated_machine;e.init(e)},vl=function(t){var e=t.decorated_machine;e.release(e)},bl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));s.update(c),r.update(r,e,n,i,a,o)},yl=function(t,e){var n=t.decorated_machine;n.render(n,e)},xl=function(t){t.spring=!0,t.spin=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},kl=function(t){t.spin=!0,t.spring=!1,t.flying=!1,t.climbing=!1,t.landing=!1,t.getting_hit=!1,t.is_fire_jumping=!1},wl=function(t,e){var n={init:El,release:Sl,update:Ml,render:jl,get_object_instance:ga},i=n;return i.decorated_machine=t,i.enable=e,n},El=function(t){var e=t.decorated_machine;e.init(e)},Sl=function(t){var e=t.decorated_machine;e.release(e)},Ml=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;Dp(t.get_object_instance(t)).disable_movement=!s.enable,r.update(r,e,n,i,a,o)},jl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Tl=function(t,e){var n={init:Il,release:Dl,update:Ol,render:Rl,get_object_instance:ga},i=n;return i.decorated_machine=t,i.alpha=Math.min(e,0,1),n},Il=function(t){var e=t.decorated_machine;e.init(e)},Dl=function(t){var e=t.decorated_machine;e.release(e)},Ol=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t;t.get_object_instance(t).actor.alpha=s.alpha,r.update(r,e,n,i,a,o)},Rl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Al=function(t){var e=t.decorated_machine;e.init(e)},Ll=function(t){var e=t.decorated_machine;e.release(e)},Nl=function(t,e,n,i,a,o){var r=t.decorated_machine;Pl(t),r.update(r,e,n,i,a,o)},Cl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Pl=function(t){var e=t,n=t.get_object_instance(t);Wn(n.actor,e.anim)},Gl=function(t,e,n){var i={init:Ul,release:Bl,update:Yl,render:Hl,get_object_instance:ga},a=i;return a.decorated_machine=t,a.is_obstacle=e,a.angle=n,i},Ul=function(t){var e=t.decorated_machine;e.init(e)},Bl=function(t){var e=t.decorated_machine;e.release(e)},Yl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);c.obstacle=s.is_obstacle,c.obstacle_angle=s.angle,r.update(r,e,n,i,a,o)},Hl=function(t,e){var n=t.decorated_machine;n.render(n,e)},Wl=function(t){var e=t.decorated_machine;e.init(e)},Fl=function(t){var e=t.decorated_machine;e.release(e)},Xl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));Wn(c.actor,s.anim),r.update(r,e,n,i,a,o)},zl=function(t,e){var n=t.decorated_machine;n.render(n,e)},$l=function(t){var e=t.decorated_machine;e.init(e)},Ql=function(t){var e=t.decorated_machine;e.release(e)},Vl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t);Dp(c).actor.position=at(c.actor.position,s.offset),r.update(r,e,n,i,a,o)},Kl=function(t,e){var n=t.decorated_machine;n.render(n,e)},ql=function(t){var e=t.decorated_machine;e.init(e)},Jl=function(t){var e=t.decorated_machine;e.release(e)},Zl=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=Dp(t.get_object_instance(t));s.strategy(c,s.speed),r.update(r,e,n,i,a,o)},tp=function(t,e){var n=t.decorated_machine;n.render(n,e)},ep=function(t,e,n){var i={init:ql,release:Jl,update:Zl,render:tp,get_object_instance:ga},a=i;return a.decorated_machine=t,a.speed=e,a.strategy=n,i},np=function(t,e){t.actor.speed.x=e},ip=function(t,e){t.actor.speed.y=e},ap=function(t){var e=t.decorated_machine;t.direction=0==q(2)?-1:1,e.init(e)},op=function(t){var e=t.decorated_machine;e.release(e)},rp=function(t,e,n,i,a,o){var r=t.decorated_machine,s=t,c=t.get_object_instance(t).actor,d=z(),u=null,l=null,p=null,_=null,f=null,h=null,m=null,g=null;c.position.x+=s.direction*s.speed*d;var v=$n(c,2,-2,i,u,l,p,_,f,h,m,g);u=v.up,l=v.upright,p=v.right,_=v.downright,f=v.down,h=v.downleft,m=v.left,g=v.upleft;var b=Kn(c,-2,u,l,p,_,f,h,m,g);u=b.up,l=b.upright,p=b.right,_=b.downright,f=b.down,h=b.downleft,m=b.left,g=b.upleft,null!=p&&s.direction>0&&(c.position.x=c.hot_spot.x-Yn(c).width+p.x,s.direction=-1),null!=m&&s.direction<0&&(c.position.x=c.hot_spot.x+m.x+jn(m).width,s.direction=1),null!=f&&(null==_&&null!=h?s.direction=-1:null==h&&null!=_&&(s.direction=1)),r.update(r,e,n,i,a,o)},sp=function(t,e){var n=t.decorated_machine;n.render(n,e)},cp=0,dp=[],up=[{command:"set_animation",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=+n[1],(s=r={init:Al,release:Ll,update:Nl,render:Cl,get_object_instance:ga}).decorated_machine=i,s.anim=dn(a,o),t=r):S("Object script error - set_animation expects two parameters: sprite_name, animation_id"),t}},{command:"set_obstacle",action:function(t,e,n){return 1==e?t=Gl(t,+n[0],0):2==e?t=Gl(t,+n[0],+n[1]):S("Object script error - set_obstacle expects at least one and at most two parameters: is_obstacle (TRUE or FALSE) [, angle]"),t}},{command:"set_alpha",action:function(t,e,n){return 1==e?t=Tl(t,+n[0]):S("Object script error - set_alpha expects one parameter: alpha (0.0 (transparent) <= alpha <= 1.0 (opaque))"),t}},{command:"hide",action:function(t,e,n){return 0==e?t=Tl(t,0):S("Object script error - hide expects no parameters"),t}},{command:"show",action:function(t,e,n){return 0==e?t=Tl(t,1):S("Object script error - show expects no parameters"),t}},{command:"enemy",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:Ed,release:Sd,update:Md,render:jd,get_object_instance:ga},i=n;return i.decorated_machine=t,i.score=e,n}(t,+n):S("Object script error - enemy expects one parameter: score"),t}},{command:"lock_camera",action:function(t,e,n){var i,a,o,r,s,c,d;return 4==e?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],(d=c={init:Xd,release:zd,update:$d,render:Qd,get_object_instance:ga}).decorated_machine=i,d.x1=Math.min(a,r),d.y1=Math.min(o,s),d.x2=Math.max(a,r),d.y2=Math.max(o,s),t=c):S("Object script error - lock_camera expects four parameters: x1, y1, x2, y2"),t}},{command:"move_player",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:du,release:uu,update:lu,render:pu,get_object_instance:ga}).decorated_machine=i,s.speed=it(a,o),t=r):S("Object script error - move_player expects two parameters: speed_x, speed_y"),t}},{command:"hit_player",action:function(t,e,n){return 0==e?t=Rd(t,Pd):S("Object script error - hit_player expects no parameters"),t}},{command:"burn_player",action:function(t,e,n){return 0==e?t=Rd(t,Gd):S("Object script error - burn_player expects no parameters"),t}},{command:"shock_player",action:function(t,e,n){return 0==e?t=Rd(t,Ud):S("Object script error - shock_player expects no parameters"),t}},{command:"acid_player",action:function(t,e,n){return 0==e?t=Rd(t,Bd):S("Object script error - acid_player expects no parameters"),t}},{command:"add_rings",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:dc,release:uc,update:lc,render:pc,get_object_instance:ga},i=n;return i.decorated_machine=t,i.rings=e,n}(t,+n[0]):S("Object script error - add_rings expects one parameter: number_of_rings"),t}},{command:"add_to_score",action:function(t,e,n){return 1==e?t=function(t,e){var n={init:_c,release:fc,update:hc,render:mc,get_object_instance:ga},i=n;return i.decorated_machine=t,i.score=e,n}(t,+n[0]):S("Object script error - add_to_score expects one parameter: score"),t}},{command:"set_player_animation",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=+n[1],(s=r={init:Wl,release:Fl,update:Xl,render:zl,get_object_instance:ga}).decorated_machine=i,s.anim=dn(a,o),t=r):S("Object script error - set_player_animation expects two parameters: sprite_name, animation_id"),t}},{command:"enable_player_movement",action:function(t,e,n){return 0==e?t=wl(t,!0):S("Object script error - enable_player_movement expects no parameters"),t}},{command:"disable_player_movement",action:function(t,e,n){0==e?t=wl(t,!1):S("Object script error - disable_player_movement expects no parameters")}},{command:"set_player_xspeed",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=ep(i,a,np)):S("Object script error - set_player_xspeed expects one parameter: speed"),t}},{command:"set_player_yspeed",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=ep(i,a,ip)):S("Object script error - set_player_yspeed expects one parameter: speed"),t}},{command:"set_player_position",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:$l,release:Ql,update:Vl,render:Kl,get_object_instance:ga}).decorated_machine=i,s.offset=it(a,o),t=r):S("Object script error - set_player_position expects two parameters: xpos, ypos"),t}},{command:"bounce_player",action:function(t,e,n){var i;return 0==e?((i={init:Lc,release:Nc,update:Cc,render:Pc,get_object_instance:ga}).decorated_machine=t,t=i):S("Object script error - bounce_player expects no parameters"),t}},{command:"observe_player",action:function(t,e,n){var i,a,o;return 1==e?(i=t,a=n[0],o=i.get_object_instance(i),t=_u(i,fu(a,o,bu))):S("Object script error - observe_player expects one parameter: player_name"),t}},{command:"observe_current_player",action:function(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=_u(i,fu("foo",a,yu))):S("Object script error - observe_current_player expects no parameters"),t}},{command:"observe_active_player",action:function(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=_u(i,fu("bar",a,xu))):S("Object script error - observe_active_player expects no parameters"),t}},{command:"observe_all_players",action:hp},{command:"observe_next_player",action:hp},{command:"attach_to_player",action:function(t,e,n){return 0==e?t=gc(t,0,0):1==e?t=gc(t,+n[0],0):2==e?t=gc(t,+n[0],+n[1]):S("Object script error - attach_to_player expects at most two parameters: [offset_x [, offset_y]]"),t}},{command:"springfy_player",action:function(t,e,n){return 0==e?t=ml(t,xl):S("Object script error - springfy_player expects no parameters"),t}},{command:"roll_player",action:function(t,e,n){return 0==e?t=ml(t,kl):S("Object script error - roll_player expects no parameters"),t}},{command:"walk",action:function(t,e,n){var i,a,o;return 1==e?(i=+n,(o=a={init:ap,release:op,update:rp,render:sp,get_object_instance:ga}).decorated_machine=t,o.speed=i,t=a):S("Object script error - walk expects one parameter: speed"),t}},{command:"gravity",action:function(t,e,n){var i;return 0==e?((i={init:Td,release:Id,update:Dd,render:Od,get_object_instance:ga}).decorated_machine=t,t=i):S("Object script error - gravity expects no parameters"),t}},{command:"jump",action:function(t,e,n){var i,a,o,r;return 1==e?(i=t,a=+n[0],(r=o={init:Yd,release:Hd,update:Wd,render:Fd,get_object_instance:ga}).decorated_machine=i,r.jump_strength=a,t=o):S("Object script error - jump expects one parameter: jump_strength"),t}},{command:"move",action:mp},{command:"bullet_trajectory",action:mp},{command:"elliptical_trajectory",action:function(t,e,n){var i,a,o,r,s,c,d,u,l;return e>=4&&e<=6?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],c=+n[4],d=+n[5],(l=u={init:yd,release:xd,update:kd,render:wd,get_object_instance:ga}).decorated_machine=i,l.amplitude_x=a,l.amplitude_y=o,l.angularspeed_x=r*(2*m),l.angularspeed_y=s*(2*m),l.initialphase_x=c*m/180,l.initialphase_y=d*m/180,t=u):S("Object script error - elliptical_trajectory expects at least four and at most six parameters: amplitude_x, amplitude_y, angularspeed_x, angularspeed_y [, initialphase_x [, initialphase_y]]"),t}},{command:"mosquito_movement",action:function(t,e,n){var i,a,o;return 1==e?(i=+n,(o=a={init:ou,release:ru,update:su,render:cu,get_object_instance:ga}).decorated_machine=t,o.speed=i,t=a):S("Object script error - mosquito_movement expects one parameter: speed"),t}},{command:"look_left",action:function(t,e,n){return 0==e?t=Kd(t,eu):S("Object script error - look_left expects no parameters"),t}},{command:"look_right",action:function(t,e,n){return 0==e?t=Kd(t,nu):S("Object script error - look_right expects no parameters"),t}},{command:"look_at_player",action:function(t,e,n){return 0==e?t=Kd(t,iu):S("Object script error - look_at_player expects no parameters"),t}},{command:"look_at_walking_direction",action:function(t,e,n){return 0==e?t=Kd(t,au):S("Object script error - look_at_walking_direction expects no parameters"),t}},{command:"create_item",action:function(t,e,n){var i,a,o,r,s,c;return 3==e?(i=t,a=+n[0],o=+n[1],r=+n[2],(c=s={init:od,release:rd,update:sd,render:cd,get_object_instance:ga}).decorated_machine=i,c.item_id=a,c.offset=it(o,r),t=s):S("Object script error - create_item expects three parameters: item_id, offset_x, offset_y"),t}},{command:"change_closest_object_state",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=n[1],(s=r={init:Hc,release:Wc,update:Fc,render:Xc,get_object_instance:ga}).decorated_machine=i,s.object_name=a,s.new_state_name=o,t=r):S("Object script error - change_closest_object_state expects two parameters: object_name, new_state_name"),t}},{command:"create_child",action:function(t,e,n){return 3==e?t=$c(t,n[0],+n[1],+n[2],""):4==e?t=$c(t,n[0],+n[1],+n[2],n[3]):S("Object script error - create_child expects three or four parameters: object_name, offset_x, offset_y [, child_name]"),t}},{command:"change_child_state",action:function(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=n[0],o=n[1],(s=r={init:Qc,release:Vc,update:Kc,render:qc,get_object_instance:ga}).decorated_machine=i,s.strategy=Zc,s.offset=it(0,0),s.object_name=null,s.child_name=a,s.new_state_name=o,t=r):S("Object script error - change_child_state expects two parameters: child_name, new_state_name"),t}},{command:"change_parent_state",action:function(t,e,n){var i,a,o,r;return 1==e?(i=t,a=n[0],(r=o={init:Qc,release:Vc,update:Kc,render:qc,get_object_instance:ga}).decorated_machine=i,r.strategy=td,r.offset=it(0,0),r.object_name=null,r.child_name=null,r.new_state_name=a,t=o):S("Object script error - change_parent_state expects one parameter: new_state_name"),t}},{command:"destroy",action:function(t,e,n){var i;return 0==e?((i={init:dd,release:ud,update:ld,render:pd,get_object_instance:ga}).decorated_machine=t,t=i):S("Object script error - destroy expects no parameters"),t}},{command:"change_state",action:function(t,e,n){return 1==e?t=wu(t,0,n[0]):S("Object script error - change_state expects one parameter: new_state_name"),t}},{command:"on_timeout",action:function(t,e,n){return 2==e?t=wu(t,+n[0],n[1]):S("Object script error - on_timeout expects two parameters: timeout (in seconds), new_state_name"),t}},{command:"on_collision",action:function(t,e,n){var i,a,o;return 2==e?(i=t,a=n[0],o=n[1],t=Eu(i,o,function(t){var e={init:Au,release:Lu,should_trigger_event:Nu};return e.target_name=t,e}(a))):S("Object script error - on_collision expects two parameters: object_name, new_state_name"),t}},{command:"on_animation_finished",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:Cu,release:Pu,should_trigger_event:Gu})):S("Object script error - on_animation_finished expects one parameter: new_state_name"),t}},{command:"on_random_event",action:function(t,e,n){var i,a,o;return 2==e?(i=t,a=+n[0],o=n[1],t=Eu(i,o,function(t){var e={init:Uu,release:Bu,should_trigger_event:Yu};return e.probability=Math.min(t,0,1),e}(a))):S("Object script error - on_random_event expects two parameters: probability (0.0 <= probability <= 1.0), new_state_name"),t}},{command:"on_player_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:Hu,release:Wu,should_trigger_event:Fu})):S("Object script error - on_player_collision expects one parameter: new_state_name"),t}},{command:"on_player_attack",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:Xu,release:zu,should_trigger_event:$u})):S("Object script error - on_player_attack expects one parameter: new_state_name"),t}},{command:"on_player_rect_collision",action:function(t,e,n){var i,a,o,r,s,c;return 5==e?(i=t,a=+n[0],o=+n[1],r=+n[2],s=+n[3],c=n[4],t=Eu(i,c,function(t,e,n,i){var a={init:Qu,release:Vu,should_trigger_event:Ku},o=a;return o.x1=Math.min(t,n),o.y1=Math.min(e,i),o.x2=Math.max(t,n),o.y2=Math.max(e,i),a}(a,o,r,s))):S("Object script error - on_player_rect_collision expects five parameters: offset_x1, offset_y1, offset_x2, offset_y2, new_state_name"),t}},{command:"on_no_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(0))):S("Object script error - on_no_shield expects one parameter: new_state_name"),t}},{command:"on_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Ns))):S("Object script error - on_shield expects one parameter: new_state_name"),t}},{command:"on_fire_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Cs))):S("Object script error - on_fire_shield expects one parameter: new_state_name"),t}},{command:"on_thunder_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Ps))):S("Object script error - on_thunder_shield expects one parameter: new_state_name"),t}},{command:"on_water_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Gs))):S("Object script error - on_water_shield expects one parameter: new_state_name"),t}},{command:"on_acid_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Us))):S("Object script error - on_acid_shield expects one parameter: new_state_name"),t}},{command:"on_wind_shield",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,qu(Bs))):S("Object script error - on_wind_shield expects one parameter: new_state_name"),t}},{command:"on_brick_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:el,release:nl,should_trigger_event:il})):S("Object script error - on_brick_collision expects one parameter: new_state_name"),t}},{command:"on_floor_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:al,release:ol,should_trigger_event:rl})):S("Object script error - on_floor_collision expects one parameter: new_state_name"),t}},{command:"on_ceiling_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:sl,release:cl,should_trigger_event:dl})):S("Object script error - on_ceiling_collision expects one parameter: new_state_name"),t}},{command:"on_left_wall_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:ul,release:ll,should_trigger_event:pl})):S("Object script error - on_left_wall_collision expects one parameter: new_state_name"),t}},{command:"on_right_wall_collision",action:function(t,e,n){var i,a;return 1==e?(i=t,a=n[0],t=Eu(i,a,{init:_l,release:fl,should_trigger_event:hl})):S("Object script error - on_right_wall_collision expects one parameter: new_state_name"),t}},{command:"show_dialog_box",action:function(t,e,n){return 2==e?t=function(t,e,n){return _d(t,e,n,vd)}(t,n[0],n[1]):S("Object script error - show_dialog_box expects two parameters: title, message"),t}},{command:"hide_dialog_box",action:function(t,e,n){return 0==e?t=_d(t,"dead","beef",bd):S("Object script error - hide_dialog_box expects no parameters"),t}},{command:"clear_level",action:function(t,e,n){var i;return 0==e?((i={init:ed,release:nd,update:id,render:ad,get_object_instance:ga}).decorated_machine=t,t=i):S("Object script error - clear_level expects no parameters"),t}},{command:"play_sample",action:function(t,e,n){return 1==e?t=kc(t,n[0],1,0,1,!1):2==e?t=kc(t,n[0],+n[1],0,1,!1):3==e?t=kc(t,n[0],+n[1],+n[2],1,!1):4==e||5==e?t=kc(t,n[0],+n[1],+n[2],+n[3],!1):S("Object script error - play_sample expects at least one and at most five parameters: sound_name [, volume [, pan [, frequency [, loops]]]]"),t}},{command:"play_music",action:function(t,e,n){var i,a;return 1==e||2==e?(i=t,a=n[0],t=jc(i,Dc(a,!1))):S("Object script error - play_music expects at least one and at most two parameters: music_name [, loops]"),t}},{command:"play_level_music",action:function(t,e,n){return 0==e?t=jc(t,{update:Rc,mus:null,loop:!0}):S("Object script error - play_level_music expects no parameters"),t}},{command:"set_music_volume",action:function(t,e,n){var i,a;return 1==e?(i=t,a=+n[0],t=jc(i,function(t){return{update:Ac,vol:J(t,0,1)}}(a))):S("Object script error - set_music_volume expects one parameter: volume"),t}},{command:null,action:null}],lp=function(t,e){return function(t,e){var n,i,a,o=e;if(0===o.state){var r=t.state.name;for(o.state,o.vm.state_list=(i=o.vm,a=t.state.list[0][0],null==ma(i.state_list,a)&&(i.state_list=function(t,e,n){var i,a;return{name:e,data:(i=n,a={init:ca,release:da,update:ua,render:la,get_object_instance:pa},a.object=i,a),next:t}}(i.state_list,a,i.owner)),i.state_list),o.vm=fa(o.vm,r),n=_a(o.vm),cp=0,function(t,e){cp<1024?(dp[cp]={stmt:t,machine:e},cp++):E("Object script error: you may write ".concat(1024," commands or less per state"))}(t.state.list,n);cp-- >0;)n=pp(dp[cp].stmt,dp[cp].machine);n&&n.init(n)}return o.vm.reference_to_current_state=n,t.destroy_if_far_from_play_area&&(o.preserve=!1),t.always_active&&(o.always_active=!0),t.hide_unless_in_editor_mode&&(o.hide_unless_in_editor_mode=!0),o}(e,t)};function pp(t,e){var n,i,a,o,r=t;for(i=r.length,n=0;n<i;n++)o=(a=r[n])[1]&&void 0!==a[1]?a[1].length?a[1].length:1:0,e=fp(e,a[0],o,a[1]);return e}function _p(t,e,n,i){return t(e,n,i)}function fp(t,e,n,i){for(var a=0,o=up[a++];null!=o.command&&null!=o.action;)o.command==e&&(t=_p(o.action,t,n,i)),o=up[a++];return t}function hp(t,e,n){var i,a;return 0==e?(a=(i=t).get_object_instance(i),t=_u(i,fu("boo",a,ku))):S("Object script error - observe_all_players expects no parameters"),t}function mp(t,e,n){var i,a,o,r,s;return 2==e?(i=t,a=+n[0],o=+n[1],(s=r={init:Gc,release:Uc,update:Bc,render:Yc,get_object_instance:ga}).decorated_machine=i,s.speed=it(a,o),t=r):S("Object script error - bullet_trajectory expects two parameters: speed_x, speed_y"),t}!function(t){t[t.ES_IDLE=0]="ES_IDLE",t[t.ES_DEAD=1]="ES_DEAD"}(ks||(ks={}));var gp,vp=ks.ES_IDLE,bp=ks.ES_DEAD,yp=null,xp=[],kp=function(t){return Lp(t)},wp=function(t){if(!t)return null;for(var e=t.children;e;e=e.next)e.data.parent=null;var n;return Pp(t.children),null!=t.parent&&Ip(t.parent,t),(n=t.vm).state_list=ha(n.state_list),n.reference_to_current_state=null,n.owner=null,Pn(t.actor),null},Ep=function(t,e,n,i,a,o){if(t){var r=_a(t.vm);r.update(r,e,n,i,a,o)}},Sp=function(t,e){if(t){var n=_a(t.vm);(!t.hide_unless_in_editor_mode||t.hide_unless_in_editor_mode&&kh())&&n.render(n,e)}},Mp=function(t){return t.parent},jp=function(t,e){return Bp(t.children,e)},Tp=function(t,e,n){t.children=Gp(t.children,e,n),n.parent=t,n.created_from_editor=!1},Ip=function(t,e){t.children=Up(t.children,e)},Dp=function(t){return null!=t.observed_player?t.observed_player:wh()},Op=function(t,e){t.observed_player=e},Rp=function(t){t.observed_player=wh()},Ap=function(t){t.observed_player=null},Lp=function(t){var e={in_object_name:null,out_object_block:null},n={name:t,state:vp,actor:Cn(),preserve:!0,obstacle:!1,obstacle_angle:0,always_active:!1,hide_unless_in_editor_mode:!1,vm:null,created_from_editor:!0,parent:null,children:Cp(),observed_player:null};return n.actor.input=xe(),Wn(n.actor,dn("SD_QUESTIONMARK",0)),n.vm={owner:n,state_list:null,reference_to_current_state:null},e.in_object_name=t,e.out_object_block=null,e.out_object_block=Np(yp,e),null!=e.out_object_block?n=lp(n,e.out_object_block):E("Object ".concat(t," does not exist")),n},Np=function(t,e){var n=t[e.in_object_name];return n?(e.in_object_name,n):(E("Object script error: unknown keyword ".concat(n)),0)},Cp=function(){return null},Pp=function(t){return null!=t&&(Pp(t.next),t.name=null,t=null),null},Gp=function(t,e,n){return{name:e,data:n,next:t}},Up=function(t,e){var n,i;if(null!=t){if(t.data==e)return i=t.next,t.name=null,t=null,i;for(n=t;null!=n.next&&n.next.data!=e;)n=n.next;return null!=n.next&&(i=n.next.next,n.next.name=null,n.next=null,n.next=i),t}return null},Bp=function(t,e){for(var n=t;null!=n;){if(n.name==e)return n.data;n=n.next}return null};!function(t){t[t.EDITORGRP_ENTITY_BRICK=0]="EDITORGRP_ENTITY_BRICK",t[t.EDITORGRP_ENTITY_ITEM=1]="EDITORGRP_ENTITY_ITEM",t[t.EDITORGRP_ENTITY_ENEMY=2]="EDITORGRP_ENTITY_ENEMY"}(gp||(gp={}));var Yp,Hp,Wp=gp.EDITORGRP_ENTITY_BRICK,Fp=gp.EDITORGRP_ENTITY_ITEM,Xp=(gp.EDITORGRP_ENTITY_ENEMY,[]),zp=0,$p=function(){return zp},Qp=function(t){return zp>0?(t=J(t,0,zp-1),Xp[t]):null},Vp=function(t){return null!=t&&(t.next=Vp(t.next),t=null,t=null),t};!function(t){t[t.EDT_BRICK=1]="EDT_BRICK",t[t.EDT_ITEM=2]="EDT_ITEM",t[t.EDT_ENEMY=3]="EDT_ENEMY",t[t.EDT_GROUP=4]="EDT_GROUP"}(Yp||(Yp={})),function(t){t[t.EDA_NEWOBJECT=1]="EDA_NEWOBJECT",t[t.EDA_DELETEOBJECT=2]="EDA_DELETEOBJECT",t[t.EDA_CHANGESPAWN=3]="EDA_CHANGESPAWN",t[t.EDA_RESTORESPAWN=4]="EDA_RESTORESPAWN"}(Hp||(Hp={}));var Kp,qp,Jp,Zp,t_,e_,n_,i_,a_,o_,r_,s_,c_,d_,u_,l_,p_,__,f_,h_,m_,g_,v_,b_,y_,x_,k_,w_,E_,S_,M_,j_,T_,I_,D_,O_,R_,A_,L_,N_,C_,P_,G_,U_,B_,Y_,H_,W_,F_,X_,z_,$_,Q_,V_,K_,q_,J_,Z_,tf,ef,nf,af,of,rf,sf,cf,df,uf,lf,pf,_f,ff,hf=Yp.EDT_BRICK,mf=Yp.EDT_ITEM,gf=Yp.EDT_ENEMY,vf=Yp.EDT_GROUP,bf=Hp.EDA_NEWOBJECT,yf=Hp.EDA_DELETEOBJECT,xf=Hp.EDA_CHANGESPAWN,kf=Hp.EDA_RESTORESPAWN,wf=function(t){return t==Wp?hf:t==Fp?mf:gf},Ef=!1,Sf=[38,40,39,37,78,66,17,123],Mf=[87,83,68,65,90,89,71,80],jf=0,Tf=0,If=[0,1,2,3,4,5,7,6,42,78,79,80,81,16,17,18,19,20,54,48,49,50,51,52,53,21,47,22,23,43,44,45,46,55,62,56,57,58,59,60,61,24,25,ms,gs,28,29,30,vs,32,33,34,bs,36,37,75,76,77,38,63,64,65,66,67,68,69,39,70,71,72,73,74,-1],Df=!1,Of=it(0,0),Rf=function(){return Ef},Af=function(){var t=mh();gh(t),L(ze("level saved"))},Lf=function(){var t,e=z();t=Se(t_,Ft)?3750:750,(Se(t_,Gt)||Se(e_,Gt))&&(n_.y-=t*e),(Se(t_,Ut)||Se(e_,Ut))&&(n_.y+=t*e),(Se(t_,Bt)||Se(e_,Bt))&&(n_.x-=t*e),(Se(t_,Yt)||Se(e_,Yt))&&(n_.x+=t*e),n_.x=~~Math.max(n_.x,240),n_.y=~~Math.max(n_.y,135.5),ra(n_)},Nf=function(t){switch(t){case hf:return"brick";case mf:return"built-in item";case gf:return"object";case vf:return"group"}return"unknown"},Cf=function(t,e){switch(t){case hf:En(e);break;case mf:Ss(e)}return""},Pf=function(){jf=0,Tf=0,(a_=a_==hf?mf:a_==mf?gf:a_==gf?vf:a_==vf?hf:a_)==vf&&0==$p()&&Pf()},Gf=function(){jf=0,Tf=0,(a_=a_==mf?hf:a_==gf?mf:a_==vf?gf:a_==hf?vf:a_)==vf&&0==$p()&&Gf()},Uf=function(){var t;switch(a_){case hf:t=Sn(),null==En(jf=(jf+1)%t)&&Uf();break;case mf:jf=If[Tf=(Tf+1)%(t=s_)];break;case gf:jf=(jf+1)%(t=d_);break;case vf:t=$p(),jf=(jf+1)%t}},Bf=function(){var t;switch(a_){case hf:t=Sn(),null==En(jf=(jf-1+t)%t)&&Bf();break;case mf:jf=If[Tf=(Tf-1+(t=s_))%t];break;case gf:jf=(jf-1+(t=d_))%t;break;case vf:t=$p(),jf=(jf-1+t)%t}},Yf=function(t){var e;for(e=0;e<s_;e++)if(t==If[e])return e;return-1},Hf=function(t,e,n){var i=null,a=it(0,0);switch(t){case hf:null!=En(e)&&(i=En(e).image);break;case mf:null!=(r=Ss(e))&&(i=Yn(r.actor),(a=r.actor.hot_spot).y-=2);break;case gf:var o=kp(Ff(e));null!=o&&(i=Yn(o.actor),(a=o.actor.hot_spot).y-=2,wp(o));break;case vf:var r=void 0;for(r=Qp(e);r;r=r.next){var s=wf(r.entity.type);Hf(s,r.entity.id,at(n,r.entity.position))}}null!=i&&Ze(i.data,St(),i.sx,i.sy,~~n.x-a.x,~~n.y-a.y,i.swidth,i.sheight)},Wf=function(t){var e;for(e=0;e<d_;e++)if(t==c_[e])return e;return-1},Ff=function(t){return t=J(t,0,NaN),c_[t]},Xf=function(){Df=!1},zf=function(){},$f=function(){Me(e_,Ft)&&(Df=!Df)},Qf=function(t){var e=ot(n_,it(240,135.5)),n=~~(e.x%1),i=~~(e.y%1),a=-n+t.x/1*1,o=-i+t.y/1*1;return at(e,it(a,o))},Vf=function(t,e,n,i){return{type:t?bf:yf,obj_type:e,obj_id:n,obj_position:i,obj_old_position:i}},Kf=function(t,e,n){return{type:t?xf:kf,obj_type:null,obj_id:null,obj_position:e,obj_old_position:n}},qf=function(){l_=Zf(l_),u_=null,p_=null},Jf=function(t){var e,n=!1;if(t.obj_type!=vf){var i=void 0,a=void 0,o={action:t,in_group:n,group_key:null,prev:null,next:null};for(o.in_group&&(o.group_key=e),null!=(i=p_)&&(i.next=Zf(i.next)),a=u_;null!=a.next;)a=a.next;a.next=o,o.prev=a,o.next=null,p_=o}else{var r=48879;for(a=void 0,n=!0,e=r++,a=Qp(t.obj_id);a;a=a.next){var s,c=a.entity,d=wf(c.type);s=Vf(!0,d,c.id,at(c.position,t.obj_position)),Jf(s)}n=!1}},Zf=function(t){var e,n;for(e=t;null!=e;)n=e.next,e=null,e=n;return null},th=function(){var t,e;p_!=l_&&(t=p_,p_=p_.prev,t.in_group&&t.prev&&t.prev.in_group&&t.group_key==t.prev.group_key&&th(),(e=t.action).type=e.type==bf?yf:e.type==yf?bf:e.type==xf?kf:e.type==kf?xf:e.type,nh(e))},eh=function(){var t,e;null!=p_.next&&((t=p_=p_.next).in_group&&t.next&&t.next.in_group&&t.group_key==t.next.group_key&&eh(),e=t.action,nh(e))},nh=function(t){if(t.type==bf)switch(t.obj_type){case hf:Gh(t.obj_id,t.obj_position);break;case mf:Uh(t.obj_id,t.obj_position);break;case gf:Bh(Ff(t.obj_id),t.obj_position);break;case vf:var e=void 0;for(e=Qp(t.obj_id);e;e=e.next){var n,i=e.entity,a=wf(i.type);n=Vf(!0,a,i.id,at(i.position,t.obj_position)),nh(n)}}else if(t.type==yf)switch(t.obj_type){case hf:e=void 0;var o=En(t.obj_id);for(e=__;e;e=e.next)e.data.brick_ref==o&&st(ot(it(e.data.x,e.data.y),t.obj_position))<p&&(e.data.state=1);break;case mf:e=void 0;var r=t.obj_id;for(e=f_;e;e=e.next)e.data.type==r&&st(ot(e.data.actor.position,t.obj_position))<p&&(e.data.state=Es);break;case gf:for(e=void 0,r=t.obj_id,e=h_;e;e=e.next)Wf(e.data.name)==r&&st(ot(e.data.actor.position,t.obj_position))<p&&(e.data.state=bp)}else t.type==xf?(Th(t.obj_position),$h()):t.type==kf&&(Th(t.obj_old_position),$h())},ih=function(t,e){rh(t,e,!0),Gn(t.actor,e),rh(t,e,!1)},ah=function(t){return 1==t.state},oh=function(t,e){var n;for(n=0;n<e.length&&1!=t.state;n++)if(e[n]&&zn(t.actor,e[n].actor))return!(!qs(e[n])&&!e[n].invincible&&(Qs(e[n]),1));return!1},rh=function(t,e,n){var i=t.actor,a=.001*$();if(3===t.type){var o=void 0,r=it(0,0);if(un(dn("SD_INVSTAR",0),1),1!=t.state)for(o=0;o<5;o++)r.x=i.position.x+20*Math.cos(2*m*a+2*o*m/5),r.y=i.position.y+20*Math.sin(m*a+2*o*m/5)}},sh=[0,1,2],ch=ut,dh="data/levels/blue_ocean_1.json",uh={position:it(0,0)},lh=[],ph=[],_h=[],fh=[],hh=function(t){dh=t,E("level_setfile('#{level}')")},mh=function(){return dh},gh=function(t){var e,n,i,a,o,r={name:m_,act:x_,theme:v_,bgtheme:b_,grouptheme:y_,spawn_point:D_,music:g_,boss:null,bricklist:[],itemlist:[],enemylist:[],dialogbox:[]};if(Em()){var s={id:U_.type,x:U_.actor.spawn_point.x,y:U_.actor.spawn_point.y,rx:U_.rect_x,ry:U_.rect_y,rw:U_.rect_w,rh:U_.rect_h};r.boss=s}var c=[];for(i=M_;i;i=i.next){var d={id:Vh(i.data),xpos:i.data.x,ypos:i.data.y};c.push(d)}r.bricklist=c;var u=[];for(a=j_;a;a=a.next)if(a.data){var l={id:a.data.type,xpos:a.data.actor.spawn_point.x,ypos:a.data.actor.spawn_point.y};u.push(l)}r.itemlist=u;var p=[];for(o=T_;o;o=o.next)if(o.data&&o.data.created_from_editor){var _={id:~~o.data.name,xpos:o.data.actor.spawn_point.x,ypos:o.data.actor.spawn_point.y};p.push(_)}r.enemylist=p;var f=[];for(e=0,n=fh.length;e<n;e++){var h={xpos:fh[e].rect_x,ypos:fh[e].rect_y,width:fh[e].rect_w,height:fh[e].rect_h,title:fh[e].title,message:fh[e].message};f.push(h)}r.dialogbox=f;var m=t.split("/");m[m.length-1],E("level_save() ok")},vh=function(){var t;ch=ut,E("level_init()"),M_=null,j_=null,C_=[],k_=800,w_=E_=0,S_=0,_f=0,X_=!1,A_=!1,L_=null,z_=$_=Q_=0,J_=Z_=tf=0,V_=K_=!1,q_=!1,N_=null,nm(),E("editor_init()"),__=Xh(),Ef=!1,s_=If.length,a_=hf,jf=0,Kp=Mt(),qp=jt(),c_=xp,Je("data/images/editorbg.png").then((function(t){Jp=t})),t_=ke(Sf),e_=ke(Mf),Zp=function(){for(var t={type:Pt.IT_MOUSE,enabled:!0,dx:0,dy:0,dz:0,x:0,y:0,z:0,keybmap:null,state:[],oldstate:[],howlong:[]},e=0;e<9;e++)t.state[e]=t.oldstate[e]=!1,t.howlong[e]=0;return Re(t),t}(),o_=oi(8),r_=oi(8),n_=oa(),function(){zp=0;for(var t=0;t<501;t++)Xp[t]=null}(),Xf(),E("editor_init() ok"),Sm(dh).then((function(){E("Creating players...");for(var e=0;e<sh.length;e++)C_[e]=Ws(sh[e]);for(dm(),P_=C_[G_=0],ia.is_locked=!1,ia.speed=0,ia.region_topleft_speed=0,ia.region_bottomright_speed=0,ia.position=ia.dest=it(0,0),ia.region_topleft.x=ia.dest_region_topleft.x=240,ia.region_topleft.y=ia.dest_region_topleft.y=135.5,ia.region_bottomright.x=ia.dest_region_bottomright.x=Mh().x-240,ia.region_bottomright.y=ia.dest_region_bottomright.y=Mh().y-135.5,ra(it(P_.actor.position.x,P_.actor.position.y)),km(P_.actor),ec(0),B_=!1,Y_=!1,E("Loading hud..."),(H_=Cn()).position=it(16,7),Wn(H_,dn("SD_MAINGUI",0)),(W_=Cn()).position=it(16,248),Wn(W_,dn("SD_LIFEGUI",0)),(F_=oi(0)).position=at(W_.position,it(32,11)),t=0;t<3;t++)lh[t]=oi(2),lh[t].position=at(H_.position,it(42,16*t+2));for((of=Cn()).position=it(0,-240),Wn(of,dn("SD_LEVELOP",0)),(rf=Cn()).position=it(260,250),Wn(rf,dn("SD_LEVELACT",x_-1)),(sf=oi(3)).position=it(330,50),si(sf,"%s",m_.toUpperCase()),ui(sf,180),ef=oi(4),nf=oi(7),af=Cn(),t=0;t<3;t++)ph[t]=oi(2),_h[t]=Cn();cf=!1,df=0,(uf=Cn()).position.y=lt,Wn(uf,dn("SD_DIALOGBOX",0)),lf=oi(8),pf=oi(8)}))},bh=function(){var t,e;S_+=z();var n,i,a,o,r,s,c,d,u,l,f=!1,h=!1,g=!1,v=z();if(bm(),gm(),vm(),Rf())!function(){__||(__=Xh());var t,e,n=un(dn("SD_ARROW",0),0),i=di(o_).x,a=di(o_).y,o=ot(n_,it(240,135.5));if(Se(t_,Ft)&&Me(t_,Xt)&&Af(),Se(t_,Xt))return E("editor_disable()"),qf(),Ef=!1,Ot(Kp,qp,Tt()),void E("editor_disable() ok");if(Se(t_,Ft)?((Me(t_,Ht)||Me(Zp,Ut))&&Pf(),(Me(t_,Wt)||Me(Zp,Gt))&&Gf()):((Me(t_,Ht)||Me(Zp,Ut))&&Uf(),(Me(t_,Wt)||Me(Zp,Gt))&&Bf()),i_.x=J(Oe(Zp).x,0,ut-n.width),i_.y=J(Oe(Zp).y,0,lt-n.height),Me(Zp,Ht)&&Se(t_,Ft)){var r=Qf(i_),s=Kf(!0,r,Of);nh(s),Jf(s)}if(Me(Zp,Ht)&&!Se(t_,Ft)&&(s=Vf(!0,a_,jf,Qf(i_)),nh(s),Jf(s)),t=Me(Zp,Ft),e=Me(Zp,Wt),t||e){var c=void 0,d=void 0,u=void 0;switch(a_){case hf:for(c=__;c;c=c.next){var l=[c.data.x,c.data.y,c.data.x+c.data.brick_ref.image.width,c.data.y+c.data.brick_ref.image.height],p=[i_.x+o.x,i_.y+o.y,i_.x+o.x+1,i_.y+o.y+1];if(Z(l,p)){if(!t){s=Vf(!1,hf,zh(c.data),it(c.data.x,c.data.y)),nh(s),Jf(s);break}jf=zh(c.data)}}break;case mf:for(d=f_;d;d=d.next)if(l=[d.data.actor.position.x-d.data.actor.hot_spot.x,d.data.actor.position.y-d.data.actor.hot_spot.y,d.data.actor.position.x-d.data.actor.hot_spot.x+Yn(d.data.actor).width,d.data.actor.position.y-d.data.actor.hot_spot.y+Yn(d.data.actor).height],p=[i_.x+o.x,i_.y+o.y,i_.x+o.x+1,i_.y+o.y+1],Z(l,p)){if(!t){s=Vf(!1,mf,d.data.type,d.data.actor.position),nh(s),Jf(s);break}var _=Yf(d.data.type);_>=0&&(Tf=_,jf=If[_])}break;case gf:for(u=h_;u;u=u.next){l=[u.data.actor.position.x-u.data.actor.hot_spot.x,u.data.actor.position.y-u.data.actor.hot_spot.y,u.data.actor.position.x-u.data.actor.hot_spot.x+Yn(u.data.actor).width,u.data.actor.position.y-u.data.actor.hot_spot.y+Yn(u.data.actor).height],p=[i_.x+o.x,i_.y+o.y,i_.x+o.x+1,i_.y+o.y+1];var f=Wf(u.data.name);if(f>=0&&Z(l,p)){if(!t){s=Vf(!1,gf,f,u.data.actor.position),nh(s),Jf(s);break}jf=f}}}}Se(t_,Ft)&&(Me(e_,Ht)?th():Me(e_,Wt)&&eh()),$f(),Lf(),si(o_,"%d,%d",Qf(i_).x,Qf(i_).y),o_.position.x=J(~~i_.x,10,ut-i*ci(o_).length-10),o_.position.y=J(~~i_.y-3*a,10,261),r_.position=it(10,10),a_!=gf?si(r_,"<color=ffff00>%s %d</color>\n%s",Nf(a_),jf,Cf(a_,jf)):si(r_,'<color=ffff00>%s "%s"</color>\n%s',Nf(a_),Ff(jf),Cf(a_,jf))}();else{for(g=S_<5,t=0;t<C_.length&&!g;t++)C_[t]&&(g=C_[t].dead);if(P_&&P_.actor&&Me(P_.actor.input,Xt)&&!g){var b=[];return O_.pause(),b[0]=Ge("CBOX_QUIT_QUESTION"),b[1]=Ge("CBOX_QUIT_OPTION1"),b[2]=Ge("CBOX_QUIT_OPTION2"),d=b[0],u=b[1],l=b[2],xi=-1,Jt=d,bi[0]=u,l?(bi[1]=l,yi=2):yi=1,void He(gy(ly))}if(1==(e=Ti())?A_=!0:2==e&&T(O_,!0),A_)return yt()?(We(),void Sg()):void bt(en(0,0,0),1);if(Me(t_,zt))return E("editor_enable()"),u_=l_={action:null,in_group:!1,group_key:null,prev:null,next:null},p_=l_,Ef=!0,n_.x=~~oa().x,n_.y=~~oa().y,i_=it(240,135.5),Kp=Mt(),qp=jt(),Ot(3,!1,Tt()),void E("editor_enable() ok");for(h=S_<5,t=0;t<C_.length&&!h;t++)h=C_[t].dying||C_[t].dead;if(P_&&Me(P_.actor.input,Ft)&&!h)return P_.spin_dash=P_.braking=!1,null==M||M.paused||M.pause(),void He(gy(oy));Wn(H_,dn("SD_MAINGUI",Js()>0?0:1)),Wn(W_,dn("SD_LIFEGUI",G_)),si(F_,"%d",Zs()),si(lh[0],"%d",tc());var y=~~(S_/60),x=~~(S_%60),k=x<10?"0"+x:x;if(si(lh[1],"%s",y+":"+k),si(lh[2],"%d",Js()),of&&(S_<5?S_<1.5?(of.position.y+=360*v,of.position.y>-2&&(of.position.y=-2),sf.position.x-=320*v,sf.position.x<140&&(sf.position.x=140),rf.position.y-=200*v,rf.position.y<200&&(rf.position.y=200)):S_>3.5&&(of.position.x-=320*v):(of.visible=!1,sf.visible=!1,rf.visible=!1)),X_){var w=0,S=$(),j=ze("ring count"),R=ze("cash"),A=ze("glasses");if(S>=z_+2e3){for(t=0;t<C_.length;t++)C_[t]&&(C_[t].actor.speed.x=0);for(ef.position.x=Math.min(ef.position.x+800*v,30),nf.position.x=Math.min(nf.position.x+700*v,12),af.position.x=Math.max(af.position.x-700*v,250),t=0;t<3;t++)_h[t].position.x=Math.min(_h[t].position.x+(400-50*t)*v,50),ph[t].position.x=Math.max(ph[t].position.x-(400-50*t)*v,230);w=tf-(J_+Z_),si(ph[0],"%d",~~J_),si(ph[1],"%d",~~Z_),si(ph[2],"%d",~~w),q_||(I(),L(ze("goal")),q_=!0)}if(S>=z_+6e3&&!V_)if(J_=Math.max(0,J_-400*v),Z_=Math.max(0,Z_-2e3*v),J_>0||Z_>0)j&&S>=Q_&&(Q_=S+100,L(j));else for(V_=!0,$_=S+4e3,L(R),t=0;t<C_.length;t++)if(C_[t].got_glasses){L(A);break}V_&&S>=$_&&(K_=!0)}for(sm(),rm(),f=!1,t=0;t<C_.length;t++)C_[t].dying&&(f=!0);for(r=hm(),n=_m(),i=null,Oi(N_),s=j_;s;s=s.next)if(s.data&&s.data.actor){var N=s.data.actor.position.x,C=s.data.actor.position.y,P=Yn(s.data.actor).width,G=Yn(s.data.actor).height;if(wm(N,C,P,G,ch)){if(Ms(s.data,C_,3,n,j_,T_),s.data.obstacle){var U=1,B=at(s.data.actor.hot_spot,it(0,-U)),Y=Yn(s.data.actor);(H=um(Y.width,Y.height-U,ot(s.data.actor.position,B),0)).brick_ref.zindex=s.data.bring_to_back?.4:.5,i={next:i,data:H},n={next:n,data:H}}}else s.data.preserve||(s.data.state=Es)}for(c=T_;c;c=c.next)if(c.data)if(N=c.data.actor.position.x,C=c.data.actor.position.y,P=Yn(c.data.actor).width,G=Yn(c.data.actor).height,wm(N,C,P,G,ch)||c.data.always_active){if(P_&&P_.actor&&P_.actor.input.enabled&&(f||X_||Ep(c.data,C_,C_.length,n,r,T_)),c.data.obstacle){var H;U=1,B=at(c.data.actor.hot_spot,it(0,-U)),Y=Yn(c.data.actor),i={next:i,data:H=um(Y.width,Y.height-U,ot(c.data.actor.position,B),c.data.obstacle_angle)},n={next:n,data:H}}}else c.data.preserve?wm(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y,P,G,ch)||(c.data.actor.position=it(c.data.actor.spawn_point.x,c.data.actor.spawn_point.y)):c.data.state=bp;if(Em()&&P_&&P_.actor){var W,F=[(W=P_.actor).position.x,W.position.y,W.position.x+1,W.position.y+1],X=[U_.rect_x,U_.rect_y,U_.rect_x+U_.rect_w,U_.rect_y+U_.rect_h];if(f||function(t,e,n){var i=t.actor,a=null,o=null,r=null,s=null,c=null,d=null,u=null,l=null,p=[],_=$n(i,2,-2,n,a,o,r,s,c,d,u,l);a=_.up,o=_.upright,r=_.right,s=_.downright,c=_.down,d=_.downleft,u=_.left,l=_.upleft;var f=Kn(i,-2,a,o,r,s,c,d,u,l);if(a=f.up,o=f.upright,r=f.right,s=f.downright,c=f.down,d=f.downleft,u=f.left,l=f.upleft,p[0]=a,p[1]=o,p[2]=r,p[3]=s,p[4]=c,p[5]=d,p[6]=u,p[7]=l,Ah())switch(t.hp<=0&&1!=t.state&&(Lh(),t.state=1),t.type){case 0:!function(t,e,n,i){var a=wh(),o=.001*$(),r=t.actor,s=t.value[0],c=t.value[1];if(1==t.state){if(t.bring_to_front=!0,Wn(r,dn("SD_SIMPLEBOSS",2)),r.position.y+=100*z(),o>=c+.15){var d=it(r.position.x-r.hot_spot.x+q(Yn(r).width),r.position.y-r.hot_spot.y+q(Yn(r).height));Uh(hs,d),r.position.y<=r.spawn_point.y+406.5&&L(ze("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Te(r.input,Yt):3==t.direction&&Te(r.input,Bt),r.position.y=r.spawn_point.y+20*Math.cos(m*o),r.mirror=1==t.direction?0:1,Bn(r,Jn(r)),o>=s+2/t.initial_hp*t.hp&&(Bh(["0","3"][q(2)],r.position).actor.speed.y=-150-q(50),s=o),oh(t,e)&&r.animation==dn("SD_SIMPLEBOSS",0)&&(Wn(r,dn("SD_SIMPLEBOSS",1)),L(ze("boss hit")),a.actor.speed.x*=-1,a.actor.speed.y=100,t.hp--),Fn(r)&&Wn(r,dn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c}(t,e);break;case 1:!function(t,e,n,i){var a,o=wh(),r=t.actor,s=.001*$(),c=z(),d=t.value[0],u=t.value[1],l=t.value[2];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(m*s),Fn(r)&&Wn(r,dn("SD_MECHASHADOW",0)),s>=d+5){var p,_=it(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);_=rt(dt(_),200),p=Uh(40,r.position),so(p,_),L(ze("big shot")),d=s}if(s>=u+15){var f=t.rect_x+t.rect_w/2;t.direction=r.position.x>f?3:1,Wn(r,dn("SD_MECHASHADOW",2)),t.state=2,u=s}break;case 2:var h=t.rect_x+100,g=t.rect_x+t.rect_w-100,v=g-h+(r.position.x-h),b=3==t.direction?-1:1;r.position.x+=200*b*c,r.position.y=r.spawn_point.y-100*Math.sin(m/(g-h)*v),Fn(r)&&Wn(r,dn("SD_MECHASHADOW",2)),(-1==b&&r.position.x<=h||1==b&&r.position.x>=g)&&(Wn(r,dn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Wn(r,dn("SD_MECHASHADOW",4)),r.position.y+=100*z(),s>=l+.15){var y=it(r.position.x-r.hot_spot.x+q(Yn(r).width),r.position.y-r.hot_spot.y+q(Yn(r).height));Uh(hs,y),r.position.y<=r.spawn_point.y+406.5&&L(ze("boss hit")),l=s}}a=r.animation==dn("SD_MECHASHADOW",1)||r.animation==dn("SD_MECHASHADOW",3),oh(t,e)&&!a&&1!=t.state&&(r.animation=dn("SD_MECHASHADOW",2==t.state?3:1),L(ze("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:1}(t,e);break;case 2:!function(t,e,n,i){var a=wh(),o=.001*$(),r=t.actor,s=t.value[0],c=t.value[1],d=t.value[2];if(1==t.state){if(t.bring_to_front=!0,Wn(r,dn("SD_SIMPLEBOSS",2)),r.position.y+=100*z(),o>=c+.15){var u=it(r.position.x-r.hot_spot.x+q(Yn(r).width),r.position.y-r.hot_spot.y+q(Yn(r).height));Uh(hs,u),r.position.y<=r.spawn_point.y+406.5&&L(ze("boss hit")),c=o}}else r.maxspeed=200-100/t.initial_hp*t.hp,r.acceleration=r.maxspeed,r.position.x<r.spawn_point.x-200&&(t.direction=1),r.position.x>r.spawn_point.x&&(t.direction=3),1==t.direction?Te(r.input,Yt):3==t.direction&&Te(r.input,Bt),r.position.y=r.spawn_point.y+20*Math.cos(m*o),r.mirror=1==t.direction?0:1,Bn(r,Jn(r)),o>=s+2/t.initial_hp*t.hp&&(Bh(["9","6"][q(2)],r.position).actor.speed.y=-150-q(50),s=o),o>=d+3/t.initial_hp*t.hp&&(Uh(41,r.position).actor.speed.y=100,L(ze("fire")),d=o),oh(t,e)&&r.animation==dn("SD_SIMPLEBOSS",0)&&(Wn(r,dn("SD_SIMPLEBOSS",1)),L(ze("boss hit")),a.actor.speed.x*=-1,a.actor.speed.y=100,t.hp--),Fn(r)&&Wn(r,dn("SD_SIMPLEBOSS",0)),t.value[0]=s,t.value[1]=c,t.value[2]=d}(t,e);break;case 3:!function(t,e,n,i){var a,o=wh(),r=t.actor,s=.001*$(),c=z(),d=t.value[0],u=t.value[1],l=t.value[2],p=t.value[3];switch(t.state){case 0:if(t.direction=o.actor.position.x<r.position.x?3:1,r.position.y=r.spawn_point.y+30*Math.cos(m*s),Fn(r)&&Wn(r,dn("SD_MECHASHADOW",0)),s>=d+4){var _,f=it(o.actor.position.x-r.position.x,o.actor.position.y-r.position.y);f=rt(dt(f),200),_=Uh(40,r.position),so(_,f),L(ze("big shot")),d=s}if(s>=u+8){var h=t.rect_x+t.rect_w/2;t.direction=r.position.x>h?3:1,Wn(r,dn("SD_MECHASHADOW",2)),t.state=2,u=s}break;case 2:var g=t.rect_x+100,v=t.rect_x+t.rect_w-100,b=v-g+(r.position.x-g),y=3==t.direction?-1:1;r.position.x+=200*y*c,r.position.y=r.spawn_point.y-100*Math.sin(m/(v-g)*b),s>=p+.2&&(Uh(41,r.position).actor.speed.y=-200,L(ze("fire")),p=s),Fn(r)&&Wn(r,dn("SD_MECHASHADOW",2)),(-1==y&&r.position.x<=g||1==y&&r.position.x>=v)&&(Wn(r,dn("SD_MECHASHADOW",0)),t.state=0);break;case 1:if(t.bring_to_front=!0,Wn(r,dn("SD_MECHASHADOW",4)),r.position.y+=100*z(),s>=l+.15){var x=it(r.position.x-r.hot_spot.x+q(Yn(r).width),r.position.y-r.hot_spot.y+q(Yn(r).height));Uh(hs,x),r.position.y<=r.spawn_point.y+406.5&&L(ze("boss hit")),l=s}}a=r.animation==dn("SD_MECHASHADOW",1)||r.animation==dn("SD_MECHASHADOW",3),oh(t,e)&&!a&&1!=t.state&&(r.animation=dn("SD_MECHASHADOW",2==t.state?3:1),L(ze("boss hit")),t.hp--,o.actor.speed.x*=-.5,o.actor.speed.y=o.actor.jump_strength),r.mirror=1==t.direction?0:1,t.value[0]=d,t.value[1]=u,t.value[2]=l,t.value[3]=p}(t,e)}}(U_,C_,M_),!ah(U_)&&Z(F,X)&&(B_=!0,Y_=!0),!ah(U_)){var Q=void 0;for(t=0;t<C_.length;t++)(C_[t]!=P_||P_.actor.carrying)&&((Q=C_[t].actor).position.x>U_.rect_x-30&&Q.position.x<U_.rect_x&&(Q.position.x=U_.rect_x-30,Q.speed.x=0),Q.position.x>U_.rect_x+U_.rect_w&&Q.position.x<U_.rect_x+U_.rect_w+30&&(Q.position.x=U_.rect_x+U_.rect_w+30,Q.speed.x=0))}(ah(U_)||P_.dying)&&(B_=!1,O_&&(D(O()-.5*v),O()<p&&(I(),D(1),R_=!0)))}for(t=0;t<C_.length;t++)Ie(C_[t].actor.input);for(P_&&P_.actor&&S_>=3.5&&De(P_.actor.input),t=0;t<C_.length;t++){N=C_[t].actor.position.x,C=C_[t].actor.position.y,P=Yn(C_[t].actor).width,G=Yn(C_[t].actor).height;var V=C_[t].actor.hot_spot.y;if(t!=G_&&(C_[t].getting_hit&&cm(t),C_[t].dying&&(cm(t),uh!=C_[t].actor&&aa(C_[t].actor.position,0))),C_[t].dead){if(!(Zs()>1))return We(),void He(gy(ry));if(yt())return nc(Zs()-1),void Kh();bt(en(0,0,0),1)}if(K_){if(yt())return void We();bt(en(0,0,0),1)}(wm(N,C,P,G,ch/4)||C_[t].dying)&&(!f||C_[t].dying||C_[t].getting_hit)&&Xs(C_[t],C_,n),C_[t].actor.position.y<V&&!C_[t].dying?(C_[t].actor.position.y=V,C_[t].actor.speed.y=0):C_[t].actor.position.y>E_-(G-V)&&wm(N,C,P,G,ch/4)&&Vs(C_[t])}for(f||X_||(S_+=z()/1e3,P_&&Me(P_.actor.input,Wt)&&(!(Math.abs(P_.actor.speed.y)<p)||P_.on_moveable_platform||B_||P_.disable_movement||P_.in_locked_area?L(ze("deny")):cm((G_+1)%3))),Em()&&B_&&(W=P_.actor)&&(W.position.x<U_.rect_x?(W.position.x=U_.rect_x,W.speed.x=Math.max(0,W.speed.x)):W.position.x>U_.rect_x+U_.rect_w&&(W.position.x=U_.rect_x+U_.rect_w,W.speed.x=Math.min(W.speed.x,0)),W.position.y=J(W.position.y,U_.rect_y,U_.rect_y+U_.rect_h)),im(n),a=n;a;a=a.next){if(a.data&&2==a.data.brick_ref.behavior){var K=a.data.brick_ref.image.width,tt=a.data.brick_ref.image.height,et=[a.data.x,a.data.y,a.data.x+K,a.data.y+tt],nt=[a.data.x,a.data.y,a.data.x+K,a.data.y+tt];for(t=0;t<C_.length;t++)if(C_[t]&&(et[0]=C_[t].actor.position.x-C_[t].actor.hot_spot.x-3,et[1]=C_[t].actor.position.y-C_[t].actor.hot_spot.y-3,et[2]=et[0]+Yn(C_[t].actor).width+6,et[3]=et[1]+Yn(C_[t].actor).height+6,(C_[t].spin_dash||C_[t].spin||C_[t].type==Ls)&&Z(et,nt))){var ct=void 0,pt=void 0,_t=void 0,ft=void 0;for(ft=Math.max(a.data.brick_ref.behavior_arg[0],1),_t=Math.max(a.data.brick_ref.behavior_arg[1],1),ct=0;ct<ft;ct++)for(pt=0;pt<_t;pt++){var ht=it(a.data.x+ct*K/ft,a.data.y+pt*tt/_t),mt=it(.3*-C_[t].actor.speed.x,-100-q(50)),gt=qe(K/ft,tt/_t);Math.abs(mt.x)>p&&(mt.x+=(mt.x>0?1:-1)*q(50)),Yh(gt,ht,mt,!1)}L(ze("break")),a.data.state=1}}if(a.data&&3==a.data.brick_ref.behavior&&2==a.data.state){var vt=a.data;if(vt.value[1]+=z(),vt.value[1]>=1){ct=void 0,pt=void 0,ft=void 0,_t=void 0;var xt=0!=vt.brick_ref.behavior_arg[2];for(gt=vt.brick_ref.image,ft=Math.max(vt.brick_ref.behavior_arg[0],1),_t=Math.max(vt.brick_ref.behavior_arg[1],1),ct=0;ct<ft;ct++)for(pt=0;pt<_t;pt++){var kt=it(vt.x+ct*gt.width/ft,vt.y+pt*gt.height/_t),wt=it(0,20+20*pt+20*(xt?ct:ft-ct)),Et=qe(gt.width/ft,gt.height/_t);Yh(Et,kt,wt,!1)}L(ze("break")),vt.state=1}}xm(a.data)}for(a=i;a;a=o)o=a.next,ym(a.data),a=null;if(i=null,fm(n),mm(r),P_&&P_.actor&&km(P_.actor),X_)aa(at(uh.position,it(0,-90)),.17);else if(B_){var St=[U_.rect_x+240,U_.rect_x+U_.rect_w-240],It=it(J(uh.position.x,St[0],St[1]),uh.position.y);aa(at(It,it(0,-90)),.17)}else f||uh&&aa(uh.position,.1);!function(){var t,e=z();ia.is_locked||sa(-_,-_,_,_),t=ot(ia.dest,ia.position),st(t)>10&&(t=dt(t),ia.position.x+=t.x*ia.speed*e,ia.position.y+=t.y*ia.speed*e),t=ot(ia.dest_region_topleft,ia.region_topleft),st(t)>10&&(t=dt(t),ia.region_topleft.x+=t.x*ia.region_topleft_speed*e,ia.region_topleft.y+=t.y*ia.region_topleft_speed*e),t=ot(ia.dest_region_bottomright,ia.region_bottomright),st(t)>10&&(t=dt(t),ia.region_bottomright.x+=t.x*ia.region_bottomright_speed*e,ia.region_bottomright.y+=t.y*ia.region_bottomright_speed*e),ia.position.x=J(ia.position.x,ia.region_topleft.x,ia.region_bottomright.x),ia.position.y=J(ia.position.y,ia.region_topleft.y,ia.region_bottomright.y)}()}om()},yh=function(){if(kt(),Rf())return e=ot(n_,it(240,135.5)),Jp.width,Jp.height,function(){if(Df){var t,e,n=void 0,i=void 0,a=ot(n_,it(240,135.5));for(t=qe(1,1),e=en(0,128,160),nn(t,0,0,0),n=0;n<t.height;n++)tn(0,St(),t.width-1,n,e);for(n=0;n<t.width;n++)tn(0,St(),n,t.height-1,e);for(n=0;n<=480;n++)for(i=0;i<=271;i++)ot(Qf(it(n*t.width,i*t.height)),a);an(t)}}(),Fh(),Hf(a_,jf,ot(Qf(i_),e)),t=un(dn("SD_ARROW",0),0),Ze(t.data,St(),t.sx,t.sy,~~i_.x,~~i_.y,t.width,t.height),li(o_,it(240,135.5)),void li(r_,it(240,135.5));var t,e;Ri(N_,oa()),qh(),Ai(N_,oa()),Zh()},xh=function(){var t;for(E("level_release()"),an(L_),Qh(),t=0;t<C_.length;t++)Fs(C_[t]);for(E("editor_release()"),zf(),function(){for(var t=0;t<zp;t++)Xp[t]=Vp(Xp[t]);zp=0}(),Ee(e_),Ee(t_),Ee(Zp),ri(r_),ri(o_),Ef=!1,a_=mf,jf=0,E("editor_release() ok"),Pn(W_),Pn(H_),ri(F_),t=0;t<C_.length;t++)ri(lh[t]);for(Pn(of),Pn(rf),ri(sf),ri(ef),ri(nf),Pn(af),t=0;t<3;t++)ri(ph[t]),Pn(_h[t]);ri(lf),ri(pf),Pn(uf),E("level_release() ok")},kh=function(){return Rf()},wh=function(){return P_},Eh=function(){return G_},Sh=function(t){var e,n;t=Math.max(0,t),ic(tc()+t),e=Uh(13,at(P_.actor.position,it(-9,0))),n=""+t,si(e.font,n)},Mh=function(){return it(w_,E_)},jh=function(t){O_&&I(),L(t)},Th=function(t){D_=it(t.x,t.y)},Ih=function(t){var e;if(!X_){for(X_=!0,z_=$(),J_=10*Js(),tf+=J_,e=0;e<C_.length;e++)C_[e]&&C_[e].got_glasses&&Dh(5e3);for(ic(tc()+tf),e=0;e<C_.length;e++)C_[e]&&(Ie(C_[e].actor.input),C_[e].spin_dash=!1);for(km(t),Rh(),si(ef,"TEAM SONIC"),ef.position=it(-500,20),si(nf,"GOT THROUGH"),nf.position=it(-500,46),Wn(af,dn("SD_LEVELACT",x_-1)),af.position=it(820,25),e=0;e<3;e++)_h[e].position=it(-500,120+20*e),ph[e].position=it(820,120+20*e);Wn(_h[0],dn("SD_RINGBONUS",0)),Wn(_h[1],dn("SD_SECRETBONUS",0)),Wn(_h[2],dn("SD_TOTAL",0))}},Dh=function(t){Z_+=t,tf+=t},Oh=function(t,e){(!cf||ci(lf)||ci(pf))&&(cf=!0,df=$(),si(lf,t),si(pf,e),ui(pf,260))},Rh=function(){cf=!1},Ah=function(){return Y_},Lh=function(){var t,e;for(t=T_;t;t=t.next)(e=t.data)&&(e.state=1)},Nh=function(t,e,n,i){!function(t,e,n,i){ia.is_locked=!0,sa(t,e,n,i)}(t+240,e+135.5,n-240,i-135.5)},Ch=function(){null!=O_&&I()},Ph=function(){return k_},Gh=function(t,e){for(var n={brick_ref:En(t),x:e.x,y:e.y,sx:e.x,sy:e.y,enabled:!0,state:0,value:[],animation_frame:0},i=0;i<3;i++)n.value[i]=0;var a={data:n,next:null};return pm(a),a.data},Uh=function(t,e){var n={data:Ss(t),next:null};return n.data.actor.spawn_point=it(e.x,e.y),n.data.actor.position=it(e.x,e.y),n.next=j_,j_=n,n.data},Bh=function(t,e){var n={data:kp(t),next:null};return n.data.actor.spawn_point=e,n.data.actor.position=e,n.next=T_,T_=n,n.data},Yh=function(t,e,n,i){var a={data:{image:t,position:e,speed:n,destroy_on_brick:i},next:I_};Rf()?an(t):I_=a},Hh=function(t,e){var n,i,a,o,r,s;return t?(n=t.value[0],1===t.brick_ref.behavior?(i=t.brick_ref.behavior_arg[0],a=t.brick_ref.behavior_arg[1],o=t.brick_ref.behavior_arg[2]*(2*m),r=t.brick_ref.behavior_arg[3]*(2*m),s=t.brick_ref.behavior_arg[4]*m/180,it(-i*o*Math.sin(o*n+s),a*r*Math.cos(r*n+s))):it(0,0)):it(0,0)},Wh=function(t){return Uh(15,t)},Fh=function(){qh()},Xh=function(){return M_},zh=function(t){return Vh(t)},$h=function(){dm()},Qh=function(){var t,e,n,i,a,o;for(E("level_unload()"),O_.pause(),E("releasing brick list..."),t=M_;t;t=e)e=t.next,t.data=null,t=null;for(M_=null,E("releasing item list..."),n=j_;n;n=i)i=n.next,n.data,n=null;for(j_=null,E("releasing enemy list..."),a=T_;a;a=o)o=a.next,wp(a.data),a=null;T_=null,Em()&&(E("releasing the boss..."),function(t){Pn(t.actor)}(U_),U_=null),E("unloading the brickset..."),E("unloading the background..."),E("level_unload() ok")},Vh=function(t){var e;for(e=0;e<Sn();e++)if(t.brick_ref==En(e))return e;return-1},Kh=function(){var t=D_;xh(),vh(),D_=t},qh=function(){for(var t,e,n,i=null,a=t=_m();a;a=a.next)a.data&&(o=a.data.brick_ref).zindex<.5&&(Mn(a.data),i=jn(a.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(oa().x-240),a.data.y-(oa().y-135.5),1*i.width,1*i.height));for(Jh(!0),a=t;a;a=a.next)if(a.data){var o=a.data.brick_ref;Math.abs(o.zindex-.5)<p&&1!=o.property&&(Mn(a.data),i=jn(a.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(oa().x-240),a.data.y-(oa().y-135.5),1*i.width,1*i.height))}for(e=j_;e;e=e.next)e.data&&e.data.bring_to_back&&js(e.data,oa());for(a=t;a;a=a.next)a.data&&(o=a.data.brick_ref,Math.abs(o.zindex-.5)<p&&1==o.property&&(Mn(a.data),i=jn(a.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(oa().x-240),a.data.y-(oa().y-135.5),1*i.width,1*i.height)));for(Em()&&!U_.bring_to_front&&ih(U_,oa()),n=T_;n;n=n.next)Sp(n.data,oa());for(Jh(!1),Em()&&U_.bring_to_front&&ih(U_,oa()),e=j_;e;e=e.next)e.data&&js(e.data,oa());for(am(),a=t;a;a=a.next)a.data&&(o=a.data.brick_ref).zindex>.5&&(Mn(a.data),i=jn(a.data),St().drawImage(i.data,i.sx,i.sy,i.swidth,i.sheight,a.data.x-(oa().x-240),a.data.y-(oa().y-135.5),1*i.width,1*i.height));fm(t)},Jh=function(t){if(P_){var e;for(e=C_.length-1;e>=0;e--)C_[e]!=P_&&!!C_[e].bring_to_back==t&&zs(C_[e],oa());!!P_.bring_to_back==t&&zs(P_,oa())}},Zh=function(){var t,e=it(240,135.5);if(X_)for(Gn(af,e),li(ef,e),li(nf,e),t=0;t<3;t++)Gn(_h[t],e),li(ph[t],e);else{for(Gn(H_,e),Gn(W_,e),li(F_,e),t=0;t<3;t++)li(lh[t],e);tm()}S_<2.5&&kt("rgb(0,0,0)"),Gn(of,e),Gn(rf,e),li(sf,e),em(e)},tm=function(){var t,e=[],n=[],i=0,a=.001*$();for(t=0;t<10;t++)n[t]=!0;if(P_){switch(P_.got_glasses&&(e[i++]=un(dn("SD_ICON",6),0)),P_.shield_type){case Ns:e[i++]=un(dn("SD_ICON",7),0);break;case Cs:e[i++]=un(dn("SD_ICON",11),0);break;case Ps:e[i++]=un(dn("SD_ICON",12),0);break;case Gs:e[i++]=un(dn("SD_ICON",13),0);break;case Us:e[i++]=un(dn("SD_ICON",14),0);break;case Bs:e[i++]=un(dn("SD_ICON",15),0)}if(P_.invincible&&(e[i++]=un(dn("SD_ICON",4),0),P_.invtimer>=17.25)){var o=(23-P_.invtimer)/5.75;n[i-1]=Math.sin(.5*m*a/(o+.1))>=0}P_.got_speedshoes&&(e[i++]=un(dn("SD_ICON",5),0),P_.speedshoes_timer>=17.25)&&(o=(23-P_.speedshoes_timer)/5.75,n[i-1]=Math.sin(.5*m*a/(o+.1))>=0)}for(t=0;t<i;t++)n[t]&&Ze(e[t].data,St(),e[t].sx,e[t].sy,ut-(e[t].width+5)*(t+1),5,e[t].swidth,e[t].sheight)},em=function(t){Gn(uf,t),li(lf,t),li(pf,t)},nm=function(){I_=null},im=function(t){var e,n,i,a,o=z(),r=k_,s=null;for(i=I_;i;i=a){var c=i.data;if(c){if(n=wm(c.position.x,c.position.y,c.position.x+c.image.width,c.position.y+c.image.height,ch),e=!1,c.destroy_on_brick&&n&&c.speed.y>0){var d=[c.position.x,c.position.y,c.position.x+c.image.width,c.position.y+c.image.height],u=void 0;for(u=t;u&&!e;u=u.next){var l=u.data;if(l&&1==l.brick_ref.property&&0==l.brick_ref.angle){var p=[l.x,l.y,l.x+l.brick_ref.image.width,l.y+l.brick_ref.image.height];Z(d,p)&&(e=!0)}}}!n||e?s?s.next=a:I_=a:(c.position.x+=c.speed.x*o,c.position.y+=c.speed.y*o+.5*r*(o*o),c.speed.y+=r*o,s=i)}}},am=function(){for(var t,e,n,i,a=it(oa().x-240,oa().y-135.5),o=I_;o;o=o.next){var r=o.data;r&&(t=r.image,e=St(),n=r.position.x-a.x,i=r.position.y-a.y,e.putImageData(t,n,i))}},om=function(){null==O_||X_||R_||R()||T(O_,!0)},rm=function(){if(uf){var t=z(),e=$();if(cf){if(e>=df+7e3)return void(cf=!1);uf.position.x=(ut-Yn(uf).width)/2,uf.position.y=Math.max(uf.position.y-100*t,lt-1.3*Yn(uf).height)}else uf.position.y=Math.min(uf.position.y+100*t,lt);lf.position=at(uf.position,it(2,10)),pf.position=at(uf.position,it(2,23))}},sm=function(){if(P_&&P_.actor){var t,e=[],n=[];if(!(S_<2))for(e[0]=P_.actor.position.x,e[1]=P_.actor.position.y,e[2]=e[0]+Yn(P_.actor).width,e[3]=e[1]+Yn(P_.actor).height,t=0;t<_f;t++)if(!fh[t].disabled&&(n[0]=fh[t].rect_x,n[1]=fh[t].rect_y,n[2]=n[0]+fh[t].rect_w,n[3]=n[1]+fh[t].rect_h,Z(e,n))){fh[t].disabled=!0,Oh(fh[t].title,fh[t].message);break}}},cm=function(t){P_.spin_dash=P_.braking=!1,C_[G_=t]&&(P_=C_[G_],km(P_.actor),De(P_.actor.input))},dm=function(){var t,e;for(t=0;t<C_.length;t++)e=D_.x<=w_/2?2-t:t,C_[t].actor.mirror=D_.x<=w_/2?0:1,C_[t].actor.spawn_point.x=C_[t].actor.position.x=D_.x+15*e,C_[t].actor.spawn_point.y=C_[t].actor.position.y=D_.y},um=function(t,e,n,i){for(var a={data:null,image:{data:null,sx:0,sy:0,swidth:0,sheight:0,x:0,y:0,width:0,height:0},angle:i,property:1,behavior:0,zindex:.5,behavior_arg:[]},o=0;o<5;o++)a.behavior_arg[o]=0;return{brick_ref:a,x:n.x,y:n.y,sx:n.x,sy:n.y,enabled:!0,state:0,value:[],animation_frame:0}},lm=function(t,e){var n=t.brick_ref,i=e.brick_ref;if(!n||!i)return!1;if(n.zindex<i.zindex)return-1;if(n.zindex>i.zindex)return 1;if(n.property!=i.property){var a=[0,100,50];return a[n.property]-a[i.property]}return n.angle%180!=0&&i.angle%180==0?-1:n.angle%180==0&&i.angle%180!=0?1:t.sy-e.sy},pm=function(t){var e;if(M_)if(lm(t.data,M_.data))t.next=M_,M_=t;else{for(e=M_;e.next&&lm(e.next.data,t.data);)e=e.next;t.next=e.next,e.next=t}else t.next=null,M_=t},_m=function(){for(var t,e,n,i,a=null,o=M_;o;o=o.next)t=Math.min(o.data.x,o.data.sx),e=Math.min(o.data.y,o.data.sy),n=o.data.brick_ref.image.width,i=o.data.brick_ref.image.height,(wm(t,e,n,i,2*ch)||1==o.data.brick_ref.behavior)&&(a={data:o.data,next:a});return a},fm=function(t){for(var e;t;)e=t.next,t=null,t=e},hm=function(){for(var t,e,n,i,a=null,o=j_;o;o=o.next)if(o.data){var r=Yn(o.data.actor);r&&(t=~~o.data.actor.position.x,e=~~o.data.actor.position.y,n=r.width,i=r.height,wm(t,e,n,i,ch)&&(a={data:o.data,next:a}))}return a},mm=function(t){for(var e;t;)e=t.next,t=null,t=e},gm=function(){var t,e;if(j_)for(j_.data&&j_.data.state==Es&&(e=j_.next,j_.data,j_=e),t=j_;t&&t.next;t=t.next)t.next&&t.next.data&&t.next.data.state==Es&&(e=t.next,t.next=e.next,e.data,e=null)},vm=function(){var t,e;if(T_)for(T_&&T_.data&&T_.data.state==bp&&(e=T_.next,wp(T_.data),T_=null,T_=e),t=T_;t&&t.next;t=t.next)t&&t.next&&t.next.data&&t.next.data.state==bp&&(e=t.next,t.next=e.next,wp(e.data),e=null)},bm=function(){var t,e;if(M_)for(M_.data&&1==M_.data.state&&(e=M_.next,M_.data=null,M_=null,M_=e),t=M_;t&&t.next;t=t.next)1==t.next.data.state&&(e=t.next,t.next=e.next,e.data=null,e=null)},ym=function(t){t.brick_ref=null,t=null},xm=function(t){var e,n,i,a,o,r;t&&(t.value[0]+=z(),e=t.value[0],1===t.brick_ref.behavior)&&(n=t.brick_ref.behavior_arg[0],i=t.brick_ref.behavior_arg[1],a=t.brick_ref.behavior_arg[2]*(2*m),o=t.brick_ref.behavior_arg[3]*(2*m),r=t.brick_ref.behavior_arg[4]*m/180,t.x=t.sx+Math.round(n*Math.cos(a*e+r)),t.y=t.sy+Math.round(i*Math.sin(o*e+r)))},km=function(t){uh.position.x=t.position.x,uh.position.y=t.position.y},wm=function(t,e,n,i,a){var o=oa(),r=[t,e,t+n,e+i],s=[o.x-240-a,o.y-135.5-a,o.x+240+a,o.y+135.5+a];return Z(r,s)},Em=function(){return null!=U_},Sm=function(t){return m_="Untitled",g_="",v_="",b_="",y_="",D_=it(0,0),_f=0,U_=null,x_=1,new Promise((function(e,n){E('level_load("'.concat(t,'")')),k(t).then(Mm).then((function(){O_=j(g_),function(){for(var t=0,e=0,n=M_;n;n=n.next)n.data&&n.data.brick_ref&&0!=n.data.brick_ref.property&&(t=Math.max(t,n.data.sx+jn(n.data).width),e=Math.max(e,n.data.sy+jn(n.data).height));w_=Math.max(t,ut),E_=Math.max(e,lt)}(),E("level_load() ok"),e(null)}))}))},Mm=function(t){var e;for(v_=t.theme,b_=t.bgtheme,y_=t.grouptheme,g_=t.music,m_=t.name,t.author,t.version,t.requires,x_=t.act,D_=t.spawn_point,t.readonly,t.boss&&(U_=function(t,e,n,i,a,o){for(var r={type:t,state:0,direction:0,actor:Cn(),bring_to_front:!1,initial_hp:0,hp:0,value:[],rect_x:n,rect_y:i,rect_w:a,rect_h:o},s=0;s<10;s++)r.value[s]=0;var c=r.actor;switch(c.spawn_point=it(e.x,e.y),c.position=it(e.x,e.y),c.input=xe(),t){case 0:case 2:Wn(c,dn("SD_SIMPLEBOSS",0)),r.initial_hp=r.hp=3,r.direction=3,c.maxspeed=100,c.acceleration=100;break;case 1:case 3:Wn(c,dn("SD_MECHASHADOW",0)),r.initial_hp=r.hp=10,r.direction=3,c.maxspeed=100,c.acceleration=100}return r}(t.boss.id,it(t.boss.x,t.boss.y),t.boss.rx,t.boss.ry,t.boss.rw,t.boss.rh)),e=0;e<t.dialogbox.length;e++){var n={disabled:!1,rect_x:t.dialogbox[e].xpos,rect_y:t.dialogbox[e].ypos,rect_w:t.dialogbox[e].width,rect_h:t.dialogbox[e].height,title:Ue(t.dialogbox[e].title),message:Ue(t.dialogbox[e].message)};fh.push(n),_f=fh.length}for(e=0;e<t.enemylist.length;e++)Bh(""+t.enemylist[e].id,it(t.enemylist[e].xpos,t.enemylist[e].ypos));return new Promise((function(n,i){var a;(a=t.theme,new Promise((function(t,e){E('brickdata_load("'.concat(a,'")')),k(a).then(Tn).then((function(t){wn=t})).then(t)}))).then((function(i){for(var a=0;a<t.bricklist.length;a++)Gh(t.bricklist[a].id,it(t.bricklist[a].xpos,t.bricklist[a].ypos));Ii(t.bgtheme).then((function(i){for(N_=i,e=0;e<t.itemlist.length;e++)Uh(t.itemlist[e].id,it(t.itemlist[e].xpos,t.itemlist[e].ypos));n(N_)}))}))}))},jm=function(t){return new Promise((function(e,n){var i={file:t,name:"",author:"",version:"",description:"",image:null,level_count:0,levels:[],level_path:[],show_ending:!1};E('quest_load("'.concat(t,'")')),k(t).then(Tm).then((function(t){t&&(i=t),E("load_quest() ok!"),e(i)}))}))},Tm=function(t){return new Promise((function(e,n){var i={file:"",name:t.name||"",author:t.author||"Open Sonic",version:t.version||"0",description:t.description||"",show_ending:t.show_ending||!1,image:null,levels:t.levels||[],level_count:t.levels?t.levels.length:0,level_path:t.levels||[]};(function(t){return new Promise((function(e,n){var i=t||"data/images/null.png";Je(i=""+i).then((function(t){e(t)}))}))})(t.image).then((function(t){i.image=t,e(i)}))}))};!function(t){t[t.QUESTVALUE_TOTALTIME=0]="QUESTVALUE_TOTALTIME",t[t.QUESTVALUE_BIGRINGS=1]="QUESTVALUE_BIGRINGS",t[t.QUESTVALUE_GLASSES=2]="QUESTVALUE_GLASSES"}(ff||(ff={}));var Im,Dm,Om,Rm,Am,Lm,Nm,Cm,Pm,Gm,Um,Bm,Ym,Hm,Wm,Fm,Xm,zm,$m,Qm,Vm,Km,qm,Jm,Zm,tg,eg,ng,ig,ag,og,rg,sg,cg,dg,ug,lg,pg,_g,fg=ff.QUESTVALUE_TOTALTIME,hg=ff.QUESTVALUE_BIGRINGS,mg=ff.QUESTVALUE_GLASSES,gg=null,vg=0,bg=!1,yg=[],xg=function(){var t;for(bg=!1,t=0;t<3;t++)yg[t]=0},kg=function(){if(0!=gg.level_count)return vg<gg.level_count&&!bg?(hh(gg.level_path[vg]),He(gy(ay)),void vg++):(We(),void(bg?He(gy(dy)):gg.show_ending?He(gy(cy)):He(gy(uy))));E("Quest '%s' has no levels. ".concat(gg.file))},wg=function(){},Eg=function(){},Sg=function(){bg=!0},Mg=function(t,e){var n=J(t,0,2);yg[n]=e},jg=function(t){var e=J(t,0,2);return yg[e]},Tg=[],Ig=0,Dg=function(){Ig=0,Tg[0]=oi(7),Tg[0].position=it(-50,112),si(Tg[0],"GAME"),Tg[1]=oi(7),Tg[1].position=it(298,112),si(Tg[1],"OVER")},Og=function(){var t=z();if((Ig+=t)>5){if(yt())return Sg(),void We();bt(en(0,0,0),2)}Tg[0].position.x+=200*t,Tg[0].position.x>80&&(Tg[0].position.x=80),Tg[1].position.x-=200*t,Tg[1].position.x<168&&(Tg[1].position.x=168)},Rg=function(){kt();var t=it(240,135.5);li(Tg[0],t),li(Tg[1],t)},Ag=function(){an(null),ri(Tg[1]),ri(Tg[0]),Sg()},Lg=0,Ng=null,Cg=function(){Lg=0,Ii("data/themes/intro.bg.json").then((function(t){Ng=t,vt(en(0,0,0),1)}))},Pg=function(){if(Ng&&(Lg+=z(),Oi(Ng),Lg>=3)){if(yt())return We(),void He(gy(dy));bt(en(0,0,0),1)}},Gg=function(){if(Ng){var t=it(240,135.5);Ri(Ng,t),Ai(Ng,t)}},Ug=function(){Ng=null},Bg=["data/languages/deutsch.json","data/languages/dutch.json","data/languages/english.json","data/languages/francais.json","data/languages/indonesian.json","data/languages/italiano.json","data/languages/polish.json","data/languages/ptbr.json"],Yg=1,Hg=1,Wg=!1,Fg=0,Xg=[],zg=[],$g=[],Qg=0,Vg=0,Kg=function(){Qg=0,Wg=!1,Vg=0,Om=we(),Im=oi(8),Xg[0]=oi(4),si(Xg[0],"SELECT YOUR"),Xg[0].position.x=(ut-ci(Xg[0]).length*di(Xg[0]).x)/2-140,Xg[0].position.y=10,Xg[1]=oi(4),si(Xg[1],"LANGUAGE"),Xg[1].position.x=(ut-ci(Xg[1]).length*di(Xg[1]).x)/2-120,Xg[1].position.y=Xg[0].position.y+di(Xg[1]).y+10+10,Xg[2]=oi(8),si(Xg[2],Ue("MENU_CQ_BACK")),Xg[2].position.x=10,Xg[2].position.y=lt-1.5*di(Xg[2]).y,Ii("data/themes/langselect.bg.json").then((function(t){Rm=t,vt(en(0,0,0),1)})),Dm=Cn(),Wn(Dm,dn("SD_TITLEFOOT",0)),ev(),vt(en(0,0,0),1)},qg=function(){var t=z();if(Vg+=t,Oi(Rm),Dm&&zg.length&&(Dm.position=it(zg[0][Qg].position.x,zg[0][Qg].position.y),Dm.position.x-=15,Dm.position.x+=5*Math.cos(2*m*Vg)),!Wg&&!xt()){if(Me(Om,Ut)&&(Qg=(Qg+1)%Fg,L(ze("choose"))),Me(Om,Gt)&&(Qg=((Qg-1)%Fg+Fg)%Fg,L(ze("choose"))),Me(Om,Ht)||Me(Om,Ft)){if(!$g)return;var e=$g[Qg].filepath;E("Loading language ".concat($g[Qg].title," ").concat(e)),Pe("data/languages/english.json"),Pe(e),tv(e),L(ze("select"))}Me(Om,Xt)&&(L(ze("return")),Wg=!0)}if(Yg=Math.floor(1+Qg/8),Hg=Math.floor(1+Math.max(0,Fg-1)/8),si(Im,"page %d/%d",Yg,Hg),Im.position.x=ut-ci(Im).length*di(Im).x-10,Im.position.y=lt-di(Im).y-3,!R()){var n=j("data/music/options.mp4");T(n,!0)}if(Wg){if(yt())return void We();bt(en(0,0,0),1)}},Jg=function(){var t,e=it(240,135.5);for(kt(),Ri(Rm,e),Ai(Rm,e),li(Xg[0],e),li(Xg[1],e),li(Xg[2],e),Hg>1&&li(Im,e),t=8*(Yg-1);t<8*Yg;t++)Bg[t]&&zg.length>1&&li(zg[Qg==t?1:0][t],e);Gn(Dm,e)},Zg=function(){nv(),Rm=Di(Rm),Pn(Dm),ri(Xg[0]),ri(Xg[1]),ri(Im),Ee(Om)},tv=function(t){var e;e=t,P.language=e,G()},ev=function(){E("load_lang_list()"),x(Bg).then((function(t){Fg=($g=t).length,zg[0]=[],zg[1]=[];for(var e=0;e<Fg;e++)$g[e].filepath=Bg[e],zg[0][e]=oi(8),zg[1][e]=oi(8),si(zg[0][e],$g[e].LANG_LANGUAGE),si(zg[1][e],$g[e].LANG_LANGUAGE),zg[0][e].position=it(25,75+e%8*20),zg[1][e].position=it(25,75+e%8*20)}))},nv=function(){var t;for(E("unload_lang_list()"),t=0;t<Fg;t++)ri(zg[0][t]),ri(zg[1][t]);zg[0]=null,zg[1]=null,$g=null,Fg=0},iv=["data/quests/default.json","data/quests/extra.json","data/quests/superbosses.json","data/quests/tutorial.json"],av=3,ov=[],rv=[],sv=[],cv=[],dv=function(){Qm=!1,Am=0,Pm=.001*$(),Gm=!1,Nm=null,Lm=we(),Ie(Lm),fv(),Jm=j("data/music/title.mp4"),T(Jm,!0),Ii("data/themes/menu.bg.json").then((function(t){Cm=t,vt(en(0,0,0),1)})),Hm=!0,Wm=Cn(),Wn(Wm,dn("SD_TITLESURGE",0)),Wm.position.x=(ut-Yn(Wm).width)/2+5,Wm.position.y=-15,Fm=Cn(),Wn(Fm,dn("SD_TITLEBG",0)),Fm.position.x=(ut-Yn(Fm).width)/2,Fm.position.y=Wm.position.y+25,Xm=Cn(),Wn(Xm,dn("SD_TITLEGAMENAME",0)),Xm.position.x=(ut-Yn(Xm).width)/2,Xm.position.y=Wm.position.y+Yn(Wm).height-9,(zm=oi(8)).position=it(3,259),si(zm,"%s",l),($m=oi(0)).position=it(405,3),si($m,"V%d.%d.%d",1,1,1),Bm=0,Ym=Cn(),Wn(Ym,dn("SD_TITLEFOOT",0)),(Um=[])[0]=Ge("MENU_1PGAME"),Um[1]=Ge("MENU_TUTORIAL"),Um[2]=Ge("MENU_CUSTOMQUESTS"),Um[3]=Ge("MENU_OPTIONS"),av=Um.length,ov=[];for(var t=0;t<2;t++)for(var e=0;e<av;e++)ov[e]||(ov[e]=[]),ov[e][t]=oi(t),ov[e][t].position=it(240-Yn(Fm).width/5,Xm.position.y+65+10*e),si(ov[e][t],Um[e]);rv[0]=oi(8),rv[0].position=it(5,3),rv[1]=oi(8),rv[1].position=it(5,258),(Vm=oi(8)).position=it(5,170),vt(en(0,0,0),1.5)},uv=function(){var t,e=.001*$();if(null!=Nm&&yt())return We(),void He(Nm);switch(e<=Pm+2?Ie(Lm):Gm||(De(Lm),Gm=!0),Oi(Cm),Am){case 0:Hm&&Fn(Wm)&&(Hm=!1,Wn(Wm,dn("SD_TITLESURGE",1)),De(Lm)),Xm.visible=!Hm,Ym.position.x=ov[Bm][0].position.x-20+3*Math.cos(2*m*e),Ym.position.y=ov[Bm][0].position.y,Me(Lm,Gt)&&(L(ze("choose")),Bm--),Me(Lm,Ut)&&(L(ze("choose")),Bm++),Bm=(Bm%av+av)%av,(Me(Lm,Ht)||Me(Lm,Ft))&&(L(ze("select")),_v(Bm));break;case 1:for(Me(Lm,Xt)&&(L(ze("return")),Am=0),t=0;t<qm;t++)sv[t].position=it(30,20+t%14*10),sv[t].visible=hv(t)==hv(Km);if(Ym.position.x=10,Ym.position.y=sv[Km].position.y,Me(Lm,Gt)&&(L(ze("choose")),Km--),Me(Lm,Ut)&&(L(ze("choose")),Km++),Km=(Km%qm+qm)%qm,si(rv[0],Ue("MENU_CQ_SELECT"),hv(Km),mv()),si(rv[1],Ue("MENU_CQ_BACK")),si(Vm,Ue("MENU_CQ_INFO"),cv[Km].version,cv[Km].name,cv[Km].author,cv[Km].description),Me(Lm,Ht)||Me(Lm,Ft))return L(ze("select")),void gv(cv[Km])}},lv=function(){var t,e=it(240,135.5);if(kt(),!Qm||!yt())switch(Ri(Cm,e),Ai(Cm,e),Am){case 0:for(t=0;t<av;t++)li(ov[t][t==Bm?1:0],e);Gn(Ym,e),li(zm,e),li($m,e),Gn(Fm,e),Hm&&kt(),Gn(Wm,e),Gn(Xm,e);break;case 1:var n=cv[Km].image;for(li(Vm,e),Ze(n,St(),0,0,ut-n.width-25,sv[0].position.y,n.width,n.height),li(rv[0],e),li(rv[1],e),t=0;t<qm;t++)li(sv[t],e);Gn(Ym,e)}},pv=function(){var t,e;for(Jm.pause(),ri(zm),ri($m),t=0;t<2;t++)for(e=0;e<av;e++)ri(ov[e][t]);Pn(Fm),Pn(Xm),Pn(Wm),Pn(Ym),Ee(Lm)},_v=function(t){var e=iv[0];switch(t){case 0:return void jm(e).then((function(t){gv(t)}));case 1:return void jm("data/quests/tutorial.json").then((function(t){gv(t)}));case 2:Am=1,Km=0;break;case 3:return Nm=gy(fy),void bt(en(0,0,0),.5)}},fv=function(){var t;for(qm=iv.length,cv=[],t=0;t<qm;t++)!function(e){jm(iv[t]).then((function(t){sv[e]=oi(8),cv[e]=t,si(sv[e],t.name)}))}(t);console.log("qstdata",cv)},hv=function(t){return Math.floor(t/14+1)},mv=function(){return Math.floor(qm/14+(qm%14==0?0:1))},gv=function(t){var e,n;gg=e=t,nc(5),ic(0),E("Running quest %s, '%s'... ".concat(e.file," ").concat(e.name)),n=0,vg=Math.max(0,n),Nm=gy(sy),Ie(Lm),bt(en(0,0,0),.5)},vv=function(t){if(t){t.init(t);for(var e=0;e<t.child_count;e++)vv(t.child[e])}},bv=function(t){if(t){for(var e=0;e<t.child_count;e++)bv(t.child[e]);t.update(t)}},yv=function(t,e){if(t){for(var n=0;n<t.child_count;n++)yv(t.child[n],e);t.render(t,e)}},xv=function(t){var e=0;if(t){for(var n=0;n<t.child_count;n++)e+=xv(t.child[n]);return 1+e}return 0},kv=function(t,e,n,i){return{font:null,init:t,release:e,update:n,render:i,data:null,parent:null,child:[],child_count:0}},wv=function(t,e){t.child_count<10&&(t.child[t.child_count++]=e,e.parent=t)},Ev=function(t){if(t.font=oi(8),si(t.font,"LABEL"),null!=t.parent){var e=void 0,n=void 0,i=0,a=null!=t.parent.font?di(t.parent.font):it(12,12);for(e=0;e<t.parent.child_count&&t.parent.child[e]!=t;e++);for(n=0;n<e;n++)i+=xv(t.parent.child[n])-1;t.font.position={x:t.parent.font.position.x,y:t.parent.font.position.y},t.font.position.x+=3*a.x,t.font.position.y+=(1+i+e)*a.y*2}},Sv=function(t){ri(t.font)},Mv=function(t,e){li(t.font,e)},jv=function(){sg=0,Zm=!1,og=0,ig=we(),ag=null,tg=!0,eg=oi(4),si(eg,Ue("OPTIONS_TITLE")),eg.position.x=140,eg.position.y=10,Ii("data/themes/options.bg.json").then((function(t){rg=t})),ng=Cn(),Wn(ng,dn("SD_TITLEFOOT",0)),ng.position=it(-50,-50),cg=bb(),vv(cg)},Tv=function(){var t=z();if(og+=t,si(eg,Ue("OPTIONS_TITLE")),tg&&(vt(en(0,0,0),1),tg=!1),Oi(rg),Zm||null!=ag||xt()||(Me(ig,Ut)&&(sg=(sg+1)%5,L(ze("choose"))),Me(ig,Gt)&&(sg=((sg-1)%5+5)%5,L(ze("choose"))),Me(ig,Xt)&&(L(ze("return")),Zm=!0)),bv(cg),Zm)xt()||I();else if(!R()&&og>=.2){var e=j("data/music/options.mp4");T(e,!0)}if(Zm){if(yt())return Ov(),We(),void He(gy(dy));bt(en(0,0,0),1)}if(null!=ag){if(yt())return Ov(),He(ag),ag=null,void(tg=!0);bt(en(0,0,0),1)}},Iv=function(){var t=it(240,135.5);Ri(rg,t),Ai(rg,t),li(eg,t),yv(cg,t),Gn(ng,t)},Dv=function(){Pn(ng),ri(eg),Ee(ig)},Ov=function(){var t,e,n;t=Tt(),P.fullscreen=t,G(),e=jt(),P.smooth_graphics=e,G(),n=It(),P.show_fps=n,G()},Rv=function(t,e){Ev(t),t.data=e,si(t.font,Ue(e))},Av=function(t){t.data=null,Sv(t)},Lv=function(t){si(t.font,Ue(t.data))},Nv=function(t,e){Mv(t,e)},Cv=function(t,e,n){var i;Ev(t),si(t.font,Ue(e)),t.data={},(i=t.data).option_index=n,i.lang_key=e},Pv=function(t){t.data=null,Sv(t)},Gv=function(t){var e=t.data;return sg==e.option_index},Uv=function(t){var e=t.data;si(t.font,Ue(e.lang_key)),Gv(t)&&(si(t.font,"<color=ffff00>%s</color>",Ue(e.lang_key)),ng.position=at(t.font.position,it(3*Math.cos(2*m*og)-20,0)))},Bv=function(t,e){Mv(t,e)},Yv=function(t){Ev(t),si(t.font,""),t.font.position=it(0,25)},Hv=function(t){Sv(t)},Wv=function(t){},Fv=function(t,e){Mv(t,e)},Xv=function(t){Rv(t,"OPTIONS_GRAPHICS")},zv=function(t){Av(t)},$v=function(t){Lv(t)},Qv=function(t,e){Nv(t,e)},Vv=function(t){Cv(t,"OPTIONS_FPS",0)},Kv=function(t){Pv(t)},qv=function(t){Uv(t),function(t){return Gv(t)}(t)&&(xt()||((Me(ig,Ht)||Me(ig,Ft))&&(L(ze("select")),Dt(!It())),Me(ig,Yt)&&It()&&(L(ze("select")),Dt(!1)),Me(ig,Bt)&&(It()||(L(ze("select")),Dt(!0)))))},Jv=function(t,e){var n,i=[];Bv(t,e),(n=oi(8)).position=it(175,t.font.position.y),i[0]=Ue("OPTIONS_YES"),i[1]=Ue("OPTIONS_NO"),It()?si(n,"<color=ffff00>%s</color>  %s",i[0],i[1]):si(n,"%s  <color=ffff00>%s</color>",i[0],i[1]),li(n,e),ri(n)},Zv=function(t){Rv(t,"OPTIONS_GAME")},tb=function(t){Av(t)},eb=function(t){Lv(t)},nb=function(t,e){Nv(t,e)},ib=function(t){Cv(t,"OPTIONS_LANGUAGE",1)},ab=function(t){Pv(t)},ob=function(t){Uv(t),function(t){return Gv(t)}(t)&&(xt()||(Me(ig,Ht)||Me(ig,Ft))&&(L(ze("select")),ag=gy(py)))},rb=function(t,e){Bv(t,e)},sb=function(t){Cv(t,"OPTIONS_STAGESELECT",2)},cb=function(t){Pv(t)},db=function(t){Uv(t),function(t){return Gv(t)}(t)&&(xt()||(Me(ig,Ht)||Me(ig,Ft))&&(L(ze("select")),ag=gy(hy)))},ub=function(t,e){Bv(t,e)},lb=function(t){Cv(t,"OPTIONS_CREDITS",3)},pb=function(t){Pv(t)},_b=function(t){Uv(t),function(t){return Gv(t)}(t)&&(xt()||(Me(ig,Ht)||Me(ig,Ft))&&(L(ze("select")),ag=gy(_y)))},fb=function(t,e){Bv(t,e)},hb=function(t){Cv(t,"OPTIONS_BACK",4)},mb=function(t){Pv(t)},gb=function(t){Uv(t),function(t){return Gv(t)}(t)&&(xt()||(Me(ig,Ht)||Me(ig,Ft))&&(L(ze("select")),Zm=!0))},vb=function(t,e){Bv(t,e)},bb=function(){var t,e,n,i,a,o,r,s;return n=kv(Vv,Kv,qv,Jv),e=kv(Xv,zv,$v,Qv),wv(e,n),a=kv(ib,ab,ob,rb),o=kv(lb,pb,_b,fb),r=kv(sb,cb,db,ub),i=kv(Zv,tb,eb,nb),wv(i,a),wv(i,r),wv(i,o),s=kv(hb,mb,gb,vb),t=kv(Yv,Hv,Wv,Fv),wv(t,e),wv(t,i),wv(t,s),t},yb=null,xb=!1,kb=!1,wb=0,Eb=function(){yb=we(),xb=!1,kb=!1,wb=0},Sb=function(){if(Me(yb,Xt))return Ge("CBOX_QUIT_QUESTION"),Ge("CBOX_QUIT_OPTION1"),Ge("CBOX_QUIT_OPTION2"),void He(gy(ly));if(1==Ti()&&(kb=!0),kb)return yt()?(We(),We(),void Sg()):void bt(en(0,0,0),1);if(xb){if(Me(yb,Ft))return null!=M&&M.paused&&M.play(),void We()}else je(yb,Ft)&&(xb=!0)},Mb=function(){var t=un(dn("SD_PAUSE",0),0),e=1+.5*Math.abs(Math.cos(m/2*wb));it((ut-t.width)/2-(e-1)*t.width/2,(lt-t.height)/2-(e-1)*t.height/2),kb||(wb+=z())},jb=function(){an(null),Ee(yb)},Tb=!1,Ib=function(){$(),Tb=!1,(dg=oi(8)).position=it(5,35),ug=oi(4),si(ug,Ue("QUESTCLEARED_TITLE")),ug.position=it((ut-di(ug).x*ci(ug).length)/2,5),lg=Cn(),Wn(lg,dn("SD_SONIC",24)),lg.position=it(20,150),T(j("data/music/invincible.mp4"),!1),pg=we(),vt(en(0,0,0),2)},Db=function(){var t=tc(),e=jg(fg)/3600,n=jg(fg)/60%60,i=jg(fg)%60,a=jg(mg),o=jg(hg);if($(),si(dg,Ue("QUESTCLEARED_TEXT"),"NO_QUEST_NAME",t,e,n,i,a,o,u,l),Me(pg,Ht)&&(Tb=!0),Tb){if(yt())return We(),void He(gy(dy));bt(en(0,0,0),2)}},Ob=function(){var t=it(240,135.5);kt(),li(ug,t),li(dg,t),Gn(lg,t)},Rb=function(){Ee(pg),Pn(lg),ri(ug),ri(dg)},Ab=["data/levels/blue_ocean_1.json","data/levels/blue_ocean_2.json","data/levels/blue_ocean_3.json","data/levels/desert1.json","data/levels/exotic_1.json","data/levels/exotic_2.json","data/levels/exotic_3.json","data/levels/exotichell_1.json","data/levels/prototype.json","data/levels/superboss_1.json","data/levels/superboss_2.json","data/levels/template.json","data/levels/tutorial_1.json","data/levels/tutorial_2.json","data/levels/test.json"];!function(t){t[t.STAGESTATE_NORMAL=0]="STAGESTATE_NORMAL",t[t.STAGESTATE_QUIT=1]="STAGESTATE_QUIT",t[t.STAGESTATE_PLAY=2]="STAGESTATE_PLAY",t[t.STAGESTATE_FADEIN=3]="STAGESTATE_FADEIN"}(_g||(_g={}));var Lb,Nb,Cb,Pb,Gb,Ub,Bb,Yb=_g.STAGESTATE_NORMAL,Hb=_g.STAGESTATE_QUIT,Wb=_g.STAGESTATE_PLAY,Fb=_g.STAGESTATE_FADEIN,Xb=1,zb=1,$b=0,Qb=[],Vb=0,Kb=0,qb=[],Jb=function(){Kb=0,$b=0,Bb=Yb,Gb=we(),Lb=oi(4),si(Lb,Ue("STAGESELECT_TITLE")),Lb.position.x=(ut-ci(Lb).length*di(Lb).x)/2-150,Lb.position.y=10,Nb=oi(8),si(Nb,Ue("STAGESELECT_MSG")),Nb.position.x=10,Nb.position.y=lt-1.5*di(Nb).y,Cb=oi(8),si(Cb,Ue("STAGESELECT_PAGE"),0,0),Cb.position.x=ut-ci(Cb).length*di(Cb).x-10,Cb.position.y=40,Ii("data/themes/levelselect.bg.json").then((function(t){Ub=t})),Pb=Cn(),Wn(Pb,dn("SD_TITLEFOOT",0)),ny(),vt(en(0,0,0),1)},Zb=function(){var t=z();if($b+=t,Oi(Ub),qb.length){if(Pb.position=it(qb[Kb].position.x,qb[Kb].position.y),Pb.position.x+=3*Math.cos(2*m*$b)-20,Xb=Math.floor(Kb/8+1),zb=Math.floor(Vb/8+(Vb%8==0?0:1)),si(Cb,Ue("STAGESELECT_PAGE"),Xb,zb),Cb.position.x=ut-ci(Cb).length*di(Cb).x-10,Bb==Wb)xt()||I();else if(!R()){var e=j("data/music/options.mp4");T(e,!0)}switch(Bb){case Yb:xt()||(Me(Gb,Ut)&&(Kb=(Kb+1)%Vb,L(ze("choose"))),Me(Gb,Gt)&&(Kb=((Kb-1)%Vb+Vb)%Vb,L(ze("choose"))),(Me(Gb,Ht)||Me(Gb,Ft))&&(E("Loading level ".concat(Qb[Kb].name," ").concat(Qb[Kb].filepath)),hh(Qb[Kb].filepath),L(ze("select")),Bb=Wb),Me(Gb,Xt)&&(L(ze("return")),Bb=Hb));break;case Hb:if(yt())return void We();bt(en(0,0,0),1);break;case Wb:if(yt())return nc(5),ic(0),He(gy(ay)),void(Bb=Fb);bt(en(0,0,0),1);break;case Fb:vt(en(0,0,0),1),Bb=Yb}}},ty=function(){var t,e=it(240,135.5);for(Ri(Ub,e),Ai(Ub,e),li(Lb,e),li(Nb,e),zb>1&&li(Cb,e),t=8*(Xb-1);t<8*Xb;t++)Qb[t]&&(si(qb[t],Kb==t?"<color=ffff00>%s - %s %s</color>":"%s - %s %s",Qb[t].name,Ue("STAGESELECT_ACT"),Qb[t].act),li(qb[t],e));Gn(Pb,e)},ey=function(){iy(),Ub=Di(Ub),Pn(Pb),ri(Lb),ri(Nb),ri(Cb),Ee(Gb)},ny=function(){E("load_stage_list()"),x(Ab).then((function(t){Vb=(Qb=t).length;for(var e=0;e<Vb;e++)qb[e]=oi(8),qb[e].position=it(25,60+e%8*20),Qb[e].filepath=Ab[e]}))},iy=function(){},ay=1,oy=2,ry=3,sy=4,cy=5,dy=6,uy=7,ly=8,py=9,_y=10,fy=11,hy=12,my=[],gy=function(t){return my[t]},vy=function(t,e,n,i){return{init:t,update:e,render:n,release:i}},by=function(){var t,e,i;e=function(){!function(){var t=0,e=0;for(e=0;e<10;)e=(t=$())>W?t-W:0,W=t>=W?W:t;e=Math.min(e,16),F=.001*e,B++,(Y+=e)>=1e3&&(H=B,B=0,Y=0),W=$()}(),function(){var t,e,n=z();for(e=se;e;e=e.next){for(t=0;t<9;t++)e.data.oldstate[t]=e.data.state[t];for(t=0;t<9;t++)Se(e.data,t)?e.data.howlong[t]+=n:e.data.howlong[t]=0;switch(e.data.type){case Pt.IT_KEYBOARD:e.data.state[Gt]=pe.up,e.data.state[Ut]=pe.down,e.data.state[Bt]=pe.left,e.data.state[Yt]=pe.right,e.data.state[Ht]=pe.space,e.data.state[Wt]=pe.lcontrol,e.data.state[Ft]=pe.enter,e.data.state[Xt]=pe.esc,e.data.state[zt]=pe.tilda;break;case Pt.IT_MOUSE:e.data.x=be.x,e.data.y=be.y,e.data.state[Ht]=ye.left,e.data.state[Ft]=ye.middle,e.data.state[Wt]=ye.right;break;case Pt.IT_COMPUTER:for(t=0;t<9;t++)e.data.state[t]=!1;break;case Pt.IT_JOYSTICK:ce&&!de&&(e.data.state[Gt]=_e[0].stick[0].axis[1].d1,e.data.state[Ut]=_e[0].stick[0].axis[1].d2,e.data.state[Bt]=_e[0].stick[0].axis[0].d1,e.data.state[Yt]=_e[0].stick[0].axis[0].d2,e.data.state[Ht]=_e[0].button[0].b,e.data.state[Wt]=_e[0].button[1].b,e.data.state[Ft]=_e[0].button[2].b,e.data.state[Xt]=_e[0].button[3].b);break;case Pt.IT_USER:e.data.state[Gt]=pe.up,e.data.state[Ut]=pe.down,e.data.state[Bt]=pe.left,e.data.state[Yt]=pe.right,e.data.state[Ht]=pe.space,e.data.state[Wt]=pe.lcontrol,e.data.state[Ft]=pe.enter,e.data.state[Xt]=pe.esc,ue&&(e.data.state[Gt]=fe.up(),e.data.state[Ut]=fe.down(),e.data.state[Bt]=fe.left(),e.data.state[Yt]=fe.right(),e.data.state[Ht]=he._pressed,e.data.state[Xt]=me._pressed,e.data.state[Wt]=ge._pressed),$t&&(ve="undefined"==typeof navigator?null:navigator.getGamepads()[0]||null),ve&&(e.data.state[Gt]=ve.buttons[12].pressed,e.data.state[Ut]=ve.buttons[13].pressed,e.data.state[Bt]=ve.buttons[14].pressed,e.data.state[Yt]=ve.buttons[15].pressed,e.data.state[Ht]=ve.buttons[0].pressed,e.data.state[Wt]=ve.buttons[1].pressed,e.data.state[Ft]=ve.buttons[2].pressed,e.data.state[Xt]=ve.buttons[3].pressed)}}}(),(t=Fe())&&(t.update(),t==Fe()&&t.render()),function(){if(r=!1,0!=o)if((c+=z())<d){var t=void 0;t=J(t=1.25*c/d*100,0,100),t=1==o?100-t:t,t/=100,St().fillStyle=s,St().globalAlpha=t,St().fillRect(0,0,n.width,n.height)}else 2==o&&(St().fillStyle=s,St().fillRect(0,0,n.width,n.height)),o=0,d=c=0,s=null,r=!0;St().globalAlpha=1,It()&&(St().font="14px Arial",St().fillStyle="white",St().fillText(""+H,450,20))}(),fe&&fe.render(St()),he&&he.render(St()),me&&me.render(St()),ge&&ge.render(St())},i=null,requestAnimationFrame((function t(n){var a=!1;if(null!=i){Math.min(n-i,100);a=!1===e()}i=n,a||requestAnimationFrame(t)}))},yy=function(){E("preferences_init()"),function(){if(P.video_resolution="TINY",P.fullscreen=!1,P.smooth_graphics=!1,P.show_fps=!1,P.language="data/languages/english.json","undefined"!=typeof window)for(var t in P){var e=window.localStorage.getItem(t)?localStorage.getItem(t):P[t];"false"==e&&(e=!1),"true"==e&&(e=!0),P[t]=e}}()},xy=function(a){E("timer_init()"),B=0,Y=0,H=0,F=0,W=$(),function(t,e,a,o,r,s){Ot(e,a,o),Dt(s);var c=document.getElementById("canvas");c?(i=(n=c).getContext("2d"),ht=n.width/ut,mt=n.height/lt,i.scale(n.width/ut,n.height/lt)):(c=document.createElement("canvas"),i=(n=c).getContext("2d"),n.width=ut,n.height=lt,document.body.appendChild(n)),ht=ut/window.innerWidth,mt=ht,i.imageSmoothingEnabled=!1,kt()}(wy(),a.video_resolution,a.smooth_graphics,a.fullscreen,a.color_depth,a.show_fps),E("input_init()"),se=null,Et().addEventListener("contextmenu",(function(t){if(2===t.button)return t.preventDefault(),!1}),!1),Et().addEventListener("mousemove",(function(t){be=function(t,e){var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(Et(),t)}),!1),Et().addEventListener("mousedown",(function(t){switch(t.which){case 1:ye.left=!0;break;case 2:ye.middle=!0;break;case 3:ye.right=!0}}),!1),Et().addEventListener("mouseup",(function(t){switch(t.which){case 1:ye.left=!1;break;case 2:ye.middle=!1;break;case 3:ye.right=!1}}),!1),ce=!1,de=!1,$t="undefined"!=typeof navigator&&"getGamepads"in navigator,(ue=function(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}())&&((fe=new Ct({container:Et(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>=window.innerWidth/2||e.pageY<window.innerHeight/2)})),(he=new Ct({container:Et(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:200,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY<window.innerHeight/2)})),(me=new Ct({container:Et(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:70,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX>window.innerWidth/2||e.pageY>window.innerHeight/2)})),(ge=new Ct({container:Et(),strokeStyle:"#eee",mouseSupport:!0,stationaryBase:!0,baseX:420,baseY:50,limitStickTravel:!0,stickRadius:50})).addEventListener("touchStartValidation",(function(t){var e=t.changedTouches[0];return!(e.pageX<window.innerWidth/2||e.pageY>window.innerHeight/2)}))),pe=Le(le),g.images={},g.images,g.samples={},t=g.samples,g.musics={},e=g.musics},ky=function(t,e){E("soundfactory: loading the samples table..."),k("data/config/samples.json").then((function(t){$e(t)})),E("Loading objects scripts..."),yp=null,k("data/objects/enemies.json").then((function(t){yp=t})),function(){for(var t=0;t<256;t++)my[t]=null;my[ay]=vy(vh,bh,yh,xh),my[oy]=vy(Eb,Sb,Mb,jb),my[ry]=vy(Dg,Og,Rg,Ag),my[sy]=vy(xg,kg,wg,Eg),my[dy]=vy(dv,uv,lv,pv),my[0]=vy(Cg,Pg,Gg,Ug),my[cy]=vy(Zi,ta,ea,na),my[uy]=vy(Ib,Db,Ob,Rb),my[ly]=vy(Ei,Si,Mi,ji),my[py]=vy(Kg,qg,Jg,Zg),my[_y]=vy(Fi,Xi,zi,$i),my[fy]=vy(jv,Tv,Iv,Dv),my[hy]=vy(Jb,Zb,ty,ey)}(),function(t,e){E("Initializing the language module"),Pe(Ne=t||Ne).then((function(){E("lang_init() ok!"),e()}))}(t.language,(function(){!function(){Ye=0;for(var t=0;t<16;t++)Be[t]=null}(),e()}))},wy=function(){return""};!function(t){yy();var e=function(t){var e={};return e.video_resolution=P.video_resolution,e.smooth_graphics=P.smooth_graphics,e.fullscreen=P.fullscreen,e.show_fps=P.show_fps,e.language=P.language,e.video_resolution=t.video_resolution?t.video_resolution:e.video_resolution,e.smooth_graphics=t.smooth_graphics?t.smooth_graphics:e.smooth_graphics,e.fullscreen=t.fullscreen?t.fullscreen:e.fullscreen,e.show_fps=t.show_fps?t.show_fps:e.show_fps,e.color_depth=t.color_depth?t.color_depth:32,e.level=t.level?t.level:null,e.quest=t.quest?t.quest:null,e.language=t.language?t.language:e.language,e.video_resolution=U("video_resolution")?+U("video_resolution"):e.video_resolution,e.smooth_graphics=!!U("smooth_graphics")||e.smooth_graphics,e.fullscreen=!!U("fullscreen")||e.fullscreen,e.show_fps=!!U("show_fps")||e.show_fps,e.color_depth=U("color_depth")?+U("color_depth"):e.color_depth,e.level=U("level")?U("level"):e.level,e.quest=U("quest")?U("quest"):e.quest,e.language=U("language")?U("language"):e.language,e}({});xy(e),new Promise((function(t,e){var n;for(E("Loading sprites..."),g.sprites={},on=g.sprites,n=0;n<rn.length;n++)rn[n]="data/sprites/"+rn[n]+".json";wt("Loading...",0),x(rn).then((function(e){for(n=0;n<e.length;n++)for(var i in e[n])e[n][i].name=i,cn.push(e[n][i]);gn(cn).then((function(){E("All sprites have been loaded!"),on=v(),t(on)}))}))})).then((function(){!function(){var t,e,n,i=["ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789*.:!?","0123456789:","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ","ABCDEFGHIJKLMNOPQRSTUVWXYZ"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"," !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_´abcdefghijklmnopqrstuvwxyz{|}~"];for(E("font_init()"),t=0;t<i.length;t++)for(ni[t]={ch:{}},n="FT_FONT"+t,e=0;e<i[t].length;e++)ni[t].ch[i[t][e]]=un(dn(n,0),e);E("font_init() ok")}(),ky(e,(function(){nc(5),ic(0),function(t){t.level?(hh(t.level),He(gy(ay))):He(gy(0))}(e),by()}))}))}()})();